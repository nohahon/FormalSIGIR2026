,stacks tag,code,Len,Den,P205,P1648,name,reference,type,depth,parents,content,statement,proof,formal_proof,formal_statement,augmented_proof,Informal_proof_comment,comparison_json
0,09GK,"theorem cardinalMk_le_max : #L ‚â§ max #R ‚Ñµ‚ÇÄ := by
  simpa only [lift_id] using lift_cardinalMk_le_max R L
",Formal Proof of Stacks Project Tag 09GK,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Cardinality.lean#L71-L72,Q27041,,9.8.9,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n  Lemma 9.8.9. Let $E/F$ be an algebraic extension of fields. Then the cardinality $|E|$ of $E$ is at most $\\max (\\aleph _0, |F|)$. \n\n    \n      Proof.\n      Let $S$ be the set of nonconstant polynomials with coefficients in $F$. For every $P \\in S$ the set of roots $r(P, E) = \\{ \\alpha \\in E \\mid P(\\alpha ) = 0\\} $ is finite (details omitted). Moreover, the fact that $E$ is algebraic over $F$ implies that $E = \\bigcup _{P \\in S} r(P, E)$. It is clear that $S$ has cardinality bounded by $\\max (\\aleph _0, |F|)$ because it is a countable union of finite products of copies of $F$. Thus so does $E$. \n      $\\square$\n    \n","\n  Lemma 9.8.9. Let $E/F$ be an algebraic extension of fields. Then the cardinality $|E|$ of $E$ is at most $\\max (\\aleph _0, |F|)$. \n\n    \n","Proof.\n      Let $S$ be the set of nonconstant polynomials with coefficients in $F$. For every $P \\in S$ the set of roots $r(P, E) = \\{ \\alpha \\in E \\mid P(\\alpha ) = 0\\} $ is finite (details omitted). Moreover, the fact that $E$ is algebraic over $F$ implies that $E = \\bigcup _{P \\in S} r(P, E)$. It is clear that $S$ has cardinality bounded by $\\max (\\aleph _0, |F|)$ because it is a countable union of finite products of copies of $F$. Thus so does $E$. \n      $\\square$\n    \n"," by
  simpa only [lift_id] using lift_cardinalMk_le_max R L
",theorem cardinalMk_le_max : #L ‚â§ max #R ‚Ñµ‚ÇÄ ,"Proof.\n      Let $S$ be the set of nonconstant polynomials with coefficients in $F$. For every $P \\in S$ the set of roots $r(P, E) = \\{ \\alpha \\in E \\mid P(\\alpha ) = 0\\} $ is finite (details omitted). Moreover, the fact that $E$ is algebraic over $F$ implies that $E = \\bigcup _{P \\in S} r(P, E)$. It is clear that $S$ has cardinality bounded by $\\max (\\aleph _0, |F|)$ because it is a countable union of finite products of copies of $F$. Thus so does $E$. \n      $\\square$\n    \n","Proof.\n      Let $S$ be the set of nonconstant polynomials with coefficients in $F$. For every $P \\in S$ the set of roots $r(P, E) = \\{ \\alpha \\in E \\mid P(\\alpha ) = 0\\} $ is finite (details omitted). Moreover, the fact that $E$ is algebraic over $F$ implies that $E = \\bigcup _{P \\in S} r(P, E)$. It is clear that $S$ has cardinality bounded by $\\max (\\aleph _0, |F|)$ because it is a countable union of finite products of copies of $F$. Thus so does $E$. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues a cardinality bound for an algebraic extension by covering the field E as a union of finite root sets of nonconstant polynomials over F, and bounding the size of the polynomial set by max(‚Ñµ0, |F|). The Lean proof, however, is a one-line `simpa` that reduces the goal to an existing lemma `lift_cardinalMk_le_max R L` (with a simplification `[lift_id]`). This suggests it is proving a related cardinal inequality about cardinal lifts and a max bound, but it does not explicitly reflect the union-of-roots argument or the polynomial-counting structure. Structurally, there is essentially no correspondence: the formal proof delegates everything to a pre-proved lemma, whereas the informal proof provides a concrete combinatorial argument. The alignment is therefore weak-to-moderate: likely the same end statement (a cardinal bound) is being established, but the formal proof does not mirror the informal reasoning and may rely on a different abstraction.""}"
6,01Z2,"lemma Scheme.nonempty_of_isLimit [IsCofilteredOrEmpty I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)] [‚àÄ i, Nonempty (D.obj i)]
    [‚àÄ i, CompactSpace (D.obj i)] :
    Nonempty c.pt := by
  classical
  cases isEmpty_or_nonempty I
  ¬∑ have e := (isLimitEquivIsTerminalOfIsEmpty _ _ hc).uniqueUpToIso specULiftZIsTerminal
    exact Nonempty.map e.inv inferInstance
  ¬∑ have i := Nonempty.some ‚ÄπNonempty I‚Ä∫
    have : IsCofiltered I := ‚ü®‚ü©
    let ùí∞ := (D.obj i).affineCover.finiteSubcover
    have (i' : _) : IsAffine (ùí∞.X i') := inferInstanceAs (IsAffine (Spec _))
    obtain ‚ü®j, H‚ü© :
        ‚àÉ j : ùí∞.I‚ÇÄ, ‚àÄ {i'} (f : i' ‚ü∂ i), Nonempty ((ùí∞.pullback‚ÇÅ (D.map f)).X j) := by
      by_contra! H
      choose i' f hf using H
      let g (j) := IsCofiltered.infTo (insert i (Finset.univ.image i'))
        (Finset.univ.image fun j : ùí∞.I‚ÇÄ ‚Ü¶ ‚ü®_, _, by simp, by simp, f j‚ü©) (X := j)
      have (j : ùí∞.I‚ÇÄ) : IsEmpty ((ùí∞.pullback‚ÇÅ (D.map (g i (by simp)))).X j) := by
        let F : (ùí∞.pullback‚ÇÅ (D.map (g i (by simp)))).X j ‚ü∂
            (ùí∞.pullback‚ÇÅ (D.map (f j))).X j :=
          pullback.map _ _ _ _ (D.map (g _ (by simp))) (ùüô _) (ùüô _) (by
            rw [‚Üê D.map_comp, IsCofiltered.infTo_commutes]
            ¬∑ simp [g]
            ¬∑ simp
            ¬∑ exact Finset.mem_image_of_mem _ (Finset.mem_univ _)) (by simp)
        exact Function.isEmpty F
      obtain ‚ü®x, -‚ü© :=
        Cover.covers (ùí∞.pullback‚ÇÅ (D.map (g i (by simp)))) (Nonempty.some inferInstance)
      exact (this _).elim x
    let F := Over.post D ‚ãô Over.pullback (ùí∞.f j) ‚ãô Over.forget _
    have (i' : _) : IsAffine (F.obj i') :=
      have : IsAffineHom (pullback.snd (D.map i'.hom) (ùí∞.f j)) :=
        MorphismProperty.pullback_snd _ _ inferInstance
      isAffine_of_isAffineHom (pullback.snd (D.map i'.hom) (ùí∞.f j))
    have (i' : _) : Nonempty (F.obj i') := H i'.hom
    let e : F ‚ü∂ (F ‚ãô Scheme.Œì.rightOp) ‚ãô Scheme.Spec := Functor.whiskerLeft F ŒìSpec.adjunction.unit
    have (i : _) : IsIso (e.app i) := IsAffine.affine
    have : IsIso e := NatIso.isIso_of_isIso_app e
    let c' : LimitCone F := ‚ü®_, (IsLimit.postcomposeInvEquiv (asIso e) _).symm
      (isLimitOfPreserves Scheme.Spec (limit.isLimit (F ‚ãô Scheme.Œì.rightOp)))‚ü©
    have : Nonempty c'.1.pt := by
      apply (config := { allowSynthFailures := true }) PrimeSpectrum.instNonemptyOfNontrivial
      have (i' : _) : Nontrivial ((F ‚ãô Scheme.Œì.rightOp).leftOp.obj i') := by
        apply (config := { allowSynthFailures := true }) Scheme.component_nontrivial
        simp
      exact CommRingCat.FilteredColimits.nontrivial
        (isColimitCoconeLeftOpOfCone _ (limit.isLimit (F ‚ãô Scheme.Œì.rightOp)))
    let Œ± : F ‚ü∂ Over.forget _ ‚ãô D := Functor.whiskerRight
      (Functor.whiskerLeft (Over.post D) (Over.mapPullbackAdj (ùí∞.f j)).counit) (Over.forget _)
    exact this.map (((Functor.Initial.isLimitWhiskerEquiv (Over.forget i) c).symm hc).lift
        ((Cones.postcompose Œ±).obj c'.1))
",Formal Proof of Stacks Project Tag 01Z2,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/AffineTransitionLimit.lean#L45-L96,Q27041,,32.4.3,lemma,3.0,"['081A', '01YT', '0ELP']","\n  Lemma 32.4.3. Let $S = \\mathop{\\mathrm{lim}}\\nolimits S_ i$ be the limit of a directed inverse system of schemes with affine transition morphisms (Lemma 32.2.2). If all the schemes $S_ i$ are nonempty and quasi-compact, then the limit $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ is nonempty. \n\n    \n      Proof.\n      Choose $0 \\in I$. Note that $I$ is nonempty as the limit is directed. Choose an affine open covering $S_0 = \\bigcup _{j = 1, \\ldots , m} U_ j$. Since $I$ is directed there exists a $j \\in \\{ 1, \\ldots , m\\} $ such that $f_{i0}^{-1}(U_ j) \\not= \\emptyset $ for all $i \\geq 0$. Hence $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is not empty since a directed colimit of nonzero rings is nonzero (because $1 \\not= 0$). As $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is an open subscheme of the limit we win. \n      $\\square$\n    \n","\n  Lemma 32.4.3. Let $S = \\mathop{\\mathrm{lim}}\\nolimits S_ i$ be the limit of a directed inverse system of schemes with affine transition morphisms (Lemma 32.2.2). If all the schemes $S_ i$ are nonempty and quasi-compact, then the limit $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ is nonempty. \n\n    \n","Proof.\n      Choose $0 \\in I$. Note that $I$ is nonempty as the limit is directed. Choose an affine open covering $S_0 = \\bigcup _{j = 1, \\ldots , m} U_ j$. Since $I$ is directed there exists a $j \\in \\{ 1, \\ldots , m\\} $ such that $f_{i0}^{-1}(U_ j) \\not= \\emptyset $ for all $i \\geq 0$. Hence $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is not empty since a directed colimit of nonzero rings is nonzero (because $1 \\not= 0$). As $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is an open subscheme of the limit we win. \n      $\\square$\n    \n"," by
  classical
  cases isEmpty_or_nonempty I
  ¬∑ have e := (isLimitEquivIsTerminalOfIsEmpty _ _ hc).uniqueUpToIso specULiftZIsTerminal
    exact Nonempty.map e.inv inferInstance
  ¬∑ have i := Nonempty.some ‚ÄπNonempty I‚Ä∫
    have : IsCofiltered I := ‚ü®‚ü©
    let ùí∞ := (D.obj i).affineCover.finiteSubcover
    have (i' : _) : IsAffine (ùí∞.X i') := inferInstanceAs (IsAffine (Spec _))
    obtain ‚ü®j, H‚ü© :
        ‚àÉ j : ùí∞.I‚ÇÄ, ‚àÄ {i'} (f : i' ‚ü∂ i), Nonempty ((ùí∞.pullback‚ÇÅ (D.map f)).X j) := by
      by_contra! H
      choose i' f hf using H
      let g (j) := IsCofiltered.infTo (insert i (Finset.univ.image i'))
        (Finset.univ.image fun j : ùí∞.I‚ÇÄ ‚Ü¶ ‚ü®_, _, by simp, by simp, f j‚ü©) (X := j)
      have (j : ùí∞.I‚ÇÄ) : IsEmpty ((ùí∞.pullback‚ÇÅ (D.map (g i (by simp)))).X j) := by
        let F : (ùí∞.pullback‚ÇÅ (D.map (g i (by simp)))).X j ‚ü∂
            (ùí∞.pullback‚ÇÅ (D.map (f j))).X j :=
          pullback.map _ _ _ _ (D.map (g _ (by simp))) (ùüô _) (ùüô _) (by
            rw [‚Üê D.map_comp, IsCofiltered.infTo_commutes]
            ¬∑ simp [g]
            ¬∑ simp
            ¬∑ exact Finset.mem_image_of_mem _ (Finset.mem_univ _)) (by simp)
        exact Function.isEmpty F
      obtain ‚ü®x, -‚ü© :=
        Cover.covers (ùí∞.pullback‚ÇÅ (D.map (g i (by simp)))) (Nonempty.some inferInstance)
      exact (this _).elim x
    let F := Over.post D ‚ãô Over.pullback (ùí∞.f j) ‚ãô Over.forget _
    have (i' : _) : IsAffine (F.obj i') :=
      have : IsAffineHom (pullback.snd (D.map i'.hom) (ùí∞.f j)) :=
        MorphismProperty.pullback_snd _ _ inferInstance
      isAffine_of_isAffineHom (pullback.snd (D.map i'.hom) (ùí∞.f j))
    have (i' : _) : Nonempty (F.obj i') := H i'.hom
    let e : F ‚ü∂ (F ‚ãô Scheme.Œì.rightOp) ‚ãô Scheme.Spec := Functor.whiskerLeft F ŒìSpec.adjunction.unit
    have (i : _) : IsIso (e.app i) := IsAffine.affine
    have : IsIso e := NatIso.isIso_of_isIso_app e
    let c' : LimitCone F := ‚ü®_, (IsLimit.postcomposeInvEquiv (asIso e) _).symm
      (isLimitOfPreserves Scheme.Spec (limit.isLimit (F ‚ãô Scheme.Œì.rightOp)))‚ü©
    have : Nonempty c'.1.pt := by
      apply (config := { allowSynthFailures := true }) PrimeSpectrum.instNonemptyOfNontrivial
      have (i' : _) : Nontrivial ((F ‚ãô Scheme.Œì.rightOp).leftOp.obj i') := by
        apply (config := { allowSynthFailures := true }) Scheme.component_nontrivial
        simp
      exact CommRingCat.FilteredColimits.nontrivial
        (isColimitCoconeLeftOpOfCone _ (limit.isLimit (F ‚ãô Scheme.Œì.rightOp)))
    let Œ± : F ‚ü∂ Over.forget _ ‚ãô D := Functor.whiskerRight
      (Functor.whiskerLeft (Over.post D) (Over.mapPullbackAdj (ùí∞.f j)).counit) (Over.forget _)
    exact this.map (((Functor.Initial.isLimitWhiskerEquiv (Over.forget i) c).symm hc).lift
        ((Cones.postcompose Œ±).obj c'.1))
","lemma Scheme.nonempty_of_isLimit [IsCofilteredOrEmpty I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)] [‚àÄ i, Nonempty (D.obj i)]
    [‚àÄ i, CompactSpace (D.obj i)] :
    Nonempty c.pt ","Proof.\n      Choose $0 \\in I$. Note that $I$ is nonempty as the limit is directed. Choose an affine open covering $S_0 = \\bigcup _{j = 1, \\ldots , m} U_ j$. Since $I$ is directed there exists a $j \\in \\{ 1, \\ldots , m\\} $ such that $f_{i0}^{-1}(U_ j) \\not= \\emptyset $ for all $i \\geq 0$. Hence $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is not empty since a directed colimit of nonzero rings is nonzero (because $1 \\not= 0$). As $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is an open subscheme of the limit we win. \n      $\\square$\n    \n","Proof.\n      Choose $0 \\in I$. Note that $I$ is nonempty as the limit is directed. Choose an affine open covering $S_0 = \\bigcup _{j = 1, \\ldots , m} U_ j$. Since $I$ is directed there exists a $j \\in \\{ 1, \\ldots , m\\} $ such that $f_{i0}^{-1}(U_ j) \\not= \\emptyset $ for all $i \\geq 0$. Hence $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is not empty since a directed colimit of nonzero rings is nonzero (because $1 \\not= 0$). As $\\mathop{\\mathrm{lim}}\\nolimits _{i \\geq 0} f_{i0}^{-1}(U_ j)$ is an open subscheme of the limit we win. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs aim to show nonemptiness of a limit scheme by reducing to a nonempty affine open in a cofiltered/filtered diagram and then using that the corresponding ring colimit is nontrivial, hence its prime spectrum is nonempty. The Lean proof mirrors the key ingredients: it picks an object i in a nonempty index category, takes a finite affine subcover of D.obj i, uses cofilteredness to find an index j such that all pullbacks along maps into i are nonempty (the obtain ‚ü®j, H‚ü© step), then forms a functor F of these pullbacks, identifies F with Spec of global sections via the Œì‚ÄìSpec adjunction and affineness (constructing e and proving it is an iso), and finally proves Nonempty of the limit point using nontriviality of a filtered colimit of rings and PrimeSpectrum nonemptiness. Structurally this matches the informal argument: choose i0, choose finite affine cover, pick one open with all pullbacks nonempty by directedness, then conclude the limit of that subsystem is nonempty via nontrivial filtered colimit of rings, and it sits as an open subscheme of the limit. The main mismatch is that the Lean proof includes an extra case split for IsEmpty I (handling the empty index category via terminality/uniqueUpToIso), which is not discussed in the informal proof, and it is more categorical (Over categories, whiskering, isLimit transport) than the informal narrative. Nonetheless, the core mathematical strategy and dependencies align well.""}"
7,01Z3,"lemma exists_mem_of_isClosed_of_nonempty'
    [IsCofilteredOrEmpty I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    {j : I}
    (Z : ‚àÄ (i : I), (i ‚ü∂ j) ‚Üí Set (D.obj i))
    (hZc : ‚àÄ i hij, IsClosed (Z i hij))
    (hZne : ‚àÄ i hij, (Z i hij).Nonempty)
    (hZcpt : ‚àÄ i hij, IsCompact (Z i hij))
    (hstab : ‚àÄ (i i' : I) (hi'i : i' ‚ü∂ i) (hij : i ‚ü∂ j),
      Set.MapsTo (D.map hi'i) (Z i' (hi'i ‚â´ hij)) (Z i hij)) :
    ‚àÉ (s : c.pt), ‚àÄ i hij, c.œÄ.app i s ‚àà Z i hij := by
  have {i‚ÇÅ i‚ÇÇ : Over j} (f : i‚ÇÅ ‚ü∂ i‚ÇÇ) : IsAffineHom ((Over.forget j ‚ãô D).map f) := by
    dsimp; infer_instance
  simpa [Over.forall_iff] using exists_mem_of_isClosed_of_nonempty (Over.forget j ‚ãô D) _
    ((Functor.Initial.isLimitWhiskerEquiv (Over.forget j) c).symm hc)
    (fun i ‚Ü¶ Z i.left i.hom) (fun _ ‚Ü¶ hZc _ _) (fun _ ‚Ü¶ hZne _ _) (fun _ ‚Ü¶ hZcpt _ _)
    (fun {i‚ÇÅ i‚ÇÇ} f ‚Ü¶ by dsimp; rw [‚Üê Over.w f]; exact hstab ..)
",Formal Proof of Stacks Project Tag 01Z3,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/AffineTransitionLimit.lean#L153-L169,Q27041,,32.4.8,lemma,3.0,"['081A', '01YT', '0ELP']","\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n      Proof.\n      Let $Z_ i \\subset S_ i$ also denote the reduced closed subscheme associated to $Z_ i$, see Schemes, Definition 26.12.5. A closed immersion is affine, and a composition of affine morphisms is affine (see Morphisms, Lemmas 29.11.10 and 29.11.8), and hence $Z_{i\'} \\to S_ i$ is affine when $i\' \\geq i$. We conclude that the morphism $f_{i\'i} : Z_{i\'} \\to Z_ i$ is affine by Morphisms, Lemma 29.11.12. Each of the schemes $Z_ i$ is quasi-compact as a closed subscheme of a quasi-compact scheme. Hence we may apply Lemma 32.4.3 to see that $Z = \\mathop{\\mathrm{lim}}\\nolimits _ i Z_ i$ is nonempty. Since there is a canonical morphism $Z \\to S$ we win. \n      $\\square$\n    \n",\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n,"Proof.\n      Let $Z_ i \\subset S_ i$ also denote the reduced closed subscheme associated to $Z_ i$, see Schemes, Definition 26.12.5. A closed immersion is affine, and a composition of affine morphisms is affine (see Morphisms, Lemmas 29.11.10 and 29.11.8), and hence $Z_{i\'} \\to S_ i$ is affine when $i\' \\geq i$. We conclude that the morphism $f_{i\'i} : Z_{i\'} \\to Z_ i$ is affine by Morphisms, Lemma 29.11.12. Each of the schemes $Z_ i$ is quasi-compact as a closed subscheme of a quasi-compact scheme. Hence we may apply Lemma 32.4.3 to see that $Z = \\mathop{\\mathrm{lim}}\\nolimits _ i Z_ i$ is nonempty. Since there is a canonical morphism $Z \\to S$ we win. \n      $\\square$\n    \n"," by
  have {i‚ÇÅ i‚ÇÇ : Over j} (f : i‚ÇÅ ‚ü∂ i‚ÇÇ) : IsAffineHom ((Over.forget j ‚ãô D).map f) := by
    dsimp; infer_instance
  simpa [Over.forall_iff] using exists_mem_of_isClosed_of_nonempty (Over.forget j ‚ãô D) _
    ((Functor.Initial.isLimitWhiskerEquiv (Over.forget j) c).symm hc)
    (fun i ‚Ü¶ Z i.left i.hom) (fun _ ‚Ü¶ hZc _ _) (fun _ ‚Ü¶ hZne _ _) (fun _ ‚Ü¶ hZcpt _ _)
    (fun {i‚ÇÅ i‚ÇÇ} f ‚Ü¶ by dsimp; rw [‚Üê Over.w f]; exact hstab ..)
","lemma exists_mem_of_isClosed_of_nonempty'
    [IsCofilteredOrEmpty I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    {j : I}
    (Z : ‚àÄ (i : I), (i ‚ü∂ j) ‚Üí Set (D.obj i))
    (hZc : ‚àÄ i hij, IsClosed (Z i hij))
    (hZne : ‚àÄ i hij, (Z i hij).Nonempty)
    (hZcpt : ‚àÄ i hij, IsCompact (Z i hij))
    (hstab : ‚àÄ (i i' : I) (hi'i : i' ‚ü∂ i) (hij : i ‚ü∂ j),
      Set.MapsTo (D.map hi'i) (Z i' (hi'i ‚â´ hij)) (Z i hij)) :
    ‚àÉ (s : c.pt), ‚àÄ i hij, c.œÄ.app i s ‚àà Z i hij ","Proof.\n      Let $Z_ i \\subset S_ i$ also denote the reduced closed subscheme associated to $Z_ i$, see Schemes, Definition 26.12.5 [[\n  Definition 26.12.5. Let $X$ be a scheme. Let $Z \\subset X$ be a closed subset. A scheme structure on $Z$ is given by a closed subscheme $Z\'$ of $X$ whose underlying set is equal to $Z$. We often say \xe2\x80\x9clet $(Z, \\mathcal{O}_ Z)$ be a scheme structure on $Z$\xe2\x80\x9d to indicate this. The reduced induced scheme structure on $Z$ is the one constructed in Lemma 26.12.4. The reduction $X_{red}$ of $X$ is the reduced induced scheme structure on $X$ itself. \n]]. A closed immersion is affine, and a composition of affine morphisms is affine (see Morphisms, Lemmas 29.11.10 [[\n  Lemma 29.11.10. A closed immersion is affine. \n\n    \n]] and 29.11.8 [[\n  Lemma 29.11.8. The composition of affine morphisms is affine. \n\n    \n]]), and hence $Z_{i\'} \\to S_ i$ is affine when $i\' \\geq i$. We conclude that the morphism $f_{i\'i} : Z_{i\'} \\to Z_ i$ is affine by Morphisms, Lemma 29.11.12 [[\n  Lemma 29.11.12. Suppose $g : X \\to Y$ is a morphism of schemes over $S$. \n  \n  \nIf $X$ is affine over $S$ and $\\Delta : Y \\to Y \\times _ S Y$ is affine, then $g$ is affine. \n\n\nIf $X$ is affine over $S$ and $Y$ is separated over $S$, then $g$ is affine. \n\n\nA morphism from an affine scheme to a scheme with affine diagonal is affine. \n\n\nA morphism from an affine scheme to a separated scheme is affine. \n\n\n\n\n    \n]]. Each of the schemes $Z_ i$ is quasi-compact as a closed subscheme of a quasi-compact scheme. Hence we may apply Lemma 32.4.3 [[\n  Lemma 32.4.3. Let $S = \\mathop{\\mathrm{lim}}\\nolimits S_ i$ be the limit of a directed inverse system of schemes with affine transition morphisms (Lemma 32.2.2). If all the schemes $S_ i$ are nonempty and quasi-compact, then the limit $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ is nonempty. \n\n    \n]] to see that $Z = \\mathop{\\mathrm{lim}}\\nolimits _ i Z_ i$ is nonempty. Since there is a canonical morphism $Z \\to S$ we win. \n      $\\square$\n    \n","Proof.\n      Let $Z_ i \\subset S_ i$ also denote the reduced closed subscheme associated to $Z_ i$, see Schemes, Definition 26.12.5 [[\n  Definition 26.12.5. Let $X$ be a scheme. Let $Z \\subset X$ be a closed subset. A scheme structure on $Z$ is given by a closed subscheme $Z\'$ of $X$ whose underlying set is equal to $Z$. We often say \xe2\x80\x9clet $(Z, \\mathcal{O}_ Z)$ be a scheme structure on $Z$\xe2\x80\x9d to indicate this. The reduced induced scheme structure on $Z$ is the one constructed in Lemma 26.12.4. The reduction $X_{red}$ of $X$ is the reduced induced scheme structure on $X$ itself. \n]]. A closed immersion is affine, and a composition of affine morphisms is affine (see Morphisms, Lemmas 29.11.10 [[\n  Lemma 29.11.10. A closed immersion is affine. \n\n    \n]] and 29.11.8 [[\n  Lemma 29.11.8. The composition of affine morphisms is affine. \n\n    \n]]), and hence $Z_{i\'} \\to S_ i$ is affine when $i\' \\geq i$. We conclude that the morphism $f_{i\'i} : Z_{i\'} \\to Z_ i$ is affine by Morphisms, Lemma 29.11.12 [[\n  Lemma 29.11.12. Suppose $g : X \\to Y$ is a morphism of schemes over $S$. \n  \n  \nIf $X$ is affine over $S$ and $\\Delta : Y \\to Y \\times _ S Y$ is affine, then $g$ is affine. \n\n\nIf $X$ is affine over $S$ and $Y$ is separated over $S$, then $g$ is affine. \n\n\nA morphism from an affine scheme to a scheme with affine diagonal is affine. \n\n\nA morphism from an affine scheme to a separated scheme is affine. \n\n\n\n\n    \n]]. Each of the schemes $Z_ i$ is quasi-compact as a closed subscheme of a quasi-compact scheme. Hence we may apply Lemma 32.4.3 [[\n  Lemma 32.4.3. Let $S = \\mathop{\\mathrm{lim}}\\nolimits S_ i$ be the limit of a directed inverse system of schemes with affine transition morphisms (Lemma 32.2.2). If all the schemes $S_ i$ are nonempty and quasi-compact, then the limit $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ is nonempty. \n\n    \n]] to see that $Z = \\mathop{\\mathrm{lim}}\\nolimits _ i Z_ i$ is nonempty. Since there is a canonical morphism $Z \\to S$ we win. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs aim to deduce nonemptiness of a limit object (the limit of the Z_i) from nonemptiness/closedness/compactness hypotheses on the Z_i and affineness of transition maps, and then conclude via the canonical map to the ambient limit S. The Lean proof applies a general lemma `exists_mem_of_isClosed_of_nonempty` to the diagram `(Over.forget j ‚ãô D)` with closed subsets `Z i.left i.hom`, supplying hypotheses: closedness (`hZc`), nonemptiness (`hZne`), compactness/quasi-compactness (`hZcpt`), and stability under morphisms (`hstab`), plus it establishes that all transition morphisms are affine via an `IsAffineHom` instance. This matches the informal argument‚Äôs key steps: show transition maps are affine, note quasi-compactness, then apply a nonemptiness-of-limit lemma.\nStructurally, the informal proof explicitly derives affineness using several cited lemmas about closed immersions and affine diagonals, whereas the Lean proof compresses this into an `infer_instance` for `IsAffineHom` on the mapped morphisms; thus the structure is less explicit but corresponds to the same requirement. The informal proof also discusses reduced induced scheme structures and specific scheme-theoretic lemmas, which do not appear in the Lean snippet; these details are not reflected formally (they are presumably packaged into the hypotheses/instances). Overall the core logical flow aligns well, with some mismatch in explicit intermediate reasoning and extra informal discussion not mirrored in the Lean code.""}"
8,01Z4,"lemma exists_map_preimage_eq_map_preimage
    [IsCofiltered I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    {i : I} {U V : (D.obj i).Opens} (hU : IsCompact (U : Set (D.obj i)))
    (hV : IsCompact (V : Set (D.obj i))) (H : c.œÄ.app i ‚Åª¬π·µÅ U = c.œÄ.app i ‚Åª¬π·µÅ V) :
    ‚àÉ (j : I) (fji : j ‚ü∂ i), D.map fji ‚Åª¬π·µÅ U = D.map fji ‚Åª¬π·µÅ V := by
  obtain ‚ü®j‚ÇÅ, fj‚ÇÅi, e‚ÇÅ‚ü© := exists_map_preimage_le_map_preimage D c hc hU H.le
  obtain ‚ü®j‚ÇÇ, fj‚ÇÇi, e‚ÇÇ‚ü© := exists_map_preimage_le_map_preimage D c hc hV H.ge
  obtain ‚ü®k, fkj‚ÇÅ, fkj‚ÇÇ, e‚ü© := IsCofiltered.cospan fj‚ÇÅi fj‚ÇÇi
  refine ‚ü®k, fkj‚ÇÅ ‚â´ fj‚ÇÅi, le_antisymm ?_ ?_‚ü©
  ¬∑ simpa only [Scheme.Hom.comp_preimage, Functor.map_comp] using Scheme.Hom.preimage_mono _ e‚ÇÅ
  ¬∑ rw [e]
    simpa only [Scheme.Hom.comp_preimage, Functor.map_comp] using Scheme.Hom.preimage_mono _ e‚ÇÇ
",Formal Proof of Stacks Project Tag 01Z4,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/AffineTransitionLimit.lean#L278-L290,Q27041,,32.4.11,lemma,3.0,"['081A', '01YT', '0ELP']","\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n      Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n","\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n"," by
  obtain ‚ü®j‚ÇÅ, fj‚ÇÅi, e‚ÇÅ‚ü© := exists_map_preimage_le_map_preimage D c hc hU H.le
  obtain ‚ü®j‚ÇÇ, fj‚ÇÇi, e‚ÇÇ‚ü© := exists_map_preimage_le_map_preimage D c hc hV H.ge
  obtain ‚ü®k, fkj‚ÇÅ, fkj‚ÇÇ, e‚ü© := IsCofiltered.cospan fj‚ÇÅi fj‚ÇÇi
  refine ‚ü®k, fkj‚ÇÅ ‚â´ fj‚ÇÅi, le_antisymm ?_ ?_‚ü©
  ¬∑ simpa only [Scheme.Hom.comp_preimage, Functor.map_comp] using Scheme.Hom.preimage_mono _ e‚ÇÅ
  ¬∑ rw [e]
    simpa only [Scheme.Hom.comp_preimage, Functor.map_comp] using Scheme.Hom.preimage_mono _ e‚ÇÇ
","lemma exists_map_preimage_eq_map_preimage
    [IsCofiltered I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    {i : I} {U V : (D.obj i).Opens} (hU : IsCompact (U : Set (D.obj i)))
    (hV : IsCompact (V : Set (D.obj i))) (H : c.œÄ.app i ‚Åª¬π·µÅ U = c.œÄ.app i ‚Åª¬π·µÅ V) :
    ‚àÉ (j : I) (fji : j ‚ü∂ i), D.map fji ‚Åª¬π·µÅ U = D.map fji ‚Åª¬π·µÅ V ","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about finding a common refinement index in a cofiltered diagram and comparing preimages of opens via monotonicity: it uses two applications of an existence lemma `exists_map_preimage_le_map_preimage` (once for a ‚â§-hypothesis and once for a ‚â•-hypothesis), then takes a cospan in a cofiltered category to get a common `k`, and concludes equality by `le_antisymm` using `Scheme.Hom.preimage_mono`. This matches only a very small fragment of the informal proof‚Äôs logic (the directedness/cofilteredness step to pass to a larger index and compare pullbacks).\n\nStructurally, the Lean proof is a short categorical argument (choose indices j‚ÇÅ, j‚ÇÇ, then a common k, then antisymmetry of ‚â§), whereas the informal proof is a long geometric argument establishing uniqueness/existence of quasi-compact opens in an inverse limit of schemes, reducing to affine cases and using radical ideal computations and colimits of rings, plus a gluing argument over an affine open cover. None of the affine/radical/colimit/gluing content appears in the Lean proof.\n\nThus, while there is some thematic overlap (directed/cofiltered refinement to compare preimages), the formal proof does not capture the main semantic content or structure of the informal proof, suggesting low alignment.""}"
9,01Z4,"lemma exists_isAffineOpen_preimage_eq
    [IsCofiltered I] [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    [‚àÄ i, QuasiSeparatedSpace (D.obj i)]
    (U : c.pt.Opens) (hU : IsAffineOpen U) :
    ‚àÉ (i : I) (V : (D.obj i).Opens), IsAffineOpen V ‚àß c.œÄ.app i ‚Åª¬π·µÅ V = U := by
  classical
  obtain ‚ü®i, U, hU', rfl‚ü© := exists_preimage_eq D c hc U hU.isCompact
  have (j : Over i) : CompactSpace ((opensDiagram D i U).obj j) :=
    isCompact_iff_compactSpace.mp (QuasiCompact.isCompact_preimage _ U.2 hU')
  have (j : Over i) : QuasiSeparatedSpace ((opensDiagram D i U).obj j) :=
    (isQuasiSeparated_iff_quasiSeparatedSpace _ (D.map _ ‚Åª¬π·µÅ _).2).mp (.of_quasiSeparatedSpace _)
  have : IsAffine (opensCone D c i U).pt := hU
  obtain ‚ü®j, hj‚ü© := Scheme.exists_isAffine_of_isLimit _ _ (isLimitOpensCone D c hc i U)
  refine ‚ü®_, _, hj, ?_‚ü©
  rw [‚Üê Scheme.Hom.comp_preimage, c.w]
  simp
",Formal Proof of Stacks Project Tag 01Z4,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/AffineTransitionLimit.lean#L1010-L1025,Q27041,,32.4.11,lemma,3.0,"['081A', '01YT', '0ELP']","\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n      Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n","\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n"," by
  classical
  obtain ‚ü®i, U, hU', rfl‚ü© := exists_preimage_eq D c hc U hU.isCompact
  have (j : Over i) : CompactSpace ((opensDiagram D i U).obj j) :=
    isCompact_iff_compactSpace.mp (QuasiCompact.isCompact_preimage _ U.2 hU')
  have (j : Over i) : QuasiSeparatedSpace ((opensDiagram D i U).obj j) :=
    (isQuasiSeparated_iff_quasiSeparatedSpace _ (D.map _ ‚Åª¬π·µÅ _).2).mp (.of_quasiSeparatedSpace _)
  have : IsAffine (opensCone D c i U).pt := hU
  obtain ‚ü®j, hj‚ü© := Scheme.exists_isAffine_of_isLimit _ _ (isLimitOpensCone D c hc i U)
  refine ‚ü®_, _, hj, ?_‚ü©
  rw [‚Üê Scheme.Hom.comp_preimage, c.w]
  simp
","lemma exists_isAffineOpen_preimage_eq
    [IsCofiltered I] [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    [‚àÄ i, QuasiSeparatedSpace (D.obj i)]
    (U : c.pt.Opens) (hU : IsAffineOpen U) :
    ‚àÉ (i : I) (V : (D.obj i).Opens), IsAffineOpen V ‚àß c.œÄ.app i ‚Åª¬π·µÅ V = U ","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Choose an affine open covering $S_0 = U_{1, 0} \\cup \\ldots \\cup U_{m, 0}$. Denote $U_{j, i} \\subset S_ i$ the inverse image of $U_{j, 0}$ under the transition morphism for $i \\geq 0$. Denote $U_ j$ the inverse image of $U_{j, 0}$ in $S$. Note that $U_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i U_{j, i}$ is a limit of affine schemes. \n    \n      We first prove the uniqueness statement: Let $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$. It suffices to show that $f_{i\'\'i}^{-1}(V_ i \\cap U_{j, i\'\'})$ and $f_{i\'\'i\'}^{-1}(V_{i\'} \\cap U_{j, i\'\'})$ become equal for $i\'\'$ large enough. Hence we reduce to the case of a limit of affine schemes. In this case write $S = \\mathop{\\mathrm{Spec}}(R)$ and $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\in I$. We may write $V_ i = S_ i \\setminus V(h_1, \\ldots , h_ m)$ and $V_{i\'} = S_{i\'} \\setminus V(g_1, \\ldots , g_ n)$. The assumption means that the ideals $\\sum g_ jR$ and $\\sum h_ jR$ have the same radical in $R$. This means that $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ for some $N \\gg 0$ and $a_{jj\'}$ and $b_{jj\'}$ in $R$. Since $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ we can chose an index $i\'\' \\geq i$ such that the equations $g_ j^ N = \\sum a_{jj\'}h_{j\'}$ and $h_ j^ N = \\sum b_{jj\'} g_{j\'}$ hold in $R_{i\'\'}$ for some $a_{jj\'}$ and $b_{jj\'}$ in $R_{i\'\'}$. This implies that the ideals $\\sum g_ jR_{i\'\'}$ and $\\sum h_ jR_{i\'\'}$ have the same radical in $R_{i\'\'}$ as desired. \n    \n      We prove existence: If $S_0$ is affine, then $S_ i = \\mathop{\\mathrm{Spec}}(R_ i)$ for all $i \\geq 0$ and $S = \\mathop{\\mathrm{Spec}}(R)$ with $R = \\mathop{\\mathrm{colim}}\\nolimits R_ i$. Then $V = S \\setminus V(g_1, \\ldots , g_ n)$ for some $g_1, \\ldots , g_ n \\in R$. Choose any $i$ large enough so that each of the $g_ j$ comes from an element $g_{j, i} \\in R_ i$ and take $V_ i = S_ i \\setminus V(g_{1, i}, \\ldots , g_{n, i})$. If $S_0$ is general, then the opens $V \\cap U_ j$ are quasi-compact because $S$ is quasi-separated. Hence by the affine case we see that for each $j = 1, \\ldots , m$ there exists an $i_ j \\in I$ and a quasi-compact open $V_{i_ j} \\subset U_{j, i_ j}$ whose inverse image in $U_ j$ is $V \\cap U_ j$. Set $i = \\max (i_1, \\ldots , i_ m)$ and let $V_ i = \\bigcup f_{ii_ j}^{-1}(V_{i_ j})$. \n    \n      The statement on coverings follows from the uniqueness statement for the opens $V_{1, i} \\cup \\ldots \\cup V_{n, i}$ and $S_ i$ of $S_ i$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about producing an affine open in the limit scheme coming from some stage: it uses `exists_preimage_eq` to express an open as a preimage from some index, then applies `Scheme.exists_isAffine_of_isLimit` with an `opensCone`/`opensDiagram` limit argument to obtain an index `j` and an affine open whose pullback matches, finishing by rewriting preimages. This corresponds only loosely to the *existence* part of the informal proof (descending a quasi-compact open along a directed limit, using affine covers and reduction to the affine case).\n\nHowever, the informal proof‚Äôs main content is a detailed descent/uniqueness argument for quasi-compact opens in a directed limit (including radical ideal computations in the affine case, and gluing via an affine open cover in the general case), plus a statement about coverings. None of that uniqueness/radical-ideal/gluing structure appears in the Lean code; the Lean code instead relies on abstract lemmas about compactness/quasi-separatedness of objects in an opens diagram and a limit cone to extract an affine stage. Structurally, the Lean proof is a short categorical/limit-based extraction, while the informal proof is a multi-step descent argument with explicit affine algebra. Thus the Lean proof captures at best a small fragment (existence of an affine preimage) and omits most of the informal proof‚Äôs structure and claims.""}"
10,01ZC,"lemma Scheme.exists_hom_hom_comp_eq_comp_of_locallyOfFiniteType
    {i : I} (a : D.obj i ‚ü∂ X) (ha : t.app i = a ‚â´ f)
    {j : I} (b : D.obj j ‚ü∂ X) (hb : t.app j = b ‚â´ f)
    (hab : c.œÄ.app i ‚â´ a = c.œÄ.app j ‚â´ b) :
    ‚àÉ (k : I) (hik : k ‚ü∂ i) (hjk : k ‚ü∂ j),
      D.map hik ‚â´ a = D.map hjk ‚â´ b := by
  let o := IsCofiltered.min i j
  obtain ‚ü®k, hik, heq‚ü© := Scheme.exists_hom_comp_eq_comp_of_locallyOfFiniteType D t f c hc
    (D.map (IsCofiltered.minToLeft i j) ‚â´ a) (D.map (IsCofiltered.minToRight i j) ‚â´ b)
    (by simp [‚Üê ha])
    (by simp [‚Üê hb]) (by simpa)
  use k, hik ‚â´ IsCofiltered.minToLeft i j, hik ‚â´ IsCofiltered.minToRight i j
  simpa using heq
",Formal Proof of Stacks Project Tag 01ZC,Injective part of (1) => (3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/AffineTransitionLimit.lean#L656-L668,Q27041,,32.6.1,proposition,3.0,"['01ZB', '01YT', '0ELP']","\n       \n      \n  Proposition 32.6.1. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor any directed set $I$, and any inverse system $(T_ i, f_{ii\'})$ of $S$-schemes over $I$ with each $T_ i$ affine, we have \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X)  \\]\n\n\nFor any directed set $I$, and any inverse system $(T_ i, f_{ii\'})$ of $S$-schemes over $I$ with each $f_{ii\'}$ affine and every $T_ i$ quasi-compact and quasi-separated as a scheme, we have \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X)  \\]\n\n\n\n\n    \n      Proof.\n      It is clear that (3) implies (2). \n    \n      Let us prove that (2) implies (1). Assume (2). Choose any affine opens $U \\subset X$ and $V \\subset S$ such that $f(U) \\subset V$. We have to show that $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. Let $(A_ i, \\varphi _{ii\'})$ be a directed system of $\\mathcal{O}_ S(V)$-algebras. Set $A = \\mathop{\\mathrm{colim}}\\nolimits _ i A_ i$. According to Algebra, Lemma 10.127.3 we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A_ i)  \\]\n\n    \n       Consider the schemes $T_ i = \\mathop{\\mathrm{Spec}}(A_ i)$. They form an inverse system of $V$-schemes over $I$ with transition morphisms $f_{ii\'} : T_ i \\to T_{i\'}$ induced by the $\\mathcal{O}_ S(V)$-algebra maps $\\varphi _{i\'i}$. Set $T := \\mathop{\\mathrm{Spec}}(A) = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. The formula above becomes in terms of morphism sets of schemes \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ V(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U).  \\]\n\n    \n       We first observe that $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)$ and $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T, U)$. Hence we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)  \\]\n\n    \n       and we are given that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X).  \\]\n\n    \n       Hence it suffices to prove that given a morphism $g_ i : T_ i \\to X$ over $S$ such that the composition $T \\to T_ i \\to X$ ends up in $U$ there exists some $i\' \\geq i$ such that the composition $g_{i\'} : T_{i\'} \\to T_ i \\to X$ ends up in $U$. Denote $Z_{i\'} = g_{i\'}^{-1}(X \\setminus U)$. Assume each $Z_{i\'}$ is nonempty to get a contradiction. By Lemma 32.4.8 there exists a point $t$ of $T$ which is mapped into $Z_{i\'}$ for all $i\' \\geq i$. Such a point is not mapped into $U$. A contradiction. \n    \n      Finally, let us prove that (1) implies (3). Assume (1). Let an inverse directed system $(T_ i, f_{ii\'})$ of $S$-schemes be given. Assume the morphisms $f_{ii\'}$ are affine and each $T_ i$ is quasi-compact and quasi-separated as a scheme. Let $T = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. Denote $f_ i : T \\to T_ i$ the projection morphisms. We have to show: \n    \n      \n  \nGiven morphisms $g_ i, g\'_ i : T_ i \\to X$ over $S$ such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$, then there exists an $i\' \\geq i$ such that $g_ i \\circ f_{i\'i} = g\'_ i \\circ f_{i\'i}$. \n\n\nGiven any morphism $g : T \\to X$ over $S$ there exists an $i \\in I$ and a morphism $g_ i : T_ i \\to X$ such that $g = f_ i \\circ g_ i$. \n\n\n\n    \n      First let us prove the uniqueness part (a). Let $g_ i, g\'_ i : T_ i \\to X$ be morphisms such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$. For any $i\' \\geq i$ we set $g_{i\'} = g_ i \\circ f_{i\'i}$ and $g\'_{i\'} = g\'_ i \\circ f_{i\'i}$. We also set $g = g_ i \\circ f_ i = g\'_ i \\circ f_ i$. Consider the morphism $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$. Set \n    \n      \n  \\[  W = \\bigcup \\nolimits _{U \\subset X\\text{ affine open}, V \\subset S\\text{ affine open}, f(U) \\subset V} U \\times _ V U.  \\]\n\n    \n       This is an open in $X \\times _ S X$, with the property that the morphism $\\Delta _{X/S}$ factors through a closed immersion into $W$, see the proof of Schemes, Lemma 26.21.2. Note that the composition $(g_ i, g\'_ i) \\circ f_ i : T \\to X \\times _ S X$ is a morphism into $W$ because it factors through the diagonal by assumption. Set $Z_{i\'} = (g_{i\'}, g\'_{i\'})^{-1}(X \\times _ S X \\setminus W)$. If each $Z_{i\'}$ is nonempty, then by Lemma 32.4.8 there exists a point $t \\in T$ which maps to $Z_{i\'}$ for all $i\' \\geq i$. This is a contradiction with the fact that $T$ maps into $W$. Hence we may increase $i$ and assume that $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$ is a morphism into $W$. By construction of $W$, and since $T_ i$ is quasi-compact we can find a finite affine open covering $T_ i = T_{1, i} \\cup \\ldots \\cup T_{n, i}$ such that $(g_ i, g\'_ i)|_{T_{j, i}}$ is a morphism into $U \\times _ V U$ for some pair $(U, V)$ as in the definition of $W$ above. Since it suffices to prove that $g_{i\'}$ and $g\'_{i\'}$ agree on each of the $f_{i\'i}^{-1}(T_{j, i})$ this reduces us to the affine case. The affine case follows from Algebra, Lemma 10.127.3 and the fact that the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation (see Morphisms, Lemma 29.21.2). \n    \n      Finally, we prove the existence part (b). Let $g : T \\to X$ be a morphism of schemes over $S$. We can find a finite affine open covering $T = W_1 \\cup \\ldots \\cup W_ n$ such that for each $j \\in \\{ 1, \\ldots , n\\} $ there exist affine opens $U_ j \\subset X$ and $V_ j \\subset S$ with $f(U_ j) \\subset V_ j$ and $g(W_ j) \\subset U_ j$. By Lemmas 32.4.11 and 32.4.13 (after possibly shrinking $I$) we may assume that there exist affine open coverings $T_ i = W_{1, i} \\cup \\ldots \\cup W_{n, i}$ compatible with transition maps such that $W_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i W_{j, i}$. We apply Algebra, Lemma 10.127.3 to the rings corresponding to the affine schemes $U_ j$, $V_ j$, $W_{j, i}$ and $W_ j$ using that $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ j)$ is of finite presentation (see Morphisms, Lemma 29.21.2). Thus we can find for each $j$ an index $i_ j \\in I$ and a morphism $g_{j, i_ j} : W_{j, i_ j} \\to X$ such that $g_{j, i_ j} \\circ f_ i|_{W_ j} : W_ j \\to W_{j, i} \\to X$ equals $g|_{W_ j}$. By part (a) proved above, using the quasi-compactness of $W_{j_1, i} \\cap W_{j_2, i}$ which follows as $T_ i$ is quasi-separated, we can find an index $i\' \\in I$ larger than all $i_ j$ such that \n    \n      \n  \\[  g_{j_1, i_{j_1}} \\circ f_{i\'i_{j_1}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}} = g_{j_2, i_{j_2}} \\circ f_{i\'i_{j_2}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}}  \\]\n\n    \n       for all $j_1, j_2 \\in \\{ 1, \\ldots , n\\} $. Hence the morphisms $g_{j, i_ j} \\circ f_{i\'i_ j}|_{W_{j, i\'}}$ glue to given the desired morphism $T_{i\'} \\to X$. \n      $\\square$\n    \n","\n       \n      \n  Proposition 32.6.1. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor any directed set $I$, and any inverse system $(T_ i, f_{ii\'})$ of $S$-schemes over $I$ with each $T_ i$ affine, we have \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X)  \\]\n\n\nFor any directed set $I$, and any inverse system $(T_ i, f_{ii\'})$ of $S$-schemes over $I$ with each $f_{ii\'}$ affine and every $T_ i$ quasi-compact and quasi-separated as a scheme, we have \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X)  \\]\n\n\n\n\n    \n","Proof.\n      It is clear that (3) implies (2). \n    \n      Let us prove that (2) implies (1). Assume (2). Choose any affine opens $U \\subset X$ and $V \\subset S$ such that $f(U) \\subset V$. We have to show that $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. Let $(A_ i, \\varphi _{ii\'})$ be a directed system of $\\mathcal{O}_ S(V)$-algebras. Set $A = \\mathop{\\mathrm{colim}}\\nolimits _ i A_ i$. According to Algebra, Lemma 10.127.3 we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A_ i)  \\]\n\n    \n       Consider the schemes $T_ i = \\mathop{\\mathrm{Spec}}(A_ i)$. They form an inverse system of $V$-schemes over $I$ with transition morphisms $f_{ii\'} : T_ i \\to T_{i\'}$ induced by the $\\mathcal{O}_ S(V)$-algebra maps $\\varphi _{i\'i}$. Set $T := \\mathop{\\mathrm{Spec}}(A) = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. The formula above becomes in terms of morphism sets of schemes \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ V(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U).  \\]\n\n    \n       We first observe that $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)$ and $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T, U)$. Hence we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)  \\]\n\n    \n       and we are given that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X).  \\]\n\n    \n       Hence it suffices to prove that given a morphism $g_ i : T_ i \\to X$ over $S$ such that the composition $T \\to T_ i \\to X$ ends up in $U$ there exists some $i\' \\geq i$ such that the composition $g_{i\'} : T_{i\'} \\to T_ i \\to X$ ends up in $U$. Denote $Z_{i\'} = g_{i\'}^{-1}(X \\setminus U)$. Assume each $Z_{i\'}$ is nonempty to get a contradiction. By Lemma 32.4.8 there exists a point $t$ of $T$ which is mapped into $Z_{i\'}$ for all $i\' \\geq i$. Such a point is not mapped into $U$. A contradiction. \n    \n      Finally, let us prove that (1) implies (3). Assume (1). Let an inverse directed system $(T_ i, f_{ii\'})$ of $S$-schemes be given. Assume the morphisms $f_{ii\'}$ are affine and each $T_ i$ is quasi-compact and quasi-separated as a scheme. Let $T = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. Denote $f_ i : T \\to T_ i$ the projection morphisms. We have to show: \n    \n      \n  \nGiven morphisms $g_ i, g\'_ i : T_ i \\to X$ over $S$ such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$, then there exists an $i\' \\geq i$ such that $g_ i \\circ f_{i\'i} = g\'_ i \\circ f_{i\'i}$. \n\n\nGiven any morphism $g : T \\to X$ over $S$ there exists an $i \\in I$ and a morphism $g_ i : T_ i \\to X$ such that $g = f_ i \\circ g_ i$. \n\n\n\n    \n      First let us prove the uniqueness part (a). Let $g_ i, g\'_ i : T_ i \\to X$ be morphisms such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$. For any $i\' \\geq i$ we set $g_{i\'} = g_ i \\circ f_{i\'i}$ and $g\'_{i\'} = g\'_ i \\circ f_{i\'i}$. We also set $g = g_ i \\circ f_ i = g\'_ i \\circ f_ i$. Consider the morphism $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$. Set \n    \n      \n  \\[  W = \\bigcup \\nolimits _{U \\subset X\\text{ affine open}, V \\subset S\\text{ affine open}, f(U) \\subset V} U \\times _ V U.  \\]\n\n    \n       This is an open in $X \\times _ S X$, with the property that the morphism $\\Delta _{X/S}$ factors through a closed immersion into $W$, see the proof of Schemes, Lemma 26.21.2. Note that the composition $(g_ i, g\'_ i) \\circ f_ i : T \\to X \\times _ S X$ is a morphism into $W$ because it factors through the diagonal by assumption. Set $Z_{i\'} = (g_{i\'}, g\'_{i\'})^{-1}(X \\times _ S X \\setminus W)$. If each $Z_{i\'}$ is nonempty, then by Lemma 32.4.8 there exists a point $t \\in T$ which maps to $Z_{i\'}$ for all $i\' \\geq i$. This is a contradiction with the fact that $T$ maps into $W$. Hence we may increase $i$ and assume that $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$ is a morphism into $W$. By construction of $W$, and since $T_ i$ is quasi-compact we can find a finite affine open covering $T_ i = T_{1, i} \\cup \\ldots \\cup T_{n, i}$ such that $(g_ i, g\'_ i)|_{T_{j, i}}$ is a morphism into $U \\times _ V U$ for some pair $(U, V)$ as in the definition of $W$ above. Since it suffices to prove that $g_{i\'}$ and $g\'_{i\'}$ agree on each of the $f_{i\'i}^{-1}(T_{j, i})$ this reduces us to the affine case. The affine case follows from Algebra, Lemma 10.127.3 and the fact that the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation (see Morphisms, Lemma 29.21.2). \n    \n      Finally, we prove the existence part (b). Let $g : T \\to X$ be a morphism of schemes over $S$. We can find a finite affine open covering $T = W_1 \\cup \\ldots \\cup W_ n$ such that for each $j \\in \\{ 1, \\ldots , n\\} $ there exist affine opens $U_ j \\subset X$ and $V_ j \\subset S$ with $f(U_ j) \\subset V_ j$ and $g(W_ j) \\subset U_ j$. By Lemmas 32.4.11 and 32.4.13 (after possibly shrinking $I$) we may assume that there exist affine open coverings $T_ i = W_{1, i} \\cup \\ldots \\cup W_{n, i}$ compatible with transition maps such that $W_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i W_{j, i}$. We apply Algebra, Lemma 10.127.3 to the rings corresponding to the affine schemes $U_ j$, $V_ j$, $W_{j, i}$ and $W_ j$ using that $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ j)$ is of finite presentation (see Morphisms, Lemma 29.21.2). Thus we can find for each $j$ an index $i_ j \\in I$ and a morphism $g_{j, i_ j} : W_{j, i_ j} \\to X$ such that $g_{j, i_ j} \\circ f_ i|_{W_ j} : W_ j \\to W_{j, i} \\to X$ equals $g|_{W_ j}$. By part (a) proved above, using the quasi-compactness of $W_{j_1, i} \\cap W_{j_2, i}$ which follows as $T_ i$ is quasi-separated, we can find an index $i\' \\in I$ larger than all $i_ j$ such that \n    \n      \n  \\[  g_{j_1, i_{j_1}} \\circ f_{i\'i_{j_1}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}} = g_{j_2, i_{j_2}} \\circ f_{i\'i_{j_2}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}}  \\]\n\n    \n       for all $j_1, j_2 \\in \\{ 1, \\ldots , n\\} $. Hence the morphisms $g_{j, i_ j} \\circ f_{i\'i_ j}|_{W_{j, i\'}}$ glue to given the desired morphism $T_{i\'} \\to X$. \n      $\\square$\n    \n"," by
  let o := IsCofiltered.min i j
  obtain ‚ü®k, hik, heq‚ü© := Scheme.exists_hom_comp_eq_comp_of_locallyOfFiniteType D t f c hc
    (D.map (IsCofiltered.minToLeft i j) ‚â´ a) (D.map (IsCofiltered.minToRight i j) ‚â´ b)
    (by simp [‚Üê ha])
    (by simp [‚Üê hb]) (by simpa)
  use k, hik ‚â´ IsCofiltered.minToLeft i j, hik ‚â´ IsCofiltered.minToRight i j
  simpa using heq
","lemma Scheme.exists_hom_hom_comp_eq_comp_of_locallyOfFiniteType
    {i : I} (a : D.obj i ‚ü∂ X) (ha : t.app i = a ‚â´ f)
    {j : I} (b : D.obj j ‚ü∂ X) (hb : t.app j = b ‚â´ f)
    (hab : c.œÄ.app i ‚â´ a = c.œÄ.app j ‚â´ b) :
    ‚àÉ (k : I) (hik : k ‚ü∂ i) (hjk : k ‚ü∂ j),
      D.map hik ‚â´ a = D.map hjk ‚â´ b ","Proof.\n      It is clear that (3) implies (2). \n    \n      Let us prove that (2) implies (1). Assume (2). Choose any affine opens $U \\subset X$ and $V \\subset S$ such that $f(U) \\subset V$. We have to show that $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. Let $(A_ i, \\varphi _{ii\'})$ be a directed system of $\\mathcal{O}_ S(V)$-algebras. Set $A = \\mathop{\\mathrm{colim}}\\nolimits _ i A_ i$. According to Algebra, Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A_ i)  \\]\n\n    \n       Consider the schemes $T_ i = \\mathop{\\mathrm{Spec}}(A_ i)$. They form an inverse system of $V$-schemes over $I$ with transition morphisms $f_{ii\'} : T_ i \\to T_{i\'}$ induced by the $\\mathcal{O}_ S(V)$-algebra maps $\\varphi _{i\'i}$. Set $T := \\mathop{\\mathrm{Spec}}(A) = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. The formula above becomes in terms of morphism sets of schemes \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ V(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U).  \\]\n\n    \n       We first observe that $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)$ and $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T, U)$. Hence we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)  \\]\n\n    \n       and we are given that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X).  \\]\n\n    \n       Hence it suffices to prove that given a morphism $g_ i : T_ i \\to X$ over $S$ such that the composition $T \\to T_ i \\to X$ ends up in $U$ there exists some $i\' \\geq i$ such that the composition $g_{i\'} : T_{i\'} \\to T_ i \\to X$ ends up in $U$. Denote $Z_{i\'} = g_{i\'}^{-1}(X \\setminus U)$. Assume each $Z_{i\'}$ is nonempty to get a contradiction. By Lemma 32.4.8 [[\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n]] there exists a point $t$ of $T$ which is mapped into $Z_{i\'}$ for all $i\' \\geq i$. Such a point is not mapped into $U$. A contradiction. \n    \n      Finally, let us prove that (1) implies (3). Assume (1). Let an inverse directed system $(T_ i, f_{ii\'})$ of $S$-schemes be given. Assume the morphisms $f_{ii\'}$ are affine and each $T_ i$ is quasi-compact and quasi-separated as a scheme. Let $T = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. Denote $f_ i : T \\to T_ i$ the projection morphisms. We have to show: \n    \n      \n  \nGiven morphisms $g_ i, g\'_ i : T_ i \\to X$ over $S$ such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$, then there exists an $i\' \\geq i$ such that $g_ i \\circ f_{i\'i} = g\'_ i \\circ f_{i\'i}$. \n\n\nGiven any morphism $g : T \\to X$ over $S$ there exists an $i \\in I$ and a morphism $g_ i : T_ i \\to X$ such that $g = f_ i \\circ g_ i$. \n\n\n\n    \n      First let us prove the uniqueness part (a). Let $g_ i, g\'_ i : T_ i \\to X$ be morphisms such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$. For any $i\' \\geq i$ we set $g_{i\'} = g_ i \\circ f_{i\'i}$ and $g\'_{i\'} = g\'_ i \\circ f_{i\'i}$. We also set $g = g_ i \\circ f_ i = g\'_ i \\circ f_ i$. Consider the morphism $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$. Set \n    \n      \n  \\[  W = \\bigcup \\nolimits _{U \\subset X\\text{ affine open}, V \\subset S\\text{ affine open}, f(U) \\subset V} U \\times _ V U.  \\]\n\n    \n       This is an open in $X \\times _ S X$, with the property that the morphism $\\Delta _{X/S}$ factors through a closed immersion into $W$, see the proof of Schemes, Lemma 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]]. Note that the composition $(g_ i, g\'_ i) \\circ f_ i : T \\to X \\times _ S X$ is a morphism into $W$ because it factors through the diagonal by assumption. Set $Z_{i\'} = (g_{i\'}, g\'_{i\'})^{-1}(X \\times _ S X \\setminus W)$. If each $Z_{i\'}$ is nonempty, then by Lemma 32.4.8 [[\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n]] there exists a point $t \\in T$ which maps to $Z_{i\'}$ for all $i\' \\geq i$. This is a contradiction with the fact that $T$ maps into $W$. Hence we may increase $i$ and assume that $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$ is a morphism into $W$. By construction of $W$, and since $T_ i$ is quasi-compact we can find a finite affine open covering $T_ i = T_{1, i} \\cup \\ldots \\cup T_{n, i}$ such that $(g_ i, g\'_ i)|_{T_{j, i}}$ is a morphism into $U \\times _ V U$ for some pair $(U, V)$ as in the definition of $W$ above. Since it suffices to prove that $g_{i\'}$ and $g\'_{i\'}$ agree on each of the $f_{i\'i}^{-1}(T_{j, i})$ this reduces us to the affine case. The affine case follows from Algebra, Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] and the fact that the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation (see Morphisms, Lemma 29.21.2 [[\n  Lemma 29.21.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite presentation. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite presentation, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite presentation then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite presentation. \n\n    \n]]). \n    \n      Finally, we prove the existence part (b). Let $g : T \\to X$ be a morphism of schemes over $S$. We can find a finite affine open covering $T = W_1 \\cup \\ldots \\cup W_ n$ such that for each $j \\in \\{ 1, \\ldots , n\\} $ there exist affine opens $U_ j \\subset X$ and $V_ j \\subset S$ with $f(U_ j) \\subset V_ j$ and $g(W_ j) \\subset U_ j$. By Lemmas 32.4.11 [[\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n]] and 32.4.13 [[\n  Lemma 32.4.13. In Situation 32.4.5 if $S$ is affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are affine. \n\n    \n]] (after possibly shrinking $I$) we may assume that there exist affine open coverings $T_ i = W_{1, i} \\cup \\ldots \\cup W_{n, i}$ compatible with transition maps such that $W_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i W_{j, i}$. We apply Algebra, Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] to the rings corresponding to the affine schemes $U_ j$, $V_ j$, $W_{j, i}$ and $W_ j$ using that $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ j)$ is of finite presentation (see Morphisms, Lemma 29.21.2 [[\n  Lemma 29.21.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite presentation. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite presentation, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite presentation then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite presentation. \n\n    \n]]). Thus we can find for each $j$ an index $i_ j \\in I$ and a morphism $g_{j, i_ j} : W_{j, i_ j} \\to X$ such that $g_{j, i_ j} \\circ f_ i|_{W_ j} : W_ j \\to W_{j, i} \\to X$ equals $g|_{W_ j}$. By part (a) proved above, using the quasi-compactness of $W_{j_1, i} \\cap W_{j_2, i}$ which follows as $T_ i$ is quasi-separated, we can find an index $i\' \\in I$ larger than all $i_ j$ such that \n    \n      \n  \\[  g_{j_1, i_{j_1}} \\circ f_{i\'i_{j_1}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}} = g_{j_2, i_{j_2}} \\circ f_{i\'i_{j_2}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}}  \\]\n\n    \n       for all $j_1, j_2 \\in \\{ 1, \\ldots , n\\} $. Hence the morphisms $g_{j, i_ j} \\circ f_{i\'i_ j}|_{W_{j, i\'}}$ glue to given the desired morphism $T_{i\'} \\to X$. \n      $\\square$\n    \n","Proof.\n      It is clear that (3) implies (2). \n    \n      Let us prove that (2) implies (1). Assume (2). Choose any affine opens $U \\subset X$ and $V \\subset S$ such that $f(U) \\subset V$. We have to show that $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. Let $(A_ i, \\varphi _{ii\'})$ be a directed system of $\\mathcal{O}_ S(V)$-algebras. Set $A = \\mathop{\\mathrm{colim}}\\nolimits _ i A_ i$. According to Algebra, Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Hom}}\\nolimits _{\\mathcal{O}_ S(V)}(\\mathcal{O}_ X(U), A_ i)  \\]\n\n    \n       Consider the schemes $T_ i = \\mathop{\\mathrm{Spec}}(A_ i)$. They form an inverse system of $V$-schemes over $I$ with transition morphisms $f_{ii\'} : T_ i \\to T_{i\'}$ induced by the $\\mathcal{O}_ S(V)$-algebra maps $\\varphi _{i\'i}$. Set $T := \\mathop{\\mathrm{Spec}}(A) = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. The formula above becomes in terms of morphism sets of schemes \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ V(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U).  \\]\n\n    \n       We first observe that $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T_ i, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)$ and $\\mathop{\\mathrm{Mor}}\\nolimits _ V(T, U) = \\mathop{\\mathrm{Mor}}\\nolimits _ S(T, U)$. Hence we have to show that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, U) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, U)  \\]\n\n    \n       and we are given that \n    \n      \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _ S(\\mathop{\\mathrm{lim}}\\nolimits _ i T_ i, X) = \\mathop{\\mathrm{colim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _ S(T_ i, X).  \\]\n\n    \n       Hence it suffices to prove that given a morphism $g_ i : T_ i \\to X$ over $S$ such that the composition $T \\to T_ i \\to X$ ends up in $U$ there exists some $i\' \\geq i$ such that the composition $g_{i\'} : T_{i\'} \\to T_ i \\to X$ ends up in $U$. Denote $Z_{i\'} = g_{i\'}^{-1}(X \\setminus U)$. Assume each $Z_{i\'}$ is nonempty to get a contradiction. By Lemma 32.4.8 [[\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n]] there exists a point $t$ of $T$ which is mapped into $Z_{i\'}$ for all $i\' \\geq i$. Such a point is not mapped into $U$. A contradiction. \n    \n      Finally, let us prove that (1) implies (3). Assume (1). Let an inverse directed system $(T_ i, f_{ii\'})$ of $S$-schemes be given. Assume the morphisms $f_{ii\'}$ are affine and each $T_ i$ is quasi-compact and quasi-separated as a scheme. Let $T = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. Denote $f_ i : T \\to T_ i$ the projection morphisms. We have to show: \n    \n      \n  \nGiven morphisms $g_ i, g\'_ i : T_ i \\to X$ over $S$ such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$, then there exists an $i\' \\geq i$ such that $g_ i \\circ f_{i\'i} = g\'_ i \\circ f_{i\'i}$. \n\n\nGiven any morphism $g : T \\to X$ over $S$ there exists an $i \\in I$ and a morphism $g_ i : T_ i \\to X$ such that $g = f_ i \\circ g_ i$. \n\n\n\n    \n      First let us prove the uniqueness part (a). Let $g_ i, g\'_ i : T_ i \\to X$ be morphisms such that $g_ i \\circ f_ i = g\'_ i \\circ f_ i$. For any $i\' \\geq i$ we set $g_{i\'} = g_ i \\circ f_{i\'i}$ and $g\'_{i\'} = g\'_ i \\circ f_{i\'i}$. We also set $g = g_ i \\circ f_ i = g\'_ i \\circ f_ i$. Consider the morphism $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$. Set \n    \n      \n  \\[  W = \\bigcup \\nolimits _{U \\subset X\\text{ affine open}, V \\subset S\\text{ affine open}, f(U) \\subset V} U \\times _ V U.  \\]\n\n    \n       This is an open in $X \\times _ S X$, with the property that the morphism $\\Delta _{X/S}$ factors through a closed immersion into $W$, see the proof of Schemes, Lemma 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]]. Note that the composition $(g_ i, g\'_ i) \\circ f_ i : T \\to X \\times _ S X$ is a morphism into $W$ because it factors through the diagonal by assumption. Set $Z_{i\'} = (g_{i\'}, g\'_{i\'})^{-1}(X \\times _ S X \\setminus W)$. If each $Z_{i\'}$ is nonempty, then by Lemma 32.4.8 [[\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n]] there exists a point $t \\in T$ which maps to $Z_{i\'}$ for all $i\' \\geq i$. This is a contradiction with the fact that $T$ maps into $W$. Hence we may increase $i$ and assume that $(g_ i, g\'_ i) : T_ i \\to X \\times _ S X$ is a morphism into $W$. By construction of $W$, and since $T_ i$ is quasi-compact we can find a finite affine open covering $T_ i = T_{1, i} \\cup \\ldots \\cup T_{n, i}$ such that $(g_ i, g\'_ i)|_{T_{j, i}}$ is a morphism into $U \\times _ V U$ for some pair $(U, V)$ as in the definition of $W$ above. Since it suffices to prove that $g_{i\'}$ and $g\'_{i\'}$ agree on each of the $f_{i\'i}^{-1}(T_{j, i})$ this reduces us to the affine case. The affine case follows from Algebra, Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] and the fact that the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation (see Morphisms, Lemma 29.21.2 [[\n  Lemma 29.21.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite presentation. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite presentation, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite presentation then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite presentation. \n\n    \n]]). \n    \n      Finally, we prove the existence part (b). Let $g : T \\to X$ be a morphism of schemes over $S$. We can find a finite affine open covering $T = W_1 \\cup \\ldots \\cup W_ n$ such that for each $j \\in \\{ 1, \\ldots , n\\} $ there exist affine opens $U_ j \\subset X$ and $V_ j \\subset S$ with $f(U_ j) \\subset V_ j$ and $g(W_ j) \\subset U_ j$. By Lemmas 32.4.11 [[\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n]] and 32.4.13 [[\n  Lemma 32.4.13. In Situation 32.4.5 if $S$ is affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are affine. \n\n    \n]] (after possibly shrinking $I$) we may assume that there exist affine open coverings $T_ i = W_{1, i} \\cup \\ldots \\cup W_{n, i}$ compatible with transition maps such that $W_ j = \\mathop{\\mathrm{lim}}\\nolimits _ i W_{j, i}$. We apply Algebra, Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] to the rings corresponding to the affine schemes $U_ j$, $V_ j$, $W_{j, i}$ and $W_ j$ using that $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ j)$ is of finite presentation (see Morphisms, Lemma 29.21.2 [[\n  Lemma 29.21.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite presentation. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite presentation, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite presentation then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite presentation. \n\n    \n]]). Thus we can find for each $j$ an index $i_ j \\in I$ and a morphism $g_{j, i_ j} : W_{j, i_ j} \\to X$ such that $g_{j, i_ j} \\circ f_ i|_{W_ j} : W_ j \\to W_{j, i} \\to X$ equals $g|_{W_ j}$. By part (a) proved above, using the quasi-compactness of $W_{j_1, i} \\cap W_{j_2, i}$ which follows as $T_ i$ is quasi-separated, we can find an index $i\' \\in I$ larger than all $i_ j$ such that \n    \n      \n  \\[  g_{j_1, i_{j_1}} \\circ f_{i\'i_{j_1}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}} = g_{j_2, i_{j_2}} \\circ f_{i\'i_{j_2}}|_{W_{j_1, i\'} \\cap W_{j_2, i\'}}  \\]\n\n    \n       for all $j_1, j_2 \\in \\{ 1, \\ldots , n\\} $. Hence the morphisms $g_{j, i_ j} \\circ f_{i\'i_ j}|_{W_{j, i\'}}$ glue to given the desired morphism $T_{i\'} \\to X$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Injective part of (1) => (3)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is proving an ‚Äúinjectivity/uniqueness‚Äù lifting property typical of the injective part of (1) ‚áí (3): given two morphisms (here encoded as arrows `a` and `b`) that become equal after composing with the limit cone map `c` (hypothesis `hc`), it produces a later stage `k` and transition maps from `k` to the two indices `i,j` such that the pulled-back morphisms become equal (conclusion `heq`). This matches the informal uniqueness argument: equality after pullback to the limit implies equality after passing to some sufficiently large index.\nStructurally, the Lean code is a very compressed categorical version: it uses cofilteredness via `IsCofiltered.min i j` to compare two indices, then applies a packaged lemma `Scheme.exists_hom_comp_eq_comp_of_locallyOfFiniteType` to obtain the required stage `k` and equality, and finally composes with the canonical maps `minToLeft/minToRight`. The informal proof instead proceeds by constructing opens, defining closed subsets, and using a point-existence lemma to derive a contradiction, then reducing to affines. Those geometric steps are not mirrored explicitly in Lean; they are presumably encapsulated inside the lemma `exists_hom_comp_eq_comp_of_locallyOfFiniteType`.\nCompleteness/precision: for the stated scope (‚ÄúInjective part of (1) => (3)‚Äù), the Lean proof contains exactly the needed existence of a later index and equality, with no obvious extraneous content. The main mismatch is that the informal proof is for locally of finite presentation and uses substantial intermediate arguments, while the Lean proof appeals directly to a lemma about locally of finite type and cofiltered minima, so the correspondence relies on library lemmas rather than matching the informal derivation step-by-step.""}"
11,01Z5,"lemma Scheme.exists_isQuasiAffine_of_isLimit [IsCofiltered I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    [‚àÄ (i : I), CompactSpace (D.obj i)]
    [‚àÄ (i : I), QuasiSeparatedSpace (D.obj i)]
    [IsQuasiAffine c.pt] :
    ‚àÉ i, IsQuasiAffine (D.obj i) := by
  classical
  have (x : c.pt) : ‚àÉ (i : I) (f : Œì(D.obj i, ‚ä§)),
      IsAffineOpen (Scheme.basicOpen _ f) ‚àß c.œÄ.app i x ‚àà (Scheme.basicOpen _ f) := by
    obtain ‚ü®i‚ü© := IsCofiltered.nonempty (C := I)
    obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hxU, -‚ü© := (D.obj i).isBasis_affineOpens.exists_subset_of_mem_open
      (Set.mem_univ (c.œÄ.app i x)) isOpen_univ
    obtain ‚ü®_, ‚ü®_, ‚ü®r, hr, rfl‚ü©, rfl‚ü©, hxr, hrU‚ü© :=
      (IsQuasiAffine.isBasis_basicOpen c.pt).exists_subset_of_mem_open hxU (c.œÄ.app i ‚Åª¬π·µÅ U).isOpen
    obtain ‚ü®j, r, rfl‚ü© := exists_appTop_œÄ_eq_of_isLimit D c hc r
    obtain ‚ü®k, fki, fkj, -‚ü© := IsCofilteredOrEmpty.cone_objs i j
    obtain ‚ü®l, flk, hl‚ü© := exists_map_preimage_le_map_preimage D c hc (isCompact_basicOpen _
      isCompact_univ ((D.map fkj).appTop r)) (V := D.map fki ‚Åª¬π·µÅ U) (by
        rwa [‚Üê preimage_basicOpen_top, ‚Üê Hom.comp_preimage, ‚Üê Hom.comp_preimage,
          c.w, c.w, preimage_basicOpen_top])
    refine ‚ü®l, (D.map (flk ‚â´ fkj)).appTop r, ?_, ?_‚ü©
    ¬∑ convert (hU.preimage (D.map (flk ‚â´ fki))).basicOpen
        ((D.obj _).presheaf.map (homOfLE le_top).op ((D.map (flk ‚â´ fkj)).appTop r)) using 1
      rwa [Scheme.basicOpen_res, eq_comm, inf_eq_right, Functor.map_comp,
        elementwise_of% Scheme.Hom.comp_appTop, ‚Üê Scheme.preimage_basicOpen_top, Functor.map_comp,
        Scheme.Hom.comp_preimage]
    ¬∑ change x ‚àà c.œÄ.app l ‚Åª¬π·µÅ (D.obj l).basicOpen _
      rwa [Scheme.preimage_basicOpen_top, ‚Üê elementwise_of% Scheme.Hom.comp_appTop, Cone.w]
  choose i f hf hi using this
  obtain ‚ü®œÉ, hœÉ‚ü© := CompactSpace.elim_nhds_subcover
    (fun x ‚Ü¶ (((c.œÄ.app (i x)) ‚Åª¬π·µÅ (D.obj (i x)).basicOpen (f x)).1))
    (fun x ‚Ü¶ ((c.œÄ.app (i x)) ‚Åª¬π·µÅ (D.obj (i x)).basicOpen (f x)).2.mem_nhds (by exact hi x))
  choose œÉi hœÉiœÉ hœÉi using fun x ‚Ü¶ Set.mem_iUnion‚ÇÇ.mp (hœÉ.ge (Set.mem_univ x))
  obtain ‚ü®j, fj‚ü© := IsCofiltered.inf_objs_exists (œÉ.image i)
  replace fj := fun i h ‚Ü¶ (@fj i h).some
  obtain ‚ü®k, fkj, hk‚ü© := exists_map_eq_top D c hc
    (‚®Ü k, D.map (fj _ (Finset.mem_image_of_mem i (hœÉiœÉ k))) ‚Åª¬π·µÅ (D.obj (i _)).basicOpen (f _)) (by
      refine top_le_iff.mp fun x _ ‚Ü¶ TopologicalSpace.Opens.mem_iSup.mpr ‚ü®x, ?_‚ü©
      change (c.œÄ.app j ‚â´ D.map _).base x ‚àà (D.obj (i (œÉi x))).basicOpen (f (œÉi x))
      rw [Cone.w]
      exact hœÉi _)
  refine ‚ü®k, .of_forall_exists_mem_basicOpen _ fun x ‚Ü¶ ?_‚ü©
  obtain ‚ü®y, hy‚ü© := TopologicalSpace.Opens.mem_iSup.mp (hk.ge (Set.mem_univ x))
  use (D.map fkj).appTop ((D.map (fj _ (Finset.mem_image_of_mem i (hœÉiœÉ y)))).appTop (f _))
  rw [‚Üê Scheme.preimage_basicOpen_top, ‚Üê Scheme.preimage_basicOpen_top]
  exact ‚ü®((hf _).preimage _).preimage _, hy‚ü©
",Formal Proof of Stacks Project Tag 01Z5,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/AffineTransitionLimit.lean#L938-L983,Q27041,,32.4.12,lemma,3.0,"['081A', '01YT', '0ELP']","\n  Lemma 32.4.12. In Situation 32.4.5 if $S$ is quasi-affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are quasi-affine. \n\n    \n      Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Let $s \\in S$. We may choose an affine open $U_0 \\subset S_0$ containing $f_0(s)$. Since $S$ is quasi-affine we may choose an element $a \\in \\Gamma (S, \\mathcal{O}_ S)$ such that $s \\in D(a) \\subset f_0^{-1}(U_0)$, and such that $D(a)$ is affine. By Lemma 32.4.7 there exists an $i \\geq 0$ such that $a$ comes from an element $a_ i \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$. For any index $j \\geq i$ we denote $a_ j$ the image of $a_ i$ in the global sections of the structure sheaf of $S_ j$. Consider the opens $D(a_ j) \\subset S_ j$ and $U_ j = f_{j0}^{-1}(U_0)$. Note that $U_ j$ is affine and $D(a_ j)$ is a quasi-compact open of $S_ j$, see Properties, Lemma 28.26.4 for example. Hence we may apply Lemma 32.4.11 to the opens $U_ j$ and $U_ j \\cup D(a_ j)$ to conclude that $D(a_ j) \\subset U_ j$ for some $j \\geq i$. For such an index $j$ we see that $D(a_ j) \\subset S_ j$ is an affine open (because $D(a_ j)$ is a standard affine open of the affine open $U_ j$) containing the image $f_ j(s)$. \n    \n      We conclude that for every $s \\in S$ there exist an index $i \\in I$, and a global section $a \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that $D(a) \\subset S_ i$ is an affine open containing $f_ i(s)$. Because $S$ is quasi-compact we may choose a single index $i \\in I$ and global sections $a_1, \\ldots , a_ m \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that each $D(a_ j) \\subset S_ i$ is affine open and such that $f_ i : S \\to S_ i$ has image contained in the union $W_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. For $i\' \\geq i$ set $W_{i\'} = f_{i\'i}^{-1}(W_ i)$. Since $f_ i^{-1}(W_ i)$ is all of $S$ we see (by Lemma 32.4.11 again) that for a suitable $i\' \\geq i$ we have $S_{i\'} = W_{i\'}$. Thus we may replace $i$ by $i\'$ and assume that $S_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. This implies that $\\mathcal{O}_{S_ i}$ is an ample invertible sheaf on $S_ i$ (see Properties, Definition 28.26.1) and hence that $S_ i$ is quasi-affine, see Properties, Lemma 28.27.1. Hence we win. \n      $\\square$\n    \n","\n  Lemma 32.4.12. In Situation 32.4.5 if $S$ is quasi-affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are quasi-affine. \n\n    \n","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Let $s \\in S$. We may choose an affine open $U_0 \\subset S_0$ containing $f_0(s)$. Since $S$ is quasi-affine we may choose an element $a \\in \\Gamma (S, \\mathcal{O}_ S)$ such that $s \\in D(a) \\subset f_0^{-1}(U_0)$, and such that $D(a)$ is affine. By Lemma 32.4.7 there exists an $i \\geq 0$ such that $a$ comes from an element $a_ i \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$. For any index $j \\geq i$ we denote $a_ j$ the image of $a_ i$ in the global sections of the structure sheaf of $S_ j$. Consider the opens $D(a_ j) \\subset S_ j$ and $U_ j = f_{j0}^{-1}(U_0)$. Note that $U_ j$ is affine and $D(a_ j)$ is a quasi-compact open of $S_ j$, see Properties, Lemma 28.26.4 for example. Hence we may apply Lemma 32.4.11 to the opens $U_ j$ and $U_ j \\cup D(a_ j)$ to conclude that $D(a_ j) \\subset U_ j$ for some $j \\geq i$. For such an index $j$ we see that $D(a_ j) \\subset S_ j$ is an affine open (because $D(a_ j)$ is a standard affine open of the affine open $U_ j$) containing the image $f_ j(s)$. \n    \n      We conclude that for every $s \\in S$ there exist an index $i \\in I$, and a global section $a \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that $D(a) \\subset S_ i$ is an affine open containing $f_ i(s)$. Because $S$ is quasi-compact we may choose a single index $i \\in I$ and global sections $a_1, \\ldots , a_ m \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that each $D(a_ j) \\subset S_ i$ is affine open and such that $f_ i : S \\to S_ i$ has image contained in the union $W_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. For $i\' \\geq i$ set $W_{i\'} = f_{i\'i}^{-1}(W_ i)$. Since $f_ i^{-1}(W_ i)$ is all of $S$ we see (by Lemma 32.4.11 again) that for a suitable $i\' \\geq i$ we have $S_{i\'} = W_{i\'}$. Thus we may replace $i$ by $i\'$ and assume that $S_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. This implies that $\\mathcal{O}_{S_ i}$ is an ample invertible sheaf on $S_ i$ (see Properties, Definition 28.26.1) and hence that $S_ i$ is quasi-affine, see Properties, Lemma 28.27.1. Hence we win. \n      $\\square$\n    \n"," by
  classical
  have (x : c.pt) : ‚àÉ (i : I) (f : Œì(D.obj i, ‚ä§)),
      IsAffineOpen (Scheme.basicOpen _ f) ‚àß c.œÄ.app i x ‚àà (Scheme.basicOpen _ f) := by
    obtain ‚ü®i‚ü© := IsCofiltered.nonempty (C := I)
    obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hxU, -‚ü© := (D.obj i).isBasis_affineOpens.exists_subset_of_mem_open
      (Set.mem_univ (c.œÄ.app i x)) isOpen_univ
    obtain ‚ü®_, ‚ü®_, ‚ü®r, hr, rfl‚ü©, rfl‚ü©, hxr, hrU‚ü© :=
      (IsQuasiAffine.isBasis_basicOpen c.pt).exists_subset_of_mem_open hxU (c.œÄ.app i ‚Åª¬π·µÅ U).isOpen
    obtain ‚ü®j, r, rfl‚ü© := exists_appTop_œÄ_eq_of_isLimit D c hc r
    obtain ‚ü®k, fki, fkj, -‚ü© := IsCofilteredOrEmpty.cone_objs i j
    obtain ‚ü®l, flk, hl‚ü© := exists_map_preimage_le_map_preimage D c hc (isCompact_basicOpen _
      isCompact_univ ((D.map fkj).appTop r)) (V := D.map fki ‚Åª¬π·µÅ U) (by
        rwa [‚Üê preimage_basicOpen_top, ‚Üê Hom.comp_preimage, ‚Üê Hom.comp_preimage,
          c.w, c.w, preimage_basicOpen_top])
    refine ‚ü®l, (D.map (flk ‚â´ fkj)).appTop r, ?_, ?_‚ü©
    ¬∑ convert (hU.preimage (D.map (flk ‚â´ fki))).basicOpen
        ((D.obj _).presheaf.map (homOfLE le_top).op ((D.map (flk ‚â´ fkj)).appTop r)) using 1
      rwa [Scheme.basicOpen_res, eq_comm, inf_eq_right, Functor.map_comp,
        elementwise_of% Scheme.Hom.comp_appTop, ‚Üê Scheme.preimage_basicOpen_top, Functor.map_comp,
        Scheme.Hom.comp_preimage]
    ¬∑ change x ‚àà c.œÄ.app l ‚Åª¬π·µÅ (D.obj l).basicOpen _
      rwa [Scheme.preimage_basicOpen_top, ‚Üê elementwise_of% Scheme.Hom.comp_appTop, Cone.w]
  choose i f hf hi using this
  obtain ‚ü®œÉ, hœÉ‚ü© := CompactSpace.elim_nhds_subcover
    (fun x ‚Ü¶ (((c.œÄ.app (i x)) ‚Åª¬π·µÅ (D.obj (i x)).basicOpen (f x)).1))
    (fun x ‚Ü¶ ((c.œÄ.app (i x)) ‚Åª¬π·µÅ (D.obj (i x)).basicOpen (f x)).2.mem_nhds (by exact hi x))
  choose œÉi hœÉiœÉ hœÉi using fun x ‚Ü¶ Set.mem_iUnion‚ÇÇ.mp (hœÉ.ge (Set.mem_univ x))
  obtain ‚ü®j, fj‚ü© := IsCofiltered.inf_objs_exists (œÉ.image i)
  replace fj := fun i h ‚Ü¶ (@fj i h).some
  obtain ‚ü®k, fkj, hk‚ü© := exists_map_eq_top D c hc
    (‚®Ü k, D.map (fj _ (Finset.mem_image_of_mem i (hœÉiœÉ k))) ‚Åª¬π·µÅ (D.obj (i _)).basicOpen (f _)) (by
      refine top_le_iff.mp fun x _ ‚Ü¶ TopologicalSpace.Opens.mem_iSup.mpr ‚ü®x, ?_‚ü©
      change (c.œÄ.app j ‚â´ D.map _).base x ‚àà (D.obj (i (œÉi x))).basicOpen (f (œÉi x))
      rw [Cone.w]
      exact hœÉi _)
  refine ‚ü®k, .of_forall_exists_mem_basicOpen _ fun x ‚Ü¶ ?_‚ü©
  obtain ‚ü®y, hy‚ü© := TopologicalSpace.Opens.mem_iSup.mp (hk.ge (Set.mem_univ x))
  use (D.map fkj).appTop ((D.map (fj _ (Finset.mem_image_of_mem i (hœÉiœÉ y)))).appTop (f _))
  rw [‚Üê Scheme.preimage_basicOpen_top, ‚Üê Scheme.preimage_basicOpen_top]
  exact ‚ü®((hf _).preimage _).preimage _, hy‚ü©
","lemma Scheme.exists_isQuasiAffine_of_isLimit [IsCofiltered I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    [‚àÄ (i : I), CompactSpace (D.obj i)]
    [‚àÄ (i : I), QuasiSeparatedSpace (D.obj i)]
    [IsQuasiAffine c.pt] :
    ‚àÉ i, IsQuasiAffine (D.obj i) ","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Let $s \\in S$. We may choose an affine open $U_0 \\subset S_0$ containing $f_0(s)$. Since $S$ is quasi-affine we may choose an element $a \\in \\Gamma (S, \\mathcal{O}_ S)$ such that $s \\in D(a) \\subset f_0^{-1}(U_0)$, and such that $D(a)$ is affine. By Lemma 32.4.7 [[\n  Lemma 32.4.7. In Situation 32.4.5. Suppose that $\\mathcal{F}_0$ is a quasi-coherent sheaf on $S_0$. Set $\\mathcal{F}_ i = f_{i0}^*\\mathcal{F}_0$ for $i \\geq 0$ and set $\\mathcal{F} = f_0^*\\mathcal{F}_0$. Then \n  \n  \\[  \\Gamma (S, \\mathcal{F}) = \\mathop{\\mathrm{colim}}\\nolimits _{i \\geq 0} \\Gamma (S_ i, \\mathcal{F}_ i)  \\]\n\n\n    \n]] there exists an $i \\geq 0$ such that $a$ comes from an element $a_ i \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$. For any index $j \\geq i$ we denote $a_ j$ the image of $a_ i$ in the global sections of the structure sheaf of $S_ j$. Consider the opens $D(a_ j) \\subset S_ j$ and $U_ j = f_{j0}^{-1}(U_0)$. Note that $U_ j$ is affine and $D(a_ j)$ is a quasi-compact open of $S_ j$, see Properties, Lemma 28.26.4 [[\n  Lemma 28.26.4. Let $X$ be a scheme. Let $\\mathcal{L}$ be an invertible $\\mathcal{O}_ X$-module. Let $s \\in \\Gamma (X, \\mathcal{L})$. For any affine $U \\subset X$ the intersection $U \\cap X_ s$ is affine. \n\n    \n]] for example. Hence we may apply Lemma 32.4.11 [[\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n]] to the opens $U_ j$ and $U_ j \\cup D(a_ j)$ to conclude that $D(a_ j) \\subset U_ j$ for some $j \\geq i$. For such an index $j$ we see that $D(a_ j) \\subset S_ j$ is an affine open (because $D(a_ j)$ is a standard affine open of the affine open $U_ j$) containing the image $f_ j(s)$. \n    \n      We conclude that for every $s \\in S$ there exist an index $i \\in I$, and a global section $a \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that $D(a) \\subset S_ i$ is an affine open containing $f_ i(s)$. Because $S$ is quasi-compact we may choose a single index $i \\in I$ and global sections $a_1, \\ldots , a_ m \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that each $D(a_ j) \\subset S_ i$ is affine open and such that $f_ i : S \\to S_ i$ has image contained in the union $W_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. For $i\' \\geq i$ set $W_{i\'} = f_{i\'i}^{-1}(W_ i)$. Since $f_ i^{-1}(W_ i)$ is all of $S$ we see (by Lemma 32.4.11 [[\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n]] again) that for a suitable $i\' \\geq i$ we have $S_{i\'} = W_{i\'}$. Thus we may replace $i$ by $i\'$ and assume that $S_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. This implies that $\\mathcal{O}_{S_ i}$ is an ample invertible sheaf on $S_ i$ (see Properties, Definition 28.26.1 [[\n       \n      \n  Definition 28.26.1. Let $X$ be a scheme. Let $\\mathcal{L}$ be an invertible $\\mathcal{O}_ X$-module. We say $\\mathcal{L}$ is ample if \n  \n  \n$X$ is quasi-compact, and \n\n\nfor every $x \\in X$ there exists an $n \\geq 1$ and $s \\in \\Gamma (X, \\mathcal{L}^{\\otimes n})$ such that $x \\in X_ s$ and $X_ s$ is affine. \n\n\n\n]]) and hence that $S_ i$ is quasi-affine, see Properties, Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]]. Hence we win. \n      $\\square$\n    \n","Proof.\n      Choose $i_0 \\in I$. Note that $I$ is nonempty as the limit is directed. For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$. Let $s \\in S$. We may choose an affine open $U_0 \\subset S_0$ containing $f_0(s)$. Since $S$ is quasi-affine we may choose an element $a \\in \\Gamma (S, \\mathcal{O}_ S)$ such that $s \\in D(a) \\subset f_0^{-1}(U_0)$, and such that $D(a)$ is affine. By Lemma 32.4.7 [[\n  Lemma 32.4.7. In Situation 32.4.5. Suppose that $\\mathcal{F}_0$ is a quasi-coherent sheaf on $S_0$. Set $\\mathcal{F}_ i = f_{i0}^*\\mathcal{F}_0$ for $i \\geq 0$ and set $\\mathcal{F} = f_0^*\\mathcal{F}_0$. Then \n  \n  \\[  \\Gamma (S, \\mathcal{F}) = \\mathop{\\mathrm{colim}}\\nolimits _{i \\geq 0} \\Gamma (S_ i, \\mathcal{F}_ i)  \\]\n\n\n    \n]] there exists an $i \\geq 0$ such that $a$ comes from an element $a_ i \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$. For any index $j \\geq i$ we denote $a_ j$ the image of $a_ i$ in the global sections of the structure sheaf of $S_ j$. Consider the opens $D(a_ j) \\subset S_ j$ and $U_ j = f_{j0}^{-1}(U_0)$. Note that $U_ j$ is affine and $D(a_ j)$ is a quasi-compact open of $S_ j$, see Properties, Lemma 28.26.4 [[\n  Lemma 28.26.4. Let $X$ be a scheme. Let $\\mathcal{L}$ be an invertible $\\mathcal{O}_ X$-module. Let $s \\in \\Gamma (X, \\mathcal{L})$. For any affine $U \\subset X$ the intersection $U \\cap X_ s$ is affine. \n\n    \n]] for example. Hence we may apply Lemma 32.4.11 [[\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n]] to the opens $U_ j$ and $U_ j \\cup D(a_ j)$ to conclude that $D(a_ j) \\subset U_ j$ for some $j \\geq i$. For such an index $j$ we see that $D(a_ j) \\subset S_ j$ is an affine open (because $D(a_ j)$ is a standard affine open of the affine open $U_ j$) containing the image $f_ j(s)$. \n    \n      We conclude that for every $s \\in S$ there exist an index $i \\in I$, and a global section $a \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that $D(a) \\subset S_ i$ is an affine open containing $f_ i(s)$. Because $S$ is quasi-compact we may choose a single index $i \\in I$ and global sections $a_1, \\ldots , a_ m \\in \\Gamma (S_ i, \\mathcal{O}_{S_ i})$ such that each $D(a_ j) \\subset S_ i$ is affine open and such that $f_ i : S \\to S_ i$ has image contained in the union $W_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. For $i\' \\geq i$ set $W_{i\'} = f_{i\'i}^{-1}(W_ i)$. Since $f_ i^{-1}(W_ i)$ is all of $S$ we see (by Lemma 32.4.11 [[\n  Lemma 32.4.11. In Situation 32.4.5 we have the following: \n  \n  \nGiven any quasi-compact open $V \\subset S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$ there exists an $i \\in I$ and a quasi-compact open $V_ i \\subset S_ i$ such that $f_ i^{-1}(V_ i) = V$. \n\n\nGiven $V_ i \\subset S_ i$ and $V_{i\'} \\subset S_{i\'}$ quasi-compact opens such that $f_ i^{-1}(V_ i) = f_{i\'}^{-1}(V_{i\'})$ there exists an index $i\'\' \\geq i, i\'$ such that $f_{i\'\'i}^{-1}(V_ i) = f_{i\'\'i\'}^{-1}(V_{i\'})$. \n\n\nIf $V_{1, i}, \\ldots , V_{n, i} \\subset S_ i$ are quasi-compact opens and $S = f_ i^{-1}(V_{1, i}) \\cup \\ldots \\cup f_ i^{-1}(V_{n, i})$ then $S_{i\'} = f_{i\'i}^{-1}(V_{1, i}) \\cup \\ldots \\cup f_{i\'i}^{-1}(V_{n, i})$ for some $i\' \\geq i$. \n\n\n\n\n    \n]] again) that for a suitable $i\' \\geq i$ we have $S_{i\'} = W_{i\'}$. Thus we may replace $i$ by $i\'$ and assume that $S_ i = \\bigcup _{j = 1, \\ldots , m} D(a_ j)$. This implies that $\\mathcal{O}_{S_ i}$ is an ample invertible sheaf on $S_ i$ (see Properties, Definition 28.26.1 [[\n       \n      \n  Definition 28.26.1. Let $X$ be a scheme. Let $\\mathcal{L}$ be an invertible $\\mathcal{O}_ X$-module. We say $\\mathcal{L}$ is ample if \n  \n  \n$X$ is quasi-compact, and \n\n\nfor every $x \\in X$ there exists an $n \\geq 1$ and $s \\in \\Gamma (X, \\mathcal{L}^{\\otimes n})$ such that $x \\in X_ s$ and $X_ s$ is affine. \n\n\n\n]]) and hence that $S_ i$ is quasi-affine, see Properties, Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]]. Hence we win. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish the same key intermediate claim: for every point x of the limit/quasi-affine scheme S (c.pt), there exists an index i and a global section f on S_i such that the basic open D(f) is affine and contains the image of x in S_i. The Lean proof constructs this using the affine-open basis on S_i, the basic-open basis on the quasi-affine limit, and then uses cofilteredness plus limit-compatibility lemmas to descend/compare basic opens across indices; this corresponds to the informal steps using existence of affine opens around f_0(s), choosing a basic open D(a) inside the preimage, and then moving to a larger index where the inclusion holds.\n\nStructurally, the Lean proof mirrors the informal argument‚Äôs two phases: (1) a pointwise construction of an affine basic open neighborhood at some stage (the long `have (x) : ‚àÉ i f, IsAffineOpen ... ‚àß ...` block), and (2) a quasi-compactness argument to pass from pointwise data to finitely many opens and then a single index (Lean uses `CompactSpace.elim_nhds_subcover`, chooses a finite subcover, then `IsCofiltered.inf_objs_exists` to get a common upper index k). This matches the informal ‚Äúsince S is quasi-compact choose finitely many D(a_j) and then replace by a larger index so they cover‚Äù.\n\nMain mismatch: the informal proof explicitly uses a colimit-of-global-sections lemma (Lemma 32.4.7) to ensure the chosen section on S comes from some S_i, and then applies a specific lemma about quasi-compact opens in limits (Lemma 32.4.11) to force D(a_j) ‚äÇ U_j at some stage. The Lean proof instead uses specialized limit lemmas (`exists_appTop_œÄ_eq_of_isLimit`, `exists_map_preimage_le_map_preimage`, `exists_map_eq_top`) and works directly with `appTop` sections and preimages; it does not reflect the explicit colimit argument or the final ‚ÄúO_{S_i} ample hence S_i quasi-affine‚Äù conclusion. So the core neighborhood/finite-subcover mechanism aligns well, but the later ample/quasi-affine wrap-up from the informal proof is not present in the provided Lean snippet.""}"
12,01Z6,"lemma Scheme.exists_isAffine_of_isLimit [IsCofiltered I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    [‚àÄ (i : I), CompactSpace (D.obj i)]
    [‚àÄ (i : I), QuasiSeparatedSpace (D.obj i)]
    [IsAffine c.pt] :
    ‚àÉ i, IsAffine (D.obj i) := by
  have := isAffineHom_œÄ_app _ _ hc
  obtain ‚ü®i, hi‚ü© := Scheme.exists_isQuasiAffine_of_isLimit D c hc
  have : ‚àÄ {i j : I} (f : i ‚ü∂ j), IsAffineHom ((D ‚ãô Œì.rightOp ‚ãô Scheme.Spec).map f) := by
    dsimp; infer_instance
  have (j : _) : CompactSpace ((D ‚ãô Œì.rightOp ‚ãô Scheme.Spec).obj j) := by dsimp; infer_instance
  obtain ‚ü®j, fij, hj‚ü© := exists_map_eq_top _ _
    (isLimitOfPreserves (Scheme.Œì.rightOp ‚ãô Scheme.Spec) hc) (D.obj i).toSpecŒì.opensRange
    ((preimage_opensRange_toSpecŒì (X := c.pt) (c.œÄ.app i)).trans
      (by simp [Hom.opensRange_of_isIso]))
  have := IsQuasiAffine.of_isAffineHom (D.map fij)
  exact ‚ü®j, ‚ü®isIso_of_isOpenImmersion_of_opensRange_eq_top _
    ((preimage_opensRange_toSpecŒì (D.map fij)).symm.trans hj)‚ü©‚ü©
",Formal Proof of Stacks Project Tag 01Z6,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/AffineTransitionLimit.lean#L989-L1006,Q27041,,32.4.13,lemma,3.0,"['081A', '01YT', '0ELP']","\n  Lemma 32.4.13. In Situation 32.4.5 if $S$ is affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are affine. \n\n    \n      Proof.\n      By Lemma 32.4.12 we may assume that $S_0$ is quasi-affine for some $0 \\in I$. Set $R_0 = \\Gamma (S_0, \\mathcal{O}_{S_0})$. Then $S_0$ is a quasi-compact open of $T_0 = \\mathop{\\mathrm{Spec}}(R_0)$. Denote $j_0 : S_0 \\to T_0$ the corresponding quasi-compact open immersion. For $i \\geq 0$ set $\\mathcal{A}_ i = f_{i0, *}\\mathcal{O}_{S_ i}$. Since $f_{i0}$ is affine we see that $S_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{S_0}(\\mathcal{A}_ i)$. Set $T_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{T_0}(j_{0, *}\\mathcal{A}_ i)$. Then $T_ i \\to T_0$ is affine, hence $T_ i$ is affine. Thus $T_ i$ is the spectrum of \n    \n      \n  \\[  R_ i = \\Gamma (T_0, j_{0, *}\\mathcal{A}_ i) = \\Gamma (S_0, \\mathcal{A}_ i) = \\Gamma (S_ i, \\mathcal{O}_{S_ i}).  \\]\n\n    \n       Write $S = \\mathop{\\mathrm{Spec}}(R)$. We have $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ by Lemma 32.4.7. Hence also $S = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. As formation of the relative spectrum commutes with base change, the inverse image of the open $S_0 \\subset T_0$ in $T_ i$ is $S_ i$. Let $Z_0 = T_0 \\setminus S_0$ and let $Z_ i \\subset T_ i$ be the inverse image of $Z_0$. As $S_ i = T_ i \\setminus Z_ i$, it suffices to show that $Z_ i$ is empty for some $i$. Assume $Z_ i$ is nonempty for all $i$ to get a contradiction. By Lemma 32.4.8 there exists a point $s$ of $S = \\mathop{\\mathrm{lim}}\\nolimits T_ i$ which maps to a point of $Z_ i$ for every $i$. But $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$, and hence we arrive at a contradiction by Lemma 32.4.6. \n      $\\square$\n    \n","\n  Lemma 32.4.13. In Situation 32.4.5 if $S$ is affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are affine. \n\n    \n","Proof.\n      By Lemma 32.4.12 we may assume that $S_0$ is quasi-affine for some $0 \\in I$. Set $R_0 = \\Gamma (S_0, \\mathcal{O}_{S_0})$. Then $S_0$ is a quasi-compact open of $T_0 = \\mathop{\\mathrm{Spec}}(R_0)$. Denote $j_0 : S_0 \\to T_0$ the corresponding quasi-compact open immersion. For $i \\geq 0$ set $\\mathcal{A}_ i = f_{i0, *}\\mathcal{O}_{S_ i}$. Since $f_{i0}$ is affine we see that $S_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{S_0}(\\mathcal{A}_ i)$. Set $T_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{T_0}(j_{0, *}\\mathcal{A}_ i)$. Then $T_ i \\to T_0$ is affine, hence $T_ i$ is affine. Thus $T_ i$ is the spectrum of \n    \n      \n  \\[  R_ i = \\Gamma (T_0, j_{0, *}\\mathcal{A}_ i) = \\Gamma (S_0, \\mathcal{A}_ i) = \\Gamma (S_ i, \\mathcal{O}_{S_ i}).  \\]\n\n    \n       Write $S = \\mathop{\\mathrm{Spec}}(R)$. We have $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ by Lemma 32.4.7. Hence also $S = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. As formation of the relative spectrum commutes with base change, the inverse image of the open $S_0 \\subset T_0$ in $T_ i$ is $S_ i$. Let $Z_0 = T_0 \\setminus S_0$ and let $Z_ i \\subset T_ i$ be the inverse image of $Z_0$. As $S_ i = T_ i \\setminus Z_ i$, it suffices to show that $Z_ i$ is empty for some $i$. Assume $Z_ i$ is nonempty for all $i$ to get a contradiction. By Lemma 32.4.8 there exists a point $s$ of $S = \\mathop{\\mathrm{lim}}\\nolimits T_ i$ which maps to a point of $Z_ i$ for every $i$. But $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$, and hence we arrive at a contradiction by Lemma 32.4.6. \n      $\\square$\n    \n"," by
  have := isAffineHom_œÄ_app _ _ hc
  obtain ‚ü®i, hi‚ü© := Scheme.exists_isQuasiAffine_of_isLimit D c hc
  have : ‚àÄ {i j : I} (f : i ‚ü∂ j), IsAffineHom ((D ‚ãô Œì.rightOp ‚ãô Scheme.Spec).map f) := by
    dsimp; infer_instance
  have (j : _) : CompactSpace ((D ‚ãô Œì.rightOp ‚ãô Scheme.Spec).obj j) := by dsimp; infer_instance
  obtain ‚ü®j, fij, hj‚ü© := exists_map_eq_top _ _
    (isLimitOfPreserves (Scheme.Œì.rightOp ‚ãô Scheme.Spec) hc) (D.obj i).toSpecŒì.opensRange
    ((preimage_opensRange_toSpecŒì (X := c.pt) (c.œÄ.app i)).trans
      (by simp [Hom.opensRange_of_isIso]))
  have := IsQuasiAffine.of_isAffineHom (D.map fij)
  exact ‚ü®j, ‚ü®isIso_of_isOpenImmersion_of_opensRange_eq_top _
    ((preimage_opensRange_toSpecŒì (D.map fij)).symm.trans hj)‚ü©‚ü©
","lemma Scheme.exists_isAffine_of_isLimit [IsCofiltered I]
    [‚àÄ {i j} (f : i ‚ü∂ j), IsAffineHom (D.map f)]
    [‚àÄ (i : I), CompactSpace (D.obj i)]
    [‚àÄ (i : I), QuasiSeparatedSpace (D.obj i)]
    [IsAffine c.pt] :
    ‚àÉ i, IsAffine (D.obj i) ","Proof.\n      By Lemma 32.4.12 [[\n  Lemma 32.4.12. In Situation 32.4.5 if $S$ is quasi-affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are quasi-affine. \n\n    \n]] we may assume that $S_0$ is quasi-affine for some $0 \\in I$. Set $R_0 = \\Gamma (S_0, \\mathcal{O}_{S_0})$. Then $S_0$ is a quasi-compact open of $T_0 = \\mathop{\\mathrm{Spec}}(R_0)$. Denote $j_0 : S_0 \\to T_0$ the corresponding quasi-compact open immersion. For $i \\geq 0$ set $\\mathcal{A}_ i = f_{i0, *}\\mathcal{O}_{S_ i}$. Since $f_{i0}$ is affine we see that $S_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{S_0}(\\mathcal{A}_ i)$. Set $T_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{T_0}(j_{0, *}\\mathcal{A}_ i)$. Then $T_ i \\to T_0$ is affine, hence $T_ i$ is affine. Thus $T_ i$ is the spectrum of \n    \n      \n  \\[  R_ i = \\Gamma (T_0, j_{0, *}\\mathcal{A}_ i) = \\Gamma (S_0, \\mathcal{A}_ i) = \\Gamma (S_ i, \\mathcal{O}_{S_ i}).  \\]\n\n    \n       Write $S = \\mathop{\\mathrm{Spec}}(R)$. We have $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ by Lemma 32.4.7 [[\n  Lemma 32.4.7. In Situation 32.4.5. Suppose that $\\mathcal{F}_0$ is a quasi-coherent sheaf on $S_0$. Set $\\mathcal{F}_ i = f_{i0}^*\\mathcal{F}_0$ for $i \\geq 0$ and set $\\mathcal{F} = f_0^*\\mathcal{F}_0$. Then \n  \n  \\[  \\Gamma (S, \\mathcal{F}) = \\mathop{\\mathrm{colim}}\\nolimits _{i \\geq 0} \\Gamma (S_ i, \\mathcal{F}_ i)  \\]\n\n\n    \n]]. Hence also $S = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. As formation of the relative spectrum commutes with base change, the inverse image of the open $S_0 \\subset T_0$ in $T_ i$ is $S_ i$. Let $Z_0 = T_0 \\setminus S_0$ and let $Z_ i \\subset T_ i$ be the inverse image of $Z_0$. As $S_ i = T_ i \\setminus Z_ i$, it suffices to show that $Z_ i$ is empty for some $i$. Assume $Z_ i$ is nonempty for all $i$ to get a contradiction. By Lemma 32.4.8 [[\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n]] there exists a point $s$ of $S = \\mathop{\\mathrm{lim}}\\nolimits T_ i$ which maps to a point of $Z_ i$ for every $i$. But $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$, and hence we arrive at a contradiction by Lemma 32.4.6 [[\n  Lemma 32.4.6. In Situation 32.4.5. \n  \n  \nWe have $S_{set} = \\mathop{\\mathrm{lim}}\\nolimits _ i S_{i, set}$ where $S_{set}$ indicates the underlying set of the scheme $S$. \n\n\nWe have $S_{top} = \\mathop{\\mathrm{lim}}\\nolimits _ i S_{i, top}$ where $S_{top}$ indicates the underlying topological space of the scheme $S$. \n\n\nIf $s, s\' \\in S$ and $s\'$ is not a specialization of $s$ then for some $i \\in I$ the image $s\'_ i \\in S_ i$ of $s\'$ is not a specialization of the image $s_ i \\in S_ i$ of $s$. \n\n\nAdd more easy facts on topology of $S$ here. (Requirement: whatever is added should be easy in the affine case.) \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      By Lemma 32.4.12 [[\n  Lemma 32.4.12. In Situation 32.4.5 if $S$ is quasi-affine, then for some $i_0 \\in I$ the schemes $S_ i$ for $i \\geq i_0$ are quasi-affine. \n\n    \n]] we may assume that $S_0$ is quasi-affine for some $0 \\in I$. Set $R_0 = \\Gamma (S_0, \\mathcal{O}_{S_0})$. Then $S_0$ is a quasi-compact open of $T_0 = \\mathop{\\mathrm{Spec}}(R_0)$. Denote $j_0 : S_0 \\to T_0$ the corresponding quasi-compact open immersion. For $i \\geq 0$ set $\\mathcal{A}_ i = f_{i0, *}\\mathcal{O}_{S_ i}$. Since $f_{i0}$ is affine we see that $S_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{S_0}(\\mathcal{A}_ i)$. Set $T_ i = \\underline{\\mathop{\\mathrm{Spec}}}_{T_0}(j_{0, *}\\mathcal{A}_ i)$. Then $T_ i \\to T_0$ is affine, hence $T_ i$ is affine. Thus $T_ i$ is the spectrum of \n    \n      \n  \\[  R_ i = \\Gamma (T_0, j_{0, *}\\mathcal{A}_ i) = \\Gamma (S_0, \\mathcal{A}_ i) = \\Gamma (S_ i, \\mathcal{O}_{S_ i}).  \\]\n\n    \n       Write $S = \\mathop{\\mathrm{Spec}}(R)$. We have $R = \\mathop{\\mathrm{colim}}\\nolimits _ i R_ i$ by Lemma 32.4.7 [[\n  Lemma 32.4.7. In Situation 32.4.5. Suppose that $\\mathcal{F}_0$ is a quasi-coherent sheaf on $S_0$. Set $\\mathcal{F}_ i = f_{i0}^*\\mathcal{F}_0$ for $i \\geq 0$ and set $\\mathcal{F} = f_0^*\\mathcal{F}_0$. Then \n  \n  \\[  \\Gamma (S, \\mathcal{F}) = \\mathop{\\mathrm{colim}}\\nolimits _{i \\geq 0} \\Gamma (S_ i, \\mathcal{F}_ i)  \\]\n\n\n    \n]]. Hence also $S = \\mathop{\\mathrm{lim}}\\nolimits _ i T_ i$. As formation of the relative spectrum commutes with base change, the inverse image of the open $S_0 \\subset T_0$ in $T_ i$ is $S_ i$. Let $Z_0 = T_0 \\setminus S_0$ and let $Z_ i \\subset T_ i$ be the inverse image of $Z_0$. As $S_ i = T_ i \\setminus Z_ i$, it suffices to show that $Z_ i$ is empty for some $i$. Assume $Z_ i$ is nonempty for all $i$ to get a contradiction. By Lemma 32.4.8 [[\n  Lemma 32.4.8. In Situation 32.4.5. Suppose for each $i$ we are given a nonempty closed subset $Z_ i \\subset S_ i$ with $f_{i\'i}(Z_{i\'}) \\subset Z_ i$ for all $i\' \\geq i$. Then there exists a point $s \\in S$ with $f_ i(s) \\in Z_ i$ for all $i$. \n\n    \n]] there exists a point $s$ of $S = \\mathop{\\mathrm{lim}}\\nolimits T_ i$ which maps to a point of $Z_ i$ for every $i$. But $S = \\mathop{\\mathrm{lim}}\\nolimits _ i S_ i$, and hence we arrive at a contradiction by Lemma 32.4.6 [[\n  Lemma 32.4.6. In Situation 32.4.5. \n  \n  \nWe have $S_{set} = \\mathop{\\mathrm{lim}}\\nolimits _ i S_{i, set}$ where $S_{set}$ indicates the underlying set of the scheme $S$. \n\n\nWe have $S_{top} = \\mathop{\\mathrm{lim}}\\nolimits _ i S_{i, top}$ where $S_{top}$ indicates the underlying topological space of the scheme $S$. \n\n\nIf $s, s\' \\in S$ and $s\'$ is not a specialization of $s$ then for some $i \\in I$ the image $s\'_ i \\in S_ i$ of $s\'$ is not a specialization of the image $s_ i \\in S_ i$ of $s$. \n\n\nAdd more easy facts on topology of $S$ here. (Requirement: whatever is added should be easy in the affine case.) \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, both proofs aim at an eventual quasi-affineness/quasi-affine open immersion statement in an inverse limit situation, and the Lean proof does use a key ingredient `Scheme.exists_isQuasiAffine_of_isLimit` matching the informal opening reduction ‚Äúfor some i0 the Si are quasi-affine‚Äù. However, the informal proof‚Äôs main content is a detailed construction via relative Spec, rings of global sections, expressing S as a limit of affine Ti, and a contradiction argument using nonempty closed complements Zi plus a point-existence lemma (32.4.8) and topology-of-limit lemma (32.4.6). None of that structure appears in the Lean proof.\n\nStructurally, the Lean proof instead proceeds by extracting an index i with quasi-affineness, then using an `exists_map_eq_top` argument about opensRange becoming top after some transition map, and concludes an open immersion isomorphism via `isIso_of_isOpenImmersion_of_opensRange_eq_top`. This is a different strategy (opensRange/top + affine hom machinery) rather than the informal relative-Spec/closed-subset contradiction. So while the endpoint property is plausibly related, the proof methods and intermediate constructions/lemmas do not correspond closely, and significant informal steps are absent from the formal proof.""}"
13,01OX,"instance (priority := 100) {Z : Scheme} [IsLocallyNoetherian X]
    {f : Z ‚ü∂ X} [IsOpenImmersion f] : QuasiCompact f := by
  apply quasiCompact_iff_forall_isAffineOpen.mpr
  intro U hU
  rw [Opens.map_coe, ‚Üê Set.preimage_inter_range]
  apply f.isOpenEmbedding.isInducing.isCompact_preimage'
  ¬∑ apply (noetherianSpace_set_iff _).mp
    ¬∑ convert noetherianSpace_of_isAffineOpen U hU
      apply IsLocallyNoetherian.component_noetherian ‚ü®U, hU‚ü©
    ¬∑ exact Set.inter_subset_left
  ¬∑ exact Set.inter_subset_right
",Formal Proof of Stacks Project Tag 01OX,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Noetherian.lean#L205-L215,Q27041,,28.5.3,lemma,3.0,"['01OU', '01OH', '0ELP']","\n  Lemma 28.5.3. Any immersion $Z \\to X$ with $X$ locally Noetherian is quasi-compact. \n\n    \n      Proof.\n      A closed immersion is clearly quasi-compact. A composition of quasi-compact morphisms is quasi-compact, see Topology, Lemma 5.12.2. Hence it suffices to show that an open immersion into a locally Noetherian scheme is quasi-compact. Using Schemes, Lemma 26.19.2 we reduce to the case where $X$ is affine. Any open subset of the spectrum of a Noetherian ring is quasi-compact (for example combine Algebra, Lemma 10.31.5 and Topology, Lemmas 5.9.2 and 5.12.13). \n      $\\square$\n    \n",\n  Lemma 28.5.3. Any immersion $Z \\to X$ with $X$ locally Noetherian is quasi-compact. \n\n    \n,"Proof.\n      A closed immersion is clearly quasi-compact. A composition of quasi-compact morphisms is quasi-compact, see Topology, Lemma 5.12.2. Hence it suffices to show that an open immersion into a locally Noetherian scheme is quasi-compact. Using Schemes, Lemma 26.19.2 we reduce to the case where $X$ is affine. Any open subset of the spectrum of a Noetherian ring is quasi-compact (for example combine Algebra, Lemma 10.31.5 and Topology, Lemmas 5.9.2 and 5.12.13). \n      $\\square$\n    \n"," 100) {Z : Scheme} [IsLocallyNoetherian X]
    {f : Z ‚ü∂ X} [IsOpenImmersion f] : QuasiCompact f := by
  apply quasiCompact_iff_forall_isAffineOpen.mpr
  intro U hU
  rw [Opens.map_coe, ‚Üê Set.preimage_inter_range]
  apply f.isOpenEmbedding.isInducing.isCompact_preimage'
  ¬∑ apply (noetherianSpace_set_iff _).mp
    ¬∑ convert noetherianSpace_of_isAffineOpen U hU
      apply IsLocallyNoetherian.component_noetherian ‚ü®U, hU‚ü©
    ¬∑ exact Set.inter_subset_left
  ¬∑ exact Set.inter_subset_right
",instance (priority ,"Proof.\n      A closed immersion is clearly quasi-compact. A composition of quasi-compact morphisms is quasi-compact, see Topology, Lemma 5.12.2 [[\n  Lemma 5.12.2. A composition of quasi-compact maps is quasi-compact. \n\n    \n]]. Hence it suffices to show that an open immersion into a locally Noetherian scheme is quasi-compact. Using Schemes, Lemma 26.19.2 [[\n  Lemma 26.19.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f : X \\to S$ is quasi-compact, \n\n\nthe inverse image of every affine open is quasi-compact, and \n\n\nthere exists some affine open covering $S = \\bigcup _{i \\in I} U_ i$ such that $f^{-1}(U_ i)$ is quasi-compact for all $i$. \n\n\n\n\n    \n]] we reduce to the case where $X$ is affine. Any open subset of the spectrum of a Noetherian ring is quasi-compact (for example combine Algebra, Lemma 10.31.5 [[\n  Lemma 10.31.5. If $R$ is a Noetherian ring then $\\mathop{\\mathrm{Spec}}(R)$ is a Noetherian topological space, see Topology, Definition 5.9.1. \n\n    \n]] and Topology, Lemmas 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]] and 5.12.13 [[\n  Lemma 5.12.13. Let $X$ be a Noetherian topological space. \n  \n  \nThe space $X$ is quasi-compact. \n\n\nAny subset of $X$ is retrocompact. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","Proof.\n      A closed immersion is clearly quasi-compact. A composition of quasi-compact morphisms is quasi-compact, see Topology, Lemma 5.12.2 [[\n  Lemma 5.12.2. A composition of quasi-compact maps is quasi-compact. \n\n    \n]]. Hence it suffices to show that an open immersion into a locally Noetherian scheme is quasi-compact. Using Schemes, Lemma 26.19.2 [[\n  Lemma 26.19.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f : X \\to S$ is quasi-compact, \n\n\nthe inverse image of every affine open is quasi-compact, and \n\n\nthere exists some affine open covering $S = \\bigcup _{i \\in I} U_ i$ such that $f^{-1}(U_ i)$ is quasi-compact for all $i$. \n\n\n\n\n    \n]] we reduce to the case where $X$ is affine. Any open subset of the spectrum of a Noetherian ring is quasi-compact (for example combine Algebra, Lemma 10.31.5 [[\n  Lemma 10.31.5. If $R$ is a Noetherian ring then $\\mathop{\\mathrm{Spec}}(R)$ is a Noetherian topological space, see Topology, Definition 5.9.1. \n\n    \n]] and Topology, Lemmas 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]] and 5.12.13 [[\n  Lemma 5.12.13. Let $X$ be a Noetherian topological space. \n  \n  \nThe space $X$ is quasi-compact. \n\n\nAny subset of $X$ is retrocompact. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof establishes exactly the key reduced claim highlighted in the informal proof: an open immersion into a locally Noetherian scheme is quasi-compact. It uses the characterization of quasi-compactness via checking preimages of affine opens (`quasiCompact_iff_forall_isAffineOpen`), matching the informal reduction using the cited lemma about affine opens. Structurally, the Lean argument then proves quasi-compactness of `f ‚Åª¬π(U)` by rewriting it as an intersection with the range and applying a compact-preimage lemma for an inducing map, using that an affine open in a locally Noetherian scheme is a Noetherian space (hence quasi-compact). This corresponds to the informal step ‚Äúopen subsets of Spec of a Noetherian ring are quasi-compact,‚Äù though Lean phrases it via Noetherian topological space machinery rather than explicitly mentioning Spec.\n\nThe main mismatch is that the informal proof also discusses closed immersions and composition of quasi-compact morphisms before reducing to the open immersion case, while the formal proof contains only the open immersion case and does not formalize those preliminary reductions. Hence strong alignment on the core lemma proved, but not a perfect match to the full informal narrative.""}"
14,01OY,"instance (priority := 100) IsLocallyNoetherian.quasiSeparatedSpace [IsLocallyNoetherian X] :
    QuasiSeparatedSpace X := by
  apply quasiSeparatedSpace_iff_forall_affineOpens.mpr
  intro U V
  have hInd := U.2.fromSpec.isOpenEmbedding.isInducing
  apply (hInd.isCompact_preimage_iff ?_).mp
  ¬∑ rw [‚Üê Set.preimage_inter_range, IsAffineOpen.range_fromSpec, Set.inter_comm]
    apply hInd.isCompact_preimage'
    ¬∑ apply (noetherianSpace_set_iff _).mp
      ¬∑ convert noetherianSpace_of_isAffineOpen U.1 U.2
        apply IsLocallyNoetherian.component_noetherian
      ¬∑ exact Set.inter_subset_left
    ¬∑ rw [IsAffineOpen.range_fromSpec]
      exact Set.inter_subset_left
  ¬∑ rw [IsAffineOpen.range_fromSpec]
    exact Set.inter_subset_left
",Formal Proof of Stacks Project Tag 01OY,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Noetherian.lean#L219-L234,Q27041,,28.5.4,lemma,3.0,"['01OU', '01OH', '0ELP']","\n  Lemma 28.5.4. A locally Noetherian scheme is quasi-separated. \n\n    \n      Proof.\n      By Schemes, Lemma 26.21.6 we have to show that the intersection $U \\cap V$ of two affine opens of $X$ is quasi-compact. This follows from Lemma 28.5.3 above on considering the open immersion $U \\cap V \\to U$ for example. (But really it is just because any open of the spectrum of a Noetherian ring is quasi-compact.) \n      $\\square$\n    \n",\n  Lemma 28.5.4. A locally Noetherian scheme is quasi-separated. \n\n    \n,"Proof.\n      By Schemes, Lemma 26.21.6 we have to show that the intersection $U \\cap V$ of two affine opens of $X$ is quasi-compact. This follows from Lemma 28.5.3 above on considering the open immersion $U \\cap V \\to U$ for example. (But really it is just because any open of the spectrum of a Noetherian ring is quasi-compact.) \n      $\\square$\n    \n"," 100) IsLocallyNoetherian.quasiSeparatedSpace [IsLocallyNoetherian X] :
    QuasiSeparatedSpace X := by
  apply quasiSeparatedSpace_iff_forall_affineOpens.mpr
  intro U V
  have hInd := U.2.fromSpec.isOpenEmbedding.isInducing
  apply (hInd.isCompact_preimage_iff ?_).mp
  ¬∑ rw [‚Üê Set.preimage_inter_range, IsAffineOpen.range_fromSpec, Set.inter_comm]
    apply hInd.isCompact_preimage'
    ¬∑ apply (noetherianSpace_set_iff _).mp
      ¬∑ convert noetherianSpace_of_isAffineOpen U.1 U.2
        apply IsLocallyNoetherian.component_noetherian
      ¬∑ exact Set.inter_subset_left
    ¬∑ rw [IsAffineOpen.range_fromSpec]
      exact Set.inter_subset_left
  ¬∑ rw [IsAffineOpen.range_fromSpec]
    exact Set.inter_subset_left
",instance (priority ,"Proof.\n      By Schemes, Lemma 26.21.6 [[\n  Lemma 26.21.6. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nThe morphism $f$ is quasi-separated. \n\n\nFor every pair of affine opens $U, V \\subset X$ which map into a common affine open of $S$ the intersection $U \\cap V$ is a finite union of affine opens of $X$. \n\n\nThere exists an affine open covering $S = \\bigcup _{i \\in I} U_ i$ and for each $i$ an affine open covering $f^{-1}U_ i = \\bigcup _{j \\in I_ i} V_ j$ such that for each $i$ and each pair $j, j\' \\in I_ i$ the intersection $V_ j \\cap V_{j\'}$ is a finite union of affine opens of $X$. \n\n\n\n\n    \n]] we have to show that the intersection $U \\cap V$ of two affine opens of $X$ is quasi-compact. This follows from Lemma 28.5.3 [[\n  Lemma 28.5.3. Any immersion $Z \\to X$ with $X$ locally Noetherian is quasi-compact. \n\n    \n]] above on considering the open immersion $U \\cap V \\to U$ for example. (But really it is just because any open of the spectrum of a Noetherian ring is quasi-compact.) \n      $\\square$\n    \n","Proof.\n      By Schemes, Lemma 26.21.6 [[\n  Lemma 26.21.6. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nThe morphism $f$ is quasi-separated. \n\n\nFor every pair of affine opens $U, V \\subset X$ which map into a common affine open of $S$ the intersection $U \\cap V$ is a finite union of affine opens of $X$. \n\n\nThere exists an affine open covering $S = \\bigcup _{i \\in I} U_ i$ and for each $i$ an affine open covering $f^{-1}U_ i = \\bigcup _{j \\in I_ i} V_ j$ such that for each $i$ and each pair $j, j\' \\in I_ i$ the intersection $V_ j \\cap V_{j\'}$ is a finite union of affine opens of $X$. \n\n\n\n\n    \n]] we have to show that the intersection $U \\cap V$ of two affine opens of $X$ is quasi-compact. This follows from Lemma 28.5.3 [[\n  Lemma 28.5.3. Any immersion $Z \\to X$ with $X$ locally Noetherian is quasi-compact. \n\n    \n]] above on considering the open immersion $U \\cap V \\to U$ for example. (But really it is just because any open of the spectrum of a Noetherian ring is quasi-compact.) \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish that a locally Noetherian scheme/space is quasi-separated by reducing to the criterion that intersections of affine opens are quasi-compact. The Lean proof uses `quasiSeparatedSpace_iff_forall_affineOpens` and then proves compactness of the relevant preimage via the inducing map `fromSpec` and a Noetherian-space argument (`noetherianSpace_of_isAffineOpen` plus `component_noetherian`), which matches the informal claim that opens in Spec of a Noetherian ring are quasi-compact. Structurally, the informal proof cites Stacks lemmas (quasi-separated iff affine intersections are qc; immersion into locally Noetherian is qc) and then applies it to the open immersion `U‚à©V ‚Üí U`. The Lean proof does not explicitly invoke an immersion lemma but instead proves compactness directly by pulling back along `fromSpec` and using Noetherianity; this is a different route but achieves the same key step. No major extraneous content appears, though the formal proof‚Äôs technical detour through `isInducing`/preimage-of-range is not reflected in the informal narrative, so correspondence is not perfect.""}"
15,01OZ,"instance (priority := 100) IsNoetherian.noetherianSpace [IsNoetherian X] :
    NoetherianSpace X := by
  apply TopologicalSpace.noetherian_univ_iff.mp
  let ùí∞ := X.affineCover.finiteSubcover
  rw [‚Üê ùí∞.iUnion_range]
  suffices ‚àÄ i : ùí∞.I‚ÇÄ, NoetherianSpace (Set.range <| (ùí∞.f i)) by
    apply NoetherianSpace.iUnion
  intro i
  have : IsAffine (ùí∞.X i) := by
    rw [X.affineCover.finiteSubcover_X]
    apply Scheme.isAffine_affineCover
  let U : X.affineOpens := ‚ü®Scheme.Hom.opensRange (ùí∞.f i), isAffineOpen_opensRange _‚ü©
  convert noetherianSpace_of_isAffineOpen U.1 U.2
  apply IsLocallyNoetherian.component_noetherian
",Formal Proof of Stacks Project Tag 01OZ,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Noetherian.lean#L294-L307,Q27041,,28.5.5,lemma,3.0,"['01OU', '01OH', '0ELP']","\n  Lemma 28.5.5. A (locally) Noetherian scheme has a (locally) Noetherian underlying topological space, see Topology, Definition 5.9.1. \n\n    \n      Proof.\n      This is because a Noetherian scheme is a finite union of spectra of Noetherian rings and Algebra, Lemma 10.31.5 and Topology, Lemma 5.9.4. \n      $\\square$\n    \n","\n  Lemma 28.5.5. A (locally) Noetherian scheme has a (locally) Noetherian underlying topological space, see Topology, Definition 5.9.1. \n\n    \n","Proof.\n      This is because a Noetherian scheme is a finite union of spectra of Noetherian rings and Algebra, Lemma 10.31.5 and Topology, Lemma 5.9.4. \n      $\\square$\n    \n"," 100) IsNoetherian.noetherianSpace [IsNoetherian X] :
    NoetherianSpace X := by
  apply TopologicalSpace.noetherian_univ_iff.mp
  let ùí∞ := X.affineCover.finiteSubcover
  rw [‚Üê ùí∞.iUnion_range]
  suffices ‚àÄ i : ùí∞.I‚ÇÄ, NoetherianSpace (Set.range <| (ùí∞.f i)) by
    apply NoetherianSpace.iUnion
  intro i
  have : IsAffine (ùí∞.X i) := by
    rw [X.affineCover.finiteSubcover_X]
    apply Scheme.isAffine_affineCover
  let U : X.affineOpens := ‚ü®Scheme.Hom.opensRange (ùí∞.f i), isAffineOpen_opensRange _‚ü©
  convert noetherianSpace_of_isAffineOpen U.1 U.2
  apply IsLocallyNoetherian.component_noetherian
",instance (priority ,"Proof.\n      This is because a Noetherian scheme is a finite union of spectra of Noetherian rings and Algebra, Lemma 10.31.5 [[\n  Lemma 10.31.5. If $R$ is a Noetherian ring then $\\mathop{\\mathrm{Spec}}(R)$ is a Noetherian topological space, see Topology, Definition 5.9.1. \n\n    \n]] and Topology, Lemma 5.9.4 [[\n  Lemma 5.9.4. Let $X$ be a topological space. Let $X_ i \\subset X$, $i = 1, \\ldots , n$ be a finite collection of subsets. If each $X_ i$ is Noetherian (with the induced topology), then $\\bigcup _{i = 1, \\ldots , n} X_ i$ is Noetherian (with the induced topology). \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      This is because a Noetherian scheme is a finite union of spectra of Noetherian rings and Algebra, Lemma 10.31.5 [[\n  Lemma 10.31.5. If $R$ is a Noetherian ring then $\\mathop{\\mathrm{Spec}}(R)$ is a Noetherian topological space, see Topology, Definition 5.9.1. \n\n    \n]] and Topology, Lemma 5.9.4 [[\n  Lemma 5.9.4. Let $X$ be a topological space. Let $X_ i \\subset X$, $i = 1, \\ldots , n$ be a finite collection of subsets. If each $X_ i$ is Noetherian (with the induced topology), then $\\bigcup _{i = 1, \\ldots , n} X_ i$ is Noetherian (with the induced topology). \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish that a Noetherian scheme has a Noetherian underlying topological space by covering the scheme with finitely many affine opens and using that each affine piece is Noetherian, then concluding the finite union is Noetherian. The Lean proof implements this via `TopologicalSpace.noetherian_univ_iff`, taking a finite subcover from `X.affineCover`, proving each `Set.range (ùí∞.f i)` is Noetherian using `noetherianSpace_of_isAffineOpen` together with `IsLocallyNoetherian.component_noetherian`, and then applying `NoetherianSpace.iUnion` to the union. Structurally, this matches the informal argument‚Äôs ‚Äúfinite union of affine spectra + finite union lemma,‚Äù though the Lean proof does not explicitly mention Spec of Noetherian rings (Lemma 10.31.5) and instead uses a more abstract lemma about affine opens/components being Noetherian. Thus the core idea aligns well, but the cited ring-theoretic route in the informal proof is not mirrored explicitly, making it not a perfect structural match.""}"
16,01P0,"instance (priority := 100) quasiCompact_of_noetherianSpace_source {X Y : Scheme}
    [NoetherianSpace X] (f : X ‚ü∂ Y) : QuasiCompact f :=
  ‚ü®fun _ _ _ => NoetherianSpace.isCompact _‚ü©
",Formal Proof of Stacks Project Tag 01P0,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Noetherian.lean#L311-L313,Q27041,,28.5.8,lemma,3.0,"['01OU', '01OH', '0ELP']","\n  Lemma 28.5.8. Any morphism of schemes $f : X \\to Y$ with $X$ Noetherian is quasi-compact. \n\n    \n      Proof.\n      Use Lemma 28.5.5 and use that any subset of a Noetherian topological space is quasi-compact (see Topology, Lemmas 5.9.2 and 5.12.13). \n      $\\square$\n    \n",\n  Lemma 28.5.8. Any morphism of schemes $f : X \\to Y$ with $X$ Noetherian is quasi-compact. \n\n    \n,"Proof.\n      Use Lemma 28.5.5 and use that any subset of a Noetherian topological space is quasi-compact (see Topology, Lemmas 5.9.2 and 5.12.13). \n      $\\square$\n    \n"," 100) quasiCompact_of_noetherianSpace_source {X Y : Scheme}
    [NoetherianSpace X] (f : X ‚ü∂ Y) : QuasiCompact f :=
  ‚ü®fun _ _ _ => NoetherianSpace.isCompact _‚ü©
",instance (priority ,"Proof.\n      Use Lemma 28.5.5 [[\n  Lemma 28.5.5. A (locally) Noetherian scheme has a (locally) Noetherian underlying topological space, see Topology, Definition 5.9.1. \n\n    \n]] and use that any subset of a Noetherian topological space is quasi-compact (see Topology, Lemmas 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]] and 5.12.13 [[\n  Lemma 5.12.13. Let $X$ be a Noetherian topological space. \n  \n  \nThe space $X$ is quasi-compact. \n\n\nAny subset of $X$ is retrocompact. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","Proof.\n      Use Lemma 28.5.5 [[\n  Lemma 28.5.5. A (locally) Noetherian scheme has a (locally) Noetherian underlying topological space, see Topology, Definition 5.9.1. \n\n    \n]] and use that any subset of a Noetherian topological space is quasi-compact (see Topology, Lemmas 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]] and 5.12.13 [[\n  Lemma 5.12.13. Let $X$ be a Noetherian topological space. \n  \n  \nThe space $X$ is quasi-compact. \n\n\nAny subset of $X$ is retrocompact. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish the same claim: if the source scheme X has a Noetherian underlying topological space, then any morphism f : X ‚ü∂ Y is quasi-compact. The Lean proof does this by directly using `NoetherianSpace.isCompact` to show the relevant preimages are compact, which implies quasi-compactness. Structurally, the informal proof proceeds by citing lemmas that (i) a Noetherian scheme has a Noetherian underlying space and (ii) Noetherian spaces (and their subsets) are quasi-compact; the Lean proof compresses these steps into the single typeclass assumption `[NoetherianSpace X]` and the lemma `isCompact`. The main mismatch is that the informal proof explicitly discusses subsets/preimages and references specific lemmas about subsets being quasi-compact, while the Lean proof does not mention these intermediate results explicitly (they are bundled into `isCompact` and the definition of `QuasiCompact`).""}"
17,0BA8,"theorem finite_irreducibleComponents_of_isNoetherian [IsNoetherian X] :
    (irreducibleComponents X).Finite := NoetherianSpace.finite_irreducibleComponents
",Formal Proof of Stacks Project Tag 0BA8,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Noetherian.lean#L338-L339,Q27041,,28.5.7,lemma,3.0,"['01OU', '01OH', '0ELP']","\n  Lemma 28.5.7. A Noetherian scheme has a finite number of irreducible components. \n\n    \n      Proof.\n      The underlying topological space of a Noetherian scheme is Noetherian (Lemma 28.5.5) and we conclude because a Noetherian topological space has only finitely many irreducible components (Topology, Lemma 5.9.2). \n      $\\square$\n    \n",\n  Lemma 28.5.7. A Noetherian scheme has a finite number of irreducible components. \n\n    \n,"Proof.\n      The underlying topological space of a Noetherian scheme is Noetherian (Lemma 28.5.5) and we conclude because a Noetherian topological space has only finitely many irreducible components (Topology, Lemma 5.9.2). \n      $\\square$\n    \n"," NoetherianSpace.finite_irreducibleComponents
","theorem finite_irreducibleComponents_of_isNoetherian [IsNoetherian X] :
    (irreducibleComponents X).Finite ","Proof.\n      The underlying topological space of a Noetherian scheme is Noetherian (Lemma 28.5.5 [[\n  Lemma 28.5.5. A (locally) Noetherian scheme has a (locally) Noetherian underlying topological space, see Topology, Definition 5.9.1. \n\n    \n]]) and we conclude because a Noetherian topological space has only finitely many irreducible components (Topology, Lemma 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","Proof.\n      The underlying topological space of a Noetherian scheme is Noetherian (Lemma 28.5.5 [[\n  Lemma 28.5.5. A (locally) Noetherian scheme has a (locally) Noetherian underlying topological space, see Topology, Definition 5.9.1. \n\n    \n]]) and we conclude because a Noetherian topological space has only finitely many irreducible components (Topology, Lemma 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the informal proof argues: (1) the underlying topological space is Noetherian, then (2) a Noetherian topological space has finitely many irreducible components, hence the conclusion. The Lean proof reference `NoetherianSpace.finite_irreducibleComponents` directly corresponds to step (2): it is precisely the general topological lemma that a Noetherian space has finitely many irreducible components. Structurally, however, the informal proof includes the preliminary reduction from a (locally) Noetherian scheme to a Noetherian topological space (Lemma 28.5.5), while the formal proof as given only cites the topological lemma and does not show that reduction. Thus it matches the core concluding step but omits the scheme-to-topology part present in the informal argument.""}"
19,03GP,"instance [IsIntegralHom f] : IsIso f.toNormalization := by
  refine (IsZariskiLocalAtTarget.iff_of_openCover (P := .isomorphisms _)
    f.normalizationOpenCover).mpr fun U ‚Ü¶ ?_
  let e := IsOpenImmersion.isoOfRangeEq (pullback.fst f.toNormalization
    (f.normalizationOpenCover.f U)) (f ‚Åª¬π·µÅ U.1).Œπ (by simp [‚Üê Hom.coe_opensRange,
      Hom.opensRange_pullbackFst, ‚Üê f.fromNormalization_preimage, ‚Üê Scheme.Hom.comp_preimage])
  rw [‚Üê MorphismProperty.cancel_left_of_respectsIso (.isomorphisms _)
    (e ‚â™‚â´ (U.2.preimage f).isoSpec).inv]
  letI := (f.app U.1).hom.toAlgebra
  convert_to IsIso (Spec.map (CommRingCat.ofHom
      (integralClosure Œì(Y, U.1) Œì(X, f ‚Åª¬π·µÅ U.1)).val.toRingHom))
  ¬∑ rw [‚Üê cancel_mono (f.normalizationOpenCover.f U), ‚Üê cancel_epi (U.2.preimage f).isoSpec.hom]
    simp [e, -Iso.cancel_iso_hom_left, IsAffineOpen.isoSpec_hom,
      Hom.Œπ_toNormalization]
  have : integralClosure Œì(Y, U.1) Œì(X, f ‚Åª¬π·µÅ U.1) = ‚ä§ := by
    rw [integralClosure_eq_top_iff, ‚Üê algebraMap_isIntegral_iff, RingHom.algebraMap_toAlgebra]
    exact IsIntegralHom.isIntegral_app _ _ U.2
  rw [this]
  exact inferInstanceAs (IsIso (Scheme.Spec.mapIso (Subalgebra.topEquiv
    (R := Œì(Y, U.1)) (A := ‚ÜëŒì(X, f ‚Åª¬π·µÅ U.1))).toCommRingCatIso.op).hom)
",Formal Proof of Stacks Project Tag 03GP,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Normalization.lean#L232-L251,Q27041,,29.53.12,lemma,3.0,"['0BAK', '01QL', '0ELP']",\n  Lemma 29.53.12. Let $f : Y \\to X$ be an integral morphism. Then the normalization of $X$ in $Y$ is equal to $Y$. \n\n    \n      Proof.\n      By Lemma 29.44.7 this is a special case of Lemma 29.53.11. \n      $\\square$\n    \n,\n  Lemma 29.53.12. Let $f : Y \\to X$ be an integral morphism. Then the normalization of $X$ in $Y$ is equal to $Y$. \n\n    \n,Proof.\n      By Lemma 29.44.7 this is a special case of Lemma 29.53.11. \n      $\\square$\n    \n," by
  refine (IsZariskiLocalAtTarget.iff_of_openCover (P := .isomorphisms _)
    f.normalizationOpenCover).mpr fun U ‚Ü¶ ?_
  let e := IsOpenImmersion.isoOfRangeEq (pullback.fst f.toNormalization
    (f.normalizationOpenCover.f U)) (f ‚Åª¬π·µÅ U.1).Œπ (by simp [‚Üê Hom.coe_opensRange,
      Hom.opensRange_pullbackFst, ‚Üê f.fromNormalization_preimage, ‚Üê Scheme.Hom.comp_preimage])
  rw [‚Üê MorphismProperty.cancel_left_of_respectsIso (.isomorphisms _)
    (e ‚â™‚â´ (U.2.preimage f).isoSpec).inv]
  letI := (f.app U.1).hom.toAlgebra
  convert_to IsIso (Spec.map (CommRingCat.ofHom
      (integralClosure Œì(Y, U.1) Œì(X, f ‚Åª¬π·µÅ U.1)).val.toRingHom))
  ¬∑ rw [‚Üê cancel_mono (f.normalizationOpenCover.f U), ‚Üê cancel_epi (U.2.preimage f).isoSpec.hom]
    simp [e, -Iso.cancel_iso_hom_left, IsAffineOpen.isoSpec_hom,
      Hom.Œπ_toNormalization]
  have : integralClosure Œì(Y, U.1) Œì(X, f ‚Åª¬π·µÅ U.1) = ‚ä§ := by
    rw [integralClosure_eq_top_iff, ‚Üê algebraMap_isIntegral_iff, RingHom.algebraMap_toAlgebra]
    exact IsIntegralHom.isIntegral_app _ _ U.2
  rw [this]
  exact inferInstanceAs (IsIso (Scheme.Spec.mapIso (Subalgebra.topEquiv
    (R := Œì(Y, U.1)) (A := ‚ÜëŒì(X, f ‚Åª¬π·µÅ U.1))).toCommRingCatIso.op).hom)
",instance [IsIntegralHom f] : IsIso f.toNormalization ,"Proof.\n      By Lemma 29.44.7 [[\n       \n      \n  Lemma 29.44.7. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f$ is integral, and \n\n\n$f$ is affine and universally closed. \n\n\n\n\n    \n]] this is a special case of Lemma 29.53.11 [[\n  Lemma 29.53.11. Let $f : X \\to S$ be a quasi-compact, quasi-separated and universally closed morphisms of schemes. Then $f_*\\mathcal{O}_ X$ is integral over $\\mathcal{O}_ S$. In other words, the normalization of $S$ in $X$ is equal to the factorization \n  \n  \\[  X \\longrightarrow \\underline{\\mathop{\\mathrm{Spec}}}_ S(f_*\\mathcal{O}_ X) \\longrightarrow S  \\]\n\n   of Constructions, Lemma 27.4.7. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      By Lemma 29.44.7 [[\n       \n      \n  Lemma 29.44.7. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f$ is integral, and \n\n\n$f$ is affine and universally closed. \n\n\n\n\n    \n]] this is a special case of Lemma 29.53.11 [[\n  Lemma 29.53.11. Let $f : X \\to S$ be a quasi-compact, quasi-separated and universally closed morphisms of schemes. Then $f_*\\mathcal{O}_ X$ is integral over $\\mathcal{O}_ S$. In other words, the normalization of $S$ in $X$ is equal to the factorization \n  \n  \\[  X \\longrightarrow \\underline{\\mathop{\\mathrm{Spec}}}_ S(f_*\\mathcal{O}_ X) \\longrightarrow S  \\]\n\n   of Constructions, Lemma 27.4.7. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues an equivalence/implication about an integral morphism using two external lemmas (29.44.7 reducing to 29.53.11) and concludes that the normalization of S in X agrees with a relative Spec construction of f_*O_X. The Lean proof instead is a Zariski-local-at-target argument showing a morphism is an isomorphism by checking on an open cover (the normalizationOpenCover), constructing explicit isomorphisms via open immersions and pullbacks, and then reducing to a ring-level statement that an integralClosure subalgebra equals ‚ä§, using an `IsIntegralHom.isIntegral_app` hypothesis.\n\nStructurally, the informal proof is a short lemma-chaining reduction with no local computations, while the formal proof is a detailed local computation on affine opens and integral closure/top arguments to prove an isomorphism. There is some thematic overlap (integrality implies integral closure is top / normalization identification), but the formal proof does not mirror the cited lemma-reduction structure, and it proves a more specific local-isomorphism statement rather than explicitly the equivalence ‚Äúintegral ‚Üî affine + universally closed‚Äù or the identification with Spec_S(f_*O_X) as stated in the informal proof.""}"
20,0AXN,"instance [IsReduced X] : IsReduced f.normalization :=
  have (i : _) : IsReduced ((normalizationOpenCover f).X i) := by
    have : _root_.IsReduced ((normalizationDiagram f).obj (.op i.1)) :=
      let := (f.app i.1).hom.toAlgebra
      isReduced_of_injective (Subalgebra.val _) Subtype.val_injective
    dsimp [normalizationOpenCover]
    infer_instance
  .of_openCover _ f.normalizationOpenCover
",Formal Proof of Stacks Project Tag 0AXN,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Normalization.lean#L292-L299,Q27041,,29.53.8,lemma,3.0,"['0BAK', '01QL', '0ELP']","\n  Lemma 29.53.8. Let $f : Y \\to X$ be a quasi-compact and quasi-separated morphism of schemes. Let $X\' \\to X$ be the normalization of $X$ in $Y$. If $Y$ is reduced, so is $X\'$. \n\n    \n      Proof.\n      This follows from the fact that a subring of a reduced ring is reduced. Some details omitted. \n      $\\square$\n    \n","\n  Lemma 29.53.8. Let $f : Y \\to X$ be a quasi-compact and quasi-separated morphism of schemes. Let $X\' \\to X$ be the normalization of $X$ in $Y$. If $Y$ is reduced, so is $X\'$. \n\n    \n",Proof.\n      This follows from the fact that a subring of a reduced ring is reduced. Some details omitted. \n      $\\square$\n    \n,"
  have (i : _) : IsReduced ((normalizationOpenCover f).X i) := by
    have : _root_.IsReduced ((normalizationDiagram f).obj (.op i.1)) :=
      let := (f.app i.1).hom.toAlgebra
      isReduced_of_injective (Subalgebra.val _) Subtype.val_injective
    dsimp [normalizationOpenCover]
    infer_instance
  .of_openCover _ f.normalizationOpenCover
",instance [IsReduced X] : IsReduced f.normalization ,Proof.\n      This follows from the fact that a subring of a reduced ring is reduced. Some details omitted. \n      $\\square$\n    \n,Proof.\n      This follows from the fact that a subring of a reduced ring is reduced. Some details omitted. \n      $\\square$\n    \n,"{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs rely on the same key idea: reducedness is inherited by a substructure (informal: subring of a reduced ring; formal: `isReduced_of_injective` applied to the inclusion map `Subalgebra.val` with `Subtype.val_injective`). The formal proof then transports this reducedness to the members of the `normalizationOpenCover` and concludes via `.of_openCover`, which is consistent with the intended conclusion but adds categorical/open-cover packaging not mentioned in the informal sketch. Structurally, the informal proof is a one-line argument, while the formal proof expands it into (1) proving reducedness of an object in the normalization diagram using injectivity, (2) unfolding `normalizationOpenCover` and using typeclass inference, and (3) applying an open-cover lemma. This is more detailed and includes extra scaffolding, but it does not contradict the informal reasoning.""}"
22,0BCK,"lemma IsQuasiAffine.of_isImmersion
    [Y.IsQuasiAffine] [IsImmersion f] [CompactSpace X] : X.IsQuasiAffine := by
  have : IsImmersion (X.toSpecŒì ‚â´ Spec.map f.appTop) := by rw [‚Üê toSpecŒì_naturality]; infer_instance
  have : IsImmersion X.toSpecŒì := .of_comp _ (Spec.map f.appTop)
  constructor
",Formal Proof of Stacks Project Tag 0BCK,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/QuasiAffine.lean#L53-L57,Q27041,,28.27.2,lemma,3.0,"['01QD', '01OH', '0ELP']","\n  Lemma 28.27.2. Let $X$ be a quasi-affine scheme. For any quasi-compact immersion $i : X\' \\to X$ the scheme $X\'$ is quasi-affine. \n\n    \n      Proof.\n      This can be proved directly without making use of the material on ample invertible sheaves; we urge the reader to do this on a napkin. Since $X$ is quasi-affine, we have that $\\mathcal{O}_ X$ is ample by Lemma 28.27.1. Then $\\mathcal{O}_{X\'}$ is ample by Lemma 28.26.14. Then $X\'$ is quasi-affine by Lemma 28.27.1. \n      $\\square$\n    \n",\n  Lemma 28.27.2. Let $X$ be a quasi-affine scheme. For any quasi-compact immersion $i : X\' \\to X$ the scheme $X\'$ is quasi-affine. \n\n    \n,"Proof.\n      This can be proved directly without making use of the material on ample invertible sheaves; we urge the reader to do this on a napkin. Since $X$ is quasi-affine, we have that $\\mathcal{O}_ X$ is ample by Lemma 28.27.1. Then $\\mathcal{O}_{X\'}$ is ample by Lemma 28.26.14. Then $X\'$ is quasi-affine by Lemma 28.27.1. \n      $\\square$\n    \n"," by
  have : IsImmersion (X.toSpecŒì ‚â´ Spec.map f.appTop) := by rw [‚Üê toSpecŒì_naturality]; infer_instance
  have : IsImmersion X.toSpecŒì := .of_comp _ (Spec.map f.appTop)
  constructor
","lemma IsQuasiAffine.of_isImmersion
    [Y.IsQuasiAffine] [IsImmersion f] [CompactSpace X] : X.IsQuasiAffine ","Proof.\n      This can be proved directly without making use of the material on ample invertible sheaves; we urge the reader to do this on a napkin. Since $X$ is quasi-affine, we have that $\\mathcal{O}_ X$ is ample by Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]]. Then $\\mathcal{O}_{X\'}$ is ample by Lemma 28.26.14 [[\n  Lemma 28.26.14. Let $X$ be a scheme. Let $\\mathcal{L}$ be an ample invertible $\\mathcal{O}_ X$-module. Let $i : X\' \\to X$ be a morphism of schemes. Assume at least one of the following conditions holds \n  \n  \n$i$ is a quasi-compact immersion, \n\n\n$X\'$ is quasi-compact and $i$ is an immersion, \n\n\n$i$ is quasi-compact and induces a homeomorphism between $X\'$ and $i(X\')$, \n\n\n$X\'$ is quasi-compact and $i$ induces a homeomorphism between $X\'$ and $i(X\')$. \n\n\n\n   Then $i^*\\mathcal{L}$ is ample on $X\'$. \n\n    \n]]. Then $X\'$ is quasi-affine by Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      This can be proved directly without making use of the material on ample invertible sheaves; we urge the reader to do this on a napkin. Since $X$ is quasi-affine, we have that $\\mathcal{O}_ X$ is ample by Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]]. Then $\\mathcal{O}_{X\'}$ is ample by Lemma 28.26.14 [[\n  Lemma 28.26.14. Let $X$ be a scheme. Let $\\mathcal{L}$ be an ample invertible $\\mathcal{O}_ X$-module. Let $i : X\' \\to X$ be a morphism of schemes. Assume at least one of the following conditions holds \n  \n  \n$i$ is a quasi-compact immersion, \n\n\n$X\'$ is quasi-compact and $i$ is an immersion, \n\n\n$i$ is quasi-compact and induces a homeomorphism between $X\'$ and $i(X\')$, \n\n\n$X\'$ is quasi-compact and $i$ induces a homeomorphism between $X\'$ and $i(X\')$. \n\n\n\n   Then $i^*\\mathcal{L}$ is ample on $X\'$. \n\n    \n]]. Then $X\'$ is quasi-affine by Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof argues that quasi-affineness is preserved under a morphism i : X' ‚Üí X satisfying immersion/quasi-compactness hypotheses, via ampleness of O_X and pullback of ample line bundles (using Lemmas 28.27.1 and 28.26.14). The formal proof instead establishes an `IsImmersion` fact about `X.toSpecŒì` by using naturality and an `of_comp` lemma, and then finishes with `constructor` (suggesting it is proving a conjunction/structure with an immersion component). There is no mention of quasi-affine, ampleness, pullbacks of line bundles, or the cited lemmas‚Äô content. Structurally, the informal proof is a three-step chain (quasi-affine ‚Üî ample, pullback preserves ample, hence quasi-affine), while the formal proof is a short composition/instance argument about immersions. Thus the formal proof does not reflect the informal argument in meaning or structure.""}"
23,01LH,"noncomputable abbrev glued : Scheme.{u} :=
  colimit d.functor
",Formal Proof of Stacks Project Tag 01LH,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/RelativeGluing.lean#L97-L98,Q27041,,27.2.1,lemma,3.0,"['01LG', '01LE', '0ELP']","\n  Lemma 27.2.1. Let $S$ be a scheme. Let $\\mathcal{B}$ be a basis for the topology of $S$. Suppose given the following data: \n  \n  \nFor every $U \\in \\mathcal{B}$ a scheme $f_ U : X_ U \\to U$ over $U$. \n\n\nFor $U, V \\in \\mathcal{B}$ with $V \\subset U$ a morphism $\\rho ^ U_ V : X_ V \\to X_ U$ over $U$. \n\n\n\n   Assume that \n  \n  \neach $\\rho ^ U_ V$ induces an isomorphism $X_ V \\to f_ U^{-1}(V)$ of schemes over $V$, \n\n\nwhenever $W, V, U \\in \\mathcal{B}$, with $W \\subset V \\subset U$ we have $\\rho ^ U_ W = \\rho ^ U_ V \\circ \\rho ^ V_ W$. \n\n\n\n   Then there exists a morphism $f : X \\to S$ of schemes and isomorphisms $i_ U : f^{-1}(U) \\to X_ U$ over $U \\in \\mathcal{B}$ such that for $V, U \\in \\mathcal{B}$ with $V \\subset U$ the composition \n  \n  \\[  \\xymatrix{ X_ V \\ar[r]^{i_ V^{-1}} &  f^{-1}(V) \\ar[rr]^{inclusion} &  &  f^{-1}(U) \\ar[r]^{i_ U} &  X_ U }  \\]\n\n   is the morphism $\\rho ^ U_ V$. Moreover $X$ is unique up to unique isomorphism over $S$. \n\n    \n      Proof.\n      To prove this we will use Schemes, Lemma 26.15.4. First we define a contravariant functor $F$ from the category of schemes to the category of sets. Namely, for a scheme $T$ we set \n    \n      \n  \\[  F(T) = \\left\\{  \\begin{matrix}  (g, \\{ h_ U\\} _{U \\in \\mathcal{B}}), \\  g : T \\to S, \\  h_ U : g^{-1}(U) \\to X_ U, \n\n\\\\  f_ U \\circ h_ U = g|_{g^{-1}(U)}, \\  h_ U|_{g^{-1}(V)} = \\rho ^ U_ V \\circ h_ V \\  \\forall \\  V, U \\in \\mathcal{B}, V \\subset U \n\n\\end{matrix} \\right\\} .  \\]\n\n    \n       The restriction mapping $F(T) \\to F(T\')$ given a morphism $T\' \\to T$ is just gotten by composition. For any $W \\in \\mathcal{B}$ we consider the subfunctor $F_ W \\subset F$ consisting of those systems $(g, \\{ h_ U\\} )$ such that $g(T) \\subset W$. \n    \n      First we show $F$ satisfies the sheaf property for the Zariski topology. Suppose that $T$ is a scheme, $T = \\bigcup V_ i$ is an open covering, and $\\xi _ i \\in F(V_ i)$ is an element such that $\\xi _ i|_{V_ i \\cap V_ j} = \\xi _ j|_{V_ i \\cap V_ j}$. Say $\\xi _ i = (g_ i, \\{ h_{i, U}\\} )$. Then we immediately see that the morphisms $g_ i$ glue to a unique global morphism $g : T \\to S$. Moreover, it is clear that $g^{-1}(U) = \\bigcup g_ i^{-1}(U)$. Hence the morphisms $h_{i, U} : g_ i^{-1}(U) \\to X_ U$ glue to a unique morphism $h_ U : g^{-1}(U) \\to X_ U$. It is easy to verify that the system $(g, \\{ h_ U\\} )$ is an element of $F(T)$. Hence $F$ satisfies the sheaf property for the Zariski topology. \n    \n      Next we verify that each $F_ W$, $W \\in \\mathcal{B}$ is representable. Namely, we claim that the transformation of functors \n    \n      \n  \\[  F_ W \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits (-, X_ W), \\  (g, \\{ h_ U\\} ) \\longmapsto h_ W  \\]\n\n    \n       is an isomorphism. To see this suppose that $T$ is a scheme and $\\alpha : T \\to X_ W$ is a morphism. Set $g = f_ W \\circ \\alpha $. For any $U \\in \\mathcal{B}$ such that $U \\subset W$ we can define $h_ U : g^{-1}(U) \\to X_ U$ be the composition $(\\rho ^ W_ U)^{-1} \\circ \\alpha |_{g^{-1}(U)}$. This works because the image $\\alpha (g^{-1}(U))$ is contained in $f_ W^{-1}(U)$ and condition (a) of the lemma. It is clear that $f_ U \\circ h_ U = g|_{g^{-1}(U)}$ for such a $U$. Moreover, if also $V \\in \\mathcal{B}$ and $V \\subset U \\subset W$, then $\\rho ^ U_ V \\circ h_ V = h_ U|_{g^{-1}(V)}$ by property (b) of the lemma. We still have to define $h_ U$ for an arbitrary element $U \\in \\mathcal{B}$. Since $\\mathcal{B}$ is a basis for the topology on $S$ we can find an open covering $U \\cap W = \\bigcup U_ i$ with $U_ i \\in \\mathcal{B}$. Since $g$ maps into $W$ we have $g^{-1}(U) = g^{-1}(U \\cap W) = \\bigcup g^{-1}(U_ i)$. Consider the morphisms $h_ i = \\rho ^ U_{U_ i} \\circ h_{U_ i} : g^{-1}(U_ i) \\to X_ U$. It is a simple matter to use condition (b) of the lemma to prove that $h_ i|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)} = h_ j|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)}$. Hence these morphisms glue to give the desired morphism $h_ U : g^{-1}(U) \\to X_ U$. We omit the (easy) verification that the system $(g, \\{ h_ U\\} )$ is an element of $F_ W(T)$ which maps to $\\alpha $ under the displayed arrow above. \n    \n      Next, we verify each $F_ W \\subset F$ is representable by open immersions. This is clear from the definitions. \n    \n      Finally we have to verify the collection $(F_ W)_{W \\in \\mathcal{B}}$ covers $F$. This is clear by construction and the fact that $\\mathcal{B}$ is a basis for the topology of $S$. \n    \n      Let $X$ be a scheme representing the functor $F$. Let $(f, \\{ i_ U\\} ) \\in F(X)$ be a \xe2\x80\x9cuniversal family\xe2\x80\x9d. Since each $F_ W$ is representable by $X_ W$ (via the morphism of functors displayed above) we see that $i_ W : f^{-1}(W) \\to X_ W$ is an isomorphism as desired. The lemma is proved. \n      $\\square$\n    \n","\n  Lemma 27.2.1. Let $S$ be a scheme. Let $\\mathcal{B}$ be a basis for the topology of $S$. Suppose given the following data: \n  \n  \nFor every $U \\in \\mathcal{B}$ a scheme $f_ U : X_ U \\to U$ over $U$. \n\n\nFor $U, V \\in \\mathcal{B}$ with $V \\subset U$ a morphism $\\rho ^ U_ V : X_ V \\to X_ U$ over $U$. \n\n\n\n   Assume that \n  \n  \neach $\\rho ^ U_ V$ induces an isomorphism $X_ V \\to f_ U^{-1}(V)$ of schemes over $V$, \n\n\nwhenever $W, V, U \\in \\mathcal{B}$, with $W \\subset V \\subset U$ we have $\\rho ^ U_ W = \\rho ^ U_ V \\circ \\rho ^ V_ W$. \n\n\n\n   Then there exists a morphism $f : X \\to S$ of schemes and isomorphisms $i_ U : f^{-1}(U) \\to X_ U$ over $U \\in \\mathcal{B}$ such that for $V, U \\in \\mathcal{B}$ with $V \\subset U$ the composition \n  \n  \\[  \\xymatrix{ X_ V \\ar[r]^{i_ V^{-1}} &  f^{-1}(V) \\ar[rr]^{inclusion} &  &  f^{-1}(U) \\ar[r]^{i_ U} &  X_ U }  \\]\n\n   is the morphism $\\rho ^ U_ V$. Moreover $X$ is unique up to unique isomorphism over $S$. \n\n    \n","Proof.\n      To prove this we will use Schemes, Lemma 26.15.4. First we define a contravariant functor $F$ from the category of schemes to the category of sets. Namely, for a scheme $T$ we set \n    \n      \n  \\[  F(T) = \\left\\{  \\begin{matrix}  (g, \\{ h_ U\\} _{U \\in \\mathcal{B}}), \\  g : T \\to S, \\  h_ U : g^{-1}(U) \\to X_ U, \n\n\\\\  f_ U \\circ h_ U = g|_{g^{-1}(U)}, \\  h_ U|_{g^{-1}(V)} = \\rho ^ U_ V \\circ h_ V \\  \\forall \\  V, U \\in \\mathcal{B}, V \\subset U \n\n\\end{matrix} \\right\\} .  \\]\n\n    \n       The restriction mapping $F(T) \\to F(T\')$ given a morphism $T\' \\to T$ is just gotten by composition. For any $W \\in \\mathcal{B}$ we consider the subfunctor $F_ W \\subset F$ consisting of those systems $(g, \\{ h_ U\\} )$ such that $g(T) \\subset W$. \n    \n      First we show $F$ satisfies the sheaf property for the Zariski topology. Suppose that $T$ is a scheme, $T = \\bigcup V_ i$ is an open covering, and $\\xi _ i \\in F(V_ i)$ is an element such that $\\xi _ i|_{V_ i \\cap V_ j} = \\xi _ j|_{V_ i \\cap V_ j}$. Say $\\xi _ i = (g_ i, \\{ h_{i, U}\\} )$. Then we immediately see that the morphisms $g_ i$ glue to a unique global morphism $g : T \\to S$. Moreover, it is clear that $g^{-1}(U) = \\bigcup g_ i^{-1}(U)$. Hence the morphisms $h_{i, U} : g_ i^{-1}(U) \\to X_ U$ glue to a unique morphism $h_ U : g^{-1}(U) \\to X_ U$. It is easy to verify that the system $(g, \\{ h_ U\\} )$ is an element of $F(T)$. Hence $F$ satisfies the sheaf property for the Zariski topology. \n    \n      Next we verify that each $F_ W$, $W \\in \\mathcal{B}$ is representable. Namely, we claim that the transformation of functors \n    \n      \n  \\[  F_ W \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits (-, X_ W), \\  (g, \\{ h_ U\\} ) \\longmapsto h_ W  \\]\n\n    \n       is an isomorphism. To see this suppose that $T$ is a scheme and $\\alpha : T \\to X_ W$ is a morphism. Set $g = f_ W \\circ \\alpha $. For any $U \\in \\mathcal{B}$ such that $U \\subset W$ we can define $h_ U : g^{-1}(U) \\to X_ U$ be the composition $(\\rho ^ W_ U)^{-1} \\circ \\alpha |_{g^{-1}(U)}$. This works because the image $\\alpha (g^{-1}(U))$ is contained in $f_ W^{-1}(U)$ and condition (a) of the lemma. It is clear that $f_ U \\circ h_ U = g|_{g^{-1}(U)}$ for such a $U$. Moreover, if also $V \\in \\mathcal{B}$ and $V \\subset U \\subset W$, then $\\rho ^ U_ V \\circ h_ V = h_ U|_{g^{-1}(V)}$ by property (b) of the lemma. We still have to define $h_ U$ for an arbitrary element $U \\in \\mathcal{B}$. Since $\\mathcal{B}$ is a basis for the topology on $S$ we can find an open covering $U \\cap W = \\bigcup U_ i$ with $U_ i \\in \\mathcal{B}$. Since $g$ maps into $W$ we have $g^{-1}(U) = g^{-1}(U \\cap W) = \\bigcup g^{-1}(U_ i)$. Consider the morphisms $h_ i = \\rho ^ U_{U_ i} \\circ h_{U_ i} : g^{-1}(U_ i) \\to X_ U$. It is a simple matter to use condition (b) of the lemma to prove that $h_ i|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)} = h_ j|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)}$. Hence these morphisms glue to give the desired morphism $h_ U : g^{-1}(U) \\to X_ U$. We omit the (easy) verification that the system $(g, \\{ h_ U\\} )$ is an element of $F_ W(T)$ which maps to $\\alpha $ under the displayed arrow above. \n    \n      Next, we verify each $F_ W \\subset F$ is representable by open immersions. This is clear from the definitions. \n    \n      Finally we have to verify the collection $(F_ W)_{W \\in \\mathcal{B}}$ covers $F$. This is clear by construction and the fact that $\\mathcal{B}$ is a basis for the topology of $S$. \n    \n      Let $X$ be a scheme representing the functor $F$. Let $(f, \\{ i_ U\\} ) \\in F(X)$ be a \xe2\x80\x9cuniversal family\xe2\x80\x9d. Since each $F_ W$ is representable by $X_ W$ (via the morphism of functors displayed above) we see that $i_ W : f^{-1}(W) \\to X_ W$ is an isomorphism as desired. The lemma is proved. \n      $\\square$\n    \n","
  colimit d.functor
",noncomputable abbrev glued : Scheme.{u} ,"Proof.\n      To prove this we will use Schemes, Lemma 26.15.4 [[\n  Lemma 26.15.4. Let $F$ be a contravariant functor on the category of schemes with values in the category of sets. Suppose that \n  \n  \n$F$ satisfies the sheaf property for the Zariski topology, \n\n\nthere exists a set $I$ and a collection of subfunctors $F_ i \\subset F$ such that \n\n\n  \neach $F_ i$ is representable, \n\n\neach $F_ i \\subset F$ is representable by open immersions, and \n\n\nthe collection $(F_ i)_{i \\in I}$ covers $F$. \n\n\n\n\n\n   Then $F$ is representable. \n\n    \n]]. First we define a contravariant functor $F$ from the category of schemes to the category of sets. Namely, for a scheme $T$ we set \n    \n      \n  \\[  F(T) = \\left\\{  \\begin{matrix}  (g, \\{ h_ U\\} _{U \\in \\mathcal{B}}), \\  g : T \\to S, \\  h_ U : g^{-1}(U) \\to X_ U, \n\n\\\\  f_ U \\circ h_ U = g|_{g^{-1}(U)}, \\  h_ U|_{g^{-1}(V)} = \\rho ^ U_ V \\circ h_ V \\  \\forall \\  V, U \\in \\mathcal{B}, V \\subset U \n\n\\end{matrix} \\right\\} .  \\]\n\n    \n       The restriction mapping $F(T) \\to F(T\')$ given a morphism $T\' \\to T$ is just gotten by composition. For any $W \\in \\mathcal{B}$ we consider the subfunctor $F_ W \\subset F$ consisting of those systems $(g, \\{ h_ U\\} )$ such that $g(T) \\subset W$. \n    \n      First we show $F$ satisfies the sheaf property for the Zariski topology. Suppose that $T$ is a scheme, $T = \\bigcup V_ i$ is an open covering, and $\\xi _ i \\in F(V_ i)$ is an element such that $\\xi _ i|_{V_ i \\cap V_ j} = \\xi _ j|_{V_ i \\cap V_ j}$. Say $\\xi _ i = (g_ i, \\{ h_{i, U}\\} )$. Then we immediately see that the morphisms $g_ i$ glue to a unique global morphism $g : T \\to S$. Moreover, it is clear that $g^{-1}(U) = \\bigcup g_ i^{-1}(U)$. Hence the morphisms $h_{i, U} : g_ i^{-1}(U) \\to X_ U$ glue to a unique morphism $h_ U : g^{-1}(U) \\to X_ U$. It is easy to verify that the system $(g, \\{ h_ U\\} )$ is an element of $F(T)$. Hence $F$ satisfies the sheaf property for the Zariski topology. \n    \n      Next we verify that each $F_ W$, $W \\in \\mathcal{B}$ is representable. Namely, we claim that the transformation of functors \n    \n      \n  \\[  F_ W \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits (-, X_ W), \\  (g, \\{ h_ U\\} ) \\longmapsto h_ W  \\]\n\n    \n       is an isomorphism. To see this suppose that $T$ is a scheme and $\\alpha : T \\to X_ W$ is a morphism. Set $g = f_ W \\circ \\alpha $. For any $U \\in \\mathcal{B}$ such that $U \\subset W$ we can define $h_ U : g^{-1}(U) \\to X_ U$ be the composition $(\\rho ^ W_ U)^{-1} \\circ \\alpha |_{g^{-1}(U)}$. This works because the image $\\alpha (g^{-1}(U))$ is contained in $f_ W^{-1}(U)$ and condition (a) of the lemma. It is clear that $f_ U \\circ h_ U = g|_{g^{-1}(U)}$ for such a $U$. Moreover, if also $V \\in \\mathcal{B}$ and $V \\subset U \\subset W$, then $\\rho ^ U_ V \\circ h_ V = h_ U|_{g^{-1}(V)}$ by property (b) of the lemma. We still have to define $h_ U$ for an arbitrary element $U \\in \\mathcal{B}$. Since $\\mathcal{B}$ is a basis for the topology on $S$ we can find an open covering $U \\cap W = \\bigcup U_ i$ with $U_ i \\in \\mathcal{B}$. Since $g$ maps into $W$ we have $g^{-1}(U) = g^{-1}(U \\cap W) = \\bigcup g^{-1}(U_ i)$. Consider the morphisms $h_ i = \\rho ^ U_{U_ i} \\circ h_{U_ i} : g^{-1}(U_ i) \\to X_ U$. It is a simple matter to use condition (b) of the lemma to prove that $h_ i|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)} = h_ j|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)}$. Hence these morphisms glue to give the desired morphism $h_ U : g^{-1}(U) \\to X_ U$. We omit the (easy) verification that the system $(g, \\{ h_ U\\} )$ is an element of $F_ W(T)$ which maps to $\\alpha $ under the displayed arrow above. \n    \n      Next, we verify each $F_ W \\subset F$ is representable by open immersions. This is clear from the definitions. \n    \n      Finally we have to verify the collection $(F_ W)_{W \\in \\mathcal{B}}$ covers $F$. This is clear by construction and the fact that $\\mathcal{B}$ is a basis for the topology of $S$. \n    \n      Let $X$ be a scheme representing the functor $F$. Let $(f, \\{ i_ U\\} ) \\in F(X)$ be a \xe2\x80\x9cuniversal family\xe2\x80\x9d. Since each $F_ W$ is representable by $X_ W$ (via the morphism of functors displayed above) we see that $i_ W : f^{-1}(W) \\to X_ W$ is an isomorphism as desired. The lemma is proved. \n      $\\square$\n    \n","Proof.\n      To prove this we will use Schemes, Lemma 26.15.4 [[\n  Lemma 26.15.4. Let $F$ be a contravariant functor on the category of schemes with values in the category of sets. Suppose that \n  \n  \n$F$ satisfies the sheaf property for the Zariski topology, \n\n\nthere exists a set $I$ and a collection of subfunctors $F_ i \\subset F$ such that \n\n\n  \neach $F_ i$ is representable, \n\n\neach $F_ i \\subset F$ is representable by open immersions, and \n\n\nthe collection $(F_ i)_{i \\in I}$ covers $F$. \n\n\n\n\n\n   Then $F$ is representable. \n\n    \n]]. First we define a contravariant functor $F$ from the category of schemes to the category of sets. Namely, for a scheme $T$ we set \n    \n      \n  \\[  F(T) = \\left\\{  \\begin{matrix}  (g, \\{ h_ U\\} _{U \\in \\mathcal{B}}), \\  g : T \\to S, \\  h_ U : g^{-1}(U) \\to X_ U, \n\n\\\\  f_ U \\circ h_ U = g|_{g^{-1}(U)}, \\  h_ U|_{g^{-1}(V)} = \\rho ^ U_ V \\circ h_ V \\  \\forall \\  V, U \\in \\mathcal{B}, V \\subset U \n\n\\end{matrix} \\right\\} .  \\]\n\n    \n       The restriction mapping $F(T) \\to F(T\')$ given a morphism $T\' \\to T$ is just gotten by composition. For any $W \\in \\mathcal{B}$ we consider the subfunctor $F_ W \\subset F$ consisting of those systems $(g, \\{ h_ U\\} )$ such that $g(T) \\subset W$. \n    \n      First we show $F$ satisfies the sheaf property for the Zariski topology. Suppose that $T$ is a scheme, $T = \\bigcup V_ i$ is an open covering, and $\\xi _ i \\in F(V_ i)$ is an element such that $\\xi _ i|_{V_ i \\cap V_ j} = \\xi _ j|_{V_ i \\cap V_ j}$. Say $\\xi _ i = (g_ i, \\{ h_{i, U}\\} )$. Then we immediately see that the morphisms $g_ i$ glue to a unique global morphism $g : T \\to S$. Moreover, it is clear that $g^{-1}(U) = \\bigcup g_ i^{-1}(U)$. Hence the morphisms $h_{i, U} : g_ i^{-1}(U) \\to X_ U$ glue to a unique morphism $h_ U : g^{-1}(U) \\to X_ U$. It is easy to verify that the system $(g, \\{ h_ U\\} )$ is an element of $F(T)$. Hence $F$ satisfies the sheaf property for the Zariski topology. \n    \n      Next we verify that each $F_ W$, $W \\in \\mathcal{B}$ is representable. Namely, we claim that the transformation of functors \n    \n      \n  \\[  F_ W \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits (-, X_ W), \\  (g, \\{ h_ U\\} ) \\longmapsto h_ W  \\]\n\n    \n       is an isomorphism. To see this suppose that $T$ is a scheme and $\\alpha : T \\to X_ W$ is a morphism. Set $g = f_ W \\circ \\alpha $. For any $U \\in \\mathcal{B}$ such that $U \\subset W$ we can define $h_ U : g^{-1}(U) \\to X_ U$ be the composition $(\\rho ^ W_ U)^{-1} \\circ \\alpha |_{g^{-1}(U)}$. This works because the image $\\alpha (g^{-1}(U))$ is contained in $f_ W^{-1}(U)$ and condition (a) of the lemma. It is clear that $f_ U \\circ h_ U = g|_{g^{-1}(U)}$ for such a $U$. Moreover, if also $V \\in \\mathcal{B}$ and $V \\subset U \\subset W$, then $\\rho ^ U_ V \\circ h_ V = h_ U|_{g^{-1}(V)}$ by property (b) of the lemma. We still have to define $h_ U$ for an arbitrary element $U \\in \\mathcal{B}$. Since $\\mathcal{B}$ is a basis for the topology on $S$ we can find an open covering $U \\cap W = \\bigcup U_ i$ with $U_ i \\in \\mathcal{B}$. Since $g$ maps into $W$ we have $g^{-1}(U) = g^{-1}(U \\cap W) = \\bigcup g^{-1}(U_ i)$. Consider the morphisms $h_ i = \\rho ^ U_{U_ i} \\circ h_{U_ i} : g^{-1}(U_ i) \\to X_ U$. It is a simple matter to use condition (b) of the lemma to prove that $h_ i|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)} = h_ j|_{g^{-1}(U_ i) \\cap g^{-1}(U_ j)}$. Hence these morphisms glue to give the desired morphism $h_ U : g^{-1}(U) \\to X_ U$. We omit the (easy) verification that the system $(g, \\{ h_ U\\} )$ is an element of $F_ W(T)$ which maps to $\\alpha $ under the displayed arrow above. \n    \n      Next, we verify each $F_ W \\subset F$ is representable by open immersions. This is clear from the definitions. \n    \n      Finally we have to verify the collection $(F_ W)_{W \\in \\mathcal{B}}$ covers $F$. This is clear by construction and the fact that $\\mathcal{B}$ is a basis for the topology of $S$. \n    \n      Let $X$ be a scheme representing the functor $F$. Let $(f, \\{ i_ U\\} ) \\in F(X)$ be a \xe2\x80\x9cuniversal family\xe2\x80\x9d. Since each $F_ W$ is representable by $X_ W$ (via the morphism of functors displayed above) we see that $i_ W : f^{-1}(W) \\to X_ W$ is an isomorphism as desired. The lemma is proved. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is a detailed representability argument for a contravariant functor on schemes using a sheaf condition and an open cover by representable subfunctors (invoking a specific lemma and constructing/gluing data). The formal proof `colimit d.functor` is just an expression invoking a colimit of a functor, with no indication of schemes, sheaf properties, representability, open immersions, or the covering argument. Semantically it proves (or states) something about existence of a colimit, which is unrelated to the representability/gluing content. Structurally there is no correspondence: the informal proof has multiple steps (define F, prove sheaf property, show each F_W representable, open immersion, cover, conclude representable), while the formal proof has none of these components.""}"
24,0BX6,"lemma spread_out_of_isGermInjective [LocallyOfFiniteType sY] {x : X} [X.IsGermInjectiveAt x] {y : Y}
    (e : sX x = sY y) (œÜ : Y.presheaf.stalk y ‚ü∂ X.presheaf.stalk x)
    (h : sY.stalkMap y ‚â´ œÜ =
      S.presheaf.stalkSpecializes (Inseparable.of_eq e).specializes ‚â´ sX.stalkMap x) :
    ‚àÉ (U : X.Opens) (hxU : x ‚àà U) (f : U.toScheme ‚ü∂ Y),
      Spec.map œÜ ‚â´ Y.fromSpecStalk y = U.fromSpecStalkOfMem x hxU ‚â´ f ‚àß
      f ‚â´ sY = U.Œπ ‚â´ sX := by
  obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hxU, -‚ü© :=
    S.isBasis_affineOpens.exists_subset_of_mem_open (Set.mem_univ (sX x)) isOpen_univ
  have hyU : sY y ‚àà U := e ‚ñ∏ hxU
  obtain ‚ü®_, ‚ü®V : Y.Opens, hV, rfl‚ü©, hyV, iVU‚ü© :=
    Y.isBasis_affineOpens.exists_subset_of_mem_open hyU (sY ‚Åª¬π·µÅ U).2
  have : sY.appLE U V iVU ‚â´ Y.presheaf.germ V y hyV ‚â´ œÜ =
      sX.app U ‚â´ X.presheaf.germ (sX ‚Åª¬π·µÅ U) x hxU := by
    rw [Scheme.Hom.appLE, Category.assoc, Y.presheaf.germ_res_assoc,
      ‚Üê Scheme.Hom.germ_stalkMap_assoc, h]
    simp
  obtain ‚ü®W, hxW, œÜ', i, hW, h‚ÇÅ, h‚ÇÇ‚ü© :=
    exists_lift_of_germInjective (R := Œì(S, U)) (A := Œì(Y, V)) (U := sX ‚Åª¬π·µÅ U) (x := x) hxU
    (Y.presheaf.germ _ y hyV ‚â´ œÜ) (sY.appLE U V iVU) (sX.app U)
    (sY.finiteType_appLE hU hV _) this
  refine ‚ü®W, hxW, W.toSpecŒì ‚â´ Spec.map œÜ' ‚â´ hV.fromSpec, ?_, ?_‚ü©
  ¬∑ rw [W.fromSpecStalkOfMem_toSpecŒì_assoc x hxW, ‚Üê Spec.map_comp_assoc, ‚Üê h‚ÇÅ,
      Spec.map_comp, Category.assoc, ‚Üê IsAffineOpen.fromSpecStalk,
      IsAffineOpen.fromSpecStalk_eq_fromSpecStalk]
  ¬∑ simp only [Category.assoc]
    rw [‚Üê IsAffineOpen.SpecMap_appLE_fromSpec sY hU hV iVU, ‚Üê Spec.map_comp_assoc, ‚Üê h‚ÇÇ,
      ‚Üê Scheme.Hom.appLE, ‚Üê hW.isoSpec_hom, IsAffineOpen.SpecMap_appLE_fromSpec sX hU hW i,
      ‚Üê Iso.eq_inv_comp, IsAffineOpen.isoSpec_inv_Œπ_assoc]
",Formal Proof of Stacks Project Tag 0BX6,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/SpreadingOut.lean#L328-L356,Q27041,,29.42.4,lemma,3.0,"['0BX4', '01QL', '0ELP']","\n  Lemma 29.42.4. Let $S$ be a scheme. Let $X$, $Y$ be schemes over $S$. Let $s \\in S$ and $x \\in X$, $y \\in Y$ points over $s$. \n  \n  \nLet $f, g : X \\to Y$ be morphisms over $S$ such that $f(x) = g(x) = y$ and $f^\\sharp _ x = g^\\sharp _ x : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}$. Then there is an open neighbourhood $U \\subset X$ with $f|_ U = g|_ U$ in the following cases \n\n\n  \n$Y$ is locally of finite type over $S$, \n\n\n$X$ is integral, \n\n\n$X$ is locally Noetherian, or \n\n\n$X$ is reduced with finitely many irreducible components. \n\n\n\n\nLet $\\varphi : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}$ be a local $\\mathcal{O}_{S, s}$-algebra map. Then there exists an open neighbourhood $U \\subset X$ of $x$ and a morphism $f : U \\to Y$ mapping $x$ to $y$ with $f^\\sharp _ x = \\varphi $ in the following cases \n\n\n  \n$Y$ is locally of finite presentation over $S$, \n\n\n$Y$ is locally of finite type and $X$ is integral, \n\n\n$Y$ is locally of finite type and $X$ is locally Noetherian, or \n\n\n$Y$ is locally of finite type and $X$ is reduced with finitely many irreducible components. \n\n\n\n\n\n\n    \n      Proof.\n      Proof of (1). We may replace $X$, $Y$, $S$ by suitable affine open neighbourhoods of $x$, $y$, $s$ and reduce to the following algebra problem: given a ring $R$, two $R$-algebra maps $\\varphi , \\psi : B \\to A$ such that \n    \n      \n  \n$R \\to B$ is of finite type, or $A$ is a domain, or $A$ is Noetherian, or $A$ is reduced and has finitely many minimal primes, \n\n\nthe two maps $B \\to A_\\mathfrak p$ are the same for some prime $\\mathfrak p \\subset A$, \n\n\n\n    \n       show that $\\varphi , \\psi $ define the same map $B \\to A_ g$ for a suitable $g \\in A$, $g \\not\\in \\mathfrak p$. If $R \\to B$ is of finite type, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. For each $j$ we can find $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j)$ and $\\psi (t_ j)$ have the same image in $A_{g_ j}$. Then we set $g = \\prod g_ j$. In the other cases (if $A$ is a domain, Noetherian, or reduced with finitely many minimal primes), we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\subset A_\\mathfrak p$. See Algebra, Lemma 10.31.9. Thus the maps $B \\to A_ g$ are equal as desired. \n    \n      Proof of (2). To do this we may replace $X$, $Y$, and $S$ by suitable affine opens. Say $X = \\mathop{\\mathrm{Spec}}(A)$, $Y = \\mathop{\\mathrm{Spec}}(B)$, and $S = \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset A$ be the prime ideal corresponding to $x$. Let $\\mathfrak q \\subset B$ be the prime corresponding to $y$. Then $\\varphi $ is a local $R$-algebra map $\\varphi : B_\\mathfrak q \\to A_\\mathfrak p$. If $R \\to B$ is a ring map of finite presentation, then there exists a $g \\in A \\setminus \\mathfrak p$ and an $R$-algebra map $B \\to A_ g$ such that \n    \n      \n  \\[  \\xymatrix{ B_\\mathfrak q \\ar[r]_\\varphi &  A_\\mathfrak p \\\\  B \\ar[u] \\ar[r] &  A_ g \\ar[u] }  \\]\n\n    \n       commutes, see Algebra, Lemmas 10.127.3 and 10.9.9. The induced morphism $\\mathop{\\mathrm{Spec}}(A_ g) \\to \\mathop{\\mathrm{Spec}}(B)$ works. If $B$ is of finite type over $R$, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. Then we can choose $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j) \\in \\mathop{\\mathrm{Im}}(A_{g_ j} \\to A_\\mathfrak p)$. Thus after replacing $A$ by $A[1/\\prod g_ j]$ we may assume that $B$ maps into the image of $A \\to A_\\mathfrak p$. If we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\to A_\\mathfrak p$ is injective, then we\'ll get the desired $R$-algebra map $B \\to A_ g$. Thus the proof is finished by another application of See Algebra, Lemma 10.31.9. \n      $\\square$\n    \n","\n  Lemma 29.42.4. Let $S$ be a scheme. Let $X$, $Y$ be schemes over $S$. Let $s \\in S$ and $x \\in X$, $y \\in Y$ points over $s$. \n  \n  \nLet $f, g : X \\to Y$ be morphisms over $S$ such that $f(x) = g(x) = y$ and $f^\\sharp _ x = g^\\sharp _ x : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}$. Then there is an open neighbourhood $U \\subset X$ with $f|_ U = g|_ U$ in the following cases \n\n\n  \n$Y$ is locally of finite type over $S$, \n\n\n$X$ is integral, \n\n\n$X$ is locally Noetherian, or \n\n\n$X$ is reduced with finitely many irreducible components. \n\n\n\n\nLet $\\varphi : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}$ be a local $\\mathcal{O}_{S, s}$-algebra map. Then there exists an open neighbourhood $U \\subset X$ of $x$ and a morphism $f : U \\to Y$ mapping $x$ to $y$ with $f^\\sharp _ x = \\varphi $ in the following cases \n\n\n  \n$Y$ is locally of finite presentation over $S$, \n\n\n$Y$ is locally of finite type and $X$ is integral, \n\n\n$Y$ is locally of finite type and $X$ is locally Noetherian, or \n\n\n$Y$ is locally of finite type and $X$ is reduced with finitely many irreducible components. \n\n\n\n\n\n\n    \n","Proof.\n      Proof of (1). We may replace $X$, $Y$, $S$ by suitable affine open neighbourhoods of $x$, $y$, $s$ and reduce to the following algebra problem: given a ring $R$, two $R$-algebra maps $\\varphi , \\psi : B \\to A$ such that \n    \n      \n  \n$R \\to B$ is of finite type, or $A$ is a domain, or $A$ is Noetherian, or $A$ is reduced and has finitely many minimal primes, \n\n\nthe two maps $B \\to A_\\mathfrak p$ are the same for some prime $\\mathfrak p \\subset A$, \n\n\n\n    \n       show that $\\varphi , \\psi $ define the same map $B \\to A_ g$ for a suitable $g \\in A$, $g \\not\\in \\mathfrak p$. If $R \\to B$ is of finite type, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. For each $j$ we can find $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j)$ and $\\psi (t_ j)$ have the same image in $A_{g_ j}$. Then we set $g = \\prod g_ j$. In the other cases (if $A$ is a domain, Noetherian, or reduced with finitely many minimal primes), we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\subset A_\\mathfrak p$. See Algebra, Lemma 10.31.9. Thus the maps $B \\to A_ g$ are equal as desired. \n    \n      Proof of (2). To do this we may replace $X$, $Y$, and $S$ by suitable affine opens. Say $X = \\mathop{\\mathrm{Spec}}(A)$, $Y = \\mathop{\\mathrm{Spec}}(B)$, and $S = \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset A$ be the prime ideal corresponding to $x$. Let $\\mathfrak q \\subset B$ be the prime corresponding to $y$. Then $\\varphi $ is a local $R$-algebra map $\\varphi : B_\\mathfrak q \\to A_\\mathfrak p$. If $R \\to B$ is a ring map of finite presentation, then there exists a $g \\in A \\setminus \\mathfrak p$ and an $R$-algebra map $B \\to A_ g$ such that \n    \n      \n  \\[  \\xymatrix{ B_\\mathfrak q \\ar[r]_\\varphi &  A_\\mathfrak p \\\\  B \\ar[u] \\ar[r] &  A_ g \\ar[u] }  \\]\n\n    \n       commutes, see Algebra, Lemmas 10.127.3 and 10.9.9. The induced morphism $\\mathop{\\mathrm{Spec}}(A_ g) \\to \\mathop{\\mathrm{Spec}}(B)$ works. If $B$ is of finite type over $R$, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. Then we can choose $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j) \\in \\mathop{\\mathrm{Im}}(A_{g_ j} \\to A_\\mathfrak p)$. Thus after replacing $A$ by $A[1/\\prod g_ j]$ we may assume that $B$ maps into the image of $A \\to A_\\mathfrak p$. If we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\to A_\\mathfrak p$ is injective, then we\'ll get the desired $R$-algebra map $B \\to A_ g$. Thus the proof is finished by another application of See Algebra, Lemma 10.31.9. \n      $\\square$\n    \n"," by
  obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hxU, -‚ü© :=
    S.isBasis_affineOpens.exists_subset_of_mem_open (Set.mem_univ (sX x)) isOpen_univ
  have hyU : sY y ‚àà U := e ‚ñ∏ hxU
  obtain ‚ü®_, ‚ü®V : Y.Opens, hV, rfl‚ü©, hyV, iVU‚ü© :=
    Y.isBasis_affineOpens.exists_subset_of_mem_open hyU (sY ‚Åª¬π·µÅ U).2
  have : sY.appLE U V iVU ‚â´ Y.presheaf.germ V y hyV ‚â´ œÜ =
      sX.app U ‚â´ X.presheaf.germ (sX ‚Åª¬π·µÅ U) x hxU := by
    rw [Scheme.Hom.appLE, Category.assoc, Y.presheaf.germ_res_assoc,
      ‚Üê Scheme.Hom.germ_stalkMap_assoc, h]
    simp
  obtain ‚ü®W, hxW, œÜ', i, hW, h‚ÇÅ, h‚ÇÇ‚ü© :=
    exists_lift_of_germInjective (R := Œì(S, U)) (A := Œì(Y, V)) (U := sX ‚Åª¬π·µÅ U) (x := x) hxU
    (Y.presheaf.germ _ y hyV ‚â´ œÜ) (sY.appLE U V iVU) (sX.app U)
    (sY.finiteType_appLE hU hV _) this
  refine ‚ü®W, hxW, W.toSpecŒì ‚â´ Spec.map œÜ' ‚â´ hV.fromSpec, ?_, ?_‚ü©
  ¬∑ rw [W.fromSpecStalkOfMem_toSpecŒì_assoc x hxW, ‚Üê Spec.map_comp_assoc, ‚Üê h‚ÇÅ,
      Spec.map_comp, Category.assoc, ‚Üê IsAffineOpen.fromSpecStalk,
      IsAffineOpen.fromSpecStalk_eq_fromSpecStalk]
  ¬∑ simp only [Category.assoc]
    rw [‚Üê IsAffineOpen.SpecMap_appLE_fromSpec sY hU hV iVU, ‚Üê Spec.map_comp_assoc, ‚Üê h‚ÇÇ,
      ‚Üê Scheme.Hom.appLE, ‚Üê hW.isoSpec_hom, IsAffineOpen.SpecMap_appLE_fromSpec sX hU hW i,
      ‚Üê Iso.eq_inv_comp, IsAffineOpen.isoSpec_inv_Œπ_assoc]
","lemma spread_out_of_isGermInjective [LocallyOfFiniteType sY] {x : X} [X.IsGermInjectiveAt x] {y : Y}
    (e : sX x = sY y) (œÜ : Y.presheaf.stalk y ‚ü∂ X.presheaf.stalk x)
    (h : sY.stalkMap y ‚â´ œÜ =
      S.presheaf.stalkSpecializes (Inseparable.of_eq e).specializes ‚â´ sX.stalkMap x) :
    ‚àÉ (U : X.Opens) (hxU : x ‚àà U) (f : U.toScheme ‚ü∂ Y),
      Spec.map œÜ ‚â´ Y.fromSpecStalk y = U.fromSpecStalkOfMem x hxU ‚â´ f ‚àß
      f ‚â´ sY = U.Œπ ‚â´ sX ","Proof.\n      Proof of (1). We may replace $X$, $Y$, $S$ by suitable affine open neighbourhoods of $x$, $y$, $s$ and reduce to the following algebra problem: given a ring $R$, two $R$-algebra maps $\\varphi , \\psi : B \\to A$ such that \n    \n      \n  \n$R \\to B$ is of finite type, or $A$ is a domain, or $A$ is Noetherian, or $A$ is reduced and has finitely many minimal primes, \n\n\nthe two maps $B \\to A_\\mathfrak p$ are the same for some prime $\\mathfrak p \\subset A$, \n\n\n\n    \n       show that $\\varphi , \\psi $ define the same map $B \\to A_ g$ for a suitable $g \\in A$, $g \\not\\in \\mathfrak p$. If $R \\to B$ is of finite type, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. For each $j$ we can find $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j)$ and $\\psi (t_ j)$ have the same image in $A_{g_ j}$. Then we set $g = \\prod g_ j$. In the other cases (if $A$ is a domain, Noetherian, or reduced with finitely many minimal primes), we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\subset A_\\mathfrak p$. See Algebra, Lemma 10.31.9 [[\n  Lemma 10.31.9. Let $R$ be a ring and $\\mathfrak p \\subset R$ be a prime. There exists an $f \\in R$, $f \\not\\in \\mathfrak p$ such that $R_ f \\to R_\\mathfrak p$ is injective in each of the following cases \n  \n  \n$R$ is a domain, \n\n\n$R$ is Noetherian, or \n\n\n$R$ is reduced and has finitely many minimal primes. \n\n\n\n\n    \n]]. Thus the maps $B \\to A_ g$ are equal as desired. \n    \n      Proof of (2). To do this we may replace $X$, $Y$, and $S$ by suitable affine opens. Say $X = \\mathop{\\mathrm{Spec}}(A)$, $Y = \\mathop{\\mathrm{Spec}}(B)$, and $S = \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset A$ be the prime ideal corresponding to $x$. Let $\\mathfrak q \\subset B$ be the prime corresponding to $y$. Then $\\varphi $ is a local $R$-algebra map $\\varphi : B_\\mathfrak q \\to A_\\mathfrak p$. If $R \\to B$ is a ring map of finite presentation, then there exists a $g \\in A \\setminus \\mathfrak p$ and an $R$-algebra map $B \\to A_ g$ such that \n    \n      \n  \\[  \\xymatrix{ B_\\mathfrak q \\ar[r]_\\varphi &  A_\\mathfrak p \\\\  B \\ar[u] \\ar[r] &  A_ g \\ar[u] }  \\]\n\n    \n       commutes, see Algebra, Lemmas 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] and 10.9.9 [[\n  Lemma 10.9.9. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. Let $M$ be an $R$-module. Then \n  \n  \\[  S^{-1}M = \\mathop{\\mathrm{colim}}\\nolimits _{f \\in S} M_ f  \\]\n\n   where the preorder on $S$ is given by $f \\geq f\' \\Leftrightarrow f = f\'f\'\'$ for some $f\'\' \\in R$ in which case the map $M_{f\'} \\to M_ f$ is given by $m/(f\')^ e \\mapsto m(f\'\')^ e/f^ e$. \n\n    \n]]. The induced morphism $\\mathop{\\mathrm{Spec}}(A_ g) \\to \\mathop{\\mathrm{Spec}}(B)$ works. If $B$ is of finite type over $R$, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. Then we can choose $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j) \\in \\mathop{\\mathrm{Im}}(A_{g_ j} \\to A_\\mathfrak p)$. Thus after replacing $A$ by $A[1/\\prod g_ j]$ we may assume that $B$ maps into the image of $A \\to A_\\mathfrak p$. If we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\to A_\\mathfrak p$ is injective, then we\'ll get the desired $R$-algebra map $B \\to A_ g$. Thus the proof is finished by another application of See Algebra, Lemma 10.31.9 [[\n  Lemma 10.31.9. Let $R$ be a ring and $\\mathfrak p \\subset R$ be a prime. There exists an $f \\in R$, $f \\not\\in \\mathfrak p$ such that $R_ f \\to R_\\mathfrak p$ is injective in each of the following cases \n  \n  \n$R$ is a domain, \n\n\n$R$ is Noetherian, or \n\n\n$R$ is reduced and has finitely many minimal primes. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Proof of (1). We may replace $X$, $Y$, $S$ by suitable affine open neighbourhoods of $x$, $y$, $s$ and reduce to the following algebra problem: given a ring $R$, two $R$-algebra maps $\\varphi , \\psi : B \\to A$ such that \n    \n      \n  \n$R \\to B$ is of finite type, or $A$ is a domain, or $A$ is Noetherian, or $A$ is reduced and has finitely many minimal primes, \n\n\nthe two maps $B \\to A_\\mathfrak p$ are the same for some prime $\\mathfrak p \\subset A$, \n\n\n\n    \n       show that $\\varphi , \\psi $ define the same map $B \\to A_ g$ for a suitable $g \\in A$, $g \\not\\in \\mathfrak p$. If $R \\to B$ is of finite type, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. For each $j$ we can find $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j)$ and $\\psi (t_ j)$ have the same image in $A_{g_ j}$. Then we set $g = \\prod g_ j$. In the other cases (if $A$ is a domain, Noetherian, or reduced with finitely many minimal primes), we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\subset A_\\mathfrak p$. See Algebra, Lemma 10.31.9 [[\n  Lemma 10.31.9. Let $R$ be a ring and $\\mathfrak p \\subset R$ be a prime. There exists an $f \\in R$, $f \\not\\in \\mathfrak p$ such that $R_ f \\to R_\\mathfrak p$ is injective in each of the following cases \n  \n  \n$R$ is a domain, \n\n\n$R$ is Noetherian, or \n\n\n$R$ is reduced and has finitely many minimal primes. \n\n\n\n\n    \n]]. Thus the maps $B \\to A_ g$ are equal as desired. \n    \n      Proof of (2). To do this we may replace $X$, $Y$, and $S$ by suitable affine opens. Say $X = \\mathop{\\mathrm{Spec}}(A)$, $Y = \\mathop{\\mathrm{Spec}}(B)$, and $S = \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset A$ be the prime ideal corresponding to $x$. Let $\\mathfrak q \\subset B$ be the prime corresponding to $y$. Then $\\varphi $ is a local $R$-algebra map $\\varphi : B_\\mathfrak q \\to A_\\mathfrak p$. If $R \\to B$ is a ring map of finite presentation, then there exists a $g \\in A \\setminus \\mathfrak p$ and an $R$-algebra map $B \\to A_ g$ such that \n    \n      \n  \\[  \\xymatrix{ B_\\mathfrak q \\ar[r]_\\varphi &  A_\\mathfrak p \\\\  B \\ar[u] \\ar[r] &  A_ g \\ar[u] }  \\]\n\n    \n       commutes, see Algebra, Lemmas 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]] and 10.9.9 [[\n  Lemma 10.9.9. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. Let $M$ be an $R$-module. Then \n  \n  \\[  S^{-1}M = \\mathop{\\mathrm{colim}}\\nolimits _{f \\in S} M_ f  \\]\n\n   where the preorder on $S$ is given by $f \\geq f\' \\Leftrightarrow f = f\'f\'\'$ for some $f\'\' \\in R$ in which case the map $M_{f\'} \\to M_ f$ is given by $m/(f\')^ e \\mapsto m(f\'\')^ e/f^ e$. \n\n    \n]]. The induced morphism $\\mathop{\\mathrm{Spec}}(A_ g) \\to \\mathop{\\mathrm{Spec}}(B)$ works. If $B$ is of finite type over $R$, let $t_1, \\ldots , t_ m \\in B$ be generators of $B$ as an $R$-algebra. Then we can choose $g_ j \\in A$, $g_ j \\not\\in \\mathfrak p$ such that $\\varphi (t_ j) \\in \\mathop{\\mathrm{Im}}(A_{g_ j} \\to A_\\mathfrak p)$. Thus after replacing $A$ by $A[1/\\prod g_ j]$ we may assume that $B$ maps into the image of $A \\to A_\\mathfrak p$. If we can find a $g \\in A$, $g \\not\\in \\mathfrak p$ such that $A_ g \\to A_\\mathfrak p$ is injective, then we\'ll get the desired $R$-algebra map $B \\to A_ g$. Thus the proof is finished by another application of See Algebra, Lemma 10.31.9 [[\n  Lemma 10.31.9. Let $R$ be a ring and $\\mathfrak p \\subset R$ be a prime. There exists an $f \\in R$, $f \\not\\in \\mathfrak p$ such that $R_ f \\to R_\\mathfrak p$ is injective in each of the following cases \n  \n  \n$R$ is a domain, \n\n\n$R$ is Noetherian, or \n\n\n$R$ is reduced and has finitely many minimal primes. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is proving the same kind of statement as the informal argument in part (2): starting from an equality/compatibility on stalks (a germ-level condition at points x,y) and a finite-type (or finite-presentation‚Äìstyle) hypothesis, it produces an affine open neighborhood W of x and a morphism from W into an affine open neighborhood V of y (built as W.toSpecŒì ‚â´ Spec.map œÜ' ‚â´ hV.fromSpec) such that the induced maps on stalks/restrictions agree. This matches the informal reduction to affines and then lifting a local map B_q ‚Üí A_p to some localization A_g (i.e., shrinking around x).\n\nStructurally, both proofs follow the same pattern: (i) shrink to affine opens around the relevant points (Lean uses isBasis_affineOpens twice to get U and V with V ‚äÜ sY ‚Åª¬π(U)); (ii) translate the stalk/germ compatibility into a commutative diagram involving restriction maps (Lean‚Äôs equation with appLE and presheaf.germ, using Scheme.Hom.germ_stalkMap_assoc); (iii) apply a lifting lemma that uses injectivity of a germ map under a finite-type condition to obtain a smaller neighborhood W and a ring map œÜ' (Lean‚Äôs exists_lift_of_germInjective with sY.finiteType_appLE); (iv) assemble the resulting scheme morphism and verify the required commutativity via rewriting.\n\nThe main mismatch is that the informal proof explicitly discusses several alternative hypotheses (domain/Noetherian/reduced with finitely many minimal primes) and uses Algebra Lemma 10.31.9 and finite presentation lemmas, whereas the Lean proof appears specialized to the finite-type case via sY.finiteType_appLE and an abstract lifting lemma, without reflecting the generator/product-of-g_j construction or the other cases. Hence it is not a perfect structural/complete match, but it is strongly aligned with the finite-type lifting/shrinking core of the informal proof.""}"
25,01J7,"lemma range_fromSpecStalk {x : X} :
    Set.range (X.fromSpecStalk x) = { y | y ‚§≥ x } := by
  ext y
  constructor
  ¬∑ rintro ‚ü®y, rfl‚ü©
    exact ((IsLocalRing.specializes_closedPoint y).map (X.fromSpecStalk x).continuous).trans
      (specializes_of_eq fromSpecStalk_closedPoint)
  ¬∑ rintro (hy : y ‚§≥ x)
    have := fromSpecStalk_closedPoint (x := y)
    rw [‚Üê SpecMap_stalkSpecializes_fromSpecStalk hy] at this
    exact ‚ü®_, this‚ü©
",Formal Proof of Stacks Project Tag 01J7,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Stalk.lean#L178-L188,Q27041,,26.13.2,lemma,3.0,"['01J5', '01H8', '0ELP']","\n  Lemma 26.13.2. Let $X$ be a scheme. Let $x, x\' \\in X$ be points of $X$. Then $x\' \\in X$ is a generalization of $x$ if and only if $x\'$ is in the image of the canonical morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$. \n\n    \n      Proof.\n      A continuous map preserves the relation of specialization/generalization. Since every point of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x})$ is a generalization of the closed point we see every point in the image of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$ is a generalization of $x$. Conversely, suppose that $x\'$ is a generalization of $x$. Choose an affine open neighbourhood $U = \\mathop{\\mathrm{Spec}}(R)$ of $x$. Then $x\' \\in U$. Say $\\mathfrak p \\subset R$ and $\\mathfrak p\' \\subset R$ are the primes corresponding to $x$ and $x\'$. Since $x\'$ is a generalization of $x$ we see that $\\mathfrak p\' \\subset \\mathfrak p$. This means that $\\mathfrak p\'$ is in the image of the morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) = \\mathop{\\mathrm{Spec}}(R_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(R) = U \\subset X$ as desired. \n      $\\square$\n    \n","\n  Lemma 26.13.2. Let $X$ be a scheme. Let $x, x\' \\in X$ be points of $X$. Then $x\' \\in X$ is a generalization of $x$ if and only if $x\'$ is in the image of the canonical morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$. \n\n    \n","Proof.\n      A continuous map preserves the relation of specialization/generalization. Since every point of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x})$ is a generalization of the closed point we see every point in the image of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$ is a generalization of $x$. Conversely, suppose that $x\'$ is a generalization of $x$. Choose an affine open neighbourhood $U = \\mathop{\\mathrm{Spec}}(R)$ of $x$. Then $x\' \\in U$. Say $\\mathfrak p \\subset R$ and $\\mathfrak p\' \\subset R$ are the primes corresponding to $x$ and $x\'$. Since $x\'$ is a generalization of $x$ we see that $\\mathfrak p\' \\subset \\mathfrak p$. This means that $\\mathfrak p\'$ is in the image of the morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) = \\mathop{\\mathrm{Spec}}(R_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(R) = U \\subset X$ as desired. \n      $\\square$\n    \n"," by
  ext y
  constructor
  ¬∑ rintro ‚ü®y, rfl‚ü©
    exact ((IsLocalRing.specializes_closedPoint y).map (X.fromSpecStalk x).continuous).trans
      (specializes_of_eq fromSpecStalk_closedPoint)
  ¬∑ rintro (hy : y ‚§≥ x)
    have := fromSpecStalk_closedPoint (x := y)
    rw [‚Üê SpecMap_stalkSpecializes_fromSpecStalk hy] at this
    exact ‚ü®_, this‚ü©
","lemma range_fromSpecStalk {x : X} :
    Set.range (X.fromSpecStalk x) = { y | y ‚§≥ x } ","Proof.\n      A continuous map preserves the relation of specialization/generalization. Since every point of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x})$ is a generalization of the closed point we see every point in the image of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$ is a generalization of $x$. Conversely, suppose that $x\'$ is a generalization of $x$. Choose an affine open neighbourhood $U = \\mathop{\\mathrm{Spec}}(R)$ of $x$. Then $x\' \\in U$. Say $\\mathfrak p \\subset R$ and $\\mathfrak p\' \\subset R$ are the primes corresponding to $x$ and $x\'$. Since $x\'$ is a generalization of $x$ we see that $\\mathfrak p\' \\subset \\mathfrak p$. This means that $\\mathfrak p\'$ is in the image of the morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) = \\mathop{\\mathrm{Spec}}(R_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(R) = U \\subset X$ as desired. \n      $\\square$\n    \n","Proof.\n      A continuous map preserves the relation of specialization/generalization. Since every point of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x})$ is a generalization of the closed point we see every point in the image of $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$ is a generalization of $x$. Conversely, suppose that $x\'$ is a generalization of $x$. Choose an affine open neighbourhood $U = \\mathop{\\mathrm{Spec}}(R)$ of $x$. Then $x\' \\in U$. Say $\\mathfrak p \\subset R$ and $\\mathfrak p\' \\subset R$ are the primes corresponding to $x$ and $x\'$. Since $x\'$ is a generalization of $x$ we see that $\\mathfrak p\' \\subset \\mathfrak p$. This means that $\\mathfrak p\'$ is in the image of the morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) = \\mathop{\\mathrm{Spec}}(R_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(R) = U \\subset X$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish the same characterization of the image of the map \\(\\mathrm{Spec}(\\mathcal O_{X,x}) \\to X\\): one direction shows any image point specializes appropriately (using that every point of the stalk spectrum specializes to its closed point and that continuous maps preserve specialization), and the other direction shows any generalization/specialization relation \\(y \\rightsquigarrow x\\) comes from a point of \\(\\mathrm{Spec}(\\mathcal O_{X,x})\\). Structurally, the Lean proof mirrors this two-way inclusion via `constructor` and uses lemmas `IsLocalRing.specializes_closedPoint` and `fromSpecStalk_closedPoint` plus `SpecMap_stalkSpecializes_fromSpecStalk` to produce the required preimage, matching the informal ‚Äòconversely‚Äô argument. However, the informal proof‚Äôs explicit affine neighborhood and prime-ideal containment argument is not reflected in the formal proof; Lean instead relies on abstract lemmas encapsulating that affine-local reasoning. So the alignment is strong in meaning and overall structure, but not a close match in the detailed intermediate steps.""}"
26,01KE,"protected lemma eq :
    ValuativeCriterion.Existence = (topologically @SpecializingMap).universally := by
  ext
  constructor
  ¬∑ intro _
    apply MorphismProperty.universally_mono
    ¬∑ apply specializingMap
    ¬∑ rwa [MorphismProperty.IsStableUnderBaseChange.universally_eq]
  ¬∑ apply of_specializingMap
",Formal Proof of Stacks Project Tag 01KE,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ValuativeCriterion.lean#L215-L223,Q27041,,26.20.5,lemma,3.0,"['01KA', '01H8', '0ELP']","\n  Lemma 26.20.5. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nSpecializations lift along any base change of $f$ \n\n\nThe morphism $f$ satisfies the existence part of the valuative criterion. \n\n\n\n\n    \n      Proof.\n      Assume (1) holds. Let a solid diagram as in Definition 26.20.3 be given. In order to find the dotted arrow we may replace $X \\to S$ by $X_{\\mathop{\\mathrm{Spec}}(A)} \\to \\mathop{\\mathrm{Spec}}(A)$ since after all the assumption is stable under base change. Thus we may assume $S = \\mathop{\\mathrm{Spec}}(A)$. Let $x\' \\in X$ be the image of $\\mathop{\\mathrm{Spec}}(K) \\to X$, so that we have $\\kappa (x\') \\subset K$, see Lemma 26.13.3. By assumption there exists a specialization $x\' \\leadsto x$ in $X$ such that $x$ maps to the closed point of $S = \\mathop{\\mathrm{Spec}}(A)$. We get a local ring map $A \\to \\mathcal{O}_{X, x}$ and a ring map $\\mathcal{O}_{X, x} \\to \\kappa (x\')$, see Lemma 26.13.2 and the discussion following Lemma 26.13.3. The composition $A \\to \\mathcal{O}_{X, x} \\to \\kappa (x\') \\to K$ is the given injection $A \\to K$. Since $A \\to \\mathcal{O}_{X, x}$ is local, the image of $\\mathcal{O}_{X, x} \\to K$ dominates $A$ and hence is equal to $A$, by Algebra, Definition 10.50.1. Thus we obtain a ring map $\\mathcal{O}_{X, x} \\to A$ and hence a morphism $\\mathop{\\mathrm{Spec}}(A) \\to X$ (see Lemma 26.13.1 and discussion following it). This proves (2). \n    \n      Conversely, assume (2) holds. It is immediate that the existence part of the valuative criterion holds for any base change $X_{S\'} \\to S\'$ of $f$ by considering the following commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X_{S\'} \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] \\ar@{-->}[rru] &  S\' \\ar[r] &  S }  \\]\n\n    \n       Namely, the more horizontal dotted arrow will lead to the other one by definition of the fibre product. OK, so it clearly suffices to show that specializations lift along $f$. Let $s\' \\leadsto s$ be a specialization in $S$, and let $x\' \\in X$ be a point lying over $s\'$. Apply Lemma 26.20.4 to $s\' \\leadsto s$ and the extension of fields $K = \\kappa (x\')/\\kappa (s\')$. We get a commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[rr] \\ar[d] &  &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[rru] &  \\mathop{\\mathrm{Spec}}(\\mathcal{O}_{S, s}) \\ar[r] &  S }  \\]\n\n    \n       and by condition (2) we get the dotted arrow. The image $x$ of the closed point of $\\mathop{\\mathrm{Spec}}(A)$ in $X$ will be a solution to our problem, i.e., $x$ is a specialization of $x\'$ and maps to $s$. \n      $\\square$\n    \n",\n  Lemma 26.20.5. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nSpecializations lift along any base change of $f$ \n\n\nThe morphism $f$ satisfies the existence part of the valuative criterion. \n\n\n\n\n    \n,"Proof.\n      Assume (1) holds. Let a solid diagram as in Definition 26.20.3 be given. In order to find the dotted arrow we may replace $X \\to S$ by $X_{\\mathop{\\mathrm{Spec}}(A)} \\to \\mathop{\\mathrm{Spec}}(A)$ since after all the assumption is stable under base change. Thus we may assume $S = \\mathop{\\mathrm{Spec}}(A)$. Let $x\' \\in X$ be the image of $\\mathop{\\mathrm{Spec}}(K) \\to X$, so that we have $\\kappa (x\') \\subset K$, see Lemma 26.13.3. By assumption there exists a specialization $x\' \\leadsto x$ in $X$ such that $x$ maps to the closed point of $S = \\mathop{\\mathrm{Spec}}(A)$. We get a local ring map $A \\to \\mathcal{O}_{X, x}$ and a ring map $\\mathcal{O}_{X, x} \\to \\kappa (x\')$, see Lemma 26.13.2 and the discussion following Lemma 26.13.3. The composition $A \\to \\mathcal{O}_{X, x} \\to \\kappa (x\') \\to K$ is the given injection $A \\to K$. Since $A \\to \\mathcal{O}_{X, x}$ is local, the image of $\\mathcal{O}_{X, x} \\to K$ dominates $A$ and hence is equal to $A$, by Algebra, Definition 10.50.1. Thus we obtain a ring map $\\mathcal{O}_{X, x} \\to A$ and hence a morphism $\\mathop{\\mathrm{Spec}}(A) \\to X$ (see Lemma 26.13.1 and discussion following it). This proves (2). \n    \n      Conversely, assume (2) holds. It is immediate that the existence part of the valuative criterion holds for any base change $X_{S\'} \\to S\'$ of $f$ by considering the following commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X_{S\'} \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] \\ar@{-->}[rru] &  S\' \\ar[r] &  S }  \\]\n\n    \n       Namely, the more horizontal dotted arrow will lead to the other one by definition of the fibre product. OK, so it clearly suffices to show that specializations lift along $f$. Let $s\' \\leadsto s$ be a specialization in $S$, and let $x\' \\in X$ be a point lying over $s\'$. Apply Lemma 26.20.4 to $s\' \\leadsto s$ and the extension of fields $K = \\kappa (x\')/\\kappa (s\')$. We get a commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[rr] \\ar[d] &  &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[rru] &  \\mathop{\\mathrm{Spec}}(\\mathcal{O}_{S, s}) \\ar[r] &  S }  \\]\n\n    \n       and by condition (2) we get the dotted arrow. The image $x$ of the closed point of $\\mathop{\\mathrm{Spec}}(A)$ in $X$ will be a solution to our problem, i.e., $x$ is a specialization of $x\'$ and maps to $s$. \n      $\\square$\n    \n"," by
  ext
  constructor
  ¬∑ intro _
    apply MorphismProperty.universally_mono
    ¬∑ apply specializingMap
    ¬∑ rwa [MorphismProperty.IsStableUnderBaseChange.universally_eq]
  ¬∑ apply of_specializingMap
","protected lemma eq :
    ValuativeCriterion.Existence = (topologically @SpecializingMap).universally ","Proof.\n      Assume (1) holds. Let a solid diagram as in Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]] be given. In order to find the dotted arrow we may replace $X \\to S$ by $X_{\\mathop{\\mathrm{Spec}}(A)} \\to \\mathop{\\mathrm{Spec}}(A)$ since after all the assumption is stable under base change. Thus we may assume $S = \\mathop{\\mathrm{Spec}}(A)$. Let $x\' \\in X$ be the image of $\\mathop{\\mathrm{Spec}}(K) \\to X$, so that we have $\\kappa (x\') \\subset K$, see Lemma 26.13.3 [[\n  Lemma 26.13.3. Let $X$ be a scheme. Points of $X$ correspond bijectively to equivalence classes of morphisms from spectra of fields into $X$. Moreover, each equivalence class contains a (unique up to unique isomorphism) smallest element $\\mathop{\\mathrm{Spec}}(\\kappa (x)) \\to X$. \n\n    \n]]. By assumption there exists a specialization $x\' \\leadsto x$ in $X$ such that $x$ maps to the closed point of $S = \\mathop{\\mathrm{Spec}}(A)$. We get a local ring map $A \\to \\mathcal{O}_{X, x}$ and a ring map $\\mathcal{O}_{X, x} \\to \\kappa (x\')$, see Lemma 26.13.2 [[\n  Lemma 26.13.2. Let $X$ be a scheme. Let $x, x\' \\in X$ be points of $X$. Then $x\' \\in X$ is a generalization of $x$ if and only if $x\'$ is in the image of the canonical morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$. \n\n    \n]] and the discussion following Lemma 26.13.3 [[\n  Lemma 26.13.3. Let $X$ be a scheme. Points of $X$ correspond bijectively to equivalence classes of morphisms from spectra of fields into $X$. Moreover, each equivalence class contains a (unique up to unique isomorphism) smallest element $\\mathop{\\mathrm{Spec}}(\\kappa (x)) \\to X$. \n\n    \n]]. The composition $A \\to \\mathcal{O}_{X, x} \\to \\kappa (x\') \\to K$ is the given injection $A \\to K$. Since $A \\to \\mathcal{O}_{X, x}$ is local, the image of $\\mathcal{O}_{X, x} \\to K$ dominates $A$ and hence is equal to $A$, by Algebra, Definition 10.50.1 [[\n  Definition 10.50.1. Valuation rings. \n  \n  \nLet $K$ be a field. Let $A$, $B$ be local rings contained in $K$. We say that $B$ dominates $A$ if $A \\subset B$ and $\\mathfrak m_ A = A \\cap \\mathfrak m_ B$. \n\n\nLet $A$ be a ring. We say $A$ is a valuation ring if $A$ is a local domain and if $A$ is maximal for the relation of domination among local rings contained in the fraction field of $A$. \n\n\nLet $A$ be a valuation ring with fraction field $K$. If $R \\subset K$ is a subring of $K$, then we say $A$ is centered on $R$ if $R \\subset A$. \n\n\n\n]]. Thus we obtain a ring map $\\mathcal{O}_{X, x} \\to A$ and hence a morphism $\\mathop{\\mathrm{Spec}}(A) \\to X$ (see Lemma 26.13.1 [[\n  Lemma 26.13.1. Let $X$ be a scheme. Let $R$ be a local ring. The construction above gives a bijective correspondence between morphisms $\\mathop{\\mathrm{Spec}}(R) \\to X$ and pairs $(x, \\varphi )$ consisting of a point $x \\in X$ and a local homomorphism of local rings $\\varphi : \\mathcal{O}_{X, x} \\to R$. \n\n    \n]] and discussion following it). This proves (2). \n    \n      Conversely, assume (2) holds. It is immediate that the existence part of the valuative criterion holds for any base change $X_{S\'} \\to S\'$ of $f$ by considering the following commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X_{S\'} \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] \\ar@{-->}[rru] &  S\' \\ar[r] &  S }  \\]\n\n    \n       Namely, the more horizontal dotted arrow will lead to the other one by definition of the fibre product. OK, so it clearly suffices to show that specializations lift along $f$. Let $s\' \\leadsto s$ be a specialization in $S$, and let $x\' \\in X$ be a point lying over $s\'$. Apply Lemma 26.20.4 [[\n       \n      \n  Lemma 26.20.4. Let $S$ be a scheme. Let $s\' \\leadsto s$ be a specialization of points of $S$. Then \n  \n  \nthere exists a valuation ring $A$ and a morphism $f : \\mathop{\\mathrm{Spec}}(A) \\to S$ such that the generic point $\\eta $ of $\\mathop{\\mathrm{Spec}}(A)$ maps to $s\'$ and the special point maps to $s$, and \n\n\ngiven a field extension $K/\\kappa (s\')$ we may arrange it so that the extension $\\kappa (\\eta )/\\kappa (s\')$ induced by $f$ is isomorphic to the given extension. \n\n\n\n\n    \n]] to $s\' \\leadsto s$ and the extension of fields $K = \\kappa (x\')/\\kappa (s\')$. We get a commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[rr] \\ar[d] &  &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[rru] &  \\mathop{\\mathrm{Spec}}(\\mathcal{O}_{S, s}) \\ar[r] &  S }  \\]\n\n    \n       and by condition (2) we get the dotted arrow. The image $x$ of the closed point of $\\mathop{\\mathrm{Spec}}(A)$ in $X$ will be a solution to our problem, i.e., $x$ is a specialization of $x\'$ and maps to $s$. \n      $\\square$\n    \n","Proof.\n      Assume (1) holds. Let a solid diagram as in Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]] be given. In order to find the dotted arrow we may replace $X \\to S$ by $X_{\\mathop{\\mathrm{Spec}}(A)} \\to \\mathop{\\mathrm{Spec}}(A)$ since after all the assumption is stable under base change. Thus we may assume $S = \\mathop{\\mathrm{Spec}}(A)$. Let $x\' \\in X$ be the image of $\\mathop{\\mathrm{Spec}}(K) \\to X$, so that we have $\\kappa (x\') \\subset K$, see Lemma 26.13.3 [[\n  Lemma 26.13.3. Let $X$ be a scheme. Points of $X$ correspond bijectively to equivalence classes of morphisms from spectra of fields into $X$. Moreover, each equivalence class contains a (unique up to unique isomorphism) smallest element $\\mathop{\\mathrm{Spec}}(\\kappa (x)) \\to X$. \n\n    \n]]. By assumption there exists a specialization $x\' \\leadsto x$ in $X$ such that $x$ maps to the closed point of $S = \\mathop{\\mathrm{Spec}}(A)$. We get a local ring map $A \\to \\mathcal{O}_{X, x}$ and a ring map $\\mathcal{O}_{X, x} \\to \\kappa (x\')$, see Lemma 26.13.2 [[\n  Lemma 26.13.2. Let $X$ be a scheme. Let $x, x\' \\in X$ be points of $X$. Then $x\' \\in X$ is a generalization of $x$ if and only if $x\'$ is in the image of the canonical morphism $\\mathop{\\mathrm{Spec}}(\\mathcal{O}_{X, x}) \\to X$. \n\n    \n]] and the discussion following Lemma 26.13.3 [[\n  Lemma 26.13.3. Let $X$ be a scheme. Points of $X$ correspond bijectively to equivalence classes of morphisms from spectra of fields into $X$. Moreover, each equivalence class contains a (unique up to unique isomorphism) smallest element $\\mathop{\\mathrm{Spec}}(\\kappa (x)) \\to X$. \n\n    \n]]. The composition $A \\to \\mathcal{O}_{X, x} \\to \\kappa (x\') \\to K$ is the given injection $A \\to K$. Since $A \\to \\mathcal{O}_{X, x}$ is local, the image of $\\mathcal{O}_{X, x} \\to K$ dominates $A$ and hence is equal to $A$, by Algebra, Definition 10.50.1 [[\n  Definition 10.50.1. Valuation rings. \n  \n  \nLet $K$ be a field. Let $A$, $B$ be local rings contained in $K$. We say that $B$ dominates $A$ if $A \\subset B$ and $\\mathfrak m_ A = A \\cap \\mathfrak m_ B$. \n\n\nLet $A$ be a ring. We say $A$ is a valuation ring if $A$ is a local domain and if $A$ is maximal for the relation of domination among local rings contained in the fraction field of $A$. \n\n\nLet $A$ be a valuation ring with fraction field $K$. If $R \\subset K$ is a subring of $K$, then we say $A$ is centered on $R$ if $R \\subset A$. \n\n\n\n]]. Thus we obtain a ring map $\\mathcal{O}_{X, x} \\to A$ and hence a morphism $\\mathop{\\mathrm{Spec}}(A) \\to X$ (see Lemma 26.13.1 [[\n  Lemma 26.13.1. Let $X$ be a scheme. Let $R$ be a local ring. The construction above gives a bijective correspondence between morphisms $\\mathop{\\mathrm{Spec}}(R) \\to X$ and pairs $(x, \\varphi )$ consisting of a point $x \\in X$ and a local homomorphism of local rings $\\varphi : \\mathcal{O}_{X, x} \\to R$. \n\n    \n]] and discussion following it). This proves (2). \n    \n      Conversely, assume (2) holds. It is immediate that the existence part of the valuative criterion holds for any base change $X_{S\'} \\to S\'$ of $f$ by considering the following commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X_{S\'} \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] \\ar@{-->}[rru] &  S\' \\ar[r] &  S }  \\]\n\n    \n       Namely, the more horizontal dotted arrow will lead to the other one by definition of the fibre product. OK, so it clearly suffices to show that specializations lift along $f$. Let $s\' \\leadsto s$ be a specialization in $S$, and let $x\' \\in X$ be a point lying over $s\'$. Apply Lemma 26.20.4 [[\n       \n      \n  Lemma 26.20.4. Let $S$ be a scheme. Let $s\' \\leadsto s$ be a specialization of points of $S$. Then \n  \n  \nthere exists a valuation ring $A$ and a morphism $f : \\mathop{\\mathrm{Spec}}(A) \\to S$ such that the generic point $\\eta $ of $\\mathop{\\mathrm{Spec}}(A)$ maps to $s\'$ and the special point maps to $s$, and \n\n\ngiven a field extension $K/\\kappa (s\')$ we may arrange it so that the extension $\\kappa (\\eta )/\\kappa (s\')$ induced by $f$ is isomorphic to the given extension. \n\n\n\n\n    \n]] to $s\' \\leadsto s$ and the extension of fields $K = \\kappa (x\')/\\kappa (s\')$. We get a commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[rr] \\ar[d] &  &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[rru] &  \\mathop{\\mathrm{Spec}}(\\mathcal{O}_{S, s}) \\ar[r] &  S }  \\]\n\n    \n       and by condition (2) we get the dotted arrow. The image $x$ of the closed point of $\\mathop{\\mathrm{Spec}}(A)$ in $X$ will be a solution to our problem, i.e., $x$ is a specialization of $x\'$ and maps to $s$. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof appears to establish an extensional equivalence (via `ext; constructor`) between two properties, with directions proved using lemmas like `MorphismProperty.universally_mono`, `specializingMap`, `of_specializingMap`, and a rewrite about universal base change stability. This matches only the very high-level shape of the informal proof: an iff with two implications, one using stability under base change and the other using a ‚Äúspecializing map‚Äù style criterion.\n\nHowever, the informal proof‚Äôs content is the valuative criterion/existence of dotted arrows and its equivalence with lifting specializations, involving explicit reductions to a base change, construction of a map Spec(A)‚ÜíX from local ring maps, and the converse using a valuation ring produced from a specialization (Lemma 26.20.4). None of these constructions/lemmas are reflected in the Lean script; the Lean proof is a short wrapper around prepackaged lemmas (`universally_mono`, `specializingMap`, `of_specializingMap`) and a base-change rewrite, without mirroring the valuation-ring argument or the specialization-lifting construction.\n\nStructurally, both are two-direction proofs, but the Lean proof is too abstract and lemma-driven to correspond to the detailed steps of the informal argument. Hence partial alignment in overall goal/shape, but weak correspondence in proof content.""}"
27,01KF,"lemma UniversallyClosed.of_valuativeCriterion [QuasiCompact f]
    (hf : ValuativeCriterion.Existence f) : UniversallyClosed f := by
  rw [eq_valuativeCriterion]
  exact ‚ü®hf, ‚Äπ_‚Ä∫‚ü©
",Formal Proof of Stacks Project Tag 01KF,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ValuativeCriterion.lean#L235-L238,Q27041,Valuative criterion of universal closedness,26.20.6,proposition,3.0,"['01KA', '01H8', '0ELP']",\n  Proposition 26.20.6 (Valuative criterion of universal closedness).  Let $f$ be a quasi-compact morphism of schemes. Then $f$ is universally closed if and only if $f$ satisfies the existence part of the valuative criterion. \n\n    \n      Proof.\n      This is a formal consequence of Lemmas 26.20.2 and 26.20.5 above. \n      $\\square$\n    \n,\n  Proposition 26.20.6 (Valuative criterion of universal closedness).  Let $f$ be a quasi-compact morphism of schemes. Then $f$ is universally closed if and only if $f$ satisfies the existence part of the valuative criterion. \n\n    \n,Proof.\n      This is a formal consequence of Lemmas 26.20.2 and 26.20.5 above. \n      $\\square$\n    \n," by
  rw [eq_valuativeCriterion]
  exact ‚ü®hf, ‚Äπ_‚Ä∫‚ü©
","lemma UniversallyClosed.of_valuativeCriterion [QuasiCompact f]
    (hf : ValuativeCriterion.Existence f) : UniversallyClosed f ","Proof.\n      This is a formal consequence of Lemmas 26.20.2 [[\n  Lemma 26.20.2. Let $f : X \\to S$ be a morphism of schemes. \n  \n  \nIf $f$ is universally closed then specializations lift along any base change of $f$, see Topology, Definition 5.19.4. \n\n\nIf $f$ is quasi-compact and specializations lift along any base change of $f$, then $f$ is universally closed. \n\n\n\n\n    \n]] and 26.20.5 [[\n  Lemma 26.20.5. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nSpecializations lift along any base change of $f$ \n\n\nThe morphism $f$ satisfies the existence part of the valuative criterion. \n\n\n\n\n    \n]] above. \n      $\\square$\n    \n","Proof.\n      This is a formal consequence of Lemmas 26.20.2 [[\n  Lemma 26.20.2. Let $f : X \\to S$ be a morphism of schemes. \n  \n  \nIf $f$ is universally closed then specializations lift along any base change of $f$, see Topology, Definition 5.19.4. \n\n\nIf $f$ is quasi-compact and specializations lift along any base change of $f$, then $f$ is universally closed. \n\n\n\n\n    \n]] and 26.20.5 [[\n  Lemma 26.20.5. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nSpecializations lift along any base change of $f$ \n\n\nThe morphism $f$ satisfies the existence part of the valuative criterion. \n\n\n\n\n    \n]] above. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof rewrites the goal using `eq_valuativeCriterion` and then finishes by providing a pair `‚ü®hf, ‚Äπ_‚Ä∫‚ü©`, i.e. it reduces the statement to an equivalence/characterization involving the valuative criterion and supplies the needed components. This matches the informal proof‚Äôs claim that the result is a formal consequence of two lemmas establishing equivalences between universal closedness, lifting of specializations under base change, and the existence part of the valuative criterion. Structurally, both arguments are ‚Äúby equivalences, then immediate,‚Äù but the Lean proof compresses the two-lemma chain into a single rewrite lemma `eq_valuativeCriterion`, so it does not explicitly mirror the two-step lemma usage. No obvious extraneous content is present, but the correspondence depends on `eq_valuativeCriterion` encapsulating exactly the cited equivalences, hence not perfectly transparent.""}"
28,01L0,"lemma IsSeparated.of_valuativeCriterion [QuasiSeparated f]
    (hf : ValuativeCriterion.Uniqueness f) : IsSeparated f where
  isClosedImmersion_diagonal := by
    suffices h : ValuativeCriterion.Existence (pullback.diagonal f) by
      have := UniversallyClosed.of_valuativeCriterion (pullback.diagonal f) h
      exact .of_isPreimmersion _ (pullback.diagonal f).isClosedMap.isClosed_range
    intro S
    have hc : CommSq S.i‚ÇÅ (Spec.map (CommRingCat.ofHom (algebraMap S.R S.K)))
        f (S.i‚ÇÇ ‚â´ pullback.fst f f ‚â´ f) := ‚ü®by simp [‚Üê S.commSq.w_assoc]‚ü©
    let S' : ValuativeCommSq f := ‚ü®S.R, S.K, S.i‚ÇÅ, S.i‚ÇÇ ‚â´ pullback.fst f f ‚â´ f, hc‚ü©
    have : Subsingleton S'.commSq.LiftStruct := hf S'
    let S'l‚ÇÅ : S'.commSq.LiftStruct := ‚ü®S.i‚ÇÇ ‚â´ pullback.fst f f,
      by simp [S', ‚Üê S.commSq.w_assoc], by simp [S']‚ü©
    let S'l‚ÇÇ : S'.commSq.LiftStruct := ‚ü®S.i‚ÇÇ ‚â´ pullback.snd f f,
      by simp [S', ‚Üê S.commSq.w_assoc], by simp [S', pullback.condition]‚ü©
    have h‚ÇÅ‚ÇÇ : S'l‚ÇÅ = S'l‚ÇÇ := Subsingleton.elim _ _
    constructor
    constructor
    refine ‚ü®S.i‚ÇÇ ‚â´ pullback.fst _ _, ?_, ?_‚ü©
    ¬∑ simp [‚Üê S.commSq.w_assoc]
    ¬∑ simp only [Category.assoc]
      apply IsPullback.hom_ext (IsPullback.of_hasPullback _ _)
      ¬∑ simp
      ¬∑ simp only [Category.assoc, pullback.diagonal_snd, Category.comp_id]
        exact congrArg CommSq.LiftStruct.l h‚ÇÅ‚ÇÇ
",Formal Proof of Stacks Project Tag 01L0,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ValuativeCriterion.lean#L244-L268,Q27041,Valuative criterion separatedness,26.22.2,lemma,3.0,"['01KY', '01H8', '0ELP']","\n        \n      \n  Lemma 26.22.2 (Valuative criterion separatedness). Let $f : X \\to S$ be a morphism. Assume \n  \n  \nthe morphism $f$ is quasi-separated, and \n\n\nthe morphism $f$ satisfies the uniqueness part of the valuative criterion. \n\n\n\n   Then $f$ is separated. \n\n    \n      Proof.\n      By assumption (1), Proposition 26.20.6, and Lemmas 26.21.2 and 26.10.4 we see that it suffices to prove the morphism $\\Delta _{X/S} : X \\to X \\times _ S X$ satisfies the existence part of the valuative criterion. Let a solid commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  X \\times _ S X }  \\]\n\n    \n       be given. The lower right arrow corresponds to a pair of morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ over $S$. By (2) we see that $a = b$. Hence using $a$ as the dotted arrow works. \n      $\\square$\n    \n","\n        \n      \n  Lemma 26.22.2 (Valuative criterion separatedness). Let $f : X \\to S$ be a morphism. Assume \n  \n  \nthe morphism $f$ is quasi-separated, and \n\n\nthe morphism $f$ satisfies the uniqueness part of the valuative criterion. \n\n\n\n   Then $f$ is separated. \n\n    \n","Proof.\n      By assumption (1), Proposition 26.20.6, and Lemmas 26.21.2 and 26.10.4 we see that it suffices to prove the morphism $\\Delta _{X/S} : X \\to X \\times _ S X$ satisfies the existence part of the valuative criterion. Let a solid commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  X \\times _ S X }  \\]\n\n    \n       be given. The lower right arrow corresponds to a pair of morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ over $S$. By (2) we see that $a = b$. Hence using $a$ as the dotted arrow works. \n      $\\square$\n    \n"," by
    suffices h : ValuativeCriterion.Existence (pullback.diagonal f) by
      have := UniversallyClosed.of_valuativeCriterion (pullback.diagonal f) h
      exact .of_isPreimmersion _ (pullback.diagonal f).isClosedMap.isClosed_range
    intro S
    have hc : CommSq S.i‚ÇÅ (Spec.map (CommRingCat.ofHom (algebraMap S.R S.K)))
        f (S.i‚ÇÇ ‚â´ pullback.fst f f ‚â´ f) := ‚ü®by simp [‚Üê S.commSq.w_assoc]‚ü©
    let S' : ValuativeCommSq f := ‚ü®S.R, S.K, S.i‚ÇÅ, S.i‚ÇÇ ‚â´ pullback.fst f f ‚â´ f, hc‚ü©
    have : Subsingleton S'.commSq.LiftStruct := hf S'
    let S'l‚ÇÅ : S'.commSq.LiftStruct := ‚ü®S.i‚ÇÇ ‚â´ pullback.fst f f,
      by simp [S', ‚Üê S.commSq.w_assoc], by simp [S']‚ü©
    let S'l‚ÇÇ : S'.commSq.LiftStruct := ‚ü®S.i‚ÇÇ ‚â´ pullback.snd f f,
      by simp [S', ‚Üê S.commSq.w_assoc], by simp [S', pullback.condition]‚ü©
    have h‚ÇÅ‚ÇÇ : S'l‚ÇÅ = S'l‚ÇÇ := Subsingleton.elim _ _
    constructor
    constructor
    refine ‚ü®S.i‚ÇÇ ‚â´ pullback.fst _ _, ?_, ?_‚ü©
    ¬∑ simp [‚Üê S.commSq.w_assoc]
    ¬∑ simp only [Category.assoc]
      apply IsPullback.hom_ext (IsPullback.of_hasPullback _ _)
      ¬∑ simp
      ¬∑ simp only [Category.assoc, pullback.diagonal_snd, Category.comp_id]
        exact congrArg CommSq.LiftStruct.l h‚ÇÅ‚ÇÇ
","lemma IsSeparated.of_valuativeCriterion [QuasiSeparated f]
    (hf : ValuativeCriterion.Uniqueness f) : IsSeparated f where
  isClosedImmersion_diagonal ","Proof.\n      By assumption (1), Proposition 26.20.6 [[\n  Proposition 26.20.6 (Valuative criterion of universal closedness).  Let $f$ be a quasi-compact morphism of schemes. Then $f$ is universally closed if and only if $f$ satisfies the existence part of the valuative criterion. \n\n    \n]], and Lemmas 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]] and 26.10.4 [[\n  Lemma 26.10.4. Let $f : Y \\to X$ be an immersion of schemes. Then $f$ is a closed immersion if and only if $f(Y) \\subset X$ is a closed subset. \n\n    \n]] we see that it suffices to prove the morphism $\\Delta _{X/S} : X \\to X \\times _ S X$ satisfies the existence part of the valuative criterion. Let a solid commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  X \\times _ S X }  \\]\n\n    \n       be given. The lower right arrow corresponds to a pair of morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ over $S$. By (2) we see that $a = b$. Hence using $a$ as the dotted arrow works. \n      $\\square$\n    \n","Proof.\n      By assumption (1), Proposition 26.20.6 [[\n  Proposition 26.20.6 (Valuative criterion of universal closedness).  Let $f$ be a quasi-compact morphism of schemes. Then $f$ is universally closed if and only if $f$ satisfies the existence part of the valuative criterion. \n\n    \n]], and Lemmas 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]] and 26.10.4 [[\n  Lemma 26.10.4. Let $f : Y \\to X$ be an immersion of schemes. Then $f$ is a closed immersion if and only if $f(Y) \\subset X$ is a closed subset. \n\n    \n]] we see that it suffices to prove the morphism $\\Delta _{X/S} : X \\to X \\times _ S X$ satisfies the existence part of the valuative criterion. Let a solid commutative diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  X \\times _ S X }  \\]\n\n    \n       be given. The lower right arrow corresponds to a pair of morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ over $S$. By (2) we see that $a = b$. Hence using $a$ as the dotted arrow works. \n      $\\square$\n    \n","{""Alignment Score"": ""5"", ""brief_justification"": ""Semantically, both proofs show that to prove the diagonal is a closed immersion it suffices to prove it satisfies the existence part of the valuative criterion, then conclude universal closedness/closed immersion using the facts that the diagonal is an immersion and that an immersion is a closed immersion iff its image is closed. The Lean proof does this by reducing to `ValuativeCriterion.Existence (pullback.diagonal f)`, applying `UniversallyClosed.of_valuativeCriterion` to get the diagonal is universally closed (hence has closed image), and then using `.of_isPreimmersion` plus `isClosed_range` to conclude closed immersion‚Äîmatching the informal citations.\n\nStructurally, the informal argument takes a valuative square into the diagonal, identifies the bottom-right map with a pair of maps `a,b : Spec(A) ‚Üí X`, uses assumption (2) to deduce `a=b`, and chooses `a` as the lift. The Lean proof mirrors this: it converts a square for the diagonal into a `ValuativeCommSq f` square `S'` for `f`, uses `hf` to get `Subsingleton` of lifts (uniqueness), constructs two candidate lifts `S'l‚ÇÅ` and `S'l‚ÇÇ` corresponding to the two projections (the pair `a` and `b`), deduces they are equal by subsingleton elimination (formalizing `a=b`), and then builds the required lift for the diagonal and proves the needed equalities via pullback extensionality. No extraneous steps beyond formal bookkeeping are present.""}"
29,01KZ,"lemma IsSeparated.valuativeCriterion [IsSeparated f] : ValuativeCriterion.Uniqueness f := by
  intro S
  constructor
  rintro ‚ü®l‚ÇÅ, hl‚ÇÅ, hl‚ÇÅ'‚ü© ‚ü®l‚ÇÇ, hl‚ÇÇ, hl‚ÇÇ'‚ü©
  ext : 1
  dsimp at *
  have h := hl‚ÇÅ'.trans hl‚ÇÇ'.symm
  let Z := pullback (pullback.diagonal f) (pullback.lift l‚ÇÅ l‚ÇÇ h)
  let g : Z ‚ü∂ Spec (.of S.R) := pullback.snd _ _
  have : IsClosedImmersion g := MorphismProperty.pullback_snd _ _ inferInstance
  have hZ : IsAffine Z := by
    rw [@HasAffineProperty.iff_of_isAffine @IsClosedImmersion] at this
    exact this.left
  suffices IsIso g by
    rw [‚Üê cancel_epi g]
    conv_lhs => rw [‚Üê pullback.lift_fst l‚ÇÅ l‚ÇÇ h, ‚Üê pullback.condition_assoc]
    conv_rhs => rw [‚Üê pullback.lift_snd l‚ÇÅ l‚ÇÇ h, ‚Üê pullback.condition_assoc]
    simp
  suffices h : Function.Bijective (g.appTop) by
    refine (HasAffineProperty.iff_of_isAffine (P := MorphismProperty.isomorphisms Scheme)).mpr ?_
    exact ‚ü®hZ, (ConcreteCategory.isIso_iff_bijective _).mpr h‚ü©
  constructor
  ¬∑ let l : Spec (.of S.K) ‚ü∂ Z :=
      pullback.lift S.i‚ÇÅ (Spec.map (CommRingCat.ofHom (algebraMap S.R S.K))) (by
        apply IsPullback.hom_ext (IsPullback.of_hasPullback _ _)
        ¬∑ simpa using hl‚ÇÅ.symm
        ¬∑ simpa using hl‚ÇÇ.symm)
    have hg : l ‚â´ g = Spec.map (CommRingCat.ofHom (algebraMap S.R S.K)) :=
      pullback.lift_snd _ _ _
    have : Function.Injective ((l ‚â´ g).appTop) := by
      rw [hg]
      let e := arrowIsoŒìSpecOfIsAffine (CommRingCat.ofHom <| algebraMap S.R S.K)
      let P : MorphismProperty CommRingCat :=
        RingHom.toMorphismProperty <| fun f ‚Ü¶ Function.Injective f
      have : (RingHom.toMorphismProperty <| fun f ‚Ü¶ Function.Injective f).RespectsIso :=
        RingHom.toMorphismProperty_respectsIso_iff.mp RingHom.injective_respectsIso
      change P _
      rw [‚Üê MorphismProperty.arrow_mk_iso_iff (P := P) e]
      exact FaithfulSMul.algebraMap_injective S.R S.K
    rw [Scheme.Hom.comp_appTop] at this
    exact Function.Injective.of_comp this
  ¬∑ rw [@HasAffineProperty.iff_of_isAffine @IsClosedImmersion] at this
    exact this.right
",Formal Proof of Stacks Project Tag 01KZ,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ValuativeCriterion.lean#L271-L313,Q27041,,26.22.1,lemma,3.0,"['01KY', '01H8', '0ELP']","\n  Lemma 26.22.1. Let $f : X \\to S$ be a morphism of schemes. If $f$ is separated, then $f$ satisfies the uniqueness part of the valuative criterion. \n\n    \n      Proof.\n      Let a diagram as in Definition 26.20.3 be given. Suppose there are two morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ fitting into the diagram. Let $Z \\subset \\mathop{\\mathrm{Spec}}(A)$ be the equalizer of $a$ and $b$. By Lemma 26.21.5 this is a closed subscheme of $\\mathop{\\mathrm{Spec}}(A)$. By assumption it contains the generic point of $\\mathop{\\mathrm{Spec}}(A)$. Since $A$ is a domain this implies $Z = \\mathop{\\mathrm{Spec}}(A)$. Hence $a = b$ as desired. \n      $\\square$\n    \n","\n  Lemma 26.22.1. Let $f : X \\to S$ be a morphism of schemes. If $f$ is separated, then $f$ satisfies the uniqueness part of the valuative criterion. \n\n    \n","Proof.\n      Let a diagram as in Definition 26.20.3 be given. Suppose there are two morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ fitting into the diagram. Let $Z \\subset \\mathop{\\mathrm{Spec}}(A)$ be the equalizer of $a$ and $b$. By Lemma 26.21.5 this is a closed subscheme of $\\mathop{\\mathrm{Spec}}(A)$. By assumption it contains the generic point of $\\mathop{\\mathrm{Spec}}(A)$. Since $A$ is a domain this implies $Z = \\mathop{\\mathrm{Spec}}(A)$. Hence $a = b$ as desired. \n      $\\square$\n    \n"," by
  intro S
  constructor
  rintro ‚ü®l‚ÇÅ, hl‚ÇÅ, hl‚ÇÅ'‚ü© ‚ü®l‚ÇÇ, hl‚ÇÇ, hl‚ÇÇ'‚ü©
  ext : 1
  dsimp at *
  have h := hl‚ÇÅ'.trans hl‚ÇÇ'.symm
  let Z := pullback (pullback.diagonal f) (pullback.lift l‚ÇÅ l‚ÇÇ h)
  let g : Z ‚ü∂ Spec (.of S.R) := pullback.snd _ _
  have : IsClosedImmersion g := MorphismProperty.pullback_snd _ _ inferInstance
  have hZ : IsAffine Z := by
    rw [@HasAffineProperty.iff_of_isAffine @IsClosedImmersion] at this
    exact this.left
  suffices IsIso g by
    rw [‚Üê cancel_epi g]
    conv_lhs => rw [‚Üê pullback.lift_fst l‚ÇÅ l‚ÇÇ h, ‚Üê pullback.condition_assoc]
    conv_rhs => rw [‚Üê pullback.lift_snd l‚ÇÅ l‚ÇÇ h, ‚Üê pullback.condition_assoc]
    simp
  suffices h : Function.Bijective (g.appTop) by
    refine (HasAffineProperty.iff_of_isAffine (P := MorphismProperty.isomorphisms Scheme)).mpr ?_
    exact ‚ü®hZ, (ConcreteCategory.isIso_iff_bijective _).mpr h‚ü©
  constructor
  ¬∑ let l : Spec (.of S.K) ‚ü∂ Z :=
      pullback.lift S.i‚ÇÅ (Spec.map (CommRingCat.ofHom (algebraMap S.R S.K))) (by
        apply IsPullback.hom_ext (IsPullback.of_hasPullback _ _)
        ¬∑ simpa using hl‚ÇÅ.symm
        ¬∑ simpa using hl‚ÇÇ.symm)
    have hg : l ‚â´ g = Spec.map (CommRingCat.ofHom (algebraMap S.R S.K)) :=
      pullback.lift_snd _ _ _
    have : Function.Injective ((l ‚â´ g).appTop) := by
      rw [hg]
      let e := arrowIsoŒìSpecOfIsAffine (CommRingCat.ofHom <| algebraMap S.R S.K)
      let P : MorphismProperty CommRingCat :=
        RingHom.toMorphismProperty <| fun f ‚Ü¶ Function.Injective f
      have : (RingHom.toMorphismProperty <| fun f ‚Ü¶ Function.Injective f).RespectsIso :=
        RingHom.toMorphismProperty_respectsIso_iff.mp RingHom.injective_respectsIso
      change P _
      rw [‚Üê MorphismProperty.arrow_mk_iso_iff (P := P) e]
      exact FaithfulSMul.algebraMap_injective S.R S.K
    rw [Scheme.Hom.comp_appTop] at this
    exact Function.Injective.of_comp this
  ¬∑ rw [@HasAffineProperty.iff_of_isAffine @IsClosedImmersion] at this
    exact this.right
",lemma IsSeparated.valuativeCriterion [IsSeparated f] : ValuativeCriterion.Uniqueness f ,"Proof.\n      Let a diagram as in Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]] be given. Suppose there are two morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ fitting into the diagram. Let $Z \\subset \\mathop{\\mathrm{Spec}}(A)$ be the equalizer of $a$ and $b$. By Lemma 26.21.5 [[\n  Lemma 26.21.5. Let $X$, $Y$ be schemes over $S$. Let $a, b : X \\to Y$ be morphisms of schemes over $S$. There exists a largest locally closed subscheme $Z \\subset X$ such that $a|_ Z = b|_ Z$. In fact $Z$ is the equalizer of $(a, b)$. Moreover, if $Y$ is separated over $S$, then $Z$ is a closed subscheme. \n\n    \n]] this is a closed subscheme of $\\mathop{\\mathrm{Spec}}(A)$. By assumption it contains the generic point of $\\mathop{\\mathrm{Spec}}(A)$. Since $A$ is a domain this implies $Z = \\mathop{\\mathrm{Spec}}(A)$. Hence $a = b$ as desired. \n      $\\square$\n    \n","Proof.\n      Let a diagram as in Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]] be given. Suppose there are two morphisms $a, b : \\mathop{\\mathrm{Spec}}(A) \\to X$ fitting into the diagram. Let $Z \\subset \\mathop{\\mathrm{Spec}}(A)$ be the equalizer of $a$ and $b$. By Lemma 26.21.5 [[\n  Lemma 26.21.5. Let $X$, $Y$ be schemes over $S$. Let $a, b : X \\to Y$ be morphisms of schemes over $S$. There exists a largest locally closed subscheme $Z \\subset X$ such that $a|_ Z = b|_ Z$. In fact $Z$ is the equalizer of $(a, b)$. Moreover, if $Y$ is separated over $S$, then $Z$ is a closed subscheme. \n\n    \n]] this is a closed subscheme of $\\mathop{\\mathrm{Spec}}(A)$. By assumption it contains the generic point of $\\mathop{\\mathrm{Spec}}(A)$. Since $A$ is a domain this implies $Z = \\mathop{\\mathrm{Spec}}(A)$. Hence $a = b$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to establish the uniqueness part of the valuative criterion: given two lifts l‚ÇÅ, l‚ÇÇ : Spec(A) ‚Üí X agreeing on the generic point Spec(K), they must be equal. The informal proof does this by forming the equalizer Z ‚äÇ Spec(A), using separatedness to make Z closed, then using that Z contains the generic point and Spec(A) is irreducible (A a domain) to conclude Z = Spec(A), hence a = b.\n\nThe formal proof instead constructs an auxiliary scheme Z as a pullback involving the diagonal (pullback (pullback.diagonal f) (pullback.lift l‚ÇÅ l‚ÇÇ h)), then considers the projection g : Z ‚Üí Spec(R) and proves g is an isomorphism by showing g.appTop is bijective, using that g is a closed immersion (from pullback stability) and an injectivity argument via algebraMap_injective. From IsIso g it deduces l‚ÇÅ = l‚ÇÇ by extensionality and pullback identities.\n\nStructurally, there is partial correspondence: both use the diagonal/closed immersion idea (equalizer via diagonal) and the fact that agreement on the generic point forces global agreement. However, the formal proof does not explicitly use the ‚Äúgeneric point contained in a closed subscheme implies whole Spec(A)‚Äù argument; instead it proves an isomorphism via affine/closed immersion + bijectivity on global sections, which is a different route and introduces extra machinery (HasAffineProperty, appTop bijectivity) not present in the informal proof. Thus the core goal matches, but the method and key intermediate reasoning differ substantially.""}"
30,0BX5,"lemma IsProper.of_valuativeCriterion [QuasiCompact f] [QuasiSeparated f] [LocallyOfFiniteType f]
    (H : ValuativeCriterion f) : IsProper f := by
  rw [eq_valuativeCriterion]
  exact ‚ü®‚ü®‚ü®‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫‚ü©, ‚Äπ_‚Ä∫‚ü©, ‚Äπ_‚Ä∫‚ü©
",Formal Proof of Stacks Project Tag 0BX5,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ValuativeCriterion.lean#L337-L340,Q27041,Valuative criterion for properness,29.42.1,lemma,3.0,"['0BX4', '01QL', '0ELP']","\n        \n      \n  Lemma 29.42.1 (Valuative criterion for properness). Let $S$ be a scheme. Let $f : X \\to Y$ be a morphism of schemes over $S$. Assume $f$ is of finite type and quasi-separated. Then the following are equivalent \n  \n  \n$f$ is proper, \n\n\n$f$ satisfies the valuative criterion (Schemes, Definition 26.20.3), \n\n\ngiven any commutative solid diagram \n\n\n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  Y }  \\]\n\n\n where $A$ is a valuation ring with field of fractions $K$, there exists a unique dotted arrow making the diagram commute. \n\n\n\n\n    \n      Proof.\n      Part (3) is a reformulation of (2). Thus the lemma is a formal consequence of Schemes, Proposition 26.20.6 and Lemma 26.22.2 and the definitions. \n      $\\square$\n    \n","\n        \n      \n  Lemma 29.42.1 (Valuative criterion for properness). Let $S$ be a scheme. Let $f : X \\to Y$ be a morphism of schemes over $S$. Assume $f$ is of finite type and quasi-separated. Then the following are equivalent \n  \n  \n$f$ is proper, \n\n\n$f$ satisfies the valuative criterion (Schemes, Definition 26.20.3), \n\n\ngiven any commutative solid diagram \n\n\n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  Y }  \\]\n\n\n where $A$ is a valuation ring with field of fractions $K$, there exists a unique dotted arrow making the diagram commute. \n\n\n\n\n    \n","Proof.\n      Part (3) is a reformulation of (2). Thus the lemma is a formal consequence of Schemes, Proposition 26.20.6 and Lemma 26.22.2 and the definitions. \n      $\\square$\n    \n"," by
  rw [eq_valuativeCriterion]
  exact ‚ü®‚ü®‚ü®‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫‚ü©, ‚Äπ_‚Ä∫‚ü©, ‚Äπ_‚Ä∫‚ü©
","lemma IsProper.of_valuativeCriterion [QuasiCompact f] [QuasiSeparated f] [LocallyOfFiniteType f]
    (H : ValuativeCriterion f) : IsProper f ","Proof.\n      Part (3) is a reformulation of (2). Thus the lemma is a formal consequence of Schemes, Proposition 26.20.6 [[\n  Proposition 26.20.6 (Valuative criterion of universal closedness).  Let $f$ be a quasi-compact morphism of schemes. Then $f$ is universally closed if and only if $f$ satisfies the existence part of the valuative criterion. \n\n    \n]] and Lemma 26.22.2 [[\n        \n      \n  Lemma 26.22.2 (Valuative criterion separatedness). Let $f : X \\to S$ be a morphism. Assume \n  \n  \nthe morphism $f$ is quasi-separated, and \n\n\nthe morphism $f$ satisfies the uniqueness part of the valuative criterion. \n\n\n\n   Then $f$ is separated. \n\n    \n]] and the definitions. \n      $\\square$\n    \n","Proof.\n      Part (3) is a reformulation of (2). Thus the lemma is a formal consequence of Schemes, Proposition 26.20.6 [[\n  Proposition 26.20.6 (Valuative criterion of universal closedness).  Let $f$ be a quasi-compact morphism of schemes. Then $f$ is universally closed if and only if $f$ satisfies the existence part of the valuative criterion. \n\n    \n]] and Lemma 26.22.2 [[\n        \n      \n  Lemma 26.22.2 (Valuative criterion separatedness). Let $f : X \\to S$ be a morphism. Assume \n  \n  \nthe morphism $f$ is quasi-separated, and \n\n\nthe morphism $f$ satisfies the uniqueness part of the valuative criterion. \n\n\n\n   Then $f$ is separated. \n\n    \n]] and the definitions. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof rewrites the goal using `eq_valuativeCriterion` and then finishes by providing a nested tuple of existing hypotheses (`‚Äπ_‚Ä∫`) to match the reformulated statement. This corresponds to the informal claim that the result is essentially a reformulation and follows formally from definitions/previous results. Structurally, however, the informal proof explicitly cites Proposition 26.20.6 (universal closedness ‚Üî existence part) and Lemma 26.22.2 (uniqueness part + quasi-separated ‚áí separated) and indicates a chain of consequences, while the Lean proof does not show these intermediate steps and instead relies on a single rewrite lemma plus packaging. Thus the formal proof captures the ‚Äúreformulation/definition chasing‚Äù aspect but does not mirror the cited proposition/lemma structure, making the alignment partial rather than perfect.""}"
32,022C,"lemma of_isOpenMap {ùí∞ : S.Cover K} [Scheme.JointlySurjective K] (h : ‚àÄ i, IsOpenMap (ùí∞.f i)) :
    QuasiCompactCover ùí∞.toPreZeroHypercover where
  isCompactOpenCovered_of_isAffineOpen {U} hU := .of_isOpenMap
    (fun i ‚Ü¶ (ùí∞.f i).continuous) h (fun x _ ‚Ü¶ ‚ü®ùí∞.idx x, ùí∞.covers x‚ü©) U.2 hU.isCompact
",Formal Proof of Stacks Project Tag 022C,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Cover/QuasiCompact.lean#L73-L76,Q27041,,34.9.7,lemma,3.0,"['022A', '020K', '0ELP']","\n  Lemma 34.9.7. Any fppf covering is an fpqc covering, and a fortiori, any syntomic, smooth, \xc3\xa9tale or Zariski covering is an fpqc covering. \n\n    \n      Proof.\n      We will show that an fppf covering is an fpqc covering, and then the rest follows from Lemma 34.7.2. Let $\\{ f_ i : U_ i \\to U\\} _{i \\in I}$ be an fppf covering. By definition this means that the $f_ i$ are flat which checks the first condition of Definition 34.9.1. To check the second, let $V \\subset U$ be an affine open subset. Write $f_ i^{-1}(V) = \\bigcup _{j \\in J_ i} V_{ij}$ for some affine opens $V_{ij} \\subset U_ i$. Since each $f_ i$ is open (Morphisms, Lemma 29.25.10), we see that $V = \\bigcup _{i\\in I} \\bigcup _{j \\in J_ i} f_ i(V_{ij})$ is an open covering of $V$. Since $V$ is quasi-compact, this covering has a finite refinement. This finishes the proof. \n      $\\square$\n    \n","\n  Lemma 34.9.7. Any fppf covering is an fpqc covering, and a fortiori, any syntomic, smooth, \xc3\xa9tale or Zariski covering is an fpqc covering. \n\n    \n","Proof.\n      We will show that an fppf covering is an fpqc covering, and then the rest follows from Lemma 34.7.2. Let $\\{ f_ i : U_ i \\to U\\} _{i \\in I}$ be an fppf covering. By definition this means that the $f_ i$ are flat which checks the first condition of Definition 34.9.1. To check the second, let $V \\subset U$ be an affine open subset. Write $f_ i^{-1}(V) = \\bigcup _{j \\in J_ i} V_{ij}$ for some affine opens $V_{ij} \\subset U_ i$. Since each $f_ i$ is open (Morphisms, Lemma 29.25.10), we see that $V = \\bigcup _{i\\in I} \\bigcup _{j \\in J_ i} f_ i(V_{ij})$ is an open covering of $V$. Since $V$ is quasi-compact, this covering has a finite refinement. This finishes the proof. \n      $\\square$\n    \n"," .of_isOpenMap
    (fun i ‚Ü¶ (ùí∞.f i).continuous) h (fun x _ ‚Ü¶ ‚ü®ùí∞.idx x, ùí∞.covers x‚ü©) U.2 hU.isCompact
","lemma of_isOpenMap {ùí∞ : S.Cover K} [Scheme.JointlySurjective K] (h : ‚àÄ i, IsOpenMap (ùí∞.f i)) :
    QuasiCompactCover ùí∞.toPreZeroHypercover where
  isCompactOpenCovered_of_isAffineOpen {U} hU ","Proof.\n      We will show that an fppf covering is an fpqc covering, and then the rest follows from Lemma 34.7.2 [[\n  Lemma 34.7.2. Any syntomic covering is an fppf covering, and a fortiori, any smooth, \xc3\xa9tale, or Zariski covering is an fppf covering. \n\n    \n]]. Let $\\{ f_ i : U_ i \\to U\\} _{i \\in I}$ be an fppf covering. By definition this means that the $f_ i$ are flat which checks the first condition of Definition 34.9.1 [[\n  Definition 34.9.1. Let $T$ be a scheme. An fpqc covering of $T$ is a family of morphisms $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ of schemes such that each $f_ i$ is flat and such that for every affine open $U \\subset T$ there exists $n \\geq 0$, a map $a : \\{ 1, \\ldots , n\\}  \\to I$ and affine opens $V_ j \\subset T_{a(j)}$, $j = 1, \\ldots , n$ with $\\bigcup _{j = 1}^ n f_{a(j)}(V_ j) = U$. \n]]. To check the second, let $V \\subset U$ be an affine open subset. Write $f_ i^{-1}(V) = \\bigcup _{j \\in J_ i} V_{ij}$ for some affine opens $V_{ij} \\subset U_ i$. Since each $f_ i$ is open (Morphisms, Lemma 29.25.10 [[\n  Lemma 29.25.10. A flat morphism locally of finite presentation is universally open. \n\n    \n]]), we see that $V = \\bigcup _{i\\in I} \\bigcup _{j \\in J_ i} f_ i(V_{ij})$ is an open covering of $V$. Since $V$ is quasi-compact, this covering has a finite refinement. This finishes the proof. \n      $\\square$\n    \n","Proof.\n      We will show that an fppf covering is an fpqc covering, and then the rest follows from Lemma 34.7.2 [[\n  Lemma 34.7.2. Any syntomic covering is an fppf covering, and a fortiori, any smooth, \xc3\xa9tale, or Zariski covering is an fppf covering. \n\n    \n]]. Let $\\{ f_ i : U_ i \\to U\\} _{i \\in I}$ be an fppf covering. By definition this means that the $f_ i$ are flat which checks the first condition of Definition 34.9.1 [[\n  Definition 34.9.1. Let $T$ be a scheme. An fpqc covering of $T$ is a family of morphisms $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ of schemes such that each $f_ i$ is flat and such that for every affine open $U \\subset T$ there exists $n \\geq 0$, a map $a : \\{ 1, \\ldots , n\\}  \\to I$ and affine opens $V_ j \\subset T_{a(j)}$, $j = 1, \\ldots , n$ with $\\bigcup _{j = 1}^ n f_{a(j)}(V_ j) = U$. \n]]. To check the second, let $V \\subset U$ be an affine open subset. Write $f_ i^{-1}(V) = \\bigcup _{j \\in J_ i} V_{ij}$ for some affine opens $V_{ij} \\subset U_ i$. Since each $f_ i$ is open (Morphisms, Lemma 29.25.10 [[\n  Lemma 29.25.10. A flat morphism locally of finite presentation is universally open. \n\n    \n]]), we see that $V = \\bigcup _{i\\in I} \\bigcup _{j \\in J_ i} f_ i(V_{ij})$ is an open covering of $V$. Since $V$ is quasi-compact, this covering has a finite refinement. This finishes the proof. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that an fppf covering is fpqc by using that each map is open and then extracting a finite subcover on an affine (quasi-compact) open subset. The formal proof snippet instead applies a lemma `.of_isOpenMap` using continuity of the maps, an `isOpenMap` hypothesis `h`, a choice function giving an index covering each point, and then uses `hU.isCompact` to extract finiteness via compactness. This matches the general topological pattern ‚Äúopen cover + compactness ‚áí finite subcover‚Äù, but it does not reflect the scheme-specific fpqc condition (affine opens, flatness, locally finite presentation, refinement by affine opens) nor the intermediate step ‚Äúfppf ‚áí fpqc‚Äù. Structurally, the informal proof has multiple steps (flatness, openness from a cited lemma, affine refinements, quasi-compactness), while the formal proof is a one-line application of a topological lemma with compactness, omitting most of that structure. Hence only partial alignment: similar compactness/subcover idea, but missing key semantic content and proof structure.""}"
33,03L8,"lemma of_hom {ùí± : PreZeroHypercover.{w'} S} (f : ùí±.Hom ùí∞) [QuasiCompactCover ùí±] :
    QuasiCompactCover ùí∞ := by
  refine ‚ü®fun {U} hU ‚Ü¶ ?_‚ü©
  exact .of_comp (a := f.s‚ÇÄ) (ùí±.f ¬∑) (f.h‚ÇÄ ¬∑)
    (fun _ ‚Ü¶ Scheme.Hom.continuous _) (fun i ‚Ü¶ funext <| by simp [‚Üê Scheme.Hom.comp_apply])
    (fun _ ‚Ü¶ Scheme.Hom.continuous _) U.2 (hU.isCompactOpenCovered ùí±)
",Formal Proof of Stacks Project Tag 03L8,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Cover/QuasiCompact.lean#L84-L89,Q27041,,34.9.5,lemma,3.0,"['022A', '020K', '0ELP']","\n  Lemma 34.9.5. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. Assume that \n  \n  \neach $f_ i$ is flat, and \n\n\nthe family $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ can be refined by an fpqc covering of $T$. \n\n\n\n   Then $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering of $T$. \n\n    \n      Proof.\n      Let $\\{ g_ j : X_ j \\to T\\} _{j \\in J}$ be an fpqc covering refining $\\{ f_ i : T_ i \\to T\\} $. Suppose that $U \\subset T$ is affine open. Choose $j_1, \\ldots , j_ m \\in J$ and $V_ k \\subset X_{j_ k}$ affine open such that $U = \\bigcup g_{j_ k}(V_ k)$. For each $j$ pick $i_ j \\in I$ and a morphism $h_ j : X_ j \\to T_{i_ j}$ such that $g_ j = f_{i_ j} \\circ h_ j$. Since $h_{j_ k}(V_ k)$ is quasi-compact we can find a quasi-compact open $h_{j_ k}(V_ k) \\subset U_ k \\subset f_{i_{j_ k}}^{-1}(U)$. Then $U = \\bigcup f_{i_{j_ k}}(U_ k)$. We conclude that $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n","\n  Lemma 34.9.5. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. Assume that \n  \n  \neach $f_ i$ is flat, and \n\n\nthe family $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ can be refined by an fpqc covering of $T$. \n\n\n\n   Then $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering of $T$. \n\n    \n","Proof.\n      Let $\\{ g_ j : X_ j \\to T\\} _{j \\in J}$ be an fpqc covering refining $\\{ f_ i : T_ i \\to T\\} $. Suppose that $U \\subset T$ is affine open. Choose $j_1, \\ldots , j_ m \\in J$ and $V_ k \\subset X_{j_ k}$ affine open such that $U = \\bigcup g_{j_ k}(V_ k)$. For each $j$ pick $i_ j \\in I$ and a morphism $h_ j : X_ j \\to T_{i_ j}$ such that $g_ j = f_{i_ j} \\circ h_ j$. Since $h_{j_ k}(V_ k)$ is quasi-compact we can find a quasi-compact open $h_{j_ k}(V_ k) \\subset U_ k \\subset f_{i_{j_ k}}^{-1}(U)$. Then $U = \\bigcup f_{i_{j_ k}}(U_ k)$. We conclude that $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n"," by
  refine ‚ü®fun {U} hU ‚Ü¶ ?_‚ü©
  exact .of_comp (a := f.s‚ÇÄ) (ùí±.f ¬∑) (f.h‚ÇÄ ¬∑)
    (fun _ ‚Ü¶ Scheme.Hom.continuous _) (fun i ‚Ü¶ funext <| by simp [‚Üê Scheme.Hom.comp_apply])
    (fun _ ‚Ü¶ Scheme.Hom.continuous _) U.2 (hU.isCompactOpenCovered ùí±)
","lemma of_hom {ùí± : PreZeroHypercover.{w'} S} (f : ùí±.Hom ùí∞) [QuasiCompactCover ùí±] :
    QuasiCompactCover ùí∞ ","Proof.\n      Let $\\{ g_ j : X_ j \\to T\\} _{j \\in J}$ be an fpqc covering refining $\\{ f_ i : T_ i \\to T\\} $. Suppose that $U \\subset T$ is affine open. Choose $j_1, \\ldots , j_ m \\in J$ and $V_ k \\subset X_{j_ k}$ affine open such that $U = \\bigcup g_{j_ k}(V_ k)$. For each $j$ pick $i_ j \\in I$ and a morphism $h_ j : X_ j \\to T_{i_ j}$ such that $g_ j = f_{i_ j} \\circ h_ j$. Since $h_{j_ k}(V_ k)$ is quasi-compact we can find a quasi-compact open $h_{j_ k}(V_ k) \\subset U_ k \\subset f_{i_{j_ k}}^{-1}(U)$. Then $U = \\bigcup f_{i_{j_ k}}(U_ k)$. We conclude that $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Let $\\{ g_ j : X_ j \\to T\\} _{j \\in J}$ be an fpqc covering refining $\\{ f_ i : T_ i \\to T\\} $. Suppose that $U \\subset T$ is affine open. Choose $j_1, \\ldots , j_ m \\in J$ and $V_ k \\subset X_{j_ k}$ affine open such that $U = \\bigcup g_{j_ k}(V_ k)$. For each $j$ pick $i_ j \\in I$ and a morphism $h_ j : X_ j \\to T_{i_ j}$ such that $g_ j = f_{i_ j} \\circ h_ j$. Since $h_{j_ k}(V_ k)$ is quasi-compact we can find a quasi-compact open $h_{j_ k}(V_ k) \\subset U_ k \\subset f_{i_{j_ k}}^{-1}(U)$. Then $U = \\bigcup f_{i_{j_ k}}(U_ k)$. We conclude that $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to show that a family is an fpqc covering by producing, for an affine open U in the target, a finite/quasi-compact open cover of U by images of suitable opens upstairs, using a refinement cover and factorisations through the original family. The Lean proof applies a packaged lemma `.of_comp` with data `(a := f.s‚ÇÄ) (ùí±.f ¬∑) (f.h‚ÇÄ ¬∑)` plus continuity and a compact-open-covered hypothesis `hU.isCompactOpenCovered ùí±`, which corresponds to the informal argument‚Äôs use of a refining cover and compactness/quasi-compactness to extract finitely many pieces covering U.\n\nStructurally, however, the informal proof explicitly constructs indices j_k, affine opens V_k, factorisations g_j = f_i‚àòh_j, then enlarges images to quasi-compact opens U_k ‚äÇ f_i^{-1}(U) and concludes via Lemma 34.9.2. The Lean proof does not mirror these steps; it delegates almost everything to `.of_comp` and a compact-open-covered lemma, with no visible handling of flatness or the specific quasi-compact-open enlargement step. Thus the high-level idea matches, but the detailed structure and some conditions present in the informal proof are not explicitly reflected in the code.""}"
34,022D,"instance [QuasiCompactCover ùí∞] {T : Scheme.{u}} (f : T ‚ü∂ S) :
    QuasiCompactCover (ùí∞.pullback‚ÇÅ f) := by
  refine ‚ü®fun {U'} hU' ‚Ü¶ ?_‚ü©
  wlog h : ‚àÉ (U : S.Opens), IsAffineOpen U ‚àß f '' U' ‚äÜ U generalizing U'
  ¬∑ refine .of_isCompact_of_forall_exists_isCompactOpenCovered hU'.isCompact fun x hxU ‚Ü¶ ?_
    obtain ‚ü®W, hW, hx, _‚ü© := isBasis_iff_nbhd.mp S.isBasis_affineOpens (mem_top (f x))
    obtain ‚ü®W', hW', hx', hle‚ü© := isBasis_iff_nbhd.mp T.isBasis_affineOpens
      (show x ‚àà f ‚Åª¬π·µÅ W ‚äì U' from ‚ü®hx, hxU‚ü©)
    exact ‚ü®W', le_trans hle inf_le_right, by simpa [hx], W'.2,
      this hW' ‚ü®W, hW, by simpa using le_trans hle inf_le_left‚ü©‚ü©
  obtain ‚ü®U, hU, hsub‚ü© := h
  obtain ‚ü®s, hf, V, hc, (heq : _ = (U : Set S))‚ü© := hU.isCompactOpenCovered ùí∞
  refine ‚ü®s, hf, fun i hi ‚Ü¶ pullback.fst f (ùí∞.f i) ‚Åª¬π·µÅ U' ‚äì pullback.snd f (ùí∞.f i) ‚Åª¬π·µÅ (V i hi),
      fun i hi ‚Ü¶ ?_, ?_‚ü©
  ¬∑ exact hU'.isCompact_pullback_inf (hc _ _) hU (by simpa using hsub) <| show _ ‚äÜ _ by
      simpa [‚Üê heq, Set.range_comp] using Set.subset_iUnion_of_subset i
        (Set.subset_iUnion_of_subset hi (Set.subset_preimage_image _ _))
  ¬∑ refine subset_antisymm (by simp) (fun x hx ‚Ü¶ ?_)
    have : f x ‚àà (U : Set S) := hsub ‚ü®x, hx, rfl‚ü©
    simp_rw [‚Üê heq, Set.mem_iUnion] at this
    obtain ‚ü®i, hi, y, hy, heq‚ü© := this
    simp_rw [Set.mem_iUnion]
    obtain ‚ü®z, hzl, hzr‚ü© := Scheme.Pullback.exists_preimage_pullback x y heq.symm
    exact ‚ü®i, hi, z, ‚ü®by simpa [hzl], by simpa [hzr]‚ü©, hzl‚ü©
",Formal Proof of Stacks Project Tag 022D,(3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Cover/QuasiCompact.lean#L93-L116,Q27041,,34.9.8,lemma,3.0,"['022A', '020K', '0ELP']","\n  Lemma 34.9.8. Let $T$ be a scheme. \n  \n  \nIf $T\' \\to T$ is an isomorphism then $\\{ T\' \\to T\\} $ is an fpqc covering of $T$. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ T_{ij} \\to T_ i\\} _{j\\in J_ i}$, then $\\{ T_{ij} \\to T\\} _{i \\in I, j\\in J_ i}$ is an fpqc covering. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes then $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering. \n\n\n\n\n    \n      Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 and 29.25.6). Thus we can apply Lemma 34.9.2 in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n","\n  Lemma 34.9.8. Let $T$ be a scheme. \n  \n  \nIf $T\' \\to T$ is an isomorphism then $\\{ T\' \\to T\\} $ is an fpqc covering of $T$. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ T_{ij} \\to T_ i\\} _{j\\in J_ i}$, then $\\{ T_{ij} \\to T\\} _{i \\in I, j\\in J_ i}$ is an fpqc covering. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes then $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering. \n\n\n\n\n    \n","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 and 29.25.6). Thus we can apply Lemma 34.9.2 in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n"," by
  refine ‚ü®fun {U'} hU' ‚Ü¶ ?_‚ü©
  wlog h : ‚àÉ (U : S.Opens), IsAffineOpen U ‚àß f '' U' ‚äÜ U generalizing U'
  ¬∑ refine .of_isCompact_of_forall_exists_isCompactOpenCovered hU'.isCompact fun x hxU ‚Ü¶ ?_
    obtain ‚ü®W, hW, hx, _‚ü© := isBasis_iff_nbhd.mp S.isBasis_affineOpens (mem_top (f x))
    obtain ‚ü®W', hW', hx', hle‚ü© := isBasis_iff_nbhd.mp T.isBasis_affineOpens
      (show x ‚àà f ‚Åª¬π·µÅ W ‚äì U' from ‚ü®hx, hxU‚ü©)
    exact ‚ü®W', le_trans hle inf_le_right, by simpa [hx], W'.2,
      this hW' ‚ü®W, hW, by simpa using le_trans hle inf_le_left‚ü©‚ü©
  obtain ‚ü®U, hU, hsub‚ü© := h
  obtain ‚ü®s, hf, V, hc, (heq : _ = (U : Set S))‚ü© := hU.isCompactOpenCovered ùí∞
  refine ‚ü®s, hf, fun i hi ‚Ü¶ pullback.fst f (ùí∞.f i) ‚Åª¬π·µÅ U' ‚äì pullback.snd f (ùí∞.f i) ‚Åª¬π·µÅ (V i hi),
      fun i hi ‚Ü¶ ?_, ?_‚ü©
  ¬∑ exact hU'.isCompact_pullback_inf (hc _ _) hU (by simpa using hsub) <| show _ ‚äÜ _ by
      simpa [‚Üê heq, Set.range_comp] using Set.subset_iUnion_of_subset i
        (Set.subset_iUnion_of_subset hi (Set.subset_preimage_image _ _))
  ¬∑ refine subset_antisymm (by simp) (fun x hx ‚Ü¶ ?_)
    have : f x ‚àà (U : Set S) := hsub ‚ü®x, hx, rfl‚ü©
    simp_rw [‚Üê heq, Set.mem_iUnion] at this
    obtain ‚ü®i, hi, y, hy, heq‚ü© := this
    simp_rw [Set.mem_iUnion]
    obtain ‚ü®z, hzl, hzr‚ü© := Scheme.Pullback.exists_preimage_pullback x y heq.symm
    exact ‚ü®i, hi, z, ‚ü®by simpa [hzl], by simpa [hzr]‚ü©, hzl‚ü©
","instance [QuasiCompactCover ùí∞] {T : Scheme.{u}} (f : T ‚ü∂ S) :
    QuasiCompactCover (ùí∞.pullback‚ÇÅ f) ","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.25.6 [[\n  Lemma 29.25.6. The composition of flat morphisms is flat. \n\n    \n]]). Thus we can apply Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]] in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.25.6 [[\n  Lemma 29.25.6. The composition of flat morphisms is flat. \n\n    \n]]). Thus we can apply Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]] in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is proving the base-change stability of an fpqc covering (the user note says the intended statement is part (3)), by showing that for an affine open U' in the base-changed scheme one can find a finite/quasi-compact family of opens in the pullback pieces whose images cover U'. This matches the informal argument for (3): take an affine U' mapping into an affine U, choose quasi-compact opens Ui covering U in the original fpqc family, then the fiber products U'√óU Ui are quasi-compact opens covering U'. Structurally, the Lean code follows the same pattern but in a more topological/Lean-specific way: it uses a wlog reduction to the case where f '' U' lies in an affine open U, then applies an `isCompactOpenCovered` lemma to get a quasi-compact cover of U by members of ùí∞, and constructs the corresponding opens in the pullback via intersections of preimages under `pullback.fst`/`pullback.snd`, finally proving the union equals U' using a pullback preimage existence lemma. The main mismatch is that the informal proof explicitly invokes flatness/base change of flatness and Lemma 34.9.2 to conclude fpqc, while the Lean snippet focuses on the quasi-compact-open covering condition and does not visibly address flatness (likely handled elsewhere in the file/structure). Hence strong but not perfect alignment.""}"
35,022D,"instance {X : Scheme.{u}} (ùí∞ : PreZeroHypercover.{w} X) [QuasiCompactCover ùí∞]
    (f : ‚àÄ (x : ùí∞.I‚ÇÄ), PreZeroHypercover.{w} (ùí∞.X x)) [‚àÄ x, QuasiCompactCover (f x)] :
    QuasiCompactCover (ùí∞.bind f) where
  isCompactOpenCovered_of_isAffineOpen {U} hU := by
    obtain ‚ü®s, hs, V, hcV, hU‚ü© := hU.isCompactOpenCovered ùí∞
    have (i) (hi) : IsCompactOpenCovered ((f i).f ¬∑) (V i hi) :=
      isCompactOpenCovered_of_isCompact (f i) (hcV i hi)
    choose t ht W hcW hV using this
    have : Finite s := hs
    have (i) (hi) : Finite (t i hi) := ht i hi
    refine .of_finite (Œ∫ := Œ£ (i : s), t i.1 i.2) (fun p ‚Ü¶ ‚ü®p.1, p.2‚ü©) (fun p ‚Ü¶ W _ p.1.2 _ p.2.2)
      (fun p ‚Ü¶ hcW ..) ?_
    simpa [‚Üê hV, Set.iUnion_sigma, Set.iUnion_subtype, Set.image_iUnion, Set.image_image] using hU
",Formal Proof of Stacks Project Tag 022D,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Cover/QuasiCompact.lean#L124-L136,Q27041,,34.9.8,lemma,3.0,"['022A', '020K', '0ELP']","\n  Lemma 34.9.8. Let $T$ be a scheme. \n  \n  \nIf $T\' \\to T$ is an isomorphism then $\\{ T\' \\to T\\} $ is an fpqc covering of $T$. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ T_{ij} \\to T_ i\\} _{j\\in J_ i}$, then $\\{ T_{ij} \\to T\\} _{i \\in I, j\\in J_ i}$ is an fpqc covering. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes then $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering. \n\n\n\n\n    \n      Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 and 29.25.6). Thus we can apply Lemma 34.9.2 in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n","\n  Lemma 34.9.8. Let $T$ be a scheme. \n  \n  \nIf $T\' \\to T$ is an isomorphism then $\\{ T\' \\to T\\} $ is an fpqc covering of $T$. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ T_{ij} \\to T_ i\\} _{j\\in J_ i}$, then $\\{ T_{ij} \\to T\\} _{i \\in I, j\\in J_ i}$ is an fpqc covering. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes then $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering. \n\n\n\n\n    \n","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 and 29.25.6). Thus we can apply Lemma 34.9.2 in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n"," by
    obtain ‚ü®s, hs, V, hcV, hU‚ü© := hU.isCompactOpenCovered ùí∞
    have (i) (hi) : IsCompactOpenCovered ((f i).f ¬∑) (V i hi) :=
      isCompactOpenCovered_of_isCompact (f i) (hcV i hi)
    choose t ht W hcW hV using this
    have : Finite s := hs
    have (i) (hi) : Finite (t i hi) := ht i hi
    refine .of_finite (Œ∫ := Œ£ (i : s), t i.1 i.2) (fun p ‚Ü¶ ‚ü®p.1, p.2‚ü©) (fun p ‚Ü¶ W _ p.1.2 _ p.2.2)
      (fun p ‚Ü¶ hcW ..) ?_
    simpa [‚Üê hV, Set.iUnion_sigma, Set.iUnion_subtype, Set.image_iUnion, Set.image_image] using hU
","instance {X : Scheme.{u}} (ùí∞ : PreZeroHypercover.{w} X) [QuasiCompactCover ùí∞]
    (f : ‚àÄ (x : ùí∞.I‚ÇÄ), PreZeroHypercover.{w} (ùí∞.X x)) [‚àÄ x, QuasiCompactCover (f x)] :
    QuasiCompactCover (ùí∞.bind f) where
  isCompactOpenCovered_of_isAffineOpen {U} hU ","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.25.6 [[\n  Lemma 29.25.6. The composition of flat morphisms is flat. \n\n    \n]]). Thus we can apply Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]] in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.25.6 [[\n  Lemma 29.25.6. The composition of flat morphisms is flat. \n\n    \n]]). Thus we can apply Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]] in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the informal proof of part (2): it starts from a compact-open covered decomposition of an affine/compact open U by images f_i(V_i) with only finitely many indices (obtain ‚ü®s, hs, V, hcV, hU‚ü©), then for each i in that finite set refines the cover of V_i by a further compact-open cover coming from the second-stage covering (have IsCompactOpenCovered ‚Ä¶; choose t ht W hcW hV), and finally combines these into a single finite cover indexed by a sigma type Œ£ (i : s), t i.1 i.2, concluding via union/image simp lemmas. Structurally, this mirrors the informal argument: choose quasi-compact opens U_i covering U, then for each i choose quasi-compact opens U_{ij} covering U_i, and conclude the composites cover U. The Lean proof is more topological/compact-open rather than scheme-theoretic/flatness-based, and it does not mention flatness or Lemma 34.9.2 explicitly; those aspects correspond to other parts (1)/(3) in the informal text. Given the user note that we are comparing part (2), the core refinement-of-covers argument aligns well, with only minor mismatch in surrounding context (flatness/affine language absent).""}"
36,022D,"instance {P : MorphismProperty Scheme.{u}} [P.ContainsIdentities] [P.RespectsIso]
    {X Y : Scheme.{u}} {f : X ‚ü∂ Y} [IsIso f] :
    QuasiCompactCover (Scheme.coverOfIsIso (P := P) f).toPreZeroHypercover :=
  of_isOpenMap (fun _ ‚Ü¶ f.homeomorph.isOpenMap)
",Formal Proof of Stacks Project Tag 022D,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Cover/QuasiCompact.lean#L158-L161,Q27041,,34.9.8,lemma,3.0,"['022A', '020K', '0ELP']","\n  Lemma 34.9.8. Let $T$ be a scheme. \n  \n  \nIf $T\' \\to T$ is an isomorphism then $\\{ T\' \\to T\\} $ is an fpqc covering of $T$. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ T_{ij} \\to T_ i\\} _{j\\in J_ i}$, then $\\{ T_{ij} \\to T\\} _{i \\in I, j\\in J_ i}$ is an fpqc covering. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes then $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering. \n\n\n\n\n    \n      Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 and 29.25.6). Thus we can apply Lemma 34.9.2 in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n","\n  Lemma 34.9.8. Let $T$ be a scheme. \n  \n  \nIf $T\' \\to T$ is an isomorphism then $\\{ T\' \\to T\\} $ is an fpqc covering of $T$. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ T_{ij} \\to T_ i\\} _{j\\in J_ i}$, then $\\{ T_{ij} \\to T\\} _{i \\in I, j\\in J_ i}$ is an fpqc covering. \n\n\nIf $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes then $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering. \n\n\n\n\n    \n","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 and 29.25.6). Thus we can apply Lemma 34.9.2 in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2. \n      $\\square$\n    \n"," P) f).toPreZeroHypercover :=
  of_isOpenMap (fun _ ‚Ü¶ f.homeomorph.isOpenMap)
","instance {P : MorphismProperty Scheme.{u}} [P.ContainsIdentities] [P.RespectsIso]
    {X Y : Scheme.{u}} {f : X ‚ü∂ Y} [IsIso f] :
    QuasiCompactCover (Scheme.coverOfIsIso (P ","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.25.6 [[\n  Lemma 29.25.6. The composition of flat morphisms is flat. \n\n    \n]]). Thus we can apply Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]] in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Part (1) is immediate. Recall that the composition of flat morphisms is flat and that the base change of a flat morphism is flat (Morphisms, Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.25.6 [[\n  Lemma 29.25.6. The composition of flat morphisms is flat. \n\n    \n]]). Thus we can apply Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]] in each case to check that our families of morphisms are fpqc coverings. \n    \n      Proof of (2). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and for each $i$ we have an fpqc covering $\\{ f_{ij} : T_{ij} \\to T_ i\\} _{j\\in J_ i}$. Let $U \\subset T$ be an affine open. We can find quasi-compact opens $U_ i \\subset T_ i$ for $i \\in I$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then for each $i$ we can choose quasi-compact opens $U_{ij} \\subset T_{ij}$ for $j \\in J_ i$, almost all empty, with $U_ i = \\bigcup _ j f_{ij}(U_{ij})$. Thus $\\{ T_{ij} \\to T\\} $ is an fpqc covering. \n    \n      Proof of (3). Assume $\\{ T_ i \\to T\\} _{i\\in I}$ is an fpqc covering and $T\' \\to T$ is a morphism of schemes. Let $U\' \\subset T\'$ be an affine open which maps into the affine open $U \\subset T$. Choose quasi-compact opens $U_ i \\subset T_ i$, almost all empty, such that $U = \\bigcup f_ i(U_ i)$. Then $U\' \\times _ U U_ i$ is a quasi-compact open of $T\' \\times _ T T_ i$ and $U\' = \\bigcup \\text{pr}_1(U\' \\times _ U U_ i)$. Since $T\'$ can be covered by such affine opens $U\' \\subset T\'$ we see that $\\{ T\' \\times _ T T_ i \\to T\'\\} _{i\\in I}$ is an fpqc covering by Lemma 34.9.2 [[\n  Lemma 34.9.2. Let $T$ be a scheme. Let $\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ be a family of morphisms of schemes with target $T$. The following are equivalent \n  \n  \n$\\{ f_ i : T_ i \\to T\\} _{i \\in I}$ is an fpqc covering, \n\n\neach $f_ i$ is flat and for every affine open $U \\subset T$ there exist quasi-compact opens $U_ i \\subset T_ i$ which are almost all empty, such that $U = \\bigcup f_ i(U_ i)$, \n\n\neach $f_ i$ is flat and there exists an affine open covering $T = \\bigcup _{\\alpha \\in A} U_\\alpha $ and for each $\\alpha \\in A$ there exist $i_{\\alpha , 1}, \\ldots , i_{\\alpha , n(\\alpha )} \\in I$ and quasi-compact opens $U_{\\alpha , j} \\subset T_{i_{\\alpha , j}}$ such that $U_\\alpha = \\bigcup _{j = 1, \\ldots , n(\\alpha )} f_{i_{\\alpha , j}}(U_{\\alpha , j})$. \n\n\n\n   If $T$ is quasi-separated, these are also equivalent to \n  \n  \neach $f_ i$ is flat, and for every $t \\in T$ there exist $i_1, \\ldots , i_ n \\in I$ and quasi-compact opens $U_ j \\subset T_{i_ j}$ such that $\\bigcup _{j = 1, \\ldots , n} f_{i_ j}(U_ j)$ is a (not necessarily open) neighbourhood of $t$ in $T$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about fpqc coverings of schemes and proves closure properties: (1) immediate using stability of flatness under composition/base change and a characterization lemma; (2) refinement of an fpqc covering is fpqc; (3) base change of an fpqc covering is fpqc. The Lean snippet instead constructs a `toPreZeroHypercover` using `of_isOpenMap` and the fact that a homeomorphism is an open map (`f.homeomorph.isOpenMap`). This is about open maps/topological (hyper)cover data, not flatness/fpqc, and it does not address composition/refinement/base change arguments. Structurally, the informal proof has three parts with explicit covering and quasi-compact open arguments, while the Lean proof is a one-liner invoking an open-map lemma. Hence there is essentially no alignment.""}"
37,01QF,"lemma isAffine_of_isAffineOpen_basicOpen (s : Set Œì(X, ‚ä§))
    (hs : Ideal.span s = ‚ä§) (hs‚ÇÇ : ‚àÄ i ‚àà s, IsAffineOpen (X.basicOpen i)) :
    IsAffine X := by
  have : QuasiSeparatedSpace X := isAffine_of_isAffineOpen_basicOpen_aux s hs hs‚ÇÇ
  have : CompactSpace X := by
    obtain ‚ü®s', hs', e‚ü© := (Ideal.span_eq_top_iff_finite _).mp hs
    rw [‚Üê isCompact_univ_iff, ‚Üê Opens.coe_top, ‚Üê iSup_basicOpen_of_span_eq_top _ _ e]
    simp only [Finset.mem_coe, Opens.iSup_mk, Opens.carrier_eq_coe, Opens.coe_mk]
    apply s'.isCompact_biUnion
    exact fun i hi ‚Ü¶ (hs‚ÇÇ _ (hs' hi)).isCompact
  constructor
  refine HasAffineProperty.of_iSup_eq_top (P := MorphismProperty.isomorphisms Scheme)
    (fun i : s ‚Ü¶ ‚ü®PrimeSpectrum.basicOpen i.1, ?_‚ü©) ?_ (fun i ‚Ü¶ ‚ü®?_, ?_‚ü©)
  ¬∑ change IsAffineOpen _
    simp only [‚Üê basicOpen_eq_of_affine]
    exact (isAffineOpen_top (Scheme.Spec.obj (op _))).basicOpen _
  ¬∑ rw [PrimeSpectrum.iSup_basicOpen_eq_top_iff, Subtype.range_coe_subtype, Set.setOf_mem_eq, hs]
  ¬∑ rw [Scheme.toSpecŒì_preimage_basicOpen]
    exact hs‚ÇÇ _ i.2
  ¬∑ simp only [Opens.map_top, morphismRestrict_app]
    refine IsIso.comp_isIso' ?_ inferInstance
    convert isIso_ŒìSpec_adjunction_unit_app_basicOpen i.1 using 0
    exact congr(IsIso ((ŒìSpec.adjunction.unit.app X).app $(by simp)))
",Formal Proof of Stacks Project Tag 01QF,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Affine.lean#L109-L131,Q27041,,28.27.3,lemma,3.0,"['01QD', '01OH', '0ELP']","\n  Lemma 28.27.3. Let $X$ be a scheme. Suppose that there exist finitely many elements $f_1, \\ldots , f_ n \\in \\Gamma (X, \\mathcal{O}_ X)$ such that \n  \n  \neach $X_{f_ i}$ is an affine open of $X$, and \n\n\nthe ideal generated by $f_1, \\ldots , f_ n$ in $\\Gamma (X, \\mathcal{O}_ X)$ is equal to the unit ideal. \n\n\n\n   Then $X$ is affine. \n\n    \n      Proof.\n      Assume we have $f_1, \\ldots , f_ n$ as in the lemma. We may write $1 = \\sum g_ i f_ i$ for some $g_ j \\in \\Gamma (X, \\mathcal{O}_ X)$ and hence it is clear that $X = \\bigcup X_{f_ i}$. (The $f_ i$\'s cannot all vanish at a point.) Since each $X_{f_ i}$ is quasi-compact (being affine) it follows that $X$ is quasi-compact. Hence we see that $X$ is quasi-affine by Lemma 28.27.1 above. Consider the open immersion \n    \n      \n  \\[  j : X \\to \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)),  \\]\n\n    \n       see Lemma 28.18.4. The inverse image of the standard open $D(f_ i)$ on the right hand side is equal to $X_{f_ i}$ on the left hand side and the morphism $j$ induces an isomorphism $X_{f_ i} \\cong D(f_ i)$, see Lemma 28.18.3. Since the $f_ i$ generate the unit ideal we see that $\\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)) = \\bigcup _{i = 1, \\ldots , n} D(f_ i)$. Thus $j$ is an isomorphism. \n      $\\square$\n    \n","\n  Lemma 28.27.3. Let $X$ be a scheme. Suppose that there exist finitely many elements $f_1, \\ldots , f_ n \\in \\Gamma (X, \\mathcal{O}_ X)$ such that \n  \n  \neach $X_{f_ i}$ is an affine open of $X$, and \n\n\nthe ideal generated by $f_1, \\ldots , f_ n$ in $\\Gamma (X, \\mathcal{O}_ X)$ is equal to the unit ideal. \n\n\n\n   Then $X$ is affine. \n\n    \n","Proof.\n      Assume we have $f_1, \\ldots , f_ n$ as in the lemma. We may write $1 = \\sum g_ i f_ i$ for some $g_ j \\in \\Gamma (X, \\mathcal{O}_ X)$ and hence it is clear that $X = \\bigcup X_{f_ i}$. (The $f_ i$\'s cannot all vanish at a point.) Since each $X_{f_ i}$ is quasi-compact (being affine) it follows that $X$ is quasi-compact. Hence we see that $X$ is quasi-affine by Lemma 28.27.1 above. Consider the open immersion \n    \n      \n  \\[  j : X \\to \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)),  \\]\n\n    \n       see Lemma 28.18.4. The inverse image of the standard open $D(f_ i)$ on the right hand side is equal to $X_{f_ i}$ on the left hand side and the morphism $j$ induces an isomorphism $X_{f_ i} \\cong D(f_ i)$, see Lemma 28.18.3. Since the $f_ i$ generate the unit ideal we see that $\\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)) = \\bigcup _{i = 1, \\ldots , n} D(f_ i)$. Thus $j$ is an isomorphism. \n      $\\square$\n    \n"," by
  have : QuasiSeparatedSpace X := isAffine_of_isAffineOpen_basicOpen_aux s hs hs‚ÇÇ
  have : CompactSpace X := by
    obtain ‚ü®s', hs', e‚ü© := (Ideal.span_eq_top_iff_finite _).mp hs
    rw [‚Üê isCompact_univ_iff, ‚Üê Opens.coe_top, ‚Üê iSup_basicOpen_of_span_eq_top _ _ e]
    simp only [Finset.mem_coe, Opens.iSup_mk, Opens.carrier_eq_coe, Opens.coe_mk]
    apply s'.isCompact_biUnion
    exact fun i hi ‚Ü¶ (hs‚ÇÇ _ (hs' hi)).isCompact
  constructor
  refine HasAffineProperty.of_iSup_eq_top (P := MorphismProperty.isomorphisms Scheme)
    (fun i : s ‚Ü¶ ‚ü®PrimeSpectrum.basicOpen i.1, ?_‚ü©) ?_ (fun i ‚Ü¶ ‚ü®?_, ?_‚ü©)
  ¬∑ change IsAffineOpen _
    simp only [‚Üê basicOpen_eq_of_affine]
    exact (isAffineOpen_top (Scheme.Spec.obj (op _))).basicOpen _
  ¬∑ rw [PrimeSpectrum.iSup_basicOpen_eq_top_iff, Subtype.range_coe_subtype, Set.setOf_mem_eq, hs]
  ¬∑ rw [Scheme.toSpecŒì_preimage_basicOpen]
    exact hs‚ÇÇ _ i.2
  ¬∑ simp only [Opens.map_top, morphismRestrict_app]
    refine IsIso.comp_isIso' ?_ inferInstance
    convert isIso_ŒìSpec_adjunction_unit_app_basicOpen i.1 using 0
    exact congr(IsIso ((ŒìSpec.adjunction.unit.app X).app $(by simp)))
","lemma isAffine_of_isAffineOpen_basicOpen (s : Set Œì(X, ‚ä§))
    (hs : Ideal.span s = ‚ä§) (hs‚ÇÇ : ‚àÄ i ‚àà s, IsAffineOpen (X.basicOpen i)) :
    IsAffine X ","Proof.\n      Assume we have $f_1, \\ldots , f_ n$ as in the lemma. We may write $1 = \\sum g_ i f_ i$ for some $g_ j \\in \\Gamma (X, \\mathcal{O}_ X)$ and hence it is clear that $X = \\bigcup X_{f_ i}$. (The $f_ i$\'s cannot all vanish at a point.) Since each $X_{f_ i}$ is quasi-compact (being affine) it follows that $X$ is quasi-compact. Hence we see that $X$ is quasi-affine by Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]] above. Consider the open immersion \n    \n      \n  \\[  j : X \\to \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)),  \\]\n\n    \n       see Lemma 28.18.4 [[\n  Lemma 28.18.4. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if the canonical morphism \n  \n  \\[  X \\longrightarrow \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X))  \\]\n\n   from Schemes, Lemma 26.6.4 is a quasi-compact open immersion. \n\n    \n]]. The inverse image of the standard open $D(f_ i)$ on the right hand side is equal to $X_{f_ i}$ on the left hand side and the morphism $j$ induces an isomorphism $X_{f_ i} \\cong D(f_ i)$, see Lemma 28.18.3 [[\n  Lemma 28.18.3. Let $X$ be a scheme. Let $f \\in \\Gamma (X, \\mathcal{O}_ X)$. Assume $X$ is quasi-compact and quasi-separated and assume that $X_ f$ is affine. Then the canonical morphism \n  \n  \\[  j : X \\longrightarrow \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X))  \\]\n\n   from Schemes, Lemma 26.6.4 induces an isomorphism of $X_ f = j^{-1}(D(f))$ onto the standard affine open $D(f) \\subset \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X))$. \n\n    \n]]. Since the $f_ i$ generate the unit ideal we see that $\\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)) = \\bigcup _{i = 1, \\ldots , n} D(f_ i)$. Thus $j$ is an isomorphism. \n      $\\square$\n    \n","Proof.\n      Assume we have $f_1, \\ldots , f_ n$ as in the lemma. We may write $1 = \\sum g_ i f_ i$ for some $g_ j \\in \\Gamma (X, \\mathcal{O}_ X)$ and hence it is clear that $X = \\bigcup X_{f_ i}$. (The $f_ i$\'s cannot all vanish at a point.) Since each $X_{f_ i}$ is quasi-compact (being affine) it follows that $X$ is quasi-compact. Hence we see that $X$ is quasi-affine by Lemma 28.27.1 [[\n  Lemma 28.27.1. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if $\\mathcal{O}_ X$ is ample. \n\n    \n]] above. Consider the open immersion \n    \n      \n  \\[  j : X \\to \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)),  \\]\n\n    \n       see Lemma 28.18.4 [[\n  Lemma 28.18.4. Let $X$ be a scheme. Then $X$ is quasi-affine if and only if the canonical morphism \n  \n  \\[  X \\longrightarrow \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X))  \\]\n\n   from Schemes, Lemma 26.6.4 is a quasi-compact open immersion. \n\n    \n]]. The inverse image of the standard open $D(f_ i)$ on the right hand side is equal to $X_{f_ i}$ on the left hand side and the morphism $j$ induces an isomorphism $X_{f_ i} \\cong D(f_ i)$, see Lemma 28.18.3 [[\n  Lemma 28.18.3. Let $X$ be a scheme. Let $f \\in \\Gamma (X, \\mathcal{O}_ X)$. Assume $X$ is quasi-compact and quasi-separated and assume that $X_ f$ is affine. Then the canonical morphism \n  \n  \\[  j : X \\longrightarrow \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X))  \\]\n\n   from Schemes, Lemma 26.6.4 induces an isomorphism of $X_ f = j^{-1}(D(f))$ onto the standard affine open $D(f) \\subset \\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X))$. \n\n    \n]]. Since the $f_ i$ generate the unit ideal we see that $\\mathop{\\mathrm{Spec}}(\\Gamma (X, \\mathcal{O}_ X)) = \\bigcup _{i = 1, \\ldots , n} D(f_ i)$. Thus $j$ is an isomorphism. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs follow the same strategy: from a finite set of global sections whose basic opens cover (span = ‚ä§), deduce quasi-compactness/compactness of X via a finite union of compact basic opens; then use the canonical map j : X ‚Üí Spec Œì(X) and show it is an isomorphism by checking it is an isomorphism on a covering by standard/basic opens D(f). The Lean proof explicitly extracts a finite subset s' from the span=‚ä§ hypothesis, rewrites univ as an iSup/union of basic opens, and proves CompactSpace X by finite biUnion of isCompact basic opens, matching the informal ‚ÄúX = ‚ãÉ X_{f_i} and each is quasi-compact hence X is quasi-compact‚Äù. Structurally, Lean then applies an affine-property/local-isomorphism criterion (HasAffineProperty.of_iSup_eq_top for isomorphisms) on the cover by basic opens, and uses the lemma identifying the restriction of the unit map with the ŒìSpec adjunction unit on basic opens, matching the informal use of Lemma 28.18.3 that j induces isomorphisms X_{f_i} ‚âÖ D(f_i). The main mismatch is that the informal proof explicitly goes through ‚Äòquasi-affine ‚áî ample‚Äô and ‚Äòquasi-affine ‚áî j is quasi-compact open immersion‚Äô before concluding j is an isomorphism, whereas the Lean proof bypasses these intermediate lemmas and instead directly proves the global morphism is an isomorphism from local isomorphisms on a cover. So the core meaning aligns well, but the intermediate narrative (ample/quasi-affine/open immersion) is not reflected in the formal proof.""}"
38,04DE,"lemma isAffineHom_of_isInducing
    (hf‚ÇÅ : Topology.IsInducing f)
    (hf‚ÇÇ : IsClosed (Set.range f)) :
    IsAffineHom f := by
  apply isAffineHom_of_forall_exists_isAffineOpen
  intro y
  by_cases hy : y ‚àà Set.range f
  ¬∑ obtain ‚ü®x, rfl‚ü© := hy
    obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hxU, -‚ü© :=
      Y.isBasis_affineOpens.exists_subset_of_mem_open (Set.mem_univ (f x)) isOpen_univ
    obtain ‚ü®_, ‚ü®V, hV, rfl‚ü©, hxV, hVU‚ü© :=
      X.isBasis_affineOpens.exists_subset_of_mem_open hxU (f ‚Åª¬π·µÅ U).isOpen
    obtain ‚ü®U', hU'U, rfl‚ü© : ‚àÉ U' : Y.Opens, U' ‚â§ U ‚àß f ‚Åª¬π·µÅ U' = V := by
      obtain ‚ü®U', hU', e‚ü© := hf‚ÇÅ.isOpen_iff.mp V.2
      exact ‚ü®‚ü®U', hU'‚ü© ‚äì U, inf_le_right, Opens.ext (by simpa [e] using hVU)‚ü©
    obtain ‚ü®r, hrU', hxr‚ü© := hU.exists_basicOpen_le ‚ü®f x, hxV‚ü© hxU
    refine ‚ü®_, hxr, hU.basicOpen r, ?_‚ü©
    convert hV.basicOpen (f.app _ (Y.presheaf.map (homOfLE hU'U).op r)) using 1
    simp only [Scheme.preimage_basicOpen, ‚Üê CommRingCat.comp_apply, f.naturality]
    simpa using ((Opens.map f.base).map (homOfLE hrU')).le
  ¬∑ obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hyU, hU'‚ü© :=
      Y.isBasis_affineOpens.exists_subset_of_mem_open hy hf‚ÇÇ.isOpen_compl
    rw [Set.subset_compl_iff_disjoint_right, ‚Üê Set.preimage_eq_empty_iff] at hU'
    refine ‚ü®U, hyU, hU, ?_‚ü©
    convert isAffineOpen_bot _
    exact Opens.ext hU'
",Formal Proof of Stacks Project Tag 04DE,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Affine.lean#L224-L249,Q27041,,29.45.4,lemma,3.0,"['04DC', '01QL', '0ELP']","\n  Lemma 29.45.4. Let $f : X \\to Y$ be a morphism of schemes. If $f$ is a homeomorphism onto a closed subset of $Y$ then $f$ is affine. \n\n    \n      Proof.\n      Let $y \\in Y$ be a point. If $y \\not\\in f(X)$, then there exists an affine neighbourhood of $y$ which is disjoint from $f(X)$. If $y \\in f(X)$, let $x \\in X$ be the unique point of $X$ mapping to $y$. Let $y \\in V$ be an affine open neighbourhood. Let $U \\subset X$ be an affine open neighbourhood of $x$ which maps into $V$. Since $f(U) \\subset V \\cap f(X)$ is open in the induced topology by our assumption on $f$ we may choose a $h \\in \\Gamma (V, \\mathcal{O}_ Y)$ such that $y \\in D(h)$ and $D(h) \\cap f(X) \\subset f(U)$. Denote $h\' \\in \\Gamma (U, \\mathcal{O}_ X)$ the restriction of $f^\\sharp (h)$ to $U$. Then we see that $D(h\') \\subset U$ is equal to $f^{-1}(D(h))$. In other words, every point of $Y$ has an open neighbourhood whose inverse image is affine. Thus $f$ is affine, see Lemma 29.11.3. \n      $\\square$\n    \n",\n  Lemma 29.45.4. Let $f : X \\to Y$ be a morphism of schemes. If $f$ is a homeomorphism onto a closed subset of $Y$ then $f$ is affine. \n\n    \n,"Proof.\n      Let $y \\in Y$ be a point. If $y \\not\\in f(X)$, then there exists an affine neighbourhood of $y$ which is disjoint from $f(X)$. If $y \\in f(X)$, let $x \\in X$ be the unique point of $X$ mapping to $y$. Let $y \\in V$ be an affine open neighbourhood. Let $U \\subset X$ be an affine open neighbourhood of $x$ which maps into $V$. Since $f(U) \\subset V \\cap f(X)$ is open in the induced topology by our assumption on $f$ we may choose a $h \\in \\Gamma (V, \\mathcal{O}_ Y)$ such that $y \\in D(h)$ and $D(h) \\cap f(X) \\subset f(U)$. Denote $h\' \\in \\Gamma (U, \\mathcal{O}_ X)$ the restriction of $f^\\sharp (h)$ to $U$. Then we see that $D(h\') \\subset U$ is equal to $f^{-1}(D(h))$. In other words, every point of $Y$ has an open neighbourhood whose inverse image is affine. Thus $f$ is affine, see Lemma 29.11.3. \n      $\\square$\n    \n"," by
  apply isAffineHom_of_forall_exists_isAffineOpen
  intro y
  by_cases hy : y ‚àà Set.range f
  ¬∑ obtain ‚ü®x, rfl‚ü© := hy
    obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hxU, -‚ü© :=
      Y.isBasis_affineOpens.exists_subset_of_mem_open (Set.mem_univ (f x)) isOpen_univ
    obtain ‚ü®_, ‚ü®V, hV, rfl‚ü©, hxV, hVU‚ü© :=
      X.isBasis_affineOpens.exists_subset_of_mem_open hxU (f ‚Åª¬π·µÅ U).isOpen
    obtain ‚ü®U', hU'U, rfl‚ü© : ‚àÉ U' : Y.Opens, U' ‚â§ U ‚àß f ‚Åª¬π·µÅ U' = V := by
      obtain ‚ü®U', hU', e‚ü© := hf‚ÇÅ.isOpen_iff.mp V.2
      exact ‚ü®‚ü®U', hU'‚ü© ‚äì U, inf_le_right, Opens.ext (by simpa [e] using hVU)‚ü©
    obtain ‚ü®r, hrU', hxr‚ü© := hU.exists_basicOpen_le ‚ü®f x, hxV‚ü© hxU
    refine ‚ü®_, hxr, hU.basicOpen r, ?_‚ü©
    convert hV.basicOpen (f.app _ (Y.presheaf.map (homOfLE hU'U).op r)) using 1
    simp only [Scheme.preimage_basicOpen, ‚Üê CommRingCat.comp_apply, f.naturality]
    simpa using ((Opens.map f.base).map (homOfLE hrU')).le
  ¬∑ obtain ‚ü®_, ‚ü®U, hU, rfl‚ü©, hyU, hU'‚ü© :=
      Y.isBasis_affineOpens.exists_subset_of_mem_open hy hf‚ÇÇ.isOpen_compl
    rw [Set.subset_compl_iff_disjoint_right, ‚Üê Set.preimage_eq_empty_iff] at hU'
    refine ‚ü®U, hyU, hU, ?_‚ü©
    convert isAffineOpen_bot _
    exact Opens.ext hU'
","lemma isAffineHom_of_isInducing
    (hf‚ÇÅ : Topology.IsInducing f)
    (hf‚ÇÇ : IsClosed (Set.range f)) :
    IsAffineHom f ","Proof.\n      Let $y \\in Y$ be a point. If $y \\not\\in f(X)$, then there exists an affine neighbourhood of $y$ which is disjoint from $f(X)$. If $y \\in f(X)$, let $x \\in X$ be the unique point of $X$ mapping to $y$. Let $y \\in V$ be an affine open neighbourhood. Let $U \\subset X$ be an affine open neighbourhood of $x$ which maps into $V$. Since $f(U) \\subset V \\cap f(X)$ is open in the induced topology by our assumption on $f$ we may choose a $h \\in \\Gamma (V, \\mathcal{O}_ Y)$ such that $y \\in D(h)$ and $D(h) \\cap f(X) \\subset f(U)$. Denote $h\' \\in \\Gamma (U, \\mathcal{O}_ X)$ the restriction of $f^\\sharp (h)$ to $U$. Then we see that $D(h\') \\subset U$ is equal to $f^{-1}(D(h))$. In other words, every point of $Y$ has an open neighbourhood whose inverse image is affine. Thus $f$ is affine, see Lemma 29.11.3 [[\n       \n      \n  Lemma 29.11.3. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is affine. \n\n\nThere exists an affine open covering $S = \\bigcup W_ j$ such that each $f^{-1}(W_ j)$ is affine. \n\n\nThere exists a quasi-coherent sheaf of $\\mathcal{O}_ S$-algebras $\\mathcal{A}$ and an isomorphism $X \\cong \\underline{\\mathop{\\mathrm{Spec}}}_ S(\\mathcal{A})$ of schemes over $S$. See Constructions, Section 27.4 for notation. \n\n\n\n   Moreover, in this case $X = \\underline{\\mathop{\\mathrm{Spec}}}_ S(f_*\\mathcal{O}_ X)$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Let $y \\in Y$ be a point. If $y \\not\\in f(X)$, then there exists an affine neighbourhood of $y$ which is disjoint from $f(X)$. If $y \\in f(X)$, let $x \\in X$ be the unique point of $X$ mapping to $y$. Let $y \\in V$ be an affine open neighbourhood. Let $U \\subset X$ be an affine open neighbourhood of $x$ which maps into $V$. Since $f(U) \\subset V \\cap f(X)$ is open in the induced topology by our assumption on $f$ we may choose a $h \\in \\Gamma (V, \\mathcal{O}_ Y)$ such that $y \\in D(h)$ and $D(h) \\cap f(X) \\subset f(U)$. Denote $h\' \\in \\Gamma (U, \\mathcal{O}_ X)$ the restriction of $f^\\sharp (h)$ to $U$. Then we see that $D(h\') \\subset U$ is equal to $f^{-1}(D(h))$. In other words, every point of $Y$ has an open neighbourhood whose inverse image is affine. Thus $f$ is affine, see Lemma 29.11.3 [[\n       \n      \n  Lemma 29.11.3. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is affine. \n\n\nThere exists an affine open covering $S = \\bigcup W_ j$ such that each $f^{-1}(W_ j)$ is affine. \n\n\nThere exists a quasi-coherent sheaf of $\\mathcal{O}_ S$-algebras $\\mathcal{A}$ and an isomorphism $X \\cong \\underline{\\mathop{\\mathrm{Spec}}}_ S(\\mathcal{A})$ of schemes over $S$. See Constructions, Section 27.4 for notation. \n\n\n\n   Moreover, in this case $X = \\underline{\\mathop{\\mathrm{Spec}}}_ S(f_*\\mathcal{O}_ X)$. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish that a morphism is affine by showing: for every point y in Y there exists an affine open neighborhood U of y such that f ‚Åª¬π(U) is affine (or empty/affine), and then invoking a criterion equivalent to Lemma 29.11.3. The Lean proof does this via `isAffineHom_of_forall_exists_isAffineOpen` and a case split on whether y lies in `Set.range f` (i.e. y ‚àà f(X)), matching the informal split into y‚àâf(X) and y‚ààf(X).\n\nStructurally, in the y‚ààf(X) case, Lean chooses x with f x = y, then picks affine opens U in Y and V in X with V ‚äÜ f‚Åª¬π(U), then refines to an open U' ‚äÜ U with f‚Åª¬π(U') = V using an openness assumption (`hf‚ÇÅ.isOpen_iff`), and finally shrinks to a basic open D(r) around y so that its preimage is a basic open in V, hence affine. This corresponds to the informal argument: choose affine neighborhoods V (in Y) and U (in X) mapping into V, then choose a basic open D(h) around y whose intersection with f(X) lies in f(U), and identify f‚Åª¬π(D(h)) with a basic open in U.\n\nIn the y‚àâf(X) case, Lean explicitly constructs an affine open neighborhood U contained in the complement of the range (using `hf‚ÇÇ.isOpen_compl`), so that f‚Åª¬π(U)=‚àÖ, and concludes it is affine; this matches the informal ‚Äúaffine neighborhood disjoint from f(X)‚Äù.\n\nThe main mismatch is that the informal proof emphasizes uniqueness of x mapping to y and uses global sections h and their pullback/restriction, while Lean does not use uniqueness and encodes the section/basic-open shrinking via basis and presheaf/naturality manipulations. These are differences in presentation rather than meaning, so overall alignment is strong but not perfect.""}"
39,01TB,"lemma Scheme.Hom.closePoints_subset_preimage_closedPoints
    {X Y : Scheme.{u}} (f : X ‚ü∂ Y) [JacobsonSpace Y] [LocallyOfFiniteType f] :
    closedPoints X ‚äÜ f ‚Åª¬π' closedPoints Y := by
  intro x hx
  have := isClosed_singleton_iff_isClosedImmersion.mp hx
  have := (isFinite_iff_locallyOfFiniteType_of_jacobsonSpace
    (f := X.fromSpecResidueField x ‚â´ f)).mpr inferInstance
  simpa [Set.range_comp, Scheme.range_fromSpecResidueField] using
    (X.fromSpecResidueField x ‚â´ f).isClosedMap.isClosed_range
",Formal Proof of Stacks Project Tag 01TB,(1) => (3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Finite.lean#L190-L198,Q27041,,29.16.8,lemma,3.0,"['01T9', '01QL', '0ELP']","\n  Lemma 29.16.8. Let $S$ be a scheme. The following are equivalent: \n  \n  \nthe scheme $S$ is Jacobson, \n\n\n$S_{\\text{ft-pts}}$ is the set of closed points of $S$, \n\n\nfor all $T \\to S$ locally of finite type closed points map to closed points, and \n\n\nfor all $T \\to S$ locally of finite type closed points $t \\in T$ map to closed points $s \\in S$ with $\\kappa (s) \\subset \\kappa (t)$ finite. \n\n\n\n\n    \n      Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2) and $R$ is Jacobson by Properties, Lemma 28.6.3. Thus the result follows from Algebra, Proposition 10.35.19. \n      $\\square$\n    \n","\n  Lemma 29.16.8. Let $S$ be a scheme. The following are equivalent: \n  \n  \nthe scheme $S$ is Jacobson, \n\n\n$S_{\\text{ft-pts}}$ is the set of closed points of $S$, \n\n\nfor all $T \\to S$ locally of finite type closed points map to closed points, and \n\n\nfor all $T \\to S$ locally of finite type closed points $t \\in T$ map to closed points $s \\in S$ with $\\kappa (s) \\subset \\kappa (t)$ finite. \n\n\n\n\n    \n","Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2) and $R$ is Jacobson by Properties, Lemma 28.6.3. Thus the result follows from Algebra, Proposition 10.35.19. \n      $\\square$\n    \n"," by
  intro x hx
  have := isClosed_singleton_iff_isClosedImmersion.mp hx
  have := (isFinite_iff_locallyOfFiniteType_of_jacobsonSpace
    (f := X.fromSpecResidueField x ‚â´ f)).mpr inferInstance
  simpa [Set.range_comp, Scheme.range_fromSpecResidueField] using
    (X.fromSpecResidueField x ‚â´ f).isClosedMap.isClosed_range
","lemma Scheme.Hom.closePoints_subset_preimage_closedPoints
    {X Y : Scheme.{u}} (f : X ‚ü∂ Y) [JacobsonSpace Y] [LocallyOfFiniteType f] :
    closedPoints X ‚äÜ f ‚Åª¬π' closedPoints Y ","Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 [[\n  Lemma 29.16.7. Let $S$ be a scheme. For any locally closed subset $T \\subset S$ we have \n  \n  \\[  T \\not= \\emptyset \\Rightarrow T \\cap S_{\\text{ft-pts}} \\not= \\emptyset .  \\]\n\n   In particular, for any closed subset $T \\subset S$ we see that $T \\cap S_{\\text{ft-pts}}$ is dense in $T$. \n\n    \n]] shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2 [[\n  Lemma 29.15.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite type. \n\n\nFor all affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite type. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite type. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite type, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite type then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite type. \n\n    \n]]) and $R$ is Jacobson by Properties, Lemma 28.6.3 [[\n  Lemma 28.6.3. Let $X$ be a scheme. The following are equivalent: \n  \n  \nThe scheme $X$ is Jacobson. \n\n\nThe scheme $X$ is \xe2\x80\x9clocally Jacobson\xe2\x80\x9d in the sense of Definition 28.4.2. \n\n\nFor every affine open $U \\subset X$ the ring $\\mathcal{O}_ X(U)$ is Jacobson. \n\n\nThere exists an affine open covering $X = \\bigcup U_ i$ such that each $\\mathcal{O}_ X(U_ i)$ is Jacobson. \n\n\nThere exists an open covering $X = \\bigcup X_ j$ such that each open subscheme $X_ j$ is Jacobson. \n\n\n\n   Moreover, if $X$ is Jacobson then every open subscheme is Jacobson. \n\n    \n]]. Thus the result follows from Algebra, Proposition 10.35.19 [[\n  Proposition 10.35.19. Let $R$ be a Jacobson ring. Let $R \\to S$ be a ring map of finite type. Then \n  \n  \nThe ring $S$ is Jacobson. \n\n\nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ transforms closed points to closed points. \n\n\nFor $\\mathfrak m\' \\subset S$ maximal lying over $\\mathfrak m \\subset R$ the field extension $\\kappa (\\mathfrak m\')/\\kappa (\\mathfrak m)$ is finite. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 [[\n  Lemma 29.16.7. Let $S$ be a scheme. For any locally closed subset $T \\subset S$ we have \n  \n  \\[  T \\not= \\emptyset \\Rightarrow T \\cap S_{\\text{ft-pts}} \\not= \\emptyset .  \\]\n\n   In particular, for any closed subset $T \\subset S$ we see that $T \\cap S_{\\text{ft-pts}}$ is dense in $T$. \n\n    \n]] shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2 [[\n  Lemma 29.15.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite type. \n\n\nFor all affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite type. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite type. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite type, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite type then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite type. \n\n    \n]]) and $R$ is Jacobson by Properties, Lemma 28.6.3 [[\n  Lemma 28.6.3. Let $X$ be a scheme. The following are equivalent: \n  \n  \nThe scheme $X$ is Jacobson. \n\n\nThe scheme $X$ is \xe2\x80\x9clocally Jacobson\xe2\x80\x9d in the sense of Definition 28.4.2. \n\n\nFor every affine open $U \\subset X$ the ring $\\mathcal{O}_ X(U)$ is Jacobson. \n\n\nThere exists an affine open covering $X = \\bigcup U_ i$ such that each $\\mathcal{O}_ X(U_ i)$ is Jacobson. \n\n\nThere exists an open covering $X = \\bigcup X_ j$ such that each open subscheme $X_ j$ is Jacobson. \n\n\n\n   Moreover, if $X$ is Jacobson then every open subscheme is Jacobson. \n\n    \n]]. Thus the result follows from Algebra, Proposition 10.35.19 [[\n  Proposition 10.35.19. Let $R$ be a Jacobson ring. Let $R \\to S$ be a ring map of finite type. Then \n  \n  \nThe ring $S$ is Jacobson. \n\n\nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ transforms closed points to closed points. \n\n\nFor $\\mathfrak m\' \\subset S$ maximal lying over $\\mathfrak m \\subset R$ the field extension $\\kappa (\\mathfrak m\')/\\kappa (\\mathfrak m)$ is finite. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) => (3)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about showing a certain map has closed range/closed map properties by reducing to a closed immersion of a singleton and then invoking a finiteness criterion for morphisms over a Jacobson space (`isFinite_iff_locallyOfFiniteType_of_jacobsonSpace`) applied to `X.fromSpecResidueField x ‚â´ f`, concluding via `isClosedMap.isClosed_range`. The informal proof for (1) ‚áí (3) (in the given comment context) argues that for a locally finite type morphism, closed points map to closed points, using affine neighborhoods, Jacobsonness of the base ring, and a commutative algebra proposition about finite type maps over Jacobson rings. Structurally, the informal proof proceeds by local affine reduction and algebraic Jacobson arguments, while the Lean proof instead uses a residue-field point morphism and a global lemma equating finiteness with locally finite type over Jacobson spaces, then a topological closed-range statement. This captures a related idea (using Jacobson + locally finite type to get finiteness/closedness properties of point maps), but it does not mirror the explicit ‚Äúclosed points map to closed points‚Äù argument, and it seems closer to proving closedness of the image of a residue-field map than the stated (1) ‚áí (3) implication. Hence partial semantic overlap but weak structural correspondence.""}"
40,01TB,"lemma isClosed_singleton_iff_locallyOfFiniteType {X : Scheme.{u}} [JacobsonSpace X] {x : X} :
    IsClosed {x} ‚Üî LocallyOfFiniteType (X.fromSpecResidueField x) := by
  constructor
  ¬∑ exact fun H ‚Ü¶ have := isClosed_singleton_iff_isClosedImmersion.mp H; inferInstance
  ¬∑ intro H
    simpa using (X.fromSpecResidueField x).closePoints_subset_preimage_closedPoints
      (IsLocalRing.isClosed_singleton_closedPoint _)
",Formal Proof of Stacks Project Tag 01TB,(1) => (2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Finite.lean#L201-L207,Q27041,,29.16.8,lemma,3.0,"['01T9', '01QL', '0ELP']","\n  Lemma 29.16.8. Let $S$ be a scheme. The following are equivalent: \n  \n  \nthe scheme $S$ is Jacobson, \n\n\n$S_{\\text{ft-pts}}$ is the set of closed points of $S$, \n\n\nfor all $T \\to S$ locally of finite type closed points map to closed points, and \n\n\nfor all $T \\to S$ locally of finite type closed points $t \\in T$ map to closed points $s \\in S$ with $\\kappa (s) \\subset \\kappa (t)$ finite. \n\n\n\n\n    \n      Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2) and $R$ is Jacobson by Properties, Lemma 28.6.3. Thus the result follows from Algebra, Proposition 10.35.19. \n      $\\square$\n    \n","\n  Lemma 29.16.8. Let $S$ be a scheme. The following are equivalent: \n  \n  \nthe scheme $S$ is Jacobson, \n\n\n$S_{\\text{ft-pts}}$ is the set of closed points of $S$, \n\n\nfor all $T \\to S$ locally of finite type closed points map to closed points, and \n\n\nfor all $T \\to S$ locally of finite type closed points $t \\in T$ map to closed points $s \\in S$ with $\\kappa (s) \\subset \\kappa (t)$ finite. \n\n\n\n\n    \n","Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2) and $R$ is Jacobson by Properties, Lemma 28.6.3. Thus the result follows from Algebra, Proposition 10.35.19. \n      $\\square$\n    \n"," by
  constructor
  ¬∑ exact fun H ‚Ü¶ have := isClosed_singleton_iff_isClosedImmersion.mp H; inferInstance
  ¬∑ intro H
    simpa using (X.fromSpecResidueField x).closePoints_subset_preimage_closedPoints
      (IsLocalRing.isClosed_singleton_closedPoint _)
","lemma isClosed_singleton_iff_locallyOfFiniteType {X : Scheme.{u}} [JacobsonSpace X] {x : X} :
    IsClosed {x} ‚Üî LocallyOfFiniteType (X.fromSpecResidueField x) ","Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 [[\n  Lemma 29.16.7. Let $S$ be a scheme. For any locally closed subset $T \\subset S$ we have \n  \n  \\[  T \\not= \\emptyset \\Rightarrow T \\cap S_{\\text{ft-pts}} \\not= \\emptyset .  \\]\n\n   In particular, for any closed subset $T \\subset S$ we see that $T \\cap S_{\\text{ft-pts}}$ is dense in $T$. \n\n    \n]] shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2 [[\n  Lemma 29.15.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite type. \n\n\nFor all affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite type. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite type. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite type, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite type then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite type. \n\n    \n]]) and $R$ is Jacobson by Properties, Lemma 28.6.3 [[\n  Lemma 28.6.3. Let $X$ be a scheme. The following are equivalent: \n  \n  \nThe scheme $X$ is Jacobson. \n\n\nThe scheme $X$ is \xe2\x80\x9clocally Jacobson\xe2\x80\x9d in the sense of Definition 28.4.2. \n\n\nFor every affine open $U \\subset X$ the ring $\\mathcal{O}_ X(U)$ is Jacobson. \n\n\nThere exists an affine open covering $X = \\bigcup U_ i$ such that each $\\mathcal{O}_ X(U_ i)$ is Jacobson. \n\n\nThere exists an open covering $X = \\bigcup X_ j$ such that each open subscheme $X_ j$ is Jacobson. \n\n\n\n   Moreover, if $X$ is Jacobson then every open subscheme is Jacobson. \n\n    \n]]. Thus the result follows from Algebra, Proposition 10.35.19 [[\n  Proposition 10.35.19. Let $R$ be a Jacobson ring. Let $R \\to S$ be a ring map of finite type. Then \n  \n  \nThe ring $S$ is Jacobson. \n\n\nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ transforms closed points to closed points. \n\n\nFor $\\mathfrak m\' \\subset S$ maximal lying over $\\mathfrak m \\subset R$ the field extension $\\kappa (\\mathfrak m\')/\\kappa (\\mathfrak m)$ is finite. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      We have trivially (4) $\\Rightarrow $ (3) $\\Rightarrow $ (2). Lemma 29.16.7 [[\n  Lemma 29.16.7. Let $S$ be a scheme. For any locally closed subset $T \\subset S$ we have \n  \n  \\[  T \\not= \\emptyset \\Rightarrow T \\cap S_{\\text{ft-pts}} \\not= \\emptyset .  \\]\n\n   In particular, for any closed subset $T \\subset S$ we see that $T \\cap S_{\\text{ft-pts}}$ is dense in $T$. \n\n    \n]] shows that (2) implies (1). Hence it suffices to show that (1) implies (4). Suppose that $T \\to S$ is locally of finite type. Choose $t \\in T$ closed and let $s \\in S$ be the image. Choose affine open neighbourhoods $\\mathop{\\mathrm{Spec}}(R) = U \\subset S$ of $s$ and $\\mathop{\\mathrm{Spec}}(A) = V \\subset T$ of $t$ with $V$ mapping into $U$. The induced ring map $R \\to A$ is of finite type (see Lemma 29.15.2 [[\n  Lemma 29.15.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite type. \n\n\nFor all affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite type. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite type. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite type, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite type then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite type. \n\n    \n]]) and $R$ is Jacobson by Properties, Lemma 28.6.3 [[\n  Lemma 28.6.3. Let $X$ be a scheme. The following are equivalent: \n  \n  \nThe scheme $X$ is Jacobson. \n\n\nThe scheme $X$ is \xe2\x80\x9clocally Jacobson\xe2\x80\x9d in the sense of Definition 28.4.2. \n\n\nFor every affine open $U \\subset X$ the ring $\\mathcal{O}_ X(U)$ is Jacobson. \n\n\nThere exists an affine open covering $X = \\bigcup U_ i$ such that each $\\mathcal{O}_ X(U_ i)$ is Jacobson. \n\n\nThere exists an open covering $X = \\bigcup X_ j$ such that each open subscheme $X_ j$ is Jacobson. \n\n\n\n   Moreover, if $X$ is Jacobson then every open subscheme is Jacobson. \n\n    \n]]. Thus the result follows from Algebra, Proposition 10.35.19 [[\n  Proposition 10.35.19. Let $R$ be a Jacobson ring. Let $R \\to S$ be a ring map of finite type. Then \n  \n  \nThe ring $S$ is Jacobson. \n\n\nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ transforms closed points to closed points. \n\n\nFor $\\mathfrak m\' \\subset S$ maximal lying over $\\mathfrak m \\subset R$ the field extension $\\kappa (\\mathfrak m\')/\\kappa (\\mathfrak m)$ is finite. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) => (2)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof‚Äôs (1) ‚áí (4) argument uses Jacobson/finite type algebra (affine neighborhoods, Jacobson ring, finite type map, and a proposition about closed points under Spec of a finite type map). The Lean proof instead is a two-way `constructor` proof about a closedness condition on a singleton/closed point, using `isClosed_singleton_iff_isClosedImmersion` and a lemma about `closePoints_subset_preimage_closedPoints` for `fromSpecResidueField`, i.e. a statement about closed points under the residue field morphism. Structurally, the Lean proof shows an equivalence with two short implications, while the informal proof is a chain of implications plus a substantial Jacobson/finite-type reduction; even restricting to the comment ‚Äú(1) ‚áí (2)‚Äù, the Lean code does not reflect the affine/Jacobson/finite-type reasoning. There is some thematic overlap (closed points / closed singletons), but the main content and proof strategy do not match, and key ingredients from the informal proof are absent.""}"
41,054K,"-- `nonrec` is needed for `wlog`
nonrec lemma Scheme.Hom.isLocallyConstructible_image (f : X ‚ü∂ Y)
    [hf : LocallyOfFinitePresentation f] [QuasiCompact f]
    {s : Set X} (hs : IsLocallyConstructible s) :
    IsLocallyConstructible (f '' s) := by
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ refine .of_isOpenCover Y.affineCover.isOpenCover_opensRange fun i ‚Ü¶ ?_
    have inst : LocallyOfFinitePresentation (Y.affineCover.pullbackHom f i) :=
      MorphismProperty.pullback_snd _ _ inferInstance
    have inst : QuasiCompact (Y.affineCover.pullbackHom f i) :=
      MorphismProperty.pullback_snd _ _ inferInstance
    convert (this (Y.affineCover.pullbackHom f i) (hs.preimage_of_isOpenEmbedding
      ((Y.affineCover.pullback‚ÇÅ f).f i).isOpenEmbedding)
      ‚ü®_, rfl‚ü©).preimage_of_isOpenEmbedding (Y.affineCover.f i).isoOpensRange.inv.isOpenEmbedding
    refine .trans ?_
      ((Scheme.homeoOfIso (Y.affineCover.f i).isoOpensRange).image_eq_preimage_symm _)
    apply Set.image_injective.mpr Subtype.val_injective
    rw [Set.image_preimage_eq_inter_range, ‚Üê Set.image_comp, ‚Üê Set.image_comp,
      Subtype.range_coe_subtype, Set.setOf_mem_eq]
    change _ = (Y.affineCover.pullbackHom f i ‚â´
      (Y.affineCover.f i).isoOpensRange.hom ‚â´ Opens.Œπ _).base.hom '' _
    rw [Scheme.Hom.isoOpensRange_hom_Œπ, Cover.pullbackHom_map, Scheme.Hom.comp_base,
      TopCat.hom_comp, ContinuousMap.coe_comp, Set.image_comp, Set.image_preimage_eq_inter_range]
    simp [IsOpenImmersion.range_pullbackFst, Set.image_inter_preimage]
  obtain ‚ü®R, rfl‚ü© := hY
  wlog hX : ‚àÉ S, X = Spec S
  ¬∑ have inst : CompactSpace X := HasAffineProperty.iff_of_isAffine.mp ‚ÄπQuasiCompact f‚Ä∫
    let ùí∞ := X.affineCover.finiteSubcover
    rw [‚Üê ùí∞.isOpenCover_opensRange.iUnion_inter s, Set.image_iUnion]
    refine .iUnion fun i ‚Ü¶ ?_
    have inst : QuasiCompact (ùí∞.f i ‚â´ f) :=
      HasAffineProperty.iff_of_isAffine.mpr (inferInstanceAs (CompactSpace (Spec _)))
    convert this (hs.preimage_of_isOpenEmbedding (ùí∞.f i).isOpenEmbedding) _
      (ùí∞.f i ‚â´ f) ‚ü®_, rfl‚ü©
    rw [Scheme.Hom.comp_base, ‚Üê TopCat.Hom.hom, ‚Üê TopCat.Hom.hom, TopCat.hom_comp,
      ContinuousMap.coe_comp, Set.image_comp, Set.image_preimage_eq_inter_range, coe_opensRange]
  obtain ‚ü®S, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.map_surjective f
  rw [HasRingHomProperty.Spec_iff (P := @LocallyOfFinitePresentation)] at hf
  exact (PrimeSpectrum.isConstructible_comap_image hf hs.isConstructible).isLocallyConstructible
",Formal Proof of Stacks Project Tag 054K,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FinitePresentation.lean#L105-L144,Q27041,Chevalley's Theorem,29.22.3,theorem,3.0,"['054H', '01QL', '0ELP']","\n        \n      \n  Theorem 29.22.3 (Chevalley\'s Theorem). Let $f : X \\to Y$ be a morphism of schemes. Assume $f$ is quasi-compact and locally of finite presentation. Then the image of every locally constructible subset is locally constructible. \n\n    \n      Proof.\n      Let $E \\subset X$ be locally constructible. We have to show that $f(E)$ is locally constructible too. We will show that $f(E) \\cap V$ is constructible for any affine open $V \\subset Y$. Thus we reduce to the case where $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is locally constructible, then each $E \\cap U_ i$ is constructible, see Properties, Lemma 28.2.1. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10. \n      $\\square$\n    \n",\n        \n      \n  Theorem 29.22.3 (Chevalley\'s Theorem). Let $f : X \\to Y$ be a morphism of schemes. Assume $f$ is quasi-compact and locally of finite presentation. Then the image of every locally constructible subset is locally constructible. \n\n    \n,"Proof.\n      Let $E \\subset X$ be locally constructible. We have to show that $f(E)$ is locally constructible too. We will show that $f(E) \\cap V$ is constructible for any affine open $V \\subset Y$. Thus we reduce to the case where $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is locally constructible, then each $E \\cap U_ i$ is constructible, see Properties, Lemma 28.2.1. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10. \n      $\\square$\n    \n"," by
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ refine .of_isOpenCover Y.affineCover.isOpenCover_opensRange fun i ‚Ü¶ ?_
    have inst : LocallyOfFinitePresentation (Y.affineCover.pullbackHom f i) :=
      MorphismProperty.pullback_snd _ _ inferInstance
    have inst : QuasiCompact (Y.affineCover.pullbackHom f i) :=
      MorphismProperty.pullback_snd _ _ inferInstance
    convert (this (Y.affineCover.pullbackHom f i) (hs.preimage_of_isOpenEmbedding
      ((Y.affineCover.pullback‚ÇÅ f).f i).isOpenEmbedding)
      ‚ü®_, rfl‚ü©).preimage_of_isOpenEmbedding (Y.affineCover.f i).isoOpensRange.inv.isOpenEmbedding
    refine .trans ?_
      ((Scheme.homeoOfIso (Y.affineCover.f i).isoOpensRange).image_eq_preimage_symm _)
    apply Set.image_injective.mpr Subtype.val_injective
    rw [Set.image_preimage_eq_inter_range, ‚Üê Set.image_comp, ‚Üê Set.image_comp,
      Subtype.range_coe_subtype, Set.setOf_mem_eq]
    change _ = (Y.affineCover.pullbackHom f i ‚â´
      (Y.affineCover.f i).isoOpensRange.hom ‚â´ Opens.Œπ _).base.hom '' _
    rw [Scheme.Hom.isoOpensRange_hom_Œπ, Cover.pullbackHom_map, Scheme.Hom.comp_base,
      TopCat.hom_comp, ContinuousMap.coe_comp, Set.image_comp, Set.image_preimage_eq_inter_range]
    simp [IsOpenImmersion.range_pullbackFst, Set.image_inter_preimage]
  obtain ‚ü®R, rfl‚ü© := hY
  wlog hX : ‚àÉ S, X = Spec S
  ¬∑ have inst : CompactSpace X := HasAffineProperty.iff_of_isAffine.mp ‚ÄπQuasiCompact f‚Ä∫
    let ùí∞ := X.affineCover.finiteSubcover
    rw [‚Üê ùí∞.isOpenCover_opensRange.iUnion_inter s, Set.image_iUnion]
    refine .iUnion fun i ‚Ü¶ ?_
    have inst : QuasiCompact (ùí∞.f i ‚â´ f) :=
      HasAffineProperty.iff_of_isAffine.mpr (inferInstanceAs (CompactSpace (Spec _)))
    convert this (hs.preimage_of_isOpenEmbedding (ùí∞.f i).isOpenEmbedding) _
      (ùí∞.f i ‚â´ f) ‚ü®_, rfl‚ü©
    rw [Scheme.Hom.comp_base, ‚Üê TopCat.Hom.hom, ‚Üê TopCat.Hom.hom, TopCat.hom_comp,
      ContinuousMap.coe_comp, Set.image_comp, Set.image_preimage_eq_inter_range, coe_opensRange]
  obtain ‚ü®S, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.map_surjective f
  rw [HasRingHomProperty.Spec_iff (P := @LocallyOfFinitePresentation)] at hf
  exact (PrimeSpectrum.isConstructible_comap_image hf hs.isConstructible).isLocallyConstructible
","-- `nonrec` is needed for `wlog`
nonrec lemma Scheme.Hom.isLocallyConstructible_image (f : X ‚ü∂ Y)
    [hf : LocallyOfFinitePresentation f] [QuasiCompact f]
    {s : Set X} (hs : IsLocallyConstructible s) :
    IsLocallyConstructible (f '' s) ","Proof.\n      Let $E \\subset X$ be locally constructible. We have to show that $f(E)$ is locally constructible too. We will show that $f(E) \\cap V$ is constructible for any affine open $V \\subset Y$. Thus we reduce to the case where $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is locally constructible, then each $E \\cap U_ i$ is constructible, see Properties, Lemma 28.2.1 [[\n  Lemma 28.2.1. Let $X$ be a scheme. A subset $E$ of $X$ is locally constructible in $X$ if and only if $E \\cap U$ is constructible in $U$ for every affine open $U$ of $X$. \n\n    \n]]. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10 [[\n  Theorem 10.29.10 (Chevalley\'s Theorem).  Suppose that $R \\to S$ is of finite presentation. The image of a constructible subset of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$ is constructible. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Let $E \\subset X$ be locally constructible. We have to show that $f(E)$ is locally constructible too. We will show that $f(E) \\cap V$ is constructible for any affine open $V \\subset Y$. Thus we reduce to the case where $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is locally constructible, then each $E \\cap U_ i$ is constructible, see Properties, Lemma 28.2.1 [[\n  Lemma 28.2.1. Let $X$ be a scheme. A subset $E$ of $X$ is locally constructible in $X$ if and only if $E \\cap U$ is constructible in $U$ for every affine open $U$ of $X$. \n\n    \n]]. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10 [[\n  Theorem 10.29.10 (Chevalley\'s Theorem).  Suppose that $R \\to S$ is of finite presentation. The image of a constructible subset of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$ is constructible. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""5"", ""brief_justification"": ""Semantically, both proofs establish that for a morphism f that is locally of finite presentation, the image of a (locally) constructible subset is (locally) constructible, reducing to the affine case and then invoking Chevalley for rings. The Lean proof first reduces to affine opens on Y via an open cover (using Y.affineCover and showing constructibility on each opensRange), matching the informal step ‚Äúcheck f(E) ‚à© V for affine open V ‚äÇ Y‚Äù. It then reduces to X affine by taking a finite affine subcover of X (using quasi-compactness when Y is affine), matching the informal ‚ÄúX quasi-compact ‚áí finite affine cover ‚áí reduce to affine X using finite unions‚Äù. Finally, in the affine‚Äìaffine situation it converts the scheme morphism to a ring map (Spec.map_surjective and Spec_iff for LocallyOfFinitePresentation) and applies PrimeSpectrum.isConstructible_comap_image, corresponding to invoking Chevalley‚Äôs theorem. Structurally the sequence of reductions (Y affine-local, then X affine via finite cover, then ring-theoretic Chevalley) aligns closely, and there is no evident extraneous or mismatched content beyond the necessary Lean bookkeeping about pullbacks, open immersions, and images/preimages.""}"
42,054J,"lemma Scheme.Hom.isConstructible_image (f : X ‚ü∂ Y)
    [LocallyOfFinitePresentation f] [QuasiCompact f] [CompactSpace Y] [QuasiSeparatedSpace Y]
    {s : Set X} (hs : IsConstructible s) :
    IsConstructible (f '' s) :=
  (f.isLocallyConstructible_image hs.isLocallyConstructible).isConstructible
",Formal Proof of Stacks Project Tag 054J,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FinitePresentation.lean#L149-L153,Q27041,,29.22.2,lemma,3.0,"['054H', '01QL', '0ELP']","\n  Lemma 29.22.2. Let $f : X \\to Y$ be a morphism of schemes. Assume \n  \n  \n$f$ is quasi-compact and locally of finite presentation, and \n\n\n$Y$ is quasi-compact and quasi-separated. \n\n\n\n   Then the image of every constructible subset of $X$ is constructible in $Y$. \n\n    \n      Proof.\n      By Properties, Lemma 28.2.5 it suffices to prove this lemma in case $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is constructible, then each $E \\cap U_ i$ is constructible too, see Topology, Lemma 5.15.4. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10. \n      $\\square$\n    \n","\n  Lemma 29.22.2. Let $f : X \\to Y$ be a morphism of schemes. Assume \n  \n  \n$f$ is quasi-compact and locally of finite presentation, and \n\n\n$Y$ is quasi-compact and quasi-separated. \n\n\n\n   Then the image of every constructible subset of $X$ is constructible in $Y$. \n\n    \n","Proof.\n      By Properties, Lemma 28.2.5 it suffices to prove this lemma in case $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is constructible, then each $E \\cap U_ i$ is constructible too, see Topology, Lemma 5.15.4. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10. \n      $\\square$\n    \n","
  (f.isLocallyConstructible_image hs.isLocallyConstructible).isConstructible
","lemma Scheme.Hom.isConstructible_image (f : X ‚ü∂ Y)
    [LocallyOfFinitePresentation f] [QuasiCompact f] [CompactSpace Y] [QuasiSeparatedSpace Y]
    {s : Set X} (hs : IsConstructible s) :
    IsConstructible (f '' s) ","Proof.\n      By Properties, Lemma 28.2.5 [[\n  Lemma 28.2.5. Let $X$ be a quasi-compact and quasi-separated scheme. Any locally constructible subset of $X$ is constructible. \n\n    \n]] it suffices to prove this lemma in case $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is constructible, then each $E \\cap U_ i$ is constructible too, see Topology, Lemma 5.15.4 [[\n  Lemma 5.15.4. Let $U \\subset X$ be open. For a constructible set $E \\subset X$ the intersection $E \\cap U$ is constructible in $U$. \n\n    \n]]. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10 [[\n  Theorem 10.29.10 (Chevalley\'s Theorem).  Suppose that $R \\to S$ is of finite presentation. The image of a constructible subset of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$ is constructible. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      By Properties, Lemma 28.2.5 [[\n  Lemma 28.2.5. Let $X$ be a quasi-compact and quasi-separated scheme. Any locally constructible subset of $X$ is constructible. \n\n    \n]] it suffices to prove this lemma in case $Y$ is affine. In this case $X$ is quasi-compact. Hence we can write $X = U_1 \\cup \\ldots \\cup U_ n$ with each $U_ i$ affine open in $X$. If $E \\subset X$ is constructible, then each $E \\cap U_ i$ is constructible too, see Topology, Lemma 5.15.4 [[\n  Lemma 5.15.4. Let $U \\subset X$ be open. For a constructible set $E \\subset X$ the intersection $E \\cap U$ is constructible in $U$. \n\n    \n]]. Hence, since $f(E) = \\bigcup f(E \\cap U_ i)$ and since finite unions of constructible sets are constructible, this reduces us to the case where $X$ is affine. In this case the result is Algebra, Theorem 10.29.10 [[\n  Theorem 10.29.10 (Chevalley\'s Theorem).  Suppose that $R \\to S$ is of finite presentation. The image of a constructible subset of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$ is constructible. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term proves that the image of a (locally) constructible set under a map is locally constructible, and then concludes it is constructible via an `isConstructible` lemma. This matches only the very high-level goal ‚Äúimage is constructible‚Äù but not the specific route of the informal proof. Structurally, the informal proof reduces to the affine case using qcqs/finite affine cover arguments and then invokes Chevalley‚Äôs theorem for affine schemes; none of these reductions (qcqs, affine cover, finite union/intersection lemmas, Chevalley) appear in the formal proof snippet. The formal proof is a one-line composition of existing lemmas, so it omits essentially all intermediate reasoning present in the informal proof. Thus there is partial semantic overlap in the final statement, but poor structural correspondence and completeness.""}"
43,054I,"lemma Scheme.Hom.isConstructible_preimage (f : X ‚ü∂ Y) {s : Set Y} (hs : IsConstructible s) :
    IsConstructible (f ‚Åª¬π' s) :=
  hs.preimage f.continuous fun t ht ht' ‚Ü¶ IsRetrocompact_iff_isSpectralMap_subtypeVal.mpr
    (quasiCompact_iff_isSpectralMap.mp
    (MorphismProperty.of_isPullback (P := @QuasiCompact)
    (isPullback_morphismRestrict f ‚ü®t, ht‚ü©)
    (quasiCompact_iff_isSpectralMap.mpr (IsRetrocompact_iff_isSpectralMap_subtypeVal.mp ht'))))
",Formal Proof of Stacks Project Tag 054I,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FinitePresentation.lean#L156-L162,Q27041,,29.22.1,lemma,3.0,"['054H', '01QL', '0ELP']","\n  Lemma 29.22.1. Let $f : X \\to Y$ be a morphism of schemes. Let $E \\subset Y$ be a subset. If $E$ is (locally) constructible in $Y$, then $f^{-1}(E)$ is (locally) constructible in $X$. \n\n    \n      Proof.\n      To show that the inverse image of every constructible subset is constructible it suffices to show that the inverse image of every retrocompact open $V$ of $Y$ is retrocompact in $X$, see Topology, Lemma 5.15.3. The significance of $V$ being retrocompact in $Y$ is just that the open immersion $V \\to Y$ is quasi-compact. Hence the base change $f^{-1}(V) = X \\times _ Y V \\to X$ is quasi-compact too, see Schemes, Lemma 26.19.3. Hence we see $f^{-1}(V)$ is retrocompact in $X$. Suppose $E$ is locally constructible in $Y$. Choose $x \\in X$. Choose an affine neighbourhood $V$ of $f(x)$ and an affine neighbourhood $U \\subset X$ of $x$ such that $f(U) \\subset V$. Thus we think of $f|_ U : U \\to V$ as a morphism into $V$. By Properties, Lemma 28.2.1 we see that $E \\cap V$ is constructible in $V$. By the constructible case we see that $(f|_ U)^{-1}(E \\cap V)$ is constructible in $U$. Since $(f|_ U)^{-1}(E \\cap V) = f^{-1}(E) \\cap U$ we win. \n      $\\square$\n    \n","\n  Lemma 29.22.1. Let $f : X \\to Y$ be a morphism of schemes. Let $E \\subset Y$ be a subset. If $E$ is (locally) constructible in $Y$, then $f^{-1}(E)$ is (locally) constructible in $X$. \n\n    \n","Proof.\n      To show that the inverse image of every constructible subset is constructible it suffices to show that the inverse image of every retrocompact open $V$ of $Y$ is retrocompact in $X$, see Topology, Lemma 5.15.3. The significance of $V$ being retrocompact in $Y$ is just that the open immersion $V \\to Y$ is quasi-compact. Hence the base change $f^{-1}(V) = X \\times _ Y V \\to X$ is quasi-compact too, see Schemes, Lemma 26.19.3. Hence we see $f^{-1}(V)$ is retrocompact in $X$. Suppose $E$ is locally constructible in $Y$. Choose $x \\in X$. Choose an affine neighbourhood $V$ of $f(x)$ and an affine neighbourhood $U \\subset X$ of $x$ such that $f(U) \\subset V$. Thus we think of $f|_ U : U \\to V$ as a morphism into $V$. By Properties, Lemma 28.2.1 we see that $E \\cap V$ is constructible in $V$. By the constructible case we see that $(f|_ U)^{-1}(E \\cap V)$ is constructible in $U$. Since $(f|_ U)^{-1}(E \\cap V) = f^{-1}(E) \\cap U$ we win. \n      $\\square$\n    \n","
  hs.preimage f.continuous fun t ht ht' ‚Ü¶ IsRetrocompact_iff_isSpectralMap_subtypeVal.mpr
    (quasiCompact_iff_isSpectralMap.mp
    (MorphismProperty.of_isPullback (P := @QuasiCompact)
    (isPullback_morphismRestrict f ‚ü®t, ht‚ü©)
    (quasiCompact_iff_isSpectralMap.mpr (IsRetrocompact_iff_isSpectralMap_subtypeVal.mp ht'))))
","lemma Scheme.Hom.isConstructible_preimage (f : X ‚ü∂ Y) {s : Set Y} (hs : IsConstructible s) :
    IsConstructible (f ‚Åª¬π' s) ","Proof.\n      To show that the inverse image of every constructible subset is constructible it suffices to show that the inverse image of every retrocompact open $V$ of $Y$ is retrocompact in $X$, see Topology, Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. The significance of $V$ being retrocompact in $Y$ is just that the open immersion $V \\to Y$ is quasi-compact. Hence the base change $f^{-1}(V) = X \\times _ Y V \\to X$ is quasi-compact too, see Schemes, Lemma 26.19.3 [[\n  Lemma 26.19.3. Being quasi-compact is a property of morphisms of schemes over a base which is preserved under arbitrary base change. \n\n    \n]]. Hence we see $f^{-1}(V)$ is retrocompact in $X$. Suppose $E$ is locally constructible in $Y$. Choose $x \\in X$. Choose an affine neighbourhood $V$ of $f(x)$ and an affine neighbourhood $U \\subset X$ of $x$ such that $f(U) \\subset V$. Thus we think of $f|_ U : U \\to V$ as a morphism into $V$. By Properties, Lemma 28.2.1 [[\n  Lemma 28.2.1. Let $X$ be a scheme. A subset $E$ of $X$ is locally constructible in $X$ if and only if $E \\cap U$ is constructible in $U$ for every affine open $U$ of $X$. \n\n    \n]] we see that $E \\cap V$ is constructible in $V$. By the constructible case we see that $(f|_ U)^{-1}(E \\cap V)$ is constructible in $U$. Since $(f|_ U)^{-1}(E \\cap V) = f^{-1}(E) \\cap U$ we win. \n      $\\square$\n    \n","Proof.\n      To show that the inverse image of every constructible subset is constructible it suffices to show that the inverse image of every retrocompact open $V$ of $Y$ is retrocompact in $X$, see Topology, Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. The significance of $V$ being retrocompact in $Y$ is just that the open immersion $V \\to Y$ is quasi-compact. Hence the base change $f^{-1}(V) = X \\times _ Y V \\to X$ is quasi-compact too, see Schemes, Lemma 26.19.3 [[\n  Lemma 26.19.3. Being quasi-compact is a property of morphisms of schemes over a base which is preserved under arbitrary base change. \n\n    \n]]. Hence we see $f^{-1}(V)$ is retrocompact in $X$. Suppose $E$ is locally constructible in $Y$. Choose $x \\in X$. Choose an affine neighbourhood $V$ of $f(x)$ and an affine neighbourhood $U \\subset X$ of $x$ such that $f(U) \\subset V$. Thus we think of $f|_ U : U \\to V$ as a morphism into $V$. By Properties, Lemma 28.2.1 [[\n  Lemma 28.2.1. Let $X$ be a scheme. A subset $E$ of $X$ is locally constructible in $X$ if and only if $E \\cap U$ is constructible in $U$ for every affine open $U$ of $X$. \n\n    \n]] we see that $E \\cap V$ is constructible in $V$. By the constructible case we see that $(f|_ U)^{-1}(E \\cap V)$ is constructible in $U$. Since $(f|_ U)^{-1}(E \\cap V) = f^{-1}(E) \\cap U$ we win. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is focused on the key sub-argument from the informal proof: preimages of retrocompact opens are retrocompact, via the equivalence ‚Äúretrocompact open immersion ‚Üî spectral map/subtypeVal‚Äù and stability of quasi-compactness under pullback (base change). The code uses `hs.preimage f.continuous` (a lemma reducing constructible-preimage to checking retrocompact opens) and then proves retrocompactness of the preimage by translating retrocompactness to a quasi-compact/spectral-map condition and applying `MorphismProperty.of_isPullback` with `isPullback_morphismRestrict` (the base change step).\n\nStructurally, it matches the first paragraph of the informal proof (Lemma 5.15.3 reduction + quasi-compactness preserved under base change ‚áí preimage retrocompact). However, the informal proof continues with an additional argument about locally constructible sets using affine neighborhoods and restriction to affines; none of that appears in the Lean snippet. So the formal proof aligns with a substantial part but not the full informal proof, and it omits the later local/affine reduction steps.""}"
44,02JY,"lemma isQuotientMap_of_surjective {X Y : Scheme.{u}} (f : X ‚ü∂ Y) [Flat f] [QuasiCompact f]
    [Surjective f] : Topology.IsQuotientMap f := by
  rw [Topology.isQuotientMap_iff]
  refine ‚ü®f.surjective, fun s ‚Ü¶ ‚ü®fun hs ‚Ü¶ hs.preimage f.continuous, fun hs ‚Ü¶ ?_‚ü©‚ü©
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ let ùí∞ := Y.affineCover
    rw [ùí∞.isOpenCover_opensRange.isOpen_iff_inter]
    intro i
    rw [Scheme.Hom.coe_opensRange, ‚Üê Set.image_preimage_eq_inter_range]
    apply (ùí∞.f i).isOpenEmbedding.isOpenMap
    refine this (f := pullback.fst (ùí∞.f i) f) _ ?_ ‚ü®_, rfl‚ü©
    rw [‚Üê Set.preimage_comp, ‚Üê TopCat.coe_comp, ‚Üê Scheme.Hom.comp_base, pullback.condition,
      Scheme.Hom.comp_base, TopCat.coe_comp, Set.preimage_comp]
    exact hs.preimage (Scheme.Hom.continuous _)
  obtain ‚ü®R, rfl‚ü© := hY
  wlog hX : ‚àÉ S, X = Spec S
  ¬∑ have _ : CompactSpace X := QuasiCompact.compactSpace_of_compactSpace f
    let ùí∞ := X.affineCover.finiteSubcover
    let p : ‚àê (fun i : ùí∞.I‚ÇÄ ‚Ü¶ ùí∞.X i) ‚ü∂ X := Sigma.desc (fun i ‚Ü¶ ùí∞.f i)
    refine this (f := (‚àê (fun i : ùí∞.I‚ÇÄ ‚Ü¶ ùí∞.X i)).isoSpec.inv ‚â´ p ‚â´ f) _ _ ?_ ‚ü®_, rfl‚ü©
    rw [‚Üê Category.assoc, Scheme.Hom.comp_base, TopCat.coe_comp, Set.preimage_comp]
    exact hs.preimage (_ ‚â´ p).continuous
  obtain ‚ü®S, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.map_surjective f
  refine ((PrimeSpectrum.isQuotientMap_of_generalizingMap ?_ ?_).isOpen_preimage).mp hs
  ¬∑ exact (surjective_iff (Spec.map œÜ)).mp inferInstance
  ¬∑ apply RingHom.Flat.generalizingMap_comap
    rwa [‚Üê HasRingHomProperty.Spec_iff (P := @Flat)]
",Formal Proof of Stacks Project Tag 02JY,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Flat.lean#L102-L129,Q27041,,29.25.12,lemma,3.0,"['01U2', '01QL', '0ELP']","\n       \n      \n  Lemma 29.25.12. Let $f : X \\to Y$ be a quasi-compact, surjective, flat morphism. A subset $T \\subset Y$ is open (resp. closed) if and only $f^{-1}(T)$ is open (resp. closed). In other words, $f$ is a submersive morphism. \n\n    \n      Proof.\n      The question is local on $Y$, hence we may assume that $Y$ is affine. In this case $X$ is quasi-compact as $f$ is quasi-compact. Write $X = X_1 \\cup \\ldots \\cup X_ n$ as a finite union of affine opens. Then $f\' : X\' = X_1 \\amalg \\ldots \\amalg X_ n \\to Y$ is a surjective flat morphism of affine schemes. Note that for $T \\subset Y$ we have $(f\')^{-1}(T) = f^{-1}(T) \\cap X_1 \\amalg \\ldots \\amalg f^{-1}(T) \\cap X_ n$. Hence, $f^{-1}(T)$ is open if and only if $(f\')^{-1}(T)$ is open. Thus we may assume both $X$ and $Y$ are affine. \n    \n      Let $f : \\mathop{\\mathrm{Spec}}(B) \\to \\mathop{\\mathrm{Spec}}(A)$ be a surjective morphism of affine schemes corresponding to a flat ring map $A \\to B$. Suppose that $f^{-1}(T)$ is closed, say $f^{-1}(T) = V(J)$ for $J \\subset B$ an ideal. Then $T = f(f^{-1}(T)) = f(V(J))$ is the image of $\\mathop{\\mathrm{Spec}}(B/J) \\to \\mathop{\\mathrm{Spec}}(A)$ (here we use that $f$ is surjective). On the other hand, generalizations lift along $f$ (Lemma 29.25.9). Hence by Topology, Lemma 5.19.6 we see that $Y \\setminus T = f(X \\setminus f^{-1}(T))$ is stable under generalization. Hence $T$ is stable under specialization (Topology, Lemma 5.19.2). Thus $T$ is closed by Algebra, Lemma 10.41.5. \n      $\\square$\n    \n","\n       \n      \n  Lemma 29.25.12. Let $f : X \\to Y$ be a quasi-compact, surjective, flat morphism. A subset $T \\subset Y$ is open (resp. closed) if and only $f^{-1}(T)$ is open (resp. closed). In other words, $f$ is a submersive morphism. \n\n    \n","Proof.\n      The question is local on $Y$, hence we may assume that $Y$ is affine. In this case $X$ is quasi-compact as $f$ is quasi-compact. Write $X = X_1 \\cup \\ldots \\cup X_ n$ as a finite union of affine opens. Then $f\' : X\' = X_1 \\amalg \\ldots \\amalg X_ n \\to Y$ is a surjective flat morphism of affine schemes. Note that for $T \\subset Y$ we have $(f\')^{-1}(T) = f^{-1}(T) \\cap X_1 \\amalg \\ldots \\amalg f^{-1}(T) \\cap X_ n$. Hence, $f^{-1}(T)$ is open if and only if $(f\')^{-1}(T)$ is open. Thus we may assume both $X$ and $Y$ are affine. \n    \n      Let $f : \\mathop{\\mathrm{Spec}}(B) \\to \\mathop{\\mathrm{Spec}}(A)$ be a surjective morphism of affine schemes corresponding to a flat ring map $A \\to B$. Suppose that $f^{-1}(T)$ is closed, say $f^{-1}(T) = V(J)$ for $J \\subset B$ an ideal. Then $T = f(f^{-1}(T)) = f(V(J))$ is the image of $\\mathop{\\mathrm{Spec}}(B/J) \\to \\mathop{\\mathrm{Spec}}(A)$ (here we use that $f$ is surjective). On the other hand, generalizations lift along $f$ (Lemma 29.25.9). Hence by Topology, Lemma 5.19.6 we see that $Y \\setminus T = f(X \\setminus f^{-1}(T))$ is stable under generalization. Hence $T$ is stable under specialization (Topology, Lemma 5.19.2). Thus $T$ is closed by Algebra, Lemma 10.41.5. \n      $\\square$\n    \n"," by
  rw [Topology.isQuotientMap_iff]
  refine ‚ü®f.surjective, fun s ‚Ü¶ ‚ü®fun hs ‚Ü¶ hs.preimage f.continuous, fun hs ‚Ü¶ ?_‚ü©‚ü©
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ let ùí∞ := Y.affineCover
    rw [ùí∞.isOpenCover_opensRange.isOpen_iff_inter]
    intro i
    rw [Scheme.Hom.coe_opensRange, ‚Üê Set.image_preimage_eq_inter_range]
    apply (ùí∞.f i).isOpenEmbedding.isOpenMap
    refine this (f := pullback.fst (ùí∞.f i) f) _ ?_ ‚ü®_, rfl‚ü©
    rw [‚Üê Set.preimage_comp, ‚Üê TopCat.coe_comp, ‚Üê Scheme.Hom.comp_base, pullback.condition,
      Scheme.Hom.comp_base, TopCat.coe_comp, Set.preimage_comp]
    exact hs.preimage (Scheme.Hom.continuous _)
  obtain ‚ü®R, rfl‚ü© := hY
  wlog hX : ‚àÉ S, X = Spec S
  ¬∑ have _ : CompactSpace X := QuasiCompact.compactSpace_of_compactSpace f
    let ùí∞ := X.affineCover.finiteSubcover
    let p : ‚àê (fun i : ùí∞.I‚ÇÄ ‚Ü¶ ùí∞.X i) ‚ü∂ X := Sigma.desc (fun i ‚Ü¶ ùí∞.f i)
    refine this (f := (‚àê (fun i : ùí∞.I‚ÇÄ ‚Ü¶ ùí∞.X i)).isoSpec.inv ‚â´ p ‚â´ f) _ _ ?_ ‚ü®_, rfl‚ü©
    rw [‚Üê Category.assoc, Scheme.Hom.comp_base, TopCat.coe_comp, Set.preimage_comp]
    exact hs.preimage (_ ‚â´ p).continuous
  obtain ‚ü®S, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.map_surjective f
  refine ((PrimeSpectrum.isQuotientMap_of_generalizingMap ?_ ?_).isOpen_preimage).mp hs
  ¬∑ exact (surjective_iff (Spec.map œÜ)).mp inferInstance
  ¬∑ apply RingHom.Flat.generalizingMap_comap
    rwa [‚Üê HasRingHomProperty.Spec_iff (P := @Flat)]
","lemma isQuotientMap_of_surjective {X Y : Scheme.{u}} (f : X ‚ü∂ Y) [Flat f] [QuasiCompact f]
    [Surjective f] : Topology.IsQuotientMap f ","Proof.\n      The question is local on $Y$, hence we may assume that $Y$ is affine. In this case $X$ is quasi-compact as $f$ is quasi-compact. Write $X = X_1 \\cup \\ldots \\cup X_ n$ as a finite union of affine opens. Then $f\' : X\' = X_1 \\amalg \\ldots \\amalg X_ n \\to Y$ is a surjective flat morphism of affine schemes. Note that for $T \\subset Y$ we have $(f\')^{-1}(T) = f^{-1}(T) \\cap X_1 \\amalg \\ldots \\amalg f^{-1}(T) \\cap X_ n$. Hence, $f^{-1}(T)$ is open if and only if $(f\')^{-1}(T)$ is open. Thus we may assume both $X$ and $Y$ are affine. \n    \n      Let $f : \\mathop{\\mathrm{Spec}}(B) \\to \\mathop{\\mathrm{Spec}}(A)$ be a surjective morphism of affine schemes corresponding to a flat ring map $A \\to B$. Suppose that $f^{-1}(T)$ is closed, say $f^{-1}(T) = V(J)$ for $J \\subset B$ an ideal. Then $T = f(f^{-1}(T)) = f(V(J))$ is the image of $\\mathop{\\mathrm{Spec}}(B/J) \\to \\mathop{\\mathrm{Spec}}(A)$ (here we use that $f$ is surjective). On the other hand, generalizations lift along $f$ (Lemma 29.25.9 [[\n  Lemma 29.25.9. Let $f : X \\to S$ be a flat morphism of schemes. Then generalizations lift along $f$, see Topology, Definition 5.19.4. \n\n    \n]]). Hence by Topology, Lemma 5.19.6 [[\n  Lemma 5.19.6. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf specializations lift along $f$, and if $T \\subset X$ is stable under specialization, then $f(T) \\subset Y$ is stable under specialization. \n\n\nIf generalizations lift along $f$, and if $T \\subset X$ is stable under generalization, then $f(T) \\subset Y$ is stable under generalization. \n\n\n\n\n    \n]] we see that $Y \\setminus T = f(X \\setminus f^{-1}(T))$ is stable under generalization. Hence $T$ is stable under specialization (Topology, Lemma 5.19.2 [[\n  Lemma 5.19.2. Let $X$ be a topological space. \n  \n  \nAny closed subset of $X$ is stable under specialization. \n\n\nAny open subset of $X$ is stable under generalization. \n\n\nA subset $T \\subset X$ is stable under specialization if and only if the complement $T^ c$ is stable under generalization. \n\n\n\n\n    \n]]). Thus $T$ is closed by Algebra, Lemma 10.41.5 [[\n  Lemma 10.41.5. Let $R \\to S$ be a ring map. Let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be the image of $\\mathop{\\mathrm{Spec}}(S)$. If $T$ is stable under specialization, then $T$ is closed. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      The question is local on $Y$, hence we may assume that $Y$ is affine. In this case $X$ is quasi-compact as $f$ is quasi-compact. Write $X = X_1 \\cup \\ldots \\cup X_ n$ as a finite union of affine opens. Then $f\' : X\' = X_1 \\amalg \\ldots \\amalg X_ n \\to Y$ is a surjective flat morphism of affine schemes. Note that for $T \\subset Y$ we have $(f\')^{-1}(T) = f^{-1}(T) \\cap X_1 \\amalg \\ldots \\amalg f^{-1}(T) \\cap X_ n$. Hence, $f^{-1}(T)$ is open if and only if $(f\')^{-1}(T)$ is open. Thus we may assume both $X$ and $Y$ are affine. \n    \n      Let $f : \\mathop{\\mathrm{Spec}}(B) \\to \\mathop{\\mathrm{Spec}}(A)$ be a surjective morphism of affine schemes corresponding to a flat ring map $A \\to B$. Suppose that $f^{-1}(T)$ is closed, say $f^{-1}(T) = V(J)$ for $J \\subset B$ an ideal. Then $T = f(f^{-1}(T)) = f(V(J))$ is the image of $\\mathop{\\mathrm{Spec}}(B/J) \\to \\mathop{\\mathrm{Spec}}(A)$ (here we use that $f$ is surjective). On the other hand, generalizations lift along $f$ (Lemma 29.25.9 [[\n  Lemma 29.25.9. Let $f : X \\to S$ be a flat morphism of schemes. Then generalizations lift along $f$, see Topology, Definition 5.19.4. \n\n    \n]]). Hence by Topology, Lemma 5.19.6 [[\n  Lemma 5.19.6. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf specializations lift along $f$, and if $T \\subset X$ is stable under specialization, then $f(T) \\subset Y$ is stable under specialization. \n\n\nIf generalizations lift along $f$, and if $T \\subset X$ is stable under generalization, then $f(T) \\subset Y$ is stable under generalization. \n\n\n\n\n    \n]] we see that $Y \\setminus T = f(X \\setminus f^{-1}(T))$ is stable under generalization. Hence $T$ is stable under specialization (Topology, Lemma 5.19.2 [[\n  Lemma 5.19.2. Let $X$ be a topological space. \n  \n  \nAny closed subset of $X$ is stable under specialization. \n\n\nAny open subset of $X$ is stable under generalization. \n\n\nA subset $T \\subset X$ is stable under specialization if and only if the complement $T^ c$ is stable under generalization. \n\n\n\n\n    \n]]). Thus $T$ is closed by Algebra, Lemma 10.41.5 [[\n  Lemma 10.41.5. Let $R \\to S$ be a ring map. Let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be the image of $\\mathop{\\mathrm{Spec}}(S)$. If $T$ is stable under specialization, then $T$ is closed. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish that a surjective flat morphism of schemes is a quotient map by showing the key topological criterion: a subset of Y is open iff its preimage in X is open. The Lean proof rewrites to `Topology.isQuotientMap_iff`, uses surjectivity, and reduces the openness condition to the affine case (first local-on-target via an affine cover of Y, then quasi-compactness to reduce X to a finite affine cover, then replacing X by a disjoint union of affines). It then identifies the affine morphism with `Spec.map œÜ` and applies `PrimeSpectrum.isQuotientMap_of_generalizingMap` together with the fact that flat maps are generalizing (`RingHom.Flat.generalizingMap_comap`). Structurally, this matches the informal reductions to Y affine and then X affine via finite affine cover, and the use of ‚Äúgeneralizations lift along f‚Äù to conclude the needed topological property.\n\nThe main mismatch is that the informal proof argues via closed sets/images and stability under specialization/generalization (invoking several lemmas about images being closed when stable under specialization), whereas the Lean proof bypasses that route and directly uses an existing lemma that a surjective generalizing map of prime spectra is a quotient map, then extracts the open-preimage characterization. So the core idea (flat ‚áí generalizing ‚áí quotient) aligns, but the intermediate specialization/closed-image argument is not mirrored in the formal proof.""}"
45,02VW,"lemma epi_of_flat_of_surjective (f : X ‚ü∂ Y) [Flat f] [Surjective f] : Epi f := by
  apply CategoryTheory.Functor.epi_of_epi_map (Scheme.forgetToLocallyRingedSpace)
  apply CategoryTheory.Functor.epi_of_epi_map (LocallyRingedSpace.forgetToSheafedSpace)
  apply SheafedSpace.epi_of_base_surjective_of_stalk_mono _ ‚ÄπSurjective f‚Ä∫.surj
  intro x
  apply ConcreteCategory.mono_of_injective
  algebraize [(f.stalkMap x).hom]
  have : Module.FaithfullyFlat (Y.presheaf.stalk (f x)) (X.presheaf.stalk x) :=
    @Module.FaithfullyFlat.of_flat_of_isLocalHom _ _ _ _ _ _ _
      (Flat.stalkMap f x) (f.toLRSHom.prop x)
  exact ‚ÄπRingHom.FaithfullyFlat _‚Ä∫.injective
",Formal Proof of Stacks Project Tag 02VW,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Flat.lean#L133-L143,Q27041,,35.35.1,lemma,3.0,"['02VV', '0238', '0ELP']","\n  Lemma 35.35.1. A surjective and flat morphism is an epimorphism in the category of schemes. \n\n    \n      Proof.\n      Suppose we have $h : X\' \\to X$ surjective and flat and $a, b : X \\to Y$ morphisms such that $a \\circ h = b \\circ h$. As $h$ is surjective we see that $a$ and $b$ agree on underlying topological spaces. Pick $x\' \\in X\'$ and set $x = h(x\')$ and $y = a(x) = b(x)$. Consider the local ring maps \n    \n      \n  \\[  a^\\sharp _ x, b^\\sharp _ x : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}  \\]\n\n    \n       These become equal when composed with the flat local homomorphism $h^\\sharp _{x\'} : \\mathcal{O}_{X, x} \\to \\mathcal{O}_{X\', x\'}$. Since a flat local homomorphism is faithfully flat (Algebra, Lemma 10.39.17) we conclude that $h^\\sharp _{x\'}$ is injective. Hence $a^\\sharp _ x = b^\\sharp _ x$ which implies $a = b$ as desired. \n      $\\square$\n    \n",\n  Lemma 35.35.1. A surjective and flat morphism is an epimorphism in the category of schemes. \n\n    \n,"Proof.\n      Suppose we have $h : X\' \\to X$ surjective and flat and $a, b : X \\to Y$ morphisms such that $a \\circ h = b \\circ h$. As $h$ is surjective we see that $a$ and $b$ agree on underlying topological spaces. Pick $x\' \\in X\'$ and set $x = h(x\')$ and $y = a(x) = b(x)$. Consider the local ring maps \n    \n      \n  \\[  a^\\sharp _ x, b^\\sharp _ x : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}  \\]\n\n    \n       These become equal when composed with the flat local homomorphism $h^\\sharp _{x\'} : \\mathcal{O}_{X, x} \\to \\mathcal{O}_{X\', x\'}$. Since a flat local homomorphism is faithfully flat (Algebra, Lemma 10.39.17) we conclude that $h^\\sharp _{x\'}$ is injective. Hence $a^\\sharp _ x = b^\\sharp _ x$ which implies $a = b$ as desired. \n      $\\square$\n    \n"," by
  apply CategoryTheory.Functor.epi_of_epi_map (Scheme.forgetToLocallyRingedSpace)
  apply CategoryTheory.Functor.epi_of_epi_map (LocallyRingedSpace.forgetToSheafedSpace)
  apply SheafedSpace.epi_of_base_surjective_of_stalk_mono _ ‚ÄπSurjective f‚Ä∫.surj
  intro x
  apply ConcreteCategory.mono_of_injective
  algebraize [(f.stalkMap x).hom]
  have : Module.FaithfullyFlat (Y.presheaf.stalk (f x)) (X.presheaf.stalk x) :=
    @Module.FaithfullyFlat.of_flat_of_isLocalHom _ _ _ _ _ _ _
      (Flat.stalkMap f x) (f.toLRSHom.prop x)
  exact ‚ÄπRingHom.FaithfullyFlat _‚Ä∫.injective
",lemma epi_of_flat_of_surjective (f : X ‚ü∂ Y) [Flat f] [Surjective f] : Epi f ,"Proof.\n      Suppose we have $h : X\' \\to X$ surjective and flat and $a, b : X \\to Y$ morphisms such that $a \\circ h = b \\circ h$. As $h$ is surjective we see that $a$ and $b$ agree on underlying topological spaces. Pick $x\' \\in X\'$ and set $x = h(x\')$ and $y = a(x) = b(x)$. Consider the local ring maps \n    \n      \n  \\[  a^\\sharp _ x, b^\\sharp _ x : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}  \\]\n\n    \n       These become equal when composed with the flat local homomorphism $h^\\sharp _{x\'} : \\mathcal{O}_{X, x} \\to \\mathcal{O}_{X\', x\'}$. Since a flat local homomorphism is faithfully flat (Algebra, Lemma 10.39.17 [[\n  Lemma 10.39.17. A flat local ring homomorphism of local rings is faithfully flat. \n\n    \n]]) we conclude that $h^\\sharp _{x\'}$ is injective. Hence $a^\\sharp _ x = b^\\sharp _ x$ which implies $a = b$ as desired. \n      $\\square$\n    \n","Proof.\n      Suppose we have $h : X\' \\to X$ surjective and flat and $a, b : X \\to Y$ morphisms such that $a \\circ h = b \\circ h$. As $h$ is surjective we see that $a$ and $b$ agree on underlying topological spaces. Pick $x\' \\in X\'$ and set $x = h(x\')$ and $y = a(x) = b(x)$. Consider the local ring maps \n    \n      \n  \\[  a^\\sharp _ x, b^\\sharp _ x : \\mathcal{O}_{Y, y} \\to \\mathcal{O}_{X, x}  \\]\n\n    \n       These become equal when composed with the flat local homomorphism $h^\\sharp _{x\'} : \\mathcal{O}_{X, x} \\to \\mathcal{O}_{X\', x\'}$. Since a flat local homomorphism is faithfully flat (Algebra, Lemma 10.39.17 [[\n  Lemma 10.39.17. A flat local ring homomorphism of local rings is faithfully flat. \n\n    \n]]) we conclude that $h^\\sharp _{x\'}$ is injective. Hence $a^\\sharp _ x = b^\\sharp _ x$ which implies $a = b$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish that a morphism (here f/h) is an epimorphism by using surjectivity on the underlying space and injectivity on stalk maps coming from faithful flatness: the informal proof argues that equality after composing with a surjective flat map forces equality on topological spaces and then on local ring maps via injectivity of a faithfully flat local hom; the Lean proof reduces epi in `Scheme` to epi in `SheafedSpace`, applies `epi_of_base_surjective_of_stalk_mono` using `Surjective f`, and proves each stalk map is mono by showing it is injective, deriving injectivity from `Module.FaithfullyFlat.of_flat_of_isLocalHom` applied to `Flat.stalkMap f x` and the local-hom property. Structurally, Lean follows the same two-step pattern (base surjective + stalk mono) though it is phrased categorically (epi via forgetful functors) rather than via explicit cancellation with a test morphism `h`. A minor mismatch is that the informal proof explicitly uses a cancellation setup with morphisms a,b and a surjective flat h, while the Lean proof directly proves epi via a general lemma about sheafed spaces; also the informal proof mentions composing with h to get equality, whereas Lean uses faithful flatness to get injectivity of the stalk map itself. Overall the key mathematical content aligns well, with some difference in presentation and level of abstraction.""}"
46,02KS,"instance descendsAlong_universallyClosed_surjective_inf_flat_inf_quasicompact :
    DescendsAlong @UniversallyClosed (@Surjective ‚äì @Flat ‚äì @QuasiCompact) := by
  refine IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact _ _ ?_ ?_
  ¬∑ rw [inf_comm]
    exact inf_le_inf le_rfl (IsLocalIso.le_of_isZariskiLocalAtSource _)
  refine fun {R} S Y œÜ g ‚ü®_, _‚ü© hfst ‚Ü¶ ‚ü®universally_mk' _ _ fun {T} f _ s hs ‚Ü¶ ?_‚ü©
  let p := pullback.fst (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g)
  let r : pullback (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g) ‚ü∂ pullback f g :=
    pullback.map _ _ _ _ (pullback.snd _ _) (pullback.snd _ _) (Spec.map œÜ) (pullback.condition ..)
      (pullback.condition ..)
  have : IsClosed ((pullback.snd (Spec.map œÜ) f).base ‚Åª¬π' ((pullback.fst f g).base '' s)) := by
    rw [‚Üê Scheme.image_preimage_eq_of_isPullback (isPullback_map_snd_snd ..)]
    exact p.isClosedMap _ (hs.preimage r.continuous)
  rwa [(Flat.isQuotientMap_of_surjective _).isClosed_preimage] at this
",Formal Proof of Stacks Project Tag 02KS,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FlatDescent.lean#L46-L59,Q27041,,35.23.3,lemma,3.0,"['02YJ', '0238', '0ELP']","\n  Lemma 35.23.3. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally closed\xe2\x80\x9d is fpqc local on the base. \n\n    \n      Proof.\n      A base change of a universally closed morphism is universally closed by definition. Being universally closed is Zariski local on the base (from the definition or by Morphisms, Lemma 29.41.2). Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally closed. Let $T \\to S$ be any morphism. Consider the diagram \n    \n      \n  \\[  \\xymatrix{ X\' \\ar[d] &  S\' \\times _ S T \\times _ S X \\ar[d] \\ar[r] \\ar[l] &  T \\times _ S X \\ar[d] \\\\  S\' &  S\' \\times _ S T \\ar[r] \\ar[l] &  T }  \\]\n\n    \n       in which both squares are cartesian. Thus the assumption implies that the middle vertical arrow is closed. The right horizontal arrows are flat, quasi-compact and surjective (as base changes of $S\' \\to S$). Hence a subset of $T$ is closed if and only if its inverse image in $S\' \\times _ S T$ is closed, see Morphisms, Lemma 29.25.12. An easy diagram chase shows that the right vertical arrow is closed too, and we conclude $X \\to S$ is universally closed. Therefore Lemma 35.22.4 applies and we win. \n      $\\square$\n    \n",\n  Lemma 35.23.3. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally closed\xe2\x80\x9d is fpqc local on the base. \n\n    \n,"Proof.\n      A base change of a universally closed morphism is universally closed by definition. Being universally closed is Zariski local on the base (from the definition or by Morphisms, Lemma 29.41.2). Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally closed. Let $T \\to S$ be any morphism. Consider the diagram \n    \n      \n  \\[  \\xymatrix{ X\' \\ar[d] &  S\' \\times _ S T \\times _ S X \\ar[d] \\ar[r] \\ar[l] &  T \\times _ S X \\ar[d] \\\\  S\' &  S\' \\times _ S T \\ar[r] \\ar[l] &  T }  \\]\n\n    \n       in which both squares are cartesian. Thus the assumption implies that the middle vertical arrow is closed. The right horizontal arrows are flat, quasi-compact and surjective (as base changes of $S\' \\to S$). Hence a subset of $T$ is closed if and only if its inverse image in $S\' \\times _ S T$ is closed, see Morphisms, Lemma 29.25.12. An easy diagram chase shows that the right vertical arrow is closed too, and we conclude $X \\to S$ is universally closed. Therefore Lemma 35.22.4 applies and we win. \n      $\\square$\n    \n"," by
  refine IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact _ _ ?_ ?_
  ¬∑ rw [inf_comm]
    exact inf_le_inf le_rfl (IsLocalIso.le_of_isZariskiLocalAtSource _)
  refine fun {R} S Y œÜ g ‚ü®_, _‚ü© hfst ‚Ü¶ ‚ü®universally_mk' _ _ fun {T} f _ s hs ‚Ü¶ ?_‚ü©
  let p := pullback.fst (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g)
  let r : pullback (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g) ‚ü∂ pullback f g :=
    pullback.map _ _ _ _ (pullback.snd _ _) (pullback.snd _ _) (Spec.map œÜ) (pullback.condition ..)
      (pullback.condition ..)
  have : IsClosed ((pullback.snd (Spec.map œÜ) f).base ‚Åª¬π' ((pullback.fst f g).base '' s)) := by
    rw [‚Üê Scheme.image_preimage_eq_of_isPullback (isPullback_map_snd_snd ..)]
    exact p.isClosedMap _ (hs.preimage r.continuous)
  rwa [(Flat.isQuotientMap_of_surjective _).isClosed_preimage] at this
","instance descendsAlong_universallyClosed_surjective_inf_flat_inf_quasicompact :
    DescendsAlong @UniversallyClosed (@Surjective ‚äì @Flat ‚äì @QuasiCompact) ","Proof.\n      A base change of a universally closed morphism is universally closed by definition. Being universally closed is Zariski local on the base (from the definition or by Morphisms, Lemma 29.41.2 [[\n  Lemma 29.41.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nThe morphism $f$ is universally closed. \n\n\nThere exists an open covering $S = \\bigcup V_ j$ such that $f^{-1}(V_ j) \\to V_ j$ is universally closed for all indices $j$. \n\n\n\n\n    \n]]). Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally closed. Let $T \\to S$ be any morphism. Consider the diagram \n    \n      \n  \\[  \\xymatrix{ X\' \\ar[d] &  S\' \\times _ S T \\times _ S X \\ar[d] \\ar[r] \\ar[l] &  T \\times _ S X \\ar[d] \\\\  S\' &  S\' \\times _ S T \\ar[r] \\ar[l] &  T }  \\]\n\n    \n       in which both squares are cartesian. Thus the assumption implies that the middle vertical arrow is closed. The right horizontal arrows are flat, quasi-compact and surjective (as base changes of $S\' \\to S$). Hence a subset of $T$ is closed if and only if its inverse image in $S\' \\times _ S T$ is closed, see Morphisms, Lemma 29.25.12 [[\n       \n      \n  Lemma 29.25.12. Let $f : X \\to Y$ be a quasi-compact, surjective, flat morphism. A subset $T \\subset Y$ is open (resp. closed) if and only $f^{-1}(T)$ is open (resp. closed). In other words, $f$ is a submersive morphism. \n\n    \n]]. An easy diagram chase shows that the right vertical arrow is closed too, and we conclude $X \\to S$ is universally closed. Therefore Lemma 35.22.4 [[\n  Lemma 35.22.4. Let $\\mathcal{P}$ be a property of morphisms of schemes over a base. Let $\\tau \\in \\{ fpqc, fppf, {\\acute{e}tale}, smooth, syntomic\\} $. Assume that \n  \n  \nthe property is preserved under flat, flat and locally of finite presentation, \xc3\xa9tale, smooth, or syntomic base change depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic (compare with Schemes, Definition 26.18.3), \n\n\nthe property is Zariski local on the base. \n\n\nfor any surjective morphism of affine schemes $S\' \\to S$ which is flat, flat of finite presentation, \xc3\xa9tale, smooth or syntomic depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic, and any morphism of schemes $f : X \\to S$ property $\\mathcal{P}$ holds for $f$ if property $\\mathcal{P}$ holds for the base change $f\' : X\' = S\' \\times _ S X \\to S\'$. \n\n\n\n   Then $\\mathcal{P}$ is $\\tau $ local on the base. \n\n    \n]] applies and we win. \n      $\\square$\n    \n","Proof.\n      A base change of a universally closed morphism is universally closed by definition. Being universally closed is Zariski local on the base (from the definition or by Morphisms, Lemma 29.41.2 [[\n  Lemma 29.41.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nThe morphism $f$ is universally closed. \n\n\nThere exists an open covering $S = \\bigcup V_ j$ such that $f^{-1}(V_ j) \\to V_ j$ is universally closed for all indices $j$. \n\n\n\n\n    \n]]). Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally closed. Let $T \\to S$ be any morphism. Consider the diagram \n    \n      \n  \\[  \\xymatrix{ X\' \\ar[d] &  S\' \\times _ S T \\times _ S X \\ar[d] \\ar[r] \\ar[l] &  T \\times _ S X \\ar[d] \\\\  S\' &  S\' \\times _ S T \\ar[r] \\ar[l] &  T }  \\]\n\n    \n       in which both squares are cartesian. Thus the assumption implies that the middle vertical arrow is closed. The right horizontal arrows are flat, quasi-compact and surjective (as base changes of $S\' \\to S$). Hence a subset of $T$ is closed if and only if its inverse image in $S\' \\times _ S T$ is closed, see Morphisms, Lemma 29.25.12 [[\n       \n      \n  Lemma 29.25.12. Let $f : X \\to Y$ be a quasi-compact, surjective, flat morphism. A subset $T \\subset Y$ is open (resp. closed) if and only $f^{-1}(T)$ is open (resp. closed). In other words, $f$ is a submersive morphism. \n\n    \n]]. An easy diagram chase shows that the right vertical arrow is closed too, and we conclude $X \\to S$ is universally closed. Therefore Lemma 35.22.4 [[\n  Lemma 35.22.4. Let $\\mathcal{P}$ be a property of morphisms of schemes over a base. Let $\\tau \\in \\{ fpqc, fppf, {\\acute{e}tale}, smooth, syntomic\\} $. Assume that \n  \n  \nthe property is preserved under flat, flat and locally of finite presentation, \xc3\xa9tale, smooth, or syntomic base change depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic (compare with Schemes, Definition 26.18.3), \n\n\nthe property is Zariski local on the base. \n\n\nfor any surjective morphism of affine schemes $S\' \\to S$ which is flat, flat of finite presentation, \xc3\xa9tale, smooth or syntomic depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic, and any morphism of schemes $f : X \\to S$ property $\\mathcal{P}$ holds for $f$ if property $\\mathcal{P}$ holds for the base change $f\' : X\' = S\' \\times _ S X \\to S\'$. \n\n\n\n   Then $\\mathcal{P}$ is $\\tau $ local on the base. \n\n    \n]] applies and we win. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is proving descent/locality of the property ‚Äúuniversally closed‚Äù along a flat surjective (fpqc-type) morphism: it uses a Zariski-local descent lemma (`IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact`), then in the affine test situation constructs the relevant pullback maps and proves closedness of a set by pulling back along a surjective flat map and using that such a map is a quotient/submersive map (`Flat.isQuotientMap_of_surjective ... .isClosed_preimage`). This matches the informal argument: reduce to Zariski-locality on the base, then for a flat surjective affine cover show closedness descends by checking preimages in the base change and using the lemma that closedness can be tested after pullback along a qc surjective flat map.\n\nStructurally, both proofs follow the same outline: (1) invoke Zariski-locality on the target/base, (2) reduce to an affine/fiber-product diagram, (3) use that the base-changed morphism is closed and that the horizontal maps are flat qc surjective to descend closedness. The Lean code explicitly builds the pullback morphisms (`p`, `r`) and uses `Scheme.image_preimage_eq_of_isPullback` plus `isClosedMap` to implement the ‚Äúdiagram chase‚Äù.\n\nThe main mismatch is that the informal proof explicitly mentions preservation under base change and then applies a general lemma (Stacks Lemma 35.22.4) to conclude œÑ-locality, whereas the Lean proof directly applies a specific descent/locality combinator and does not explicitly reference the general lemma or the initial remark about base change (it is implicit in the `universally_mk'` construction). Hence not perfectly aligned, but largely consistent.""}"
47,02KT,"instance descendsAlong_universallyOpen_surjective_inf_flat_inf_quasicompact :
    DescendsAlong @UniversallyOpen
      (@Surjective ‚äì @Flat ‚äì @QuasiCompact) := by
  refine IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact _ _ ?_ ?_
  ¬∑ rw [inf_comm]
    exact inf_le_inf le_rfl (IsLocalIso.le_of_isZariskiLocalAtSource _)
  refine fun {R} S Y œÜ g ‚ü®_, _‚ü© hfst ‚Ü¶ ‚ü®universally_mk' _ _ fun {T} f _ s hs ‚Ü¶ ?_‚ü©
  let p := pullback.fst (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g)
  let r : pullback (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g) ‚ü∂ pullback f g :=
    pullback.map _ _ _ _ (pullback.snd _ _) (pullback.snd _ _) (Spec.map œÜ) (pullback.condition ..)
      (pullback.condition ..)
  have : IsOpen ((pullback.snd (Spec.map œÜ) f).base ‚Åª¬π' ((pullback.fst f g).base '' s)) := by
    rw [‚Üê Scheme.image_preimage_eq_of_isPullback (isPullback_map_snd_snd ..)]
    exact p.isOpenMap _ (hs.preimage r.continuous)
  rwa [(Flat.isQuotientMap_of_surjective _).isOpen_preimage] at this
",Formal Proof of Stacks Project Tag 02KT,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FlatDescent.lean#L63-L77,Q27041,,35.23.4,lemma,3.0,"['02YJ', '0238', '0ELP']",\n  Lemma 35.23.4. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally open\xe2\x80\x9d is fpqc local on the base. \n\n    \n      Proof.\n      The proof is the same as the proof of Lemma 35.23.3. \n      $\\square$\n    \n,\n  Lemma 35.23.4. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally open\xe2\x80\x9d is fpqc local on the base. \n\n    \n,Proof.\n      The proof is the same as the proof of Lemma 35.23.3. \n      $\\square$\n    \n," by
  refine IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact _ _ ?_ ?_
  ¬∑ rw [inf_comm]
    exact inf_le_inf le_rfl (IsLocalIso.le_of_isZariskiLocalAtSource _)
  refine fun {R} S Y œÜ g ‚ü®_, _‚ü© hfst ‚Ü¶ ‚ü®universally_mk' _ _ fun {T} f _ s hs ‚Ü¶ ?_‚ü©
  let p := pullback.fst (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g)
  let r : pullback (pullback.fst (Spec.map œÜ) f) (pullback.fst (Spec.map œÜ) g) ‚ü∂ pullback f g :=
    pullback.map _ _ _ _ (pullback.snd _ _) (pullback.snd _ _) (Spec.map œÜ) (pullback.condition ..)
      (pullback.condition ..)
  have : IsOpen ((pullback.snd (Spec.map œÜ) f).base ‚Åª¬π' ((pullback.fst f g).base '' s)) := by
    rw [‚Üê Scheme.image_preimage_eq_of_isPullback (isPullback_map_snd_snd ..)]
    exact p.isOpenMap _ (hs.preimage r.continuous)
  rwa [(Flat.isQuotientMap_of_surjective _).isOpen_preimage] at this
","instance descendsAlong_universallyOpen_surjective_inf_flat_inf_quasicompact :
    DescendsAlong @UniversallyOpen
      (@Surjective ‚äì @Flat ‚äì @QuasiCompact) ",Proof.\n      The proof is the same as the proof of Lemma 35.23.3 [[\n  Lemma 35.23.3. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally closed\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. \n      $\\square$\n    \n,Proof.\n      The proof is the same as the proof of Lemma 35.23.3 [[\n  Lemma 35.23.3. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally closed\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. \n      $\\square$\n    \n,"{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof claims the result follows immediately by repeating the argument of a referenced lemma (about ‚Äúuniversally closed‚Äù being fpqc local on the base), without giving any details. The Lean proof, however, is a detailed construction using `IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact`, pullbacks, open maps, and quotient-map/open-preimage arguments (involving `Flat.isQuotientMap_of_surjective`). Structurally, the informal proof is purely by citation, while the formal proof provides an explicit descent argument with concrete morphisms and topological openness reasoning. While both could be proving the same kind of locality/descent statement, the mismatch in structure (citation vs full proof) and the lack of explicit connection to the referenced lemma in the informal text make the alignment weak.""}"
48,02KW,"instance descendsAlong_universallyInjective_surjective_inf_flat_inf_quasicompact :
    DescendsAlong @UniversallyInjective (@Surjective ‚äì @Flat ‚äì @QuasiCompact) := by
  rw [universallyInjective_eq_diagonal]
  infer_instance
",Formal Proof of Stacks Project Tag 02KW,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FlatDescent.lean#L81-L84,Q27041,,35.23.10,lemma,3.0,"['02YJ', '0238', '0ELP']","\n  Lemma 35.23.10. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally injective\xe2\x80\x9d is fpqc local on the base. \n\n    \n      Proof.\n      A base change of a universally injective morphism is universally injective (this is formal). Being universally injective is Zariski local on the base; this is clear from the definition. Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally injective. Let $K$ be a field, and let $a, b : \\mathop{\\mathrm{Spec}}(K) \\to X$ be two morphisms such that $f \\circ a = f \\circ b$. As $S\' \\to S$ is surjective and by the discussion in Schemes, Section 26.13 there exists a field extension $K\'/K$ and a morphism $\\mathop{\\mathrm{Spec}}(K\') \\to S\'$ such that the following solid diagram commutes \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K\') \\ar[rrd] \\ar@{-->}[rd]_{a\', b\'} \\ar[dd] \\\\  &  X\' \\ar[r] \\ar[d] &  S\' \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(K) \\ar[r]^{a, b} &  X \\ar[r] &  S }  \\]\n\n    \n       As the square is cartesian we get the two dotted arrows $a\'$, $b\'$ making the diagram commute. Since $X\' \\to S\'$ is universally injective we get $a\' = b\'$, by Morphisms, Lemma 29.10.2. Clearly this forces $a = b$ (by the discussion in Schemes, Section 26.13). Therefore Lemma 35.22.4 applies and we win. \n    \n      An alternative proof would be to use the characterization of a universally injective morphism as one whose diagonal is surjective, see Morphisms, Lemma 29.10.2. The lemma then follows from the fact that the property of being surjective is fpqc local on the base, see Lemma 35.23.7. (Hint: use that the base change of the diagonal is the diagonal of the base change.) \n      $\\square$\n    \n",\n  Lemma 35.23.10. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally injective\xe2\x80\x9d is fpqc local on the base. \n\n    \n,"Proof.\n      A base change of a universally injective morphism is universally injective (this is formal). Being universally injective is Zariski local on the base; this is clear from the definition. Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally injective. Let $K$ be a field, and let $a, b : \\mathop{\\mathrm{Spec}}(K) \\to X$ be two morphisms such that $f \\circ a = f \\circ b$. As $S\' \\to S$ is surjective and by the discussion in Schemes, Section 26.13 there exists a field extension $K\'/K$ and a morphism $\\mathop{\\mathrm{Spec}}(K\') \\to S\'$ such that the following solid diagram commutes \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K\') \\ar[rrd] \\ar@{-->}[rd]_{a\', b\'} \\ar[dd] \\\\  &  X\' \\ar[r] \\ar[d] &  S\' \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(K) \\ar[r]^{a, b} &  X \\ar[r] &  S }  \\]\n\n    \n       As the square is cartesian we get the two dotted arrows $a\'$, $b\'$ making the diagram commute. Since $X\' \\to S\'$ is universally injective we get $a\' = b\'$, by Morphisms, Lemma 29.10.2. Clearly this forces $a = b$ (by the discussion in Schemes, Section 26.13). Therefore Lemma 35.22.4 applies and we win. \n    \n      An alternative proof would be to use the characterization of a universally injective morphism as one whose diagonal is surjective, see Morphisms, Lemma 29.10.2. The lemma then follows from the fact that the property of being surjective is fpqc local on the base, see Lemma 35.23.7. (Hint: use that the base change of the diagonal is the diagonal of the base change.) \n      $\\square$\n    \n"," by
  rw [universallyInjective_eq_diagonal]
  infer_instance
","instance descendsAlong_universallyInjective_surjective_inf_flat_inf_quasicompact :
    DescendsAlong @UniversallyInjective (@Surjective ‚äì @Flat ‚äì @QuasiCompact) ","Proof.\n      A base change of a universally injective morphism is universally injective (this is formal). Being universally injective is Zariski local on the base; this is clear from the definition. Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally injective. Let $K$ be a field, and let $a, b : \\mathop{\\mathrm{Spec}}(K) \\to X$ be two morphisms such that $f \\circ a = f \\circ b$. As $S\' \\to S$ is surjective and by the discussion in Schemes, Section 26.13 [[26.13 Points of schemes\n\n\nGiven a scheme $X$ we can define a functor \n\n\n  \\[  h_ X : \\mathit{Sch}^{opp} \\longrightarrow \\textit{Sets}, \\quad T \\longmapsto \\mathop{\\mathrm{Mor}}\\nolimits (T, X).  \\]\n\n\n See Categories, Example 4.3.4. This is called the functor of points of $X$. A fun part of scheme theory is to find descriptions of the internal geometry of $X$ in terms of this functor $h_ X$. In this section we find a simple way to describe points of $X$. \n\n\nLet $X$ be a scheme. Let $R$ be a local ring with maximal ideal $\\mathfrak m \\subset R$. Suppose that $f : \\mathop{\\mathrm{Spec}}(R) \\to X$ is a morphism of schemes. Let $x \\in X$ be the image of the closed point $\\mathfrak m \\in \\mathop{\\mathrm{Spec}}(R)$. Then we obtain a local homomorphism of local rings \n\n\n  \\[  f^\\sharp : \\mathcal{O}_{X, x} \\longrightarrow \\mathcal{O}_{\\mathop{\\mathrm{Spec}}(R), \\mathfrak m} = R.  \\]\n\n\n\n  Lemma 26.13.1. Let $X$ be a scheme. Let $R$ be a local ring. The construction above gives a bijective correspondence between morphisms $\\mathop{\\mathrm{Spec}}(R) \\to X$ and pairs $(x, \\varphi )$ consisting of a point $x \\in X$ and a local homomorphism of local rings $\\varphi : \\mathcal{O}_{X, x} \\to R$. \n \n\n\n    \n]] there exists a field extension $K\'/K$ and a morphism $\\mathop{\\mathrm{Spec}}(K\') \\to S\'$ such that the following solid diagram commutes \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K\') \\ar[rrd] \\ar@{-->}[rd]_{a\', b\'} \\ar[dd] \\\\  &  X\' \\ar[r] \\ar[d] &  S\' \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(K) \\ar[r]^{a, b} &  X \\ar[r] &  S }  \\]\n\n    \n       As the square is cartesian we get the two dotted arrows $a\'$, $b\'$ making the diagram commute. Since $X\' \\to S\'$ is universally injective we get $a\' = b\'$, by Morphisms, Lemma 29.10.2 [[\n  Lemma 29.10.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nFor every field $K$ the induced map $\\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), X) \\to \\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), S)$ is injective. \n\n\nThe morphism $f$ is universally injective. \n\n\nThe morphism $f$ is radicial. \n\n\nThe diagonal morphism $\\Delta _{X/S} : X \\longrightarrow X \\times _ S X$ is surjective. \n\n\n\n\n    \n]]. Clearly this forces $a = b$ (by the discussion in Schemes, Section 26.13 [[26.13 Points of schemes\n\n\nGiven a scheme $X$ we can define a functor \n\n\n  \\[  h_ X : \\mathit{Sch}^{opp} \\longrightarrow \\textit{Sets}, \\quad T \\longmapsto \\mathop{\\mathrm{Mor}}\\nolimits (T, X).  \\]\n\n\n See Categories, Example 4.3.4. This is called the functor of points of $X$. A fun part of scheme theory is to find descriptions of the internal geometry of $X$ in terms of this functor $h_ X$. In this section we find a simple way to describe points of $X$. \n\n\nLet $X$ be a scheme. Let $R$ be a local ring with maximal ideal $\\mathfrak m \\subset R$. Suppose that $f : \\mathop{\\mathrm{Spec}}(R) \\to X$ is a morphism of schemes. Let $x \\in X$ be the image of the closed point $\\mathfrak m \\in \\mathop{\\mathrm{Spec}}(R)$. Then we obtain a local homomorphism of local rings \n\n\n  \\[  f^\\sharp : \\mathcal{O}_{X, x} \\longrightarrow \\mathcal{O}_{\\mathop{\\mathrm{Spec}}(R), \\mathfrak m} = R.  \\]\n\n\n\n  Lemma 26.13.1. Let $X$ be a scheme. Let $R$ be a local ring. The construction above gives a bijective correspondence between morphisms $\\mathop{\\mathrm{Spec}}(R) \\to X$ and pairs $(x, \\varphi )$ consisting of a point $x \\in X$ and a local homomorphism of local rings $\\varphi : \\mathcal{O}_{X, x} \\to R$. \n \n\n\n    \n]]). Therefore Lemma 35.22.4 [[\n  Lemma 35.22.4. Let $\\mathcal{P}$ be a property of morphisms of schemes over a base. Let $\\tau \\in \\{ fpqc, fppf, {\\acute{e}tale}, smooth, syntomic\\} $. Assume that \n  \n  \nthe property is preserved under flat, flat and locally of finite presentation, \xc3\xa9tale, smooth, or syntomic base change depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic (compare with Schemes, Definition 26.18.3), \n\n\nthe property is Zariski local on the base. \n\n\nfor any surjective morphism of affine schemes $S\' \\to S$ which is flat, flat of finite presentation, \xc3\xa9tale, smooth or syntomic depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic, and any morphism of schemes $f : X \\to S$ property $\\mathcal{P}$ holds for $f$ if property $\\mathcal{P}$ holds for the base change $f\' : X\' = S\' \\times _ S X \\to S\'$. \n\n\n\n   Then $\\mathcal{P}$ is $\\tau $ local on the base. \n\n    \n]] applies and we win. \n    \n      An alternative proof would be to use the characterization of a universally injective morphism as one whose diagonal is surjective, see Morphisms, Lemma 29.10.2 [[\n  Lemma 29.10.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nFor every field $K$ the induced map $\\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), X) \\to \\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), S)$ is injective. \n\n\nThe morphism $f$ is universally injective. \n\n\nThe morphism $f$ is radicial. \n\n\nThe diagonal morphism $\\Delta _{X/S} : X \\longrightarrow X \\times _ S X$ is surjective. \n\n\n\n\n    \n]]. The lemma then follows from the fact that the property of being surjective is fpqc local on the base, see Lemma 35.23.7 [[\n  Lemma 35.23.7. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is surjective\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. (Hint: use that the base change of the diagonal is the diagonal of the base change.) \n      $\\square$\n    \n","Proof.\n      A base change of a universally injective morphism is universally injective (this is formal). Being universally injective is Zariski local on the base; this is clear from the definition. Finally, let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is universally injective. Let $K$ be a field, and let $a, b : \\mathop{\\mathrm{Spec}}(K) \\to X$ be two morphisms such that $f \\circ a = f \\circ b$. As $S\' \\to S$ is surjective and by the discussion in Schemes, Section 26.13 [[26.13 Points of schemes\n\n\nGiven a scheme $X$ we can define a functor \n\n\n  \\[  h_ X : \\mathit{Sch}^{opp} \\longrightarrow \\textit{Sets}, \\quad T \\longmapsto \\mathop{\\mathrm{Mor}}\\nolimits (T, X).  \\]\n\n\n See Categories, Example 4.3.4. This is called the functor of points of $X$. A fun part of scheme theory is to find descriptions of the internal geometry of $X$ in terms of this functor $h_ X$. In this section we find a simple way to describe points of $X$. \n\n\nLet $X$ be a scheme. Let $R$ be a local ring with maximal ideal $\\mathfrak m \\subset R$. Suppose that $f : \\mathop{\\mathrm{Spec}}(R) \\to X$ is a morphism of schemes. Let $x \\in X$ be the image of the closed point $\\mathfrak m \\in \\mathop{\\mathrm{Spec}}(R)$. Then we obtain a local homomorphism of local rings \n\n\n  \\[  f^\\sharp : \\mathcal{O}_{X, x} \\longrightarrow \\mathcal{O}_{\\mathop{\\mathrm{Spec}}(R), \\mathfrak m} = R.  \\]\n\n\n\n  Lemma 26.13.1. Let $X$ be a scheme. Let $R$ be a local ring. The construction above gives a bijective correspondence between morphisms $\\mathop{\\mathrm{Spec}}(R) \\to X$ and pairs $(x, \\varphi )$ consisting of a point $x \\in X$ and a local homomorphism of local rings $\\varphi : \\mathcal{O}_{X, x} \\to R$. \n \n\n\n    \n]] there exists a field extension $K\'/K$ and a morphism $\\mathop{\\mathrm{Spec}}(K\') \\to S\'$ such that the following solid diagram commutes \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K\') \\ar[rrd] \\ar@{-->}[rd]_{a\', b\'} \\ar[dd] \\\\  &  X\' \\ar[r] \\ar[d] &  S\' \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(K) \\ar[r]^{a, b} &  X \\ar[r] &  S }  \\]\n\n    \n       As the square is cartesian we get the two dotted arrows $a\'$, $b\'$ making the diagram commute. Since $X\' \\to S\'$ is universally injective we get $a\' = b\'$, by Morphisms, Lemma 29.10.2 [[\n  Lemma 29.10.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nFor every field $K$ the induced map $\\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), X) \\to \\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), S)$ is injective. \n\n\nThe morphism $f$ is universally injective. \n\n\nThe morphism $f$ is radicial. \n\n\nThe diagonal morphism $\\Delta _{X/S} : X \\longrightarrow X \\times _ S X$ is surjective. \n\n\n\n\n    \n]]. Clearly this forces $a = b$ (by the discussion in Schemes, Section 26.13 [[26.13 Points of schemes\n\n\nGiven a scheme $X$ we can define a functor \n\n\n  \\[  h_ X : \\mathit{Sch}^{opp} \\longrightarrow \\textit{Sets}, \\quad T \\longmapsto \\mathop{\\mathrm{Mor}}\\nolimits (T, X).  \\]\n\n\n See Categories, Example 4.3.4. This is called the functor of points of $X$. A fun part of scheme theory is to find descriptions of the internal geometry of $X$ in terms of this functor $h_ X$. In this section we find a simple way to describe points of $X$. \n\n\nLet $X$ be a scheme. Let $R$ be a local ring with maximal ideal $\\mathfrak m \\subset R$. Suppose that $f : \\mathop{\\mathrm{Spec}}(R) \\to X$ is a morphism of schemes. Let $x \\in X$ be the image of the closed point $\\mathfrak m \\in \\mathop{\\mathrm{Spec}}(R)$. Then we obtain a local homomorphism of local rings \n\n\n  \\[  f^\\sharp : \\mathcal{O}_{X, x} \\longrightarrow \\mathcal{O}_{\\mathop{\\mathrm{Spec}}(R), \\mathfrak m} = R.  \\]\n\n\n\n  Lemma 26.13.1. Let $X$ be a scheme. Let $R$ be a local ring. The construction above gives a bijective correspondence between morphisms $\\mathop{\\mathrm{Spec}}(R) \\to X$ and pairs $(x, \\varphi )$ consisting of a point $x \\in X$ and a local homomorphism of local rings $\\varphi : \\mathcal{O}_{X, x} \\to R$. \n \n\n\n    \n]]). Therefore Lemma 35.22.4 [[\n  Lemma 35.22.4. Let $\\mathcal{P}$ be a property of morphisms of schemes over a base. Let $\\tau \\in \\{ fpqc, fppf, {\\acute{e}tale}, smooth, syntomic\\} $. Assume that \n  \n  \nthe property is preserved under flat, flat and locally of finite presentation, \xc3\xa9tale, smooth, or syntomic base change depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic (compare with Schemes, Definition 26.18.3), \n\n\nthe property is Zariski local on the base. \n\n\nfor any surjective morphism of affine schemes $S\' \\to S$ which is flat, flat of finite presentation, \xc3\xa9tale, smooth or syntomic depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic, and any morphism of schemes $f : X \\to S$ property $\\mathcal{P}$ holds for $f$ if property $\\mathcal{P}$ holds for the base change $f\' : X\' = S\' \\times _ S X \\to S\'$. \n\n\n\n   Then $\\mathcal{P}$ is $\\tau $ local on the base. \n\n    \n]] applies and we win. \n    \n      An alternative proof would be to use the characterization of a universally injective morphism as one whose diagonal is surjective, see Morphisms, Lemma 29.10.2 [[\n  Lemma 29.10.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent: \n  \n  \nFor every field $K$ the induced map $\\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), X) \\to \\mathop{\\mathrm{Mor}}\\nolimits (\\mathop{\\mathrm{Spec}}(K), S)$ is injective. \n\n\nThe morphism $f$ is universally injective. \n\n\nThe morphism $f$ is radicial. \n\n\nThe diagonal morphism $\\Delta _{X/S} : X \\longrightarrow X \\times _ S X$ is surjective. \n\n\n\n\n    \n]]. The lemma then follows from the fact that the property of being surjective is fpqc local on the base, see Lemma 35.23.7 [[\n  Lemma 35.23.7. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is surjective\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. (Hint: use that the base change of the diagonal is the diagonal of the base change.) \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof reduces the goal to an equivalent characterization via `universallyInjective_eq_diagonal` and then discharges it by typeclass inference (`infer_instance`), which corresponds only to the *alternative* informal argument: ‚Äúuniversally injective iff diagonal is surjective‚Äù and then use fpqc-locality of surjectivity. However, the informal proof‚Äôs main body argues fpqc-locality directly via field-valued points, lifting along a flat surjective affine cover, and then invokes a general descent lemma (35.22.4). None of that structure appears in the Lean proof. Structurally, the Lean proof is a one-line rewrite + instance search, so it does not mirror the multi-step descent/lifting argument; it matches at best the final alternative route, and even then it hides the surjectivity-fpqc-local step inside `infer_instance` without reflecting the explicit reasoning.""}"
49,02L4,"instance descendsAlong_isomorphisms_surjective_inf_flat_inf_quasicompact :
    (isomorphisms Scheme.{u}).DescendsAlong (@Surjective ‚äì @Flat ‚äì @QuasiCompact) := by
  apply IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact
  ¬∑ rw [inf_comm]
    exact inf_le_inf le_rfl (IsLocalIso.le_of_isZariskiLocalAtSource _)
  intro R S Y œÜ g h (hfst : IsIso _)
  have : IsAffine Y :=
    have : UniversallyInjective g :=
      of_pullback_fst_of_descendsAlong (P := @UniversallyInjective) (f := Spec.map œÜ)
        (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) ‚ü®h, inferInstance‚ü© inferInstance
    have : Surjective g :=
      of_pullback_fst_of_descendsAlong (P := @Surjective) (f := Spec.map œÜ)
        (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) ‚ü®h, inferInstance‚ü© inferInstance
    have hopen' : UniversallyOpen g :=
      of_pullback_fst_of_descendsAlong (P := @UniversallyOpen) (f := Spec.map œÜ)
        (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) ‚ü®h, inferInstance‚ü© inferInstance
    have : IsHomeomorph g.base := ‚ü®g.continuous, g.isOpenMap, g.injective, g.surjective‚ü©
    have : IsAffineHom g :=
      isAffineHom_of_isInducing g this.isInducing this.isClosedEmbedding.isClosed_range
    isAffine_of_isAffineHom g
  wlog hY : ‚àÉ T, Y = Spec T generalizing Y
  ¬∑ rw [‚Üê (isomorphisms Scheme).cancel_left_of_respectsIso Y.isoSpec.inv]
    have heq : pullback.fst (Spec.map œÜ) (Y.isoSpec.inv ‚â´ g) =
      pullback.map _ _ _ _ (ùüô _) (Y.isoSpec.inv) (ùüô _) (by simp) (by simp) ‚â´
        pullback.fst (Spec.map œÜ) g := (pullback.lift_fst _ _ _).symm
    refine this _ ?_ inferInstance ‚ü®_, rfl‚ü©
    change isomorphisms Scheme _
    rwa [heq, (isomorphisms Scheme).cancel_left_of_respectsIso]
  obtain ‚ü®T, rfl‚ü© := hY
  obtain ‚ü®œà, rfl‚ü© := Spec.map_surjective g
  refine of_pullback_fst_Spec_of_codescendsAlong (P := isomorphisms Scheme.{u})
      (Q' := RingHom.FaithfullyFlat) (Q := fun f ‚Ü¶ Function.Bijective f) (P' := @Surjective ‚äì @Flat)
      RingHom.FaithfullyFlat.codescendsAlong_bijective ?_ ?_ h hfst
  ¬∑ intro _ _ f hf
    rwa [‚Üê flat_and_surjective_SpecMap_iff, and_comm]
  ¬∑ simp_rw [‚Üê isIso_SpecMap_iff, isomorphisms.iff, implies_true]
",Formal Proof of Stacks Project Tag 02L4,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FlatDescent.lean#L88-L123,Q27041,,35.23.19,lemma,3.0,"['02YJ', '0238', '0ELP']",\n  Lemma 35.23.19. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an isomorphism\xe2\x80\x9d is fpqc local on the base. \n\n    \n      Proof.\n      Combine Lemmas 35.23.7 and 35.23.18. \n      $\\square$\n    \n,\n  Lemma 35.23.19. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an isomorphism\xe2\x80\x9d is fpqc local on the base. \n\n    \n,Proof.\n      Combine Lemmas 35.23.7 and 35.23.18. \n      $\\square$\n    \n," by
  apply IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact
  ¬∑ rw [inf_comm]
    exact inf_le_inf le_rfl (IsLocalIso.le_of_isZariskiLocalAtSource _)
  intro R S Y œÜ g h (hfst : IsIso _)
  have : IsAffine Y :=
    have : UniversallyInjective g :=
      of_pullback_fst_of_descendsAlong (P := @UniversallyInjective) (f := Spec.map œÜ)
        (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) ‚ü®h, inferInstance‚ü© inferInstance
    have : Surjective g :=
      of_pullback_fst_of_descendsAlong (P := @Surjective) (f := Spec.map œÜ)
        (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) ‚ü®h, inferInstance‚ü© inferInstance
    have hopen' : UniversallyOpen g :=
      of_pullback_fst_of_descendsAlong (P := @UniversallyOpen) (f := Spec.map œÜ)
        (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) ‚ü®h, inferInstance‚ü© inferInstance
    have : IsHomeomorph g.base := ‚ü®g.continuous, g.isOpenMap, g.injective, g.surjective‚ü©
    have : IsAffineHom g :=
      isAffineHom_of_isInducing g this.isInducing this.isClosedEmbedding.isClosed_range
    isAffine_of_isAffineHom g
  wlog hY : ‚àÉ T, Y = Spec T generalizing Y
  ¬∑ rw [‚Üê (isomorphisms Scheme).cancel_left_of_respectsIso Y.isoSpec.inv]
    have heq : pullback.fst (Spec.map œÜ) (Y.isoSpec.inv ‚â´ g) =
      pullback.map _ _ _ _ (ùüô _) (Y.isoSpec.inv) (ùüô _) (by simp) (by simp) ‚â´
        pullback.fst (Spec.map œÜ) g := (pullback.lift_fst _ _ _).symm
    refine this _ ?_ inferInstance ‚ü®_, rfl‚ü©
    change isomorphisms Scheme _
    rwa [heq, (isomorphisms Scheme).cancel_left_of_respectsIso]
  obtain ‚ü®T, rfl‚ü© := hY
  obtain ‚ü®œà, rfl‚ü© := Spec.map_surjective g
  refine of_pullback_fst_Spec_of_codescendsAlong (P := isomorphisms Scheme.{u})
      (Q' := RingHom.FaithfullyFlat) (Q := fun f ‚Ü¶ Function.Bijective f) (P' := @Surjective ‚äì @Flat)
      RingHom.FaithfullyFlat.codescendsAlong_bijective ?_ ?_ h hfst
  ¬∑ intro _ _ f hf
    rwa [‚Üê flat_and_surjective_SpecMap_iff, and_comm]
  ¬∑ simp_rw [‚Üê isIso_SpecMap_iff, isomorphisms.iff, implies_true]
","instance descendsAlong_isomorphisms_surjective_inf_flat_inf_quasicompact :
    (isomorphisms Scheme.{u}).DescendsAlong (@Surjective ‚äì @Flat ‚äì @QuasiCompact) ",Proof.\n      Combine Lemmas 35.23.7 [[\n  Lemma 35.23.7. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is surjective\xe2\x80\x9d is fpqc local on the base. \n\n    \n]] and 35.23.18 [[\n  Lemma 35.23.18. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an open immersion\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. \n      $\\square$\n    \n,Proof.\n      Combine Lemmas 35.23.7 [[\n  Lemma 35.23.7. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is surjective\xe2\x80\x9d is fpqc local on the base. \n\n    \n]] and 35.23.18 [[\n  Lemma 35.23.18. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an open immersion\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. \n      $\\square$\n    \n,"{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof claims the result follows by combining two lemmas: surjectivity is fpqc-local on the base and open immersion is fpqc-local on the base. The formal proof instead sets up a much more elaborate descent/codescent argument: it uses `IsZariskiLocalAtTarget.descendsAlong_inf_quasiCompact`, proves affineness of an intermediate scheme via universally injective/surjective/universally open leading to a homeomorphism and `IsAffineHom`, then reduces to the affine case `Y = Spec T`, and finally applies a codescent lemma for isomorphisms along faithfully flat ring maps, with conditions expressed via `Surjective ‚äì Flat` and bijectivity.\n\nStructurally, the informal proof is a short ‚Äúcombine two locality lemmas‚Äù argument, while the formal proof is a multi-step reduction (Zariski-local descent, affineness, wlog Spec, then ring-level codescent). Although surjectivity and flat/fpqc-style descent appear in the formal proof, there is no clear use of an ‚Äúopen immersion is fpqc local‚Äù lemma; instead the endpoint seems to be about isomorphisms/Spec maps and faithfully flat descent. Thus the formal proof only partially overlaps with the informal outline and appears to be proving a stronger/different statement or using a different strategy.""}"
50,02L3,"instance descendsAlong_isOpenImmersion_surjective_inf_flat_inf_quasicompact' :
    IsOpenImmersion.DescendsAlong (@Surjective ‚äì @Flat ‚äì @QuasiCompact) := by
  apply DescendsAlong.mk'
  intro X Y Z f g _ hf hg
  have : UniversallyOpen g :=
    MorphismProperty.of_pullback_fst_of_descendsAlong
      (P := @UniversallyOpen) (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) (f := f)
      hf inferInstance
  let U : Z.Opens := ‚ü®Set.range g.base, g.isOpenMap.isOpen_range‚ü©
  let f' := pullback.snd f U.Œπ
  let g' : Y ‚ü∂ U := IsOpenImmersion.lift U.Œπ g (by simp [U])
  have : Surjective g' := ‚ü®fun ‚ü®x, ‚ü®y, hy‚ü©‚ü© ‚Ü¶
    ‚ü®y, by apply U.Œπ.injective; simp [‚Üê Scheme.Hom.comp_apply, g', hy]‚ü©‚ü©
  have : IsIso (pullback.fst f' g') := by
    rw [isIso_iff_isOpenImmersion_and_surjective]
    refine ‚ü®?_, inferInstance‚ü©
    have : IsOpenImmersion (pullback.fst f (g' ‚â´ U.Œπ)) := by
      rwa [AlgebraicGeometry.IsOpenImmersion.lift_fac]
    have : IsOpenImmersion (pullback.fst f' g' ‚â´ pullback.fst f U.Œπ) := by
      rw [‚Üê pullbackLeftPullbackSndIso_hom_fst]
      infer_instance
    exact .of_comp _ (pullback.fst _ _)
  have : IsIso g' := by
    apply MorphismProperty.of_pullback_fst_of_descendsAlong
      (P := isomorphisms Scheme) (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) (f := f') ?_ this
    exact MorphismProperty.pullback_snd _ _ hf
  rw [‚Üê IsOpenImmersion.lift_fac U.Œπ g (by simp [U])]
  infer_instance
",Formal Proof of Stacks Project Tag 02L3,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FlatDescent.lean#L127-L154,Q27041,,35.23.18,lemma,3.0,"['02YJ', '0238', '0ELP']","\n  Lemma 35.23.18. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an open immersion\xe2\x80\x9d is fpqc local on the base. \n\n    \n      Proof.\n      The property of being an open immersion is stable under base change, see Schemes, Lemma 26.18.2. The property of being an open immersion is Zariski local on the base (this is obvious). \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is an open immersion. We claim that $f$ is an open immersion. Then $f\'$ is universally open, and universally injective. Hence we conclude that $f$ is universally open by Lemma 35.23.4, and universally injective by Lemma 35.23.10. In particular $f(X) \\subset S$ is open. If for every affine open $U \\subset f(X)$ we can prove that $f^{-1}(U) \\to U$ is an isomorphism, then $f$ is an open immersion and we\'re done. If $U\' \\subset S\'$ denotes the inverse image of $U$, then $U\' \\to U$ is a faithfully flat morphism of affines and $(f\')^{-1}(U\') \\to U\'$ is an isomorphism (as $f\'(X\')$ contains $U\'$ by our choice of $U$). Thus we reduce to the case discussed in the next paragraph. \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, let $f : X \\to S$ be a morphism, and assume that the base change $f\' : X\' \\to S\'$ is an isomorphism. We have to show that $f$ is an isomorphism also. It is clear that $f$ is surjective, universally injective, and universally open (see arguments above for the last two). Hence $f$ is bijective, i.e., $f$ is a homeomorphism. Thus $f$ is affine by Morphisms, Lemma 29.45.4. Since \n    \n      \n  \\[  \\mathcal{O}(S\') \\to \\mathcal{O}(X\') = \\mathcal{O}(S\') \\otimes _{\\mathcal{O}(S)} \\mathcal{O}(X)  \\]\n\n    \n       is an isomorphism and since $\\mathcal{O}(S) \\to \\mathcal{O}(S\')$ is faithfully flat this implies that $\\mathcal{O}(S) \\to \\mathcal{O}(X)$ is an isomorphism. Thus $f$ is an isomorphism. This finishes the proof of the claim above. Therefore Lemma 35.22.4 applies and we win. \n      $\\square$\n    \n",\n  Lemma 35.23.18. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an open immersion\xe2\x80\x9d is fpqc local on the base. \n\n    \n,"Proof.\n      The property of being an open immersion is stable under base change, see Schemes, Lemma 26.18.2. The property of being an open immersion is Zariski local on the base (this is obvious). \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is an open immersion. We claim that $f$ is an open immersion. Then $f\'$ is universally open, and universally injective. Hence we conclude that $f$ is universally open by Lemma 35.23.4, and universally injective by Lemma 35.23.10. In particular $f(X) \\subset S$ is open. If for every affine open $U \\subset f(X)$ we can prove that $f^{-1}(U) \\to U$ is an isomorphism, then $f$ is an open immersion and we\'re done. If $U\' \\subset S\'$ denotes the inverse image of $U$, then $U\' \\to U$ is a faithfully flat morphism of affines and $(f\')^{-1}(U\') \\to U\'$ is an isomorphism (as $f\'(X\')$ contains $U\'$ by our choice of $U$). Thus we reduce to the case discussed in the next paragraph. \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, let $f : X \\to S$ be a morphism, and assume that the base change $f\' : X\' \\to S\'$ is an isomorphism. We have to show that $f$ is an isomorphism also. It is clear that $f$ is surjective, universally injective, and universally open (see arguments above for the last two). Hence $f$ is bijective, i.e., $f$ is a homeomorphism. Thus $f$ is affine by Morphisms, Lemma 29.45.4. Since \n    \n      \n  \\[  \\mathcal{O}(S\') \\to \\mathcal{O}(X\') = \\mathcal{O}(S\') \\otimes _{\\mathcal{O}(S)} \\mathcal{O}(X)  \\]\n\n    \n       is an isomorphism and since $\\mathcal{O}(S) \\to \\mathcal{O}(S\')$ is faithfully flat this implies that $\\mathcal{O}(S) \\to \\mathcal{O}(X)$ is an isomorphism. Thus $f$ is an isomorphism. This finishes the proof of the claim above. Therefore Lemma 35.22.4 applies and we win. \n      $\\square$\n    \n"," by
  apply DescendsAlong.mk'
  intro X Y Z f g _ hf hg
  have : UniversallyOpen g :=
    MorphismProperty.of_pullback_fst_of_descendsAlong
      (P := @UniversallyOpen) (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) (f := f)
      hf inferInstance
  let U : Z.Opens := ‚ü®Set.range g.base, g.isOpenMap.isOpen_range‚ü©
  let f' := pullback.snd f U.Œπ
  let g' : Y ‚ü∂ U := IsOpenImmersion.lift U.Œπ g (by simp [U])
  have : Surjective g' := ‚ü®fun ‚ü®x, ‚ü®y, hy‚ü©‚ü© ‚Ü¶
    ‚ü®y, by apply U.Œπ.injective; simp [‚Üê Scheme.Hom.comp_apply, g', hy]‚ü©‚ü©
  have : IsIso (pullback.fst f' g') := by
    rw [isIso_iff_isOpenImmersion_and_surjective]
    refine ‚ü®?_, inferInstance‚ü©
    have : IsOpenImmersion (pullback.fst f (g' ‚â´ U.Œπ)) := by
      rwa [AlgebraicGeometry.IsOpenImmersion.lift_fac]
    have : IsOpenImmersion (pullback.fst f' g' ‚â´ pullback.fst f U.Œπ) := by
      rw [‚Üê pullbackLeftPullbackSndIso_hom_fst]
      infer_instance
    exact .of_comp _ (pullback.fst _ _)
  have : IsIso g' := by
    apply MorphismProperty.of_pullback_fst_of_descendsAlong
      (P := isomorphisms Scheme) (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) (f := f') ?_ this
    exact MorphismProperty.pullback_snd _ _ hf
  rw [‚Üê IsOpenImmersion.lift_fac U.Œπ g (by simp [U])]
  infer_instance
","instance descendsAlong_isOpenImmersion_surjective_inf_flat_inf_quasicompact' :
    IsOpenImmersion.DescendsAlong (@Surjective ‚äì @Flat ‚äì @QuasiCompact) ","Proof.\n      The property of being an open immersion is stable under base change, see Schemes, Lemma 26.18.2 [[\n  Lemma 26.18.2. Let $S$ be a scheme. Let $f : X \\to Y$ be an immersion (resp. closed immersion, resp. open immersion) of schemes over $S$. Then any base change of $f$ is an immersion (resp. closed immersion, resp. open immersion). \n\n    \n]]. The property of being an open immersion is Zariski local on the base (this is obvious). \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is an open immersion. We claim that $f$ is an open immersion. Then $f\'$ is universally open, and universally injective. Hence we conclude that $f$ is universally open by Lemma 35.23.4 [[\n  Lemma 35.23.4. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally open\xe2\x80\x9d is fpqc local on the base. \n\n    \n]], and universally injective by Lemma 35.23.10 [[\n  Lemma 35.23.10. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally injective\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. In particular $f(X) \\subset S$ is open. If for every affine open $U \\subset f(X)$ we can prove that $f^{-1}(U) \\to U$ is an isomorphism, then $f$ is an open immersion and we\'re done. If $U\' \\subset S\'$ denotes the inverse image of $U$, then $U\' \\to U$ is a faithfully flat morphism of affines and $(f\')^{-1}(U\') \\to U\'$ is an isomorphism (as $f\'(X\')$ contains $U\'$ by our choice of $U$). Thus we reduce to the case discussed in the next paragraph. \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, let $f : X \\to S$ be a morphism, and assume that the base change $f\' : X\' \\to S\'$ is an isomorphism. We have to show that $f$ is an isomorphism also. It is clear that $f$ is surjective, universally injective, and universally open (see arguments above for the last two). Hence $f$ is bijective, i.e., $f$ is a homeomorphism. Thus $f$ is affine by Morphisms, Lemma 29.45.4 [[\n  Lemma 29.45.4. Let $f : X \\to Y$ be a morphism of schemes. If $f$ is a homeomorphism onto a closed subset of $Y$ then $f$ is affine. \n\n    \n]]. Since \n    \n      \n  \\[  \\mathcal{O}(S\') \\to \\mathcal{O}(X\') = \\mathcal{O}(S\') \\otimes _{\\mathcal{O}(S)} \\mathcal{O}(X)  \\]\n\n    \n       is an isomorphism and since $\\mathcal{O}(S) \\to \\mathcal{O}(S\')$ is faithfully flat this implies that $\\mathcal{O}(S) \\to \\mathcal{O}(X)$ is an isomorphism. Thus $f$ is an isomorphism. This finishes the proof of the claim above. Therefore Lemma 35.22.4 [[\n  Lemma 35.22.4. Let $\\mathcal{P}$ be a property of morphisms of schemes over a base. Let $\\tau \\in \\{ fpqc, fppf, {\\acute{e}tale}, smooth, syntomic\\} $. Assume that \n  \n  \nthe property is preserved under flat, flat and locally of finite presentation, \xc3\xa9tale, smooth, or syntomic base change depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic (compare with Schemes, Definition 26.18.3), \n\n\nthe property is Zariski local on the base. \n\n\nfor any surjective morphism of affine schemes $S\' \\to S$ which is flat, flat of finite presentation, \xc3\xa9tale, smooth or syntomic depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic, and any morphism of schemes $f : X \\to S$ property $\\mathcal{P}$ holds for $f$ if property $\\mathcal{P}$ holds for the base change $f\' : X\' = S\' \\times _ S X \\to S\'$. \n\n\n\n   Then $\\mathcal{P}$ is $\\tau $ local on the base. \n\n    \n]] applies and we win. \n      $\\square$\n    \n","Proof.\n      The property of being an open immersion is stable under base change, see Schemes, Lemma 26.18.2 [[\n  Lemma 26.18.2. Let $S$ be a scheme. Let $f : X \\to Y$ be an immersion (resp. closed immersion, resp. open immersion) of schemes over $S$. Then any base change of $f$ is an immersion (resp. closed immersion, resp. open immersion). \n\n    \n]]. The property of being an open immersion is Zariski local on the base (this is obvious). \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, and let $f : X \\to S$ be a morphism. Assume that the base change $f\' : X\' \\to S\'$ is an open immersion. We claim that $f$ is an open immersion. Then $f\'$ is universally open, and universally injective. Hence we conclude that $f$ is universally open by Lemma 35.23.4 [[\n  Lemma 35.23.4. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally open\xe2\x80\x9d is fpqc local on the base. \n\n    \n]], and universally injective by Lemma 35.23.10 [[\n  Lemma 35.23.10. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is universally injective\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. In particular $f(X) \\subset S$ is open. If for every affine open $U \\subset f(X)$ we can prove that $f^{-1}(U) \\to U$ is an isomorphism, then $f$ is an open immersion and we\'re done. If $U\' \\subset S\'$ denotes the inverse image of $U$, then $U\' \\to U$ is a faithfully flat morphism of affines and $(f\')^{-1}(U\') \\to U\'$ is an isomorphism (as $f\'(X\')$ contains $U\'$ by our choice of $U$). Thus we reduce to the case discussed in the next paragraph. \n    \n      Let $S\' \\to S$ be a flat surjective morphism of affine schemes, let $f : X \\to S$ be a morphism, and assume that the base change $f\' : X\' \\to S\'$ is an isomorphism. We have to show that $f$ is an isomorphism also. It is clear that $f$ is surjective, universally injective, and universally open (see arguments above for the last two). Hence $f$ is bijective, i.e., $f$ is a homeomorphism. Thus $f$ is affine by Morphisms, Lemma 29.45.4 [[\n  Lemma 29.45.4. Let $f : X \\to Y$ be a morphism of schemes. If $f$ is a homeomorphism onto a closed subset of $Y$ then $f$ is affine. \n\n    \n]]. Since \n    \n      \n  \\[  \\mathcal{O}(S\') \\to \\mathcal{O}(X\') = \\mathcal{O}(S\') \\otimes _{\\mathcal{O}(S)} \\mathcal{O}(X)  \\]\n\n    \n       is an isomorphism and since $\\mathcal{O}(S) \\to \\mathcal{O}(S\')$ is faithfully flat this implies that $\\mathcal{O}(S) \\to \\mathcal{O}(X)$ is an isomorphism. Thus $f$ is an isomorphism. This finishes the proof of the claim above. Therefore Lemma 35.22.4 [[\n  Lemma 35.22.4. Let $\\mathcal{P}$ be a property of morphisms of schemes over a base. Let $\\tau \\in \\{ fpqc, fppf, {\\acute{e}tale}, smooth, syntomic\\} $. Assume that \n  \n  \nthe property is preserved under flat, flat and locally of finite presentation, \xc3\xa9tale, smooth, or syntomic base change depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic (compare with Schemes, Definition 26.18.3), \n\n\nthe property is Zariski local on the base. \n\n\nfor any surjective morphism of affine schemes $S\' \\to S$ which is flat, flat of finite presentation, \xc3\xa9tale, smooth or syntomic depending on whether $\\tau $ is fpqc, fppf, \xc3\xa9tale, smooth, or syntomic, and any morphism of schemes $f : X \\to S$ property $\\mathcal{P}$ holds for $f$ if property $\\mathcal{P}$ holds for the base change $f\' : X\' = S\' \\times _ S X \\to S\'$. \n\n\n\n   Then $\\mathcal{P}$ is $\\tau $ local on the base. \n\n    \n]] applies and we win. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is proving a descent/locality statement via `DescendsAlong.mk'` for a morphism property, using that `UniversallyOpen` descends along a cover and then constructing an open subset `U = range g` and reducing to showing certain pullback maps are isomorphisms using surjectivity and open immersion criteria. This matches part of the informal argument: deducing openness of the image from universal openness and then reducing to checking isomorphism on affine opens via a faithfully flat cover.\n\nHowever, the informal proof is specifically about the property ‚Äúopen immersion‚Äù being fpqc-local on the base, and it crucially uses both universal openness and universal injectivity, plus an affineness + faithfully flat descent argument on rings to conclude an isomorphism. The Lean proof instead works with `UniversallyOpen` and then shows an isomorphism of a certain pullback projection using `isIso_iff_isOpenImmersion_and_surjective`, and finally concludes an `IsOpenImmersion` instance via `infer_instance`. There is no explicit universal injectivity step, no affineness/ring-level descent, and the cover class in Lean is `Surjective ‚äì Flat ‚äì QuasiCompact` (fpqc-like) but the structure is more specialized (using range-open subset and pullback isomorphisms) than the staged reduction in the informal proof.\n\nStructurally, both proofs use descent along a flat surjective cover and reduction to an isomorphism criterion on a base change, but the Lean proof omits several key intermediate claims present in the informal proof and uses different lemmas/criteria to finish. Hence partial but not perfect alignment.""}"
51,06NC,"lemma Flat.isIso_of_surjective_of_mono {X Y : Scheme.{u}} (f : X ‚ü∂ Y) [Flat f]
    [QuasiCompact f] [Surjective f] [Mono f] : IsIso f := by
  apply MorphismProperty.of_pullback_fst_of_descendsAlong
    (P := isomorphisms Scheme.{u}) (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) (f := f) (g := f)
  ¬∑ tauto
  ¬∑ exact inferInstanceAs <| IsIso (pullback.fst f f)
",Formal Proof of Stacks Project Tag 06NC,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/FlatMono.lean#L25-L30,Q27041,,35.25.1,lemma,3.0,"['02LB', '0238', '0ELP']","\n  Lemma 35.25.1. Let $f : X \\to Y$ be a flat, quasi-compact, surjective monomorphism. Then f is an isomorphism. \n\n    \n      Proof.\n      As $f$ is a flat, quasi-compact, surjective morphism we see $\\{ X \\to Y\\} $ is an fpqc covering of $Y$. The diagonal $\\Delta : X \\to X \\times _ Y X$ is an isomorphism (Schemes, Lemma 26.23.2). This implies that the base change of $f$ by $f$ is an isomorphism. Hence we see $f$ is an isomorphism by Lemma 35.23.19. \n      $\\square$\n    \n","\n  Lemma 35.25.1. Let $f : X \\to Y$ be a flat, quasi-compact, surjective monomorphism. Then f is an isomorphism. \n\n    \n","Proof.\n      As $f$ is a flat, quasi-compact, surjective morphism we see $\\{ X \\to Y\\} $ is an fpqc covering of $Y$. The diagonal $\\Delta : X \\to X \\times _ Y X$ is an isomorphism (Schemes, Lemma 26.23.2). This implies that the base change of $f$ by $f$ is an isomorphism. Hence we see $f$ is an isomorphism by Lemma 35.23.19. \n      $\\square$\n    \n"," by
  apply MorphismProperty.of_pullback_fst_of_descendsAlong
    (P := isomorphisms Scheme.{u}) (Q := @Surjective ‚äì @Flat ‚äì @QuasiCompact) (f := f) (g := f)
  ¬∑ tauto
  ¬∑ exact inferInstanceAs <| IsIso (pullback.fst f f)
","lemma Flat.isIso_of_surjective_of_mono {X Y : Scheme.{u}} (f : X ‚ü∂ Y) [Flat f]
    [QuasiCompact f] [Surjective f] [Mono f] : IsIso f ","Proof.\n      As $f$ is a flat, quasi-compact, surjective morphism we see $\\{ X \\to Y\\} $ is an fpqc covering of $Y$. The diagonal $\\Delta : X \\to X \\times _ Y X$ is an isomorphism (Schemes, Lemma 26.23.2 [[\n       \n      \n  Lemma 26.23.2. Let $j : X \\to Y$ be a morphism of schemes. Then $j$ is a monomorphism if and only if the diagonal morphism $\\Delta _{X/Y} : X \\to X \\times _ Y X$ is an isomorphism. \n\n    \n]]). This implies that the base change of $f$ by $f$ is an isomorphism. Hence we see $f$ is an isomorphism by Lemma 35.23.19 [[\n  Lemma 35.23.19. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an isomorphism\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      As $f$ is a flat, quasi-compact, surjective morphism we see $\\{ X \\to Y\\} $ is an fpqc covering of $Y$. The diagonal $\\Delta : X \\to X \\times _ Y X$ is an isomorphism (Schemes, Lemma 26.23.2 [[\n       \n      \n  Lemma 26.23.2. Let $j : X \\to Y$ be a morphism of schemes. Then $j$ is a monomorphism if and only if the diagonal morphism $\\Delta _{X/Y} : X \\to X \\times _ Y X$ is an isomorphism. \n\n    \n]]). This implies that the base change of $f$ by $f$ is an isomorphism. Hence we see $f$ is an isomorphism by Lemma 35.23.19 [[\n  Lemma 35.23.19. The property $\\mathcal{P}(f) =$\xe2\x80\x9c$f$ is an isomorphism\xe2\x80\x9d is fpqc local on the base. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs aim to show that f is an isomorphism by fpqc descent/locality on the base: the informal proof uses that f is fpqc (flat + quasi-compact + surjective), checks that the base change of f along itself is an isomorphism, and then applies the lemma that ‚Äúisomorphism‚Äù is fpqc-local on the base. The Lean proof matches this overall strategy via `MorphismProperty.of_pullback_fst_of_descendsAlong` with `P := isomorphisms` and `Q := Surjective ‚äì Flat ‚äì QuasiCompact`, discharging the fpqc hypotheses by `tauto` and using that `pullback.fst f f` is an isomorphism. Structurally, however, the informal proof explicitly derives the pullback-isomorphism from the diagonal being an isomorphism (monomorphism criterion), while the Lean proof assumes/provides `IsIso (pullback.fst f f)` directly via typeclass inference, so that intermediate diagonal/monomorphism argument is not reflected. Thus the core descent step aligns well, but the justification for the pullback map being an isomorphism is elided/handled differently.""}"
52,01KJ,"instance : IsImmersion (pullback.diagonal f) := by
  let ùí∞ := Y.affineCover
  let ùí± (i) := (pullback f (ùí∞.f i)).affineCover
  have H : pullback.diagonal f ‚Åª¬π·µÅ diagonalCoverDiagonalRange f ùí∞ ùí± = ‚ä§ :=
    top_le_iff.mp fun _ _ ‚Ü¶ range_diagonal_subset_diagonalCoverDiagonalRange _ _ _ ‚ü®_, rfl‚ü©
  have := isClosedImmersion_diagonal_restrict_diagonalCoverDiagonalRange f ùí∞ ùí±
  have : IsImmersion ((pullback.diagonal f ‚à£_
    diagonalCoverDiagonalRange f ùí∞ ùí±) ‚â´ Scheme.Opens.Œπ _) := inferInstance
  rwa [morphismRestrict_Œπ, H, ‚Üê Scheme.topIso_hom,
    MorphismProperty.cancel_left_of_respectsIso (P := @IsImmersion)] at this
",Formal Proof of Stacks Project Tag 01KJ,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Immersion.lean#L190-L199,Q27041,,26.21.2,lemma,3.0,"['01KH', '01H8', '0ELP']","\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n      Proof.\n      Recall that if $V \\subset X$ is affine open and maps into $U \\subset S$ affine open, then $V \\times _ U V$ is affine open in $X \\times _ S X$, see Lemmas 26.17.2 and 26.17.3. Consider the open subscheme $W$ of $X \\times _ S X$ which is the union of these affine opens $V \\times _ U V$. By Lemma 26.4.2 it is enough to show that each morphism $\\Delta _{X/S}^{-1}(V \\times _ U V) \\to V \\times _ U V$ is a closed immersion. Since $V = \\Delta _{X/S}^{-1}(V \\times _ U V)$ we are just checking that $\\Delta _{V/U}$ is a closed immersion, which is Lemma 26.21.1. \n      $\\square$\n    \n",\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n,"Proof.\n      Recall that if $V \\subset X$ is affine open and maps into $U \\subset S$ affine open, then $V \\times _ U V$ is affine open in $X \\times _ S X$, see Lemmas 26.17.2 and 26.17.3. Consider the open subscheme $W$ of $X \\times _ S X$ which is the union of these affine opens $V \\times _ U V$. By Lemma 26.4.2 it is enough to show that each morphism $\\Delta _{X/S}^{-1}(V \\times _ U V) \\to V \\times _ U V$ is a closed immersion. Since $V = \\Delta _{X/S}^{-1}(V \\times _ U V)$ we are just checking that $\\Delta _{V/U}$ is a closed immersion, which is Lemma 26.21.1. \n      $\\square$\n    \n"," by
  let ùí∞ := Y.affineCover
  let ùí± (i) := (pullback f (ùí∞.f i)).affineCover
  have H : pullback.diagonal f ‚Åª¬π·µÅ diagonalCoverDiagonalRange f ùí∞ ùí± = ‚ä§ :=
    top_le_iff.mp fun _ _ ‚Ü¶ range_diagonal_subset_diagonalCoverDiagonalRange _ _ _ ‚ü®_, rfl‚ü©
  have := isClosedImmersion_diagonal_restrict_diagonalCoverDiagonalRange f ùí∞ ùí±
  have : IsImmersion ((pullback.diagonal f ‚à£_
    diagonalCoverDiagonalRange f ùí∞ ùí±) ‚â´ Scheme.Opens.Œπ _) := inferInstance
  rwa [morphismRestrict_Œπ, H, ‚Üê Scheme.topIso_hom,
    MorphismProperty.cancel_left_of_respectsIso (P := @IsImmersion)] at this
",instance : IsImmersion (pullback.diagonal f) ,"Proof.\n      Recall that if $V \\subset X$ is affine open and maps into $U \\subset S$ affine open, then $V \\times _ U V$ is affine open in $X \\times _ S X$, see Lemmas 26.17.2 [[\n  Lemma 26.17.2. Let $f : X \\to S$ and $g : Y \\to S$ be morphisms of schemes with the same target. If $X, Y, S$ are all affine then $X \\times _ S Y$ is affine. \n\n    \n]] and 26.17.3 [[\n  Lemma 26.17.3. Let $f : X \\to S$ and $g : Y \\to S$ be morphisms of schemes with the same target. Let $X \\times _ S Y$, $p$, $q$ be the fibre product. Suppose that $U \\subset S$, $V \\subset X$, $W \\subset Y$ are open subschemes such that $f(V) \\subset U$ and $g(W) \\subset U$. Then the canonical morphism $V \\times _ U W \\to X \\times _ S Y$ is an open immersion which identifies $V \\times _ U W$ with $p^{-1}(V) \\cap q^{-1}(W)$. \n\n    \n]]. Consider the open subscheme $W$ of $X \\times _ S X$ which is the union of these affine opens $V \\times _ U V$. By Lemma 26.4.2 [[\n  Lemma 26.4.2. Let $f : Z \\to X$ be a morphism of locally ringed spaces. In order for $f$ to be a closed immersion it suffices that there exists an open covering $X = \\bigcup U_ i$ such that each $f : f^{-1}U_ i \\to U_ i$ is a closed immersion. \n\n    \n]] it is enough to show that each morphism $\\Delta _{X/S}^{-1}(V \\times _ U V) \\to V \\times _ U V$ is a closed immersion. Since $V = \\Delta _{X/S}^{-1}(V \\times _ U V)$ we are just checking that $\\Delta _{V/U}$ is a closed immersion, which is Lemma 26.21.1 [[\n  Lemma 26.21.1. The diagonal morphism of a morphism between affines is closed. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Recall that if $V \\subset X$ is affine open and maps into $U \\subset S$ affine open, then $V \\times _ U V$ is affine open in $X \\times _ S X$, see Lemmas 26.17.2 [[\n  Lemma 26.17.2. Let $f : X \\to S$ and $g : Y \\to S$ be morphisms of schemes with the same target. If $X, Y, S$ are all affine then $X \\times _ S Y$ is affine. \n\n    \n]] and 26.17.3 [[\n  Lemma 26.17.3. Let $f : X \\to S$ and $g : Y \\to S$ be morphisms of schemes with the same target. Let $X \\times _ S Y$, $p$, $q$ be the fibre product. Suppose that $U \\subset S$, $V \\subset X$, $W \\subset Y$ are open subschemes such that $f(V) \\subset U$ and $g(W) \\subset U$. Then the canonical morphism $V \\times _ U W \\to X \\times _ S Y$ is an open immersion which identifies $V \\times _ U W$ with $p^{-1}(V) \\cap q^{-1}(W)$. \n\n    \n]]. Consider the open subscheme $W$ of $X \\times _ S X$ which is the union of these affine opens $V \\times _ U V$. By Lemma 26.4.2 [[\n  Lemma 26.4.2. Let $f : Z \\to X$ be a morphism of locally ringed spaces. In order for $f$ to be a closed immersion it suffices that there exists an open covering $X = \\bigcup U_ i$ such that each $f : f^{-1}U_ i \\to U_ i$ is a closed immersion. \n\n    \n]] it is enough to show that each morphism $\\Delta _{X/S}^{-1}(V \\times _ U V) \\to V \\times _ U V$ is a closed immersion. Since $V = \\Delta _{X/S}^{-1}(V \\times _ U V)$ we are just checking that $\\Delta _{V/U}$ is a closed immersion, which is Lemma 26.21.1 [[\n  Lemma 26.21.1. The diagonal morphism of a morphism between affines is closed. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to deduce a global property of the diagonal morphism by restricting to an open cover built from affine pieces coming from an affine cover of the target and affine covers of the pullbacks, and then using a local criterion on those pieces. The Lean proof constructs an affine cover ùí∞ of Y and affine covers ùí± of the pullbacks, identifies the preimage of the chosen open (diagonalCoverDiagonalRange) under the diagonal as ‚ä§ (i.e. the whole source), and then uses a lemma `isClosedImmersion_diagonal_restrict_diagonalCoverDiagonalRange` to obtain an immersion statement for the restricted diagonal, finally cancelling an open immersion/iso to get the desired `IsImmersion` for the diagonal.\n\nStructurally, however, the informal proof is about proving the diagonal is a *closed immersion* by covering X√ó_S X with affines V√ó_U V and applying a lemma that closed immersion is local on the target, reducing to the affine case where the diagonal is closed. The Lean proof instead concludes `IsImmersion` (not explicitly `IsClosedImmersion`) and relies on a prepackaged lemma about the diagonal restricted to the diagonal-cover range, without explicitly mirroring the local-on-target closed-immersion argument or the affine diagonal-closed lemma. Thus there is partial alignment in the covering/restriction strategy, but a mismatch in the stated property and in the detailed reduction steps.""}"
53,01W6,"lemma UniversallyClosed.of_comp_of_isSeparated [UniversallyClosed (f ‚â´ g)] [IsSeparated g] :
    UniversallyClosed f :=
  MorphismProperty.of_postcomp _ _ g ‚Äπ_‚Ä∫ ‚Äπ_‚Ä∫
",Formal Proof of Stacks Project Tag 01W6,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Proper.lean#L105-L107,Q27041,,29.41.7,lemma,3.0,"['01W0', '01QL', '0ELP']","\n  Lemma 29.41.7. Suppose given a commutative diagram of schemes \n  \n  \\[  \\xymatrix{ X \\ar[rr] \\ar[rd] &  &  Y \\ar[ld] \\\\  &  S &  }  \\]\n\n   with $Y$ separated over $S$. \n  \n  \nIf $X \\to S$ is universally closed, then the morphism $X \\to Y$ is universally closed. \n\n\nIf $X$ is proper over $S$, then the morphism $X \\to Y$ is proper. \n\n\n\n   In particular, in both cases the image of $X$ in $Y$ is closed. \n\n    \n      Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10. Hence the first morphism is proper (Lemma 29.41.6). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4). \n      $\\square$\n    \n","\n  Lemma 29.41.7. Suppose given a commutative diagram of schemes \n  \n  \\[  \\xymatrix{ X \\ar[rr] \\ar[rd] &  &  Y \\ar[ld] \\\\  &  S &  }  \\]\n\n   with $Y$ separated over $S$. \n  \n  \nIf $X \\to S$ is universally closed, then the morphism $X \\to Y$ is universally closed. \n\n\nIf $X$ is proper over $S$, then the morphism $X \\to Y$ is proper. \n\n\n\n   In particular, in both cases the image of $X$ in $Y$ is closed. \n\n    \n","Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10. Hence the first morphism is proper (Lemma 29.41.6). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4). \n      $\\square$\n    \n","
  MorphismProperty.of_postcomp _ _ g ‚Äπ_‚Ä∫ ‚Äπ_‚Ä∫
","lemma UniversallyClosed.of_comp_of_isSeparated [UniversallyClosed (f ‚â´ g)] [IsSeparated g] :
    UniversallyClosed f ","Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10 [[\n  Lemma 26.21.10. Let $g : X \\to Y$ be a morphism of schemes over $S$. The morphism $i : X \\to X \\times _ S Y$ is an immersion. If $Y$ is separated over $S$ it is a closed immersion. If $Y$ is quasi-separated over $S$ it is quasi-compact. \n\n    \n]]. Hence the first morphism is proper (Lemma 29.41.6 [[\n  Lemma 29.41.6. A closed immersion is proper, hence a fortiori universally closed. \n\n    \n]]). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5 [[\n  Lemma 29.41.5. The base change of a proper morphism is proper. The same is true for universally closed morphisms. \n\n    \n]]. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4 [[\n  Lemma 29.41.4. The composition of proper morphisms is proper. The same is true for universally closed morphisms. \n\n    \n]]). \n      $\\square$\n    \n","Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10 [[\n  Lemma 26.21.10. Let $g : X \\to Y$ be a morphism of schemes over $S$. The morphism $i : X \\to X \\times _ S Y$ is an immersion. If $Y$ is separated over $S$ it is a closed immersion. If $Y$ is quasi-separated over $S$ it is quasi-compact. \n\n    \n]]. Hence the first morphism is proper (Lemma 29.41.6 [[\n  Lemma 29.41.6. A closed immersion is proper, hence a fortiori universally closed. \n\n    \n]]). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5 [[\n  Lemma 29.41.5. The base change of a proper morphism is proper. The same is true for universally closed morphisms. \n\n    \n]]. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4 [[\n  Lemma 29.41.4. The composition of proper morphisms is proper. The same is true for universally closed morphisms. \n\n    \n]]). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof `MorphismProperty.of_postcomp _ _ g ‚Äπ_‚Ä∫ ‚Äπ_‚Ä∫` establishes a postcomposition/cancellation-type result for a morphism property along a morphism `g`: from hypotheses about the property after composing with `g` (and typically some stability/reflecting condition along `g`), it concludes the property for the original morphism. This matches the *high-level* goal of the informal proof: deducing that `X ‚Üí Y` is universally closed/proper from assumptions about `X ‚Üí S` together with properties of `Y ‚Üí S` (so that one can factor through `X √ó_S Y` and use stability under base change and composition).\n\nStructurally, however, the informal proof is explicit: it constructs the factorization `X ‚Üí X √ó_S Y ‚Üí Y`, proves the first map is a closed immersion hence proper, proves the second is a base change hence proper/universally closed, and then uses closure under composition. None of these steps appear in the Lean term; instead it is a one-line application of a generic lemma `of_postcomp`, so the detailed factorization/base-change/closed-immersion argument is not reflected.\n\nCompleteness/precision: the Lean proof omits the intermediate geometric lemmas cited informally (immersion/closed immersion, closed immersion proper, base change stability, composition stability). It is plausible these are packaged into the `MorphismProperty.of_postcomp` lemma and the provided implicit arguments `‚Äπ_‚Ä∫ ‚Äπ_‚Ä∫`, but this is not evident from the term alone. Hence the alignment is partial rather than perfect.""}"
54,01W6,"lemma IsProper.of_comp [IsProper (f ‚â´ g)] [IsSeparated g] : IsProper f :=
  MorphismProperty.of_postcomp _ _ g ‚Äπ_‚Ä∫ ‚Äπ_‚Ä∫
",Formal Proof of Stacks Project Tag 01W6,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Proper.lean#L114-L115,Q27041,,29.41.7,lemma,3.0,"['01W0', '01QL', '0ELP']","\n  Lemma 29.41.7. Suppose given a commutative diagram of schemes \n  \n  \\[  \\xymatrix{ X \\ar[rr] \\ar[rd] &  &  Y \\ar[ld] \\\\  &  S &  }  \\]\n\n   with $Y$ separated over $S$. \n  \n  \nIf $X \\to S$ is universally closed, then the morphism $X \\to Y$ is universally closed. \n\n\nIf $X$ is proper over $S$, then the morphism $X \\to Y$ is proper. \n\n\n\n   In particular, in both cases the image of $X$ in $Y$ is closed. \n\n    \n      Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10. Hence the first morphism is proper (Lemma 29.41.6). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4). \n      $\\square$\n    \n","\n  Lemma 29.41.7. Suppose given a commutative diagram of schemes \n  \n  \\[  \\xymatrix{ X \\ar[rr] \\ar[rd] &  &  Y \\ar[ld] \\\\  &  S &  }  \\]\n\n   with $Y$ separated over $S$. \n  \n  \nIf $X \\to S$ is universally closed, then the morphism $X \\to Y$ is universally closed. \n\n\nIf $X$ is proper over $S$, then the morphism $X \\to Y$ is proper. \n\n\n\n   In particular, in both cases the image of $X$ in $Y$ is closed. \n\n    \n","Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10. Hence the first morphism is proper (Lemma 29.41.6). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4). \n      $\\square$\n    \n","
  MorphismProperty.of_postcomp _ _ g ‚Äπ_‚Ä∫ ‚Äπ_‚Ä∫
",lemma IsProper.of_comp [IsProper (f ‚â´ g)] [IsSeparated g] : IsProper f ,"Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10 [[\n  Lemma 26.21.10. Let $g : X \\to Y$ be a morphism of schemes over $S$. The morphism $i : X \\to X \\times _ S Y$ is an immersion. If $Y$ is separated over $S$ it is a closed immersion. If $Y$ is quasi-separated over $S$ it is quasi-compact. \n\n    \n]]. Hence the first morphism is proper (Lemma 29.41.6 [[\n  Lemma 29.41.6. A closed immersion is proper, hence a fortiori universally closed. \n\n    \n]]). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5 [[\n  Lemma 29.41.5. The base change of a proper morphism is proper. The same is true for universally closed morphisms. \n\n    \n]]. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4 [[\n  Lemma 29.41.4. The composition of proper morphisms is proper. The same is true for universally closed morphisms. \n\n    \n]]). \n      $\\square$\n    \n","Proof.\n      Assume that $X \\to S$ is universally closed (resp. proper). We factor the morphism as $X \\to X \\times _ S Y \\to Y$. The first morphism is a closed immersion, see Schemes, Lemma 26.21.10 [[\n  Lemma 26.21.10. Let $g : X \\to Y$ be a morphism of schemes over $S$. The morphism $i : X \\to X \\times _ S Y$ is an immersion. If $Y$ is separated over $S$ it is a closed immersion. If $Y$ is quasi-separated over $S$ it is quasi-compact. \n\n    \n]]. Hence the first morphism is proper (Lemma 29.41.6 [[\n  Lemma 29.41.6. A closed immersion is proper, hence a fortiori universally closed. \n\n    \n]]). The projection $X \\times _ S Y \\to Y$ is the base change of a universally closed (resp. proper) morphism and hence universally closed (resp. proper), see Lemma 29.41.5 [[\n  Lemma 29.41.5. The base change of a proper morphism is proper. The same is true for universally closed morphisms. \n\n    \n]]. Thus $X \\to Y$ is universally closed (resp. proper) as the composition of universally closed (resp. proper) morphisms (Lemma 29.41.4 [[\n  Lemma 29.41.4. The composition of proper morphisms is proper. The same is true for universally closed morphisms. \n\n    \n]]). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof `MorphismProperty.of_postcomp _ _ g ‚Äπ_‚Ä∫ ‚Äπ_‚Ä∫` establishes a ‚Äúproperty is stable under postcomposition‚Äù type statement: from hypotheses about a composite with `g` (and typically about `g` itself), it concludes the property for the original morphism. This matches the informal proof‚Äôs overall goal: deducing that `X ‚Üí Y` is universally closed/proper by factoring through `X √ó_S Y ‚Üí Y` and using stability under composition and base change.\n\nStructurally, however, the informal argument is explicit: it constructs the factorization `X ‚Üí X√ó_S Y ‚Üí Y`, proves the first map is a closed immersion hence proper, proves the second is a base change hence proper/universally closed, then concludes by composition. The Lean proof is a one-line application of a general lemma (`of_postcomp`) and does not reflect the intermediate steps (closed immersion, base change, composition) present in the informal proof. So while the end semantic implication is plausibly the same, the formal proof compresses the entire reasoning into a generic lemma application, losing the detailed structure and completeness relative to the informal proof.""}"
55,01K9,"lemma isClosedMap_iff_specializingMap (f : X ‚ü∂ Y) [QuasiCompact f] :
    IsClosedMap f ‚Üî SpecializingMap f := by
  refine ‚ü®fun h ‚Ü¶ h.specializingMap, fun H ‚Ü¶ ?_‚ü©
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ change topologically @IsClosedMap f
    rw [IsZariskiLocalAtTarget.iff_of_openCover (P := topologically @IsClosedMap) Y.affineCover]
    intro i
    have _ : QuasiCompact (Y.affineCover.pullbackHom f i) := MorphismProperty.pullback_snd _ _ ‚Äπ_‚Ä∫
    refine this (Y.affineCover.pullbackHom f i) ?_ ‚ü®_, rfl‚ü©
    exact IsZariskiLocalAtTarget.of_isPullback
      (P := topologically @SpecializingMap) (.of_hasPullback _ _) H
  obtain ‚ü®S, rfl‚ü© := hY
  clear * - H
  intro Z hZ
  replace H := hZ.stableUnderSpecialization.image H
  wlog hX : ‚àÉ R, X = Spec R
  ¬∑ obtain ‚ü®R, g, hg‚ü© := compactSpace_iff_exists.mp (QuasiCompact.compactSpace_of_compactSpace f)
    have inst : QuasiCompact (g ‚â´ f) := HasAffineProperty.iff_of_isAffine.mpr (by infer_instance)
    have := this _ (g ‚â´ f) (g ‚Åª¬π' Z) (hZ.preimage g.continuous)
    simp_rw [Scheme.Hom.comp_base, TopCat.comp_app, ‚Üê Set.image_image,
      Set.image_preimage_eq _ hg] at this
    exact this H ‚ü®_, rfl‚ü©
  obtain ‚ü®R, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.homEquiv.symm.surjective f
  exact PrimeSpectrum.isClosed_image_of_stableUnderSpecialization œÜ.hom Z hZ H
",Formal Proof of Stacks Project Tag 01K9,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/QuasiCompact.lean#L225-L249,Q27041,,26.19.8,lemma,3.0,"['01K2', '01H8', '0ELP']","\n  Lemma 26.19.8. Let $f : X \\to S$ be a quasi-compact morphism of schemes. Then $f$ is closed if and only if specializations lift along $f$, see Topology, Definition 5.19.4. \n\n    \n      Proof.\n      According to Topology, Lemma 5.19.7 if $f$ is closed then specializations lift along $f$. Conversely, suppose that specializations lift along $f$. Let $Z \\subset X$ be a closed subset. We may think of $Z$ as a scheme with the reduced induced scheme structure, see Definition 26.12.5. Since $Z \\subset X$ is closed the restriction of $f$ to $Z$ is still quasi-compact. Moreover specializations lift along $Z \\to S$ as well, see Topology, Lemma 5.19.5. Hence it suffices to prove $f(X)$ is closed if specializations lift along $f$. In particular $f(X)$ is stable under specializations, see Topology, Lemma 5.19.6. Thus $f(X)$ is closed by Lemma 26.19.7. \n      $\\square$\n    \n","\n  Lemma 26.19.8. Let $f : X \\to S$ be a quasi-compact morphism of schemes. Then $f$ is closed if and only if specializations lift along $f$, see Topology, Definition 5.19.4. \n\n    \n","Proof.\n      According to Topology, Lemma 5.19.7 if $f$ is closed then specializations lift along $f$. Conversely, suppose that specializations lift along $f$. Let $Z \\subset X$ be a closed subset. We may think of $Z$ as a scheme with the reduced induced scheme structure, see Definition 26.12.5. Since $Z \\subset X$ is closed the restriction of $f$ to $Z$ is still quasi-compact. Moreover specializations lift along $Z \\to S$ as well, see Topology, Lemma 5.19.5. Hence it suffices to prove $f(X)$ is closed if specializations lift along $f$. In particular $f(X)$ is stable under specializations, see Topology, Lemma 5.19.6. Thus $f(X)$ is closed by Lemma 26.19.7. \n      $\\square$\n    \n"," by
  refine ‚ü®fun h ‚Ü¶ h.specializingMap, fun H ‚Ü¶ ?_‚ü©
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ change topologically @IsClosedMap f
    rw [IsZariskiLocalAtTarget.iff_of_openCover (P := topologically @IsClosedMap) Y.affineCover]
    intro i
    have _ : QuasiCompact (Y.affineCover.pullbackHom f i) := MorphismProperty.pullback_snd _ _ ‚Äπ_‚Ä∫
    refine this (Y.affineCover.pullbackHom f i) ?_ ‚ü®_, rfl‚ü©
    exact IsZariskiLocalAtTarget.of_isPullback
      (P := topologically @SpecializingMap) (.of_hasPullback _ _) H
  obtain ‚ü®S, rfl‚ü© := hY
  clear * - H
  intro Z hZ
  replace H := hZ.stableUnderSpecialization.image H
  wlog hX : ‚àÉ R, X = Spec R
  ¬∑ obtain ‚ü®R, g, hg‚ü© := compactSpace_iff_exists.mp (QuasiCompact.compactSpace_of_compactSpace f)
    have inst : QuasiCompact (g ‚â´ f) := HasAffineProperty.iff_of_isAffine.mpr (by infer_instance)
    have := this _ (g ‚â´ f) (g ‚Åª¬π' Z) (hZ.preimage g.continuous)
    simp_rw [Scheme.Hom.comp_base, TopCat.comp_app, ‚Üê Set.image_image,
      Set.image_preimage_eq _ hg] at this
    exact this H ‚ü®_, rfl‚ü©
  obtain ‚ü®R, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.homEquiv.symm.surjective f
  exact PrimeSpectrum.isClosed_image_of_stableUnderSpecialization œÜ.hom Z hZ H
","lemma isClosedMap_iff_specializingMap (f : X ‚ü∂ Y) [QuasiCompact f] :
    IsClosedMap f ‚Üî SpecializingMap f ","Proof.\n      According to Topology, Lemma 5.19.7 [[\n  Lemma 5.19.7. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf $f$ is closed then specializations lift along $f$. \n\n\nIf $f$ is open, $X$ is a Noetherian topological space, each irreducible closed subset of $X$ has a generic point, and $Y$ is Kolmogorov then generalizations lift along $f$. \n\n\n\n\n    \n]] if $f$ is closed then specializations lift along $f$. Conversely, suppose that specializations lift along $f$. Let $Z \\subset X$ be a closed subset. We may think of $Z$ as a scheme with the reduced induced scheme structure, see Definition 26.12.5 [[\n  Definition 26.12.5. Let $X$ be a scheme. Let $Z \\subset X$ be a closed subset. A scheme structure on $Z$ is given by a closed subscheme $Z\'$ of $X$ whose underlying set is equal to $Z$. We often say \xe2\x80\x9clet $(Z, \\mathcal{O}_ Z)$ be a scheme structure on $Z$\xe2\x80\x9d to indicate this. The reduced induced scheme structure on $Z$ is the one constructed in Lemma 26.12.4. The reduction $X_{red}$ of $X$ is the reduced induced scheme structure on $X$ itself. \n]]. Since $Z \\subset X$ is closed the restriction of $f$ to $Z$ is still quasi-compact. Moreover specializations lift along $Z \\to S$ as well, see Topology, Lemma 5.19.5 [[\n  Lemma 5.19.5. Suppose $f : X \\to Y$ and $g : Y \\to Z$ are continuous maps of topological spaces. If specializations lift along both $f$ and $g$ then specializations lift along $g \\circ f$. Similarly for \xe2\x80\x9cgeneralizations lift along\xe2\x80\x9d. \n\n    \n]]. Hence it suffices to prove $f(X)$ is closed if specializations lift along $f$. In particular $f(X)$ is stable under specializations, see Topology, Lemma 5.19.6 [[\n  Lemma 5.19.6. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf specializations lift along $f$, and if $T \\subset X$ is stable under specialization, then $f(T) \\subset Y$ is stable under specialization. \n\n\nIf generalizations lift along $f$, and if $T \\subset X$ is stable under generalization, then $f(T) \\subset Y$ is stable under generalization. \n\n\n\n\n    \n]]. Thus $f(X)$ is closed by Lemma 26.19.7 [[\n  Lemma 26.19.7. Let $f : X \\to S$ be a quasi-compact morphism of schemes. The following are equivalent \n  \n  \n$f(X) \\subset S$ is closed, and \n\n\n$f(X) \\subset S$ is stable under specialization. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      According to Topology, Lemma 5.19.7 [[\n  Lemma 5.19.7. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf $f$ is closed then specializations lift along $f$. \n\n\nIf $f$ is open, $X$ is a Noetherian topological space, each irreducible closed subset of $X$ has a generic point, and $Y$ is Kolmogorov then generalizations lift along $f$. \n\n\n\n\n    \n]] if $f$ is closed then specializations lift along $f$. Conversely, suppose that specializations lift along $f$. Let $Z \\subset X$ be a closed subset. We may think of $Z$ as a scheme with the reduced induced scheme structure, see Definition 26.12.5 [[\n  Definition 26.12.5. Let $X$ be a scheme. Let $Z \\subset X$ be a closed subset. A scheme structure on $Z$ is given by a closed subscheme $Z\'$ of $X$ whose underlying set is equal to $Z$. We often say \xe2\x80\x9clet $(Z, \\mathcal{O}_ Z)$ be a scheme structure on $Z$\xe2\x80\x9d to indicate this. The reduced induced scheme structure on $Z$ is the one constructed in Lemma 26.12.4. The reduction $X_{red}$ of $X$ is the reduced induced scheme structure on $X$ itself. \n]]. Since $Z \\subset X$ is closed the restriction of $f$ to $Z$ is still quasi-compact. Moreover specializations lift along $Z \\to S$ as well, see Topology, Lemma 5.19.5 [[\n  Lemma 5.19.5. Suppose $f : X \\to Y$ and $g : Y \\to Z$ are continuous maps of topological spaces. If specializations lift along both $f$ and $g$ then specializations lift along $g \\circ f$. Similarly for \xe2\x80\x9cgeneralizations lift along\xe2\x80\x9d. \n\n    \n]]. Hence it suffices to prove $f(X)$ is closed if specializations lift along $f$. In particular $f(X)$ is stable under specializations, see Topology, Lemma 5.19.6 [[\n  Lemma 5.19.6. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf specializations lift along $f$, and if $T \\subset X$ is stable under specialization, then $f(T) \\subset Y$ is stable under specialization. \n\n\nIf generalizations lift along $f$, and if $T \\subset X$ is stable under generalization, then $f(T) \\subset Y$ is stable under generalization. \n\n\n\n\n    \n]]. Thus $f(X)$ is closed by Lemma 26.19.7 [[\n  Lemma 26.19.7. Let $f : X \\to S$ be a quasi-compact morphism of schemes. The following are equivalent \n  \n  \n$f(X) \\subset S$ is closed, and \n\n\n$f(X) \\subset S$ is stable under specialization. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish the equivalence between ‚Äúf is a closed map (topologically)‚Äù and ‚Äúspecializations lift along f‚Äù for a quasi-compact morphism of schemes. The Lean proof constructs the equivalence ‚ü®(closed ‚Üí specializing), (specializing ‚Üí closed)‚ü©, matching the informal direction split: it uses `h.specializingMap` for the forward implication (corresponding to the cited Topology Lemma 5.19.7), and for the converse it shows images of closed sets are closed by proving stability under specialization and then invoking the scheme-theoretic lemma that for quasi-compact morphisms, ‚Äòclosed image‚Äô ‚Üî ‚Äòstable under specialization‚Äô (informal Lemma 26.19.7; Lean uses `PrimeSpectrum.isClosed_image_of_stableUnderSpecialization` after reducing to affine Spec cases).\n\nStructurally, the informal proof reduces to proving f(X) is closed and uses lemmas about stability under specialization and restriction to closed subschemes; the Lean proof instead proceeds via Zariski-locality on the target (`IsZariskiLocalAtTarget` with an affine cover) and then reduces both X and Y to affine schemes (Spec R) to apply the corresponding PrimeSpectrum result. This is a different but compatible structure: it still implements the same key idea ‚Äúspecialization-lifting ‚áí image stable under specialization ‚áí image closed‚Äù but via affine-local reduction rather than the explicit closed-subscheme restriction argument.\n\nCompleteness/precision: the Lean proof covers the main logical steps but does not mirror the informal detour through giving Z a reduced induced scheme structure and using composition/restriction lemmas (Topology 5.19.5/5.19.6) explicitly; instead it encodes stability under specialization via `hZ.stableUnderSpecialization.image H` and uses local/affine reductions. No obvious extraneous claims are introduced, but some cited intermediate lemmas in the informal proof are not reflected one-for-one in the Lean structure, hence not a perfect alignment.""}"
56,0DVA,"lemma isSeparated_of_injective (hf : Function.Injective f) :
    IsSeparated f := by
  constructor
  let ùí∞ := Y.affineCover
  let ùí± (i) := (pullback f (ùí∞.f i)).affineCover
  refine IsZariskiLocalAtTarget.of_iSup_eq_top (fun i : PUnit.{0} ‚Ü¶ ‚ä§) (by simp) fun _ ‚Ü¶ ?_
  rw [‚Üê diagonalCoverDiagonalRange_eq_top_of_injective f ùí∞ ùí± hf]
  exact isClosedImmersion_diagonal_restrict_diagonalCoverDiagonalRange f ùí∞ ùí±
",Formal Proof of Stacks Project Tag 0DVA,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Separated.lean#L214-L221,Q27041,,26.23.6,lemma,3.0,"['01L1', '01H8', '0ELP']","\n  Lemma 26.23.6. Let $j : X \\to Y$ be a morphism of schemes. If $j$ is injective on points, then $j$ is separated. \n\n    \n      Proof.\n      Let $z$ be a point of $X \\times _ Y X$. Then $x = \\text{pr}_1(z)$ and $\\text{pr}_2(z)$ are the same because $j$ maps these points to the same point $y$ of $Y$. Then we can choose an affine open neighbourhood $V \\subset Y$ of $y$ and an affine open neighbourhood $U \\subset X$ of $x$ with $j(U) \\subset V$. Then $z \\in U \\times _ V U \\subset X \\times _ Y X$. Hence $X \\times _ Y X$ is the union of the affine opens $U \\times _ V U$. Since $\\Delta _{X/Y}^{-1}(U \\times _ V U) = U$ and since $U \\to U \\times _ V U$ is a closed immersion, we conclude that $\\Delta _{X/Y}$ is a closed immersion (see argument in the proof of Lemma 26.21.2). \n      $\\square$\n    \n","\n  Lemma 26.23.6. Let $j : X \\to Y$ be a morphism of schemes. If $j$ is injective on points, then $j$ is separated. \n\n    \n","Proof.\n      Let $z$ be a point of $X \\times _ Y X$. Then $x = \\text{pr}_1(z)$ and $\\text{pr}_2(z)$ are the same because $j$ maps these points to the same point $y$ of $Y$. Then we can choose an affine open neighbourhood $V \\subset Y$ of $y$ and an affine open neighbourhood $U \\subset X$ of $x$ with $j(U) \\subset V$. Then $z \\in U \\times _ V U \\subset X \\times _ Y X$. Hence $X \\times _ Y X$ is the union of the affine opens $U \\times _ V U$. Since $\\Delta _{X/Y}^{-1}(U \\times _ V U) = U$ and since $U \\to U \\times _ V U$ is a closed immersion, we conclude that $\\Delta _{X/Y}$ is a closed immersion (see argument in the proof of Lemma 26.21.2). \n      $\\square$\n    \n"," by
  constructor
  let ùí∞ := Y.affineCover
  let ùí± (i) := (pullback f (ùí∞.f i)).affineCover
  refine IsZariskiLocalAtTarget.of_iSup_eq_top (fun i : PUnit.{0} ‚Ü¶ ‚ä§) (by simp) fun _ ‚Ü¶ ?_
  rw [‚Üê diagonalCoverDiagonalRange_eq_top_of_injective f ùí∞ ùí± hf]
  exact isClosedImmersion_diagonal_restrict_diagonalCoverDiagonalRange f ùí∞ ùí±
","lemma isSeparated_of_injective (hf : Function.Injective f) :
    IsSeparated f ","Proof.\n      Let $z$ be a point of $X \\times _ Y X$. Then $x = \\text{pr}_1(z)$ and $\\text{pr}_2(z)$ are the same because $j$ maps these points to the same point $y$ of $Y$. Then we can choose an affine open neighbourhood $V \\subset Y$ of $y$ and an affine open neighbourhood $U \\subset X$ of $x$ with $j(U) \\subset V$. Then $z \\in U \\times _ V U \\subset X \\times _ Y X$. Hence $X \\times _ Y X$ is the union of the affine opens $U \\times _ V U$. Since $\\Delta _{X/Y}^{-1}(U \\times _ V U) = U$ and since $U \\to U \\times _ V U$ is a closed immersion, we conclude that $\\Delta _{X/Y}$ is a closed immersion (see argument in the proof of Lemma 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]]). \n      $\\square$\n    \n","Proof.\n      Let $z$ be a point of $X \\times _ Y X$. Then $x = \\text{pr}_1(z)$ and $\\text{pr}_2(z)$ are the same because $j$ maps these points to the same point $y$ of $Y$. Then we can choose an affine open neighbourhood $V \\subset Y$ of $y$ and an affine open neighbourhood $U \\subset X$ of $x$ with $j(U) \\subset V$. Then $z \\in U \\times _ V U \\subset X \\times _ Y X$. Hence $X \\times _ Y X$ is the union of the affine opens $U \\times _ V U$. Since $\\Delta _{X/Y}^{-1}(U \\times _ V U) = U$ and since $U \\to U \\times _ V U$ is a closed immersion, we conclude that $\\Delta _{X/Y}$ is a closed immersion (see argument in the proof of Lemma 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]]). \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs aim to show the diagonal morphism is a closed immersion by reducing to an affine-local statement on the target (the fiber product) and then using that on each affine piece the restricted diagonal is a closed immersion. The Lean proof sets up an affine cover ùí∞ of Y and induced affine covers ùí± of the pullbacks, then applies an `IsZariskiLocalAtTarget` lemma to reduce to checking the property on a cover whose union is top; it uses lemmas identifying the relevant open cover of the diagonal range (`diagonalCoverDiagonalRange_eq_top_of_injective`) and then concludes via `isClosedImmersion_diagonal_restrict_diagonalCoverDiagonalRange`. Structurally, this matches the informal argument‚Äôs ‚Äúcover X√ó_Y X by affine opens U√ó_V U and check the diagonal on each piece‚Äù. However, the informal proof explicitly uses pointwise reasoning and the equality pr‚ÇÅ(z)=pr‚ÇÇ(z) coming from injectivity, while the Lean proof packages this into the lemma about the diagonal cover being top; it also does not explicitly mention the preimage computation Œî^{-1}(U√ó_V U)=U, which is implicit in the referenced restriction lemma. Overall the correspondence is strong but not perfectly one-to-one in exposition.""}"
57,01KM,"instance isClosedImmersion_equalizer_Œπ_left {S : Scheme} {X Y : Over S} [IsSeparated Y.hom]
    (f g : X ‚ü∂ Y) : IsClosedImmersion (equalizer.Œπ f g).left := by
  refine MorphismProperty.of_isPullback
    ((Limits.isPullback_equalizer_prod f g).map (Over.forget _)).flip ?_
  rw [‚Üê MorphismProperty.cancel_right_of_respectsIso @IsClosedImmersion _
    (Over.prodLeftIsoPullback Y Y).hom]
  convert (inferInstanceAs (IsClosedImmersion (pullback.diagonal Y.hom)))
  ext1 <;> simp [‚Üê Over.comp_left]
",Formal Proof of Stacks Project Tag 01KM,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/Separated.lean#L267-L274,Q27041,,26.21.5,lemma,3.0,"['01KH', '01H8', '0ELP']","\n  Lemma 26.21.5. Let $X$, $Y$ be schemes over $S$. Let $a, b : X \\to Y$ be morphisms of schemes over $S$. There exists a largest locally closed subscheme $Z \\subset X$ such that $a|_ Z = b|_ Z$. In fact $Z$ is the equalizer of $(a, b)$. Moreover, if $Y$ is separated over $S$, then $Z$ is a closed subscheme. \n\n    \n      Proof.\n      The equalizer of $(a, b)$ is for categorical reasons the fibre product $Z$ in the following diagram \n    \n      \n  \\[  \\xymatrix{ Z = Y \\times _{(Y \\times _ S Y)} X \\ar[r] \\ar[d] &  X \\ar[d]^{(a , b)} \\\\  Y \\ar[r]^-{\\Delta _{Y/S}} &  Y \\times _ S Y }  \\]\n\n    \n       Thus the lemma follows from Lemmas 26.18.2, 26.21.2 and Definition 26.21.3. \n      $\\square$\n    \n","\n  Lemma 26.21.5. Let $X$, $Y$ be schemes over $S$. Let $a, b : X \\to Y$ be morphisms of schemes over $S$. There exists a largest locally closed subscheme $Z \\subset X$ such that $a|_ Z = b|_ Z$. In fact $Z$ is the equalizer of $(a, b)$. Moreover, if $Y$ is separated over $S$, then $Z$ is a closed subscheme. \n\n    \n","Proof.\n      The equalizer of $(a, b)$ is for categorical reasons the fibre product $Z$ in the following diagram \n    \n      \n  \\[  \\xymatrix{ Z = Y \\times _{(Y \\times _ S Y)} X \\ar[r] \\ar[d] &  X \\ar[d]^{(a , b)} \\\\  Y \\ar[r]^-{\\Delta _{Y/S}} &  Y \\times _ S Y }  \\]\n\n    \n       Thus the lemma follows from Lemmas 26.18.2, 26.21.2 and Definition 26.21.3. \n      $\\square$\n    \n"," by
  refine MorphismProperty.of_isPullback
    ((Limits.isPullback_equalizer_prod f g).map (Over.forget _)).flip ?_
  rw [‚Üê MorphismProperty.cancel_right_of_respectsIso @IsClosedImmersion _
    (Over.prodLeftIsoPullback Y Y).hom]
  convert (inferInstanceAs (IsClosedImmersion (pullback.diagonal Y.hom)))
  ext1 <;> simp [‚Üê Over.comp_left]
","instance isClosedImmersion_equalizer_Œπ_left {S : Scheme} {X Y : Over S} [IsSeparated Y.hom]
    (f g : X ‚ü∂ Y) : IsClosedImmersion (equalizer.Œπ f g).left ","Proof.\n      The equalizer of $(a, b)$ is for categorical reasons the fibre product $Z$ in the following diagram \n    \n      \n  \\[  \\xymatrix{ Z = Y \\times _{(Y \\times _ S Y)} X \\ar[r] \\ar[d] &  X \\ar[d]^{(a , b)} \\\\  Y \\ar[r]^-{\\Delta _{Y/S}} &  Y \\times _ S Y }  \\]\n\n    \n       Thus the lemma follows from Lemmas 26.18.2 [[\n  Lemma 26.18.2. Let $S$ be a scheme. Let $f : X \\to Y$ be an immersion (resp. closed immersion, resp. open immersion) of schemes over $S$. Then any base change of $f$ is an immersion (resp. closed immersion, resp. open immersion). \n\n    \n]], 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]] and Definition 26.21.3 [[\n  Definition 26.21.3. Let $f : X \\to S$ be a morphism of schemes. \n  \n  \nWe say $f$ is separated if the diagonal morphism $\\Delta _{X/S}$ is a closed immersion. \n\n\nWe say $f$ is quasi-separated if the diagonal morphism $\\Delta _{X/S}$ is a quasi-compact morphism. \n\n\nWe say a scheme $Y$ is separated if the morphism $Y \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is separated. \n\n\nWe say a scheme $Y$ is quasi-separated if the morphism $Y \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is quasi-separated. \n\n\n\n]]. \n      $\\square$\n    \n","Proof.\n      The equalizer of $(a, b)$ is for categorical reasons the fibre product $Z$ in the following diagram \n    \n      \n  \\[  \\xymatrix{ Z = Y \\times _{(Y \\times _ S Y)} X \\ar[r] \\ar[d] &  X \\ar[d]^{(a , b)} \\\\  Y \\ar[r]^-{\\Delta _{Y/S}} &  Y \\times _ S Y }  \\]\n\n    \n       Thus the lemma follows from Lemmas 26.18.2 [[\n  Lemma 26.18.2. Let $S$ be a scheme. Let $f : X \\to Y$ be an immersion (resp. closed immersion, resp. open immersion) of schemes over $S$. Then any base change of $f$ is an immersion (resp. closed immersion, resp. open immersion). \n\n    \n]], 26.21.2 [[\n       \n      \n  Lemma 26.21.2. Let $X$ be a scheme over $S$. The diagonal morphism $\\Delta _{X/S}$ is an immersion. \n\n    \n]] and Definition 26.21.3 [[\n  Definition 26.21.3. Let $f : X \\to S$ be a morphism of schemes. \n  \n  \nWe say $f$ is separated if the diagonal morphism $\\Delta _{X/S}$ is a closed immersion. \n\n\nWe say $f$ is quasi-separated if the diagonal morphism $\\Delta _{X/S}$ is a quasi-compact morphism. \n\n\nWe say a scheme $Y$ is separated if the morphism $Y \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is separated. \n\n\nWe say a scheme $Y$ is quasi-separated if the morphism $Y \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is quasi-separated. \n\n\n\n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof shows the target morphism is a closed immersion by identifying it via an isPullback with a base change of a diagonal morphism: it uses `MorphismProperty.of_isPullback` together with `Limits.isPullback_equalizer_prod f g` (expressing the equalizer as a pullback against a product map), then applies cancellation under an isomorphism (`cancel_right_of_respectsIso` with `Over.prodLeftIsoPullback`) and finally reduces to the instance `IsClosedImmersion (pullback.diagonal Y.hom)`, i.e. the diagonal being a closed immersion (separatedness). This matches the informal argument: equalizer is a fiber product over the diagonal, and closed immersions are stable under base change.\nStructurally, both proofs follow the same high-level steps (equalizer-as-pullback, then base change of diagonal, then conclude closed immersion). The informal proof explicitly cites lemmas about base change stability and diagonal being an immersion plus the definition of separated; the Lean proof compresses these into existing lemmas/instances and does not mention the intermediate ‚Äúdiagonal is an immersion‚Äù step, going directly to ‚Äúdiagonal is a closed immersion‚Äù via an instance. Minor mismatch: the informal text discusses immersions in general and references separatedness definition, while the Lean proof is specialized to `IsClosedImmersion` and uses categorical equalizer/pullback machinery rather than explicitly stating the fiber product diagram.""}"
58,04XU,"lemma Scheme.Hom.isProperMap (f : X ‚ü∂ Y) [UniversallyClosed f] : IsProperMap f := by
  rw [isProperMap_iff_isClosedMap_and_compact_fibers]
  refine ‚ü®f.continuous, f.isClosedMap, fun y ‚Ü¶ ?_‚ü©
  have := compactSpace_of_universallyClosed (pullback.snd f (Y.fromSpecResidueField y))
  rw [‚Üê Scheme.range_fromSpecResidueField, ‚Üê Scheme.Pullback.range_fst]
  exact isCompact_range (Scheme.Hom.continuous _)
",Formal Proof of Stacks Project Tag 04XU,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/UniversallyClosed.lean#L156-L161,Q27041,,29.41.8,lemma,3.0,"['01W0', '01QL', '0ELP']","\n       \n      \n  Lemma 29.41.8. A universally closed morphism of schemes is quasi-compact. \n\n    \n      Proof.\n      Let $f : X \\to S$ be a morphism. Assume that $f$ is not quasi-compact. Our goal is to show that $f$ is not universally closed. By Schemes, Lemma 26.19.2 there exists an affine open $V \\subset S$ such that $f^{-1}(V)$ is not quasi-compact. To achieve our goal it suffices to show that $f^{-1}(V) \\to V$ is not universally closed, hence we may assume that $S = \\mathop{\\mathrm{Spec}}(A)$ for some ring $A$. \n    \n      Write $X = \\bigcup _{i \\in I} X_ i$ where the $X_ i$ are affine open subschemes of $X$. Let $T = \\mathop{\\mathrm{Spec}}(A[y_ i ; i \\in I])$. Let $T_ i = D(y_ i) \\subset T$. Let $Z$ be the closed set $(X \\times _ S T) - \\bigcup _{i \\in I} (X_ i \\times _ S T_ i)$. It suffices to prove that the image $f_ T(Z)$ of $Z$ under $f_ T : X \\times _ S T \\to T$ is not closed. \n    \n      There exists a point $s \\in S$ such that there is no neighborhood $U$ of $s$ in $S$ such that $X_ U$ is quasi-compact. Otherwise we could cover $S$ with finitely many such $U$ and Schemes, Lemma 26.19.2 would imply $f$ quasi-compact. Fix such an $s \\in S$. \n    \n      First we check that $f_ T(Z_ s) \\ne T_ s$. Let $t \\in T$ be the point lying over $s$ with $\\kappa (t) = \\kappa (s)$ such that $y_ i = 1$ in $\\kappa (t)$ for all $i$. Then $t \\in T_ i$ for all $i$, and the fiber of $Z_ s \\to T_ s$ above $t$ is isomorphic to $(X - \\bigcup _{i \\in I} X_ i)_ s$, which is empty. Thus $t \\in T_ s - f_ T(Z_ s)$. \n    \n      Assume $f_ T(Z)$ is closed in $T$. Then there exists an element $g \\in A[y_ i; i \\in I]$ with $f_ T(Z) \\subset V(g)$ but $t \\not\\in V(g)$. Hence the image of $g$ in $\\kappa (t)$ is nonzero. In particular some coefficient of $g$ has nonzero image in $\\kappa (s)$. Hence this coefficient is invertible on some neighborhood $U$ of $s$. Let $J$ be the finite set of $j \\in I$ such that $y_ j$ appears in $g$. Since $X_ U$ is not quasi-compact, we may choose a point $x \\in X - \\bigcup _{j \\in J} X_ j$ lying above some $u \\in U$. Since $g$ has a coefficient that is invertible on $U$, we can find a point $t\' \\in T$ lying above $u$ such that $t\' \\not\\in V(g)$ and $t\' \\in V(y_ i)$ for all $i \\notin J$. This is true because $V(y_ i; i \\in I, i \\not\\in J) = \\mathop{\\mathrm{Spec}}(A[t_ j; j\\in J])$ and the set of points of this scheme lying over $u$ is bijective with $\\mathop{\\mathrm{Spec}}(\\kappa (u)[t_ j; j \\in J])$. In other words $t\' \\notin T_ i$ for each $i \\notin J$. By Schemes, Lemma 26.17.5 we can find a point $z$ of $X \\times _ S T$ mapping to $x \\in X$ and to $t\' \\in T$. Since $x \\not\\in X_ j$ for $j \\in J$ and $t\' \\not\\in T_ i$ for $i \\in I \\setminus J$ we see that $z \\in Z$. On the other hand $f_ T(z) = t\' \\not\\in V(g)$ which contradicts $f_ T(Z) \\subset V(g)$. Thus the assumption \xe2\x80\x9c$f_ T(Z)$ closed\xe2\x80\x9d is wrong and we conclude indeed that $f_ T$ is not closed, as desired. \n      $\\square$\n    \n",\n       \n      \n  Lemma 29.41.8. A universally closed morphism of schemes is quasi-compact. \n\n    \n,"Proof.\n      Let $f : X \\to S$ be a morphism. Assume that $f$ is not quasi-compact. Our goal is to show that $f$ is not universally closed. By Schemes, Lemma 26.19.2 there exists an affine open $V \\subset S$ such that $f^{-1}(V)$ is not quasi-compact. To achieve our goal it suffices to show that $f^{-1}(V) \\to V$ is not universally closed, hence we may assume that $S = \\mathop{\\mathrm{Spec}}(A)$ for some ring $A$. \n    \n      Write $X = \\bigcup _{i \\in I} X_ i$ where the $X_ i$ are affine open subschemes of $X$. Let $T = \\mathop{\\mathrm{Spec}}(A[y_ i ; i \\in I])$. Let $T_ i = D(y_ i) \\subset T$. Let $Z$ be the closed set $(X \\times _ S T) - \\bigcup _{i \\in I} (X_ i \\times _ S T_ i)$. It suffices to prove that the image $f_ T(Z)$ of $Z$ under $f_ T : X \\times _ S T \\to T$ is not closed. \n    \n      There exists a point $s \\in S$ such that there is no neighborhood $U$ of $s$ in $S$ such that $X_ U$ is quasi-compact. Otherwise we could cover $S$ with finitely many such $U$ and Schemes, Lemma 26.19.2 would imply $f$ quasi-compact. Fix such an $s \\in S$. \n    \n      First we check that $f_ T(Z_ s) \\ne T_ s$. Let $t \\in T$ be the point lying over $s$ with $\\kappa (t) = \\kappa (s)$ such that $y_ i = 1$ in $\\kappa (t)$ for all $i$. Then $t \\in T_ i$ for all $i$, and the fiber of $Z_ s \\to T_ s$ above $t$ is isomorphic to $(X - \\bigcup _{i \\in I} X_ i)_ s$, which is empty. Thus $t \\in T_ s - f_ T(Z_ s)$. \n    \n      Assume $f_ T(Z)$ is closed in $T$. Then there exists an element $g \\in A[y_ i; i \\in I]$ with $f_ T(Z) \\subset V(g)$ but $t \\not\\in V(g)$. Hence the image of $g$ in $\\kappa (t)$ is nonzero. In particular some coefficient of $g$ has nonzero image in $\\kappa (s)$. Hence this coefficient is invertible on some neighborhood $U$ of $s$. Let $J$ be the finite set of $j \\in I$ such that $y_ j$ appears in $g$. Since $X_ U$ is not quasi-compact, we may choose a point $x \\in X - \\bigcup _{j \\in J} X_ j$ lying above some $u \\in U$. Since $g$ has a coefficient that is invertible on $U$, we can find a point $t\' \\in T$ lying above $u$ such that $t\' \\not\\in V(g)$ and $t\' \\in V(y_ i)$ for all $i \\notin J$. This is true because $V(y_ i; i \\in I, i \\not\\in J) = \\mathop{\\mathrm{Spec}}(A[t_ j; j\\in J])$ and the set of points of this scheme lying over $u$ is bijective with $\\mathop{\\mathrm{Spec}}(\\kappa (u)[t_ j; j \\in J])$. In other words $t\' \\notin T_ i$ for each $i \\notin J$. By Schemes, Lemma 26.17.5 we can find a point $z$ of $X \\times _ S T$ mapping to $x \\in X$ and to $t\' \\in T$. Since $x \\not\\in X_ j$ for $j \\in J$ and $t\' \\not\\in T_ i$ for $i \\in I \\setminus J$ we see that $z \\in Z$. On the other hand $f_ T(z) = t\' \\not\\in V(g)$ which contradicts $f_ T(Z) \\subset V(g)$. Thus the assumption \xe2\x80\x9c$f_ T(Z)$ closed\xe2\x80\x9d is wrong and we conclude indeed that $f_ T$ is not closed, as desired. \n      $\\square$\n    \n"," by
  rw [isProperMap_iff_isClosedMap_and_compact_fibers]
  refine ‚ü®f.continuous, f.isClosedMap, fun y ‚Ü¶ ?_‚ü©
  have := compactSpace_of_universallyClosed (pullback.snd f (Y.fromSpecResidueField y))
  rw [‚Üê Scheme.range_fromSpecResidueField, ‚Üê Scheme.Pullback.range_fst]
  exact isCompact_range (Scheme.Hom.continuous _)
",lemma Scheme.Hom.isProperMap (f : X ‚ü∂ Y) [UniversallyClosed f] : IsProperMap f ,"Proof.\n      Let $f : X \\to S$ be a morphism. Assume that $f$ is not quasi-compact. Our goal is to show that $f$ is not universally closed. By Schemes, Lemma 26.19.2 [[\n  Lemma 26.19.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f : X \\to S$ is quasi-compact, \n\n\nthe inverse image of every affine open is quasi-compact, and \n\n\nthere exists some affine open covering $S = \\bigcup _{i \\in I} U_ i$ such that $f^{-1}(U_ i)$ is quasi-compact for all $i$. \n\n\n\n\n    \n]] there exists an affine open $V \\subset S$ such that $f^{-1}(V)$ is not quasi-compact. To achieve our goal it suffices to show that $f^{-1}(V) \\to V$ is not universally closed, hence we may assume that $S = \\mathop{\\mathrm{Spec}}(A)$ for some ring $A$. \n    \n      Write $X = \\bigcup _{i \\in I} X_ i$ where the $X_ i$ are affine open subschemes of $X$. Let $T = \\mathop{\\mathrm{Spec}}(A[y_ i ; i \\in I])$. Let $T_ i = D(y_ i) \\subset T$. Let $Z$ be the closed set $(X \\times _ S T) - \\bigcup _{i \\in I} (X_ i \\times _ S T_ i)$. It suffices to prove that the image $f_ T(Z)$ of $Z$ under $f_ T : X \\times _ S T \\to T$ is not closed. \n    \n      There exists a point $s \\in S$ such that there is no neighborhood $U$ of $s$ in $S$ such that $X_ U$ is quasi-compact. Otherwise we could cover $S$ with finitely many such $U$ and Schemes, Lemma 26.19.2 [[\n  Lemma 26.19.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f : X \\to S$ is quasi-compact, \n\n\nthe inverse image of every affine open is quasi-compact, and \n\n\nthere exists some affine open covering $S = \\bigcup _{i \\in I} U_ i$ such that $f^{-1}(U_ i)$ is quasi-compact for all $i$. \n\n\n\n\n    \n]] would imply $f$ quasi-compact. Fix such an $s \\in S$. \n    \n      First we check that $f_ T(Z_ s) \\ne T_ s$. Let $t \\in T$ be the point lying over $s$ with $\\kappa (t) = \\kappa (s)$ such that $y_ i = 1$ in $\\kappa (t)$ for all $i$. Then $t \\in T_ i$ for all $i$, and the fiber of $Z_ s \\to T_ s$ above $t$ is isomorphic to $(X - \\bigcup _{i \\in I} X_ i)_ s$, which is empty. Thus $t \\in T_ s - f_ T(Z_ s)$. \n    \n      Assume $f_ T(Z)$ is closed in $T$. Then there exists an element $g \\in A[y_ i; i \\in I]$ with $f_ T(Z) \\subset V(g)$ but $t \\not\\in V(g)$. Hence the image of $g$ in $\\kappa (t)$ is nonzero. In particular some coefficient of $g$ has nonzero image in $\\kappa (s)$. Hence this coefficient is invertible on some neighborhood $U$ of $s$. Let $J$ be the finite set of $j \\in I$ such that $y_ j$ appears in $g$. Since $X_ U$ is not quasi-compact, we may choose a point $x \\in X - \\bigcup _{j \\in J} X_ j$ lying above some $u \\in U$. Since $g$ has a coefficient that is invertible on $U$, we can find a point $t\' \\in T$ lying above $u$ such that $t\' \\not\\in V(g)$ and $t\' \\in V(y_ i)$ for all $i \\notin J$. This is true because $V(y_ i; i \\in I, i \\not\\in J) = \\mathop{\\mathrm{Spec}}(A[t_ j; j\\in J])$ and the set of points of this scheme lying over $u$ is bijective with $\\mathop{\\mathrm{Spec}}(\\kappa (u)[t_ j; j \\in J])$. In other words $t\' \\notin T_ i$ for each $i \\notin J$. By Schemes, Lemma 26.17.5 [[\n  Lemma 26.17.5. Let $f : X \\to S$ and $g : Y \\to S$ be morphisms of schemes with the same target. Points $z$ of $X \\times _ S Y$ are in bijective correspondence to quadruples \n  \n  \\[  (x, y, s, \\mathfrak p)  \\]\n\n   where $x \\in X$, $y \\in Y$, $s \\in S$ are points with $f(x) = s$, $g(y) = s$ and $\\mathfrak p$ is a prime ideal of the ring $\\kappa (x) \\otimes _{\\kappa (s)} \\kappa (y)$. The residue field of $z$ corresponds to the residue field of the prime $\\mathfrak p$. \n\n    \n]] we can find a point $z$ of $X \\times _ S T$ mapping to $x \\in X$ and to $t\' \\in T$. Since $x \\not\\in X_ j$ for $j \\in J$ and $t\' \\not\\in T_ i$ for $i \\in I \\setminus J$ we see that $z \\in Z$. On the other hand $f_ T(z) = t\' \\not\\in V(g)$ which contradicts $f_ T(Z) \\subset V(g)$. Thus the assumption \xe2\x80\x9c$f_ T(Z)$ closed\xe2\x80\x9d is wrong and we conclude indeed that $f_ T$ is not closed, as desired. \n      $\\square$\n    \n","Proof.\n      Let $f : X \\to S$ be a morphism. Assume that $f$ is not quasi-compact. Our goal is to show that $f$ is not universally closed. By Schemes, Lemma 26.19.2 [[\n  Lemma 26.19.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f : X \\to S$ is quasi-compact, \n\n\nthe inverse image of every affine open is quasi-compact, and \n\n\nthere exists some affine open covering $S = \\bigcup _{i \\in I} U_ i$ such that $f^{-1}(U_ i)$ is quasi-compact for all $i$. \n\n\n\n\n    \n]] there exists an affine open $V \\subset S$ such that $f^{-1}(V)$ is not quasi-compact. To achieve our goal it suffices to show that $f^{-1}(V) \\to V$ is not universally closed, hence we may assume that $S = \\mathop{\\mathrm{Spec}}(A)$ for some ring $A$. \n    \n      Write $X = \\bigcup _{i \\in I} X_ i$ where the $X_ i$ are affine open subschemes of $X$. Let $T = \\mathop{\\mathrm{Spec}}(A[y_ i ; i \\in I])$. Let $T_ i = D(y_ i) \\subset T$. Let $Z$ be the closed set $(X \\times _ S T) - \\bigcup _{i \\in I} (X_ i \\times _ S T_ i)$. It suffices to prove that the image $f_ T(Z)$ of $Z$ under $f_ T : X \\times _ S T \\to T$ is not closed. \n    \n      There exists a point $s \\in S$ such that there is no neighborhood $U$ of $s$ in $S$ such that $X_ U$ is quasi-compact. Otherwise we could cover $S$ with finitely many such $U$ and Schemes, Lemma 26.19.2 [[\n  Lemma 26.19.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \n$f : X \\to S$ is quasi-compact, \n\n\nthe inverse image of every affine open is quasi-compact, and \n\n\nthere exists some affine open covering $S = \\bigcup _{i \\in I} U_ i$ such that $f^{-1}(U_ i)$ is quasi-compact for all $i$. \n\n\n\n\n    \n]] would imply $f$ quasi-compact. Fix such an $s \\in S$. \n    \n      First we check that $f_ T(Z_ s) \\ne T_ s$. Let $t \\in T$ be the point lying over $s$ with $\\kappa (t) = \\kappa (s)$ such that $y_ i = 1$ in $\\kappa (t)$ for all $i$. Then $t \\in T_ i$ for all $i$, and the fiber of $Z_ s \\to T_ s$ above $t$ is isomorphic to $(X - \\bigcup _{i \\in I} X_ i)_ s$, which is empty. Thus $t \\in T_ s - f_ T(Z_ s)$. \n    \n      Assume $f_ T(Z)$ is closed in $T$. Then there exists an element $g \\in A[y_ i; i \\in I]$ with $f_ T(Z) \\subset V(g)$ but $t \\not\\in V(g)$. Hence the image of $g$ in $\\kappa (t)$ is nonzero. In particular some coefficient of $g$ has nonzero image in $\\kappa (s)$. Hence this coefficient is invertible on some neighborhood $U$ of $s$. Let $J$ be the finite set of $j \\in I$ such that $y_ j$ appears in $g$. Since $X_ U$ is not quasi-compact, we may choose a point $x \\in X - \\bigcup _{j \\in J} X_ j$ lying above some $u \\in U$. Since $g$ has a coefficient that is invertible on $U$, we can find a point $t\' \\in T$ lying above $u$ such that $t\' \\not\\in V(g)$ and $t\' \\in V(y_ i)$ for all $i \\notin J$. This is true because $V(y_ i; i \\in I, i \\not\\in J) = \\mathop{\\mathrm{Spec}}(A[t_ j; j\\in J])$ and the set of points of this scheme lying over $u$ is bijective with $\\mathop{\\mathrm{Spec}}(\\kappa (u)[t_ j; j \\in J])$. In other words $t\' \\notin T_ i$ for each $i \\notin J$. By Schemes, Lemma 26.17.5 [[\n  Lemma 26.17.5. Let $f : X \\to S$ and $g : Y \\to S$ be morphisms of schemes with the same target. Points $z$ of $X \\times _ S Y$ are in bijective correspondence to quadruples \n  \n  \\[  (x, y, s, \\mathfrak p)  \\]\n\n   where $x \\in X$, $y \\in Y$, $s \\in S$ are points with $f(x) = s$, $g(y) = s$ and $\\mathfrak p$ is a prime ideal of the ring $\\kappa (x) \\otimes _{\\kappa (s)} \\kappa (y)$. The residue field of $z$ corresponds to the residue field of the prime $\\mathfrak p$. \n\n    \n]] we can find a point $z$ of $X \\times _ S T$ mapping to $x \\in X$ and to $t\' \\in T$. Since $x \\not\\in X_ j$ for $j \\in J$ and $t\' \\not\\in T_ i$ for $i \\in I \\setminus J$ we see that $z \\in Z$. On the other hand $f_ T(z) = t\' \\not\\in V(g)$ which contradicts $f_ T(Z) \\subset V(g)$. Thus the assumption \xe2\x80\x9c$f_ T(Z)$ closed\xe2\x80\x9d is wrong and we conclude indeed that $f_ T$ is not closed, as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantic inconsistency: the Lean proof establishes properness via the characterization ‚Äúproper iff continuous + closed map + compact fibers‚Äù (using `isProperMap_iff_isClosedMap_and_compact_fibers`) and then proves compactness of fibers using `compactSpace_of_universallyClosed` applied to a pullback along `fromSpecResidueField`. The informal proof instead argues the contrapositive direction ‚Äúnot quasi-compact ‚áí not universally closed‚Äù by constructing an explicit base change T and a closed subset Z whose image is not closed, using affine covers and a polynomial ring trick. Structurally, the informal proof is a long geometric construction with contradiction, while the formal proof is a short direct proof using existing lemmas about universally closed maps implying compact fibers. They are proving different statements (properness/compact fibers vs failure of universal closedness from non-quasi-compactness), so there is essentially no alignment.""}"
59,01U1,"lemma isOpenMap_of_generalizingMap [LocallyOfFinitePresentation f]
    (hf : GeneralizingMap f) : IsOpenMap f := by
  change topologically IsOpenMap f
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ rw [IsZariskiLocalAtTarget.iff_of_openCover (P := topologically IsOpenMap) Y.affineCover]
    intro i
    dsimp only [Scheme.Cover.pullbackHom]
    refine this _ ?_ ‚ü®_, rfl‚ü©
    exact IsZariskiLocalAtTarget.of_isPullback (P := topologically GeneralizingMap)
      (iY := Y.affineCover.f i) (IsPullback.of_hasPullback ..) hf
  obtain ‚ü®R, rfl‚ü© := hY
  wlog hX : ‚àÉ S, X = Spec S
  ¬∑ rw [IsZariskiLocalAtSource.iff_of_openCover (P := topologically IsOpenMap) X.affineCover]
    intro i
    refine this f _ _ ?_ ‚ü®_, rfl‚ü©
    exact IsZariskiLocalAtSource.comp (P := topologically GeneralizingMap) hf _
  obtain ‚ü®S, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.map_surjective f
  algebraize [œÜ.hom]
  convert PrimeSpectrum.isOpenMap_comap_of_hasGoingDown_of_finitePresentation
  ¬∑ rwa [Algebra.HasGoingDown.iff_generalizingMap_primeSpectrumComap]
  ¬∑ apply (HasRingHomProperty.Spec_iff (P := @LocallyOfFinitePresentation)).mp inferInstance
",Formal Proof of Stacks Project Tag 01U1,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/UniversallyOpen.lean#L107-L128,Q27041,,29.23.2,lemma,3.0,"['01TZ', '01QL', '0ELP']","\n  Lemma 29.23.2. Let $f : X \\to S$ be a morphism. \n  \n  \nIf $f$ is locally of finite presentation and generalizations lift along $f$, then $f$ is open. \n\n\nIf $f$ is locally of finite presentation and generalizations lift along every base change of $f$, then $f$ is universally open. \n\n\n\n\n    \n      Proof.\n      It suffices to prove the first assertion. This reduces to the case where both $X$ and $S$ are affine. In this case the result follows from Algebra, Lemma 10.41.3 and Proposition 10.41.8. \n      $\\square$\n    \n","\n  Lemma 29.23.2. Let $f : X \\to S$ be a morphism. \n  \n  \nIf $f$ is locally of finite presentation and generalizations lift along $f$, then $f$ is open. \n\n\nIf $f$ is locally of finite presentation and generalizations lift along every base change of $f$, then $f$ is universally open. \n\n\n\n\n    \n","Proof.\n      It suffices to prove the first assertion. This reduces to the case where both $X$ and $S$ are affine. In this case the result follows from Algebra, Lemma 10.41.3 and Proposition 10.41.8. \n      $\\square$\n    \n"," by
  change topologically IsOpenMap f
  wlog hY : ‚àÉ R, Y = Spec R
  ¬∑ rw [IsZariskiLocalAtTarget.iff_of_openCover (P := topologically IsOpenMap) Y.affineCover]
    intro i
    dsimp only [Scheme.Cover.pullbackHom]
    refine this _ ?_ ‚ü®_, rfl‚ü©
    exact IsZariskiLocalAtTarget.of_isPullback (P := topologically GeneralizingMap)
      (iY := Y.affineCover.f i) (IsPullback.of_hasPullback ..) hf
  obtain ‚ü®R, rfl‚ü© := hY
  wlog hX : ‚àÉ S, X = Spec S
  ¬∑ rw [IsZariskiLocalAtSource.iff_of_openCover (P := topologically IsOpenMap) X.affineCover]
    intro i
    refine this f _ _ ?_ ‚ü®_, rfl‚ü©
    exact IsZariskiLocalAtSource.comp (P := topologically GeneralizingMap) hf _
  obtain ‚ü®S, rfl‚ü© := hX
  obtain ‚ü®œÜ, rfl‚ü© := Spec.map_surjective f
  algebraize [œÜ.hom]
  convert PrimeSpectrum.isOpenMap_comap_of_hasGoingDown_of_finitePresentation
  ¬∑ rwa [Algebra.HasGoingDown.iff_generalizingMap_primeSpectrumComap]
  ¬∑ apply (HasRingHomProperty.Spec_iff (P := @LocallyOfFinitePresentation)).mp inferInstance
","lemma isOpenMap_of_generalizingMap [LocallyOfFinitePresentation f]
    (hf : GeneralizingMap f) : IsOpenMap f ","Proof.\n      It suffices to prove the first assertion. This reduces to the case where both $X$ and $S$ are affine. In this case the result follows from Algebra, Lemma 10.41.3 [[\n  Lemma 10.41.3. Let $R \\to S$ be a ring map. \n  \n  \n$R \\to S$ satisfies going down if and only if generalizations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n$R \\to S$ satisfies going up if and only if specializations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n\n\n    \n]] and Proposition 10.41.8 [[\n  Proposition 10.41.8. Let $R \\to S$ be flat and of finite presentation. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is open. More generally this holds for any ring map $R \\to S$ of finite presentation which satisfies going down. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      It suffices to prove the first assertion. This reduces to the case where both $X$ and $S$ are affine. In this case the result follows from Algebra, Lemma 10.41.3 [[\n  Lemma 10.41.3. Let $R \\to S$ be a ring map. \n  \n  \n$R \\to S$ satisfies going down if and only if generalizations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n$R \\to S$ satisfies going up if and only if specializations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n\n\n    \n]] and Proposition 10.41.8 [[\n  Proposition 10.41.8. Let $R \\to S$ be flat and of finite presentation. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is open. More generally this holds for any ring map $R \\to S$ of finite presentation which satisfies going down. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""5"", ""brief_justification"": ""Semantically, the Lean proof establishes that a scheme morphism f is an open map (after rewriting to `topologically IsOpenMap f`) under hypotheses corresponding to ‚Äúgeneralizing map‚Äù (going down) and ‚Äúlocally of finite presentation‚Äù, matching the informal reduction to the affine case and then applying the algebraic result that finite presentation + going down implies `Spec(S) ‚Üí Spec(R)` is open. Structurally, both proofs proceed by Zariski-local reduction on target and source to the affine case (Lean uses `IsZariskiLocalAtTarget/Source` with affine covers and pullbacks), then identify the morphism with a `Spec.map` induced by a ring hom `œÜ`, and finally invoke the prime spectrum lemma `PrimeSpectrum.isOpenMap_comap_of_hasGoingDown_of_finitePresentation`, which corresponds exactly to the cited Proposition 10.41.8 plus the equivalence between going down and generalizing maps (Lean uses `Algebra.HasGoingDown.iff_generalizingMap_primeSpectrumComap`). The formal proof contains no substantial extra content beyond these reductions and translations, and it covers the key ingredients mentioned informally.""}"
60,01UA,"instance (priority := low) UniversallyOpen.of_flat [Flat f] [LocallyOfFinitePresentation f] :
    UniversallyOpen f :=
  ‚ü®universally_mk' _ _ fun _ _ ‚Ü¶ isOpenMap_of_generalizingMap _ (Flat.generalizingMap _)‚ü©
",Formal Proof of Stacks Project Tag 01UA,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Morphisms/UniversallyOpen.lean#L144-L146,Q27041,,29.25.10,lemma,3.0,"['01U2', '01QL', '0ELP']","\n  Lemma 29.25.10. A flat morphism locally of finite presentation is universally open. \n\n    \n      Proof.\n      This follows from Lemmas 29.25.9 and Lemma 29.23.2 above. We can also argue directly as follows. \n    \n      Let $f : X \\to S$ be flat and locally of finite presentation. By Lemmas 29.25.8 and 29.21.4 any base change of $f$ is flat and locally of finite presentation. Hence it suffices to show $f$ is open. To show $f$ is open it suffices to show that we may cover $X$ by open affines $X = \\bigcup U_ i$ such that $U_ i \\to S$ is open. We may cover $X$ by affine opens $U_ i \\subset X$ such that each $U_ i$ maps into an affine open $V_ i \\subset S$ and such that the induced ring map $\\mathcal{O}_ S(V_ i) \\to \\mathcal{O}_ X(U_ i)$ is flat and of finite presentation (Lemmas 29.25.3 and 29.21.2). Then $U_ i \\to V_ i$ is open by Algebra, Proposition 10.41.8 and the proof is complete. \n      $\\square$\n    \n",\n  Lemma 29.25.10. A flat morphism locally of finite presentation is universally open. \n\n    \n,"Proof.\n      This follows from Lemmas 29.25.9 and Lemma 29.23.2 above. We can also argue directly as follows. \n    \n      Let $f : X \\to S$ be flat and locally of finite presentation. By Lemmas 29.25.8 and 29.21.4 any base change of $f$ is flat and locally of finite presentation. Hence it suffices to show $f$ is open. To show $f$ is open it suffices to show that we may cover $X$ by open affines $X = \\bigcup U_ i$ such that $U_ i \\to S$ is open. We may cover $X$ by affine opens $U_ i \\subset X$ such that each $U_ i$ maps into an affine open $V_ i \\subset S$ and such that the induced ring map $\\mathcal{O}_ S(V_ i) \\to \\mathcal{O}_ X(U_ i)$ is flat and of finite presentation (Lemmas 29.25.3 and 29.21.2). Then $U_ i \\to V_ i$ is open by Algebra, Proposition 10.41.8 and the proof is complete. \n      $\\square$\n    \n"," low) UniversallyOpen.of_flat [Flat f] [LocallyOfFinitePresentation f] :
    UniversallyOpen f :=
  ‚ü®universally_mk' _ _ fun _ _ ‚Ü¶ isOpenMap_of_generalizingMap _ (Flat.generalizingMap _)‚ü©
",instance (priority ,"Proof.\n      This follows from Lemmas 29.25.9 [[\n  Lemma 29.25.9. Let $f : X \\to S$ be a flat morphism of schemes. Then generalizations lift along $f$, see Topology, Definition 5.19.4. \n\n    \n]] and Lemma 29.23.2 [[\n  Lemma 29.23.2. Let $f : X \\to S$ be a morphism. \n  \n  \nIf $f$ is locally of finite presentation and generalizations lift along $f$, then $f$ is open. \n\n\nIf $f$ is locally of finite presentation and generalizations lift along every base change of $f$, then $f$ is universally open. \n\n\n\n\n    \n]] above. We can also argue directly as follows. \n    \n      Let $f : X \\to S$ be flat and locally of finite presentation. By Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.21.4 [[\n  Lemma 29.21.4. The base change of a morphism which is locally of finite presentation is locally of finite presentation. The same is true for morphisms of finite presentation. \n\n    \n]] any base change of $f$ is flat and locally of finite presentation. Hence it suffices to show $f$ is open. To show $f$ is open it suffices to show that we may cover $X$ by open affines $X = \\bigcup U_ i$ such that $U_ i \\to S$ is open. We may cover $X$ by affine opens $U_ i \\subset X$ such that each $U_ i$ maps into an affine open $V_ i \\subset S$ and such that the induced ring map $\\mathcal{O}_ S(V_ i) \\to \\mathcal{O}_ X(U_ i)$ is flat and of finite presentation (Lemmas 29.25.3 [[\n  Lemma 29.25.3. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is flat. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is flat. \n\n\nThere exists an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is flat. \n\n\nThere exists an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is flat, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is flat then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is flat. \n\n    \n]] and 29.21.2 [[\n  Lemma 29.21.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite presentation. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite presentation, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite presentation then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite presentation. \n\n    \n]]). Then $U_ i \\to V_ i$ is open by Algebra, Proposition 10.41.8 [[\n  Proposition 10.41.8. Let $R \\to S$ be flat and of finite presentation. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is open. More generally this holds for any ring map $R \\to S$ of finite presentation which satisfies going down. \n\n    \n]] and the proof is complete. \n      $\\square$\n    \n","Proof.\n      This follows from Lemmas 29.25.9 [[\n  Lemma 29.25.9. Let $f : X \\to S$ be a flat morphism of schemes. Then generalizations lift along $f$, see Topology, Definition 5.19.4. \n\n    \n]] and Lemma 29.23.2 [[\n  Lemma 29.23.2. Let $f : X \\to S$ be a morphism. \n  \n  \nIf $f$ is locally of finite presentation and generalizations lift along $f$, then $f$ is open. \n\n\nIf $f$ is locally of finite presentation and generalizations lift along every base change of $f$, then $f$ is universally open. \n\n\n\n\n    \n]] above. We can also argue directly as follows. \n    \n      Let $f : X \\to S$ be flat and locally of finite presentation. By Lemmas 29.25.8 [[\n  Lemma 29.25.8. The base change of a flat morphism is flat. \n\n    \n]] and 29.21.4 [[\n  Lemma 29.21.4. The base change of a morphism which is locally of finite presentation is locally of finite presentation. The same is true for morphisms of finite presentation. \n\n    \n]] any base change of $f$ is flat and locally of finite presentation. Hence it suffices to show $f$ is open. To show $f$ is open it suffices to show that we may cover $X$ by open affines $X = \\bigcup U_ i$ such that $U_ i \\to S$ is open. We may cover $X$ by affine opens $U_ i \\subset X$ such that each $U_ i$ maps into an affine open $V_ i \\subset S$ and such that the induced ring map $\\mathcal{O}_ S(V_ i) \\to \\mathcal{O}_ X(U_ i)$ is flat and of finite presentation (Lemmas 29.25.3 [[\n  Lemma 29.25.3. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is flat. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is flat. \n\n\nThere exists an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is flat. \n\n\nThere exists an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is flat, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is flat then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is flat. \n\n    \n]] and 29.21.2 [[\n  Lemma 29.21.2. Let $f : X \\to S$ be a morphism of schemes. The following are equivalent \n  \n  \nThe morphism $f$ is locally of finite presentation. \n\n\nFor every affine opens $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the ring map $\\mathcal{O}_ S(V) \\to \\mathcal{O}_ X(U)$ is of finite presentation. \n\n\nThere exist an open covering $S = \\bigcup _{j \\in J} V_ j$ and open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that each of the morphisms $U_ i \\to V_ j$, $j\\in J, i\\in I_ j$ is locally of finite presentation. \n\n\nThere exist an affine open covering $S = \\bigcup _{j \\in J} V_ j$ and affine open coverings $f^{-1}(V_ j) = \\bigcup _{i \\in I_ j} U_ i$ such that the ring map $\\mathcal{O}_ S(V_ j) \\to \\mathcal{O}_ X(U_ i)$ is of finite presentation, for all $j\\in J, i\\in I_ j$. \n\n\n\n   Moreover, if $f$ is locally of finite presentation then for any open subschemes $U \\subset X$, $V \\subset S$ with $f(U) \\subset V$ the restriction $f|_ U : U \\to V$ is locally of finite presentation. \n\n    \n]]). Then $U_ i \\to V_ i$ is open by Algebra, Proposition 10.41.8 [[\n  Proposition 10.41.8. Let $R \\to S$ be flat and of finite presentation. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is open. More generally this holds for any ring map $R \\to S$ of finite presentation which satisfies going down. \n\n    \n]] and the proof is complete. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof shows that a flat morphism (with the needed finiteness hypothesis in the instance context) is universally open by using that flatness implies the map is generalizing (`Flat.generalizingMap`) and then applying an openness criterion for generalizing maps (`isOpenMap_of_generalizingMap`), wrapped into a `UniversallyOpen` constructor (`universally_mk'`). This matches the informal proof‚Äôs main cited route: flat ‚áí generalizations lift (Lemma 29.25.9) and locally of finite presentation + lifting generalizations (for all base changes) ‚áí universally open (Lemma 29.23.2). Structurally, both arguments proceed via ‚Äúgeneralizations lift‚Äù and then an openness/universal openness criterion, rather than the longer affine-cover/ring-theoretic argument given as an alternative in the informal text. The only mismatch is that the informal proof explicitly discusses base change stability (flat and lfp stable under base change) to get universal openness, while the Lean proof packages universal openness directly via `universally_mk'` without explicitly mentioning those lemmas; this is likely handled implicitly by the definition/lemma used, but it is not mirrored step-by-step.""}"
61,01MC,"instance : Scheme.IsSeparated (Proj ùíú) :=
  (HasAffineProperty.iff_of_isAffine (P := @IsSeparated)).mp (isSeparated ùíú)
",Formal Proof of Stacks Project Tag 01MC,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ProjectiveSpectrum/Proper.lean#L127-L128,Q27041,,27.8.8,lemma,3.0,"['01M3', '01LE', '0ELP']","\n  Lemma 27.8.8. Let $S$ be a graded ring. The scheme $\\text{Proj}(S)$ is separated. \n\n    \n      Proof.\n      We have to show that the canonical morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is separated. We will use Schemes, Lemma 26.21.7. Thus it suffices to show given any pair of standard opens $D_{+}(f)$ and $D_{+}(g)$ that $D_{+}(f) \\cap D_{+}(g) = D_{+}(fg)$ is affine (clear) and that the ring map \n    \n      \n  \\[  S_{(f)} \\otimes _{\\mathbf{Z}} S_{(g)} \\longrightarrow S_{(fg)}  \\]\n\n    \n       is surjective. Any element $s$ in $S_{(fg)}$ is of the form $s = h/(f^ ng^ m)$ with $h \\in S$ homogeneous of degree $n\\deg (f) + m\\deg (g)$. We may multiply $h$ by a suitable monomial $f^ ig^ j$ and assume that $n = n\' \\deg (g)$, and $m = m\' \\deg (f)$. Then we can rewrite $s$ as $s = h/f^{(n\' + m\')\\deg (g)} \\cdot f^{m\'\\deg (g)}/g^{m\'\\deg (f)}$. So $s$ is indeed in the image of the displayed arrow. \n      $\\square$\n    \n",\n  Lemma 27.8.8. Let $S$ be a graded ring. The scheme $\\text{Proj}(S)$ is separated. \n\n    \n,"Proof.\n      We have to show that the canonical morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is separated. We will use Schemes, Lemma 26.21.7. Thus it suffices to show given any pair of standard opens $D_{+}(f)$ and $D_{+}(g)$ that $D_{+}(f) \\cap D_{+}(g) = D_{+}(fg)$ is affine (clear) and that the ring map \n    \n      \n  \\[  S_{(f)} \\otimes _{\\mathbf{Z}} S_{(g)} \\longrightarrow S_{(fg)}  \\]\n\n    \n       is surjective. Any element $s$ in $S_{(fg)}$ is of the form $s = h/(f^ ng^ m)$ with $h \\in S$ homogeneous of degree $n\\deg (f) + m\\deg (g)$. We may multiply $h$ by a suitable monomial $f^ ig^ j$ and assume that $n = n\' \\deg (g)$, and $m = m\' \\deg (f)$. Then we can rewrite $s$ as $s = h/f^{(n\' + m\')\\deg (g)} \\cdot f^{m\'\\deg (g)}/g^{m\'\\deg (f)}$. So $s$ is indeed in the image of the displayed arrow. \n      $\\square$\n    \n","
  (HasAffineProperty.iff_of_isAffine (P := @IsSeparated)).mp (isSeparated ùíú)
",instance : Scheme.IsSeparated (Proj ùíú) ,"Proof.\n      We have to show that the canonical morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is separated. We will use Schemes, Lemma 26.21.7 [[\n  Lemma 26.21.7. Let $f : X \\to S$ be a morphism of schemes. \n  \n  \nIf $f$ is separated then for every pair of affine opens $(U, V)$ of $X$ which map into a common affine open of $S$ we have \n\n\n  \nthe intersection $U \\cap V$ is affine. \n\n\nthe ring map $\\mathcal{O}_ X(U) \\otimes _{\\mathbf{Z}} \\mathcal{O}_ X(V) \\to \\mathcal{O}_ X(U \\cap V)$ is surjective. \n\n\n\n\nIf any pair of points $x_1, x_2 \\in X$ lying over a common point $s \\in S$ are contained in affine opens $x_1 \\in U$, $x_2 \\in V$ which map into a common affine open of $S$ such that (a), (b) hold, then $f$ is separated. \n\n\n\n\n    \n]]. Thus it suffices to show given any pair of standard opens $D_{+}(f)$ and $D_{+}(g)$ that $D_{+}(f) \\cap D_{+}(g) = D_{+}(fg)$ is affine (clear) and that the ring map \n    \n      \n  \\[  S_{(f)} \\otimes _{\\mathbf{Z}} S_{(g)} \\longrightarrow S_{(fg)}  \\]\n\n    \n       is surjective. Any element $s$ in $S_{(fg)}$ is of the form $s = h/(f^ ng^ m)$ with $h \\in S$ homogeneous of degree $n\\deg (f) + m\\deg (g)$. We may multiply $h$ by a suitable monomial $f^ ig^ j$ and assume that $n = n\' \\deg (g)$, and $m = m\' \\deg (f)$. Then we can rewrite $s$ as $s = h/f^{(n\' + m\')\\deg (g)} \\cdot f^{m\'\\deg (g)}/g^{m\'\\deg (f)}$. So $s$ is indeed in the image of the displayed arrow. \n      $\\square$\n    \n","Proof.\n      We have to show that the canonical morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is separated. We will use Schemes, Lemma 26.21.7 [[\n  Lemma 26.21.7. Let $f : X \\to S$ be a morphism of schemes. \n  \n  \nIf $f$ is separated then for every pair of affine opens $(U, V)$ of $X$ which map into a common affine open of $S$ we have \n\n\n  \nthe intersection $U \\cap V$ is affine. \n\n\nthe ring map $\\mathcal{O}_ X(U) \\otimes _{\\mathbf{Z}} \\mathcal{O}_ X(V) \\to \\mathcal{O}_ X(U \\cap V)$ is surjective. \n\n\n\n\nIf any pair of points $x_1, x_2 \\in X$ lying over a common point $s \\in S$ are contained in affine opens $x_1 \\in U$, $x_2 \\in V$ which map into a common affine open of $S$ such that (a), (b) hold, then $f$ is separated. \n\n\n\n\n    \n]]. Thus it suffices to show given any pair of standard opens $D_{+}(f)$ and $D_{+}(g)$ that $D_{+}(f) \\cap D_{+}(g) = D_{+}(fg)$ is affine (clear) and that the ring map \n    \n      \n  \\[  S_{(f)} \\otimes _{\\mathbf{Z}} S_{(g)} \\longrightarrow S_{(fg)}  \\]\n\n    \n       is surjective. Any element $s$ in $S_{(fg)}$ is of the form $s = h/(f^ ng^ m)$ with $h \\in S$ homogeneous of degree $n\\deg (f) + m\\deg (g)$. We may multiply $h$ by a suitable monomial $f^ ig^ j$ and assume that $n = n\' \\deg (g)$, and $m = m\' \\deg (f)$. Then we can rewrite $s$ as $s = h/f^{(n\' + m\')\\deg (g)} \\cdot f^{m\'\\deg (g)}/g^{m\'\\deg (f)}$. So $s$ is indeed in the image of the displayed arrow. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof establishes separatedness of a specific morphism Proj(S) ‚Üí Spec(Z) by checking the affine-intersection and surjectivity conditions on standard opens (via a cited lemma). The formal proof, however, is a one-line application of a general equivalence `HasAffineProperty.iff_of_isAffine (P := IsSeparated)` to extract `isSeparated ùíú`, i.e. it derives separatedness from an already available hypothesis/instance `isSeparated ùíú` using an affine-local characterization. Structurally, the informal argument contains the concrete verification of surjectivity on rings and the description of elements h/(f^n g^m), while the Lean code does not reflect these steps at all and instead relies on a pre-proved separatedness fact. Thus there is only partial alignment: both are about separatedness and affine-local criteria, but the formal proof omits the substantive argument present in the informal proof.""}"
62,01MF,"theorem valuativeCriterion_existence_aux
    {O : Type*} [CommRing O] [IsDomain O] [ValuationRing O]
    {K : Type*} [Field K] [Algebra O K] [IsFractionRing O K]
    (œÜ‚ÇÄ : (ùíú 0) ‚Üí+* O)
    (Œπ : Type*) [Finite Œπ] (x : Œπ ‚Üí A) (h2 : Algebra.adjoin (ùíú 0) (Set.range x) = ‚ä§)
    (j : Œπ) (œÜ : Away ùíú (x j) ‚Üí+* K)
    (hcomm : (algebraMap O K).comp œÜ‚ÇÄ = œÜ.comp (fromZeroRingHom ùíú _))
    (d : Œπ ‚Üí ‚Ñï) (hdi : ‚àÄ i, 0 < d i) (hxdi : ‚àÄ i, x i ‚àà ùíú (d i)) :
    ‚àÉ (j‚ÇÄ : Œπ) (œÜ' : Away ùíú (x j * x j‚ÇÄ) ‚Üí+* K), œÜ'.comp (awayMap ùíú (hxdi j‚ÇÄ) rfl) = œÜ ‚àß
      (œÜ'.comp (awayMap ùíú (hxdi j) (mul_comm (x j) (x j‚ÇÄ)))).range ‚â§ (algebraMap O K).range := by
  classical
  cases nonempty_fintype Œπ
  let œà (i : Œπ) : ValueGroup O K :=
    valuation O K ((œÜ (Away.isLocalizationElem (hxdi j) (hxdi i))) ^ ‚àè k ‚àà Finset.univ.erase i, d k)
  have : Nonempty Œπ := ‚ü®j‚ü©
  let Kmax := (Finset.univ.image œà).max' (by simp)
  have ‚ü®i‚ÇÄ, hi1‚ü© : ‚àÉ a, œà a = Kmax := by simpa using Finset.max'_mem (Finset.univ.image œà)
  have hi‚ÇÄ (j) : œà j ‚â§ œà i‚ÇÄ := hi1 ‚ñ∏ (Finset.univ.image œà).le_max' (œà j) (by simp)
  have hKmax : 0 < Kmax := by
    refine zero_lt_iff.mpr fun hKmax ‚Ü¶ ?_
    have (i : _) : œà i = 0 := le_zero_iff.mp (hKmax ‚ñ∏ Finset.le_max' _ _ (by simp))
    simp only [œà, map_pow, pow_eq_zero_iff', map_eq_zero, ne_eq] at this
    have : œÜ 1 = 0 := by convert (this j).1; ext; simp
    simp only [map_one, one_ne_zero] at this
  letI := (awayMap ùíú (f := x j) (hxdi i‚ÇÄ) rfl).toAlgebra
  have := Away.isLocalization_mul (hxdi j) (hxdi i‚ÇÄ) rfl (hdi _).ne'
  have hunit : IsUnit (œÜ (Away.isLocalizationElem (hxdi j) (hxdi i‚ÇÄ))) := isUnit_iff_ne_zero.mpr
    fun rid ‚Ü¶ hKmax.ne' (.symm (by simpa [œà, rid, Finset.prod_eq_zero_iff, (hdi _).ne'] using hi1))
  let œÜ' := IsLocalization.Away.lift (S := Away ùíú (x j * x i‚ÇÄ)) _ hunit
  have hœÜ'1 (s) : œÜ' (awayMap ùíú (hxdi i‚ÇÄ) rfl s) = œÜ s := IsLocalization.Away.lift_eq _ hunit s
  use i‚ÇÄ, œÜ', IsLocalization.Away.lift_comp ..
  rintro _ ‚ü®sx, rfl‚ü©
  rw [RingHom.mem_range, ‚Üê ValuationRing.mem_integer_iff, Valuation.mem_integer_iff]
  have := (Away.span_mk_prod_pow_eq_top (hxdi i‚ÇÄ) x h2 d hxdi).ge (Submodule.mem_top (x := sx))
  induction this using Submodule.span_induction with
  | zero => simp
  | add x y hx hy hhx hhy =>
    simp only [RingHom.coe_comp, Function.comp_apply, map_add, ge_iff_le]
    exact ((valuation O K).map_add _ _).trans <| sup_le_iff.mpr ‚ü®hhx, hhy‚ü©
  | smul a x‚ÇÄ hx hx1 =>
    simp only [Algebra.smul_def, RingHom.coe_comp, Function.comp_apply, map_mul, ge_iff_le]
    refine mul_le_one' ?_ hx1
    rw [RingHom.algebraMap_toAlgebra, awayMap_fromZeroRingHom ùíú (hxdi j) (mul_comm (x j) (x i‚ÇÄ)),
      ‚Üê awayMap_fromZeroRingHom ùíú (hxdi i‚ÇÄ) rfl a, hœÜ'1]
    change valuation O K (œÜ.comp (fromZeroRingHom ùíú (.powers (x j))) a) ‚â§ 1
    simp only [‚Üê hcomm, RingHom.coe_comp, Function.comp_apply, ‚Üê Valuation.mem_integer_iff,
      IsFractionRing.coe_inj, exists_eq, mem_integer_iff]
  | mem x1 h =>
    obtain ‚ü®a, ai, hai, rfl‚ü© := h
    simp only [smul_eq_mul] at hai
    have H : (‚àè i, x i ^ ai i) * x i‚ÇÄ ^ (a * (d j - 1)) ‚àà ùíú ((a * d i‚ÇÄ) ‚Ä¢ d j) := by
      convert SetLike.mul_mem_graded (SetLike.prod_pow_mem_graded ùíú d x ai fun _ _ ‚Ü¶ hxdi _)
        (SetLike.pow_mem_graded (a * (d j - 1)) (hxdi i‚ÇÄ)) using 2
      simp only [smul_eq_mul, hai]
      cases h : d j
      ¬∑ cases (hdi j).ne' h
      ¬∑ simp only [add_tsub_cancel_right]; ring
    suffices valuation O K (œÜ (Away.mk ùíú (hxdi j) _ _ H) /
          œÜ (Away.isLocalizationElem (hxdi j) (hxdi i‚ÇÄ)) ^ a) ‚â§ 1 by
      convert this
      rw [eq_div_iff (pow_ne_zero _ hunit.ne_zero), ‚Üê hœÜ'1, ‚Üê hœÜ'1, RingHom.comp_apply,
        ‚Üê map_pow, ‚Üê map_mul]
      congr
      ext
      simp only [awayMap_mk, Away.val_mk, val_pow, Localization.mk_pow, Localization.mk_mul,
        Localization.mk_eq_mk_iff, Localization.r_iff_exists, val_mul]
      use 1
      simp only [OneMemClass.coe_one, one_mul, Submonoid.coe_mul, SubmonoidClass.coe_pow]
      cases h : d j
      ¬∑ cases (hdi j).ne' h
      ¬∑ rw [Nat.add_sub_cancel]; ring
    rw [map_div‚ÇÄ, div_le_iff‚ÇÄ ((pow_pos ((Valuation.pos_iff _).mpr hunit.ne_zero) _).trans_eq
      (Valuation.map_pow _ _ _).symm), one_mul, ‚Üê pow_le_pow_iff_left‚ÇÄ zero_le' zero_le'
        (mul_pos (hdi j) (Finset.prod_pos fun i _ => hdi i)).ne.symm]
    calc
      _ = (‚àè i, œà i ^ (d i * ai i)) * œà i‚ÇÄ ^ (d i‚ÇÄ * a * (d j - 1)) := by
          simp only [œà, ‚Üê map_pow, ‚Üê map_prod, ‚Üê map_mul]
          congr 2
          apply (show Function.Injective (algebraMap (Away ùíú (x j)) (Localization.Away (x j)))
            from val_injective _)
          simp only [map_pow, map_prod, map_mul]
          simp only [HomogeneousLocalization.algebraMap_apply, Away.val_mk, Localization.mk_pow,
            Localization.mk_prod, Localization.mk_mul]
          rw [Localization.mk_eq_mk_iff, Localization.r_iff_exists]
          use 1
          simp only [OneMemClass.coe_one, ‚Üê pow_mul, Submonoid.coe_mul,
            SubmonoidClass.coe_finset_prod, one_mul]
          simp_rw [‚Üê mul_assoc, Finset.prod_erase_mul _ d (h := Finset.mem_univ _), mul_assoc,
            ‚Üê mul_assoc (Finset.prod ..), Finset.prod_erase_mul _ d (h := Finset.mem_univ _),
            SubmonoidClass.coe_pow, ‚Üê pow_mul, Finset.prod_pow_eq_pow_sum,
            ‚Üê pow_add, mul_pow, ‚Üê Finset.prod_pow, ‚Üê pow_mul]
          congr 3
          ¬∑ simp only [mul_comm _ (‚àè i, d i), mul_assoc, mul_left_comm _ (‚àè i, d i),
              mul_comm (d _) (ai _), ‚Üê Finset.mul_sum, hai]
            cases h : d j
            ¬∑ cases (hdi j).ne' h
            ¬∑ simp; ring
          ¬∑ ext i; congr 1; ring
          ¬∑ ring
      _ ‚â§ (‚àè i : Œπ, œà i‚ÇÄ ^ (d i * ai i)) * œà i‚ÇÄ ^ (d i‚ÇÄ * a * (d j - 1)) := by
          gcongr with i; exacts [fun i _ ‚Ü¶ zero_le', zero_le', hi‚ÇÄ i]
      _ = œà i‚ÇÄ ^ (d i‚ÇÄ * a * d j) := by
          rw [Finset.prod_pow_eq_pow_sum, ‚Üê pow_add]
          simp_rw [mul_comm (d _) (ai _), hai]
          cases h : d j
          ¬∑ cases (hdi j).ne' h
          ¬∑ simp; ring_nf
      _ = valuation O K ((œÜ _) ^ a) ^ (d j * ‚àè i, d i) := by
          ¬∑ simp only [œà, ‚Üê map_pow]
            congr 2
            rw [‚Üê pow_mul, ‚Üê pow_mul, ‚Üê mul_assoc, ‚Üê mul_assoc, ‚Üê mul_assoc,
              Finset.univ.prod_erase_mul d (h := Finset.mem_univ _),
              mul_comm _ a, mul_right_comm]
",Formal Proof of Stacks Project Tag 01MF,algebraic part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ProjectiveSpectrum/Proper.lean#L195-L307,Q27041,,27.8.11,lemma,3.0,"['01M3', '01LE', '0ELP']","\n  Lemma 27.8.11. Let $S$ be a graded ring. If $S$ is finitely generated as an algebra over $S_0$, then the morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(S_0)$ satisfies the existence and uniqueness parts of the valuative criterion, see Schemes, Definition 26.20.3. \n\n    \n      Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 and Schemes, Lemma 26.22.1). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n","\n  Lemma 27.8.11. Let $S$ be a graded ring. If $S$ is finitely generated as an algebra over $S_0$, then the morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(S_0)$ satisfies the existence and uniqueness parts of the valuative criterion, see Schemes, Definition 26.20.3. \n\n    \n","Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 and Schemes, Lemma 26.22.1). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n"," by
  classical
  cases nonempty_fintype Œπ
  let œà (i : Œπ) : ValueGroup O K :=
    valuation O K ((œÜ (Away.isLocalizationElem (hxdi j) (hxdi i))) ^ ‚àè k ‚àà Finset.univ.erase i, d k)
  have : Nonempty Œπ := ‚ü®j‚ü©
  let Kmax := (Finset.univ.image œà).max' (by simp)
  have ‚ü®i‚ÇÄ, hi1‚ü© : ‚àÉ a, œà a = Kmax := by simpa using Finset.max'_mem (Finset.univ.image œà)
  have hi‚ÇÄ (j) : œà j ‚â§ œà i‚ÇÄ := hi1 ‚ñ∏ (Finset.univ.image œà).le_max' (œà j) (by simp)
  have hKmax : 0 < Kmax := by
    refine zero_lt_iff.mpr fun hKmax ‚Ü¶ ?_
    have (i : _) : œà i = 0 := le_zero_iff.mp (hKmax ‚ñ∏ Finset.le_max' _ _ (by simp))
    simp only [œà, map_pow, pow_eq_zero_iff', map_eq_zero, ne_eq] at this
    have : œÜ 1 = 0 := by convert (this j).1; ext; simp
    simp only [map_one, one_ne_zero] at this
  letI := (awayMap ùíú (f := x j) (hxdi i‚ÇÄ) rfl).toAlgebra
  have := Away.isLocalization_mul (hxdi j) (hxdi i‚ÇÄ) rfl (hdi _).ne'
  have hunit : IsUnit (œÜ (Away.isLocalizationElem (hxdi j) (hxdi i‚ÇÄ))) := isUnit_iff_ne_zero.mpr
    fun rid ‚Ü¶ hKmax.ne' (.symm (by simpa [œà, rid, Finset.prod_eq_zero_iff, (hdi _).ne'] using hi1))
  let œÜ' := IsLocalization.Away.lift (S := Away ùíú (x j * x i‚ÇÄ)) _ hunit
  have hœÜ'1 (s) : œÜ' (awayMap ùíú (hxdi i‚ÇÄ) rfl s) = œÜ s := IsLocalization.Away.lift_eq _ hunit s
  use i‚ÇÄ, œÜ', IsLocalization.Away.lift_comp ..
  rintro _ ‚ü®sx, rfl‚ü©
  rw [RingHom.mem_range, ‚Üê ValuationRing.mem_integer_iff, Valuation.mem_integer_iff]
  have := (Away.span_mk_prod_pow_eq_top (hxdi i‚ÇÄ) x h2 d hxdi).ge (Submodule.mem_top (x := sx))
  induction this using Submodule.span_induction with
  | zero => simp
  | add x y hx hy hhx hhy =>
    simp only [RingHom.coe_comp, Function.comp_apply, map_add, ge_iff_le]
    exact ((valuation O K).map_add _ _).trans <| sup_le_iff.mpr ‚ü®hhx, hhy‚ü©
  | smul a x‚ÇÄ hx hx1 =>
    simp only [Algebra.smul_def, RingHom.coe_comp, Function.comp_apply, map_mul, ge_iff_le]
    refine mul_le_one' ?_ hx1
    rw [RingHom.algebraMap_toAlgebra, awayMap_fromZeroRingHom ùíú (hxdi j) (mul_comm (x j) (x i‚ÇÄ)),
      ‚Üê awayMap_fromZeroRingHom ùíú (hxdi i‚ÇÄ) rfl a, hœÜ'1]
    change valuation O K (œÜ.comp (fromZeroRingHom ùíú (.powers (x j))) a) ‚â§ 1
    simp only [‚Üê hcomm, RingHom.coe_comp, Function.comp_apply, ‚Üê Valuation.mem_integer_iff,
      IsFractionRing.coe_inj, exists_eq, mem_integer_iff]
  | mem x1 h =>
    obtain ‚ü®a, ai, hai, rfl‚ü© := h
    simp only [smul_eq_mul] at hai
    have H : (‚àè i, x i ^ ai i) * x i‚ÇÄ ^ (a * (d j - 1)) ‚àà ùíú ((a * d i‚ÇÄ) ‚Ä¢ d j) := by
      convert SetLike.mul_mem_graded (SetLike.prod_pow_mem_graded ùíú d x ai fun _ _ ‚Ü¶ hxdi _)
        (SetLike.pow_mem_graded (a * (d j - 1)) (hxdi i‚ÇÄ)) using 2
      simp only [smul_eq_mul, hai]
      cases h : d j
      ¬∑ cases (hdi j).ne' h
      ¬∑ simp only [add_tsub_cancel_right]; ring
    suffices valuation O K (œÜ (Away.mk ùíú (hxdi j) _ _ H) /
          œÜ (Away.isLocalizationElem (hxdi j) (hxdi i‚ÇÄ)) ^ a) ‚â§ 1 by
      convert this
      rw [eq_div_iff (pow_ne_zero _ hunit.ne_zero), ‚Üê hœÜ'1, ‚Üê hœÜ'1, RingHom.comp_apply,
        ‚Üê map_pow, ‚Üê map_mul]
      congr
      ext
      simp only [awayMap_mk, Away.val_mk, val_pow, Localization.mk_pow, Localization.mk_mul,
        Localization.mk_eq_mk_iff, Localization.r_iff_exists, val_mul]
      use 1
      simp only [OneMemClass.coe_one, one_mul, Submonoid.coe_mul, SubmonoidClass.coe_pow]
      cases h : d j
      ¬∑ cases (hdi j).ne' h
      ¬∑ rw [Nat.add_sub_cancel]; ring
    rw [map_div‚ÇÄ, div_le_iff‚ÇÄ ((pow_pos ((Valuation.pos_iff _).mpr hunit.ne_zero) _).trans_eq
      (Valuation.map_pow _ _ _).symm), one_mul, ‚Üê pow_le_pow_iff_left‚ÇÄ zero_le' zero_le'
        (mul_pos (hdi j) (Finset.prod_pos fun i _ => hdi i)).ne.symm]
    calc
      _ = (‚àè i, œà i ^ (d i * ai i)) * œà i‚ÇÄ ^ (d i‚ÇÄ * a * (d j - 1)) := by
          simp only [œà, ‚Üê map_pow, ‚Üê map_prod, ‚Üê map_mul]
          congr 2
          apply (show Function.Injective (algebraMap (Away ùíú (x j)) (Localization.Away (x j)))
            from val_injective _)
          simp only [map_pow, map_prod, map_mul]
          simp only [HomogeneousLocalization.algebraMap_apply, Away.val_mk, Localization.mk_pow,
            Localization.mk_prod, Localization.mk_mul]
          rw [Localization.mk_eq_mk_iff, Localization.r_iff_exists]
          use 1
          simp only [OneMemClass.coe_one, ‚Üê pow_mul, Submonoid.coe_mul,
            SubmonoidClass.coe_finset_prod, one_mul]
          simp_rw [‚Üê mul_assoc, Finset.prod_erase_mul _ d (h := Finset.mem_univ _), mul_assoc,
            ‚Üê mul_assoc (Finset.prod ..), Finset.prod_erase_mul _ d (h := Finset.mem_univ _),
            SubmonoidClass.coe_pow, ‚Üê pow_mul, Finset.prod_pow_eq_pow_sum,
            ‚Üê pow_add, mul_pow, ‚Üê Finset.prod_pow, ‚Üê pow_mul]
          congr 3
          ¬∑ simp only [mul_comm _ (‚àè i, d i), mul_assoc, mul_left_comm _ (‚àè i, d i),
              mul_comm (d _) (ai _), ‚Üê Finset.mul_sum, hai]
            cases h : d j
            ¬∑ cases (hdi j).ne' h
            ¬∑ simp; ring
          ¬∑ ext i; congr 1; ring
          ¬∑ ring
      _ ‚â§ (‚àè i : Œπ, œà i‚ÇÄ ^ (d i * ai i)) * œà i‚ÇÄ ^ (d i‚ÇÄ * a * (d j - 1)) := by
          gcongr with i; exacts [fun i _ ‚Ü¶ zero_le', zero_le', hi‚ÇÄ i]
      _ = œà i‚ÇÄ ^ (d i‚ÇÄ * a * d j) := by
          rw [Finset.prod_pow_eq_pow_sum, ‚Üê pow_add]
          simp_rw [mul_comm (d _) (ai _), hai]
          cases h : d j
          ¬∑ cases (hdi j).ne' h
          ¬∑ simp; ring_nf
      _ = valuation O K ((œÜ _) ^ a) ^ (d j * ‚àè i, d i) := by
          ¬∑ simp only [œà, ‚Üê map_pow]
            congr 2
            rw [‚Üê pow_mul, ‚Üê pow_mul, ‚Üê mul_assoc, ‚Üê mul_assoc, ‚Üê mul_assoc,
              Finset.univ.prod_erase_mul d (h := Finset.mem_univ _),
              mul_comm _ a, mul_right_comm]
","theorem valuativeCriterion_existence_aux
    {O : Type*} [CommRing O] [IsDomain O] [ValuationRing O]
    {K : Type*} [Field K] [Algebra O K] [IsFractionRing O K]
    (œÜ‚ÇÄ : (ùíú 0) ‚Üí+* O)
    (Œπ : Type*) [Finite Œπ] (x : Œπ ‚Üí A) (h2 : Algebra.adjoin (ùíú 0) (Set.range x) = ‚ä§)
    (j : Œπ) (œÜ : Away ùíú (x j) ‚Üí+* K)
    (hcomm : (algebraMap O K).comp œÜ‚ÇÄ = œÜ.comp (fromZeroRingHom ùíú _))
    (d : Œπ ‚Üí ‚Ñï) (hdi : ‚àÄ i, 0 < d i) (hxdi : ‚àÄ i, x i ‚àà ùíú (d i)) :
    ‚àÉ (j‚ÇÄ : Œπ) (œÜ' : Away ùíú (x j * x j‚ÇÄ) ‚Üí+* K), œÜ'.comp (awayMap ùíú (hxdi j‚ÇÄ) rfl) = œÜ ‚àß
      (œÜ'.comp (awayMap ùíú (hxdi j) (mul_comm (x j) (x j‚ÇÄ)))).range ‚â§ (algebraMap O K).range ","Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 [[\n  Lemma 27.8.8. Let $S$ be a graded ring. The scheme $\\text{Proj}(S)$ is separated. \n\n    \n]] and Schemes, Lemma 26.22.1 [[\n  Lemma 26.22.1. Let $f : X \\to S$ be a morphism of schemes. If $f$ is separated, then $f$ satisfies the uniqueness part of the valuative criterion. \n\n    \n]]). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]]. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13 [[\n  Definition 10.50.13. Let $A$ be a valuation ring. \n  \n  \nThe totally ordered abelian group $(\\Gamma , \\geq )$ of Lemma 10.50.12 is called the value group of the valuation ring $A$. \n\n\nThe map $v : A - \\{ 0\\}  \\to \\Gamma $ and also $v : K^* \\to \\Gamma $ is called the valuation associated to $A$. \n\n\nThe valuation ring $A$ is called a discrete valuation ring if $\\Gamma \\cong \\mathbf{Z}$. \n\n\n\n]]. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n","Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 [[\n  Lemma 27.8.8. Let $S$ be a graded ring. The scheme $\\text{Proj}(S)$ is separated. \n\n    \n]] and Schemes, Lemma 26.22.1 [[\n  Lemma 26.22.1. Let $f : X \\to S$ be a morphism of schemes. If $f$ is separated, then $f$ satisfies the uniqueness part of the valuative criterion. \n\n    \n]]). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]]. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13 [[\n  Definition 10.50.13. Let $A$ be a valuation ring. \n  \n  \nThe totally ordered abelian group $(\\Gamma , \\geq )$ of Lemma 10.50.12 is called the value group of the valuation ring $A$. \n\n\nThe map $v : A - \\{ 0\\}  \\to \\Gamma $ and also $v : K^* \\to \\Gamma $ is called the valuation associated to $A$. \n\n\nThe valuation ring $A$ is called a discrete valuation ring if $\\Gamma \\cong \\mathbf{Z}$. \n\n\n\n]]. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: algebraic part","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is clearly implementing the algebraic/valuation-theoretic existence argument from the informal proof: it fixes a finite index type Œπ of homogeneous generators x i with degrees d i, defines a valuation-based quantity œà i (a scaled valuation of œÜ applied to the localized element), chooses an index i‚ÇÄ attaining a maximum/minimum via `Finset.max'`, proves the chosen element is nonzero hence a unit (`hunit : IsUnit ...`), constructs the factored map `œÜ'` using `IsLocalization.Away.lift`, and then proves the image lands in the valuation ring by rewriting membership as a valuation inequality (`ValuationRing.mem_integer_iff`, `Valuation.mem_integer_iff`) and bounding valuations using the extremality property `hi‚ÇÄ`. This matches the informal steps: pick i‚ÇÄ minimizing Œ≥_i, factor through S_(fx0), and show generators map into A by a valuation inequality derived from minimality.\n\nStructurally, the correspondence is strong: (1) choose extremal index among finitely many œà i/Œ≥ i; (2) show the corresponding localized element is invertible so the map factors through a further localization; (3) reduce to checking a generating set and prove valuation inequalities by induction on a span (Lean‚Äôs `Submodule.span_induction` mirrors ‚Äúgenerated by elements ...‚Äù); (4) use product/power valuation computations to conclude integrality. The main mismatch is that the informal proof is phrased in terms of Proj, opens D_+(f), renumbering into nonzero/zero cases, and explicit generators x_1^{e_1}‚Ä¶/x_0^{e_0}, while the Lean code works in a more abstract graded/localization setup (Away maps, span/top lemmas) and uses a maximum `Kmax` with a positivity lemma rather than explicitly discussing the r/nonzero split. Also, the informal proof mentions uniqueness via separatedness, which is not present here (but the user note says we are focusing on the algebraic part). Overall the Lean proof captures the core valuation-minimality factorization argument with only minor presentational/structural differences.""}"
63,01MF,"lemma valuativeCriterion_existence [Algebra.FiniteType (ùíú 0) A] :
    ValuativeCriterion.Existence (Proj.toSpecZero ùíú) := by
  rintro ‚ü®O, K, i‚ÇÅ, i‚ÇÇ, w‚ü©
  obtain ‚ü®x, hx, hx'‚ü© := GradedAlgebra.exists_finset_adjoin_eq_top_and_homogeneous_ne_zero ùíú
  choose d hd hxd using hx'
  have : i‚ÇÅ (IsLocalRing.closedPoint K) ‚àà (‚ä§ : (Proj ùíú).Opens) := trivial
  rw [‚Üê Proj.iSup_basicOpen_eq_top' ùíú (Œπ := x) (‚Üë) (fun i ‚Ü¶ ‚ü®_, hxd _ i.2‚ü©) (by simpa using hx),
    TopologicalSpace.Opens.mem_iSup] at this
  obtain ‚ü®i, hi‚ü© := this
  have : Set.range i‚ÇÅ ‚äÜ (Proj.awayŒπ ùíú _ (hxd i i.2) (hd i i.2).bot_lt).opensRange := by
    rw [Proj.opensRange_awayŒπ]
    rintro _ ‚ü®x, rfl‚ü©
    obtain rfl := Subsingleton.elim x (IsLocalRing.closedPoint K)
    exact hi
  let œÜ : Spec (.of <| K) ‚ü∂ _ := IsOpenImmersion.lift _ _ this
  have H : Spec.preimage i‚ÇÇ ‚â´ CommRingCat.ofHom (algebraMap O K) =
      CommRingCat.ofHom (fromZeroRingHom ùíú _) ‚â´ Spec.preimage œÜ := by
    apply Spec.map_injective
    simp only [Spec.map_comp, Spec.map_preimage, ‚Üê w.w]
    rw [‚Üê Proj.awayŒπ_toSpecZero _ _ (hxd i i.2), IsOpenImmersion.lift_fac_assoc]
    exact Nat.zero_lt_of_ne_zero (hd i i.2)
  obtain ‚ü®i‚ÇÄ, œÜ', hœÜ, hœÜ'‚ü© :=
    valuativeCriterion_existence_aux ùíú (Spec.preimage i‚ÇÇ).hom x (‚Üë) (by simpa using hx) i
      (O := O) (K := K) (Spec.preimage œÜ).hom congr(($H).hom)
      (fun i ‚Ü¶ d _ i.2) (fun i ‚Ü¶ (hd _ i.2).bot_lt) (fun i ‚Ü¶ hxd _ i.2)
  let e : O ‚âÉ+* (algebraMap O K).range :=
    (AlgEquiv.ofInjective (Algebra.ofId O K) (IsFractionRing.injective _ _)).toRingEquiv
  let œÜ'' := e.symm.toRingHom.comp ((Subring.inclusion hœÜ').comp (RingHom.rangeRestrict _))
  have hœÜ'' : (algebraMap O K).comp œÜ'' = œÜ'.comp (awayMap ùíú (hxd _ i.2) (mul_comm _ _)) := by
    ext x
    exact congr_arg Subtype.val (e.apply_symm_apply _)
  refine ‚ü®‚ü®Spec.map (CommRingCat.ofHom œÜ'') ‚â´ Proj.awayŒπ ùíú _ (hxd _ i‚ÇÄ.2) (hd _ _).bot_lt, ?_, ?_‚ü©‚ü©
  ¬∑ rw [‚Üê Spec.map_comp_assoc]
    convert IsOpenImmersion.lift_fac _ _ this using 1
    change _ = œÜ ‚â´ _
    rw [‚Üê Spec.map_preimage œÜ, ‚Üê CommRingCat.ofHom_hom (Spec.preimage œÜ), ‚Üê hœÜ,
      ‚Üê CommRingCat.ofHom_comp]
    simp [hœÜ'', SpecMap_awayMap_awayŒπ, add_comm]
  ¬∑ simp only [Category.assoc, Proj.awayŒπ_toSpecZero, ‚Üê Spec.map_comp]
    conv_rhs => rw [‚Üê Spec.map_preimage i‚ÇÇ]
    congr 1
    ext x
    apply IsFractionRing.injective O K
    refine (DFunLike.congr_fun hœÜ'' (fromZeroRingHom ùíú _ _)).trans ?_
    simp only [RingHom.coe_comp, Function.comp_apply]
    rw [awayMap_fromZeroRingHom, ‚Üê awayMap_fromZeroRingHom ùíú (hxd i‚ÇÄ i‚ÇÄ.2) rfl,
      ‚Üê RingHom.comp_apply, hœÜ]
    exact congr($(H.symm) x)
",Formal Proof of Stacks Project Tag 01MF,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/ProjectiveSpectrum/Proper.lean#L310-L357,Q27041,,27.8.11,lemma,3.0,"['01M3', '01LE', '0ELP']","\n  Lemma 27.8.11. Let $S$ be a graded ring. If $S$ is finitely generated as an algebra over $S_0$, then the morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(S_0)$ satisfies the existence and uniqueness parts of the valuative criterion, see Schemes, Definition 26.20.3. \n\n    \n      Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 and Schemes, Lemma 26.22.1). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n","\n  Lemma 27.8.11. Let $S$ be a graded ring. If $S$ is finitely generated as an algebra over $S_0$, then the morphism $\\text{Proj}(S) \\to \\mathop{\\mathrm{Spec}}(S_0)$ satisfies the existence and uniqueness parts of the valuative criterion, see Schemes, Definition 26.20.3. \n\n    \n","Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 and Schemes, Lemma 26.22.1). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n"," by
  rintro ‚ü®O, K, i‚ÇÅ, i‚ÇÇ, w‚ü©
  obtain ‚ü®x, hx, hx'‚ü© := GradedAlgebra.exists_finset_adjoin_eq_top_and_homogeneous_ne_zero ùíú
  choose d hd hxd using hx'
  have : i‚ÇÅ (IsLocalRing.closedPoint K) ‚àà (‚ä§ : (Proj ùíú).Opens) := trivial
  rw [‚Üê Proj.iSup_basicOpen_eq_top' ùíú (Œπ := x) (‚Üë) (fun i ‚Ü¶ ‚ü®_, hxd _ i.2‚ü©) (by simpa using hx),
    TopologicalSpace.Opens.mem_iSup] at this
  obtain ‚ü®i, hi‚ü© := this
  have : Set.range i‚ÇÅ ‚äÜ (Proj.awayŒπ ùíú _ (hxd i i.2) (hd i i.2).bot_lt).opensRange := by
    rw [Proj.opensRange_awayŒπ]
    rintro _ ‚ü®x, rfl‚ü©
    obtain rfl := Subsingleton.elim x (IsLocalRing.closedPoint K)
    exact hi
  let œÜ : Spec (.of <| K) ‚ü∂ _ := IsOpenImmersion.lift _ _ this
  have H : Spec.preimage i‚ÇÇ ‚â´ CommRingCat.ofHom (algebraMap O K) =
      CommRingCat.ofHom (fromZeroRingHom ùíú _) ‚â´ Spec.preimage œÜ := by
    apply Spec.map_injective
    simp only [Spec.map_comp, Spec.map_preimage, ‚Üê w.w]
    rw [‚Üê Proj.awayŒπ_toSpecZero _ _ (hxd i i.2), IsOpenImmersion.lift_fac_assoc]
    exact Nat.zero_lt_of_ne_zero (hd i i.2)
  obtain ‚ü®i‚ÇÄ, œÜ', hœÜ, hœÜ'‚ü© :=
    valuativeCriterion_existence_aux ùíú (Spec.preimage i‚ÇÇ).hom x (‚Üë) (by simpa using hx) i
      (O := O) (K := K) (Spec.preimage œÜ).hom congr(($H).hom)
      (fun i ‚Ü¶ d _ i.2) (fun i ‚Ü¶ (hd _ i.2).bot_lt) (fun i ‚Ü¶ hxd _ i.2)
  let e : O ‚âÉ+* (algebraMap O K).range :=
    (AlgEquiv.ofInjective (Algebra.ofId O K) (IsFractionRing.injective _ _)).toRingEquiv
  let œÜ'' := e.symm.toRingHom.comp ((Subring.inclusion hœÜ').comp (RingHom.rangeRestrict _))
  have hœÜ'' : (algebraMap O K).comp œÜ'' = œÜ'.comp (awayMap ùíú (hxd _ i.2) (mul_comm _ _)) := by
    ext x
    exact congr_arg Subtype.val (e.apply_symm_apply _)
  refine ‚ü®‚ü®Spec.map (CommRingCat.ofHom œÜ'') ‚â´ Proj.awayŒπ ùíú _ (hxd _ i‚ÇÄ.2) (hd _ _).bot_lt, ?_, ?_‚ü©‚ü©
  ¬∑ rw [‚Üê Spec.map_comp_assoc]
    convert IsOpenImmersion.lift_fac _ _ this using 1
    change _ = œÜ ‚â´ _
    rw [‚Üê Spec.map_preimage œÜ, ‚Üê CommRingCat.ofHom_hom (Spec.preimage œÜ), ‚Üê hœÜ,
      ‚Üê CommRingCat.ofHom_comp]
    simp [hœÜ'', SpecMap_awayMap_awayŒπ, add_comm]
  ¬∑ simp only [Category.assoc, Proj.awayŒπ_toSpecZero, ‚Üê Spec.map_comp]
    conv_rhs => rw [‚Üê Spec.map_preimage i‚ÇÇ]
    congr 1
    ext x
    apply IsFractionRing.injective O K
    refine (DFunLike.congr_fun hœÜ'' (fromZeroRingHom ùíú _ _)).trans ?_
    simp only [RingHom.coe_comp, Function.comp_apply]
    rw [awayMap_fromZeroRingHom, ‚Üê awayMap_fromZeroRingHom ùíú (hxd i‚ÇÄ i‚ÇÄ.2) rfl,
      ‚Üê RingHom.comp_apply, hœÜ]
    exact congr($(H.symm) x)
","lemma valuativeCriterion_existence [Algebra.FiniteType (ùíú 0) A] :
    ValuativeCriterion.Existence (Proj.toSpecZero ùíú) ","Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 [[\n  Lemma 27.8.8. Let $S$ be a graded ring. The scheme $\\text{Proj}(S)$ is separated. \n\n    \n]] and Schemes, Lemma 26.22.1 [[\n  Lemma 26.22.1. Let $f : X \\to S$ be a morphism of schemes. If $f$ is separated, then $f$ satisfies the uniqueness part of the valuative criterion. \n\n    \n]]). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]]. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13 [[\n  Definition 10.50.13. Let $A$ be a valuation ring. \n  \n  \nThe totally ordered abelian group $(\\Gamma , \\geq )$ of Lemma 10.50.12 is called the value group of the valuation ring $A$. \n\n\nThe map $v : A - \\{ 0\\}  \\to \\Gamma $ and also $v : K^* \\to \\Gamma $ is called the valuation associated to $A$. \n\n\nThe valuation ring $A$ is called a discrete valuation ring if $\\Gamma \\cong \\mathbf{Z}$. \n\n\n\n]]. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n","Proof.\n      The uniqueness part follows from the fact that $\\text{Proj}(S)$ is separated (Lemma 27.8.8 [[\n  Lemma 27.8.8. Let $S$ be a graded ring. The scheme $\\text{Proj}(S)$ is separated. \n\n    \n]] and Schemes, Lemma 26.22.1 [[\n  Lemma 26.22.1. Let $f : X \\to S$ be a morphism of schemes. If $f$ is separated, then $f$ satisfies the uniqueness part of the valuative criterion. \n\n    \n]]). Choose $x_ i \\in S_{+}$ homogeneous, $i = 1, \\ldots , n$ which generate $S$ over $S_0$. Let $d_ i = \\deg (x_ i)$ and set $d = \\text{lcm}\\{ d_ i\\} $. Suppose we are given a diagram \n    \n      \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  \\text{Proj}(S) \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] &  \\mathop{\\mathrm{Spec}}(S_0) }  \\]\n\n    \n       as in Schemes, Definition 26.20.3 [[\n  Definition 26.20.3. Let $f : X \\to S$ be a morphism of schemes. We say $f$ satisfies the existence part of the valuative criterion if given any commutative solid diagram \n  \n  \\[  \\xymatrix{ \\mathop{\\mathrm{Spec}}(K) \\ar[r] \\ar[d] &  X \\ar[d] \\\\  \\mathop{\\mathrm{Spec}}(A) \\ar[r] \\ar@{-->}[ru] &  S }  \\]\n\n   where $A$ is a valuation ring with field of fractions $K$, the dotted arrow exists. We say $f$ satisfies the uniqueness part of the valuative criterion if there is at most one dotted arrow given any diagram as above (without requiring existence of course). \n]]. Denote $v : K^* \\to \\Gamma $ the valuation of $A$, see Algebra, Definition 10.50.13 [[\n  Definition 10.50.13. Let $A$ be a valuation ring. \n  \n  \nThe totally ordered abelian group $(\\Gamma , \\geq )$ of Lemma 10.50.12 is called the value group of the valuation ring $A$. \n\n\nThe map $v : A - \\{ 0\\}  \\to \\Gamma $ and also $v : K^* \\to \\Gamma $ is called the valuation associated to $A$. \n\n\nThe valuation ring $A$ is called a discrete valuation ring if $\\Gamma \\cong \\mathbf{Z}$. \n\n\n\n]]. We may choose an $f \\in S_{+}$ homogeneous such that $\\mathop{\\mathrm{Spec}}(K)$ maps into $D_{+}(f)$. Then we get a commutative diagram of ring maps \n    \n      \n  \\[  \\xymatrix{ K &  S_{(f)} \\ar[l]^{\\varphi } \\\\  A \\ar[u] &  S_0 \\ar[l] \\ar[u] }  \\]\n\n    \n       After renumbering we may assume that $\\varphi (x_ i^{\\deg (f)}/f^{d_ i})$ is nonzero for $i = 1, \\ldots , r$ and zero for $i = r + 1, \\ldots , n$. Since the open sets $D_{+}(x_ i)$ cover $\\text{Proj}(S)$ we see that $r \\geq 1$. Let $i_0 \\in \\{ 1, \\ldots , r\\} $ be an index minimizing $\\gamma _ i = (d/d_ i)v(\\varphi (x_ i^{\\deg (f)}/f^{d_ i}))$ in $\\Gamma $. For convenience set $x_0 = x_{i_0}$ and $d_0 = d_{i_0}$. The ring map $\\varphi $ factors though a map $\\varphi \' : S_{(fx_0)} \\to K$ which gives a ring map $S_{(x_0)} \\to S_{(fx_0)} \\to K$. The algebra $S_{(x_0)}$ is generated over $S_0$ by the elements $x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}$, where $\\sum e_ i d_ i = e_0 d_0$. If $e_ i > 0$ for some $i > r$, then $\\varphi \'(x_1^{e_1} \\ldots x_ n^{e_ n}/x_0^{e_0}) = 0$. If $e_ i = 0$ for $i > r$, then we have \n    \n      \n  \\begin{align*}  d \\deg (f) v(\\varphi \'(x_1^{e_1} \\ldots x_ r^{e_ r}/x_0^{e_0})) &  = d v(\\varphi \'(x_1^{e_1 \\deg (f)} \\ldots x_ r^{e_ r \\deg (f)}/x_0^{e_0 \\deg (f)})) \\\\ &  = d \\sum e_ i v(\\varphi \'(x_ i^{\\deg (f)}/f^{d_ i})) - e_0 v(\\varphi \'(x_0^{\\deg (f)}/f^{d_0})) \\\\ &  = \\sum e_ i d_ i \\gamma _ i - e_0 d_0 \\gamma _0 \\\\ &  \\geq \\sum e_ i d_ i \\gamma _0 - e_0 d_0 \\gamma _0 = 0 \\end{align*}\n\n    \n       because $\\gamma _0$ is minimal among the $\\gamma _ i$. This implies that $S_{(x_0)}$ maps into $A$ via $\\varphi \'$. The corresponding morphism of schemes $\\mathop{\\mathrm{Spec}}(A) \\to \\mathop{\\mathrm{Spec}}(S_{(x_0)}) = D_{+}(x_0) \\subset \\text{Proj}(S)$ provides the morphism fitting into the first commutative diagram of this proof. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is clearly constructing the *existence* morphism in the valuative criterion for Proj: it takes a valuative diagram ‚ü®O,K,i‚ÇÅ,i‚ÇÇ,w‚ü©, chooses finitely many homogeneous generators (via `exists_finset_adjoin_eq_top_and_homogeneous_ne_zero`), uses the cover by basic opens `awayŒπ`/`D_+(x_i)` to pick an index `i` such that the closed point lands in one basic open, lifts `Spec K` into that open immersion, and then applies an auxiliary lemma `valuativeCriterion_existence_aux` to produce the required extension map from `Spec O` into Proj. This matches the informal proof‚Äôs overall goal and its use of a finite homogeneous generating set and the standard cover by `D_+(x_i)`.\n\nStructurally, however, the informal proof‚Äôs core argument is the valuation-minimization construction (choose f, renumber, define Œ≥_i, pick i‚ÇÄ minimizing Œ≥_i, prove the image lands in A, hence get `Spec A ‚Üí D_+(x‚ÇÄ)`). The Lean proof does not explicitly implement this valuation/Œ≥_i minimization reasoning; instead it delegates the key existence step to `valuativeCriterion_existence_aux` and then performs categorical/ring-theoretic glueing and range/equivalence manipulations (`IsOpenImmersion.lift`, `Spec.map_injective`, `IsFractionRing.injective`, `AlgEquiv.ofInjective`, etc.). Thus the high-level strategy (reduce to an affine open and extend) aligns, but the detailed mechanism differs and the uniqueness/separatedness discussion from the informal proof is absent in the provided Lean snippet.\n\nCompleteness/precision: the Lean proof contains many technical steps not mentioned informally (closed point argument, open immersion lift, ring equivalence to the range), and it omits the explicit valuation computations that are central in the informal text. Hence partial but not perfect alignment.""}"
64,01JJ,"theorem isRepresentable : F.1.IsRepresentable :=
  ‚ü®_, ‚ü®representableBy hf‚ü©‚ü©
",Formal Proof of Stacks Project Tag 01JJ,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/AlgebraicGeometry/Sites/Representability.lean#L200-L201,Q27041,,26.15.4,lemma,3.0,"['01JF', '01H8', '0ELP']","\n  Lemma 26.15.4. Let $F$ be a contravariant functor on the category of schemes with values in the category of sets. Suppose that \n  \n  \n$F$ satisfies the sheaf property for the Zariski topology, \n\n\nthere exists a set $I$ and a collection of subfunctors $F_ i \\subset F$ such that \n\n\n  \neach $F_ i$ is representable, \n\n\neach $F_ i \\subset F$ is representable by open immersions, and \n\n\nthe collection $(F_ i)_{i \\in I}$ covers $F$. \n\n\n\n\n\n   Then $F$ is representable. \n\n    \n      Proof.\n      Let $X_ i$ be a scheme representing $F_ i$ and let $\\xi _ i \\in F_ i(X_ i) \\subset F(X_ i)$ be the \xe2\x80\x9cuniversal family\xe2\x80\x9d. Because $F_ j \\subset F$ is representable by open immersions, there exists an open $U_{ij} \\subset X_ i$ such that $T \\to X_ i$ factors through $U_{ij}$ if and only if $\\xi _ i|_ T \\in F_ j(T)$. In particular $\\xi _ i|_{U_{ij}} \\in F_ j(U_{ij})$ and therefore we obtain a canonical morphism $\\varphi _{ij} : U_{ij} \\to X_ j$ such that $\\varphi _{ij}^*\\xi _ j = \\xi _ i|_{U_{ij}}$. By definition of $U_{ji}$ this implies that $\\varphi _{ij}$ factors through $U_{ji}$. Since $(\\varphi _{ij} \\circ \\varphi _{ji})^*\\xi _ j =\\varphi _{ji}^*(\\varphi _{ij}^*\\xi _ j) = \\varphi _{ji}^*\\xi _ i = \\xi _ j$ we conclude that $\\varphi _{ij} \\circ \\varphi _{ji} = \\text{id}_{U_{ji}}$ because the pair $(X_ j, \\xi _ j)$ represents $F_ j$. In particular the maps $\\varphi _{ij} : U_{ij} \\to U_{ji}$ are isomorphisms of schemes. Next we have to show that $\\varphi _{ij}^{-1}(U_{ji} \\cap U_{jk}) = U_{ij} \\cap U_{ik}$. This is true because (a) $U_{ji} \\cap U_{jk}$ is the largest open of $U_{ji}$ such that $\\xi _ j$ restricts to an element of $F_ k$, (b) $U_{ij} \\cap U_{ik}$ is the largest open of $U_{ij}$ such that $\\xi _ i$ restricts to an element of $F_ k$, and (c) $\\varphi _{ij}^*\\xi _ j = \\xi _ i$. Moreover, the cocycle condition in Section 26.14 follows because both $\\varphi _{jk}|_{U_{ji} \\cap U_{jk}} \\circ \\varphi _{ij}|_{U_{ij} \\cap U_{ik}}$ and $\\varphi _{ik}|_{U_{ij} \\cap U_{ik}}$ pullback $\\xi _ k$ to the element $\\xi _ i$. Thus we may apply Lemma 26.14.2 to obtain a scheme $X$ with an open covering $X = \\bigcup U_ i$ and isomorphisms $\\varphi _ i : X_ i \\to U_ i$ with properties as in Lemma 26.14.1. Let $\\xi _ i\' = (\\varphi _ i^{-1})^* \\xi _ i$. The conditions of Lemma 26.14.1 imply that $\\xi _ i\'|_{U_ i \\cap U_ j} = \\xi _ j\'|_{U_ i \\cap U_ j}$. Therefore, by the condition that $F$ satisfies the sheaf condition in the Zariski topology we see that there exists an element $\\xi \' \\in F(X)$ such that $\\xi _ i = \\varphi _ i^*\\xi \'|_{U_ i}$ for all $i$. Since $\\varphi _ i$ is an isomorphism we also get that $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$. \n    \n      We claim that the pair $(X, \\xi \')$ represents the functor $F$. To show this, let $T$ be a scheme and let $\\xi \\in F(T)$. We will construct a unique morphism $g : T \\to X$ such that $g^*\\xi \' = \\xi $. Namely, by the condition that the subfunctors $F_ i$ cover $F$ there exists an open covering $T = \\bigcup V_ i$ such that for each $i$ the restriction $\\xi |_{V_ i} \\in F_ i(V_ i)$. Moreover, since each of the inclusions $F_ i \\subset F$ are representable by open immersions we may assume that each $V_ i \\subset T$ is maximal open with this property. Because, $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$ we get a unique morphism $g_ i : V_ i \\to U_ i$ such that $g_ i^*\\xi \'|_{U_ i} = \\xi |_{V_ i}$. On the overlaps $V_ i \\cap V_ j$ the morphisms $g_ i$ and $g_ j$ agree, for example because they both pull back $\\xi \'|_{U_ i \\cap U_ j} \\in F_ i(U_ i \\cap U_ j)$ to the same element. Thus the morphisms $g_ i$ glue to a unique morphism from $T \\to X$ as desired. \n      $\\square$\n    \n","\n  Lemma 26.15.4. Let $F$ be a contravariant functor on the category of schemes with values in the category of sets. Suppose that \n  \n  \n$F$ satisfies the sheaf property for the Zariski topology, \n\n\nthere exists a set $I$ and a collection of subfunctors $F_ i \\subset F$ such that \n\n\n  \neach $F_ i$ is representable, \n\n\neach $F_ i \\subset F$ is representable by open immersions, and \n\n\nthe collection $(F_ i)_{i \\in I}$ covers $F$. \n\n\n\n\n\n   Then $F$ is representable. \n\n    \n","Proof.\n      Let $X_ i$ be a scheme representing $F_ i$ and let $\\xi _ i \\in F_ i(X_ i) \\subset F(X_ i)$ be the \xe2\x80\x9cuniversal family\xe2\x80\x9d. Because $F_ j \\subset F$ is representable by open immersions, there exists an open $U_{ij} \\subset X_ i$ such that $T \\to X_ i$ factors through $U_{ij}$ if and only if $\\xi _ i|_ T \\in F_ j(T)$. In particular $\\xi _ i|_{U_{ij}} \\in F_ j(U_{ij})$ and therefore we obtain a canonical morphism $\\varphi _{ij} : U_{ij} \\to X_ j$ such that $\\varphi _{ij}^*\\xi _ j = \\xi _ i|_{U_{ij}}$. By definition of $U_{ji}$ this implies that $\\varphi _{ij}$ factors through $U_{ji}$. Since $(\\varphi _{ij} \\circ \\varphi _{ji})^*\\xi _ j =\\varphi _{ji}^*(\\varphi _{ij}^*\\xi _ j) = \\varphi _{ji}^*\\xi _ i = \\xi _ j$ we conclude that $\\varphi _{ij} \\circ \\varphi _{ji} = \\text{id}_{U_{ji}}$ because the pair $(X_ j, \\xi _ j)$ represents $F_ j$. In particular the maps $\\varphi _{ij} : U_{ij} \\to U_{ji}$ are isomorphisms of schemes. Next we have to show that $\\varphi _{ij}^{-1}(U_{ji} \\cap U_{jk}) = U_{ij} \\cap U_{ik}$. This is true because (a) $U_{ji} \\cap U_{jk}$ is the largest open of $U_{ji}$ such that $\\xi _ j$ restricts to an element of $F_ k$, (b) $U_{ij} \\cap U_{ik}$ is the largest open of $U_{ij}$ such that $\\xi _ i$ restricts to an element of $F_ k$, and (c) $\\varphi _{ij}^*\\xi _ j = \\xi _ i$. Moreover, the cocycle condition in Section 26.14 follows because both $\\varphi _{jk}|_{U_{ji} \\cap U_{jk}} \\circ \\varphi _{ij}|_{U_{ij} \\cap U_{ik}}$ and $\\varphi _{ik}|_{U_{ij} \\cap U_{ik}}$ pullback $\\xi _ k$ to the element $\\xi _ i$. Thus we may apply Lemma 26.14.2 to obtain a scheme $X$ with an open covering $X = \\bigcup U_ i$ and isomorphisms $\\varphi _ i : X_ i \\to U_ i$ with properties as in Lemma 26.14.1. Let $\\xi _ i\' = (\\varphi _ i^{-1})^* \\xi _ i$. The conditions of Lemma 26.14.1 imply that $\\xi _ i\'|_{U_ i \\cap U_ j} = \\xi _ j\'|_{U_ i \\cap U_ j}$. Therefore, by the condition that $F$ satisfies the sheaf condition in the Zariski topology we see that there exists an element $\\xi \' \\in F(X)$ such that $\\xi _ i = \\varphi _ i^*\\xi \'|_{U_ i}$ for all $i$. Since $\\varphi _ i$ is an isomorphism we also get that $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$. \n    \n      We claim that the pair $(X, \\xi \')$ represents the functor $F$. To show this, let $T$ be a scheme and let $\\xi \\in F(T)$. We will construct a unique morphism $g : T \\to X$ such that $g^*\\xi \' = \\xi $. Namely, by the condition that the subfunctors $F_ i$ cover $F$ there exists an open covering $T = \\bigcup V_ i$ such that for each $i$ the restriction $\\xi |_{V_ i} \\in F_ i(V_ i)$. Moreover, since each of the inclusions $F_ i \\subset F$ are representable by open immersions we may assume that each $V_ i \\subset T$ is maximal open with this property. Because, $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$ we get a unique morphism $g_ i : V_ i \\to U_ i$ such that $g_ i^*\\xi \'|_{U_ i} = \\xi |_{V_ i}$. On the overlaps $V_ i \\cap V_ j$ the morphisms $g_ i$ and $g_ j$ agree, for example because they both pull back $\\xi \'|_{U_ i \\cap U_ j} \\in F_ i(U_ i \\cap U_ j)$ to the same element. Thus the morphisms $g_ i$ glue to a unique morphism from $T \\to X$ as desired. \n      $\\square$\n    \n","
  ‚ü®_, ‚ü®representableBy hf‚ü©‚ü©
",theorem isRepresentable : F.1.IsRepresentable ,"Proof.\n      Let $X_ i$ be a scheme representing $F_ i$ and let $\\xi _ i \\in F_ i(X_ i) \\subset F(X_ i)$ be the \xe2\x80\x9cuniversal family\xe2\x80\x9d. Because $F_ j \\subset F$ is representable by open immersions, there exists an open $U_{ij} \\subset X_ i$ such that $T \\to X_ i$ factors through $U_{ij}$ if and only if $\\xi _ i|_ T \\in F_ j(T)$. In particular $\\xi _ i|_{U_{ij}} \\in F_ j(U_{ij})$ and therefore we obtain a canonical morphism $\\varphi _{ij} : U_{ij} \\to X_ j$ such that $\\varphi _{ij}^*\\xi _ j = \\xi _ i|_{U_{ij}}$. By definition of $U_{ji}$ this implies that $\\varphi _{ij}$ factors through $U_{ji}$. Since $(\\varphi _{ij} \\circ \\varphi _{ji})^*\\xi _ j =\\varphi _{ji}^*(\\varphi _{ij}^*\\xi _ j) = \\varphi _{ji}^*\\xi _ i = \\xi _ j$ we conclude that $\\varphi _{ij} \\circ \\varphi _{ji} = \\text{id}_{U_{ji}}$ because the pair $(X_ j, \\xi _ j)$ represents $F_ j$. In particular the maps $\\varphi _{ij} : U_{ij} \\to U_{ji}$ are isomorphisms of schemes. Next we have to show that $\\varphi _{ij}^{-1}(U_{ji} \\cap U_{jk}) = U_{ij} \\cap U_{ik}$. This is true because (a) $U_{ji} \\cap U_{jk}$ is the largest open of $U_{ji}$ such that $\\xi _ j$ restricts to an element of $F_ k$, (b) $U_{ij} \\cap U_{ik}$ is the largest open of $U_{ij}$ such that $\\xi _ i$ restricts to an element of $F_ k$, and (c) $\\varphi _{ij}^*\\xi _ j = \\xi _ i$. Moreover, the cocycle condition in Section 26.14 [[26.14 Glueing schemes\n\n\nLet $I$ be a set. For each $i \\in I$ let $(X_ i, \\mathcal{O}_ i)$ be a locally ringed space. (Actually the construction that follows works equally well for ringed spaces.) For each pair $i, j \\in I$ let $U_{ij} \\subset X_ i$ be an open subspace. For each pair $i, j \\in I$, let \n\n\n  \\[  \\varphi _{ij} : U_{ij} \\to U_{ji}  \\]\n\n\n be an isomorphism of locally ringed spaces. For convenience we assume that $U_{ii} = X_ i$. For each triple $i, j, k \\in I$ assume that \n\n\n  \nwe have $\\varphi _{ij}^{-1}(U_{ji} \\cap U_{jk}) = U_{ij} \\cap U_{ik}$, and \n\n\nthe diagram \n\n\n  \\[  \\xymatrix{ U_{ij} \\cap U_{ik} \\ar[rr]_{\\varphi _{ik}} \\ar[rd]_{\\varphi _{ij}} &  &  U_{ki} \\cap U_{kj} \\\\  &  U_{ji} \\cap U_{jk} \\ar[ru]_{\\varphi _{jk}} }  \\]\n\n\n is commutative. \n\n\n\n\n (In particular, it follows that $\\varphi _{ii} = \\text{id}_{X_ i}$.) Let us call a collection $(I, (X_ i)_{i\\in I}, (U_{ij})_{i, j\\in I}, (\\varphi _{ij})_{i, j\\in I})$ satisfying the conditions above a glueing data. \n\n\n\n       \n      \n  Lemma 26.14.1. Given any glueing data of locally ringed spaces there exists a locally ringed space $X$ and open subspaces $U_ i \\subset X$ together with isomorphisms $\\varphi _ i : X_ i \\to U_ i$ of locally ringed spaces such that \n  \n  \n$X=\\bigcup _{i\\in I} U_ i$, \n\n\n$\\varphi _ i(U_{ij}) = U_ i \\cap U_ j$, and \n\n\n$\\varphi _{ij} = \\varphi _ j^{-1}|_{U_ i \\cap U_ j} \\circ \\varphi _ i|_{U_{ij}}$. \n\n\n\n   The locally ringed space $X$ is characterized by the following mapping properties: Given a locally ringed space $Y$ we have \n  \n  \\begin{eqnarray*}  \\mathop{\\mathrm{Mor}}\\nolimits (X, Y) &  = &  \\{  (f_ i)_{i\\in I} \\mid f_ i : X_ i \\to Y, \\  f_ j \\circ \\varphi _{ij} = f_ i|_{U_{ij}}\\}  \\\\  f &  \\mapsto &  (f|_{U_ i} \\circ \\varphi _ i)_{i \\in I} \\\\  \\mathop{\\mathrm{Mor}}\\nolimits (Y, X) &  = &  \\left\\{  \\begin{matrix}  \\text{open covering }Y = \\bigcup \\nolimits _{i \\in I} V_ i\\text{ and } (g_ i : V_ i \\to X_ i)_{i \\in I} \\text{ such that}\n\n\\\\  g_ i^{-1}(U_{ij}) = V_ i \\cap V_ j \\text{ and } g_ j|_{V_ i \\cap V_ j} = \\varphi _{ij} \\circ g_ i|_{V_ i \\cap V_ j} \n\n\\end{matrix} \\right\\}  \\\\  g &  \\mapsto &  V_ i = g^{-1}(U_ i), \\  g_ i = \\varphi _ i^{-1} \\circ g|_{V_ i} \\end{eqnarray*}\n\n \n\n\n    \n]] follows because both $\\varphi _{jk}|_{U_{ji} \\cap U_{jk}} \\circ \\varphi _{ij}|_{U_{ij} \\cap U_{ik}}$ and $\\varphi _{ik}|_{U_{ij} \\cap U_{ik}}$ pullback $\\xi _ k$ to the element $\\xi _ i$. Thus we may apply Lemma 26.14.2 [[\n       \n      \n  Lemma 26.14.2. In Lemma 26.14.1 above, assume that all $X_ i$ are schemes. Then the resulting locally ringed space $X$ is a scheme. \n\n    \n]] to obtain a scheme $X$ with an open covering $X = \\bigcup U_ i$ and isomorphisms $\\varphi _ i : X_ i \\to U_ i$ with properties as in Lemma 26.14.1 [[\n       \n      \n  Lemma 26.14.1. Given any glueing data of locally ringed spaces there exists a locally ringed space $X$ and open subspaces $U_ i \\subset X$ together with isomorphisms $\\varphi _ i : X_ i \\to U_ i$ of locally ringed spaces such that \n  \n  \n$X=\\bigcup _{i\\in I} U_ i$, \n\n\n$\\varphi _ i(U_{ij}) = U_ i \\cap U_ j$, and \n\n\n$\\varphi _{ij} = \\varphi _ j^{-1}|_{U_ i \\cap U_ j} \\circ \\varphi _ i|_{U_{ij}}$. \n\n\n\n   The locally ringed space $X$ is characterized by the following mapping properties: Given a locally ringed space $Y$ we have \n  \n  \\begin{eqnarray*}  \\mathop{\\mathrm{Mor}}\\nolimits (X, Y) &  = &  \\{  (f_ i)_{i\\in I} \\mid f_ i : X_ i \\to Y, \\  f_ j \\circ \\varphi _{ij} = f_ i|_{U_{ij}}\\}  \\\\  f &  \\mapsto &  (f|_{U_ i} \\circ \\varphi _ i)_{i \\in I} \\\\  \\mathop{\\mathrm{Mor}}\\nolimits (Y, X) &  = &  \\left\\{  \\begin{matrix}  \\text{open covering }Y = \\bigcup \\nolimits _{i \\in I} V_ i\\text{ and } (g_ i : V_ i \\to X_ i)_{i \\in I} \\text{ such that}\n\n\\\\  g_ i^{-1}(U_{ij}) = V_ i \\cap V_ j \\text{ and } g_ j|_{V_ i \\cap V_ j} = \\varphi _{ij} \\circ g_ i|_{V_ i \\cap V_ j} \n\n\\end{matrix} \\right\\}  \\\\  g &  \\mapsto &  V_ i = g^{-1}(U_ i), \\  g_ i = \\varphi _ i^{-1} \\circ g|_{V_ i} \\end{eqnarray*}\n\n\n    \n]]. Let $\\xi _ i\' = (\\varphi _ i^{-1})^* \\xi _ i$. The conditions of Lemma 26.14.1 [[\n       \n      \n  Lemma 26.14.1. Given any glueing data of locally ringed spaces there exists a locally ringed space $X$ and open subspaces $U_ i \\subset X$ together with isomorphisms $\\varphi _ i : X_ i \\to U_ i$ of locally ringed spaces such that \n  \n  \n$X=\\bigcup _{i\\in I} U_ i$, \n\n\n$\\varphi _ i(U_{ij}) = U_ i \\cap U_ j$, and \n\n\n$\\varphi _{ij} = \\varphi _ j^{-1}|_{U_ i \\cap U_ j} \\circ \\varphi _ i|_{U_{ij}}$. \n\n\n\n   The locally ringed space $X$ is characterized by the following mapping properties: Given a locally ringed space $Y$ we have \n  \n  \\begin{eqnarray*}  \\mathop{\\mathrm{Mor}}\\nolimits (X, Y) &  = &  \\{  (f_ i)_{i\\in I} \\mid f_ i : X_ i \\to Y, \\  f_ j \\circ \\varphi _{ij} = f_ i|_{U_{ij}}\\}  \\\\  f &  \\mapsto &  (f|_{U_ i} \\circ \\varphi _ i)_{i \\in I} \\\\  \\mathop{\\mathrm{Mor}}\\nolimits (Y, X) &  = &  \\left\\{  \\begin{matrix}  \\text{open covering }Y = \\bigcup \\nolimits _{i \\in I} V_ i\\text{ and } (g_ i : V_ i \\to X_ i)_{i \\in I} \\text{ such that}\n\n\\\\  g_ i^{-1}(U_{ij}) = V_ i \\cap V_ j \\text{ and } g_ j|_{V_ i \\cap V_ j} = \\varphi _{ij} \\circ g_ i|_{V_ i \\cap V_ j} \n\n\\end{matrix} \\right\\}  \\\\  g &  \\mapsto &  V_ i = g^{-1}(U_ i), \\  g_ i = \\varphi _ i^{-1} \\circ g|_{V_ i} \\end{eqnarray*}\n\n\n    \n]] imply that $\\xi _ i\'|_{U_ i \\cap U_ j} = \\xi _ j\'|_{U_ i \\cap U_ j}$. Therefore, by the condition that $F$ satisfies the sheaf condition in the Zariski topology we see that there exists an element $\\xi \' \\in F(X)$ such that $\\xi _ i = \\varphi _ i^*\\xi \'|_{U_ i}$ for all $i$. Since $\\varphi _ i$ is an isomorphism we also get that $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$. \n    \n      We claim that the pair $(X, \\xi \')$ represents the functor $F$. To show this, let $T$ be a scheme and let $\\xi \\in F(T)$. We will construct a unique morphism $g : T \\to X$ such that $g^*\\xi \' = \\xi $. Namely, by the condition that the subfunctors $F_ i$ cover $F$ there exists an open covering $T = \\bigcup V_ i$ such that for each $i$ the restriction $\\xi |_{V_ i} \\in F_ i(V_ i)$. Moreover, since each of the inclusions $F_ i \\subset F$ are representable by open immersions we may assume that each $V_ i \\subset T$ is maximal open with this property. Because, $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$ we get a unique morphism $g_ i : V_ i \\to U_ i$ such that $g_ i^*\\xi \'|_{U_ i} = \\xi |_{V_ i}$. On the overlaps $V_ i \\cap V_ j$ the morphisms $g_ i$ and $g_ j$ agree, for example because they both pull back $\\xi \'|_{U_ i \\cap U_ j} \\in F_ i(U_ i \\cap U_ j)$ to the same element. Thus the morphisms $g_ i$ glue to a unique morphism from $T \\to X$ as desired. \n      $\\square$\n    \n","Proof.\n      Let $X_ i$ be a scheme representing $F_ i$ and let $\\xi _ i \\in F_ i(X_ i) \\subset F(X_ i)$ be the \xe2\x80\x9cuniversal family\xe2\x80\x9d. Because $F_ j \\subset F$ is representable by open immersions, there exists an open $U_{ij} \\subset X_ i$ such that $T \\to X_ i$ factors through $U_{ij}$ if and only if $\\xi _ i|_ T \\in F_ j(T)$. In particular $\\xi _ i|_{U_{ij}} \\in F_ j(U_{ij})$ and therefore we obtain a canonical morphism $\\varphi _{ij} : U_{ij} \\to X_ j$ such that $\\varphi _{ij}^*\\xi _ j = \\xi _ i|_{U_{ij}}$. By definition of $U_{ji}$ this implies that $\\varphi _{ij}$ factors through $U_{ji}$. Since $(\\varphi _{ij} \\circ \\varphi _{ji})^*\\xi _ j =\\varphi _{ji}^*(\\varphi _{ij}^*\\xi _ j) = \\varphi _{ji}^*\\xi _ i = \\xi _ j$ we conclude that $\\varphi _{ij} \\circ \\varphi _{ji} = \\text{id}_{U_{ji}}$ because the pair $(X_ j, \\xi _ j)$ represents $F_ j$. In particular the maps $\\varphi _{ij} : U_{ij} \\to U_{ji}$ are isomorphisms of schemes. Next we have to show that $\\varphi _{ij}^{-1}(U_{ji} \\cap U_{jk}) = U_{ij} \\cap U_{ik}$. This is true because (a) $U_{ji} \\cap U_{jk}$ is the largest open of $U_{ji}$ such that $\\xi _ j$ restricts to an element of $F_ k$, (b) $U_{ij} \\cap U_{ik}$ is the largest open of $U_{ij}$ such that $\\xi _ i$ restricts to an element of $F_ k$, and (c) $\\varphi _{ij}^*\\xi _ j = \\xi _ i$. Moreover, the cocycle condition in Section 26.14 [[26.14 Glueing schemes\n\n\nLet $I$ be a set. For each $i \\in I$ let $(X_ i, \\mathcal{O}_ i)$ be a locally ringed space. (Actually the construction that follows works equally well for ringed spaces.) For each pair $i, j \\in I$ let $U_{ij} \\subset X_ i$ be an open subspace. For each pair $i, j \\in I$, let \n\n\n  \\[  \\varphi _{ij} : U_{ij} \\to U_{ji}  \\]\n\n\n be an isomorphism of locally ringed spaces. For convenience we assume that $U_{ii} = X_ i$. For each triple $i, j, k \\in I$ assume that \n\n\n  \nwe have $\\varphi _{ij}^{-1}(U_{ji} \\cap U_{jk}) = U_{ij} \\cap U_{ik}$, and \n\n\nthe diagram \n\n\n  \\[  \\xymatrix{ U_{ij} \\cap U_{ik} \\ar[rr]_{\\varphi _{ik}} \\ar[rd]_{\\varphi _{ij}} &  &  U_{ki} \\cap U_{kj} \\\\  &  U_{ji} \\cap U_{jk} \\ar[ru]_{\\varphi _{jk}} }  \\]\n\n\n is commutative. \n\n\n\n\n (In particular, it follows that $\\varphi _{ii} = \\text{id}_{X_ i}$.) Let us call a collection $(I, (X_ i)_{i\\in I}, (U_{ij})_{i, j\\in I}, (\\varphi _{ij})_{i, j\\in I})$ satisfying the conditions above a glueing data. \n\n\n\n       \n      \n  Lemma 26.14.1. Given any glueing data of locally ringed spaces there exists a locally ringed space $X$ and open subspaces $U_ i \\subset X$ together with isomorphisms $\\varphi _ i : X_ i \\to U_ i$ of locally ringed spaces such that \n  \n  \n$X=\\bigcup _{i\\in I} U_ i$, \n\n\n$\\varphi _ i(U_{ij}) = U_ i \\cap U_ j$, and \n\n\n$\\varphi _{ij} = \\varphi _ j^{-1}|_{U_ i \\cap U_ j} \\circ \\varphi _ i|_{U_{ij}}$. \n\n\n\n   The locally ringed space $X$ is characterized by the following mapping properties: Given a locally ringed space $Y$ we have \n  \n  \\begin{eqnarray*}  \\mathop{\\mathrm{Mor}}\\nolimits (X, Y) &  = &  \\{  (f_ i)_{i\\in I} \\mid f_ i : X_ i \\to Y, \\  f_ j \\circ \\varphi _{ij} = f_ i|_{U_{ij}}\\}  \\\\  f &  \\mapsto &  (f|_{U_ i} \\circ \\varphi _ i)_{i \\in I} \\\\  \\mathop{\\mathrm{Mor}}\\nolimits (Y, X) &  = &  \\left\\{  \\begin{matrix}  \\text{open covering }Y = \\bigcup \\nolimits _{i \\in I} V_ i\\text{ and } (g_ i : V_ i \\to X_ i)_{i \\in I} \\text{ such that}\n\n\\\\  g_ i^{-1}(U_{ij}) = V_ i \\cap V_ j \\text{ and } g_ j|_{V_ i \\cap V_ j} = \\varphi _{ij} \\circ g_ i|_{V_ i \\cap V_ j} \n\n\\end{matrix} \\right\\}  \\\\  g &  \\mapsto &  V_ i = g^{-1}(U_ i), \\  g_ i = \\varphi _ i^{-1} \\circ g|_{V_ i} \\end{eqnarray*}\n\n \n\n\n    \n]] follows because both $\\varphi _{jk}|_{U_{ji} \\cap U_{jk}} \\circ \\varphi _{ij}|_{U_{ij} \\cap U_{ik}}$ and $\\varphi _{ik}|_{U_{ij} \\cap U_{ik}}$ pullback $\\xi _ k$ to the element $\\xi _ i$. Thus we may apply Lemma 26.14.2 [[\n       \n      \n  Lemma 26.14.2. In Lemma 26.14.1 above, assume that all $X_ i$ are schemes. Then the resulting locally ringed space $X$ is a scheme. \n\n    \n]] to obtain a scheme $X$ with an open covering $X = \\bigcup U_ i$ and isomorphisms $\\varphi _ i : X_ i \\to U_ i$ with properties as in Lemma 26.14.1 [[\n       \n      \n  Lemma 26.14.1. Given any glueing data of locally ringed spaces there exists a locally ringed space $X$ and open subspaces $U_ i \\subset X$ together with isomorphisms $\\varphi _ i : X_ i \\to U_ i$ of locally ringed spaces such that \n  \n  \n$X=\\bigcup _{i\\in I} U_ i$, \n\n\n$\\varphi _ i(U_{ij}) = U_ i \\cap U_ j$, and \n\n\n$\\varphi _{ij} = \\varphi _ j^{-1}|_{U_ i \\cap U_ j} \\circ \\varphi _ i|_{U_{ij}}$. \n\n\n\n   The locally ringed space $X$ is characterized by the following mapping properties: Given a locally ringed space $Y$ we have \n  \n  \\begin{eqnarray*}  \\mathop{\\mathrm{Mor}}\\nolimits (X, Y) &  = &  \\{  (f_ i)_{i\\in I} \\mid f_ i : X_ i \\to Y, \\  f_ j \\circ \\varphi _{ij} = f_ i|_{U_{ij}}\\}  \\\\  f &  \\mapsto &  (f|_{U_ i} \\circ \\varphi _ i)_{i \\in I} \\\\  \\mathop{\\mathrm{Mor}}\\nolimits (Y, X) &  = &  \\left\\{  \\begin{matrix}  \\text{open covering }Y = \\bigcup \\nolimits _{i \\in I} V_ i\\text{ and } (g_ i : V_ i \\to X_ i)_{i \\in I} \\text{ such that}\n\n\\\\  g_ i^{-1}(U_{ij}) = V_ i \\cap V_ j \\text{ and } g_ j|_{V_ i \\cap V_ j} = \\varphi _{ij} \\circ g_ i|_{V_ i \\cap V_ j} \n\n\\end{matrix} \\right\\}  \\\\  g &  \\mapsto &  V_ i = g^{-1}(U_ i), \\  g_ i = \\varphi _ i^{-1} \\circ g|_{V_ i} \\end{eqnarray*}\n\n\n    \n]]. Let $\\xi _ i\' = (\\varphi _ i^{-1})^* \\xi _ i$. The conditions of Lemma 26.14.1 [[\n       \n      \n  Lemma 26.14.1. Given any glueing data of locally ringed spaces there exists a locally ringed space $X$ and open subspaces $U_ i \\subset X$ together with isomorphisms $\\varphi _ i : X_ i \\to U_ i$ of locally ringed spaces such that \n  \n  \n$X=\\bigcup _{i\\in I} U_ i$, \n\n\n$\\varphi _ i(U_{ij}) = U_ i \\cap U_ j$, and \n\n\n$\\varphi _{ij} = \\varphi _ j^{-1}|_{U_ i \\cap U_ j} \\circ \\varphi _ i|_{U_{ij}}$. \n\n\n\n   The locally ringed space $X$ is characterized by the following mapping properties: Given a locally ringed space $Y$ we have \n  \n  \\begin{eqnarray*}  \\mathop{\\mathrm{Mor}}\\nolimits (X, Y) &  = &  \\{  (f_ i)_{i\\in I} \\mid f_ i : X_ i \\to Y, \\  f_ j \\circ \\varphi _{ij} = f_ i|_{U_{ij}}\\}  \\\\  f &  \\mapsto &  (f|_{U_ i} \\circ \\varphi _ i)_{i \\in I} \\\\  \\mathop{\\mathrm{Mor}}\\nolimits (Y, X) &  = &  \\left\\{  \\begin{matrix}  \\text{open covering }Y = \\bigcup \\nolimits _{i \\in I} V_ i\\text{ and } (g_ i : V_ i \\to X_ i)_{i \\in I} \\text{ such that}\n\n\\\\  g_ i^{-1}(U_{ij}) = V_ i \\cap V_ j \\text{ and } g_ j|_{V_ i \\cap V_ j} = \\varphi _{ij} \\circ g_ i|_{V_ i \\cap V_ j} \n\n\\end{matrix} \\right\\}  \\\\  g &  \\mapsto &  V_ i = g^{-1}(U_ i), \\  g_ i = \\varphi _ i^{-1} \\circ g|_{V_ i} \\end{eqnarray*}\n\n\n    \n]] imply that $\\xi _ i\'|_{U_ i \\cap U_ j} = \\xi _ j\'|_{U_ i \\cap U_ j}$. Therefore, by the condition that $F$ satisfies the sheaf condition in the Zariski topology we see that there exists an element $\\xi \' \\in F(X)$ such that $\\xi _ i = \\varphi _ i^*\\xi \'|_{U_ i}$ for all $i$. Since $\\varphi _ i$ is an isomorphism we also get that $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$. \n    \n      We claim that the pair $(X, \\xi \')$ represents the functor $F$. To show this, let $T$ be a scheme and let $\\xi \\in F(T)$. We will construct a unique morphism $g : T \\to X$ such that $g^*\\xi \' = \\xi $. Namely, by the condition that the subfunctors $F_ i$ cover $F$ there exists an open covering $T = \\bigcup V_ i$ such that for each $i$ the restriction $\\xi |_{V_ i} \\in F_ i(V_ i)$. Moreover, since each of the inclusions $F_ i \\subset F$ are representable by open immersions we may assume that each $V_ i \\subset T$ is maximal open with this property. Because, $(U_ i, \\xi \'|_{U_ i})$ represents the functor $F_ i$ we get a unique morphism $g_ i : V_ i \\to U_ i$ such that $g_ i^*\\xi \'|_{U_ i} = \\xi |_{V_ i}$. On the overlaps $V_ i \\cap V_ j$ the morphisms $g_ i$ and $g_ j$ agree, for example because they both pull back $\\xi \'|_{U_ i \\cap U_ j} \\in F_ i(U_ i \\cap U_ j)$ to the same element. Thus the morphisms $g_ i$ glue to a unique morphism from $T \\to X$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof is a substantial gluing argument: starting from schemes representing subfunctors Fi, constructing opens Uij, isomorphisms œÜij satisfying cocycle conditions, gluing the Xi to a scheme X, producing a global section Œæ‚Ä≤ by the Zariski sheaf condition, and finally proving (X, Œæ‚Ä≤) represents F via a universal mapping property. The formal proof, however, is just a short term constructor `‚ü®_, ‚ü®representableBy hf‚ü©‚ü©`, which appears to package an existence statement using a lemma `representableBy` applied to `hf`. Structurally it does not mirror the steps of constructing Uij/œÜij, verifying cocycles, gluing schemes, or using the sheaf condition; all of that is hidden inside `representableBy hf` (if it corresponds at all). Thus there is at best partial semantic alignment (both aim at representability/existence), but very weak structural correspondence and no explicit coverage of the key intermediate constructions from the informal proof.""}"
65,02C3,"instance full_functor (e : C ‚âå E) : e.functor.Full :=
  e.fullyFaithfulFunctor.full
",Formal Proof of Stacks Project Tag 02C3,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Equivalence.lean#L559-L560,Q27041,,4.2.19,lemma,3.0,"['0013', '0011', '0ELQ']","\n  Lemma 4.2.19. A functor is an equivalence of categories if and only if it is both fully faithful and essentially surjective. \n\n    \n      Proof.\n      Let $F : \\mathcal{A} \\to \\mathcal{B}$ be essentially surjective and fully faithful. As by convention all categories are small and as $F$ is essentially surjective we can, using the axiom of choice, choose for every $X \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{B})$ an object $j(X)$ of $\\mathcal{A}$ and an isomorphism $i_ X : X \\to F(j(X))$. Then we apply Lemma 4.2.18 using that $F$ is fully faithful. \n      $\\square$\n    \n",\n  Lemma 4.2.19. A functor is an equivalence of categories if and only if it is both fully faithful and essentially surjective. \n\n    \n,"Proof.\n      Let $F : \\mathcal{A} \\to \\mathcal{B}$ be essentially surjective and fully faithful. As by convention all categories are small and as $F$ is essentially surjective we can, using the axiom of choice, choose for every $X \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{B})$ an object $j(X)$ of $\\mathcal{A}$ and an isomorphism $i_ X : X \\to F(j(X))$. Then we apply Lemma 4.2.18 using that $F$ is fully faithful. \n      $\\square$\n    \n","
  e.fullyFaithfulFunctor.full
",instance full_functor (e : C ‚âå E) : e.functor.Full ,"Proof.\n      Let $F : \\mathcal{A} \\to \\mathcal{B}$ be essentially surjective and fully faithful. As by convention all categories are small and as $F$ is essentially surjective we can, using the axiom of choice, choose for every $X \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{B})$ an object $j(X)$ of $\\mathcal{A}$ and an isomorphism $i_ X : X \\to F(j(X))$. Then we apply Lemma 4.2.18 [[\n  Lemma 4.2.18. Let $F : \\mathcal{A} \\to \\mathcal{B}$ be a fully faithful functor. Suppose for every $X \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{B})$ we are given an object $j(X)$ of $\\mathcal{A}$ and an isomorphism $i_ X : X \\to F(j(X))$. Then there is a unique functor $j : \\mathcal{B} \\to \\mathcal{A}$ such that $j$ extends the rule on objects, and the isomorphisms $i_ X$ define an isomorphism of functors $\\text{id}_\\mathcal {B} \\to F \\circ j$. Moreover, $j$ and $F$ are quasi-inverse equivalences of categories. \n\n    \n]] using that $F$ is fully faithful. \n      $\\square$\n    \n","Proof.\n      Let $F : \\mathcal{A} \\to \\mathcal{B}$ be essentially surjective and fully faithful. As by convention all categories are small and as $F$ is essentially surjective we can, using the axiom of choice, choose for every $X \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{B})$ an object $j(X)$ of $\\mathcal{A}$ and an isomorphism $i_ X : X \\to F(j(X))$. Then we apply Lemma 4.2.18 [[\n  Lemma 4.2.18. Let $F : \\mathcal{A} \\to \\mathcal{B}$ be a fully faithful functor. Suppose for every $X \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{B})$ we are given an object $j(X)$ of $\\mathcal{A}$ and an isomorphism $i_ X : X \\to F(j(X))$. Then there is a unique functor $j : \\mathcal{B} \\to \\mathcal{A}$ such that $j$ extends the rule on objects, and the isomorphisms $i_ X$ define an isomorphism of functors $\\text{id}_\\mathcal {B} \\to F \\circ j$. Moreover, $j$ and $F$ are quasi-inverse equivalences of categories. \n\n    \n]] using that $F$ is fully faithful. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the informal proof argues that an essentially surjective and fully faithful functor is an equivalence by choosing object-level preimages via choice and then applying a lemma constructing a quasi-inverse functor and natural isomorphism (id_B ‚âÖ F ‚àò j), yielding an equivalence. The Lean term `e.fullyFaithfulFunctor.full` appears to be a library lemma/definition that directly produces the desired result from a fully faithful functor packaged inside an equivalence `e`, but it does not explicitly reflect the essential-surjectivity + choice + construction of a quasi-inverse described informally. Structurally, the informal proof is constructive (choose j(X), build j, show quasi-inverse), while the formal proof is a one-line invocation with no visible correspondence to those steps. Thus the end conclusion likely matches, but the proof structure and explicit assumptions (essential surjectivity, choice) are not mirrored in the given Lean snippet.""}"
72,001P,"def coyonedaLemma : coyonedaPairing C ‚âÖ coyonedaEvaluation C :=
  NatIso.ofComponents
    (fun _ ‚Ü¶ Equiv.toIso (coyonedaEquiv.trans Equiv.ulift.symm))
    (by intro (X, F) (Y, G) f
        ext (a : coyoneda.obj (op X) ‚ü∂ F)
        apply ULift.ext
        dsimp [coyonedaEquiv, coyonedaEvaluation]
        simp [‚Üê FunctorToTypes.naturality])
",Formal Proof of Stacks Project Tag 001P,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Yoneda.lean#L935-L942,Q27041,Yoneda lemma,4.3.5,lemma,3.0,"['001L', '0011', '0ELQ']","\n        \n      \n  Lemma 4.3.5 (Yoneda lemma). Let $U, V \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. Given any morphism of functors $s : h_ U \\to h_ V$ there is a unique morphism $\\phi : U \\to V$ such that $h(\\phi ) = s$. In other words the functor $h$ is fully faithful. More generally, given any contravariant functor $F$ and any object $U$ of $\\mathcal{C}$ we have a natural bijection \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ U, F) \\longrightarrow F(U), \\quad s \\longmapsto s_ U(\\text{id}_ U).  \\]\n\n\n    \n      Proof.\n      For the first statement, just take $\\phi = s_ U(\\text{id}_ U) \\in \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(U, V)$. For the second statement, given $\\xi \\in F(U)$ define $s$ by $s_ V : h_ U(V) \\to F(V)$ by sending the element $f : V \\to U$ of $h_ U(V) = \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(V, U)$ to $F(f)(\\xi )$. \n      $\\square$\n    \n","\n        \n      \n  Lemma 4.3.5 (Yoneda lemma). Let $U, V \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. Given any morphism of functors $s : h_ U \\to h_ V$ there is a unique morphism $\\phi : U \\to V$ such that $h(\\phi ) = s$. In other words the functor $h$ is fully faithful. More generally, given any contravariant functor $F$ and any object $U$ of $\\mathcal{C}$ we have a natural bijection \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ U, F) \\longrightarrow F(U), \\quad s \\longmapsto s_ U(\\text{id}_ U).  \\]\n\n\n    \n","Proof.\n      For the first statement, just take $\\phi = s_ U(\\text{id}_ U) \\in \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(U, V)$. For the second statement, given $\\xi \\in F(U)$ define $s$ by $s_ V : h_ U(V) \\to F(V)$ by sending the element $f : V \\to U$ of $h_ U(V) = \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(V, U)$ to $F(f)(\\xi )$. \n      $\\square$\n    \n","
  NatIso.ofComponents
    (fun _ ‚Ü¶ Equiv.toIso (coyonedaEquiv.trans Equiv.ulift.symm))
    (by intro (X, F) (Y, G) f
        ext (a : coyoneda.obj (op X) ‚ü∂ F)
        apply ULift.ext
        dsimp [coyonedaEquiv, coyonedaEvaluation]
        simp [‚Üê FunctorToTypes.naturality])
",def coyonedaLemma : coyonedaPairing C ‚âÖ coyonedaEvaluation C ,"Proof.\n      For the first statement, just take $\\phi = s_ U(\\text{id}_ U) \\in \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(U, V)$. For the second statement, given $\\xi \\in F(U)$ define $s$ by $s_ V : h_ U(V) \\to F(V)$ by sending the element $f : V \\to U$ of $h_ U(V) = \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(V, U)$ to $F(f)(\\xi )$. \n      $\\square$\n    \n","Proof.\n      For the first statement, just take $\\phi = s_ U(\\text{id}_ U) \\in \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(U, V)$. For the second statement, given $\\xi \\in F(U)$ define $s$ by $s_ V : h_ U(V) \\to F(V)$ by sending the element $f : V \\to U$ of $h_ U(V) = \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(V, U)$ to $F(f)(\\xi )$. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the formal proof constructs a natural isomorphism using `NatIso.ofComponents` with components given by `Equiv.toIso (coyonedaEquiv.trans Equiv.ulift.symm)`, i.e. it is proving a (co)Yoneda-style natural isomorphism between functors (with a ULift adjustment) and then checks naturality by extensionality and simp. The informal proof, however, argues about the Yoneda correspondence in elementwise terms: (1) extracting a morphism by evaluating a natural transformation at `id_U`, and (2) constructing a natural transformation from an element `Œæ ‚àà F(U)` via `f ‚Ü¶ F(f)(Œæ)`. While both are in the general Yoneda family, the informal proof explicitly describes the two directions of the bijection and their definitions, whereas the formal proof relies on an existing equivalence `coyonedaEquiv` and does not mirror the two-step elementwise construction. Structurally, the formal proof is a componentwise natural isomorphism proof with a naturality check, not the explicit two-part argument given informally. Thus there is partial thematic overlap (Yoneda/coyoneda equivalence) but weak correspondence to the specific informal steps.""}"
76,0107,"def coimageImageComparison : Abelian.coimage f ‚ü∂ Abelian.image f :=
  cokernel.desc (kernel.Œπ f) (kernel.lift (cokernel.œÄ f) f (by simp)) (by ext; simp)
",Formal Proof of Stacks Project Tag 0107,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Abelian/Images.lean#L102-L103,Q27041,,12.3.12,lemma,3.0,"['09SE', '00ZU', '0ELQ']","\n  Lemma 12.3.12. Let $f : x \\to y$ be a morphism in a preadditive category such that the kernel, cokernel, image and coimage all exist. Then $f$ can be factored uniquely as $x \\to \\mathop{\\mathrm{Coim}}(f) \\to \\mathop{\\mathrm{Im}}(f) \\to y$. \n\n    \n      Proof.\n      There is a canonical morphism $\\mathop{\\mathrm{Coim}}(f) \\to y$ because $\\mathop{\\mathrm{Ker}}(f) \\to x \\to y$ is zero. The composition $\\mathop{\\mathrm{Coim}}(f) \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ is zero, because it is the unique morphism which gives rise to the morphism $x \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ which is zero (the uniqueness follows from Lemma 12.3.11 (3)). Hence $\\mathop{\\mathrm{Coim}}(f) \\to y$ factors uniquely through $\\mathop{\\mathrm{Im}}(f) \\to y$, which gives us the desired map. \n      $\\square$\n    \n","\n  Lemma 12.3.12. Let $f : x \\to y$ be a morphism in a preadditive category such that the kernel, cokernel, image and coimage all exist. Then $f$ can be factored uniquely as $x \\to \\mathop{\\mathrm{Coim}}(f) \\to \\mathop{\\mathrm{Im}}(f) \\to y$. \n\n    \n","Proof.\n      There is a canonical morphism $\\mathop{\\mathrm{Coim}}(f) \\to y$ because $\\mathop{\\mathrm{Ker}}(f) \\to x \\to y$ is zero. The composition $\\mathop{\\mathrm{Coim}}(f) \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ is zero, because it is the unique morphism which gives rise to the morphism $x \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ which is zero (the uniqueness follows from Lemma 12.3.11 (3)). Hence $\\mathop{\\mathrm{Coim}}(f) \\to y$ factors uniquely through $\\mathop{\\mathrm{Im}}(f) \\to y$, which gives us the desired map. \n      $\\square$\n    \n","
  cokernel.desc (kernel.Œπ f) (kernel.lift (cokernel.œÄ f) f (by simp)) (by ext; simp)
",def coimageImageComparison : Abelian.coimage f ‚ü∂ Abelian.image f ,"Proof.\n      There is a canonical morphism $\\mathop{\\mathrm{Coim}}(f) \\to y$ because $\\mathop{\\mathrm{Ker}}(f) \\to x \\to y$ is zero. The composition $\\mathop{\\mathrm{Coim}}(f) \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ is zero, because it is the unique morphism which gives rise to the morphism $x \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ which is zero (the uniqueness follows from Lemma 12.3.11 [[\n  Lemma 12.3.11. Let $\\mathcal{C}$ be a preadditive category. Let $f : x \\to y$ be a morphism in $\\mathcal{C}$. \n  \n  \nIf a kernel of $f$ exists, then this kernel is a monomorphism. \n\n\nIf a cokernel of $f$ exists, then this cokernel is an epimorphism. \n\n\nIf a kernel and coimage of $f$ exist, then the coimage is an epimorphism. \n\n\nIf a cokernel and image of $f$ exist, then the image is a monomorphism. \n\n\n\n\n    \n]] (3)). Hence $\\mathop{\\mathrm{Coim}}(f) \\to y$ factors uniquely through $\\mathop{\\mathrm{Im}}(f) \\to y$, which gives us the desired map. \n      $\\square$\n    \n","Proof.\n      There is a canonical morphism $\\mathop{\\mathrm{Coim}}(f) \\to y$ because $\\mathop{\\mathrm{Ker}}(f) \\to x \\to y$ is zero. The composition $\\mathop{\\mathrm{Coim}}(f) \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ is zero, because it is the unique morphism which gives rise to the morphism $x \\to y \\to \\mathop{\\mathrm{Coker}}(f)$ which is zero (the uniqueness follows from Lemma 12.3.11 [[\n  Lemma 12.3.11. Let $\\mathcal{C}$ be a preadditive category. Let $f : x \\to y$ be a morphism in $\\mathcal{C}$. \n  \n  \nIf a kernel of $f$ exists, then this kernel is a monomorphism. \n\n\nIf a cokernel of $f$ exists, then this cokernel is an epimorphism. \n\n\nIf a kernel and coimage of $f$ exist, then the coimage is an epimorphism. \n\n\nIf a cokernel and image of $f$ exist, then the image is a monomorphism. \n\n\n\n\n    \n]] (3)). Hence $\\mathop{\\mathrm{Coim}}(f) \\to y$ factors uniquely through $\\mathop{\\mathrm{Im}}(f) \\to y$, which gives us the desired map. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean term constructs a morphism out of a cokernel using `cokernel.desc` applied to `kernel.Œπ f`, with the candidate map given by `kernel.lift (cokernel.œÄ f) f (by simp)`, and then proves the required commutativity by extensionality (`by ext; simp`). This matches the general theme of the informal proof: using the universal properties of kernel/cokernel and the fact that certain composites are zero to obtain a canonical induced morphism and a uniqueness statement.\n\nHowever, structurally the informal proof is about producing a map Coim(f) ‚Üí Im(f) by first getting Coim(f) ‚Üí y, showing its composite to Coker(f) is zero, and then factoring uniquely through Im(f) ‚Üí y (using that the relevant map is mono/epi for uniqueness). The Lean proof instead directly builds a morphism from `cokernel (kernel.Œπ f)` (i.e. a coimage-like object) to `kernel (cokernel.œÄ f)` (i.e. an image-like object) via a cokernel universal property, without explicitly mirroring the intermediate step ‚ÄúCoim ‚Üí y ‚Üí Coker is zero‚Äù or invoking the mono/epi lemma for uniqueness. So it captures the same induced-factorization idea but compresses/repackages the argument in a different universal-property route, omitting the explicit factor-through-Im narrative.""}"
77,03A3,"def abelianOfAdjunction {C : Type u‚ÇÅ} [Category.{v‚ÇÅ} C] [Preadditive C] [HasFiniteProducts C]
    {D : Type u‚ÇÇ} [Category.{v‚ÇÇ} D] [Abelian D] (F : C ‚•§ D)
    (G : D ‚•§ C) [Functor.PreservesZeroMorphisms G] [PreservesFiniteLimits G] (i : F ‚ãô G ‚âÖ ùü≠ C)
    (adj : G ‚ä£ F) : Abelian C := by
  haveI := hasKernels F G i
  haveI := hasCokernels F G i adj
  have : ‚àÄ {X Y : C} (f : X ‚ü∂ Y), IsIso (Abelian.coimageImageComparison f) := by
    intro X Y f
    let arrowIso : Arrow.mk (G.map (F.map f)) ‚âÖ Arrow.mk f :=
      ((Functor.mapArrowFunctor _ _).mapIso i).app (Arrow.mk f)
    have : PreservesColimits G := adj.leftAdjoint_preservesColimits
    let iso : Arrow.mk (G.map (Abelian.coimageImageComparison (F.map f))) ‚âÖ
        Arrow.mk (Abelian.coimageImageComparison f) :=
      Abelian.PreservesCoimageImageComparison.iso G (F.map f) ‚â™‚â´
        Abelian.coimageImageComparisonFunctor.mapIso arrowIso
    rw [Arrow.isIso_iff_isIso_of_isIso iso.inv]
    infer_instance
  apply Abelian.ofCoimageImageComparisonIsIso
",Formal Proof of Stacks Project Tag 03A3,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Abelian/Transfer.lean#L86-L103,Q27041,,12.7.4,lemma,3.0,"['010M', '00ZU', '0ELQ']","\n  Lemma 12.7.4. Let $a : \\mathcal{A} \\to \\mathcal{B}$ and $b : \\mathcal{B} \\to \\mathcal{A}$ be functors. Assume that \n  \n  \n$\\mathcal{A}$, $\\mathcal{B}$ are additive categories, $a$, $b$ are additive functors, and $a$ is right adjoint to $b$, \n\n\n$\\mathcal{B}$ is abelian and $b$ is left exact, and \n\n\n$ba \\cong \\text{id}_\\mathcal {A}$. \n\n\n\n   Then $\\mathcal{A}$ is abelian. \n\n    \n      Proof.\n      As $\\mathcal{B}$ is abelian we see that all finite limits and colimits exist in $\\mathcal{B}$ by Lemma 12.5.5. Since $b$ is a left adjoint we see that $b$ is also right exact and hence exact, see Categories, Lemma 4.24.6. Let $\\varphi : B_1 \\to B_2$ be a morphism of $\\mathcal{B}$. In particular, if $K = \\mathop{\\mathrm{Ker}}(B_1 \\to B_2)$, then $K$ is the equalizer of $0$ and $\\varphi $ and hence $bK$ is the equalizer of $0$ and $b\\varphi $, hence $bK$ is the kernel of $b\\varphi $. Similarly, if $Q = \\mathop{\\mathrm{Coker}}(B_1 \\to B_2)$, then $Q$ is the coequalizer of $0$ and $\\varphi $ and hence $bQ$ is the coequalizer of $0$ and $b\\varphi $, hence $bQ$ is the cokernel of $b\\varphi $. Thus we see that every morphism of the form $b\\varphi $ in $\\mathcal{A}$ has a kernel and a cokernel. However, since $ba \\cong \\text{id}$ we see that every morphism of $\\mathcal{A}$ is of this form, and we conclude that kernels and cokernels exist in $\\mathcal{A}$. In fact, the argument shows that if $\\psi : A_1 \\to A_2$ is a morphism then \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(\\psi ) = b\\mathop{\\mathrm{Ker}}(a\\psi ), \\quad \\text{and}\\quad \\mathop{\\mathrm{Coker}}(\\psi ) = b\\mathop{\\mathrm{Coker}}(a\\psi ).  \\]\n\n    \n       Now we still have to show that $\\mathop{\\mathrm{Coim}}(\\psi )= \\mathop{\\mathrm{Im}}(\\psi )$. We do this as follows. First note that since $\\mathcal{A}$ has kernels and cokernels it has all finite limits and colimits (see proof of Lemma 12.5.5). Hence we see by Categories, Lemma 4.24.6 that $a$ is left exact and hence transforms kernels (=equalizers) into kernels. \n    \n      \n  \\begin{align*}  \\mathop{\\mathrm{Coim}}(\\psi ) &  = \\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Coker}}(a(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1)) &  \\text{by formula above} \\\\ &  = b\\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(a\\psi ) \\to aA_1)) &  a\\text{ preserves kernels} \\\\ &  = b\\mathop{\\mathrm{Coim}}(a\\psi ) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Im}}(a\\psi ) &  \\mathcal{B}\\text{ is abelian} \\\\ &  = b\\mathop{\\mathrm{Ker}}(aA_2 \\to \\mathop{\\mathrm{Coker}}(a\\psi )) &  \\text{by definition} \\\\ &  = \\mathop{\\mathrm{Ker}}(baA_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  b\\text{ preserves kernels} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  ba = \\text{id}_\\mathcal {A} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to \\mathop{\\mathrm{Coker}}(\\psi )) &  \\text{by formula above} \\\\ &  = \\mathop{\\mathrm{Im}}(\\psi ) &  \\text{by definition} \\end{align*}\n\n    \n       Thus the lemma holds. \n      $\\square$\n    \n","\n  Lemma 12.7.4. Let $a : \\mathcal{A} \\to \\mathcal{B}$ and $b : \\mathcal{B} \\to \\mathcal{A}$ be functors. Assume that \n  \n  \n$\\mathcal{A}$, $\\mathcal{B}$ are additive categories, $a$, $b$ are additive functors, and $a$ is right adjoint to $b$, \n\n\n$\\mathcal{B}$ is abelian and $b$ is left exact, and \n\n\n$ba \\cong \\text{id}_\\mathcal {A}$. \n\n\n\n   Then $\\mathcal{A}$ is abelian. \n\n    \n","Proof.\n      As $\\mathcal{B}$ is abelian we see that all finite limits and colimits exist in $\\mathcal{B}$ by Lemma 12.5.5. Since $b$ is a left adjoint we see that $b$ is also right exact and hence exact, see Categories, Lemma 4.24.6. Let $\\varphi : B_1 \\to B_2$ be a morphism of $\\mathcal{B}$. In particular, if $K = \\mathop{\\mathrm{Ker}}(B_1 \\to B_2)$, then $K$ is the equalizer of $0$ and $\\varphi $ and hence $bK$ is the equalizer of $0$ and $b\\varphi $, hence $bK$ is the kernel of $b\\varphi $. Similarly, if $Q = \\mathop{\\mathrm{Coker}}(B_1 \\to B_2)$, then $Q$ is the coequalizer of $0$ and $\\varphi $ and hence $bQ$ is the coequalizer of $0$ and $b\\varphi $, hence $bQ$ is the cokernel of $b\\varphi $. Thus we see that every morphism of the form $b\\varphi $ in $\\mathcal{A}$ has a kernel and a cokernel. However, since $ba \\cong \\text{id}$ we see that every morphism of $\\mathcal{A}$ is of this form, and we conclude that kernels and cokernels exist in $\\mathcal{A}$. In fact, the argument shows that if $\\psi : A_1 \\to A_2$ is a morphism then \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(\\psi ) = b\\mathop{\\mathrm{Ker}}(a\\psi ), \\quad \\text{and}\\quad \\mathop{\\mathrm{Coker}}(\\psi ) = b\\mathop{\\mathrm{Coker}}(a\\psi ).  \\]\n\n    \n       Now we still have to show that $\\mathop{\\mathrm{Coim}}(\\psi )= \\mathop{\\mathrm{Im}}(\\psi )$. We do this as follows. First note that since $\\mathcal{A}$ has kernels and cokernels it has all finite limits and colimits (see proof of Lemma 12.5.5). Hence we see by Categories, Lemma 4.24.6 that $a$ is left exact and hence transforms kernels (=equalizers) into kernels. \n    \n      \n  \\begin{align*}  \\mathop{\\mathrm{Coim}}(\\psi ) &  = \\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Coker}}(a(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1)) &  \\text{by formula above} \\\\ &  = b\\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(a\\psi ) \\to aA_1)) &  a\\text{ preserves kernels} \\\\ &  = b\\mathop{\\mathrm{Coim}}(a\\psi ) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Im}}(a\\psi ) &  \\mathcal{B}\\text{ is abelian} \\\\ &  = b\\mathop{\\mathrm{Ker}}(aA_2 \\to \\mathop{\\mathrm{Coker}}(a\\psi )) &  \\text{by definition} \\\\ &  = \\mathop{\\mathrm{Ker}}(baA_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  b\\text{ preserves kernels} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  ba = \\text{id}_\\mathcal {A} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to \\mathop{\\mathrm{Coker}}(\\psi )) &  \\text{by formula above} \\\\ &  = \\mathop{\\mathrm{Im}}(\\psi ) &  \\text{by definition} \\end{align*}\n\n    \n       Thus the lemma holds. \n      $\\square$\n    \n"," by
  haveI := hasKernels F G i
  haveI := hasCokernels F G i adj
  have : ‚àÄ {X Y : C} (f : X ‚ü∂ Y), IsIso (Abelian.coimageImageComparison f) := by
    intro X Y f
    let arrowIso : Arrow.mk (G.map (F.map f)) ‚âÖ Arrow.mk f :=
      ((Functor.mapArrowFunctor _ _).mapIso i).app (Arrow.mk f)
    have : PreservesColimits G := adj.leftAdjoint_preservesColimits
    let iso : Arrow.mk (G.map (Abelian.coimageImageComparison (F.map f))) ‚âÖ
        Arrow.mk (Abelian.coimageImageComparison f) :=
      Abelian.PreservesCoimageImageComparison.iso G (F.map f) ‚â™‚â´
        Abelian.coimageImageComparisonFunctor.mapIso arrowIso
    rw [Arrow.isIso_iff_isIso_of_isIso iso.inv]
    infer_instance
  apply Abelian.ofCoimageImageComparisonIsIso
","def abelianOfAdjunction {C : Type u‚ÇÅ} [Category.{v‚ÇÅ} C] [Preadditive C] [HasFiniteProducts C]
    {D : Type u‚ÇÇ} [Category.{v‚ÇÇ} D] [Abelian D] (F : C ‚•§ D)
    (G : D ‚•§ C) [Functor.PreservesZeroMorphisms G] [PreservesFiniteLimits G] (i : F ‚ãô G ‚âÖ ùü≠ C)
    (adj : G ‚ä£ F) : Abelian C ","Proof.\n      As $\\mathcal{B}$ is abelian we see that all finite limits and colimits exist in $\\mathcal{B}$ by Lemma 12.5.5 [[\n  Lemma 12.5.5. Let $\\mathcal{A}$ be an abelian category. All finite limits and finite colimits exist in $\\mathcal{A}$. \n\n    \n]]. Since $b$ is a left adjoint we see that $b$ is also right exact and hence exact, see Categories, Lemma 4.24.6 [[\n  Lemma 4.24.6. Let $u$ be a left adjoint of $v$ as in Definition 4.24.1. \n  \n  \nIf $\\mathcal{C}$ has finite colimits, then $u$ is right exact. \n\n\nIf $\\mathcal{D}$ has finite limits, then $v$ is left exact. \n\n\n\n\n    \n]]. Let $\\varphi : B_1 \\to B_2$ be a morphism of $\\mathcal{B}$. In particular, if $K = \\mathop{\\mathrm{Ker}}(B_1 \\to B_2)$, then $K$ is the equalizer of $0$ and $\\varphi $ and hence $bK$ is the equalizer of $0$ and $b\\varphi $, hence $bK$ is the kernel of $b\\varphi $. Similarly, if $Q = \\mathop{\\mathrm{Coker}}(B_1 \\to B_2)$, then $Q$ is the coequalizer of $0$ and $\\varphi $ and hence $bQ$ is the coequalizer of $0$ and $b\\varphi $, hence $bQ$ is the cokernel of $b\\varphi $. Thus we see that every morphism of the form $b\\varphi $ in $\\mathcal{A}$ has a kernel and a cokernel. However, since $ba \\cong \\text{id}$ we see that every morphism of $\\mathcal{A}$ is of this form, and we conclude that kernels and cokernels exist in $\\mathcal{A}$. In fact, the argument shows that if $\\psi : A_1 \\to A_2$ is a morphism then \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(\\psi ) = b\\mathop{\\mathrm{Ker}}(a\\psi ), \\quad \\text{and}\\quad \\mathop{\\mathrm{Coker}}(\\psi ) = b\\mathop{\\mathrm{Coker}}(a\\psi ).  \\]\n\n    \n       Now we still have to show that $\\mathop{\\mathrm{Coim}}(\\psi )= \\mathop{\\mathrm{Im}}(\\psi )$. We do this as follows. First note that since $\\mathcal{A}$ has kernels and cokernels it has all finite limits and colimits (see proof of Lemma 12.5.5 [[\n  Lemma 12.5.5. Let $\\mathcal{A}$ be an abelian category. All finite limits and finite colimits exist in $\\mathcal{A}$. \n\n    \n]]). Hence we see by Categories, Lemma 4.24.6 [[\n  Lemma 4.24.6. Let $u$ be a left adjoint of $v$ as in Definition 4.24.1. \n  \n  \nIf $\\mathcal{C}$ has finite colimits, then $u$ is right exact. \n\n\nIf $\\mathcal{D}$ has finite limits, then $v$ is left exact. \n\n\n\n\n    \n]] that $a$ is left exact and hence transforms kernels (=equalizers) into kernels. \n    \n      \n  \\begin{align*}  \\mathop{\\mathrm{Coim}}(\\psi ) &  = \\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Coker}}(a(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1)) &  \\text{by formula above} \\\\ &  = b\\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(a\\psi ) \\to aA_1)) &  a\\text{ preserves kernels} \\\\ &  = b\\mathop{\\mathrm{Coim}}(a\\psi ) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Im}}(a\\psi ) &  \\mathcal{B}\\text{ is abelian} \\\\ &  = b\\mathop{\\mathrm{Ker}}(aA_2 \\to \\mathop{\\mathrm{Coker}}(a\\psi )) &  \\text{by definition} \\\\ &  = \\mathop{\\mathrm{Ker}}(baA_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  b\\text{ preserves kernels} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  ba = \\text{id}_\\mathcal {A} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to \\mathop{\\mathrm{Coker}}(\\psi )) &  \\text{by formula above} \\\\ &  = \\mathop{\\mathrm{Im}}(\\psi ) &  \\text{by definition} \\end{align*}\n\n    \n       Thus the lemma holds. \n      $\\square$\n    \n","Proof.\n      As $\\mathcal{B}$ is abelian we see that all finite limits and colimits exist in $\\mathcal{B}$ by Lemma 12.5.5 [[\n  Lemma 12.5.5. Let $\\mathcal{A}$ be an abelian category. All finite limits and finite colimits exist in $\\mathcal{A}$. \n\n    \n]]. Since $b$ is a left adjoint we see that $b$ is also right exact and hence exact, see Categories, Lemma 4.24.6 [[\n  Lemma 4.24.6. Let $u$ be a left adjoint of $v$ as in Definition 4.24.1. \n  \n  \nIf $\\mathcal{C}$ has finite colimits, then $u$ is right exact. \n\n\nIf $\\mathcal{D}$ has finite limits, then $v$ is left exact. \n\n\n\n\n    \n]]. Let $\\varphi : B_1 \\to B_2$ be a morphism of $\\mathcal{B}$. In particular, if $K = \\mathop{\\mathrm{Ker}}(B_1 \\to B_2)$, then $K$ is the equalizer of $0$ and $\\varphi $ and hence $bK$ is the equalizer of $0$ and $b\\varphi $, hence $bK$ is the kernel of $b\\varphi $. Similarly, if $Q = \\mathop{\\mathrm{Coker}}(B_1 \\to B_2)$, then $Q$ is the coequalizer of $0$ and $\\varphi $ and hence $bQ$ is the coequalizer of $0$ and $b\\varphi $, hence $bQ$ is the cokernel of $b\\varphi $. Thus we see that every morphism of the form $b\\varphi $ in $\\mathcal{A}$ has a kernel and a cokernel. However, since $ba \\cong \\text{id}$ we see that every morphism of $\\mathcal{A}$ is of this form, and we conclude that kernels and cokernels exist in $\\mathcal{A}$. In fact, the argument shows that if $\\psi : A_1 \\to A_2$ is a morphism then \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(\\psi ) = b\\mathop{\\mathrm{Ker}}(a\\psi ), \\quad \\text{and}\\quad \\mathop{\\mathrm{Coker}}(\\psi ) = b\\mathop{\\mathrm{Coker}}(a\\psi ).  \\]\n\n    \n       Now we still have to show that $\\mathop{\\mathrm{Coim}}(\\psi )= \\mathop{\\mathrm{Im}}(\\psi )$. We do this as follows. First note that since $\\mathcal{A}$ has kernels and cokernels it has all finite limits and colimits (see proof of Lemma 12.5.5 [[\n  Lemma 12.5.5. Let $\\mathcal{A}$ be an abelian category. All finite limits and finite colimits exist in $\\mathcal{A}$. \n\n    \n]]). Hence we see by Categories, Lemma 4.24.6 [[\n  Lemma 4.24.6. Let $u$ be a left adjoint of $v$ as in Definition 4.24.1. \n  \n  \nIf $\\mathcal{C}$ has finite colimits, then $u$ is right exact. \n\n\nIf $\\mathcal{D}$ has finite limits, then $v$ is left exact. \n\n\n\n\n    \n]] that $a$ is left exact and hence transforms kernels (=equalizers) into kernels. \n    \n      \n  \\begin{align*}  \\mathop{\\mathrm{Coim}}(\\psi ) &  = \\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Coker}}(a(\\mathop{\\mathrm{Ker}}(\\psi ) \\to A_1)) &  \\text{by formula above} \\\\ &  = b\\mathop{\\mathrm{Coker}}(\\mathop{\\mathrm{Ker}}(a\\psi ) \\to aA_1)) &  a\\text{ preserves kernels} \\\\ &  = b\\mathop{\\mathrm{Coim}}(a\\psi ) &  \\text{by definition} \\\\ &  = b\\mathop{\\mathrm{Im}}(a\\psi ) &  \\mathcal{B}\\text{ is abelian} \\\\ &  = b\\mathop{\\mathrm{Ker}}(aA_2 \\to \\mathop{\\mathrm{Coker}}(a\\psi )) &  \\text{by definition} \\\\ &  = \\mathop{\\mathrm{Ker}}(baA_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  b\\text{ preserves kernels} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to b\\mathop{\\mathrm{Coker}}(a\\psi )) &  ba = \\text{id}_\\mathcal {A} \\\\ &  = \\mathop{\\mathrm{Ker}}(A_2 \\to \\mathop{\\mathrm{Coker}}(\\psi )) &  \\text{by formula above} \\\\ &  = \\mathop{\\mathrm{Im}}(\\psi ) &  \\text{by definition} \\end{align*}\n\n    \n       Thus the lemma holds. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to show the target category is abelian by establishing existence of kernels/cokernels and then proving coimage‚Äìimage comparison is an isomorphism. The Lean proof sets up instances `hasKernels` and `hasCokernels` using the adjunction and then proves `IsIso (Abelian.coimageImageComparison f)` for all morphisms `f`, concluding via `Abelian.ofCoimageImageComparisonIsIso`. Structurally, however, the informal proof gives a detailed argument: kernels/cokernels are transported along a left adjoint using equalizer/coequalizer characterizations and the fact that every morphism is of the form `b œÜ` because `ba ‚âÖ id`, then it explicitly computes Coim = Im via preservation of kernels/cokernels and abelianness of B. The Lean proof does not mirror this explicit Coim=Im calculation; instead it uses a categorical lemma about preservation of the coimage‚Äìimage comparison under a colimit-preserving functor (`adj.leftAdjoint_preservesColimits`) and an Arrow-iso induced by the unit/counit isomorphism, which is a different route than the informal equalizer/coequalizer computation. Thus the high-level goal matches, but the internal structure and key intermediate steps differ substantially.""}"
80,079H,"instance enoughInjectives : EnoughInjectives C where
  presentation X := ‚ü®{ J := _, f := (monoMapFactorizationDataRlp (0 : X ‚ü∂ 0)).i }‚ü©
",Formal Proof of Stacks Project Tag 079H,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Abelian/GrothendieckCategory/EnoughInjectives.lean#L372-L373,Q27041,,19.11.7,theorem,3.0,"['05AB', '01D4', '0ELQ']","\n  Theorem 19.11.7. Let $\\mathcal{A}$ be a Grothendieck abelian category. Then $\\mathcal{A}$ has functorial injective embeddings. \n\n    \n      Proof.\n      Please compare with the proof of Theorem 19.2.8. Choose a generator $U$ of $\\mathcal{A}$. For an object $M$ we define $\\mathbf{M}(M)$ by the following pushout diagram \n    \n      \n  \\[  \\xymatrix{ \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} N \\ar[r] \\ar[d] &  M \\ar[d] \\\\  \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} U \\ar[r] &  \\mathbf{M}(M). }  \\]\n\n    \n       Note that $M \\mapsto \\mathbf{M}(M)$ is a functor and that there exist functorial injective maps $M \\to \\mathbf{M}(M)$. By transfinite induction we define functors $\\mathbf{M}_\\alpha (M)$ for every ordinal $\\alpha $. Namely, set $\\mathbf{M}_0(M) = M$. Given $\\mathbf{M}_\\alpha (M)$ set $\\mathbf{M}_{\\alpha + 1}(M) = \\mathbf{M}(\\mathbf{M}_\\alpha (M))$. For a limit ordinal $\\beta $ set \n    \n      \n  \\[  \\mathbf{M}_\\beta (M) = \\mathop{\\mathrm{colim}}\\nolimits _{\\alpha < \\beta } \\mathbf{M}_\\alpha (M).  \\]\n\n    \n       Finally, pick any ordinal $\\alpha $ whose cofinality is greater than $|U|$. Such an ordinal exists by Sets, Proposition 3.7.2. We claim that $M \\to \\mathbf{M}_\\alpha (M)$ is the desired functorial injective embedding. Namely, if $N \\subset U$ is a subobject and $\\varphi : N \\to \\mathbf{M}_\\alpha (M)$ is a morphism, then we see that $\\varphi $ factors through $\\mathbf{M}_{\\alpha \'}(M)$ for some $\\alpha \' < \\alpha $ by Proposition 19.11.5. By construction of $\\mathbf{M}(-)$ we see that $\\varphi $ extends to a morphism from $U$ into $\\mathbf{M}_{\\alpha \' + 1}(M)$ and hence into $\\mathbf{M}_\\alpha (M)$. By Lemma 19.11.6 we conclude that $\\mathbf{M}_\\alpha (M)$ is injective. \n      $\\square$\n    \n",\n  Theorem 19.11.7. Let $\\mathcal{A}$ be a Grothendieck abelian category. Then $\\mathcal{A}$ has functorial injective embeddings. \n\n    \n,"Proof.\n      Please compare with the proof of Theorem 19.2.8. Choose a generator $U$ of $\\mathcal{A}$. For an object $M$ we define $\\mathbf{M}(M)$ by the following pushout diagram \n    \n      \n  \\[  \\xymatrix{ \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} N \\ar[r] \\ar[d] &  M \\ar[d] \\\\  \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} U \\ar[r] &  \\mathbf{M}(M). }  \\]\n\n    \n       Note that $M \\mapsto \\mathbf{M}(M)$ is a functor and that there exist functorial injective maps $M \\to \\mathbf{M}(M)$. By transfinite induction we define functors $\\mathbf{M}_\\alpha (M)$ for every ordinal $\\alpha $. Namely, set $\\mathbf{M}_0(M) = M$. Given $\\mathbf{M}_\\alpha (M)$ set $\\mathbf{M}_{\\alpha + 1}(M) = \\mathbf{M}(\\mathbf{M}_\\alpha (M))$. For a limit ordinal $\\beta $ set \n    \n      \n  \\[  \\mathbf{M}_\\beta (M) = \\mathop{\\mathrm{colim}}\\nolimits _{\\alpha < \\beta } \\mathbf{M}_\\alpha (M).  \\]\n\n    \n       Finally, pick any ordinal $\\alpha $ whose cofinality is greater than $|U|$. Such an ordinal exists by Sets, Proposition 3.7.2. We claim that $M \\to \\mathbf{M}_\\alpha (M)$ is the desired functorial injective embedding. Namely, if $N \\subset U$ is a subobject and $\\varphi : N \\to \\mathbf{M}_\\alpha (M)$ is a morphism, then we see that $\\varphi $ factors through $\\mathbf{M}_{\\alpha \'}(M)$ for some $\\alpha \' < \\alpha $ by Proposition 19.11.5. By construction of $\\mathbf{M}(-)$ we see that $\\varphi $ extends to a morphism from $U$ into $\\mathbf{M}_{\\alpha \' + 1}(M)$ and hence into $\\mathbf{M}_\\alpha (M)$. By Lemma 19.11.6 we conclude that $\\mathbf{M}_\\alpha (M)$ is injective. \n      $\\square$\n    \n"," ‚ü®{ J := _, f := (monoMapFactorizationDataRlp (0 : X ‚ü∂ 0)).i }‚ü©
","instance enoughInjectives : EnoughInjectives C where
  presentation X ","Proof.\n      Please compare with the proof of Theorem 19.2.8 [[\n  Theorem 19.2.8. Let $\\kappa $ be the cardinality of the set of ideals in $R$, and let $\\alpha $ be an ordinal whose cofinality is greater than $\\kappa $. Then $\\mathbf{M}_\\alpha (N)$ is an injective $R$-module, and $N \\to \\mathbf{M}_\\alpha (N)$ is a functorial injective embedding. \n\n    \n]]. Choose a generator $U$ of $\\mathcal{A}$. For an object $M$ we define $\\mathbf{M}(M)$ by the following pushout diagram \n    \n      \n  \\[  \\xymatrix{ \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} N \\ar[r] \\ar[d] &  M \\ar[d] \\\\  \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} U \\ar[r] &  \\mathbf{M}(M). }  \\]\n\n    \n       Note that $M \\mapsto \\mathbf{M}(M)$ is a functor and that there exist functorial injective maps $M \\to \\mathbf{M}(M)$. By transfinite induction we define functors $\\mathbf{M}_\\alpha (M)$ for every ordinal $\\alpha $. Namely, set $\\mathbf{M}_0(M) = M$. Given $\\mathbf{M}_\\alpha (M)$ set $\\mathbf{M}_{\\alpha + 1}(M) = \\mathbf{M}(\\mathbf{M}_\\alpha (M))$. For a limit ordinal $\\beta $ set \n    \n      \n  \\[  \\mathbf{M}_\\beta (M) = \\mathop{\\mathrm{colim}}\\nolimits _{\\alpha < \\beta } \\mathbf{M}_\\alpha (M).  \\]\n\n    \n       Finally, pick any ordinal $\\alpha $ whose cofinality is greater than $|U|$. Such an ordinal exists by Sets, Proposition 3.7.2 [[\n  Proposition 3.7.2. Let $\\kappa $ be a cardinal. Then there exists an ordinal whose cofinality is bigger than $\\kappa $. \n\n    \n]]. We claim that $M \\to \\mathbf{M}_\\alpha (M)$ is the desired functorial injective embedding. Namely, if $N \\subset U$ is a subobject and $\\varphi : N \\to \\mathbf{M}_\\alpha (M)$ is a morphism, then we see that $\\varphi $ factors through $\\mathbf{M}_{\\alpha \'}(M)$ for some $\\alpha \' < \\alpha $ by Proposition 19.11.5 [[\n  Proposition 19.11.5. Let $\\mathcal{A}$ be a Grothendieck abelian category. Let $M$ be an object of $\\mathcal{A}$. Let $\\kappa = |M|$. If $\\alpha $ is an ordinal whose cofinality is bigger than $\\kappa $, then $M$ is $\\alpha $-small with respect to injections. \n\n    \n]]. By construction of $\\mathbf{M}(-)$ we see that $\\varphi $ extends to a morphism from $U$ into $\\mathbf{M}_{\\alpha \' + 1}(M)$ and hence into $\\mathbf{M}_\\alpha (M)$. By Lemma 19.11.6 [[\n       \n      \n  Lemma 19.11.6. Let $\\mathcal{A}$ be a Grothendieck abelian category with generator $U$. An object $I$ of $\\mathcal{A}$ is injective if and only if in every commutative diagram \n  \n  \\[  \\xymatrix{ M \\ar[d] \\ar[r] &  I \\\\  U \\ar@{-->}[ru] }  \\]\n\n   for $M \\subset U$ a subobject, the dotted arrow exists. \n\n    \n]] we conclude that $\\mathbf{M}_\\alpha (M)$ is injective. \n      $\\square$\n    \n","Proof.\n      Please compare with the proof of Theorem 19.2.8 [[\n  Theorem 19.2.8. Let $\\kappa $ be the cardinality of the set of ideals in $R$, and let $\\alpha $ be an ordinal whose cofinality is greater than $\\kappa $. Then $\\mathbf{M}_\\alpha (N)$ is an injective $R$-module, and $N \\to \\mathbf{M}_\\alpha (N)$ is a functorial injective embedding. \n\n    \n]]. Choose a generator $U$ of $\\mathcal{A}$. For an object $M$ we define $\\mathbf{M}(M)$ by the following pushout diagram \n    \n      \n  \\[  \\xymatrix{ \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} N \\ar[r] \\ar[d] &  M \\ar[d] \\\\  \\bigoplus _{N \\subset U} \\bigoplus _{\\varphi \\in \\mathop{\\mathrm{Hom}}\\nolimits (N, M)} U \\ar[r] &  \\mathbf{M}(M). }  \\]\n\n    \n       Note that $M \\mapsto \\mathbf{M}(M)$ is a functor and that there exist functorial injective maps $M \\to \\mathbf{M}(M)$. By transfinite induction we define functors $\\mathbf{M}_\\alpha (M)$ for every ordinal $\\alpha $. Namely, set $\\mathbf{M}_0(M) = M$. Given $\\mathbf{M}_\\alpha (M)$ set $\\mathbf{M}_{\\alpha + 1}(M) = \\mathbf{M}(\\mathbf{M}_\\alpha (M))$. For a limit ordinal $\\beta $ set \n    \n      \n  \\[  \\mathbf{M}_\\beta (M) = \\mathop{\\mathrm{colim}}\\nolimits _{\\alpha < \\beta } \\mathbf{M}_\\alpha (M).  \\]\n\n    \n       Finally, pick any ordinal $\\alpha $ whose cofinality is greater than $|U|$. Such an ordinal exists by Sets, Proposition 3.7.2 [[\n  Proposition 3.7.2. Let $\\kappa $ be a cardinal. Then there exists an ordinal whose cofinality is bigger than $\\kappa $. \n\n    \n]]. We claim that $M \\to \\mathbf{M}_\\alpha (M)$ is the desired functorial injective embedding. Namely, if $N \\subset U$ is a subobject and $\\varphi : N \\to \\mathbf{M}_\\alpha (M)$ is a morphism, then we see that $\\varphi $ factors through $\\mathbf{M}_{\\alpha \'}(M)$ for some $\\alpha \' < \\alpha $ by Proposition 19.11.5 [[\n  Proposition 19.11.5. Let $\\mathcal{A}$ be a Grothendieck abelian category. Let $M$ be an object of $\\mathcal{A}$. Let $\\kappa = |M|$. If $\\alpha $ is an ordinal whose cofinality is bigger than $\\kappa $, then $M$ is $\\alpha $-small with respect to injections. \n\n    \n]]. By construction of $\\mathbf{M}(-)$ we see that $\\varphi $ extends to a morphism from $U$ into $\\mathbf{M}_{\\alpha \' + 1}(M)$ and hence into $\\mathbf{M}_\\alpha (M)$. By Lemma 19.11.6 [[\n       \n      \n  Lemma 19.11.6. Let $\\mathcal{A}$ be a Grothendieck abelian category with generator $U$. An object $I$ of $\\mathcal{A}$ is injective if and only if in every commutative diagram \n  \n  \\[  \\xymatrix{ M \\ar[d] \\ar[r] &  I \\\\  U \\ar@{-->}[ru] }  \\]\n\n   for $M \\subset U$ a subobject, the dotted arrow exists. \n\n    \n]] we conclude that $\\mathbf{M}_\\alpha (M)$ is injective. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof constructs a functorial injective embedding M ‚Üí M_Œ±(M) via a transfinite iteration of a pushout construction using a generator U, then proves injectivity of M_Œ±(M) using smallness/cofinality and an extension property (Lemma 19.11.6). The Lean term instead is a one-line construction of a factorization datum using `monoMapFactorizationDataRlp (0 : X ‚ü∂ 0)` and extracts its map `i`, which appears to be about factoring the zero morphism X ‚Üí 0 through some object J with a mono, not about transfinite colimits, pushouts, generators, or injective objects. Structurally, the informal proof is a multi-step transfinite induction plus a diagram-chasing injectivity criterion, while the formal proof has no corresponding steps and no mention of the key constructions/lemmas. Thus the formal proof does not reflect the content or structure of the informal argument.""}"
82,0038,"lemma rightAdjoint_preservesLimits : PreservesLimitsOfSize.{v, u} G where
  preservesLimitsOfShape :=
    { preservesLimit :=
        { preserves := fun hc =>
            ‚ü®IsLimit.isoUniqueConeMorphism.inv fun _ =>
              @Equiv.unique _ _ (IsLimit.isoUniqueConeMorphism.hom hc _)
                ((adj.functorialityAdjunction' _).homEquiv _ _).symm‚ü© } }
",Formal Proof of Stacks Project Tag 0038,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Adjunction/Limits.lean#L198-L204,Q27041,,4.24.5,lemma,3.0,"['0036', '0011', '0ELQ']","\n  Lemma 4.24.5. Let $u$ be a left adjoint to $v$ as in Definition 4.24.1. \n  \n  \nSuppose that $M : \\mathcal{I} \\to \\mathcal{C}$ is a diagram, and suppose that $\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M$ exists in $\\mathcal{C}$. Then $u(\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M) = \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} u \\circ M$. In other words, $u$ commutes with (representable) colimits. \n\n\nSuppose that $M : \\mathcal{I} \\to \\mathcal{D}$ is a diagram, and suppose that $\\mathop{\\mathrm{lim}}\\nolimits _\\mathcal {I} M$ exists in $\\mathcal{D}$. Then $v(\\mathop{\\mathrm{lim}}\\nolimits _\\mathcal {I} M) = \\mathop{\\mathrm{lim}}\\nolimits _\\mathcal {I} v \\circ M$. In other words $v$ commutes with representable limits. \n\n\n\n\n    \n      Proof.\n      A morphism from a colimit into an object is the same as a compatible system of morphisms from the constituents of the limit into the object, see Remark 4.14.4. So \n    \n      \n  \\[  \\begin{matrix}  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i), Y) \n\n&  = \n\n&  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(M_ i), Y) \n\n\\end{matrix}  \\]\n\n    \n       proves that $u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i)$ is the colimit we are looking for. A similar argument works for the other statement. \n      $\\square$\n    \n","\n  Lemma 4.24.5. Let $u$ be a left adjoint to $v$ as in Definition 4.24.1. \n  \n  \nSuppose that $M : \\mathcal{I} \\to \\mathcal{C}$ is a diagram, and suppose that $\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M$ exists in $\\mathcal{C}$. Then $u(\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M) = \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} u \\circ M$. In other words, $u$ commutes with (representable) colimits. \n\n\nSuppose that $M : \\mathcal{I} \\to \\mathcal{D}$ is a diagram, and suppose that $\\mathop{\\mathrm{lim}}\\nolimits _\\mathcal {I} M$ exists in $\\mathcal{D}$. Then $v(\\mathop{\\mathrm{lim}}\\nolimits _\\mathcal {I} M) = \\mathop{\\mathrm{lim}}\\nolimits _\\mathcal {I} v \\circ M$. In other words $v$ commutes with representable limits. \n\n\n\n\n    \n","Proof.\n      A morphism from a colimit into an object is the same as a compatible system of morphisms from the constituents of the limit into the object, see Remark 4.14.4. So \n    \n      \n  \\[  \\begin{matrix}  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i), Y) \n\n&  = \n\n&  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(M_ i), Y) \n\n\\end{matrix}  \\]\n\n    \n       proves that $u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i)$ is the colimit we are looking for. A similar argument works for the other statement. \n      $\\square$\n    \n","
    { preservesLimit :=
        { preserves := fun hc =>
            ‚ü®IsLimit.isoUniqueConeMorphism.inv fun _ =>
              @Equiv.unique _ _ (IsLimit.isoUniqueConeMorphism.hom hc _)
                ((adj.functorialityAdjunction' _).homEquiv _ _).symm‚ü© } }
","lemma rightAdjoint_preservesLimits : PreservesLimitsOfSize.{v, u} G where
  preservesLimitsOfShape ","Proof.\n      A morphism from a colimit into an object is the same as a compatible system of morphisms from the constituents of the limit into the object, see Remark 4.14.4 [[\n  Remark 4.14.4. We often write $\\mathop{\\mathrm{lim}}\\nolimits _ i M_ i$, $\\mathop{\\mathrm{colim}}\\nolimits _ i M_ i$, $\\mathop{\\mathrm{lim}}\\nolimits _{i\\in \\mathcal{I}} M_ i$, or $\\mathop{\\mathrm{colim}}\\nolimits _{i\\in \\mathcal{I}} M_ i$ instead of the versions indexed by $\\mathcal{I}$. Using this notation, and using the description of limits and colimits of sets in Section 4.15 below, we can say the following. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. \n  \n  \nThe object $\\mathop{\\mathrm{lim}}\\nolimits _ i M_ i$ if it exists satisfies the following property \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(W, \\mathop{\\mathrm{lim}}\\nolimits _ i M_ i) = \\mathop{\\mathrm{lim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(W, M_ i)  \\]\n\n\n where the limit on the right takes place in the category of sets. \n\n\nThe object $\\mathop{\\mathrm{colim}}\\nolimits _ i M_ i$ if it exists satisfies the following property \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(\\mathop{\\mathrm{colim}}\\nolimits _ i M_ i, W) = \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(M_ i, W)  \\]\n\n\n where on the right we have the limit over the opposite category with value in the category of sets. \n\n\n\n   By the Yoneda lemma (and its dual) this formula completely determines the limit, respectively the colimit. \n]]. So \n    \n      \n  \\[  \\begin{matrix}  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i), Y) \n\n&  = \n\n&  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(M_ i), Y) \n\n\\end{matrix}  \\]\n\n    \n       proves that $u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i)$ is the colimit we are looking for. A similar argument works for the other statement. \n      $\\square$\n    \n","Proof.\n      A morphism from a colimit into an object is the same as a compatible system of morphisms from the constituents of the limit into the object, see Remark 4.14.4 [[\n  Remark 4.14.4. We often write $\\mathop{\\mathrm{lim}}\\nolimits _ i M_ i$, $\\mathop{\\mathrm{colim}}\\nolimits _ i M_ i$, $\\mathop{\\mathrm{lim}}\\nolimits _{i\\in \\mathcal{I}} M_ i$, or $\\mathop{\\mathrm{colim}}\\nolimits _{i\\in \\mathcal{I}} M_ i$ instead of the versions indexed by $\\mathcal{I}$. Using this notation, and using the description of limits and colimits of sets in Section 4.15 below, we can say the following. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. \n  \n  \nThe object $\\mathop{\\mathrm{lim}}\\nolimits _ i M_ i$ if it exists satisfies the following property \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(W, \\mathop{\\mathrm{lim}}\\nolimits _ i M_ i) = \\mathop{\\mathrm{lim}}\\nolimits _ i \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(W, M_ i)  \\]\n\n\n where the limit on the right takes place in the category of sets. \n\n\nThe object $\\mathop{\\mathrm{colim}}\\nolimits _ i M_ i$ if it exists satisfies the following property \n\n\n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(\\mathop{\\mathrm{colim}}\\nolimits _ i M_ i, W) = \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(M_ i, W)  \\]\n\n\n where on the right we have the limit over the opposite category with value in the category of sets. \n\n\n\n   By the Yoneda lemma (and its dual) this formula completely determines the limit, respectively the colimit. \n]]. So \n    \n      \n  \\[  \\begin{matrix}  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i), Y) \n\n&  = \n\n&  \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {C}(M_ i, v(Y)) \n\n\\\\ &  = \n\n&  \\mathop{\\mathrm{lim}}\\nolimits _{i \\in \\mathcal{I}^{opp}} \\mathop{\\mathrm{Mor}}\\nolimits _\\mathcal {D}(u(M_ i), Y) \n\n\\end{matrix}  \\]\n\n    \n       proves that $u(\\mathop{\\mathrm{colim}}\\nolimits _{i \\in \\mathcal{I}} M_ i)$ is the colimit we are looking for. A similar argument works for the other statement. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that a left adjoint functor u preserves colimits by identifying morphisms out of a colimit with compatible families (a limit of Hom-sets) and then transporting this along the adjunction Hom(u(-),Y) ‚âÖ Hom(-,v(Y)). The formal proof, however, is phrased in terms of `preservesLimit` and constructs a `preserves` witness using `IsLimit.isoUniqueConeMorphism.inv` and uniqueness via an `Equiv.unique` coming from `homEquiv` of an adjunction. This matches the general adjunction-based strategy (using the hom-set equivalence to transfer a universal property), but it is structurally and directionally different from the informal argument: it does not explicitly use the Hom/limit-of-Hom characterization of (co)limits, and it appears to be about preserving limits rather than colimits. Thus there is partial thematic alignment (adjunction transfers universal properties) but weak correspondence to the specific Hom/colimit computation and statement in the informal proof.""}"
91,0BN4,"theorem exists_lift_of_continuous (X : Action FintypeCat (Aut F))
    [TopologicalSpace X.V] [DiscreteTopology X.V] [ContinuousSMul (Aut F) X.V] :
    ‚àÉ A, Nonempty ((functorToAction F).obj A ‚âÖ X) := by
  obtain ‚ü®Œπ, hfin, f, ‚ü®u‚ü©‚ü© := has_decomp_quotients X
  choose g gu using (fun i ‚Ü¶ exists_lift_of_quotient_openSubgroup (f i))
  exact ‚ü®‚àê g, ‚ü®PreservesCoproduct.iso (functorToAction F) g ‚â™‚â´
    Sigma.mapIso (fun i ‚Ü¶ (gu i).some) ‚â™‚â´ u‚ü©‚ü©
",Formal Proof of Stacks Project Tag 0BN4,Essential surjectivity part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Galois/EssSurj.lean#L264-L270,Q27041,,58.3.10,proposition,3.0,"['0BMQ', '0BQ6', '0ELV']","\n       \n      \n  Proposition 58.3.10. Let $(\\mathcal{C}, F)$ be a Galois category. Let $G = \\text{Aut}(F)$ be as in Example 58.3.5. The functor $F : \\mathcal{C} \\to \\textit{Finite-}G\\textit{-Sets}$ (58.3.5.1) an equivalence. \n\n    \n      Proof.\n      We will use the results of Lemma 58.3.7 without further mention. In particular we know the functor is faithful. By Lemma 58.3.9 we know that for any connected $X$ the action of $G$ on $F(X)$ is transitive. Hence for general $X$ the functor $F$ sends the connected components of $X$ (which exist by an axiom of a Galois category) to the $G$-orbits of $F(X)$. Let $X$ and $Y$ be objects and let $s : F(X) \\to F(Y)$ be a map. Then the graph $\\Gamma _ s \\subset F(X) \\times F(Y)$ of $s$ is a union of connected components. Hence there exists a union of connected components $Z$ of $X \\times Y$, which comes equipped with a monomorphism $Z \\to X \\times Y$, with $F(Z) = \\Gamma _ s$. Since $F(Z) \\to F(X)$ is bijective we see that $Z \\to X$ is an isomorphism and we conclude that $s = F(f)$ where $f : X \\cong Z \\to Y$ is the composition. Hence $F$ is fully faithful. \n    \n      To finish the proof we show that $F$ is essentially surjective. It suffices to show that $G/H$ is in the essential image for any open subgroup $H \\subset G$ of finite index. By definition of the topology on $G$ there exists a finite collection of objects $X_ i$ such that \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(G \\longrightarrow \\prod \\nolimits _ i \\text{Aut}(F(X_ i)))  \\]\n\n    \n       is contained in $H$. We may assume $X_ i$ is connected for all $i$. We can choose a Galois object $Y$ mapping to a connected component of $\\prod X_ i$ using Lemma 58.3.8. Choose an isomorphism $F(Y) = G/U$ in $G\\textit{-sets}$ for some open subgroup $U \\subset G$. As $Y$ is Galois, the group $\\text{Aut}(Y) = \\text{Aut}_{G\\textit{-Sets}}(G/U)$ acts transitively on $F(Y) = G/U$. This implies that $U$ is normal. Since $F(Y)$ surjects onto $F(X_ i)$ for each $i$ we see that $U \\subset H$. Let $M \\subset \\text{Aut}(Y)$ be the finite subgroup corresponding to \n    \n      \n  \\[  (H/U)^{opp} \\subset (G/U)^{opp} = \\text{Aut}_{G\\textit{-Sets}}(G/U) = \\text{Aut}(Y).  \\]\n\n    \n       Set $X = Y/M$, i.e., $X$ is the coequalizer of the arrows $m : Y \\to Y$, $m \\in M$. Since $F$ is exact we see that $F(X) = G/H$ and the proof is complete. \n      $\\square$\n    \n","\n       \n      \n  Proposition 58.3.10. Let $(\\mathcal{C}, F)$ be a Galois category. Let $G = \\text{Aut}(F)$ be as in Example 58.3.5. The functor $F : \\mathcal{C} \\to \\textit{Finite-}G\\textit{-Sets}$ (58.3.5.1) an equivalence. \n\n    \n","Proof.\n      We will use the results of Lemma 58.3.7 without further mention. In particular we know the functor is faithful. By Lemma 58.3.9 we know that for any connected $X$ the action of $G$ on $F(X)$ is transitive. Hence for general $X$ the functor $F$ sends the connected components of $X$ (which exist by an axiom of a Galois category) to the $G$-orbits of $F(X)$. Let $X$ and $Y$ be objects and let $s : F(X) \\to F(Y)$ be a map. Then the graph $\\Gamma _ s \\subset F(X) \\times F(Y)$ of $s$ is a union of connected components. Hence there exists a union of connected components $Z$ of $X \\times Y$, which comes equipped with a monomorphism $Z \\to X \\times Y$, with $F(Z) = \\Gamma _ s$. Since $F(Z) \\to F(X)$ is bijective we see that $Z \\to X$ is an isomorphism and we conclude that $s = F(f)$ where $f : X \\cong Z \\to Y$ is the composition. Hence $F$ is fully faithful. \n    \n      To finish the proof we show that $F$ is essentially surjective. It suffices to show that $G/H$ is in the essential image for any open subgroup $H \\subset G$ of finite index. By definition of the topology on $G$ there exists a finite collection of objects $X_ i$ such that \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(G \\longrightarrow \\prod \\nolimits _ i \\text{Aut}(F(X_ i)))  \\]\n\n    \n       is contained in $H$. We may assume $X_ i$ is connected for all $i$. We can choose a Galois object $Y$ mapping to a connected component of $\\prod X_ i$ using Lemma 58.3.8. Choose an isomorphism $F(Y) = G/U$ in $G\\textit{-sets}$ for some open subgroup $U \\subset G$. As $Y$ is Galois, the group $\\text{Aut}(Y) = \\text{Aut}_{G\\textit{-Sets}}(G/U)$ acts transitively on $F(Y) = G/U$. This implies that $U$ is normal. Since $F(Y)$ surjects onto $F(X_ i)$ for each $i$ we see that $U \\subset H$. Let $M \\subset \\text{Aut}(Y)$ be the finite subgroup corresponding to \n    \n      \n  \\[  (H/U)^{opp} \\subset (G/U)^{opp} = \\text{Aut}_{G\\textit{-Sets}}(G/U) = \\text{Aut}(Y).  \\]\n\n    \n       Set $X = Y/M$, i.e., $X$ is the coequalizer of the arrows $m : Y \\to Y$, $m \\in M$. Since $F$ is exact we see that $F(X) = G/H$ and the proof is complete. \n      $\\square$\n    \n"," by
  obtain ‚ü®Œπ, hfin, f, ‚ü®u‚ü©‚ü© := has_decomp_quotients X
  choose g gu using (fun i ‚Ü¶ exists_lift_of_quotient_openSubgroup (f i))
  exact ‚ü®‚àê g, ‚ü®PreservesCoproduct.iso (functorToAction F) g ‚â™‚â´
    Sigma.mapIso (fun i ‚Ü¶ (gu i).some) ‚â™‚â´ u‚ü©‚ü©
","theorem exists_lift_of_continuous (X : Action FintypeCat (Aut F))
    [TopologicalSpace X.V] [DiscreteTopology X.V] [ContinuousSMul (Aut F) X.V] :
    ‚àÉ A, Nonempty ((functorToAction F).obj A ‚âÖ X) ","Proof.\n      We will use the results of Lemma 58.3.7 [[\n  Lemma 58.3.7. Let $(\\mathcal{C}, F)$ be a Galois category. Let $X \\to Y \\in \\text{Arrows}(\\mathcal{C})$. Then \n  \n  \n$F$ is faithful, \n\n\n$X \\to Y$ is a monomorphism $\\Leftrightarrow F(X) \\to F(Y)$ is injective, \n\n\n$X \\to Y$ is an epimorphism $\\Leftrightarrow F(X) \\to F(Y)$ is surjective, \n\n\nan object $A$ of $\\mathcal{C}$ is initial if and only if $F(A) = \\emptyset $, \n\n\nan object $Z$ of $\\mathcal{C}$ is final if and only if $F(Z)$ is a singleton, \n\n\nif $X$ and $Y$ are connected, then $X \\to Y$ is an epimorphism, \n\n\n if $X$ is connected and $a, b : X \\to Y$ are two morphisms then $a = b$ as soon as $F(a)$ and $F(b)$ agree on one element of $F(X)$, \n\n\nif $X = \\coprod _{i = 1, \\ldots , n} X_ i$ and $Y = \\coprod _{j = 1, \\ldots , m} Y_ j$ where $X_ i$, $Y_ j$ are connected, then there is map $\\alpha : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , m\\} $ such that $X \\to Y$ comes from a collection of morphisms $X_ i \\to Y_{\\alpha (i)}$. \n\n\n\n\n    \n]] without further mention. In particular we know the functor is faithful. By Lemma 58.3.9 [[\n       \n      \n  Lemma 58.3.9. Let $(\\mathcal{C}, F)$ be a Galois category. Let $G = \\text{Aut}(F)$ be as in Example 58.3.5. For any connected $X$ in $\\mathcal{C}$ the action of $G$ on $F(X)$ is transitive. \n\n    \n]] we know that for any connected $X$ the action of $G$ on $F(X)$ is transitive. Hence for general $X$ the functor $F$ sends the connected components of $X$ (which exist by an axiom of a Galois category) to the $G$-orbits of $F(X)$. Let $X$ and $Y$ be objects and let $s : F(X) \\to F(Y)$ be a map. Then the graph $\\Gamma _ s \\subset F(X) \\times F(Y)$ of $s$ is a union of connected components. Hence there exists a union of connected components $Z$ of $X \\times Y$, which comes equipped with a monomorphism $Z \\to X \\times Y$, with $F(Z) = \\Gamma _ s$. Since $F(Z) \\to F(X)$ is bijective we see that $Z \\to X$ is an isomorphism and we conclude that $s = F(f)$ where $f : X \\cong Z \\to Y$ is the composition. Hence $F$ is fully faithful. \n    \n      To finish the proof we show that $F$ is essentially surjective. It suffices to show that $G/H$ is in the essential image for any open subgroup $H \\subset G$ of finite index. By definition of the topology on $G$ there exists a finite collection of objects $X_ i$ such that \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(G \\longrightarrow \\prod \\nolimits _ i \\text{Aut}(F(X_ i)))  \\]\n\n    \n       is contained in $H$. We may assume $X_ i$ is connected for all $i$. We can choose a Galois object $Y$ mapping to a connected component of $\\prod X_ i$ using Lemma 58.3.8 [[\n  Lemma 58.3.8. Let $(\\mathcal{C}, F)$ be a Galois category. For any connected object $X$ of $\\mathcal{C}$ there exists a Galois object $Y$ and a morphism $Y \\to X$. \n\n    \n]]. Choose an isomorphism $F(Y) = G/U$ in $G\\textit{-sets}$ for some open subgroup $U \\subset G$. As $Y$ is Galois, the group $\\text{Aut}(Y) = \\text{Aut}_{G\\textit{-Sets}}(G/U)$ acts transitively on $F(Y) = G/U$. This implies that $U$ is normal. Since $F(Y)$ surjects onto $F(X_ i)$ for each $i$ we see that $U \\subset H$. Let $M \\subset \\text{Aut}(Y)$ be the finite subgroup corresponding to \n    \n      \n  \\[  (H/U)^{opp} \\subset (G/U)^{opp} = \\text{Aut}_{G\\textit{-Sets}}(G/U) = \\text{Aut}(Y).  \\]\n\n    \n       Set $X = Y/M$, i.e., $X$ is the coequalizer of the arrows $m : Y \\to Y$, $m \\in M$. Since $F$ is exact we see that $F(X) = G/H$ and the proof is complete. \n      $\\square$\n    \n","Proof.\n      We will use the results of Lemma 58.3.7 [[\n  Lemma 58.3.7. Let $(\\mathcal{C}, F)$ be a Galois category. Let $X \\to Y \\in \\text{Arrows}(\\mathcal{C})$. Then \n  \n  \n$F$ is faithful, \n\n\n$X \\to Y$ is a monomorphism $\\Leftrightarrow F(X) \\to F(Y)$ is injective, \n\n\n$X \\to Y$ is an epimorphism $\\Leftrightarrow F(X) \\to F(Y)$ is surjective, \n\n\nan object $A$ of $\\mathcal{C}$ is initial if and only if $F(A) = \\emptyset $, \n\n\nan object $Z$ of $\\mathcal{C}$ is final if and only if $F(Z)$ is a singleton, \n\n\nif $X$ and $Y$ are connected, then $X \\to Y$ is an epimorphism, \n\n\n if $X$ is connected and $a, b : X \\to Y$ are two morphisms then $a = b$ as soon as $F(a)$ and $F(b)$ agree on one element of $F(X)$, \n\n\nif $X = \\coprod _{i = 1, \\ldots , n} X_ i$ and $Y = \\coprod _{j = 1, \\ldots , m} Y_ j$ where $X_ i$, $Y_ j$ are connected, then there is map $\\alpha : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , m\\} $ such that $X \\to Y$ comes from a collection of morphisms $X_ i \\to Y_{\\alpha (i)}$. \n\n\n\n\n    \n]] without further mention. In particular we know the functor is faithful. By Lemma 58.3.9 [[\n       \n      \n  Lemma 58.3.9. Let $(\\mathcal{C}, F)$ be a Galois category. Let $G = \\text{Aut}(F)$ be as in Example 58.3.5. For any connected $X$ in $\\mathcal{C}$ the action of $G$ on $F(X)$ is transitive. \n\n    \n]] we know that for any connected $X$ the action of $G$ on $F(X)$ is transitive. Hence for general $X$ the functor $F$ sends the connected components of $X$ (which exist by an axiom of a Galois category) to the $G$-orbits of $F(X)$. Let $X$ and $Y$ be objects and let $s : F(X) \\to F(Y)$ be a map. Then the graph $\\Gamma _ s \\subset F(X) \\times F(Y)$ of $s$ is a union of connected components. Hence there exists a union of connected components $Z$ of $X \\times Y$, which comes equipped with a monomorphism $Z \\to X \\times Y$, with $F(Z) = \\Gamma _ s$. Since $F(Z) \\to F(X)$ is bijective we see that $Z \\to X$ is an isomorphism and we conclude that $s = F(f)$ where $f : X \\cong Z \\to Y$ is the composition. Hence $F$ is fully faithful. \n    \n      To finish the proof we show that $F$ is essentially surjective. It suffices to show that $G/H$ is in the essential image for any open subgroup $H \\subset G$ of finite index. By definition of the topology on $G$ there exists a finite collection of objects $X_ i$ such that \n    \n      \n  \\[  \\mathop{\\mathrm{Ker}}(G \\longrightarrow \\prod \\nolimits _ i \\text{Aut}(F(X_ i)))  \\]\n\n    \n       is contained in $H$. We may assume $X_ i$ is connected for all $i$. We can choose a Galois object $Y$ mapping to a connected component of $\\prod X_ i$ using Lemma 58.3.8 [[\n  Lemma 58.3.8. Let $(\\mathcal{C}, F)$ be a Galois category. For any connected object $X$ of $\\mathcal{C}$ there exists a Galois object $Y$ and a morphism $Y \\to X$. \n\n    \n]]. Choose an isomorphism $F(Y) = G/U$ in $G\\textit{-sets}$ for some open subgroup $U \\subset G$. As $Y$ is Galois, the group $\\text{Aut}(Y) = \\text{Aut}_{G\\textit{-Sets}}(G/U)$ acts transitively on $F(Y) = G/U$. This implies that $U$ is normal. Since $F(Y)$ surjects onto $F(X_ i)$ for each $i$ we see that $U \\subset H$. Let $M \\subset \\text{Aut}(Y)$ be the finite subgroup corresponding to \n    \n      \n  \\[  (H/U)^{opp} \\subset (G/U)^{opp} = \\text{Aut}_{G\\textit{-Sets}}(G/U) = \\text{Aut}(Y).  \\]\n\n    \n       Set $X = Y/M$, i.e., $X$ is the coequalizer of the arrows $m : Y \\to Y$, $m \\in M$. Since $F$ is exact we see that $F(X) = G/H$ and the proof is complete. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Essential surjectivity part","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is aimed at the essential surjectivity step: it starts from a decomposition of a target G-set/quotient into finitely many quotient pieces (via `has_decomp_quotients X`), then for each quotient it uses an existence-of-lift lemma (`exists_lift_of_quotient_openSubgroup`) to realize it in the essential image, and finally reassembles the object using a coproduct together with isomorphisms (`PreservesCoproduct.iso`, `Sigma.mapIso`) to conclude the whole object is in the essential image. This matches the informal proof‚Äôs goal of showing every finite-index open-subgroup quotient G/H lies in the essential image, though the informal argument constructs a specific object Y/M using Galois objects, normal subgroups, and exactness/coequalizers.\n\nStructurally, however, the approaches differ: the informal proof proceeds by choosing connected objects, a Galois object Y mapping to a product, identifying F(Y) ‚âÖ G/U with U normal, then forming a quotient by a finite subgroup M to get Y/M with F(Y/M)=G/H. The Lean proof instead uses an abstract ‚Äúdecomposition into quotients + lift each quotient + take coproduct‚Äù pattern, without reflecting the intermediate steps (Galois object, normality, coequalizer construction, exactness). Thus it captures the high-level essential-surjectivity conclusion but not the specific construction and lemmas used in the informal proof.""}"
95,002N,"theorem has_limits_of_hasEqualizers_and_products [HasProducts.{w} C] [HasEqualizers C] :
    HasLimitsOfSize.{w, w} C :=
  { has_limits_of_shape :=
    fun _ _ => { has_limit := fun F => hasLimit_of_equalizer_and_product F } }
",Formal Proof of Stacks Project Tag 002N,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Limits/Constructions/LimitsOfProductsAndEqualizers.lean#L129-L132,Q27041,,4.14.11,lemma,3.0,"['002D', '0011', '0ELQ']","\n  Lemma 4.14.11. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. Write $I = \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and $A = \\text{Arrows}(\\mathcal{I})$. Denote $s, t : A \\to I$ the source and target maps. Suppose that $\\prod _{i \\in I} M_ i$ and $\\prod _{a \\in A} M_{t(a)}$ exist. Suppose that the equalizer of \n  \n  \\[  \\xymatrix{ \\prod _{i \\in I} M_ i \\ar@<1ex>[r]^\\phi \\ar@<-1ex>[r]_\\psi &  \\prod _{a \\in A} M_{t(a)} }  \\]\n\n   exists, where the morphisms are determined by their components as follows: $p_ a \\circ \\psi = M(a) \\circ p_{s(a)}$ and $p_ a \\circ \\phi = p_{t(a)}$. Then this equalizer is the limit of the diagram. \n\n    \n      Proof.\n      Omitted. \n      $\\square$\n    \n","\n  Lemma 4.14.11. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. Write $I = \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and $A = \\text{Arrows}(\\mathcal{I})$. Denote $s, t : A \\to I$ the source and target maps. Suppose that $\\prod _{i \\in I} M_ i$ and $\\prod _{a \\in A} M_{t(a)}$ exist. Suppose that the equalizer of \n  \n  \\[  \\xymatrix{ \\prod _{i \\in I} M_ i \\ar@<1ex>[r]^\\phi \\ar@<-1ex>[r]_\\psi &  \\prod _{a \\in A} M_{t(a)} }  \\]\n\n   exists, where the morphisms are determined by their components as follows: $p_ a \\circ \\psi = M(a) \\circ p_{s(a)}$ and $p_ a \\circ \\phi = p_{t(a)}$. Then this equalizer is the limit of the diagram. \n\n    \n",Proof.\n      Omitted. \n      $\\square$\n    \n,"
  { has_limits_of_shape :=
    fun _ _ => { has_limit := fun F => hasLimit_of_equalizer_and_product F } }
","theorem has_limits_of_hasEqualizers_and_products [HasProducts.{w} C] [HasEqualizers C] :
    HasLimitsOfSize.{w, w} C ",Proof.\n      Omitted. \n      $\\square$\n    \n,Proof.\n      Omitted. \n      $\\square$\n    \n,"{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the formal proof establishes the existence of limits of a given shape by providing, for any functor F, a construction of a limit via `hasLimit_of_equalizer_and_product`. This is consistent with an informal proof being omitted, since an omitted proof could plausibly rely on the standard argument that limits can be built from products and equalizers. Structurally, however, the informal proof contains no steps (it is entirely omitted), so there is no explicit structure to match; the Lean code is a concrete implementation rather than a reflection of any presented argument. Completeness and precision cannot be verified against the informal text because it provides no content, but the formal proof is at least a coherent proof term for the claimed existence statement.""}"
96,002O,"theorem hasFiniteLimits_of_hasEqualizers_and_finite_products [HasFiniteProducts C]
    [HasEqualizers C] : HasFiniteLimits C where
  out _ := { has_limit := fun F => hasLimit_of_equalizer_and_product F }
",Formal Proof of Stacks Project Tag 002O,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Limits/Constructions/LimitsOfProductsAndEqualizers.lean#L136-L138,Q27041,,4.18.4,lemma,3.0,"['04AS', '0011', '0ELQ']","\n  Lemma 4.18.4. Let $\\mathcal{C}$ be a category. The following are equivalent: \n  \n  \nFinite limits exist in $\\mathcal{C}$. \n\n\nFinite products and equalizers exist. \n\n\nThe category has a final object and fibre products exist. \n\n\n\n\n    \n      Proof.\n      Since finite products, fibre products, equalizers, and final objects are limits over finite index categories we see that (1) implies both (2) and (3). By Lemma 4.14.11 above we see that (2) implies (1). Assume (3). Note that the product $A \\times B$ is the fibre product over the final object. If $a, b : A \\to B$ are morphisms of $\\mathcal{C}$, then the equalizer of $a, b$ is \n    \n      \n  \\[  (A \\times _{a, B, b} A)\\times _{(\\text{pr}_1, \\text{pr}_2), A \\times A, \\Delta } A.  \\]\n\n    \n       Thus (3) implies (2) and the lemma is proved. \n      $\\square$\n    \n",\n  Lemma 4.18.4. Let $\\mathcal{C}$ be a category. The following are equivalent: \n  \n  \nFinite limits exist in $\\mathcal{C}$. \n\n\nFinite products and equalizers exist. \n\n\nThe category has a final object and fibre products exist. \n\n\n\n\n    \n,"Proof.\n      Since finite products, fibre products, equalizers, and final objects are limits over finite index categories we see that (1) implies both (2) and (3). By Lemma 4.14.11 above we see that (2) implies (1). Assume (3). Note that the product $A \\times B$ is the fibre product over the final object. If $a, b : A \\to B$ are morphisms of $\\mathcal{C}$, then the equalizer of $a, b$ is \n    \n      \n  \\[  (A \\times _{a, B, b} A)\\times _{(\\text{pr}_1, \\text{pr}_2), A \\times A, \\Delta } A.  \\]\n\n    \n       Thus (3) implies (2) and the lemma is proved. \n      $\\square$\n    \n"," { has_limit := fun F => hasLimit_of_equalizer_and_product F }
","theorem hasFiniteLimits_of_hasEqualizers_and_finite_products [HasFiniteProducts C]
    [HasEqualizers C] : HasFiniteLimits C where
  out _ ","Proof.\n      Since finite products, fibre products, equalizers, and final objects are limits over finite index categories we see that (1) implies both (2) and (3). By Lemma 4.14.11 [[\n  Lemma 4.14.11. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. Write $I = \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and $A = \\text{Arrows}(\\mathcal{I})$. Denote $s, t : A \\to I$ the source and target maps. Suppose that $\\prod _{i \\in I} M_ i$ and $\\prod _{a \\in A} M_{t(a)}$ exist. Suppose that the equalizer of \n  \n  \\[  \\xymatrix{ \\prod _{i \\in I} M_ i \\ar@<1ex>[r]^\\phi \\ar@<-1ex>[r]_\\psi &  \\prod _{a \\in A} M_{t(a)} }  \\]\n\n   exists, where the morphisms are determined by their components as follows: $p_ a \\circ \\psi = M(a) \\circ p_{s(a)}$ and $p_ a \\circ \\phi = p_{t(a)}$. Then this equalizer is the limit of the diagram. \n\n    \n]] above we see that (2) implies (1). Assume (3). Note that the product $A \\times B$ is the fibre product over the final object. If $a, b : A \\to B$ are morphisms of $\\mathcal{C}$, then the equalizer of $a, b$ is \n    \n      \n  \\[  (A \\times _{a, B, b} A)\\times _{(\\text{pr}_1, \\text{pr}_2), A \\times A, \\Delta } A.  \\]\n\n    \n       Thus (3) implies (2) and the lemma is proved. \n      $\\square$\n    \n","Proof.\n      Since finite products, fibre products, equalizers, and final objects are limits over finite index categories we see that (1) implies both (2) and (3). By Lemma 4.14.11 [[\n  Lemma 4.14.11. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. Write $I = \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and $A = \\text{Arrows}(\\mathcal{I})$. Denote $s, t : A \\to I$ the source and target maps. Suppose that $\\prod _{i \\in I} M_ i$ and $\\prod _{a \\in A} M_{t(a)}$ exist. Suppose that the equalizer of \n  \n  \\[  \\xymatrix{ \\prod _{i \\in I} M_ i \\ar@<1ex>[r]^\\phi \\ar@<-1ex>[r]_\\psi &  \\prod _{a \\in A} M_{t(a)} }  \\]\n\n   exists, where the morphisms are determined by their components as follows: $p_ a \\circ \\psi = M(a) \\circ p_{s(a)}$ and $p_ a \\circ \\phi = p_{t(a)}$. Then this equalizer is the limit of the diagram. \n\n    \n]] above we see that (2) implies (1). Assume (3). Note that the product $A \\times B$ is the fibre product over the final object. If $a, b : A \\to B$ are morphisms of $\\mathcal{C}$, then the equalizer of $a, b$ is \n    \n      \n  \\[  (A \\times _{a, B, b} A)\\times _{(\\text{pr}_1, \\text{pr}_2), A \\times A, \\Delta } A.  \\]\n\n    \n       Thus (3) implies (2) and the lemma is proved. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the formal proof appeals to a single lemma/construction `hasLimit_of_equalizer_and_product`, which matches the informal proof‚Äôs key mathematical content: deriving existence of general finite limits from existence of products and equalizers (via the standard equalizer-of-two-maps-between-products construction, like Lemma 4.14.11). Structurally, however, the informal proof is a multi-implication equivalence argument ((1)‚áí(2),(3); (2)‚áí(1) via Lemma 4.14.11; (3)‚áí(2) by expressing products and equalizers using final objects and pullbacks), while the formal proof only provides the (2)‚áí(1)-style direction and does not reflect the other directions or the explicit constructions using final objects/pullbacks. Thus it captures a central step but is incomplete relative to the full informal proof.""}"
97,002P,"theorem has_colimits_of_hasCoequalizers_and_coproducts [HasCoproducts.{w} C] [HasCoequalizers C] :
    HasColimitsOfSize.{w, w} C where
  has_colimits_of_shape := fun _ _ =>
      { has_colimit := fun F => hasColimit_of_coequalizer_and_coproduct F }
",Formal Proof of Stacks Project Tag 002P,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Limits/Constructions/LimitsOfProductsAndEqualizers.lean#L394-L397,Q27041,,4.14.12,lemma,3.0,"['002D', '0011', '0ELQ']","\n       \n      \n  Lemma 4.14.12. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. Write $I = \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and $A = \\text{Arrows}(\\mathcal{I})$. Denote $s, t : A \\to I$ the source and target maps. Suppose that $\\coprod _{i \\in I} M_ i$ and $\\coprod _{a \\in A} M_{s(a)}$ exist. Suppose that the coequalizer of \n  \n  \\[  \\xymatrix{ \\coprod _{a \\in A} M_{s(a)} \\ar@<1ex>[r]^\\phi \\ar@<-1ex>[r]_\\psi &  \\coprod _{i \\in I} M_ i }  \\]\n\n   exists, where the morphisms are determined by their components as follows: The component $M_{s(a)}$ maps via $\\psi $ to the component $M_{t(a)}$ via the morphism $M(a)$. The component $M_{s(a)}$ maps via $\\phi $ to the component $M_{s(a)}$ by the identity morphism. Then this coequalizer is the colimit of the diagram. \n\n    \n      Proof.\n      Omitted. \n      $\\square$\n    \n","\n       \n      \n  Lemma 4.14.12. Let $M : \\mathcal{I} \\to \\mathcal{C}$ be a diagram. Write $I = \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and $A = \\text{Arrows}(\\mathcal{I})$. Denote $s, t : A \\to I$ the source and target maps. Suppose that $\\coprod _{i \\in I} M_ i$ and $\\coprod _{a \\in A} M_{s(a)}$ exist. Suppose that the coequalizer of \n  \n  \\[  \\xymatrix{ \\coprod _{a \\in A} M_{s(a)} \\ar@<1ex>[r]^\\phi \\ar@<-1ex>[r]_\\psi &  \\coprod _{i \\in I} M_ i }  \\]\n\n   exists, where the morphisms are determined by their components as follows: The component $M_{s(a)}$ maps via $\\psi $ to the component $M_{t(a)}$ via the morphism $M(a)$. The component $M_{s(a)}$ maps via $\\phi $ to the component $M_{s(a)}$ by the identity morphism. Then this coequalizer is the colimit of the diagram. \n\n    \n",Proof.\n      Omitted. \n      $\\square$\n    \n," fun _ _ =>
      { has_colimit := fun F => hasColimit_of_coequalizer_and_coproduct F }
","theorem has_colimits_of_hasCoequalizers_and_coproducts [HasCoproducts.{w} C] [HasCoequalizers C] :
    HasColimitsOfSize.{w, w} C where
  has_colimits_of_shape ",Proof.\n      Omitted. \n      $\\square$\n    \n,Proof.\n      Omitted. \n      $\\square$\n    \n,"{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the formal proof provides a concrete construction: it defines an instance by supplying `has_colimit` via `hasColimit_of_coequalizer_and_coproduct`, i.e., it proves existence of colimits under certain hypotheses. The informal proof, however, is entirely omitted, so there is no explicit mathematical content to compare against; it could be consistent with many different arguments. Structurally, the informal proof has no steps, while the formal proof is a one-line implementation, so there is no structural correspondence to assess beyond the fact that both are very short. Overall, the formal proof plausibly matches an omitted argument but cannot be verified as aligned, yielding only moderate alignment.""}"
98,002Q,"theorem hasFiniteColimits_of_hasCoequalizers_and_finite_coproducts [HasFiniteCoproducts C]
    [HasCoequalizers C] : HasFiniteColimits C where
  out _ := { has_colimit := fun F => hasColimit_of_coequalizer_and_coproduct F }
",Formal Proof of Stacks Project Tag 002Q,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Limits/Constructions/LimitsOfProductsAndEqualizers.lean#L401-L403,Q27041,,4.18.7,lemma,3.0,"['04AS', '0011', '0ELQ']",\n  Lemma 4.18.7. Let $\\mathcal{C}$ be a category. The following are equivalent: \n  \n  \nFinite colimits exist in $\\mathcal{C}$. \n\n\nFinite coproducts and coequalizers exist in $\\mathcal{C}$. \n\n\nThe category has an initial object and pushouts exist. \n\n\n\n\n    \n      Proof.\n      Omitted. Hint: This is dual to Lemma 4.18.4. \n      $\\square$\n    \n,\n  Lemma 4.18.7. Let $\\mathcal{C}$ be a category. The following are equivalent: \n  \n  \nFinite colimits exist in $\\mathcal{C}$. \n\n\nFinite coproducts and coequalizers exist in $\\mathcal{C}$. \n\n\nThe category has an initial object and pushouts exist. \n\n\n\n\n    \n,Proof.\n      Omitted. Hint: This is dual to Lemma 4.18.4. \n      $\\square$\n    \n," { has_colimit := fun F => hasColimit_of_coequalizer_and_coproduct F }
","theorem hasFiniteColimits_of_hasCoequalizers_and_finite_coproducts [HasFiniteCoproducts C]
    [HasCoequalizers C] : HasFiniteColimits C where
  out _ ",Proof.\n      Omitted. Hint: This is dual to Lemma 4.18.4 [[\n  Lemma 4.18.4. Let $\\mathcal{C}$ be a category. The following are equivalent: \n  \n  \nFinite limits exist in $\\mathcal{C}$. \n\n\nFinite products and equalizers exist. \n\n\nThe category has a final object and fibre products exist. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n,Proof.\n      Omitted. Hint: This is dual to Lemma 4.18.4 [[\n  Lemma 4.18.4. Let $\\mathcal{C}$ be a category. The following are equivalent: \n  \n  \nFinite limits exist in $\\mathcal{C}$. \n\n\nFinite products and equalizers exist. \n\n\nThe category has a final object and fibre products exist. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n,"{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof establishes existence of colimits for a diagram F by invoking a lemma `hasColimit_of_coequalizer_and_coproduct`, i.e. it reduces existence of (finite) colimits to existence of coproducts and coequalizers. This matches the informal hint that the result is the dual of a lemma characterizing finite limits via products and equalizers. Structurally, however, the informal proof is entirely omitted and only references duality with a multi-part equivalence (including terminal object and pullbacks), while the formal proof picks one specific characterization (coproducts + coequalizers) and does not reflect the broader equivalence structure or the duality argument. Thus the core idea aligns, but the correspondence is partial and not fully faithful to the informal proof‚Äôs stated structure.""}"
101,0032,"lemma IsFiltered.exists_directed
    (J : Type w) [SmallCategory J] [IsFiltered J] :
    ‚àÉ (Œ± : Type w) (_ : PartialOrder Œ±) (_ : IsDirected Œ± (¬∑ ‚â§ ¬∑)) (_ : Nonempty Œ±)
      (F : Œ± ‚•§ J), F.Final := by
  have := (isCardinalFiltered_aleph0_iff.{w} J).2 inferInstance
  obtain ‚ü®Œ±, _, _, F, _‚ü© := IsCardinalFiltered.exists_cardinal_directed J .aleph0
  have : IsFiltered Œ± := by rwa [‚Üê isCardinalFiltered_aleph0_iff.{w}]
  exact ‚ü®Œ±, _, IsFiltered.isDirectedOrder _, nonempty, F, inferInstance‚ü©
",Formal Proof of Stacks Project Tag 0032,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Presentable/Directed.lean#L545-L552,Q27041,,4.21.5,lemma,3.0,"['002Z', '0011', '0ELQ']","\n  Lemma 4.21.5. Let $\\mathcal{I}$ be a filtered index category. There exist a directed set $I$ and a system $(x_ i, \\varphi _{ii\'})$ over $I$ in $\\mathcal{I}$ with the following properties: \n  \n  \nFor every category $\\mathcal{C}$ and every diagram $M : \\mathcal{I} \\to \\mathcal{C}$ with values in $\\mathcal{C}$, denote $(M(x_ i), M(\\varphi _{ii\'}))$ the corresponding system over $I$. If $\\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} M(x_ i)$ exists then so does $\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M$ and the transformation \n\n\n  \\[  \\theta : \\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} M(x_ i) \\longrightarrow \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M  \\]\n\n\n of Lemma 4.14.8 is an isomorphism. \n\n\nFor every category $\\mathcal{C}$ and every diagram $M : \\mathcal{I}^{opp} \\to \\mathcal{C}$ in $\\mathcal{C}$, denote $(M(x_ i), M(\\varphi _{ii\'}))$ the corresponding inverse system over $I$. If $\\mathop{\\mathrm{lim}}\\nolimits _{i \\in I} M(x_ i)$ exists then so does $\\mathop{\\mathrm{lim}}\\nolimits _{\\mathcal{I}^{opp}} M$ and the transformation \n\n\n  \\[  \\theta : \\mathop{\\mathrm{lim}}\\nolimits _{\\mathcal{I}^{opp}} M \\longrightarrow \\mathop{\\mathrm{lim}}\\nolimits _{i \\in I} M(x_ i)  \\]\n\n\n of Lemma 4.14.9 is an isomorphism. \n\n\n\n\n    \n      Proof.\n      As explained in the text following Definition 4.21.2, we may view preordered sets as categories and systems as functors. Throughout the proof, we will freely shift between these two points of view. We prove the first statement by constructing a category $\\mathcal{I}_0$, corresponding to a directed set1, and a cofinal functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$. Then, by Lemma 4.17.2, the colimit of a diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of the diagram $M \\circ M_0 : \\mathcal{I}_0 \\to \\mathcal{C}$, from which the statement follows. The second statement is dual to the first and may be proved by interpreting a limit in $\\mathcal{C}$ as a colimit in $\\mathcal{C}^{opp}$. We omit the details. \n    \n      A category $\\mathcal{F}$ is called finitely generated if there exists a finite set $F$ of arrows in $\\mathcal{F}$, such that each arrow in $\\mathcal{F}$ may be obtained by composing arrows from $F$. In particular, this implies that $\\mathcal{F}$ has finitely many objects. We start the proof by reducing to the case when $\\mathcal{I}$ has the property that every finitely generated subcategory of $\\mathcal{I}$ may be extended to a finitely generated subcategory with a unique final object. \n    \n      Let $\\omega $ denote the directed set of finite ordinals, which we view as a filtered category. It is easy to verify that the product category $\\mathcal{I}\\times \\omega $ is also filtered, and the projection $\\Pi : \\mathcal{I} \\times \\omega \\to \\mathcal{I}$ is cofinal. \n    \n      Now let $\\mathcal{F}$ be any finitely generated subcategory of $\\mathcal{I}\\times \\omega $. By using the axioms of a filtered category and a simple induction argument on a finite set of generators of $\\mathcal{F}$, we may construct a cocone $(\\{ f_ i\\} , i_\\infty )$ in $\\mathcal{I} \\times \\omega $ for the diagram $\\mathcal{F} \\to \\mathcal{I} \\times \\omega $. That is, a morphism $f_ i : i \\to i_\\infty $ for every object $i$ in $\\mathcal{F}$ such that for each arrow $f : i \\to i\'$ in $\\mathcal{F}$ we have $f_ i = f_{i\'} \\circ f$. We can also choose $i_\\infty $ such that there are no arrows from $i_\\infty $ to an object in $\\mathcal{F}$. This is possible since we may always post-compose the arrows $f_ i$ with an arrow which is the identity on the $\\mathcal{I}$-component and strictly increasing on the $\\omega $-component. Now let $\\mathcal{F}^+$ denote the category consisting of all objects and arrows in $\\mathcal{F}$ together with the object $i_\\infty $, the identity arrow $\\text{id}_{i_\\infty }$ and the arrows $f_ i$. Since there are no arrows from $i_\\infty $ in $\\mathcal{F}^+$ to any object of $\\mathcal{F}$, the arrow set in $\\mathcal{F}^+$ is closed under composition, so $\\mathcal{F}^+$ is indeed a category. By construction, it is a finitely generated subcategory of $\\mathcal{I}$ which has $i_\\infty $ as unique final object. Since, by Lemma 4.17.2, the colimit of any diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of $M\\circ \\Pi $ , this gives the desired reduction. \n    \n      The set of all finitely generated subcategories of $\\mathcal{I}$ with a unique final object is naturally ordered by inclusion. We take $\\mathcal{I}_0$ to be the category corresponding to this set. We also have a functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$, which takes an arrow $\\mathcal{F} \\subset \\mathcal{F\'}$ in $\\mathcal{I}_0$ to the unique map from the final object of $\\mathcal{F}$ to the final object of $\\mathcal{F}\'$. Given any two finitely generated subcategories of $\\mathcal{I}$, the category generated by these two categories is also finitely generated. By our assumption on $\\mathcal{I}$, it is also contained in a finitely generated subcategory of $\\mathcal{I}$ with a unique final object. This shows that $\\mathcal{I}_0$ is directed. \n    \n      Finally, we verify that $M_0$ is cofinal. Since any object of $\\mathcal{I}$ is the final object in the subcategory consisting of only that object and its identity arrow, the functor $M_0$ is surjective on objects. In particular, Condition (1) of Definition 4.17.1 is satisfied. Given an object $i$ of $\\mathcal{I}$, objects $\\mathcal{F}_1, \\mathcal{F}_2$ in $\\mathcal{I}_0$ and maps $\\varphi _1 : i \\to M_0(\\mathcal{F}_1)$ and $\\varphi _2 : i \\to M_0(\\mathcal{F}_2)$ in $\\mathcal{I}$, we can take $\\mathcal{F}_{12}$ to be a finitely generated category with a unique final object containing $\\mathcal{F}_1$, $\\mathcal{F}_2$ and the morphisms $\\varphi _1, \\varphi _2$. The resulting diagram commutes \n    \n      \n  \\[  \\xymatrix{ &  M_0(\\mathcal{F}_{12}) &  \\\\  M_0(\\mathcal{F}_{1}) \\ar[ru] &  &  M_0(\\mathcal{F}_{2}) \\ar[lu] \\\\  &  i \\ar[lu] \\ar[ru] }  \\]\n\n    \n       since it lives in the category $\\mathcal{F}_{12}$ and $M_0(\\mathcal{F}_{12})$ is final in this category. Hence also Condition (2) is satisfied, which concludes the proof. \n      $\\square$\n    \n","\n  Lemma 4.21.5. Let $\\mathcal{I}$ be a filtered index category. There exist a directed set $I$ and a system $(x_ i, \\varphi _{ii\'})$ over $I$ in $\\mathcal{I}$ with the following properties: \n  \n  \nFor every category $\\mathcal{C}$ and every diagram $M : \\mathcal{I} \\to \\mathcal{C}$ with values in $\\mathcal{C}$, denote $(M(x_ i), M(\\varphi _{ii\'}))$ the corresponding system over $I$. If $\\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} M(x_ i)$ exists then so does $\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M$ and the transformation \n\n\n  \\[  \\theta : \\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} M(x_ i) \\longrightarrow \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M  \\]\n\n\n of Lemma 4.14.8 is an isomorphism. \n\n\nFor every category $\\mathcal{C}$ and every diagram $M : \\mathcal{I}^{opp} \\to \\mathcal{C}$ in $\\mathcal{C}$, denote $(M(x_ i), M(\\varphi _{ii\'}))$ the corresponding inverse system over $I$. If $\\mathop{\\mathrm{lim}}\\nolimits _{i \\in I} M(x_ i)$ exists then so does $\\mathop{\\mathrm{lim}}\\nolimits _{\\mathcal{I}^{opp}} M$ and the transformation \n\n\n  \\[  \\theta : \\mathop{\\mathrm{lim}}\\nolimits _{\\mathcal{I}^{opp}} M \\longrightarrow \\mathop{\\mathrm{lim}}\\nolimits _{i \\in I} M(x_ i)  \\]\n\n\n of Lemma 4.14.9 is an isomorphism. \n\n\n\n\n    \n","Proof.\n      As explained in the text following Definition 4.21.2, we may view preordered sets as categories and systems as functors. Throughout the proof, we will freely shift between these two points of view. We prove the first statement by constructing a category $\\mathcal{I}_0$, corresponding to a directed set1, and a cofinal functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$. Then, by Lemma 4.17.2, the colimit of a diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of the diagram $M \\circ M_0 : \\mathcal{I}_0 \\to \\mathcal{C}$, from which the statement follows. The second statement is dual to the first and may be proved by interpreting a limit in $\\mathcal{C}$ as a colimit in $\\mathcal{C}^{opp}$. We omit the details. \n    \n      A category $\\mathcal{F}$ is called finitely generated if there exists a finite set $F$ of arrows in $\\mathcal{F}$, such that each arrow in $\\mathcal{F}$ may be obtained by composing arrows from $F$. In particular, this implies that $\\mathcal{F}$ has finitely many objects. We start the proof by reducing to the case when $\\mathcal{I}$ has the property that every finitely generated subcategory of $\\mathcal{I}$ may be extended to a finitely generated subcategory with a unique final object. \n    \n      Let $\\omega $ denote the directed set of finite ordinals, which we view as a filtered category. It is easy to verify that the product category $\\mathcal{I}\\times \\omega $ is also filtered, and the projection $\\Pi : \\mathcal{I} \\times \\omega \\to \\mathcal{I}$ is cofinal. \n    \n      Now let $\\mathcal{F}$ be any finitely generated subcategory of $\\mathcal{I}\\times \\omega $. By using the axioms of a filtered category and a simple induction argument on a finite set of generators of $\\mathcal{F}$, we may construct a cocone $(\\{ f_ i\\} , i_\\infty )$ in $\\mathcal{I} \\times \\omega $ for the diagram $\\mathcal{F} \\to \\mathcal{I} \\times \\omega $. That is, a morphism $f_ i : i \\to i_\\infty $ for every object $i$ in $\\mathcal{F}$ such that for each arrow $f : i \\to i\'$ in $\\mathcal{F}$ we have $f_ i = f_{i\'} \\circ f$. We can also choose $i_\\infty $ such that there are no arrows from $i_\\infty $ to an object in $\\mathcal{F}$. This is possible since we may always post-compose the arrows $f_ i$ with an arrow which is the identity on the $\\mathcal{I}$-component and strictly increasing on the $\\omega $-component. Now let $\\mathcal{F}^+$ denote the category consisting of all objects and arrows in $\\mathcal{F}$ together with the object $i_\\infty $, the identity arrow $\\text{id}_{i_\\infty }$ and the arrows $f_ i$. Since there are no arrows from $i_\\infty $ in $\\mathcal{F}^+$ to any object of $\\mathcal{F}$, the arrow set in $\\mathcal{F}^+$ is closed under composition, so $\\mathcal{F}^+$ is indeed a category. By construction, it is a finitely generated subcategory of $\\mathcal{I}$ which has $i_\\infty $ as unique final object. Since, by Lemma 4.17.2, the colimit of any diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of $M\\circ \\Pi $ , this gives the desired reduction. \n    \n      The set of all finitely generated subcategories of $\\mathcal{I}$ with a unique final object is naturally ordered by inclusion. We take $\\mathcal{I}_0$ to be the category corresponding to this set. We also have a functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$, which takes an arrow $\\mathcal{F} \\subset \\mathcal{F\'}$ in $\\mathcal{I}_0$ to the unique map from the final object of $\\mathcal{F}$ to the final object of $\\mathcal{F}\'$. Given any two finitely generated subcategories of $\\mathcal{I}$, the category generated by these two categories is also finitely generated. By our assumption on $\\mathcal{I}$, it is also contained in a finitely generated subcategory of $\\mathcal{I}$ with a unique final object. This shows that $\\mathcal{I}_0$ is directed. \n    \n      Finally, we verify that $M_0$ is cofinal. Since any object of $\\mathcal{I}$ is the final object in the subcategory consisting of only that object and its identity arrow, the functor $M_0$ is surjective on objects. In particular, Condition (1) of Definition 4.17.1 is satisfied. Given an object $i$ of $\\mathcal{I}$, objects $\\mathcal{F}_1, \\mathcal{F}_2$ in $\\mathcal{I}_0$ and maps $\\varphi _1 : i \\to M_0(\\mathcal{F}_1)$ and $\\varphi _2 : i \\to M_0(\\mathcal{F}_2)$ in $\\mathcal{I}$, we can take $\\mathcal{F}_{12}$ to be a finitely generated category with a unique final object containing $\\mathcal{F}_1$, $\\mathcal{F}_2$ and the morphisms $\\varphi _1, \\varphi _2$. The resulting diagram commutes \n    \n      \n  \\[  \\xymatrix{ &  M_0(\\mathcal{F}_{12}) &  \\\\  M_0(\\mathcal{F}_{1}) \\ar[ru] &  &  M_0(\\mathcal{F}_{2}) \\ar[lu] \\\\  &  i \\ar[lu] \\ar[ru] }  \\]\n\n    \n       since it lives in the category $\\mathcal{F}_{12}$ and $M_0(\\mathcal{F}_{12})$ is final in this category. Hence also Condition (2) is satisfied, which concludes the proof. \n      $\\square$\n    \n"," by
  have := (isCardinalFiltered_aleph0_iff.{w} J).2 inferInstance
  obtain ‚ü®Œ±, _, _, F, _‚ü© := IsCardinalFiltered.exists_cardinal_directed J .aleph0
  have : IsFiltered Œ± := by rwa [‚Üê isCardinalFiltered_aleph0_iff.{w}]
  exact ‚ü®Œ±, _, IsFiltered.isDirectedOrder _, nonempty, F, inferInstance‚ü©
","lemma IsFiltered.exists_directed
    (J : Type w) [SmallCategory J] [IsFiltered J] :
    ‚àÉ (Œ± : Type w) (_ : PartialOrder Œ±) (_ : IsDirected Œ± (¬∑ ‚â§ ¬∑)) (_ : Nonempty Œ±)
      (F : Œ± ‚•§ J), F.Final ","Proof.\n      As explained in the text following Definition 4.21.2 [[\n  Definition 4.21.2. Let $(I, \\leq )$ be a preordered set. Let $\\mathcal{C}$ be a category. \n  \n  \nA system over $I$ in $\\mathcal{C}$, sometimes called a inductive system over $I$ in $\\mathcal{C}$ is given by objects $M_ i$ of $\\mathcal{C}$ and for every $i \\leq i\'$ a morphism $f_{ii\'} : M_ i \\to M_{i\'}$ such that $f_{ii} = \\text{id}$ and such that $f_{ii\'\'} = f_{i\'i\'\'} \\circ f_{i i\'}$ whenever $i \\leq i\' \\leq i\'\'$. \n\n\nAn inverse system over $I$ in $\\mathcal{C}$, sometimes called a projective system over $I$ in $\\mathcal{C}$ is given by objects $M_ i$ of $\\mathcal{C}$ and for every $i\' \\leq i$ a morphism $f_{ii\'} : M_ i \\to M_{i\'}$ such that $f_{ii} = \\text{id}$ and such that $f_{ii\'\'} = f_{i\'i\'\'} \\circ f_{i i\'}$ whenever $i\'\' \\leq i\' \\leq i$. (Note reversal of inequalities.) \n\n\n\n   We will say $(M_ i, f_{ii\'})$ is a (inverse) system over $I$ to denote this. The maps $f_{ii\'}$ are sometimes called the transition maps. \n]], we may view preordered sets as categories and systems as functors. Throughout the proof, we will freely shift between these two points of view. We prove the first statement by constructing a category $\\mathcal{I}_0$, corresponding to a directed set1, and a cofinal functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$. Then, by Lemma 4.17.2 [[\n  Lemma 4.17.2. Let $H : \\mathcal{I} \\to \\mathcal{J}$ be a functor of categories. Assume $\\mathcal{I}$ is cofinal in $\\mathcal{J}$. Then for every diagram $M : \\mathcal{J} \\to \\mathcal{C}$ we have a canonical isomorphism \n  \n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M \\circ H = \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {J} M  \\]\n\n   if either side exists. \n\n    \n]], the colimit of a diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of the diagram $M \\circ M_0 : \\mathcal{I}_0 \\to \\mathcal{C}$, from which the statement follows. The second statement is dual to the first and may be proved by interpreting a limit in $\\mathcal{C}$ as a colimit in $\\mathcal{C}^{opp}$. We omit the details. \n    \n      A category $\\mathcal{F}$ is called finitely generated if there exists a finite set $F$ of arrows in $\\mathcal{F}$, such that each arrow in $\\mathcal{F}$ may be obtained by composing arrows from $F$. In particular, this implies that $\\mathcal{F}$ has finitely many objects. We start the proof by reducing to the case when $\\mathcal{I}$ has the property that every finitely generated subcategory of $\\mathcal{I}$ may be extended to a finitely generated subcategory with a unique final object. \n    \n      Let $\\omega $ denote the directed set of finite ordinals, which we view as a filtered category. It is easy to verify that the product category $\\mathcal{I}\\times \\omega $ is also filtered, and the projection $\\Pi : \\mathcal{I} \\times \\omega \\to \\mathcal{I}$ is cofinal. \n    \n      Now let $\\mathcal{F}$ be any finitely generated subcategory of $\\mathcal{I}\\times \\omega $. By using the axioms of a filtered category and a simple induction argument on a finite set of generators of $\\mathcal{F}$, we may construct a cocone $(\\{ f_ i\\} , i_\\infty )$ in $\\mathcal{I} \\times \\omega $ for the diagram $\\mathcal{F} \\to \\mathcal{I} \\times \\omega $. That is, a morphism $f_ i : i \\to i_\\infty $ for every object $i$ in $\\mathcal{F}$ such that for each arrow $f : i \\to i\'$ in $\\mathcal{F}$ we have $f_ i = f_{i\'} \\circ f$. We can also choose $i_\\infty $ such that there are no arrows from $i_\\infty $ to an object in $\\mathcal{F}$. This is possible since we may always post-compose the arrows $f_ i$ with an arrow which is the identity on the $\\mathcal{I}$-component and strictly increasing on the $\\omega $-component. Now let $\\mathcal{F}^+$ denote the category consisting of all objects and arrows in $\\mathcal{F}$ together with the object $i_\\infty $, the identity arrow $\\text{id}_{i_\\infty }$ and the arrows $f_ i$. Since there are no arrows from $i_\\infty $ in $\\mathcal{F}^+$ to any object of $\\mathcal{F}$, the arrow set in $\\mathcal{F}^+$ is closed under composition, so $\\mathcal{F}^+$ is indeed a category. By construction, it is a finitely generated subcategory of $\\mathcal{I}$ which has $i_\\infty $ as unique final object. Since, by Lemma 4.17.2 [[\n  Lemma 4.17.2. Let $H : \\mathcal{I} \\to \\mathcal{J}$ be a functor of categories. Assume $\\mathcal{I}$ is cofinal in $\\mathcal{J}$. Then for every diagram $M : \\mathcal{J} \\to \\mathcal{C}$ we have a canonical isomorphism \n  \n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M \\circ H = \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {J} M  \\]\n\n   if either side exists. \n\n    \n]], the colimit of any diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of $M\\circ \\Pi $ , this gives the desired reduction. \n    \n      The set of all finitely generated subcategories of $\\mathcal{I}$ with a unique final object is naturally ordered by inclusion. We take $\\mathcal{I}_0$ to be the category corresponding to this set. We also have a functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$, which takes an arrow $\\mathcal{F} \\subset \\mathcal{F\'}$ in $\\mathcal{I}_0$ to the unique map from the final object of $\\mathcal{F}$ to the final object of $\\mathcal{F}\'$. Given any two finitely generated subcategories of $\\mathcal{I}$, the category generated by these two categories is also finitely generated. By our assumption on $\\mathcal{I}$, it is also contained in a finitely generated subcategory of $\\mathcal{I}$ with a unique final object. This shows that $\\mathcal{I}_0$ is directed. \n    \n      Finally, we verify that $M_0$ is cofinal. Since any object of $\\mathcal{I}$ is the final object in the subcategory consisting of only that object and its identity arrow, the functor $M_0$ is surjective on objects. In particular, Condition (1) of Definition 4.17.1 [[\n  Definition 4.17.1. Let $H : \\mathcal{I} \\to \\mathcal{J}$ be a functor between categories. We say $\\mathcal{I}$ is cofinal in $\\mathcal{J}$ or that $H$ is cofinal if \n  \n  \nfor all $y \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{J})$ there exist an $x \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and a morphism $y \\to H(x)$, and \n\n\ngiven $y \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{J})$, $x, x\' \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and morphisms $y \\to H(x)$ and $y \\to H(x\')$ there exist a sequence of morphisms \n\n\n  \\[  x = x_0 \\leftarrow x_1 \\rightarrow x_2 \\leftarrow x_3 \\rightarrow \\ldots \\rightarrow x_{2n} = x\'  \\]\n\n\n in $\\mathcal{I}$ and morphisms $y \\to H(x_ i)$ in $\\mathcal{J}$ with $y \\to H(x_0)$ and $y \\to H(x_{2n})$ the given morphisms such that the diagrams \n\n\n  \\[  \\xymatrix{ &  y \\ar[ld] \\ar[d] \\ar[rd] \\\\  H(x_{2k}) &  H(x_{2k + 1}) \\ar[l] \\ar[r] &  H(x_{2k + 2}) }  \\]\n\n\n commute for $k = 0, \\ldots , n - 1$. \n\n\n\n   In other words, fixing an object $y$ of $\\mathcal{J}$ consider the set $S$ of pairs $(x, b)$ where $x$ is an object of $\\mathcal{I}$ and $b : y \\to H(x)$ is a morphism. Consider the equivalence relation on $S$ generated by $(x, b) \\sim (x\', b\')$ if there exists a morphism $a : x \\to x\'$ with $b\' = H(a) \\circ b$. Then $S$ should consist of exactly one equivalence class. \n]] is satisfied. Given an object $i$ of $\\mathcal{I}$, objects $\\mathcal{F}_1, \\mathcal{F}_2$ in $\\mathcal{I}_0$ and maps $\\varphi _1 : i \\to M_0(\\mathcal{F}_1)$ and $\\varphi _2 : i \\to M_0(\\mathcal{F}_2)$ in $\\mathcal{I}$, we can take $\\mathcal{F}_{12}$ to be a finitely generated category with a unique final object containing $\\mathcal{F}_1$, $\\mathcal{F}_2$ and the morphisms $\\varphi _1, \\varphi _2$. The resulting diagram commutes \n    \n      \n  \\[  \\xymatrix{ &  M_0(\\mathcal{F}_{12}) &  \\\\  M_0(\\mathcal{F}_{1}) \\ar[ru] &  &  M_0(\\mathcal{F}_{2}) \\ar[lu] \\\\  &  i \\ar[lu] \\ar[ru] }  \\]\n\n    \n       since it lives in the category $\\mathcal{F}_{12}$ and $M_0(\\mathcal{F}_{12})$ is final in this category. Hence also Condition (2) is satisfied, which concludes the proof. \n      $\\square$\n    \n","Proof.\n      As explained in the text following Definition 4.21.2 [[\n  Definition 4.21.2. Let $(I, \\leq )$ be a preordered set. Let $\\mathcal{C}$ be a category. \n  \n  \nA system over $I$ in $\\mathcal{C}$, sometimes called a inductive system over $I$ in $\\mathcal{C}$ is given by objects $M_ i$ of $\\mathcal{C}$ and for every $i \\leq i\'$ a morphism $f_{ii\'} : M_ i \\to M_{i\'}$ such that $f_{ii} = \\text{id}$ and such that $f_{ii\'\'} = f_{i\'i\'\'} \\circ f_{i i\'}$ whenever $i \\leq i\' \\leq i\'\'$. \n\n\nAn inverse system over $I$ in $\\mathcal{C}$, sometimes called a projective system over $I$ in $\\mathcal{C}$ is given by objects $M_ i$ of $\\mathcal{C}$ and for every $i\' \\leq i$ a morphism $f_{ii\'} : M_ i \\to M_{i\'}$ such that $f_{ii} = \\text{id}$ and such that $f_{ii\'\'} = f_{i\'i\'\'} \\circ f_{i i\'}$ whenever $i\'\' \\leq i\' \\leq i$. (Note reversal of inequalities.) \n\n\n\n   We will say $(M_ i, f_{ii\'})$ is a (inverse) system over $I$ to denote this. The maps $f_{ii\'}$ are sometimes called the transition maps. \n]], we may view preordered sets as categories and systems as functors. Throughout the proof, we will freely shift between these two points of view. We prove the first statement by constructing a category $\\mathcal{I}_0$, corresponding to a directed set1, and a cofinal functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$. Then, by Lemma 4.17.2 [[\n  Lemma 4.17.2. Let $H : \\mathcal{I} \\to \\mathcal{J}$ be a functor of categories. Assume $\\mathcal{I}$ is cofinal in $\\mathcal{J}$. Then for every diagram $M : \\mathcal{J} \\to \\mathcal{C}$ we have a canonical isomorphism \n  \n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M \\circ H = \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {J} M  \\]\n\n   if either side exists. \n\n    \n]], the colimit of a diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of the diagram $M \\circ M_0 : \\mathcal{I}_0 \\to \\mathcal{C}$, from which the statement follows. The second statement is dual to the first and may be proved by interpreting a limit in $\\mathcal{C}$ as a colimit in $\\mathcal{C}^{opp}$. We omit the details. \n    \n      A category $\\mathcal{F}$ is called finitely generated if there exists a finite set $F$ of arrows in $\\mathcal{F}$, such that each arrow in $\\mathcal{F}$ may be obtained by composing arrows from $F$. In particular, this implies that $\\mathcal{F}$ has finitely many objects. We start the proof by reducing to the case when $\\mathcal{I}$ has the property that every finitely generated subcategory of $\\mathcal{I}$ may be extended to a finitely generated subcategory with a unique final object. \n    \n      Let $\\omega $ denote the directed set of finite ordinals, which we view as a filtered category. It is easy to verify that the product category $\\mathcal{I}\\times \\omega $ is also filtered, and the projection $\\Pi : \\mathcal{I} \\times \\omega \\to \\mathcal{I}$ is cofinal. \n    \n      Now let $\\mathcal{F}$ be any finitely generated subcategory of $\\mathcal{I}\\times \\omega $. By using the axioms of a filtered category and a simple induction argument on a finite set of generators of $\\mathcal{F}$, we may construct a cocone $(\\{ f_ i\\} , i_\\infty )$ in $\\mathcal{I} \\times \\omega $ for the diagram $\\mathcal{F} \\to \\mathcal{I} \\times \\omega $. That is, a morphism $f_ i : i \\to i_\\infty $ for every object $i$ in $\\mathcal{F}$ such that for each arrow $f : i \\to i\'$ in $\\mathcal{F}$ we have $f_ i = f_{i\'} \\circ f$. We can also choose $i_\\infty $ such that there are no arrows from $i_\\infty $ to an object in $\\mathcal{F}$. This is possible since we may always post-compose the arrows $f_ i$ with an arrow which is the identity on the $\\mathcal{I}$-component and strictly increasing on the $\\omega $-component. Now let $\\mathcal{F}^+$ denote the category consisting of all objects and arrows in $\\mathcal{F}$ together with the object $i_\\infty $, the identity arrow $\\text{id}_{i_\\infty }$ and the arrows $f_ i$. Since there are no arrows from $i_\\infty $ in $\\mathcal{F}^+$ to any object of $\\mathcal{F}$, the arrow set in $\\mathcal{F}^+$ is closed under composition, so $\\mathcal{F}^+$ is indeed a category. By construction, it is a finitely generated subcategory of $\\mathcal{I}$ which has $i_\\infty $ as unique final object. Since, by Lemma 4.17.2 [[\n  Lemma 4.17.2. Let $H : \\mathcal{I} \\to \\mathcal{J}$ be a functor of categories. Assume $\\mathcal{I}$ is cofinal in $\\mathcal{J}$. Then for every diagram $M : \\mathcal{J} \\to \\mathcal{C}$ we have a canonical isomorphism \n  \n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} M \\circ H = \\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {J} M  \\]\n\n   if either side exists. \n\n    \n]], the colimit of any diagram $M : \\mathcal{I} \\to \\mathcal{C}$ coincides with the colimit of $M\\circ \\Pi $ , this gives the desired reduction. \n    \n      The set of all finitely generated subcategories of $\\mathcal{I}$ with a unique final object is naturally ordered by inclusion. We take $\\mathcal{I}_0$ to be the category corresponding to this set. We also have a functor $M_0 : \\mathcal{I}_0 \\to \\mathcal{I}$, which takes an arrow $\\mathcal{F} \\subset \\mathcal{F\'}$ in $\\mathcal{I}_0$ to the unique map from the final object of $\\mathcal{F}$ to the final object of $\\mathcal{F}\'$. Given any two finitely generated subcategories of $\\mathcal{I}$, the category generated by these two categories is also finitely generated. By our assumption on $\\mathcal{I}$, it is also contained in a finitely generated subcategory of $\\mathcal{I}$ with a unique final object. This shows that $\\mathcal{I}_0$ is directed. \n    \n      Finally, we verify that $M_0$ is cofinal. Since any object of $\\mathcal{I}$ is the final object in the subcategory consisting of only that object and its identity arrow, the functor $M_0$ is surjective on objects. In particular, Condition (1) of Definition 4.17.1 [[\n  Definition 4.17.1. Let $H : \\mathcal{I} \\to \\mathcal{J}$ be a functor between categories. We say $\\mathcal{I}$ is cofinal in $\\mathcal{J}$ or that $H$ is cofinal if \n  \n  \nfor all $y \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{J})$ there exist an $x \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and a morphism $y \\to H(x)$, and \n\n\ngiven $y \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{J})$, $x, x\' \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{I})$ and morphisms $y \\to H(x)$ and $y \\to H(x\')$ there exist a sequence of morphisms \n\n\n  \\[  x = x_0 \\leftarrow x_1 \\rightarrow x_2 \\leftarrow x_3 \\rightarrow \\ldots \\rightarrow x_{2n} = x\'  \\]\n\n\n in $\\mathcal{I}$ and morphisms $y \\to H(x_ i)$ in $\\mathcal{J}$ with $y \\to H(x_0)$ and $y \\to H(x_{2n})$ the given morphisms such that the diagrams \n\n\n  \\[  \\xymatrix{ &  y \\ar[ld] \\ar[d] \\ar[rd] \\\\  H(x_{2k}) &  H(x_{2k + 1}) \\ar[l] \\ar[r] &  H(x_{2k + 2}) }  \\]\n\n\n commute for $k = 0, \\ldots , n - 1$. \n\n\n\n   In other words, fixing an object $y$ of $\\mathcal{J}$ consider the set $S$ of pairs $(x, b)$ where $x$ is an object of $\\mathcal{I}$ and $b : y \\to H(x)$ is a morphism. Consider the equivalence relation on $S$ generated by $(x, b) \\sim (x\', b\')$ if there exists a morphism $a : x \\to x\'$ with $b\' = H(a) \\circ b$. Then $S$ should consist of exactly one equivalence class. \n]] is satisfied. Given an object $i$ of $\\mathcal{I}$, objects $\\mathcal{F}_1, \\mathcal{F}_2$ in $\\mathcal{I}_0$ and maps $\\varphi _1 : i \\to M_0(\\mathcal{F}_1)$ and $\\varphi _2 : i \\to M_0(\\mathcal{F}_2)$ in $\\mathcal{I}$, we can take $\\mathcal{F}_{12}$ to be a finitely generated category with a unique final object containing $\\mathcal{F}_1$, $\\mathcal{F}_2$ and the morphisms $\\varphi _1, \\varphi _2$. The resulting diagram commutes \n    \n      \n  \\[  \\xymatrix{ &  M_0(\\mathcal{F}_{12}) &  \\\\  M_0(\\mathcal{F}_{1}) \\ar[ru] &  &  M_0(\\mathcal{F}_{2}) \\ar[lu] \\\\  &  i \\ar[lu] \\ar[ru] }  \\]\n\n    \n       since it lives in the category $\\mathcal{F}_{12}$ and $M_0(\\mathcal{F}_{12})$ is final in this category. Hence also Condition (2) is satisfied, which concludes the proof. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about extracting a directed/filtered structure indexed by a cardinal (using `IsCardinalFiltered.exists_cardinal_directed J .aleph0` and `isCardinalFiltered_aleph0_iff`) and then packaging data ‚ü®Œ±, ‚Ä¶, F, ‚Ä¶‚ü©. This corresponds only loosely to the informal proof‚Äôs goal of replacing a filtered category by a cofinal directed poset/category to compare (co)limits. The informal proof crucially constructs an explicit directed category I‚ÇÄ of finitely generated subcategories with a final object and proves a functor M‚ÇÄ : I‚ÇÄ ‚Üí I is cofinal, then applies a cofinality lemma to identify colimits. None of that explicit construction, cofinality verification, or colimit comparison appears in the Lean code.\n\nStructurally, the informal argument is multi-step (reduce via I√óœâ, build cocones/final objects, define I‚ÇÄ, prove directedness, prove cofinality, then apply Lemma 4.17.2). The Lean proof is a short instance-extraction/exists lemma application with no analogous intermediate constructions or cofinality/colimit reasoning. Thus there is at best partial thematic overlap (filteredness/directedness), but major components of the informal proof are missing, so alignment is low.""}"
106,0BSI,"lemma IsStableUnderComposition.ind_of_preIndSpreads
    [‚àÄ X : C, (IsFinitelyAccessibleCategory.{w} (Under X))] [HasPushouts C]
    [P.IsStableUnderComposition] [P.IsStableUnderCobaseChange]
    [PreIndSpreads.{w} P] (H : P ‚â§ isFinitelyPresentable.{w} C) :
    (ind.{w} P).IsStableUnderComposition where
  comp_mem {X Y Z} f g hf hg := by
    rw [ind_iff_exists H]
    intro T p u hp hpu
    obtain ‚ü®J‚ÇÅ, _, _, D‚ÇÅ, s‚ÇÅ, t‚ÇÅ, ht‚ÇÅ, h‚ÇÅ‚ü© := hf
    obtain ‚ü®J‚ÇÇ, _, _, D‚ÇÇ, s‚ÇÇ, t‚ÇÇ, ht‚ÇÇ, h‚ÇÇ‚ü© := hg
    have : IsFinitelyPresentable (CategoryTheory.Under.mk p) := hp
    obtain ‚ü®j‚ÇÇ, q, hcomp, hu‚ü© := IsFinitelyPresentable.exists_hom_of_isColimit_under
        ht‚ÇÇ p ((Functor.const _).map f ‚â´ s‚ÇÇ) u <| by simp [h‚ÇÇ, hpu]
    obtain ‚ü®j‚ÇÅ, W, f', g', h, hf'‚ü© :=
      P.exists_isPushout_of_isFiltered ht‚ÇÅ (s‚ÇÇ.app j‚ÇÇ) (h‚ÇÇ j‚ÇÇ).left
    let D' : Under j‚ÇÅ ‚•§ C :=
      (Under.post D‚ÇÅ ‚ãô Under.pushout f') ‚ãô CategoryTheory.Under.forget _
    let c' : Cocone D' :=
      (Under.pushout f' ‚ãô CategoryTheory.Under.forget _).mapCocone
        ((Cocone.mk _ t‚ÇÅ).underPost j‚ÇÅ) |>.extend h.isoPushout.inv
    let hc' : IsColimit c' :=
      IsColimit.extendIso _ <| isColimitOfPreserves _ (ht‚ÇÅ.underPost j‚ÇÅ)
    let s' : (Functor.const (Under j‚ÇÅ)).obj X ‚ü∂ D' :=
      { app k := s‚ÇÅ.app k.right ‚â´ pushout.inl _ _
        naturality k l a := by
          have h2 := s‚ÇÅ.naturality a.right
          simp only [Functor.const_obj_obj, Functor.const_obj_map, Category.id_comp] at h2
          simp [h2, D'] }
    obtain ‚ü®j‚ÇÉ, v, hcomp', hq‚ü© := IsFinitelyPresentable.exists_hom_of_isColimit_under
        hc' p s' q <| fun k ‚Ü¶ by
      simp [c', s', hcomp, reassoc_of% (h‚ÇÅ k.right).right]
    refine ‚ü®D'.obj j‚ÇÉ, v, c'.Œπ.app j‚ÇÉ ‚â´ t‚ÇÇ.app j‚ÇÇ, ?_, ?_‚ü©
    ¬∑ rwa [reassoc_of% hq]
    ¬∑ rw [hcomp']
      exact P.comp_mem _ _ (h‚ÇÅ _).left (P.pushout_inl _ _ hf')
",Formal Proof of Stacks Project Tag 0BSI,The stacks project lemma is for the special case of ind-√©tale ring homomorphisms.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/MorphismProperty/Ind.lean#L182-L216,Q27041,,10.154.2,lemma,3.0,"['0BSG', '00AO', '0ELQ']","\n  Lemma 10.154.2. Let $A \\to B \\to C$ be ring maps. If $A \\to B$ is a filtered colimit of \xc3\xa9tale ring maps and $B \\to C$ is a filtered colimit of \xc3\xa9tale ring maps, then $A \\to C$ is a filtered colimit of \xc3\xa9tale ring maps. \n\n    \n      Proof.\n      We will use the criterion of Lemma 10.127.4. Let $A \\to P \\to C$ be a factorization of $A \\to C$ with $P$ of finite presentation over $A$. Write $B = \\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} B_ i$ where $I$ is a directed set and where $B_ i$ is an \xc3\xa9tale $A$-algebra. Write $C = \\mathop{\\mathrm{colim}}\\nolimits _{j \\in J} C_ j$ where $J$ is a directed set and where $C_ j$ is an \xc3\xa9tale $B$-algebra. We can factor $P \\to C$ as $P \\to C_ j \\to C$ for some $j$ by Lemma 10.127.3. By Lemma 10.143.3 we can find an $i \\in I$ and an \xc3\xa9tale ring map $B_ i \\to C\'_ j$ such that $C_ j = B \\otimes _{B_ i} C\'_ j$. Then $C_ j = \\mathop{\\mathrm{colim}}\\nolimits _{i\' \\geq i} B_{i\'} \\otimes _{B_ i} C\'_ j$ and again we see that $P \\to C_ j$ factors as $P \\to B_{i\'} \\otimes _{B_ i} C\'_ j \\to C$. As $A \\to C\' = B_{i\'} \\otimes _{B_ i} C\'_ j$ is \xc3\xa9tale as compositions and tensor products of \xc3\xa9tale ring maps are \xc3\xa9tale. Hence we have factored $P \\to C$ as $P \\to C\' \\to C$ with $C\'$ \xc3\xa9tale over $A$ and the criterion of Lemma 10.127.4 applies. \n      $\\square$\n    \n","\n  Lemma 10.154.2. Let $A \\to B \\to C$ be ring maps. If $A \\to B$ is a filtered colimit of \xc3\xa9tale ring maps and $B \\to C$ is a filtered colimit of \xc3\xa9tale ring maps, then $A \\to C$ is a filtered colimit of \xc3\xa9tale ring maps. \n\n    \n",Proof.\n      We will use the criterion of Lemma 10.127.4. Let $A \\to P \\to C$ be a factorization of $A \\to C$ with $P$ of finite presentation over $A$. Write $B = \\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} B_ i$ where $I$ is a directed set and where $B_ i$ is an \xc3\xa9tale $A$-algebra. Write $C = \\mathop{\\mathrm{colim}}\\nolimits _{j \\in J} C_ j$ where $J$ is a directed set and where $C_ j$ is an \xc3\xa9tale $B$-algebra. We can factor $P \\to C$ as $P \\to C_ j \\to C$ for some $j$ by Lemma 10.127.3. By Lemma 10.143.3 we can find an $i \\in I$ and an \xc3\xa9tale ring map $B_ i \\to C\'_ j$ such that $C_ j = B \\otimes _{B_ i} C\'_ j$. Then $C_ j = \\mathop{\\mathrm{colim}}\\nolimits _{i\' \\geq i} B_{i\'} \\otimes _{B_ i} C\'_ j$ and again we see that $P \\to C_ j$ factors as $P \\to B_{i\'} \\otimes _{B_ i} C\'_ j \\to C$. As $A \\to C\' = B_{i\'} \\otimes _{B_ i} C\'_ j$ is \xc3\xa9tale as compositions and tensor products of \xc3\xa9tale ring maps are \xc3\xa9tale. Hence we have factored $P \\to C$ as $P \\to C\' \\to C$ with $C\'$ \xc3\xa9tale over $A$ and the criterion of Lemma 10.127.4 applies. \n      $\\square$\n    \n," by
    rw [ind_iff_exists H]
    intro T p u hp hpu
    obtain ‚ü®J‚ÇÅ, _, _, D‚ÇÅ, s‚ÇÅ, t‚ÇÅ, ht‚ÇÅ, h‚ÇÅ‚ü© := hf
    obtain ‚ü®J‚ÇÇ, _, _, D‚ÇÇ, s‚ÇÇ, t‚ÇÇ, ht‚ÇÇ, h‚ÇÇ‚ü© := hg
    have : IsFinitelyPresentable (CategoryTheory.Under.mk p) := hp
    obtain ‚ü®j‚ÇÇ, q, hcomp, hu‚ü© := IsFinitelyPresentable.exists_hom_of_isColimit_under
        ht‚ÇÇ p ((Functor.const _).map f ‚â´ s‚ÇÇ) u <| by simp [h‚ÇÇ, hpu]
    obtain ‚ü®j‚ÇÅ, W, f', g', h, hf'‚ü© :=
      P.exists_isPushout_of_isFiltered ht‚ÇÅ (s‚ÇÇ.app j‚ÇÇ) (h‚ÇÇ j‚ÇÇ).left
    let D' : Under j‚ÇÅ ‚•§ C :=
      (Under.post D‚ÇÅ ‚ãô Under.pushout f') ‚ãô CategoryTheory.Under.forget _
    let c' : Cocone D' :=
      (Under.pushout f' ‚ãô CategoryTheory.Under.forget _).mapCocone
        ((Cocone.mk _ t‚ÇÅ).underPost j‚ÇÅ) |>.extend h.isoPushout.inv
    let hc' : IsColimit c' :=
      IsColimit.extendIso _ <| isColimitOfPreserves _ (ht‚ÇÅ.underPost j‚ÇÅ)
    let s' : (Functor.const (Under j‚ÇÅ)).obj X ‚ü∂ D' :=
      { app k := s‚ÇÅ.app k.right ‚â´ pushout.inl _ _
        naturality k l a := by
          have h2 := s‚ÇÅ.naturality a.right
          simp only [Functor.const_obj_obj, Functor.const_obj_map, Category.id_comp] at h2
          simp [h2, D'] }
    obtain ‚ü®j‚ÇÉ, v, hcomp', hq‚ü© := IsFinitelyPresentable.exists_hom_of_isColimit_under
        hc' p s' q <| fun k ‚Ü¶ by
      simp [c', s', hcomp, reassoc_of% (h‚ÇÅ k.right).right]
    refine ‚ü®D'.obj j‚ÇÉ, v, c'.Œπ.app j‚ÇÉ ‚â´ t‚ÇÇ.app j‚ÇÇ, ?_, ?_‚ü©
    ¬∑ rwa [reassoc_of% hq]
    ¬∑ rw [hcomp']
      exact P.comp_mem _ _ (h‚ÇÅ _).left (P.pushout_inl _ _ hf')
","lemma IsStableUnderComposition.ind_of_preIndSpreads
    [‚àÄ X : C, (IsFinitelyAccessibleCategory.{w} (Under X))] [HasPushouts C]
    [P.IsStableUnderComposition] [P.IsStableUnderCobaseChange]
    [PreIndSpreads.{w} P] (H : P ‚â§ isFinitelyPresentable.{w} C) :
    (ind.{w} P).IsStableUnderComposition where
  comp_mem {X Y Z} f g hf hg ","Proof.\n      We will use the criterion of Lemma 10.127.4 [[\n  Lemma 10.127.4. Let $R \\to \\Lambda $ be a ring map. Let $\\mathcal{E}$ be a set of $R$-algebras such that each $A \\in \\mathcal{E}$ is of finite presentation over $R$. Then the following two statements are equivalent \n  \n  \n$\\Lambda $ is a filtered colimit of elements of $\\mathcal{E}$, and \n\n\nfor any $R$ algebra map $A \\to \\Lambda $ with $A$ of finite presentation over $R$ we can find a factorization $A \\to B \\to \\Lambda $ with $B \\in \\mathcal{E}$. \n\n\n\n\n    \n]]. Let $A \\to P \\to C$ be a factorization of $A \\to C$ with $P$ of finite presentation over $A$. Write $B = \\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} B_ i$ where $I$ is a directed set and where $B_ i$ is an \xc3\xa9tale $A$-algebra. Write $C = \\mathop{\\mathrm{colim}}\\nolimits _{j \\in J} C_ j$ where $J$ is a directed set and where $C_ j$ is an \xc3\xa9tale $B$-algebra. We can factor $P \\to C$ as $P \\to C_ j \\to C$ for some $j$ by Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]]. By Lemma 10.143.3 [[\n  Lemma 10.143.3. Results on \xc3\xa9tale ring maps. \n  \n  \nThe ring map $R \\to R_ f$ is \xc3\xa9tale for any ring $R$ and any $f \\in R$. \n\n\nCompositions of \xc3\xa9tale ring maps are \xc3\xa9tale. \n\n\nA base change of an \xc3\xa9tale ring map is \xc3\xa9tale. \n\n\nThe property of being \xc3\xa9tale is local: Given a ring map $R \\to S$ and elements $g_1, \\ldots , g_ m \\in S$ which generate the unit ideal such that $R \\to S_{g_ j}$ is \xc3\xa9tale for $j = 1, \\ldots , m$ then $R \\to S$ is \xc3\xa9tale. \n\n\nGiven $R \\to S$ of finite presentation, and a flat ring map $R \\to R\'$, set $S\' = R\' \\otimes _ R S$. The set of primes where $R\' \\to S\'$ is \xc3\xa9tale is the inverse image via $\\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$ of the set of primes where $R \\to S$ is \xc3\xa9tale. \n\n\nAn \xc3\xa9tale ring map is syntomic, in particular flat. \n\n\nIf $S$ is finite type over a field $k$, then $S$ is \xc3\xa9tale over $k$ if and only if $\\Omega _{S/k} = 0$. \n\n\nAny \xc3\xa9tale ring map $R \\to S$ is the base change of an \xc3\xa9tale ring map $R_0 \\to S_0$ with $R_0$ of finite type over $\\mathbf{Z}$. \n\n\nLet $A = \\mathop{\\mathrm{colim}}\\nolimits A_ i$ be a filtered colimit of rings. Let $A \\to B$ be an \xc3\xa9tale ring map. Then there exists an \xc3\xa9tale ring map $A_ i \\to B_ i$ for some $i$ such that $B \\cong A \\otimes _{A_ i} B_ i$. \n\n\nLet $A$ be a ring. Let $S$ be a multiplicative subset of $A$. Let $S^{-1}A \\to B\'$ be \xc3\xa9tale. Then there exists an \xc3\xa9tale ring map $A \\to B$ such that $B\' \\cong S^{-1}B$. \n\n\nLet $A$ be a ring. Let $B = B\' \\times B\'\'$ be a product of $A$-algebras. Then $B$ is \xc3\xa9tale over $A$ if and only if both $B\'$ and $B\'\'$ are \xc3\xa9tale over $A$. \n\n\n\n\n    \n]] we can find an $i \\in I$ and an \xc3\xa9tale ring map $B_ i \\to C\'_ j$ such that $C_ j = B \\otimes _{B_ i} C\'_ j$. Then $C_ j = \\mathop{\\mathrm{colim}}\\nolimits _{i\' \\geq i} B_{i\'} \\otimes _{B_ i} C\'_ j$ and again we see that $P \\to C_ j$ factors as $P \\to B_{i\'} \\otimes _{B_ i} C\'_ j \\to C$. As $A \\to C\' = B_{i\'} \\otimes _{B_ i} C\'_ j$ is \xc3\xa9tale as compositions and tensor products of \xc3\xa9tale ring maps are \xc3\xa9tale. Hence we have factored $P \\to C$ as $P \\to C\' \\to C$ with $C\'$ \xc3\xa9tale over $A$ and the criterion of Lemma 10.127.4 [[\n  Lemma 10.127.4. Let $R \\to \\Lambda $ be a ring map. Let $\\mathcal{E}$ be a set of $R$-algebras such that each $A \\in \\mathcal{E}$ is of finite presentation over $R$. Then the following two statements are equivalent \n  \n  \n$\\Lambda $ is a filtered colimit of elements of $\\mathcal{E}$, and \n\n\nfor any $R$ algebra map $A \\to \\Lambda $ with $A$ of finite presentation over $R$ we can find a factorization $A \\to B \\to \\Lambda $ with $B \\in \\mathcal{E}$. \n\n\n\n\n    \n]] applies. \n      $\\square$\n    \n","Proof.\n      We will use the criterion of Lemma 10.127.4 [[\n  Lemma 10.127.4. Let $R \\to \\Lambda $ be a ring map. Let $\\mathcal{E}$ be a set of $R$-algebras such that each $A \\in \\mathcal{E}$ is of finite presentation over $R$. Then the following two statements are equivalent \n  \n  \n$\\Lambda $ is a filtered colimit of elements of $\\mathcal{E}$, and \n\n\nfor any $R$ algebra map $A \\to \\Lambda $ with $A$ of finite presentation over $R$ we can find a factorization $A \\to B \\to \\Lambda $ with $B \\in \\mathcal{E}$. \n\n\n\n\n    \n]]. Let $A \\to P \\to C$ be a factorization of $A \\to C$ with $P$ of finite presentation over $A$. Write $B = \\mathop{\\mathrm{colim}}\\nolimits _{i \\in I} B_ i$ where $I$ is a directed set and where $B_ i$ is an \xc3\xa9tale $A$-algebra. Write $C = \\mathop{\\mathrm{colim}}\\nolimits _{j \\in J} C_ j$ where $J$ is a directed set and where $C_ j$ is an \xc3\xa9tale $B$-algebra. We can factor $P \\to C$ as $P \\to C_ j \\to C$ for some $j$ by Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]]. By Lemma 10.143.3 [[\n  Lemma 10.143.3. Results on \xc3\xa9tale ring maps. \n  \n  \nThe ring map $R \\to R_ f$ is \xc3\xa9tale for any ring $R$ and any $f \\in R$. \n\n\nCompositions of \xc3\xa9tale ring maps are \xc3\xa9tale. \n\n\nA base change of an \xc3\xa9tale ring map is \xc3\xa9tale. \n\n\nThe property of being \xc3\xa9tale is local: Given a ring map $R \\to S$ and elements $g_1, \\ldots , g_ m \\in S$ which generate the unit ideal such that $R \\to S_{g_ j}$ is \xc3\xa9tale for $j = 1, \\ldots , m$ then $R \\to S$ is \xc3\xa9tale. \n\n\nGiven $R \\to S$ of finite presentation, and a flat ring map $R \\to R\'$, set $S\' = R\' \\otimes _ R S$. The set of primes where $R\' \\to S\'$ is \xc3\xa9tale is the inverse image via $\\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$ of the set of primes where $R \\to S$ is \xc3\xa9tale. \n\n\nAn \xc3\xa9tale ring map is syntomic, in particular flat. \n\n\nIf $S$ is finite type over a field $k$, then $S$ is \xc3\xa9tale over $k$ if and only if $\\Omega _{S/k} = 0$. \n\n\nAny \xc3\xa9tale ring map $R \\to S$ is the base change of an \xc3\xa9tale ring map $R_0 \\to S_0$ with $R_0$ of finite type over $\\mathbf{Z}$. \n\n\nLet $A = \\mathop{\\mathrm{colim}}\\nolimits A_ i$ be a filtered colimit of rings. Let $A \\to B$ be an \xc3\xa9tale ring map. Then there exists an \xc3\xa9tale ring map $A_ i \\to B_ i$ for some $i$ such that $B \\cong A \\otimes _{A_ i} B_ i$. \n\n\nLet $A$ be a ring. Let $S$ be a multiplicative subset of $A$. Let $S^{-1}A \\to B\'$ be \xc3\xa9tale. Then there exists an \xc3\xa9tale ring map $A \\to B$ such that $B\' \\cong S^{-1}B$. \n\n\nLet $A$ be a ring. Let $B = B\' \\times B\'\'$ be a product of $A$-algebras. Then $B$ is \xc3\xa9tale over $A$ if and only if both $B\'$ and $B\'\'$ are \xc3\xa9tale over $A$. \n\n\n\n\n    \n]] we can find an $i \\in I$ and an \xc3\xa9tale ring map $B_ i \\to C\'_ j$ such that $C_ j = B \\otimes _{B_ i} C\'_ j$. Then $C_ j = \\mathop{\\mathrm{colim}}\\nolimits _{i\' \\geq i} B_{i\'} \\otimes _{B_ i} C\'_ j$ and again we see that $P \\to C_ j$ factors as $P \\to B_{i\'} \\otimes _{B_ i} C\'_ j \\to C$. As $A \\to C\' = B_{i\'} \\otimes _{B_ i} C\'_ j$ is \xc3\xa9tale as compositions and tensor products of \xc3\xa9tale ring maps are \xc3\xa9tale. Hence we have factored $P \\to C$ as $P \\to C\' \\to C$ with $C\'$ \xc3\xa9tale over $A$ and the criterion of Lemma 10.127.4 [[\n  Lemma 10.127.4. Let $R \\to \\Lambda $ be a ring map. Let $\\mathcal{E}$ be a set of $R$-algebras such that each $A \\in \\mathcal{E}$ is of finite presentation over $R$. Then the following two statements are equivalent \n  \n  \n$\\Lambda $ is a filtered colimit of elements of $\\mathcal{E}$, and \n\n\nfor any $R$ algebra map $A \\to \\Lambda $ with $A$ of finite presentation over $R$ we can find a factorization $A \\to B \\to \\Lambda $ with $B \\in \\mathcal{E}$. \n\n\n\n\n    \n]] applies. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: The stacks project lemma is for the special case of ind-√©tale ring homomorphisms.","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about an abstract categorical ‚Äúind‚Äù criterion expressed via `ind_iff_exists H` and finite presentability in an `Under` category, using existence of factorisations through some stage of a filtered colimit (`IsFinitelyPresentable.exists_hom_of_isColimit_under`) and then constructing a pushout diagram (`exists_isPushout_of_isFiltered`, `Under.pushout`) to produce the required object and morphisms. This matches only the very high-level pattern of the informal proof: use a finite-presentation/filtered-colimit criterion to factor a map through some stage.\n\nHowever, the informal proof is specifically about ind-√©tale ring maps and uses concrete ring-theoretic lemmas: writing B and C as filtered colimits of √©tale algebras, factoring P‚ÜíC through some C_j, then descending √©taleness along a filtered colimit/base change to get an √©tale A-algebra C‚Ä≤ and applying the Stacks criterion. None of the √©tale-specific content (√©tale stability under base change/composition, the two-step colimit B_i then C_j, or the explicit ring constructions) appears in the Lean proof; instead it uses generic categorical pushout machinery and under-category colimit arguments.\n\nStructurally, both proofs use a criterion-equivalence and then a sequence of factorisations through colimit stages, but the Lean proof‚Äôs core step is a pushout construction in a filtered setting, which has no clear counterpart in the informal argument‚Äôs √©tale descent/base-change step. Thus the alignment is partial at the level of ‚Äúfiltered colimit + finite presentability implies factorisation,‚Äù but weak regarding the specific ind-√©tale ring-homomorphism reasoning.""}"
110,00Z9,"proof (see the Stacks comments).""]
def finestTopologySingle (P : C·µí·µñ ‚•§ Type v) : GrothendieckTopology C where
  sieves X S := ‚àÄ (Y) (f : Y ‚ü∂ X), Presieve.IsSheafFor P (S.pullback f : Presieve Y)
  top_mem' X Y f := by
    rw [Sieve.pullback_top]
    exact Presieve.isSheafFor_top_sieve P
  pullback_stable' X Y S f hS Z g := by
    rw [‚Üê pullback_comp]
    apply hS
  transitive' X S hS R hR Z g := by
    -- This is the hard part of the construction, showing that the given set of sieves satisfies
    -- the transitivity axiom.
    refine isSheafFor_trans P (pullback g S) _ (hS Z g) ?_ ?_
    ¬∑ intro Y f _
      rw [‚Üê pullback_comp]
      apply (hS _ _).isSeparatedFor
    ¬∑ intro Y f hf
      have := hR hf _ (ùüô _)
      rw [pullback_id, pullback_comp] at this
      apply this
",Formal Proof of Stacks Project Tag 00Z9,"This is a special case of the Stacks entry, but following a differen",https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/Canonical.lean#L145-L164,Q27041,,7.47.11,lemma,3.0,"['00YW', '00UZ', '0ELQ']","\n  Lemma 7.47.11. Let $\\mathcal{C}$ be a category. Let $\\{  \\mathcal{F}_ i \\} _{i\\in I}$ be a collection of presheaves of sets on $\\mathcal{C}$. For each $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ denote $J(U)$ the set of sieves $S$ with the following property: For every morphism $V \\to U$, the maps \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ V, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U V, \\mathcal{F}_ i)  \\]\n\n   are bijective for all $i \\in I$. Then $J$ defines a topology on $\\mathcal{C}$. This topology is the finest topology in which all of the $\\mathcal{F}_ i$ are sheaves. \n\n    \n      Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n","\n  Lemma 7.47.11. Let $\\mathcal{C}$ be a category. Let $\\{  \\mathcal{F}_ i \\} _{i\\in I}$ be a collection of presheaves of sets on $\\mathcal{C}$. For each $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ denote $J(U)$ the set of sieves $S$ with the following property: For every morphism $V \\to U$, the maps \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ V, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U V, \\mathcal{F}_ i)  \\]\n\n   are bijective for all $i \\in I$. Then $J$ defines a topology on $\\mathcal{C}$. This topology is the finest topology in which all of the $\\mathcal{F}_ i$ are sheaves. \n\n    \n","Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n"," ‚àÄ (Y) (f : Y ‚ü∂ X), Presieve.IsSheafFor P (S.pullback f : Presieve Y)
  top_mem' X Y f := by
    rw [Sieve.pullback_top]
    exact Presieve.isSheafFor_top_sieve P
  pullback_stable' X Y S f hS Z g := by
    rw [‚Üê pullback_comp]
    apply hS
  transitive' X S hS R hR Z g := by
    -- This is the hard part of the construction, showing that the given set of sieves satisfies
    -- the transitivity axiom.
    refine isSheafFor_trans P (pullback g S) _ (hS Z g) ?_ ?_
    ¬∑ intro Y f _
      rw [‚Üê pullback_comp]
      apply (hS _ _).isSeparatedFor
    ¬∑ intro Y f hf
      have := hR hf _ (ùüô _)
      rw [pullback_id, pullback_comp] at this
      apply this
","proof (see the Stacks comments).""]
def finestTopologySingle (P : C·µí·µñ ‚•§ Type v) : GrothendieckTopology C where
  sieves X S ","Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n","Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: This is a special case of the Stacks entry, but following a differen","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs are establishing the transitivity axiom for a Grothendieck topology defined via a sheaf condition: given S covering U and a sieve R such that all pullbacks of R along arrows in S are covering, conclude R is covering. The Lean proof‚Äôs `transitive'` block does exactly this by invoking a general lemma `isSheafFor_trans` for presheaf sheaf conditions on pullbacks, using (1) separatedness coming from `hS Z g` and (2) the hypothesis `hR` specialized to `ùüô _` after rewriting pullback identities. Structurally, the informal proof constructs a section by gluing: restrict œÜ along arrows in `S √ó_U W`, use that each `S' √ó_U V` is covering to get local sections, assemble a matching family œà on `S √ó_U W`, then use that S is covering to descend to a global section, and finally check bijectivity. The Lean proof compresses this construction into the abstract lemma `isSheafFor_trans` rather than explicitly building the glued section, so it matches the logical content but not the step-by-step construction. No obvious extraneous content appears beyond the other topology axioms (`top_mem'`, `pullback_stable'`) which the informal text says are immediate.""}"
111,00Z9,"def finestTopology (Ps : Set (C·µí·µñ ‚•§ Type v)) : GrothendieckTopology C :=
  sInf (finestTopologySingle '' Ps)
",Formal Proof of Stacks Project Tag 00Z9,Equal to that Stacks construction,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/Canonical.lean#L169-L170,Q27041,,7.47.11,lemma,3.0,"['00YW', '00UZ', '0ELQ']","\n  Lemma 7.47.11. Let $\\mathcal{C}$ be a category. Let $\\{  \\mathcal{F}_ i \\} _{i\\in I}$ be a collection of presheaves of sets on $\\mathcal{C}$. For each $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ denote $J(U)$ the set of sieves $S$ with the following property: For every morphism $V \\to U$, the maps \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ V, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U V, \\mathcal{F}_ i)  \\]\n\n   are bijective for all $i \\in I$. Then $J$ defines a topology on $\\mathcal{C}$. This topology is the finest topology in which all of the $\\mathcal{F}_ i$ are sheaves. \n\n    \n      Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n","\n  Lemma 7.47.11. Let $\\mathcal{C}$ be a category. Let $\\{  \\mathcal{F}_ i \\} _{i\\in I}$ be a collection of presheaves of sets on $\\mathcal{C}$. For each $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ denote $J(U)$ the set of sieves $S$ with the following property: For every morphism $V \\to U$, the maps \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ V, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U V, \\mathcal{F}_ i)  \\]\n\n   are bijective for all $i \\in I$. Then $J$ defines a topology on $\\mathcal{C}$. This topology is the finest topology in which all of the $\\mathcal{F}_ i$ are sheaves. \n\n    \n","Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n","
  sInf (finestTopologySingle '' Ps)
",def finestTopology (Ps : Set (C·µí·µñ ‚•§ Type v)) : GrothendieckTopology C ,"Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n","Proof.\n      If we show that $J$ is a topology, then the last statement of the lemma immediately follows. The first and third axioms of a topology are immediately verified. Thus, assume that we have an object $U$, and sieves $S, S\'$ of $U$ such that $S \\in J(U)$, and for all $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. We have to show that $S\' \\in J(U)$. In other words, we have to show that for any $f : W \\to U$, the maps \n    \n      \n  \\[  \\mathcal{F}_ i(W) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ W, \\mathcal{F}_ i) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)  \\]\n\n    \n       are bijective for all $i \\in I$. Pick an element $i \\in I$ and pick an element $\\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S\' \\times _ U W, \\mathcal{F}_ i)$. We will construct a section $s \\in \\mathcal{F}_ i(W)$ mapping to $\\varphi $. \n    \n      Suppose $\\alpha : V \\to W$ is an element of $S \\times _ U W$. According to the definition of pullbacks we see that the composition $f \\circ \\alpha : V \\to W \\to U$ is in $S$. Hence $S\' \\times _ U V$ is in $J(W)$ by assumption on the pair of sieves $S, S\'$. Now we have a commutative diagram of presheaves \n    \n      \n  \\[  \\xymatrix{ S\' \\times _ U V \\ar[r] \\ar[d] &  h_ V \\ar[d] \\\\  S\' \\times _ U W \\ar[r] &  h_ W }  \\]\n\n    \n       The restriction of $\\varphi $ to $S\' \\times _ U V$ corresponds to an element $s_{V, \\alpha } \\in \\mathcal{F}_ i(V)$. This we see from the definition of $J$, and because $S\' \\times _ U V$ is in $J(W)$. We leave it to the reader to check that the rule $(V, \\alpha ) \\mapsto s_{V, \\alpha }$ defines an element $\\psi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S \\times _ U W, \\mathcal{F}_ i)$. Since $S \\in J(U)$ we see immediately from the definition of $J$ that $\\psi $ corresponds to an element $s$ of $\\mathcal{F}_ i(W)$. \n    \n      We leave it to the reader to verify that the construction $\\varphi \\mapsto s$ is inverse to the natural map displayed above. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Equal to that Stacks construction","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is a substantial argument showing that a certain Grothendieck topology J satisfies the axioms (in particular the transitivity axiom) by proving a bijectivity/sheaf condition for pullback sieves and constructing sections via restriction and gluing. The formal_proof, however, is just the Lean term `sInf (finestTopologySingle '' Ps)`, i.e. an expression denoting the infimum of a set of topologies generated from `Ps`, with no proof steps, no verification of topology axioms, and no correspondence to the sieve/gluing argument. Structurally there is no match: the informal proof proceeds by assuming S ‚àà J(U), pullback conditions, constructing œà and s, and checking inverses, whereas the Lean snippet contains neither hypotheses nor a theorem statement nor any construction. At best it names an object that might coincide with the Stacks construction, but it does not formalize the proof given. Hence the alignment is essentially absent.""}"
113,00XK,"that `C` and `D` have pullbacks.""]
theorem ran_isSheaf_of_isCocontinuous (‚Ñ± : Sheaf J A) :
    Presheaf.IsSheaf K (G.op.ran.obj ‚Ñ±.val) := by
  rw [Presheaf.isSheaf_iff_multifork]
  intro X S
  exact ‚ü®RanIsSheafOfIsCocontinuous.isLimitMultifork ‚Ñ±.2
    (G.op.isPointwiseRightKanExtensionRanCounit ‚Ñ±.val) S‚ü©
",Formal Proof of Stacks Project Tag 00XK,"Alternative reference. There, results are obtained under the additional assumptio",https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/CoverLifting.lean#L220-L226,Q27041,,7.20.2,lemma,3.0,"['00XI', '00UZ', '0ELQ']","\n  Lemma 7.20.2. Let $\\mathcal{C}$ and $\\mathcal{D}$ be sites. Let $u : \\mathcal{C} \\to \\mathcal{D}$ be cocontinuous. Let $\\mathcal{F}$ be a sheaf on $\\mathcal{C}$. Then ${}_ pu\\mathcal{F}$ is a sheaf on $\\mathcal{D}$, which we will denote ${}_ su\\mathcal{F}$. \n\n    \n      Proof.\n      Let $\\{ V_ j \\to V\\} _{j \\in J}$ be a covering of the site $\\mathcal{D}$. We have to show that \n    \n      \n  \\[  \\xymatrix{ & \\  \\phantom{}_ pu\\mathcal{F}(V) \\ar[r] &  \\prod {}_ pu\\mathcal{F}(V_ j) \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\prod {}_ pu\\mathcal{F}(V_ j \\times _ V V_{j\'}) &  }  \\]\n\n    \n       is an equalizer diagram. Since ${}_ pu$ is right adjoint to $u^ p$ we have \n    \n      \n  \\[  {}_ pu\\mathcal{F}(V) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{D})}(h_ V, {}_ pu\\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(u^ ph_ V, \\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})}((u^ ph_ V)^\\# , \\mathcal{F})  \\]\n\n    \n       Hence it suffices to show that \n    \n      \n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n\n    \n       becomes a coequalizer diagram after sheafification. (Recall that a coproduct in the category of sheaves is the sheafification of the coproduct in the category of presheaves, see Lemma 7.10.14.) \n    \n      We first show that the second arrow of (7.20.2.1) becomes surjective after sheafification. To do this we use Lemma 7.11.2. Thus it suffices to show a section $s$ of $u^ ph_ V$ over $U$ lifts to a section of $\\coprod u^ p h_{V_ j}$ on the members of a covering of $U$. Note that $s$ is a morphism $s : u(U) \\to V$. Then $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $ is a covering of $\\mathcal{D}$. Hence, as $u$ is cocontinuous, there is a covering $\\{ U_ i \\to U\\} $ such that $\\{ u(U_ i) \\to u(U)\\} $ refines $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $. This means that each restriction $s|_{U_ i} : u(U_ i) \\to V$ factors through a morphism $s_ i : u(U_ i) \\to V_ j$ for some $j$, i.e., $s|_{U_ i}$ is in the image of $u^ ph_{V_ j}(U_ i) \\to u^ ph_ V(U_ i)$ as desired. \n    \n      Let $s, s\' \\in (\\coprod u^ ph_{V_ j})^\\# (U)$ map to the same element of $(u^ ph_ V)^\\# (U)$. To finish the proof of the lemma we show that after replacing $U$ by the members of a covering that $s, s\'$ are the image of the same section of $\\coprod u^ p h_{V_ j \\times _ V V_{j\'}}$ by the two maps of (7.20.2.1). We may first replace $U$ by the members of a covering and assume that $s \\in u^ ph_{V_ j}(U)$ and $s\' \\in u^ ph_{V_{j\'}}(U)$. A second such replacement guarantees that $s$ and $s\'$ have the same image in $u^ ph_ V(U)$ instead of in the sheafification. Hence $s : u(U) \\to V_ j$ and $s\' : u(U) \\to V_{j\'}$ are morphisms of $\\mathcal{D}$ such that \n    \n      \n  \\[  \\xymatrix{ u(U) \\ar[r]_{s\'} \\ar[d]_ s &  V_{j\'} \\ar[d] \\\\  V_ j \\ar[r] &  V }  \\]\n\n    \n       is commutative. Thus we obtain $t = (s, s\') : u(U) \\to V_ j \\times _ V V_{j\'}$, i.e., a section $t \\in u^ ph_{V_ j \\times _ V V_{j\'}}(U)$ which maps to $s, s\'$ as desired. \n      $\\square$\n    \n","\n  Lemma 7.20.2. Let $\\mathcal{C}$ and $\\mathcal{D}$ be sites. Let $u : \\mathcal{C} \\to \\mathcal{D}$ be cocontinuous. Let $\\mathcal{F}$ be a sheaf on $\\mathcal{C}$. Then ${}_ pu\\mathcal{F}$ is a sheaf on $\\mathcal{D}$, which we will denote ${}_ su\\mathcal{F}$. \n\n    \n","Proof.\n      Let $\\{ V_ j \\to V\\} _{j \\in J}$ be a covering of the site $\\mathcal{D}$. We have to show that \n    \n      \n  \\[  \\xymatrix{ & \\  \\phantom{}_ pu\\mathcal{F}(V) \\ar[r] &  \\prod {}_ pu\\mathcal{F}(V_ j) \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\prod {}_ pu\\mathcal{F}(V_ j \\times _ V V_{j\'}) &  }  \\]\n\n    \n       is an equalizer diagram. Since ${}_ pu$ is right adjoint to $u^ p$ we have \n    \n      \n  \\[  {}_ pu\\mathcal{F}(V) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{D})}(h_ V, {}_ pu\\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(u^ ph_ V, \\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})}((u^ ph_ V)^\\# , \\mathcal{F})  \\]\n\n    \n       Hence it suffices to show that \n    \n      \n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n\n    \n       becomes a coequalizer diagram after sheafification. (Recall that a coproduct in the category of sheaves is the sheafification of the coproduct in the category of presheaves, see Lemma 7.10.14.) \n    \n      We first show that the second arrow of (7.20.2.1) becomes surjective after sheafification. To do this we use Lemma 7.11.2. Thus it suffices to show a section $s$ of $u^ ph_ V$ over $U$ lifts to a section of $\\coprod u^ p h_{V_ j}$ on the members of a covering of $U$. Note that $s$ is a morphism $s : u(U) \\to V$. Then $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $ is a covering of $\\mathcal{D}$. Hence, as $u$ is cocontinuous, there is a covering $\\{ U_ i \\to U\\} $ such that $\\{ u(U_ i) \\to u(U)\\} $ refines $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $. This means that each restriction $s|_{U_ i} : u(U_ i) \\to V$ factors through a morphism $s_ i : u(U_ i) \\to V_ j$ for some $j$, i.e., $s|_{U_ i}$ is in the image of $u^ ph_{V_ j}(U_ i) \\to u^ ph_ V(U_ i)$ as desired. \n    \n      Let $s, s\' \\in (\\coprod u^ ph_{V_ j})^\\# (U)$ map to the same element of $(u^ ph_ V)^\\# (U)$. To finish the proof of the lemma we show that after replacing $U$ by the members of a covering that $s, s\'$ are the image of the same section of $\\coprod u^ p h_{V_ j \\times _ V V_{j\'}}$ by the two maps of (7.20.2.1). We may first replace $U$ by the members of a covering and assume that $s \\in u^ ph_{V_ j}(U)$ and $s\' \\in u^ ph_{V_{j\'}}(U)$. A second such replacement guarantees that $s$ and $s\'$ have the same image in $u^ ph_ V(U)$ instead of in the sheafification. Hence $s : u(U) \\to V_ j$ and $s\' : u(U) \\to V_{j\'}$ are morphisms of $\\mathcal{D}$ such that \n    \n      \n  \\[  \\xymatrix{ u(U) \\ar[r]_{s\'} \\ar[d]_ s &  V_{j\'} \\ar[d] \\\\  V_ j \\ar[r] &  V }  \\]\n\n    \n       is commutative. Thus we obtain $t = (s, s\') : u(U) \\to V_ j \\times _ V V_{j\'}$, i.e., a section $t \\in u^ ph_{V_ j \\times _ V V_{j\'}}(U)$ which maps to $s, s\'$ as desired. \n      $\\square$\n    \n"," by
  rw [Presheaf.isSheaf_iff_multifork]
  intro X S
  exact ‚ü®RanIsSheafOfIsCocontinuous.isLimitMultifork ‚Ñ±.2
    (G.op.isPointwiseRightKanExtensionRanCounit ‚Ñ±.val) S‚ü©
","that `C` and `D` have pullbacks.""]
theorem ran_isSheaf_of_isCocontinuous (‚Ñ± : Sheaf J A) :
    Presheaf.IsSheaf K (G.op.ran.obj ‚Ñ±.val) ","Proof.\n      Let $\\{ V_ j \\to V\\} _{j \\in J}$ be a covering of the site $\\mathcal{D}$. We have to show that \n    \n      \n  \\[  \\xymatrix{ & \\  \\phantom{}_ pu\\mathcal{F}(V) \\ar[r] &  \\prod {}_ pu\\mathcal{F}(V_ j) \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\prod {}_ pu\\mathcal{F}(V_ j \\times _ V V_{j\'}) &  }  \\]\n\n    \n       is an equalizer diagram. Since ${}_ pu$ is right adjoint to $u^ p$ we have \n    \n      \n  \\[  {}_ pu\\mathcal{F}(V) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{D})}(h_ V, {}_ pu\\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(u^ ph_ V, \\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})}((u^ ph_ V)^\\# , \\mathcal{F})  \\]\n\n    \n       Hence it suffices to show that \n    \n      \n    7.20.2.1 [[\n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n]]\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n\n    \n       becomes a coequalizer diagram after sheafification. (Recall that a coproduct in the category of sheaves is the sheafification of the coproduct in the category of presheaves, see Lemma 7.10.14 [[\n       \n      \n  Lemma 7.10.14. Let $\\mathcal{F} : \\mathcal{I} \\to \\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})$ be a diagram. Then $\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} \\mathcal{F}$ exists and is the sheafification of the colimit in the category of presheaves. \n\n    \n]].) \n    \n      We first show that the second arrow of (7.20.2.1 [[\n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n]]) becomes surjective after sheafification. To do this we use Lemma 7.11.2 [[\n  Lemma 7.11.2. The injective (resp. surjective) maps defined above are exactly the monomorphisms (resp. epimorphisms) of the category $\\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})$. A map of sheaves is an isomorphism if and only if it is both injective and surjective. \n\n    \n]]. Thus it suffices to show a section $s$ of $u^ ph_ V$ over $U$ lifts to a section of $\\coprod u^ p h_{V_ j}$ on the members of a covering of $U$. Note that $s$ is a morphism $s : u(U) \\to V$. Then $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $ is a covering of $\\mathcal{D}$. Hence, as $u$ is cocontinuous, there is a covering $\\{ U_ i \\to U\\} $ such that $\\{ u(U_ i) \\to u(U)\\} $ refines $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $. This means that each restriction $s|_{U_ i} : u(U_ i) \\to V$ factors through a morphism $s_ i : u(U_ i) \\to V_ j$ for some $j$, i.e., $s|_{U_ i}$ is in the image of $u^ ph_{V_ j}(U_ i) \\to u^ ph_ V(U_ i)$ as desired. \n    \n      Let $s, s\' \\in (\\coprod u^ ph_{V_ j})^\\# (U)$ map to the same element of $(u^ ph_ V)^\\# (U)$. To finish the proof of the lemma we show that after replacing $U$ by the members of a covering that $s, s\'$ are the image of the same section of $\\coprod u^ p h_{V_ j \\times _ V V_{j\'}}$ by the two maps of (7.20.2.1 [[\n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n]]). We may first replace $U$ by the members of a covering and assume that $s \\in u^ ph_{V_ j}(U)$ and $s\' \\in u^ ph_{V_{j\'}}(U)$. A second such replacement guarantees that $s$ and $s\'$ have the same image in $u^ ph_ V(U)$ instead of in the sheafification. Hence $s : u(U) \\to V_ j$ and $s\' : u(U) \\to V_{j\'}$ are morphisms of $\\mathcal{D}$ such that \n    \n      \n  \\[  \\xymatrix{ u(U) \\ar[r]_{s\'} \\ar[d]_ s &  V_{j\'} \\ar[d] \\\\  V_ j \\ar[r] &  V }  \\]\n\n    \n       is commutative. Thus we obtain $t = (s, s\') : u(U) \\to V_ j \\times _ V V_{j\'}$, i.e., a section $t \\in u^ ph_{V_ j \\times _ V V_{j\'}}(U)$ which maps to $s, s\'$ as desired. \n      $\\square$\n    \n","Proof.\n      Let $\\{ V_ j \\to V\\} _{j \\in J}$ be a covering of the site $\\mathcal{D}$. We have to show that \n    \n      \n  \\[  \\xymatrix{ & \\  \\phantom{}_ pu\\mathcal{F}(V) \\ar[r] &  \\prod {}_ pu\\mathcal{F}(V_ j) \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\prod {}_ pu\\mathcal{F}(V_ j \\times _ V V_{j\'}) &  }  \\]\n\n    \n       is an equalizer diagram. Since ${}_ pu$ is right adjoint to $u^ p$ we have \n    \n      \n  \\[  {}_ pu\\mathcal{F}(V) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{D})}(h_ V, {}_ pu\\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(u^ ph_ V, \\mathcal{F}) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})}((u^ ph_ V)^\\# , \\mathcal{F})  \\]\n\n    \n       Hence it suffices to show that \n    \n      \n    7.20.2.1 [[\n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n]]\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n\n    \n       becomes a coequalizer diagram after sheafification. (Recall that a coproduct in the category of sheaves is the sheafification of the coproduct in the category of presheaves, see Lemma 7.10.14 [[\n       \n      \n  Lemma 7.10.14. Let $\\mathcal{F} : \\mathcal{I} \\to \\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})$ be a diagram. Then $\\mathop{\\mathrm{colim}}\\nolimits _\\mathcal {I} \\mathcal{F}$ exists and is the sheafification of the colimit in the category of presheaves. \n\n    \n]].) \n    \n      We first show that the second arrow of (7.20.2.1 [[\n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n]]) becomes surjective after sheafification. To do this we use Lemma 7.11.2 [[\n  Lemma 7.11.2. The injective (resp. surjective) maps defined above are exactly the monomorphisms (resp. epimorphisms) of the category $\\mathop{\\mathit{Sh}}\\nolimits (\\mathcal{C})$. A map of sheaves is an isomorphism if and only if it is both injective and surjective. \n\n    \n]]. Thus it suffices to show a section $s$ of $u^ ph_ V$ over $U$ lifts to a section of $\\coprod u^ p h_{V_ j}$ on the members of a covering of $U$. Note that $s$ is a morphism $s : u(U) \\to V$. Then $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $ is a covering of $\\mathcal{D}$. Hence, as $u$ is cocontinuous, there is a covering $\\{ U_ i \\to U\\} $ such that $\\{ u(U_ i) \\to u(U)\\} $ refines $\\{ V_ j \\times _{V, s} u(U) \\to u(U)\\} $. This means that each restriction $s|_{U_ i} : u(U_ i) \\to V$ factors through a morphism $s_ i : u(U_ i) \\to V_ j$ for some $j$, i.e., $s|_{U_ i}$ is in the image of $u^ ph_{V_ j}(U_ i) \\to u^ ph_ V(U_ i)$ as desired. \n    \n      Let $s, s\' \\in (\\coprod u^ ph_{V_ j})^\\# (U)$ map to the same element of $(u^ ph_ V)^\\# (U)$. To finish the proof of the lemma we show that after replacing $U$ by the members of a covering that $s, s\'$ are the image of the same section of $\\coprod u^ p h_{V_ j \\times _ V V_{j\'}}$ by the two maps of (7.20.2.1 [[\n    7.20.2.1\n  \\begin{equation}  \\label{sites-equation-coequalizer} \\xymatrix{ \\coprod u^ p h_{V_ j \\times _ V V_{j\'}} \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\coprod u^ p h_{V_ j} \\ar[r] &  u^ p h_ V } \\end{equation}\n]]). We may first replace $U$ by the members of a covering and assume that $s \\in u^ ph_{V_ j}(U)$ and $s\' \\in u^ ph_{V_{j\'}}(U)$. A second such replacement guarantees that $s$ and $s\'$ have the same image in $u^ ph_ V(U)$ instead of in the sheafification. Hence $s : u(U) \\to V_ j$ and $s\' : u(U) \\to V_{j\'}$ are morphisms of $\\mathcal{D}$ such that \n    \n      \n  \\[  \\xymatrix{ u(U) \\ar[r]_{s\'} \\ar[d]_ s &  V_{j\'} \\ar[d] \\\\  V_ j \\ar[r] &  V }  \\]\n\n    \n       is commutative. Thus we obtain $t = (s, s\') : u(U) \\to V_ j \\times _ V V_{j\'}$, i.e., a section $t \\in u^ ph_{V_ j \\times _ V V_{j\'}}(U)$ which maps to $s, s\'$ as desired. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Alternative reference. There, results are obtained under the additional assumptio","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that a certain presheaf (a pushforward/right adjoint) is a sheaf by checking the sheaf equalizer condition for a covering, reducing via an adjunction to a coequalizer statement after sheafification, and then proving surjectivity/identification locally using cocontinuity and refinements. The Lean proof instead rewrites the goal using `Presheaf.isSheaf_iff_multifork` and then discharges the sheaf condition by invoking a general abstract result `RanIsSheafOfIsCocontinuous.isLimitMultifork` together with a pointwise right Kan extension counit. This matches the high-level semantic claim (sheafness obtained from cocontinuity/right Kan extension machinery), but it does not mirror the concrete adjunction/coequalizer/surjectivity arguments of the informal proof.\n\nStructurally, the informal proof is a detailed elementwise/local-cover refinement argument, while the Lean proof is a short categorical proof via an existing lemma about limits of multiforks. The Lean proof omits the intermediate steps (adjunction to Hom-sets, sheafification of coproducts, epimorphism/monomorphism criteria, local lifting and equalizing), replacing them with a black-box lemma. Thus the correspondence is only at the level of overall theorem and key hypothesis (cocontinuity), not at the level of proof structure or included details.""}"
114,00WW,"lemma Functor.isContinuous_of_coverPreserving (hF‚ÇÅ : CompatiblePreserving.{w} K F)
    (hF‚ÇÇ : CoverPreserving J K F) : Functor.IsContinuous.{w} F J K where
  op_comp_isSheaf_of_types G X S hS x hx := by
    apply existsUnique_of_exists_of_unique
    ¬∑ have H := (isSheaf_iff_isSheaf_of_type _ _).1 G.2 _ (hF‚ÇÇ.cover_preserve hS)
      exact ‚ü®H.amalgamate (x.functorPushforward F) (hx.functorPushforward hF‚ÇÅ),
        fun V f hf => (H.isAmalgamation (hx.functorPushforward hF‚ÇÅ) (F.map f) _).trans
          (hF‚ÇÅ.apply_map _ hx hf)‚ü©
    ¬∑ intro y‚ÇÅ y‚ÇÇ hy‚ÇÅ hy‚ÇÇ
      apply (((isSheaf_iff_isSheaf_of_type _ _).1 G.2).isSeparated _ (hF‚ÇÇ.cover_preserve hS)).ext
      rintro Y _ ‚ü®Z, g, h, hg, rfl‚ü©
      dsimp
      simp only [Functor.map_comp, types_comp_apply]
      have H := (hy‚ÇÅ g hg).trans (hy‚ÇÇ g hg).symm
      dsimp at H
      rw [H]
",Formal Proof of Stacks Project Tag 00WW,This is basically this Stacks entry.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/CoverPreserving.lean#L157-L172,Q27041,,7.13.2,lemma,3.0,"['00WU', '00UZ', '0ELQ']",\n  Lemma 7.13.2. Let $\\mathcal{C}$ and $\\mathcal{D}$ be sites. Let $u : \\mathcal{C} \\to \\mathcal{D}$ be a continuous functor. If $\\mathcal{F}$ is a sheaf on $\\mathcal{D}$ then $u^ p\\mathcal{F}$ is a sheaf as well. \n\n    \n      Proof.\n      Let $\\{ V_ i \\to V\\} $ be a covering. By assumption $\\{ u(V_ i) \\to u(V)\\} $ is a covering in $\\mathcal{D}$ and $u(V_ i \\times _ V V_ j) = u(V_ i)\\times _{u(V)}u(V_ j)$. Hence the sheaf condition for $u^ p\\mathcal{F}$ and the covering $\\{ V_ i \\to V\\} $ is precisely the same as the sheaf condition for $\\mathcal{F}$ and the covering $\\{ u(V_ i) \\to u(V)\\} $. \n      $\\square$\n    \n,\n  Lemma 7.13.2. Let $\\mathcal{C}$ and $\\mathcal{D}$ be sites. Let $u : \\mathcal{C} \\to \\mathcal{D}$ be a continuous functor. If $\\mathcal{F}$ is a sheaf on $\\mathcal{D}$ then $u^ p\\mathcal{F}$ is a sheaf as well. \n\n    \n,Proof.\n      Let $\\{ V_ i \\to V\\} $ be a covering. By assumption $\\{ u(V_ i) \\to u(V)\\} $ is a covering in $\\mathcal{D}$ and $u(V_ i \\times _ V V_ j) = u(V_ i)\\times _{u(V)}u(V_ j)$. Hence the sheaf condition for $u^ p\\mathcal{F}$ and the covering $\\{ V_ i \\to V\\} $ is precisely the same as the sheaf condition for $\\mathcal{F}$ and the covering $\\{ u(V_ i) \\to u(V)\\} $. \n      $\\square$\n    \n," by
    apply existsUnique_of_exists_of_unique
    ¬∑ have H := (isSheaf_iff_isSheaf_of_type _ _).1 G.2 _ (hF‚ÇÇ.cover_preserve hS)
      exact ‚ü®H.amalgamate (x.functorPushforward F) (hx.functorPushforward hF‚ÇÅ),
        fun V f hf => (H.isAmalgamation (hx.functorPushforward hF‚ÇÅ) (F.map f) _).trans
          (hF‚ÇÅ.apply_map _ hx hf)‚ü©
    ¬∑ intro y‚ÇÅ y‚ÇÇ hy‚ÇÅ hy‚ÇÇ
      apply (((isSheaf_iff_isSheaf_of_type _ _).1 G.2).isSeparated _ (hF‚ÇÇ.cover_preserve hS)).ext
      rintro Y _ ‚ü®Z, g, h, hg, rfl‚ü©
      dsimp
      simp only [Functor.map_comp, types_comp_apply]
      have H := (hy‚ÇÅ g hg).trans (hy‚ÇÇ g hg).symm
      dsimp at H
      rw [H]
","lemma Functor.isContinuous_of_coverPreserving (hF‚ÇÅ : CompatiblePreserving.{w} K F)
    (hF‚ÇÇ : CoverPreserving J K F) : Functor.IsContinuous.{w} F J K where
  op_comp_isSheaf_of_types G X S hS x hx ",Proof.\n      Let $\\{ V_ i \\to V\\} $ be a covering. By assumption $\\{ u(V_ i) \\to u(V)\\} $ is a covering in $\\mathcal{D}$ and $u(V_ i \\times _ V V_ j) = u(V_ i)\\times _{u(V)}u(V_ j)$. Hence the sheaf condition for $u^ p\\mathcal{F}$ and the covering $\\{ V_ i \\to V\\} $ is precisely the same as the sheaf condition for $\\mathcal{F}$ and the covering $\\{ u(V_ i) \\to u(V)\\} $. \n      $\\square$\n    \n,"Proof.\n      Let $\\{ V_ i \\to V\\} $ be a covering. By assumption $\\{ u(V_ i) \\to u(V)\\} $ is a covering in $\\mathcal{D}$ and $u(V_ i \\times _ V V_ j) = u(V_ i)\\times _{u(V)}u(V_ j)$. Hence the sheaf condition for $u^ p\\mathcal{F}$ and the covering $\\{ V_ i \\to V\\} $ is precisely the same as the sheaf condition for $\\mathcal{F}$ and the covering $\\{ u(V_ i) \\to u(V)\\} $. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: This is basically this Stacks entry.","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish the same core fact: the sheaf condition for a pullback/pushforward-along-a-functor construction is reduced to the sheaf condition of the original sheaf on the image covering, using that coverings are preserved and that fiber products of covering members are respected. In the Lean proof this appears via `isSheaf_iff_isSheaf_of_type` applied to `G.2` (the sheaf condition for `G`), together with `hF‚ÇÇ.cover_preserve hS` (covering preservation) and the use of `functorPushforward`/`map` to transport the matching family and its compatibility. Structurally, the informal proof is a short equivalence argument (‚Äúthe conditions are precisely the same‚Äù), while the Lean proof expands this into the standard two-step sheaf proof: (1) existence of an amalgamation (`H.amalgamate ...`) and (2) uniqueness via separatedness (`H.isSeparated ... .ext`). This matches the usual formal decomposition of the sheaf condition, but is more detailed than the informal sketch. The main potential mismatch is that the informal text explicitly mentions preservation of fiber products `u(V_i √ó_V V_j) = ...`, whereas the Lean snippet does not show that equality directly; it is likely encapsulated in the hypotheses/lemmas used (`cover_preserve`, the shape of `isSheaf_iff_isSheaf_of_type`, and the way the overlap objects are represented in the `rintro ... ‚ü®Z,g,h,...‚ü©` part). No clear extraneous goals are proved beyond existence/uniqueness of amalgamation, which is exactly the sheaf condition.""}"
123,00Z5,"theorem superset_covering (Hss : S ‚â§ R) (sjx : S ‚àà J X) : R ‚àà J X := by
  apply J.transitive sjx R fun Y f hf => _
  intro Y f hf
  apply covering_of_eq_top
  rw [‚Üê top_le_iff, ‚Üê S.pullback_eq_top_of_mem hf]
  apply Sieve.pullback_monotone _ Hss
",Formal Proof of Stacks Project Tag 00Z5,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/Grothendieck.lean#L163-L168,Q27041,,7.47.7,lemma,3.0,"['00YW', '00UZ', '0ELQ']","\n  Lemma 7.47.7. Let $\\mathcal{C}$ be a category. Let $J$ be a topology on $\\mathcal{C}$. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. \n  \n  \nFinite intersections of elements of $J(U)$ are in $J(U)$. \n\n\nIf $S \\in J(U)$ and $S\' \\supset S$, then $S\' \\in J(U)$. \n\n\n\n\n    \n      Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n","\n  Lemma 7.47.7. Let $\\mathcal{C}$ be a category. Let $J$ be a topology on $\\mathcal{C}$. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. \n  \n  \nFinite intersections of elements of $J(U)$ are in $J(U)$. \n\n\nIf $S \\in J(U)$ and $S\' \\supset S$, then $S\' \\in J(U)$. \n\n\n\n\n    \n","Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n"," by
  apply J.transitive sjx R fun Y f hf => _
  intro Y f hf
  apply covering_of_eq_top
  rw [‚Üê top_le_iff, ‚Üê S.pullback_eq_top_of_mem hf]
  apply Sieve.pullback_monotone _ Hss
",theorem superset_covering (Hss : S ‚â§ R) (sjx : S ‚àà J X) : R ‚àà J X ,"Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5 [[\n  Lemma 7.47.5. Let $\\mathcal{C}$ be a category. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. Let $S$ be a sieve on $U$. If $f : V \\to U$ is in $S$, then $S \\times _ U V = h_ V$ is maximal. \n\n    \n]]. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n","Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5 [[\n  Lemma 7.47.5. Let $\\mathcal{C}$ be a category. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. Let $S$ be a sieve on $U$. If $f : V \\to U$ is in $S$, then $S \\times _ U V = h_ V$ is maximal. \n\n    \n]]. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is showing a transitivity-style axiom for a Grothendieck topology: it applies `J.transitive` to a covering sieve `sjx` and then proves that certain pullbacks are covering, finishing by `covering_of_eq_top` after rewriting the pullback sieve to be `‚ä§` and using monotonicity of pullback (`Sieve.pullback_monotone _ Hss`). This matches the *second axiom* reasoning in the informal proof (if pullbacks along arrows in a covering sieve are covering, then the larger sieve is covering), and it also uses the idea that a pullback becomes maximal (`= ‚ä§`).\n\nStructurally, however, the informal proof has two distinct parts: (i) closure under intersection of covering sieves, and (ii) upward closure (if S is covering and S ‚äÜ S‚Ä≤ then S‚Ä≤ is covering), using the lemma that pullback along a member is maximal. The Lean proof only corresponds to a single transitivity/upward-closure argument via pullbacks becoming `‚ä§`; it does not reflect the intersection argument at all, and it does not explicitly mirror the two-step informal structure. Also, the Lean proof relies on specific lemmas (`S.pullback_eq_top_of_mem`, `pullback_monotone`) rather than explicitly constructing an intersection sieve.\n\nSo the core semantic theme (using pullbacks/maximality and transitivity to conclude covering) aligns partially, but the overall informal proof contains additional content (intersection closure) not present in the Lean snippet, and the structures do not match one-to-one.""}"
124,00Z5,"theorem intersection_covering (rj : R ‚àà J X) (sj : S ‚àà J X) : R ‚äì S ‚àà J X := by
  apply J.transitive rj _ fun Y f Hf => _
  intro Y f hf
  rw [Sieve.pullback_inter, R.pullback_eq_top_of_mem hf]
  simp [sj]
",Formal Proof of Stacks Project Tag 00Z5,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/Grothendieck.lean#L174-L178,Q27041,,7.47.7,lemma,3.0,"['00YW', '00UZ', '0ELQ']","\n  Lemma 7.47.7. Let $\\mathcal{C}$ be a category. Let $J$ be a topology on $\\mathcal{C}$. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. \n  \n  \nFinite intersections of elements of $J(U)$ are in $J(U)$. \n\n\nIf $S \\in J(U)$ and $S\' \\supset S$, then $S\' \\in J(U)$. \n\n\n\n\n    \n      Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n","\n  Lemma 7.47.7. Let $\\mathcal{C}$ be a category. Let $J$ be a topology on $\\mathcal{C}$. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. \n  \n  \nFinite intersections of elements of $J(U)$ are in $J(U)$. \n\n\nIf $S \\in J(U)$ and $S\' \\supset S$, then $S\' \\in J(U)$. \n\n\n\n\n    \n","Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n"," by
  apply J.transitive rj _ fun Y f Hf => _
  intro Y f hf
  rw [Sieve.pullback_inter, R.pullback_eq_top_of_mem hf]
  simp [sj]
",theorem intersection_covering (rj : R ‚àà J X) (sj : S ‚àà J X) : R ‚äì S ‚àà J X ,"Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5 [[\n  Lemma 7.47.5. Let $\\mathcal{C}$ be a category. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. Let $S$ be a sieve on $U$. If $f : V \\to U$ is in $S$, then $S \\times _ U V = h_ V$ is maximal. \n\n    \n]]. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n","Proof.\n      Let $S, S\' \\in J(U)$. Consider $S\'\' = S \\cap S\'$. For every $V \\to U$ in $S(V)$ we have \n    \n      \n  \\[  S\' \\times _ U V = S\'\' \\times _ U V  \\]\n\n    \n       simply because $V \\to U$ already is in $S$. Hence by the second axiom of the definition we see that $S\'\' \\in J(U)$. \n    \n      Let $S \\in J(U)$ and $S\' \\supset S$. For every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V = h_ V$ by Lemma 7.47.5 [[\n  Lemma 7.47.5. Let $\\mathcal{C}$ be a category. Let $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$. Let $S$ be a sieve on $U$. If $f : V \\to U$ is in $S$, then $S \\times _ U V = h_ V$ is maximal. \n\n    \n]]. Thus $S\' \\times _ U V \\in J(V)$ by the third axiom. Hence $S\' \\in J(U)$ by the second axiom. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is establishing closure of a Grothendieck topology under intersection and upward closure, matching the informal argument: it uses `J.transitive` (the transitivity axiom) together with rewriting `Sieve.pullback_inter` and `R.pullback_eq_top_of_mem hf` (the fact that pulling back a sieve along a morphism in it gives the maximal sieve), which corresponds to the informal equalities like `S' √ó_U V = S'' √ó_U V` / `= h_V` and then applying axioms to conclude membership in `J`. Structurally, the Lean proof is much more compressed: it proves the needed closure via a single transitivity application and simp/rewrite steps, rather than explicitly splitting into two separate paragraphs (intersection case and enlargement case) as in the informal proof. Still, the key steps (pullback of intersection, pullback becomes top when the arrow is in the sieve, then conclude by axioms) align well. The main mismatch is that the informal proof explicitly treats two closure properties, while the Lean snippet appears to be one lemma instance (likely one of those properties) packaged through `transitive`, so the correspondence is not perfectly one-to-one in structure/completeness.""}"
126,00Z7,"theorem isGLB_sInf (s : Set (GrothendieckTopology C)) : IsGLB s (sInf s) := by
  refine @IsGLB.of_image _ _ _ _ sieves ?_ _ _ ?_
  ¬∑ rfl
  ¬∑ exact _root_.isGLB_sInf _
",Formal Proof of Stacks Project Tag 00Z7,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/Grothendieck.lean#L299-L302,Q27041,,7.47.9,lemma,3.0,"['00YW', '00UZ', '0ELQ']",\n  Lemma 7.47.9. Let $\\mathcal{C}$ be a category. Let $\\{ J_ i\\} _{i\\in I}$ be a set of topologies. \n  \n  \nThe rule $J(U) = \\bigcap J_ i(U)$ defines a topology on $\\mathcal{C}$. \n\n\nThere is a coarsest topology finer than all of the topologies $J_ i$. \n\n\n\n\n    \n      Proof.\n      The first part is direct from the definitions. The second follows by taking the intersection of all topologies finer than all of the $J_ i$. \n      $\\square$\n    \n,\n  Lemma 7.47.9. Let $\\mathcal{C}$ be a category. Let $\\{ J_ i\\} _{i\\in I}$ be a set of topologies. \n  \n  \nThe rule $J(U) = \\bigcap J_ i(U)$ defines a topology on $\\mathcal{C}$. \n\n\nThere is a coarsest topology finer than all of the topologies $J_ i$. \n\n\n\n\n    \n,Proof.\n      The first part is direct from the definitions. The second follows by taking the intersection of all topologies finer than all of the $J_ i$. \n      $\\square$\n    \n," by
  refine @IsGLB.of_image _ _ _ _ sieves ?_ _ _ ?_
  ¬∑ rfl
  ¬∑ exact _root_.isGLB_sInf _
",theorem isGLB_sInf (s : Set (GrothendieckTopology C)) : IsGLB s (sInf s) ,Proof.\n      The first part is direct from the definitions. The second follows by taking the intersection of all topologies finer than all of the $J_ i$. \n      $\\square$\n    \n,Proof.\n      The first part is direct from the definitions. The second follows by taking the intersection of all topologies finer than all of the $J_ i$. \n      $\\square$\n    \n,"{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to establish a greatest-lower-bound statement by appealing to a construction as an infimum/intersection: the informal proof explicitly says ‚Äútake the intersection of all topologies finer than all of the J_i,‚Äù while the Lean proof uses `IsGLB.of_image` together with `isGLB_sInf`, i.e. the fact that `sInf` is a GLB in a complete lattice, which corresponds to taking an intersection/infimum. Structurally, however, the informal proof has two conceptual steps (a definitional part, then an intersection argument), whereas the Lean proof is a short lattice-theoretic packaging: it discharges one goal by `rfl` (matching the ‚Äòdirect from definitions‚Äô part) and the other by `isGLB_sInf` (matching the ‚Äòintersection/infimum‚Äô part), but it does not explicitly mention ‚Äútopologies finer than all J_i‚Äù or show the two-step reasoning in the same narrative form. Overall the alignment is moderate: the core idea (GLB via infimum/intersection) matches, but the formal proof is more abstract and omits the specific informal description.""}"
129,00ZC,"def toGrothendieck (K : Pretopology C) : GrothendieckTopology C where
  sieves X S := ‚àÉ R ‚àà K X, R ‚â§ (S : Presieve _)
  top_mem' _ := ‚ü®Presieve.singleton (ùüô _), K.has_isos _, fun _ _ _ => ‚ü®‚ü©‚ü©
  pullback_stable' X Y S g := by
    rintro ‚ü®R, hR, RS‚ü©
    refine ‚ü®_, K.pullbacks g _ hR, ?_‚ü©
    rw [‚Üê Sieve.generate_le_iff, Sieve.pullbackArrows_comm]
    apply Sieve.pullback_monotone
    rwa [Sieve.giGenerate.gc]
  transitive' := by
    rintro X S ‚ü®R', hR', RS‚ü© R t
    choose t‚ÇÅ t‚ÇÇ t‚ÇÉ using t
    refine ‚ü®_, K.transitive _ _ hR' fun _ f hf => t‚ÇÇ (RS _ hf), ?_‚ü©
    rintro Y _ ‚ü®Z, g, f, hg, hf, rfl‚ü©
    apply t‚ÇÉ (RS _ hg) _ hf
",Formal Proof of Stacks Project Tag 00ZC,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/CategoryTheory/Sites/Pretopology.lean#L112-L126,Q27041,,7.48.1,lemma,3.0,"['00ZB', '00UZ', '0ELQ']","\n  Lemma 7.48.1. Let $\\mathcal{C}$ be a site with coverings $\\text{Cov}(\\mathcal{C})$. For every object $U$ of $\\mathcal{C}$, let $J(U)$ denote the set of sieves $S$ on $U$ with the following property: there exists a covering $\\{ f_ i : U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ so that the sieve $S\'$ generated by the $f_ i$ (see Definition 7.47.3) is contained in $S$. \n  \n  \nThis $J$ is a topology on $\\mathcal{C}$. \n\n\nA presheaf $\\mathcal{F}$ is a sheaf for this topology (see Definition 7.47.10) if and only if it is a sheaf on the site (see Definition 7.7.1). \n\n\n\n\n    \n      Proof.\n      To prove the first assertion we just note that axioms (1), (2) and (3) of the definition of a site (Definition 7.6.2) directly imply the axioms (3), (2) and (1) of the definition of a topology (Definition 7.47.6). As an example we prove $J$ has property (2). Namely, let $U$ be an object of $\\mathcal{C}$, let $S, S\'$ be sieves on $U$ such that $S \\in J(U)$, and such that for every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. By definition of $J(U)$ we can find a covering $\\{ f_ i : U_ i \\to U\\} $ of the site such that $S$ the image of $h_{U_ i} \\to h_ U$ is contained in $S$. Since each $S\'\\times _ U U_ i$ is in $J(U_ i)$ we see that there are coverings $\\{ U_{ij} \\to U_ i\\} $ of the site such that $h_{U_{ij}} \\to h_{U_ i}$ is contained in $S\' \\times _ U U_ i$. By definition of the base change this means that $h_{U_{ij}} \\to h_ U$ is contained in the subpresheaf $S\' \\subset h_ U$. By axiom (2) for sites we see that $\\{ U_{ij} \\to U\\} $ is a covering of $U$ and we conclude that $S\' \\in J(U)$ by definition of $J$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf in the topology $J$. We will show that $\\mathcal{F}$ is a sheaf on the site as well. Let $\\{ f_ i : U_ i \\to U\\} _{i\\in I}$ be a covering of the site. Let $s_ i \\in \\mathcal{F}(U_ i)$ be a family of sections such that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. We have to show that there exists a unique section $s \\in \\mathcal{F}(U)$ restricting back to the $s_ i$ on the $U_ i$. Let $S \\subset h_ U$ be the sieve generated by the $f_ i$. Note that $S \\in J(U)$ by definition. In stead of constructing $s$, by the sheaf condition in the topology, it suffices to construct an element \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       Take $\\alpha \\in S(T)$ for some object $T \\in \\mathcal{U}$. This means exactly that $\\alpha : T \\to U$ is a morphism which factors through $f_ i$ for some $i\\in I$ (and maybe more than $1$). Pick such an index $i$ and a factorization $\\alpha = f_ i \\circ \\alpha _ i$. Define $\\varphi (\\alpha ) = \\alpha _ i^* s_ i$. If $i\'$, $\\alpha = f_ i \\circ \\alpha _{i\'}\'$ is a second choice, then $\\alpha _ i^* s_ i = (\\alpha _{i\'}\')^* s_{i\'}$ exactly because of our condition $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus $\\varphi (\\alpha )$ is well defined. We leave it to the reader to verify that $\\varphi $, which in turn determines $s$ is correct in the sense that $s$ restricts back to $s_ i$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. We will show that $\\mathcal{F}$ is a sheaf for the topology $J$ as well. Let $U$ be an object of $\\mathcal{C}$. Let $S$ be a covering sieve on $U$ with respect to the topology $J$. Let \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       We have to show there is a unique element in $\\mathcal{F}(U) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ U, \\mathcal{F})$ which restricts back to $\\varphi $. By definition there exists a covering $\\{ f_ i : U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ such that $f_ i : U_ i \\in U$ belongs to $S(U_ i)$. Hence we can set $s_ i = \\varphi (f_ i) \\in \\mathcal{F}(U_ i)$. Then it is a pleasant exercise to see that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus we obtain the desired section $s$ by the sheaf condition for $\\mathcal{F}$ on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. Details left to the reader. \n      $\\square$\n    \n","\n  Lemma 7.48.1. Let $\\mathcal{C}$ be a site with coverings $\\text{Cov}(\\mathcal{C})$. For every object $U$ of $\\mathcal{C}$, let $J(U)$ denote the set of sieves $S$ on $U$ with the following property: there exists a covering $\\{ f_ i : U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ so that the sieve $S\'$ generated by the $f_ i$ (see Definition 7.47.3) is contained in $S$. \n  \n  \nThis $J$ is a topology on $\\mathcal{C}$. \n\n\nA presheaf $\\mathcal{F}$ is a sheaf for this topology (see Definition 7.47.10) if and only if it is a sheaf on the site (see Definition 7.7.1). \n\n\n\n\n    \n","Proof.\n      To prove the first assertion we just note that axioms (1), (2) and (3) of the definition of a site (Definition 7.6.2) directly imply the axioms (3), (2) and (1) of the definition of a topology (Definition 7.47.6). As an example we prove $J$ has property (2). Namely, let $U$ be an object of $\\mathcal{C}$, let $S, S\'$ be sieves on $U$ such that $S \\in J(U)$, and such that for every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. By definition of $J(U)$ we can find a covering $\\{ f_ i : U_ i \\to U\\} $ of the site such that $S$ the image of $h_{U_ i} \\to h_ U$ is contained in $S$. Since each $S\'\\times _ U U_ i$ is in $J(U_ i)$ we see that there are coverings $\\{ U_{ij} \\to U_ i\\} $ of the site such that $h_{U_{ij}} \\to h_{U_ i}$ is contained in $S\' \\times _ U U_ i$. By definition of the base change this means that $h_{U_{ij}} \\to h_ U$ is contained in the subpresheaf $S\' \\subset h_ U$. By axiom (2) for sites we see that $\\{ U_{ij} \\to U\\} $ is a covering of $U$ and we conclude that $S\' \\in J(U)$ by definition of $J$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf in the topology $J$. We will show that $\\mathcal{F}$ is a sheaf on the site as well. Let $\\{ f_ i : U_ i \\to U\\} _{i\\in I}$ be a covering of the site. Let $s_ i \\in \\mathcal{F}(U_ i)$ be a family of sections such that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. We have to show that there exists a unique section $s \\in \\mathcal{F}(U)$ restricting back to the $s_ i$ on the $U_ i$. Let $S \\subset h_ U$ be the sieve generated by the $f_ i$. Note that $S \\in J(U)$ by definition. In stead of constructing $s$, by the sheaf condition in the topology, it suffices to construct an element \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       Take $\\alpha \\in S(T)$ for some object $T \\in \\mathcal{U}$. This means exactly that $\\alpha : T \\to U$ is a morphism which factors through $f_ i$ for some $i\\in I$ (and maybe more than $1$). Pick such an index $i$ and a factorization $\\alpha = f_ i \\circ \\alpha _ i$. Define $\\varphi (\\alpha ) = \\alpha _ i^* s_ i$. If $i\'$, $\\alpha = f_ i \\circ \\alpha _{i\'}\'$ is a second choice, then $\\alpha _ i^* s_ i = (\\alpha _{i\'}\')^* s_{i\'}$ exactly because of our condition $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus $\\varphi (\\alpha )$ is well defined. We leave it to the reader to verify that $\\varphi $, which in turn determines $s$ is correct in the sense that $s$ restricts back to $s_ i$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. We will show that $\\mathcal{F}$ is a sheaf for the topology $J$ as well. Let $U$ be an object of $\\mathcal{C}$. Let $S$ be a covering sieve on $U$ with respect to the topology $J$. Let \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       We have to show there is a unique element in $\\mathcal{F}(U) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ U, \\mathcal{F})$ which restricts back to $\\varphi $. By definition there exists a covering $\\{ f_ i : U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ such that $f_ i : U_ i \\in U$ belongs to $S(U_ i)$. Hence we can set $s_ i = \\varphi (f_ i) \\in \\mathcal{F}(U_ i)$. Then it is a pleasant exercise to see that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus we obtain the desired section $s$ by the sheaf condition for $\\mathcal{F}$ on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. Details left to the reader. \n      $\\square$\n    \n"," ‚àÉ R ‚àà K X, R ‚â§ (S : Presieve _)
  top_mem' _ := ‚ü®Presieve.singleton (ùüô _), K.has_isos _, fun _ _ _ => ‚ü®‚ü©‚ü©
  pullback_stable' X Y S g := by
    rintro ‚ü®R, hR, RS‚ü©
    refine ‚ü®_, K.pullbacks g _ hR, ?_‚ü©
    rw [‚Üê Sieve.generate_le_iff, Sieve.pullbackArrows_comm]
    apply Sieve.pullback_monotone
    rwa [Sieve.giGenerate.gc]
  transitive' := by
    rintro X S ‚ü®R', hR', RS‚ü© R t
    choose t‚ÇÅ t‚ÇÇ t‚ÇÉ using t
    refine ‚ü®_, K.transitive _ _ hR' fun _ f hf => t‚ÇÇ (RS _ hf), ?_‚ü©
    rintro Y _ ‚ü®Z, g, f, hg, hf, rfl‚ü©
    apply t‚ÇÉ (RS _ hg) _ hf
","def toGrothendieck (K : Pretopology C) : GrothendieckTopology C where
  sieves X S ","Proof.\n      To prove the first assertion we just note that axioms (1), (2) and (3) of the definition of a site (Definition 7.6.2 [[\n  Definition 7.6.2. A site1 is given by a category $\\mathcal{C}$ and a set $\\text{Cov}(\\mathcal{C})$ of families of morphisms with fixed target $\\{ U_ i \\to U\\} _{i \\in I}$, called coverings of $\\mathcal{C}$, satisfying the following axioms \n  \n  \nIf $V \\to U$ is an isomorphism then $\\{ V \\to U\\}  \\in \\text{Cov}(\\mathcal{C})$. \n\n\nIf $\\{ U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ and for each $i$ we have $\\{ V_{ij} \\to U_ i\\} _{j\\in J_ i} \\in \\text{Cov}(\\mathcal{C})$, then $\\{ V_{ij} \\to U\\} _{i \\in I, j\\in J_ i} \\in \\text{Cov}(\\mathcal{C})$. \n\n\nIf $\\{ U_ i \\to U\\} _{i\\in I}\\in \\text{Cov}(\\mathcal{C})$ and $V \\to U$ is a morphism of $\\mathcal{C}$ then $U_ i \\times _ U V$ exists for all $i$ and $\\{ U_ i \\times _ U V \\to V \\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$. \n\n\n\n]]) directly imply the axioms (3), (2) and (1) of the definition of a topology (Definition 7.47.6 [[\n  Definition 7.47.6. Let $\\mathcal{C}$ be a category. A topology on $\\mathcal{C}$ is given by a rule which assigns to every $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ a subset $J(U)$ of the set of all sieves on $U$ satisfying the following conditions \n  \n  \nFor every morphism $f : V \\to U$ in $\\mathcal{C}$, and every element $S \\in J(U)$ the pullback $S \\times _ U V$ is an element of $J(V)$. \n\n\nIf $S$ and $S\'$ are sieves on $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$, if $S \\in J(U)$, and if for all $f \\in S(V)$ the pullback $S\' \\times _ U V$ belongs to $J(V)$, then $S\'$ belongs to $J(U)$. \n\n\nFor every $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ the maximal sieve $S = h_ U$ belongs to $J(U)$. \n\n\n\n]]). As an example we prove $J$ has property (2). Namely, let $U$ be an object of $\\mathcal{C}$, let $S, S\'$ be sieves on $U$ such that $S \\in J(U)$, and such that for every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. By definition of $J(U)$ we can find a covering $\\{ f_ i : U_ i \\to U\\} $ of the site such that $S$ the image of $h_{U_ i} \\to h_ U$ is contained in $S$. Since each $S\'\\times _ U U_ i$ is in $J(U_ i)$ we see that there are coverings $\\{ U_{ij} \\to U_ i\\} $ of the site such that $h_{U_{ij}} \\to h_{U_ i}$ is contained in $S\' \\times _ U U_ i$. By definition of the base change this means that $h_{U_{ij}} \\to h_ U$ is contained in the subpresheaf $S\' \\subset h_ U$. By axiom (2) for sites we see that $\\{ U_{ij} \\to U\\} $ is a covering of $U$ and we conclude that $S\' \\in J(U)$ by definition of $J$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf in the topology $J$. We will show that $\\mathcal{F}$ is a sheaf on the site as well. Let $\\{ f_ i : U_ i \\to U\\} _{i\\in I}$ be a covering of the site. Let $s_ i \\in \\mathcal{F}(U_ i)$ be a family of sections such that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. We have to show that there exists a unique section $s \\in \\mathcal{F}(U)$ restricting back to the $s_ i$ on the $U_ i$. Let $S \\subset h_ U$ be the sieve generated by the $f_ i$. Note that $S \\in J(U)$ by definition. In stead of constructing $s$, by the sheaf condition in the topology, it suffices to construct an element \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       Take $\\alpha \\in S(T)$ for some object $T \\in \\mathcal{U}$. This means exactly that $\\alpha : T \\to U$ is a morphism which factors through $f_ i$ for some $i\\in I$ (and maybe more than $1$). Pick such an index $i$ and a factorization $\\alpha = f_ i \\circ \\alpha _ i$. Define $\\varphi (\\alpha ) = \\alpha _ i^* s_ i$. If $i\'$, $\\alpha = f_ i \\circ \\alpha _{i\'}\'$ is a second choice, then $\\alpha _ i^* s_ i = (\\alpha _{i\'}\')^* s_{i\'}$ exactly because of our condition $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus $\\varphi (\\alpha )$ is well defined. We leave it to the reader to verify that $\\varphi $, which in turn determines $s$ is correct in the sense that $s$ restricts back to $s_ i$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. We will show that $\\mathcal{F}$ is a sheaf for the topology $J$ as well. Let $U$ be an object of $\\mathcal{C}$. Let $S$ be a covering sieve on $U$ with respect to the topology $J$. Let \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       We have to show there is a unique element in $\\mathcal{F}(U) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ U, \\mathcal{F})$ which restricts back to $\\varphi $. By definition there exists a covering $\\{ f_ i : U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ such that $f_ i : U_ i \\in U$ belongs to $S(U_ i)$. Hence we can set $s_ i = \\varphi (f_ i) \\in \\mathcal{F}(U_ i)$. Then it is a pleasant exercise to see that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus we obtain the desired section $s$ by the sheaf condition for $\\mathcal{F}$ on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. Details left to the reader. \n      $\\square$\n    \n","Proof.\n      To prove the first assertion we just note that axioms (1), (2) and (3) of the definition of a site (Definition 7.6.2 [[\n  Definition 7.6.2. A site1 is given by a category $\\mathcal{C}$ and a set $\\text{Cov}(\\mathcal{C})$ of families of morphisms with fixed target $\\{ U_ i \\to U\\} _{i \\in I}$, called coverings of $\\mathcal{C}$, satisfying the following axioms \n  \n  \nIf $V \\to U$ is an isomorphism then $\\{ V \\to U\\}  \\in \\text{Cov}(\\mathcal{C})$. \n\n\nIf $\\{ U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ and for each $i$ we have $\\{ V_{ij} \\to U_ i\\} _{j\\in J_ i} \\in \\text{Cov}(\\mathcal{C})$, then $\\{ V_{ij} \\to U\\} _{i \\in I, j\\in J_ i} \\in \\text{Cov}(\\mathcal{C})$. \n\n\nIf $\\{ U_ i \\to U\\} _{i\\in I}\\in \\text{Cov}(\\mathcal{C})$ and $V \\to U$ is a morphism of $\\mathcal{C}$ then $U_ i \\times _ U V$ exists for all $i$ and $\\{ U_ i \\times _ U V \\to V \\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$. \n\n\n\n]]) directly imply the axioms (3), (2) and (1) of the definition of a topology (Definition 7.47.6 [[\n  Definition 7.47.6. Let $\\mathcal{C}$ be a category. A topology on $\\mathcal{C}$ is given by a rule which assigns to every $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ a subset $J(U)$ of the set of all sieves on $U$ satisfying the following conditions \n  \n  \nFor every morphism $f : V \\to U$ in $\\mathcal{C}$, and every element $S \\in J(U)$ the pullback $S \\times _ U V$ is an element of $J(V)$. \n\n\nIf $S$ and $S\'$ are sieves on $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$, if $S \\in J(U)$, and if for all $f \\in S(V)$ the pullback $S\' \\times _ U V$ belongs to $J(V)$, then $S\'$ belongs to $J(U)$. \n\n\nFor every $U \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ the maximal sieve $S = h_ U$ belongs to $J(U)$. \n\n\n\n]]). As an example we prove $J$ has property (2). Namely, let $U$ be an object of $\\mathcal{C}$, let $S, S\'$ be sieves on $U$ such that $S \\in J(U)$, and such that for every $V \\to U$ in $S(V)$ we have $S\' \\times _ U V \\in J(V)$. By definition of $J(U)$ we can find a covering $\\{ f_ i : U_ i \\to U\\} $ of the site such that $S$ the image of $h_{U_ i} \\to h_ U$ is contained in $S$. Since each $S\'\\times _ U U_ i$ is in $J(U_ i)$ we see that there are coverings $\\{ U_{ij} \\to U_ i\\} $ of the site such that $h_{U_{ij}} \\to h_{U_ i}$ is contained in $S\' \\times _ U U_ i$. By definition of the base change this means that $h_{U_{ij}} \\to h_ U$ is contained in the subpresheaf $S\' \\subset h_ U$. By axiom (2) for sites we see that $\\{ U_{ij} \\to U\\} $ is a covering of $U$ and we conclude that $S\' \\in J(U)$ by definition of $J$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf in the topology $J$. We will show that $\\mathcal{F}$ is a sheaf on the site as well. Let $\\{ f_ i : U_ i \\to U\\} _{i\\in I}$ be a covering of the site. Let $s_ i \\in \\mathcal{F}(U_ i)$ be a family of sections such that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. We have to show that there exists a unique section $s \\in \\mathcal{F}(U)$ restricting back to the $s_ i$ on the $U_ i$. Let $S \\subset h_ U$ be the sieve generated by the $f_ i$. Note that $S \\in J(U)$ by definition. In stead of constructing $s$, by the sheaf condition in the topology, it suffices to construct an element \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       Take $\\alpha \\in S(T)$ for some object $T \\in \\mathcal{U}$. This means exactly that $\\alpha : T \\to U$ is a morphism which factors through $f_ i$ for some $i\\in I$ (and maybe more than $1$). Pick such an index $i$ and a factorization $\\alpha = f_ i \\circ \\alpha _ i$. Define $\\varphi (\\alpha ) = \\alpha _ i^* s_ i$. If $i\'$, $\\alpha = f_ i \\circ \\alpha _{i\'}\'$ is a second choice, then $\\alpha _ i^* s_ i = (\\alpha _{i\'}\')^* s_{i\'}$ exactly because of our condition $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus $\\varphi (\\alpha )$ is well defined. We leave it to the reader to verify that $\\varphi $, which in turn determines $s$ is correct in the sense that $s$ restricts back to $s_ i$. \n    \n      Let $\\mathcal{F}$ be a presheaf. Suppose that $\\mathcal{F}$ is a sheaf on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. We will show that $\\mathcal{F}$ is a sheaf for the topology $J$ as well. Let $U$ be an object of $\\mathcal{C}$. Let $S$ be a covering sieve on $U$ with respect to the topology $J$. Let \n    \n      \n  \\[  \\varphi \\in \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(S, \\mathcal{F}).  \\]\n\n    \n       We have to show there is a unique element in $\\mathcal{F}(U) = \\mathop{\\mathrm{Mor}}\\nolimits _{\\textit{PSh}(\\mathcal{C})}(h_ U, \\mathcal{F})$ which restricts back to $\\varphi $. By definition there exists a covering $\\{ f_ i : U_ i \\to U\\} _{i\\in I} \\in \\text{Cov}(\\mathcal{C})$ such that $f_ i : U_ i \\in U$ belongs to $S(U_ i)$. Hence we can set $s_ i = \\varphi (f_ i) \\in \\mathcal{F}(U_ i)$. Then it is a pleasant exercise to see that $s_ i|_{U_ i \\times _ U U_ j} = s_ j|_{U_ i \\times _ U U_ j}$ for all $i, j$. Thus we obtain the desired section $s$ by the sheaf condition for $\\mathcal{F}$ on the site $(\\mathcal{C}, \\text{Cov}(\\mathcal{C}))$. Details left to the reader. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean snippet is proving that a coverage/basis K on a category induces a Grothendieck topology: it provides `top_mem'` (maximal sieve is covering), `pullback_stable'` (coverings stable under pullback), and `transitive'` (local character/transitivity). This matches the first part of the informal proof, which explains how the site axioms imply the topology axioms and explicitly discusses property (2) (local character). Structurally, the formal proof corresponds only to these three topology axioms, with `top_mem'` using the singleton identity/isomorphism covering, `pullback_stable'` using `K.pullbacks` plus monotonicity of pullback and `Sieve.generate_le_iff`, and `transitive'` using `K.transitive` and a factorization argument. However, the informal text goes substantially further: it also proves equivalence of sheaf conditions between the site and the induced topology, constructing morphisms from generated sieves and checking well-definedness‚Äînone of which appears in the Lean code. Thus the formal proof aligns with a subset (the topology construction) but is incomplete relative to the full informal argument.""}"
144,09GI,"def algebraicClosure : IntermediateField F E :=
  Algebra.IsAlgebraic.toIntermediateField (integralClosure F E)
",Formal Proof of Stacks Project Tag 09GI,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/AlgebraicClosure.lean#L40-L41,Q27041,,9.8.7,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n  Lemma 9.8.7. Let $E/k$ be a field extension. Then the elements of $E$ algebraic over $k$ form a subextension of $E/k$. \n\n    \n      Proof.\n      Let $\\alpha , \\beta \\in E$ be algebraic over $k$. Then $k(\\alpha , \\beta )/k$ is a finite extension by Lemma 9.8.6. It follows that $k(\\alpha + \\beta ) \\subset k(\\alpha , \\beta )$ is a finite extension, which implies that $\\alpha + \\beta $ is algebraic by Lemma 9.8.5. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n",\n  Lemma 9.8.7. Let $E/k$ be a field extension. Then the elements of $E$ algebraic over $k$ form a subextension of $E/k$. \n\n    \n,"Proof.\n      Let $\\alpha , \\beta \\in E$ be algebraic over $k$. Then $k(\\alpha , \\beta )/k$ is a finite extension by Lemma 9.8.6. It follows that $k(\\alpha + \\beta ) \\subset k(\\alpha , \\beta )$ is a finite extension, which implies that $\\alpha + \\beta $ is algebraic by Lemma 9.8.5. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n","
  Algebra.IsAlgebraic.toIntermediateField (integralClosure F E)
",def algebraicClosure : IntermediateField F E ,"Proof.\n      Let $\\alpha , \\beta \\in E$ be algebraic over $k$. Then $k(\\alpha , \\beta )/k$ is a finite extension by Lemma 9.8.6 [[\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n]]. It follows that $k(\\alpha + \\beta ) \\subset k(\\alpha , \\beta )$ is a finite extension, which implies that $\\alpha + \\beta $ is algebraic by Lemma 9.8.5 [[\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n]]. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha , \\beta \\in E$ be algebraic over $k$. Then $k(\\alpha , \\beta )/k$ is a finite extension by Lemma 9.8.6 [[\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n]]. It follows that $k(\\alpha + \\beta ) \\subset k(\\alpha , \\beta )$ is a finite extension, which implies that $\\alpha + \\beta $ is algebraic by Lemma 9.8.5 [[\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n]]. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof establishes closure of algebraic elements under +, ‚àí, √ó, and √∑ by showing k(Œ±,Œ≤)/k is finite and hence Œ±¬±Œ≤, Œ±Œ≤, Œ±/Œ≤ are algebraic. The formal proof term `Algebra.IsAlgebraic.toIntermediateField (integralClosure F E)` instead constructs an intermediate field from the integral closure (i.e., elements integral over F in E) using a general lemma about algebraic elements. This is related (integral ‚áí algebraic), but it is not the same statement or argument: it does not explicitly prove closure under field operations via finite extensions, nor does it mention sums/products/quotients. Structurally, the informal proof is a step-by-step field-theoretic finiteness argument, while the Lean code is a one-line coercion/construction lemma. Thus there is only partial thematic overlap (algebraic/integral elements forming a subfield), but poor correspondence to the specific reasoning and operations in the informal proof.""}"
145,09I3,"theorem finrank_eq_card [Fintype G] [FaithfulSMul G F] :
    finrank (FixedPoints.subfield G F) F = Fintype.card G :=
  le_antisymm (FixedPoints.finrank_le_card G F) <|
    calc
      Fintype.card G ‚â§ Fintype.card (F ‚Üí‚Çê[FixedPoints.subfield G F] F) :=
        Fintype.card_le_of_injective _ (MulSemiringAction.toAlgHom_injective _ F)
      _ ‚â§ finrank F (F ‚Üí‚Çó[FixedPoints.subfield G F] F) := finrank_algHom (subfield G F) F
      _ = finrank (FixedPoints.subfield G F) F := finrank_linearMap_self _ _ _
",Formal Proof of Stacks Project Tag 09I3,second part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Fixed.lean#L326-L333,Q27041,,9.21.6,lemma,3.0,"['09DU', '09FA', '0ELQ']","\n  Lemma 9.21.6. Let $K$ be a field. Let $G$ be a finite group acting faithfully on $K$. Then the extension $K/K^ G$ is Galois, we have $[K : K^ G] = |G|$, and the Galois group of the extension is $G$. \n\n    \n      Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9. \n      $\\square$\n    \n","\n  Lemma 9.21.6. Let $K$ be a field. Let $G$ be a finite group acting faithfully on $K$. Then the extension $K/K^ G$ is Galois, we have $[K : K^ G] = |G|$, and the Galois group of the extension is $G$. \n\n    \n","Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9. \n      $\\square$\n    \n","
  le_antisymm (FixedPoints.finrank_le_card G F) <|
    calc
      Fintype.card G ‚â§ Fintype.card (F ‚Üí‚Çê[FixedPoints.subfield G F] F) :=
        Fintype.card_le_of_injective _ (MulSemiringAction.toAlgHom_injective _ F)
      _ ‚â§ finrank F (F ‚Üí‚Çó[FixedPoints.subfield G F] F) := finrank_algHom (subfield G F) F
      _ = finrank (FixedPoints.subfield G F) F := finrank_linearMap_self _ _ _
","theorem finrank_eq_card [Fintype G] [FaithfulSMul G F] :
    finrank (FixedPoints.subfield G F) F = Fintype.card G ","Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2 [[\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n]]. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 [[\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n]] we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2 [[\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n]]. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 [[\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n]] we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: second part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about proving an equality/antisymmetry between a finrank bound and a cardinality bound: it uses `FixedPoints.finrank_le_card` for one inequality and then bounds `Fintype.card G` by the cardinality of a type of algebra homomorphisms `F ‚Üí‚Çê[FixedPoints.subfield G F] F`, then by a finrank of linear maps, and finally identifies that finrank with `finrank (FixedPoints.subfield G F) F`. This is essentially a dimension/cardinality comparison argument via injectivity of the action map and standard inequalities relating numbers of (alg)homomorphisms to finrank.\n\nStructurally, the informal proof‚Äôs ‚Äúsecond part‚Äù argues that `[K:K^G]=|G|` by constructing invariant polynomials/orbits to get algebraic+separable (hence Galois), then using primitive element and the inequality `|Aut(E/F)| ‚â§ [E:F]_s` plus faithfulness to force the degree to be exactly `|G|`. None of the orbit polynomial, separability/normality/Galois, primitive element, or minimal polynomial divisibility steps appear in the Lean snippet. The Lean code instead directly compares `|G|` to counts of algebra homomorphisms and finrank, which corresponds at best to a small fragment of the degree-vs-automorphisms inequality theme, but not to the main construction and logical flow of the informal argument.\n\nThus there is partial semantic overlap (both relate group size, fixed field, and finrank/degree via homomorphisms), but the formal proof does not reflect the key steps or structure of the informal proof‚Äôs second part and omits most of its content.""}"
146,0BMJ,"instance (K L : Type*) [Field K] [Field L] [Algebra K L] : IsTopologicalGroup Gal(L/K) :=
  GroupFilterBasis.isTopologicalGroup (galGroupBasis K L)
",Formal Proof of Stacks Project Tag 0BMJ,We define Krull topology directly without proving the universal property,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/KrullTopology.lean#L139-L140,Q27041,,9.22.1,lemma,3.0,"['0BMI', '09FA', '0ELQ']","\n  Lemma 9.22.1. Let $E/F$ be a Galois extension. Endow $\\text{Gal}(E/F)$ with the coarsest topology such that \n  \n  \\[  \\text{Gal}(E/F) \\times E \\longrightarrow E  \\]\n\n   is continuous when $E$ is given the discrete topology. Then \n  \n  \nfor any topological space $X$ and map $X \\to \\text{Gal}(E/F)$ such that the action $X \\times E \\to E$ is continuous the induced map $X \\to \\text{Gal}(E/F)$ is continuous, \n\n\nthis topology turns $\\text{Gal}(E/F)$ into a profinite topological group. \n\n\n\n\n    \n      Proof.\n      Throughout this proof we think of $E$ as a discrete topological space. Recall that the compact open topology on the set of self maps $\\text{Map}(E, E)$ is the universal topology such that the action $\\text{Map}(E, E) \\times E \\to E$ is continuous. See Topology, Example 5.30.2 for a precise statement. The topology of the lemma on $\\text{Gal}(E/F)$ is the induced topology coming from the injective map $\\text{Gal}(E/F) \\to \\text{Map}(E, E)$. Hence the universal property (1) follows from the corresponding universal property of the compact open topology. Since the set of invertible self maps $\\text{Aut}(E)$ endowed with the compact open topology forms a topological group, see Topology, Example 5.30.2, and since $\\text{Gal}(E/F) = \\text{Aut}(E/F) \\to \\text{Map}(E, E)$ factors through $\\text{Aut}(E)$ we obtain a topological group. In other words, we are using the injection \n    \n      \n  \\[  \\text{Gal}(E/F) \\subset \\text{Aut}(E)  \\]\n\n    \n       to endow $\\text{Gal}(E/F)$ with the induced structure of a topological group (see Topology, Section 5.30) and by construction this is the coarsest structure of a topological group such that the action $\\text{Gal}(E/F) \\times E \\to E$ is continuous. \n    \n      To show that $\\text{Gal}(E/F)$ is profinite we argue as follows (our argument is necessarily nonstandard because we have defined the topology before showing that the Galois group is an inverse limit of finite groups). By Topology, Lemma 5.30.4 it suffices to show that the underlying topological space of $\\text{Gal}(E/F)$ is profinite. For any subset $S \\subset E$ consider the set \n    \n      \n  \\[  G(S) = \\{  f : S \\to E \\mid \\begin{matrix}  f(\\alpha )\\text{ is a root of the minimal polynomial}\n\n\\\\  \\text{of }\\alpha \\text{ over }F\\text{ for all }\\alpha \\in S \n\n\\end{matrix} \\}   \\]\n\n    \n       Since a polynomial has only a finite number of roots we see that $G(S)$ is finite for all $S \\subset E$ finite. If $S \\subset S\'$ then restriction gives a map $G(S\') \\to G(S)$. Also, observe that if $\\alpha \\in S \\cap F$ and $f \\in G(S)$, then $f(\\alpha ) = \\alpha $ because the minimal polynomial is linear in this case. Consider the profinite topological space \n    \n      \n  \\[  G = \\mathop{\\mathrm{lim}}\\nolimits _{S \\subset E\\text{ finite}} G(S)  \\]\n\n    \n       Consider the canonical map \n    \n      \n  \\[  c : \\text{Gal}(E/F) \\longrightarrow G,\\quad \\sigma \\longmapsto (\\sigma |_ S : S \\to E)_ S  \\]\n\n    \n       This is injective and unwinding the definitions the reader sees the topology on $\\text{Gal}(E/F)$ as defined above is the induced topology from $G$. An element $(f_ S) \\in G$ is in the image of $c$ exactly if (A) $f_ S(\\alpha ) + f_ S(\\beta ) = f_ S(\\alpha + \\beta )$ and (M) $f_ S(\\alpha )f_ S(\\beta ) = f_ S(\\alpha \\beta )$ whenever this makes sense (i.e., $\\alpha , \\beta , \\alpha + \\beta , \\alpha \\beta \\in S$). Namely, this means $\\mathop{\\mathrm{lim}}\\nolimits f_ S : E \\to E$ will be an $F$-algebra map and hence an automorphism by Lemma 9.8.11. The conditions (A) and (M) for a given triple $(S, \\alpha , \\beta )$ define a closed subset of $G$ and hence $\\text{Gal}(E/F)$ is homeomorphic to a closed subset of a profinite space and therefore profinite itself. \n      $\\square$\n    \n","\n  Lemma 9.22.1. Let $E/F$ be a Galois extension. Endow $\\text{Gal}(E/F)$ with the coarsest topology such that \n  \n  \\[  \\text{Gal}(E/F) \\times E \\longrightarrow E  \\]\n\n   is continuous when $E$ is given the discrete topology. Then \n  \n  \nfor any topological space $X$ and map $X \\to \\text{Gal}(E/F)$ such that the action $X \\times E \\to E$ is continuous the induced map $X \\to \\text{Gal}(E/F)$ is continuous, \n\n\nthis topology turns $\\text{Gal}(E/F)$ into a profinite topological group. \n\n\n\n\n    \n","Proof.\n      Throughout this proof we think of $E$ as a discrete topological space. Recall that the compact open topology on the set of self maps $\\text{Map}(E, E)$ is the universal topology such that the action $\\text{Map}(E, E) \\times E \\to E$ is continuous. See Topology, Example 5.30.2 for a precise statement. The topology of the lemma on $\\text{Gal}(E/F)$ is the induced topology coming from the injective map $\\text{Gal}(E/F) \\to \\text{Map}(E, E)$. Hence the universal property (1) follows from the corresponding universal property of the compact open topology. Since the set of invertible self maps $\\text{Aut}(E)$ endowed with the compact open topology forms a topological group, see Topology, Example 5.30.2, and since $\\text{Gal}(E/F) = \\text{Aut}(E/F) \\to \\text{Map}(E, E)$ factors through $\\text{Aut}(E)$ we obtain a topological group. In other words, we are using the injection \n    \n      \n  \\[  \\text{Gal}(E/F) \\subset \\text{Aut}(E)  \\]\n\n    \n       to endow $\\text{Gal}(E/F)$ with the induced structure of a topological group (see Topology, Section 5.30) and by construction this is the coarsest structure of a topological group such that the action $\\text{Gal}(E/F) \\times E \\to E$ is continuous. \n    \n      To show that $\\text{Gal}(E/F)$ is profinite we argue as follows (our argument is necessarily nonstandard because we have defined the topology before showing that the Galois group is an inverse limit of finite groups). By Topology, Lemma 5.30.4 it suffices to show that the underlying topological space of $\\text{Gal}(E/F)$ is profinite. For any subset $S \\subset E$ consider the set \n    \n      \n  \\[  G(S) = \\{  f : S \\to E \\mid \\begin{matrix}  f(\\alpha )\\text{ is a root of the minimal polynomial}\n\n\\\\  \\text{of }\\alpha \\text{ over }F\\text{ for all }\\alpha \\in S \n\n\\end{matrix} \\}   \\]\n\n    \n       Since a polynomial has only a finite number of roots we see that $G(S)$ is finite for all $S \\subset E$ finite. If $S \\subset S\'$ then restriction gives a map $G(S\') \\to G(S)$. Also, observe that if $\\alpha \\in S \\cap F$ and $f \\in G(S)$, then $f(\\alpha ) = \\alpha $ because the minimal polynomial is linear in this case. Consider the profinite topological space \n    \n      \n  \\[  G = \\mathop{\\mathrm{lim}}\\nolimits _{S \\subset E\\text{ finite}} G(S)  \\]\n\n    \n       Consider the canonical map \n    \n      \n  \\[  c : \\text{Gal}(E/F) \\longrightarrow G,\\quad \\sigma \\longmapsto (\\sigma |_ S : S \\to E)_ S  \\]\n\n    \n       This is injective and unwinding the definitions the reader sees the topology on $\\text{Gal}(E/F)$ as defined above is the induced topology from $G$. An element $(f_ S) \\in G$ is in the image of $c$ exactly if (A) $f_ S(\\alpha ) + f_ S(\\beta ) = f_ S(\\alpha + \\beta )$ and (M) $f_ S(\\alpha )f_ S(\\beta ) = f_ S(\\alpha \\beta )$ whenever this makes sense (i.e., $\\alpha , \\beta , \\alpha + \\beta , \\alpha \\beta \\in S$). Namely, this means $\\mathop{\\mathrm{lim}}\\nolimits f_ S : E \\to E$ will be an $F$-algebra map and hence an automorphism by Lemma 9.8.11. The conditions (A) and (M) for a given triple $(S, \\alpha , \\beta )$ define a closed subset of $G$ and hence $\\text{Gal}(E/F)$ is homeomorphic to a closed subset of a profinite space and therefore profinite itself. \n      $\\square$\n    \n","
  GroupFilterBasis.isTopologicalGroup (galGroupBasis K L)
",instance (K L : Type*) [Field K] [Field L] [Algebra K L] : IsTopologicalGroup Gal(L/K) ,"Proof.\n      Throughout this proof we think of $E$ as a discrete topological space. Recall that the compact open topology on the set of self maps $\\text{Map}(E, E)$ is the universal topology such that the action $\\text{Map}(E, E) \\times E \\to E$ is continuous. See Topology, Example 5.30.2 [[\n  Example 5.30.2. Let $E$ be a set. We can endow the set of self maps $\\text{Map}(E, E)$ with the compact open topology, i.e., the topology such that given $f : E \\to E$ a fundamental system of neighbourhoods of $f$ is given by the sets $U_ S(f) = \\{ f\' : E \\to E \\mid f\'|_ S = f|_ S\\} $ where $S \\subset E$ is finite. With this topology the action \n  \n  \\[  \\text{Map}(E, E) \\times E \\longrightarrow E,\\quad (f, e) \\longmapsto f(e)  \\]\n\n   is continuous when $E$ is given the discrete topology. If $X$ is a topological space and $X \\times E \\to E$ is a continuous map, then the map $X \\to \\text{Map}(E, E)$ is continuous. In other words, the compact open topology is the coarsest topology such that the \xe2\x80\x9caction\xe2\x80\x9d map displayed above is continuous. The composition \n  \n  \\[  \\text{Map}(E, E) \\times \\text{Map}(E, E) \\to \\text{Map}(E, E)  \\]\n\n   is continuous as well (as is easily verified using the description of neighbourhoods above). Finally, if $\\text{Aut}(E) \\subset \\text{Map}(E, E)$ is the subset of invertible maps, then the inverse $i : \\text{Aut}(E) \\to \\text{Aut}(E)$, $f \\mapsto f^{-1}$ is continuous too. Namely, say $S \\subset E$ is finite, then $i^{-1}(U_ S(f^{-1})) = U_{f^{-1}(S)}(f)$. Hence $\\text{Aut}(E)$ is a topological group as in Definition 5.30.1. \n]] for a precise statement. The topology of the lemma on $\\text{Gal}(E/F)$ is the induced topology coming from the injective map $\\text{Gal}(E/F) \\to \\text{Map}(E, E)$. Hence the universal property (1) follows from the corresponding universal property of the compact open topology. Since the set of invertible self maps $\\text{Aut}(E)$ endowed with the compact open topology forms a topological group, see Topology, Example 5.30.2 [[\n  Example 5.30.2. Let $E$ be a set. We can endow the set of self maps $\\text{Map}(E, E)$ with the compact open topology, i.e., the topology such that given $f : E \\to E$ a fundamental system of neighbourhoods of $f$ is given by the sets $U_ S(f) = \\{ f\' : E \\to E \\mid f\'|_ S = f|_ S\\} $ where $S \\subset E$ is finite. With this topology the action \n  \n  \\[  \\text{Map}(E, E) \\times E \\longrightarrow E,\\quad (f, e) \\longmapsto f(e)  \\]\n\n   is continuous when $E$ is given the discrete topology. If $X$ is a topological space and $X \\times E \\to E$ is a continuous map, then the map $X \\to \\text{Map}(E, E)$ is continuous. In other words, the compact open topology is the coarsest topology such that the \xe2\x80\x9caction\xe2\x80\x9d map displayed above is continuous. The composition \n  \n  \\[  \\text{Map}(E, E) \\times \\text{Map}(E, E) \\to \\text{Map}(E, E)  \\]\n\n   is continuous as well (as is easily verified using the description of neighbourhoods above). Finally, if $\\text{Aut}(E) \\subset \\text{Map}(E, E)$ is the subset of invertible maps, then the inverse $i : \\text{Aut}(E) \\to \\text{Aut}(E)$, $f \\mapsto f^{-1}$ is continuous too. Namely, say $S \\subset E$ is finite, then $i^{-1}(U_ S(f^{-1})) = U_{f^{-1}(S)}(f)$. Hence $\\text{Aut}(E)$ is a topological group as in Definition 5.30.1. \n]], and since $\\text{Gal}(E/F) = \\text{Aut}(E/F) \\to \\text{Map}(E, E)$ factors through $\\text{Aut}(E)$ we obtain a topological group. In other words, we are using the injection \n    \n      \n  \\[  \\text{Gal}(E/F) \\subset \\text{Aut}(E)  \\]\n\n    \n       to endow $\\text{Gal}(E/F)$ with the induced structure of a topological group (see Topology, Section 5.30 [[5.30 Topological groups, rings, modules\n\n\nThis is just a short section with definitions and elementary properties. \n\n\n\n  Definition 5.30.1. A topological group is a group $G$ endowed with a topology such that multiplication $G \\times G \\to G$, $(x, y) \\mapsto xy$ and inverse $G \\to G$, $x \\mapsto x^{-1}$ are continuous. A homomorphism of topological groups is a homomorphism of groups which is continuous. \n \n\n\nIf $G$ is a topological group and $H \\subset G$ is a subgroup, then $H$ with the induced topology is a topological group. If $G$ is a topological group and $G \\to H$ is a surjection of groups, then $H$ endowed with the quotient topology is a topological group. \n\n\n\n  Example 5.30.2. Let $E$ be a set. We can endow the set of self maps $\\text{Map}(E, E)$ with the compact open topology, i.e., the topology such that given $f : E \\to E$ a fundamental system of neighbourhoods of $f$ is given by the sets $U_ S(f) = \\{ f\' : E \\to E \\mid f\'|_ S = f|_ S\\} $ where $S \\subset E$ is finite. With this topology the action \n  \n  \\[  \\text{Map}(E, E) \\times E \\longrightarrow E,\\quad (f, e) \\longmapsto f(e)  \\]\n\n   is continuous when $E$ is given the discrete topology. If $X$ is a topological space and $X \\times E \\to E$ is a continuous map, then the map $X \\to \\text{Map}(E, E)$ is continuous. In other words, the compact open topology is the coarsest topology such that the \xe2\x80\x9caction\xe2\x80\x9d map displayed above is continuous. The composition \n  \n  \\[  \\text{Map}(E, E) \\times \\text{Map}(E, E) \\to \\text{Map}(E, E)  \\]\n\n   is continuous as well (as is easily verified using the description of neighbourhoods above). Finally, if $\\text{Aut}(E) \\subset \\text{Map}(E, E)$ is the subset of invertible maps, then the inverse $i : \\text{Aut}(E) \\to \\text{Aut}(E)$, $f \\mapsto f^{-1}$ is continuous too. Namely, say $S \\subset E$ is finite, then $i^{-1}(U_ S(f^{-1})) = U_{f^{-1}(S)}(f)$. Hence $\\text{Aut}(E)$ is a topological group as in Definition 5.30.1. \n \n\n\n\n  Lemma 5.30.3. The category of topological groups has limits and limits commute with the forgetful functors to (a) the category of topological spaces and (b) the category of groups. \n \n\n\n    \n]]) and by construction this is the coarsest structure of a topological group such that the action $\\text{Gal}(E/F) \\times E \\to E$ is continuous. \n    \n      To show that $\\text{Gal}(E/F)$ is profinite we argue as follows (our argument is necessarily nonstandard because we have defined the topology before showing that the Galois group is an inverse limit of finite groups). By Topology, Lemma 5.30.4 [[\n  Lemma 5.30.4. Let $G$ be a topological group. The following are equivalent \n  \n  \n$G$ as a topological space is profinite, \n\n\n$G$ is a limit of a diagram of finite discrete topological groups, \n\n\n$G$ is a cofiltered limit of finite discrete topological groups. \n\n\n\n\n    \n]] it suffices to show that the underlying topological space of $\\text{Gal}(E/F)$ is profinite. For any subset $S \\subset E$ consider the set \n    \n      \n  \\[  G(S) = \\{  f : S \\to E \\mid \\begin{matrix}  f(\\alpha )\\text{ is a root of the minimal polynomial}\n\n\\\\  \\text{of }\\alpha \\text{ over }F\\text{ for all }\\alpha \\in S \n\n\\end{matrix} \\}   \\]\n\n    \n       Since a polynomial has only a finite number of roots we see that $G(S)$ is finite for all $S \\subset E$ finite. If $S \\subset S\'$ then restriction gives a map $G(S\') \\to G(S)$. Also, observe that if $\\alpha \\in S \\cap F$ and $f \\in G(S)$, then $f(\\alpha ) = \\alpha $ because the minimal polynomial is linear in this case. Consider the profinite topological space \n    \n      \n  \\[  G = \\mathop{\\mathrm{lim}}\\nolimits _{S \\subset E\\text{ finite}} G(S)  \\]\n\n    \n       Consider the canonical map \n    \n      \n  \\[  c : \\text{Gal}(E/F) \\longrightarrow G,\\quad \\sigma \\longmapsto (\\sigma |_ S : S \\to E)_ S  \\]\n\n    \n       This is injective and unwinding the definitions the reader sees the topology on $\\text{Gal}(E/F)$ as defined above is the induced topology from $G$. An element $(f_ S) \\in G$ is in the image of $c$ exactly if (A) $f_ S(\\alpha ) + f_ S(\\beta ) = f_ S(\\alpha + \\beta )$ and (M) $f_ S(\\alpha )f_ S(\\beta ) = f_ S(\\alpha \\beta )$ whenever this makes sense (i.e., $\\alpha , \\beta , \\alpha + \\beta , \\alpha \\beta \\in S$). Namely, this means $\\mathop{\\mathrm{lim}}\\nolimits f_ S : E \\to E$ will be an $F$-algebra map and hence an automorphism by Lemma 9.8.11 [[\n  Lemma 9.8.11. Let $E/F$ an algebraic extension of fields. Any $F$-algebra map $f : E \\to E$ is an automorphism. \n\n    \n]]. The conditions (A) and (M) for a given triple $(S, \\alpha , \\beta )$ define a closed subset of $G$ and hence $\\text{Gal}(E/F)$ is homeomorphic to a closed subset of a profinite space and therefore profinite itself. \n      $\\square$\n    \n","Proof.\n      Throughout this proof we think of $E$ as a discrete topological space. Recall that the compact open topology on the set of self maps $\\text{Map}(E, E)$ is the universal topology such that the action $\\text{Map}(E, E) \\times E \\to E$ is continuous. See Topology, Example 5.30.2 [[\n  Example 5.30.2. Let $E$ be a set. We can endow the set of self maps $\\text{Map}(E, E)$ with the compact open topology, i.e., the topology such that given $f : E \\to E$ a fundamental system of neighbourhoods of $f$ is given by the sets $U_ S(f) = \\{ f\' : E \\to E \\mid f\'|_ S = f|_ S\\} $ where $S \\subset E$ is finite. With this topology the action \n  \n  \\[  \\text{Map}(E, E) \\times E \\longrightarrow E,\\quad (f, e) \\longmapsto f(e)  \\]\n\n   is continuous when $E$ is given the discrete topology. If $X$ is a topological space and $X \\times E \\to E$ is a continuous map, then the map $X \\to \\text{Map}(E, E)$ is continuous. In other words, the compact open topology is the coarsest topology such that the \xe2\x80\x9caction\xe2\x80\x9d map displayed above is continuous. The composition \n  \n  \\[  \\text{Map}(E, E) \\times \\text{Map}(E, E) \\to \\text{Map}(E, E)  \\]\n\n   is continuous as well (as is easily verified using the description of neighbourhoods above). Finally, if $\\text{Aut}(E) \\subset \\text{Map}(E, E)$ is the subset of invertible maps, then the inverse $i : \\text{Aut}(E) \\to \\text{Aut}(E)$, $f \\mapsto f^{-1}$ is continuous too. Namely, say $S \\subset E$ is finite, then $i^{-1}(U_ S(f^{-1})) = U_{f^{-1}(S)}(f)$. Hence $\\text{Aut}(E)$ is a topological group as in Definition 5.30.1. \n]] for a precise statement. The topology of the lemma on $\\text{Gal}(E/F)$ is the induced topology coming from the injective map $\\text{Gal}(E/F) \\to \\text{Map}(E, E)$. Hence the universal property (1) follows from the corresponding universal property of the compact open topology. Since the set of invertible self maps $\\text{Aut}(E)$ endowed with the compact open topology forms a topological group, see Topology, Example 5.30.2 [[\n  Example 5.30.2. Let $E$ be a set. We can endow the set of self maps $\\text{Map}(E, E)$ with the compact open topology, i.e., the topology such that given $f : E \\to E$ a fundamental system of neighbourhoods of $f$ is given by the sets $U_ S(f) = \\{ f\' : E \\to E \\mid f\'|_ S = f|_ S\\} $ where $S \\subset E$ is finite. With this topology the action \n  \n  \\[  \\text{Map}(E, E) \\times E \\longrightarrow E,\\quad (f, e) \\longmapsto f(e)  \\]\n\n   is continuous when $E$ is given the discrete topology. If $X$ is a topological space and $X \\times E \\to E$ is a continuous map, then the map $X \\to \\text{Map}(E, E)$ is continuous. In other words, the compact open topology is the coarsest topology such that the \xe2\x80\x9caction\xe2\x80\x9d map displayed above is continuous. The composition \n  \n  \\[  \\text{Map}(E, E) \\times \\text{Map}(E, E) \\to \\text{Map}(E, E)  \\]\n\n   is continuous as well (as is easily verified using the description of neighbourhoods above). Finally, if $\\text{Aut}(E) \\subset \\text{Map}(E, E)$ is the subset of invertible maps, then the inverse $i : \\text{Aut}(E) \\to \\text{Aut}(E)$, $f \\mapsto f^{-1}$ is continuous too. Namely, say $S \\subset E$ is finite, then $i^{-1}(U_ S(f^{-1})) = U_{f^{-1}(S)}(f)$. Hence $\\text{Aut}(E)$ is a topological group as in Definition 5.30.1. \n]], and since $\\text{Gal}(E/F) = \\text{Aut}(E/F) \\to \\text{Map}(E, E)$ factors through $\\text{Aut}(E)$ we obtain a topological group. In other words, we are using the injection \n    \n      \n  \\[  \\text{Gal}(E/F) \\subset \\text{Aut}(E)  \\]\n\n    \n       to endow $\\text{Gal}(E/F)$ with the induced structure of a topological group (see Topology, Section 5.30 [[5.30 Topological groups, rings, modules\n\n\nThis is just a short section with definitions and elementary properties. \n\n\n\n  Definition 5.30.1. A topological group is a group $G$ endowed with a topology such that multiplication $G \\times G \\to G$, $(x, y) \\mapsto xy$ and inverse $G \\to G$, $x \\mapsto x^{-1}$ are continuous. A homomorphism of topological groups is a homomorphism of groups which is continuous. \n \n\n\nIf $G$ is a topological group and $H \\subset G$ is a subgroup, then $H$ with the induced topology is a topological group. If $G$ is a topological group and $G \\to H$ is a surjection of groups, then $H$ endowed with the quotient topology is a topological group. \n\n\n\n  Example 5.30.2. Let $E$ be a set. We can endow the set of self maps $\\text{Map}(E, E)$ with the compact open topology, i.e., the topology such that given $f : E \\to E$ a fundamental system of neighbourhoods of $f$ is given by the sets $U_ S(f) = \\{ f\' : E \\to E \\mid f\'|_ S = f|_ S\\} $ where $S \\subset E$ is finite. With this topology the action \n  \n  \\[  \\text{Map}(E, E) \\times E \\longrightarrow E,\\quad (f, e) \\longmapsto f(e)  \\]\n\n   is continuous when $E$ is given the discrete topology. If $X$ is a topological space and $X \\times E \\to E$ is a continuous map, then the map $X \\to \\text{Map}(E, E)$ is continuous. In other words, the compact open topology is the coarsest topology such that the \xe2\x80\x9caction\xe2\x80\x9d map displayed above is continuous. The composition \n  \n  \\[  \\text{Map}(E, E) \\times \\text{Map}(E, E) \\to \\text{Map}(E, E)  \\]\n\n   is continuous as well (as is easily verified using the description of neighbourhoods above). Finally, if $\\text{Aut}(E) \\subset \\text{Map}(E, E)$ is the subset of invertible maps, then the inverse $i : \\text{Aut}(E) \\to \\text{Aut}(E)$, $f \\mapsto f^{-1}$ is continuous too. Namely, say $S \\subset E$ is finite, then $i^{-1}(U_ S(f^{-1})) = U_{f^{-1}(S)}(f)$. Hence $\\text{Aut}(E)$ is a topological group as in Definition 5.30.1. \n \n\n\n\n  Lemma 5.30.3. The category of topological groups has limits and limits commute with the forgetful functors to (a) the category of topological spaces and (b) the category of groups. \n \n\n\n    \n]]) and by construction this is the coarsest structure of a topological group such that the action $\\text{Gal}(E/F) \\times E \\to E$ is continuous. \n    \n      To show that $\\text{Gal}(E/F)$ is profinite we argue as follows (our argument is necessarily nonstandard because we have defined the topology before showing that the Galois group is an inverse limit of finite groups). By Topology, Lemma 5.30.4 [[\n  Lemma 5.30.4. Let $G$ be a topological group. The following are equivalent \n  \n  \n$G$ as a topological space is profinite, \n\n\n$G$ is a limit of a diagram of finite discrete topological groups, \n\n\n$G$ is a cofiltered limit of finite discrete topological groups. \n\n\n\n\n    \n]] it suffices to show that the underlying topological space of $\\text{Gal}(E/F)$ is profinite. For any subset $S \\subset E$ consider the set \n    \n      \n  \\[  G(S) = \\{  f : S \\to E \\mid \\begin{matrix}  f(\\alpha )\\text{ is a root of the minimal polynomial}\n\n\\\\  \\text{of }\\alpha \\text{ over }F\\text{ for all }\\alpha \\in S \n\n\\end{matrix} \\}   \\]\n\n    \n       Since a polynomial has only a finite number of roots we see that $G(S)$ is finite for all $S \\subset E$ finite. If $S \\subset S\'$ then restriction gives a map $G(S\') \\to G(S)$. Also, observe that if $\\alpha \\in S \\cap F$ and $f \\in G(S)$, then $f(\\alpha ) = \\alpha $ because the minimal polynomial is linear in this case. Consider the profinite topological space \n    \n      \n  \\[  G = \\mathop{\\mathrm{lim}}\\nolimits _{S \\subset E\\text{ finite}} G(S)  \\]\n\n    \n       Consider the canonical map \n    \n      \n  \\[  c : \\text{Gal}(E/F) \\longrightarrow G,\\quad \\sigma \\longmapsto (\\sigma |_ S : S \\to E)_ S  \\]\n\n    \n       This is injective and unwinding the definitions the reader sees the topology on $\\text{Gal}(E/F)$ as defined above is the induced topology from $G$. An element $(f_ S) \\in G$ is in the image of $c$ exactly if (A) $f_ S(\\alpha ) + f_ S(\\beta ) = f_ S(\\alpha + \\beta )$ and (M) $f_ S(\\alpha )f_ S(\\beta ) = f_ S(\\alpha \\beta )$ whenever this makes sense (i.e., $\\alpha , \\beta , \\alpha + \\beta , \\alpha \\beta \\in S$). Namely, this means $\\mathop{\\mathrm{lim}}\\nolimits f_ S : E \\to E$ will be an $F$-algebra map and hence an automorphism by Lemma 9.8.11 [[\n  Lemma 9.8.11. Let $E/F$ an algebraic extension of fields. Any $F$-algebra map $f : E \\to E$ is an automorphism. \n\n    \n]]. The conditions (A) and (M) for a given triple $(S, \\alpha , \\beta )$ define a closed subset of $G$ and hence $\\text{Gal}(E/F)$ is homeomorphic to a closed subset of a profinite space and therefore profinite itself. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: We define Krull topology directly without proving the universal property","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean term `GroupFilterBasis.isTopologicalGroup (galGroupBasis K L)` establishes that the group equipped with the filter basis `galGroupBasis` (i.e. the Krull topology as implemented via a group filter basis) is a topological group: continuity of multiplication and inversion follows from the `GroupFilterBasis` API. This matches the informal proof‚Äôs key conclusion that the Galois group with the chosen topology is a topological group (via induced topology from `Aut(E)` / compact-open style neighborhoods).\n\nStructurally, however, the informal proof proceeds by (1) recalling the compact-open topology on `Map(E,E)`, (2) showing `Aut(E)` is a topological group, and (3) giving `Gal(E/F)` the induced topological group structure, with discussion of a universal property. The Lean proof is a one-line invocation of a general lemma about group filter bases, and (per the user comment) does not formalize the universal property route. It also does not address the later profiniteness argument present in the informal text.\n\nSo the alignment is partial: the endpoint statement ‚Äúis a topological group‚Äù aligns, but the proof method and included content differ substantially (Lean uses the Krull-topology-via-filter-basis construction rather than compact-open/induced topology and universal property), and it omits major informal components (universal property and profiniteness).""}"
147,09HF,"theorem X_pow_sub_C_irreducible_of_prime {p : ‚Ñï} (hp : p.Prime) {a : K} (ha : ‚àÄ b : K, b ^ p ‚â† a) :
    Irreducible (X ^ p - C a) := by
  -- First of all, We may find an irreducible factor `g` of `X ^ p - C a`.
  have : ¬¨ IsUnit (X ^ p - C a) := by
    rw [Polynomial.isUnit_iff_degree_eq_zero, degree_X_pow_sub_C hp.pos, Nat.cast_eq_zero]
    exact hp.ne_zero
  have ‚ü®g, hg, hg'‚ü© := WfDvdMonoid.exists_irreducible_factor this (X_pow_sub_C_ne_zero hp.pos a)
  -- It suffices to show that `deg g = p`.
  suffices natDegree g = p from (associated_of_dvd_of_natDegree_le hg'
    (X_pow_sub_C_ne_zero hp.pos a) (this.trans natDegree_X_pow_sub_C.symm).ge).irreducible hg
  -- Suppose `deg g ‚â† p`.
  by_contra h
  -- Let `r` be a root of `g`, then `N_K(r) ^ p = N_K(r ^ p) = N_K(a) = a ^ (deg g)`.
  have key : (Algebra.norm K (AdjoinRoot.root g)) ^ p = a ^ g.natDegree := by
    have := eval‚ÇÇ_eq_zero_of_dvd_of_eval‚ÇÇ_eq_zero _ _ hg' (AdjoinRoot.eval‚ÇÇ_root g)
    rw [eval‚ÇÇ_sub, eval‚ÇÇ_pow, eval‚ÇÇ_C, eval‚ÇÇ_X, sub_eq_zero] at this
    rw [‚Üê map_pow, this, ‚Üê AdjoinRoot.algebraMap_eq, Algebra.norm_algebraMap,
      (powerBasis hg.ne_zero).finrank, powerBasis_dim hg.ne_zero]
  -- Since `a ^ (deg g)` is a `p`-power, and `p` is coprime to `deg g`, we conclude that `a` is
  -- also a `p`-power, contradicting the hypothesis
  have : p.Coprime (natDegree g) := hp.coprime_iff_not_dvd.mpr (fun e ‚Ü¶ h (((natDegree_le_of_dvd hg'
    (X_pow_sub_C_ne_zero hp.pos a)).trans_eq natDegree_X_pow_sub_C).antisymm (Nat.le_of_dvd
      (natDegree_pos_iff_degree_pos.mpr <| Polynomial.degree_pos_of_irreducible hg) e)))
  exact ha _ ((pow_mem_range_pow_of_coprime this.symm a).mp ‚ü®_, key‚ü©).choose_spec
",Formal Proof of Stacks Project Tag 09HF,We proved the result without the condition that `K` is char p in 09HF.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/KummerPolynomial.lean#L98-L121,Q27041,,9.14.2,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.2. Let $p$ be a prime number. Let $F$ be a field of characteristic $p$. Let $t \\in F$ be an element which does not have a $p$th root in $F$. Then the polynomial $x^ p - t$ is irreducible over $F$. \n\n    \n      Proof.\n      To see this, suppose that we have a factorization $x^ p - t = f g$. Taking derivatives we get $f\' g + f g\' = 0$. Note that neither $f\' = 0$ nor $g\' = 0$ as the degrees of $f$ and $g$ are smaller than $p$. Moreover, $\\deg (f\') < \\deg (f)$ and $\\deg (g\') < \\deg (g)$. We conclude that $f$ and $g$ have a factor in common. Thus if $x^ p - t$ is reducible, then it is of the form $x^ p - t = c f^ n$ for some irreducible $f$, $c \\in F^*$, and $n > 1$. Since $p$ is a prime number this implies $n = p$ and $f$ linear, which would imply $x^ p - t$ has a root in $F$. Contradiction. \n      $\\square$\n    \n",\n  Lemma 9.14.2. Let $p$ be a prime number. Let $F$ be a field of characteristic $p$. Let $t \\in F$ be an element which does not have a $p$th root in $F$. Then the polynomial $x^ p - t$ is irreducible over $F$. \n\n    \n,"Proof.\n      To see this, suppose that we have a factorization $x^ p - t = f g$. Taking derivatives we get $f\' g + f g\' = 0$. Note that neither $f\' = 0$ nor $g\' = 0$ as the degrees of $f$ and $g$ are smaller than $p$. Moreover, $\\deg (f\') < \\deg (f)$ and $\\deg (g\') < \\deg (g)$. We conclude that $f$ and $g$ have a factor in common. Thus if $x^ p - t$ is reducible, then it is of the form $x^ p - t = c f^ n$ for some irreducible $f$, $c \\in F^*$, and $n > 1$. Since $p$ is a prime number this implies $n = p$ and $f$ linear, which would imply $x^ p - t$ has a root in $F$. Contradiction. \n      $\\square$\n    \n"," by
  -- First of all, We may find an irreducible factor `g` of `X ^ p - C a`.
  have : ¬¨ IsUnit (X ^ p - C a) := by
    rw [Polynomial.isUnit_iff_degree_eq_zero, degree_X_pow_sub_C hp.pos, Nat.cast_eq_zero]
    exact hp.ne_zero
  have ‚ü®g, hg, hg'‚ü© := WfDvdMonoid.exists_irreducible_factor this (X_pow_sub_C_ne_zero hp.pos a)
  -- It suffices to show that `deg g = p`.
  suffices natDegree g = p from (associated_of_dvd_of_natDegree_le hg'
    (X_pow_sub_C_ne_zero hp.pos a) (this.trans natDegree_X_pow_sub_C.symm).ge).irreducible hg
  -- Suppose `deg g ‚â† p`.
  by_contra h
  -- Let `r` be a root of `g`, then `N_K(r) ^ p = N_K(r ^ p) = N_K(a) = a ^ (deg g)`.
  have key : (Algebra.norm K (AdjoinRoot.root g)) ^ p = a ^ g.natDegree := by
    have := eval‚ÇÇ_eq_zero_of_dvd_of_eval‚ÇÇ_eq_zero _ _ hg' (AdjoinRoot.eval‚ÇÇ_root g)
    rw [eval‚ÇÇ_sub, eval‚ÇÇ_pow, eval‚ÇÇ_C, eval‚ÇÇ_X, sub_eq_zero] at this
    rw [‚Üê map_pow, this, ‚Üê AdjoinRoot.algebraMap_eq, Algebra.norm_algebraMap,
      (powerBasis hg.ne_zero).finrank, powerBasis_dim hg.ne_zero]
  -- Since `a ^ (deg g)` is a `p`-power, and `p` is coprime to `deg g`, we conclude that `a` is
  -- also a `p`-power, contradicting the hypothesis
  have : p.Coprime (natDegree g) := hp.coprime_iff_not_dvd.mpr (fun e ‚Ü¶ h (((natDegree_le_of_dvd hg'
    (X_pow_sub_C_ne_zero hp.pos a)).trans_eq natDegree_X_pow_sub_C).antisymm (Nat.le_of_dvd
      (natDegree_pos_iff_degree_pos.mpr <| Polynomial.degree_pos_of_irreducible hg) e)))
  exact ha _ ((pow_mem_range_pow_of_coprime this.symm a).mp ‚ü®_, key‚ü©).choose_spec
","theorem X_pow_sub_C_irreducible_of_prime {p : ‚Ñï} (hp : p.Prime) {a : K} (ha : ‚àÄ b : K, b ^ p ‚â† a) :
    Irreducible (X ^ p - C a) ","Proof.\n      To see this, suppose that we have a factorization $x^ p - t = f g$. Taking derivatives we get $f\' g + f g\' = 0$. Note that neither $f\' = 0$ nor $g\' = 0$ as the degrees of $f$ and $g$ are smaller than $p$. Moreover, $\\deg (f\') < \\deg (f)$ and $\\deg (g\') < \\deg (g)$. We conclude that $f$ and $g$ have a factor in common. Thus if $x^ p - t$ is reducible, then it is of the form $x^ p - t = c f^ n$ for some irreducible $f$, $c \\in F^*$, and $n > 1$. Since $p$ is a prime number this implies $n = p$ and $f$ linear, which would imply $x^ p - t$ has a root in $F$. Contradiction. \n      $\\square$\n    \n","Proof.\n      To see this, suppose that we have a factorization $x^ p - t = f g$. Taking derivatives we get $f\' g + f g\' = 0$. Note that neither $f\' = 0$ nor $g\' = 0$ as the degrees of $f$ and $g$ are smaller than $p$. Moreover, $\\deg (f\') < \\deg (f)$ and $\\deg (g\') < \\deg (g)$. We conclude that $f$ and $g$ have a factor in common. Thus if $x^ p - t$ is reducible, then it is of the form $x^ p - t = c f^ n$ for some irreducible $f$, $c \\in F^*$, and $n > 1$. Since $p$ is a prime number this implies $n = p$ and $f$ linear, which would imply $x^ p - t$ has a root in $F$. Contradiction. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: We proved the result without the condition that `K` is char p in 09HF.","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is a standard separability/derivative argument in characteristic p: from a factorization of x^p ‚àí t, differentiating gives f'g + fg' = 0, forcing a common factor and ultimately showing any reducible case would be a p-th power, hence would yield a root in F, contradiction. The Lean proof does not use derivatives, characteristic p, or gcd/common-factor reasoning at all. Instead it picks an irreducible factor g of X^p ‚àí C a, adjoins a root r of g, applies the field norm to derive (Norm r)^p = a^(deg g), then uses coprimality of p and deg g to conclude a is a p-th power, contradicting a hypothesis ha. Structurally and semantically these are different proofs of (apparently) different statements: the Lean argument is a norm/coprime-exponent argument about degrees of irreducible factors, not the derivative-based irreducibility criterion in char p. The added comment about not needing char p further highlights the mismatch, since the informal proof crucially relies on char p via (x^p)' = 0.""}"
149,030N,"theorem exists_primitive_element : ‚àÉ Œ± : E, F‚üÆŒ±‚üØ = ‚ä§ := by
  rcases isEmpty_or_nonempty (Fintype F) with (F_inf | ‚ü®‚ü®F_finite‚ü©‚ü©)
  ¬∑ let P : IntermediateField F E ‚Üí Prop := fun K => ‚àÉ Œ± : E, F‚üÆŒ±‚üØ = K
    have base : P ‚ä• := ‚ü®0, adjoin_zero‚ü©
    have ih : ‚àÄ (K : IntermediateField F E) (x : E), P K ‚Üí P (K‚üÆx‚üØ.restrictScalars F) := by
      intro K Œ≤ hK
      obtain ‚ü®Œ±, hK‚ü© := hK
      rw [‚Üê hK, adjoin_simple_adjoin_simple]
      haveI : Infinite F := isEmpty_fintype.mp F_inf
      obtain ‚ü®Œ≥, hŒ≥‚ü© := primitive_element_inf_aux F Œ± Œ≤
      exact ‚ü®Œ≥, hŒ≥.symm‚ü©
    exact induction_on_adjoin P base ih ‚ä§
  ¬∑ exact exists_primitive_element_of_finite_bot F E
",Formal Proof of Stacks Project Tag 030N,The moreover part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PrimitiveElement.lean#L213-L225,Q27041,Primitive element,9.19.1,lemma,3.0,"['09HZ', '09FA', '0ELQ']","\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n      Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n","\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n","Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n"," by
  rcases isEmpty_or_nonempty (Fintype F) with (F_inf | ‚ü®‚ü®F_finite‚ü©‚ü©)
  ¬∑ let P : IntermediateField F E ‚Üí Prop := fun K => ‚àÉ Œ± : E, F‚üÆŒ±‚üØ = K
    have base : P ‚ä• := ‚ü®0, adjoin_zero‚ü©
    have ih : ‚àÄ (K : IntermediateField F E) (x : E), P K ‚Üí P (K‚üÆx‚üØ.restrictScalars F) := by
      intro K Œ≤ hK
      obtain ‚ü®Œ±, hK‚ü© := hK
      rw [‚Üê hK, adjoin_simple_adjoin_simple]
      haveI : Infinite F := isEmpty_fintype.mp F_inf
      obtain ‚ü®Œ≥, hŒ≥‚ü© := primitive_element_inf_aux F Œ± Œ≤
      exact ‚ü®Œ≥, hŒ≥.symm‚ü©
    exact induction_on_adjoin P base ih ‚ä§
  ¬∑ exact exists_primitive_element_of_finite_bot F E
","theorem exists_primitive_element : ‚àÉ Œ± : E, F‚üÆŒ±‚üØ = ‚ä§ ","Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18 [[9.18 Finite fields\n\n\nLet $F$ be a finite field. It is clear that $F$ has positive characteristic as we cannot have an injection $\\mathbf{Q} \\to F$. Say the characteristic of $F$ is $p$. The extension $\\mathbf{F}_ p \\subset F$ is finite. Hence we see that $F$ has $q = p^ f$ elements for some $f \\geq 1$. \n\n\nLet us think about the group of units $F^*$. This is a finite abelian group, so it has some exponent $e$. Then $F^* = \\mu _ e(F)$ and we see from the discussion in Section 9.17 that $F^*$ is a cyclic group of order $q - 1$. (A posteriori it follows that $e = q - 1$ as well.) In particular, if $\\alpha \\in F^*$ is a generator then it clearly is true that \n\n\n  \\[  F = \\mathbf{F}_ p(\\alpha )  \\]\n\n\n In other words, the extension $F/\\mathbf{F}_ p$ is generated by a single element. Of course, the same thing is true for any extension of finite fields $E/F$ (because $E$ is already generated by a single element over the prime field). \n\n]]. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]]. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18 [[9.18 Finite fields\n\n\nLet $F$ be a finite field. It is clear that $F$ has positive characteristic as we cannot have an injection $\\mathbf{Q} \\to F$. Say the characteristic of $F$ is $p$. The extension $\\mathbf{F}_ p \\subset F$ is finite. Hence we see that $F$ has $q = p^ f$ elements for some $f \\geq 1$. \n\n\nLet us think about the group of units $F^*$. This is a finite abelian group, so it has some exponent $e$. Then $F^* = \\mu _ e(F)$ and we see from the discussion in Section 9.17 that $F^*$ is a cyclic group of order $q - 1$. (A posteriori it follows that $e = q - 1$ as well.) In particular, if $\\alpha \\in F^*$ is a generator then it clearly is true that \n\n\n  \\[  F = \\mathbf{F}_ p(\\alpha )  \\]\n\n\n In other words, the extension $F/\\mathbf{F}_ p$ is generated by a single element. Of course, the same thing is true for any extension of finite fields $E/F$ (because $E$ is already generated by a single element over the prime field). \n\n]]. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]]. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: The moreover part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about existence of a primitive element (showing ‚ä§ is a simple extension F‚üÆŒ±‚üØ) by splitting into the cases ‚ÄúF is infinite‚Äù vs ‚ÄúF is finite‚Äù using `isEmpty_or_nonempty (Fintype F)`. In the infinite case it uses an induction on adjoining elements (`induction_on_adjoin`) plus an auxiliary lemma `primitive_element_inf_aux` to combine two simple extensions into one; in the finite case it invokes `exists_primitive_element_of_finite_bot`. This does not match the informal proof‚Äôs main argument, which is the ‚Äòmoreover‚Äô part: finiteness of intermediate fields via minimal polynomials and finiteness of monic factors, and then using ‚Äúfinite union of proper subspaces‚Äù to pick an element outside all proper intermediate fields. Structurally, the informal proof proceeds through (i) bounding the number of intermediate fields, (ii) choosing Œ± outside their union, and (iii) a separability/morphism-count argument; none of these steps appear in the Lean code. The Lean code instead proves primitive element directly by adjoin-induction and a separate finite-field lemma, without addressing the ‚Äòmoreover‚Äô finiteness-of-intermediate-fields statement. Hence the alignment is low: the conclusion overlaps partially (primitive element existence), but the ‚Äòmoreover‚Äô content and proof structure are largely absent.""}"
150,030N,"theorem exists_primitive_element_iff_finite_intermediateField :
    (Algebra.IsAlgebraic F E ‚àß ‚àÉ Œ± : E, F‚üÆŒ±‚üØ = ‚ä§) ‚Üî Finite (IntermediateField F E) :=
  ‚ü®fun ‚ü®_, h‚ü© ‚Ü¶ finite_intermediateField_of_exists_primitive_element F E h,
    fun _ ‚Ü¶ ‚ü®isAlgebraic_of_finite_intermediateField F E,
      exists_primitive_element_of_finite_intermediateField F E _‚ü©‚ü©
",Formal Proof of Stacks Project Tag 030N,Equivalence of (1) & (2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PrimitiveElement.lean#L337-L341,Q27041,Primitive element,9.19.1,lemma,3.0,"['09HZ', '09FA', '0ELQ']","\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n      Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n","\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n","Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n","
  ‚ü®fun ‚ü®_, h‚ü© ‚Ü¶ finite_intermediateField_of_exists_primitive_element F E h,
    fun _ ‚Ü¶ ‚ü®isAlgebraic_of_finite_intermediateField F E,
      exists_primitive_element_of_finite_intermediateField F E _‚ü©‚ü©
","theorem exists_primitive_element_iff_finite_intermediateField :
    (Algebra.IsAlgebraic F E ‚àß ‚àÉ Œ± : E, F‚üÆŒ±‚üØ = ‚ä§) ‚Üî Finite (IntermediateField F E) ","Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18 [[9.18 Finite fields\n\n\nLet $F$ be a finite field. It is clear that $F$ has positive characteristic as we cannot have an injection $\\mathbf{Q} \\to F$. Say the characteristic of $F$ is $p$. The extension $\\mathbf{F}_ p \\subset F$ is finite. Hence we see that $F$ has $q = p^ f$ elements for some $f \\geq 1$. \n\n\nLet us think about the group of units $F^*$. This is a finite abelian group, so it has some exponent $e$. Then $F^* = \\mu _ e(F)$ and we see from the discussion in Section 9.17 that $F^*$ is a cyclic group of order $q - 1$. (A posteriori it follows that $e = q - 1$ as well.) In particular, if $\\alpha \\in F^*$ is a generator then it clearly is true that \n\n\n  \\[  F = \\mathbf{F}_ p(\\alpha )  \\]\n\n\n In other words, the extension $F/\\mathbf{F}_ p$ is generated by a single element. Of course, the same thing is true for any extension of finite fields $E/F$ (because $E$ is already generated by a single element over the prime field). \n\n]]. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]]. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha \\in E$ be a primitive element. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Next, let $E/K/F$ be a subextension. Let $Q$ be the minimal polynomial of $\\alpha $ over $K$. Observe that $\\deg (Q) = [E : K]$. Writing $Q = x^ d + \\sum _{i < d} a_ i x^ i$ we claim that $K$ is equal to $L = F(a_0, \\ldots , a_{d - 1})$. Indeed $\\alpha $ has degree $d$ over $L$ and $L \\subset K$. Hence $[E : L] = [E : K]$ and it follows that $[K : L] = 1$, i.e., $K = L$. Thus it suffices to show there are at most finitely many possibilities for the polynomial $Q$. This is clear because we have a factorization $P = QR$ in $K[x]$ in particular in $E[x]$. Since we have unique factorization in $E[x]$ there are at most finitely many monic factors of $P$ in $E[x]$. \n    \n      If $F$ is a finite field (equivalently $E$ is a finite field), then $E/F$ has a primitive element by the discussion in Section 9.18 [[9.18 Finite fields\n\n\nLet $F$ be a finite field. It is clear that $F$ has positive characteristic as we cannot have an injection $\\mathbf{Q} \\to F$. Say the characteristic of $F$ is $p$. The extension $\\mathbf{F}_ p \\subset F$ is finite. Hence we see that $F$ has $q = p^ f$ elements for some $f \\geq 1$. \n\n\nLet us think about the group of units $F^*$. This is a finite abelian group, so it has some exponent $e$. Then $F^* = \\mu _ e(F)$ and we see from the discussion in Section 9.17 that $F^*$ is a cyclic group of order $q - 1$. (A posteriori it follows that $e = q - 1$ as well.) In particular, if $\\alpha \\in F^*$ is a generator then it clearly is true that \n\n\n  \\[  F = \\mathbf{F}_ p(\\alpha )  \\]\n\n\n In other words, the extension $F/\\mathbf{F}_ p$ is generated by a single element. Of course, the same thing is true for any extension of finite fields $E/F$ (because $E$ is already generated by a single element over the prime field). \n\n]]. Next, assume $F$ is infinite and there are at most finitely many proper subfields $E/K/F$. List them, say $K_1, \\ldots , K_ N$. Then each $K_ i \\subset E$ is a proper sub $F$-vector space. As $F$ is infinite we can find a vector $\\alpha \\in E$ with $\\alpha \\not\\in K_ i$ for all $i$ (a vector space can never be equal to a finite union of proper subvector spaces; details omitted). Then $\\alpha $ is a primitive element for $E$ over $F$. \n    \n      Having established the equivalence of (1) and (2) we now turn to the final statement of the lemma. Choose an algebraic closure $\\overline{F}$ of $F$. Enumerate the elements $\\sigma _1, \\ldots , \\sigma _ n \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Since $E/F$ is separable we have $n = [E : F]$ by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]]. Note that if $i \\not= j$, then \n    \n      \n  \\[  V_{ij} = \\mathop{\\mathrm{Ker}}(\\sigma _ i - \\sigma _ j : E \\longrightarrow \\overline{F})  \\]\n\n    \n       is not equal to $E$. Hence arguing as in the preceding paragraph we can find $\\alpha \\in E$ with $\\alpha \\not\\in V_{ij}$ for all $i \\not= j$. It follows that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})| \\geq n$. On the other hand $[F(\\alpha ) : F] \\leq [E : F]$. Hence equality by Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] and we conclude that $E = F(\\alpha )$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Equivalence of (1) & (2)","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean term is proving an equivalence between two conditions: (i) from an existence of a primitive element it derives finiteness of intermediate fields (via `finite_intermediateField_of_exists_primitive_element`), and (ii) from finiteness of intermediate fields it derives existence of a primitive element, packaging also an algebraicity hypothesis (`isAlgebraic_of_finite_intermediateField`) and then applying `exists_primitive_element_of_finite_intermediateField`. This matches the user comment that the relevant part is the equivalence of (1) and (2).\n\nStructurally, however, the informal proof‚Äôs (1)‚Üí(2) direction proceeds by detailed minimal-polynomial/factorization arguments to show only finitely many intermediate fields, while the Lean proof simply invokes a lemma encapsulating that result, so the internal structure is not reflected. Likewise, the informal (2)‚Üí(1) direction splits into cases (finite base field vs infinite base field) and uses a vector-space union argument; the Lean proof again uses a single lemma and additionally inserts an `isAlgebraic` component not explicitly part of the informal equivalence discussion. Thus the high-level logical content aligns, but the formal proof is more abstract/black-box and includes extra packaged hypotheses, giving only moderate alignment.""}"
152,09H3,"theorem nodup_aroots_iff_of_splits [Algebra F K] {f : F[X]} (hf : f ‚â† 0)
    (h : (f.map (algebraMap F K)).Splits) : (f.aroots K).Nodup ‚Üî f.Separable := by
  rw [nodup_roots_iff_of_splits (map_ne_zero hf) h, separable_map]
",Formal Proof of Stacks Project Tag 09H3,Here we only require `f` splits instead of `K` is algebraically closed.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Separable.lean#L478-L480,Q27041,,9.12.4,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n      Proof.\n      Suppose that $\\alpha \\in \\overline{F}$ is a root of both $P$ and $P\'$. Then $P = (x - \\alpha )Q$ for some polynomial $Q$. Taking derivatives we obtain $P\' = Q + (x - \\alpha )Q\'$. Thus $\\alpha $ is a root of $Q$. Hence we see that if $P$ and $P\'$ have a common root, then $P$ does not have pairwise distinct roots. Conversely, if $P$ has a repeated root, i.e., $(x - \\alpha )^2$ divides $P$, then $\\alpha $ is a root of both $P$ and $P\'$. Combined with Lemma 9.11.2 this proves the lemma. \n      $\\square$\n    \n",\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n,"Proof.\n      Suppose that $\\alpha \\in \\overline{F}$ is a root of both $P$ and $P\'$. Then $P = (x - \\alpha )Q$ for some polynomial $Q$. Taking derivatives we obtain $P\' = Q + (x - \\alpha )Q\'$. Thus $\\alpha $ is a root of $Q$. Hence we see that if $P$ and $P\'$ have a common root, then $P$ does not have pairwise distinct roots. Conversely, if $P$ has a repeated root, i.e., $(x - \\alpha )^2$ divides $P$, then $\\alpha $ is a root of both $P$ and $P\'$. Combined with Lemma 9.11.2 this proves the lemma. \n      $\\square$\n    \n"," by
  rw [nodup_roots_iff_of_splits (map_ne_zero hf) h, separable_map]
","theorem nodup_aroots_iff_of_splits [Algebra F K] {f : F[X]} (hf : f ‚â† 0)
    (h : (f.map (algebraMap F K)).Splits) : (f.aroots K).Nodup ‚Üî f.Separable ","Proof.\n      Suppose that $\\alpha \\in \\overline{F}$ is a root of both $P$ and $P\'$. Then $P = (x - \\alpha )Q$ for some polynomial $Q$. Taking derivatives we obtain $P\' = Q + (x - \\alpha )Q\'$. Thus $\\alpha $ is a root of $Q$. Hence we see that if $P$ and $P\'$ have a common root, then $P$ does not have pairwise distinct roots. Conversely, if $P$ has a repeated root, i.e., $(x - \\alpha )^2$ divides $P$, then $\\alpha $ is a root of both $P$ and $P\'$. Combined with Lemma 9.11.2 [[\n  Lemma 9.11.2. Two polynomials in $k[x]$ are relatively prime precisely when they have no common roots in an algebraic closure $\\overline{k}$ of $k$. \n\n    \n]] this proves the lemma. \n      $\\square$\n    \n","Proof.\n      Suppose that $\\alpha \\in \\overline{F}$ is a root of both $P$ and $P\'$. Then $P = (x - \\alpha )Q$ for some polynomial $Q$. Taking derivatives we obtain $P\' = Q + (x - \\alpha )Q\'$. Thus $\\alpha $ is a root of $Q$. Hence we see that if $P$ and $P\'$ have a common root, then $P$ does not have pairwise distinct roots. Conversely, if $P$ has a repeated root, i.e., $(x - \\alpha )^2$ divides $P$, then $\\alpha $ is a root of both $P$ and $P\'$. Combined with Lemma 9.11.2 [[\n  Lemma 9.11.2. Two polynomials in $k[x]$ are relatively prime precisely when they have no common roots in an algebraic closure $\\overline{k}$ of $k$. \n\n    \n]] this proves the lemma. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Here we only require `f` splits instead of `K` is algebraically closed.","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the informal proof argues the classical equivalence: a polynomial has no repeated roots (is separable / has nodup roots) iff it has no common root with its derivative, and then uses the lemma ‚Äúcoprime iff no common roots in an algebraic closure‚Äù to translate this into a gcd/coprime statement. The Lean proof, however, is just a rewrite step: it rewrites the goal using `nodup_roots_iff_of_splits (map_ne_zero hf) h` (capturing the ‚Äòsplits‚Äô hypothesis rather than algebraic closedness, matching the given comment) and then `separable_map`. This indicates the Lean proof is relying on existing library lemmas that already package the equivalence, rather than reproducing the derivative/root argument.\n\nStructurally, the informal proof is constructive and two-directional (common root with derivative ‚Üî repeated root) plus an extra lemma about coprimality vs common roots. The Lean proof has no visible two-directional reasoning or explicit use of the coprime/common-root lemma; it compresses everything into rewriting by pre-proved equivalences. So while the end result likely matches the same statement (especially given the ‚Äòsplits‚Äô condition), the correspondence is indirect and the structure of the informal argument is not reflected in the Lean code.""}"
154,09H2,"theorem IsSeparable.tower_top
    {x : E} (h : IsSeparable F x) : IsSeparable L x :=
  .of_dvd (.map h) (minpoly.dvd_map_of_isScalarTower ..)
",Formal Proof of Stacks Project Tag 09H2,first part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Separable.lean#L639-L641,Q27041,,9.12.3,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n      Proof.\n      We will use Lemma 9.12.1 without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n","\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n","Proof.\n      We will use Lemma 9.12.1 without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n","
  .of_dvd (.map h) (minpoly.dvd_map_of_isScalarTower ..)
","theorem IsSeparable.tower_top
    {x : E} (h : IsSeparable F x) : IsSeparable L x ","Proof.\n      We will use Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]] without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n","Proof.\n      We will use Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]] without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: first part","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about minimal polynomials over a tower F ‚äÜ E, using the derivative and a lemma about an irreducible polynomial being either coprime to its derivative or having zero derivative, to deduce a statement (1) about P‚Ä≤=0 when Q‚Ä≤=0, and then (2) from definitions. The Lean snippet `.of_dvd (.map h) (minpoly.dvd_map_of_isScalarTower ..)` instead constructs a divisibility statement after mapping a polynomial along a ring homomorphism `h`, using a lemma `minpoly.dvd_map_of_isScalarTower`. There is no appearance of derivatives, coprimality, characteristic p, or the key argument involving P‚Ä≤ = Q‚Ä≤R + QR‚Ä≤. Structurally, the informal proof proceeds by factoring P=QR in E[x] and analyzing derivatives; the Lean proof is a one-line application of a minpoly divisibility lemma under scalar tower and mapping, which corresponds at best to the preliminary fact ‚ÄúQ divides P in E[x]‚Äù but not to the derivative-based conclusion. Overall the formal proof captures only a small, different fragment and misses the main content, so alignment is very low.""}"
155,09H2,"theorem Algebra.isSeparable_tower_top_of_isSeparable [Algebra.IsSeparable F E] :
    Algebra.IsSeparable L E :=
  ‚ü®fun x ‚Ü¶ IsSeparable.tower_top _ (Algebra.IsSeparable.isSeparable F x)‚ü©
",Formal Proof of Stacks Project Tag 09H2,second part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Separable.lean#L647-L649,Q27041,,9.12.3,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n      Proof.\n      We will use Lemma 9.12.1 without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n","\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n","Proof.\n      We will use Lemma 9.12.1 without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n","
  ‚ü®fun x ‚Ü¶ IsSeparable.tower_top _ (Algebra.IsSeparable.isSeparable F x)‚ü©
","theorem Algebra.isSeparable_tower_top_of_isSeparable [Algebra.IsSeparable F E] :
    Algebra.IsSeparable L E ","Proof.\n      We will use Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]] without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n","Proof.\n      We will use Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]] without further mention. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Then $P\' = Q\'R + QR\'$. Thus if $Q\' = 0$, then $Q$ divides $P$ and $P\'$ hence $P\' = 0$ by the lemma. This proves (1). Part (2) follows immediately from (1) and the definitions. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: second part","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof argues about minimal polynomials, their derivatives, and a lemma on irreducible polynomials vs. their derivatives to deduce a statement (1) and then a statement (2) from definitions. In contrast, the Lean term is a one-line construction using `IsSeparable.tower_top` applied to `Algebra.IsSeparable.isSeparable F x`, i.e. it proves separability in a tower of extensions by invoking an existing separability lemma, with no mention of minimal polynomials, derivatives, characteristic p, or the divisibility argument. Structurally, the informal proof is a multi-step polynomial/derivative argument, while the formal proof is a direct application of a separability-tower lemma. Semantically, they do not match: the Lean proof establishes separability via tower properties, whereas the informal proof establishes a derivative/minimal-polynomial criterion and then a separability conclusion. Hence the alignment is very low.""}"
156,09HC,"def separableClosure : IntermediateField F E where
  carrier := {x | IsSeparable F x}
  mul_mem' := isSeparable_mul
  add_mem' := isSeparable_add
  algebraMap_mem' := isSeparable_algebraMap
  inv_mem' _ := isSeparable_inv
",Formal Proof of Stacks Project Tag 09HC,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableClosure.lean#L82-L87,Q27041,,9.12.13,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.13. Let $E/k$ be a field extension. Then the elements of $E$ separable over $k$ form a subextension of $E/k$. \n\n    \n      Proof.\n      Let $\\alpha , \\beta \\in E$ be separable over $k$. Then $\\beta $ is separable over $k(\\alpha )$ by Lemma 9.12.3. By Lemma 9.12.10 (applied with $n = 2$, $\\alpha _1 = \\alpha $, and $\\alpha _2 = \\beta $) we see that $k(\\alpha , \\beta )$ is separable over $k$. \n      $\\square$\n    \n",\n  Lemma 9.12.13. Let $E/k$ be a field extension. Then the elements of $E$ separable over $k$ form a subextension of $E/k$. \n\n    \n,"Proof.\n      Let $\\alpha , \\beta \\in E$ be separable over $k$. Then $\\beta $ is separable over $k(\\alpha )$ by Lemma 9.12.3. By Lemma 9.12.10 (applied with $n = 2$, $\\alpha _1 = \\alpha $, and $\\alpha _2 = \\beta $) we see that $k(\\alpha , \\beta )$ is separable over $k$. \n      $\\square$\n    \n"," {x | IsSeparable F x}
  mul_mem' := isSeparable_mul
  add_mem' := isSeparable_add
  algebraMap_mem' := isSeparable_algebraMap
  inv_mem' _ := isSeparable_inv
","def separableClosure : IntermediateField F E where
  carrier ","Proof.\n      Let $\\alpha , \\beta \\in E$ be separable over $k$. Then $\\beta $ is separable over $k(\\alpha )$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]]. By Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]] (applied with $n = 2$, $\\alpha _1 = \\alpha $, and $\\alpha _2 = \\beta $) we see that $k(\\alpha , \\beta )$ is separable over $k$. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha , \\beta \\in E$ be separable over $k$. Then $\\beta $ is separable over $k(\\alpha )$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]]. By Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]] (applied with $n = 2$, $\\alpha _1 = \\alpha $, and $\\alpha _2 = \\beta $) we see that $k(\\alpha , \\beta )$ is separable over $k$. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the formal proof is establishing that the set {x | IsSeparable F x} is closed under the field/subalgebra operations (multiplication, addition, algebraMap, and inversion) by invoking lemmas `isSeparable_mul`, `isSeparable_add`, `isSeparable_algebraMap`, and `isSeparable_inv`. The informal proof, however, argues that if Œ± and Œ≤ are separable over k then the compositum/simple extension k(Œ±,Œ≤) is separable over k, using tower/separability lemmas (Œ≤ separable over k(Œ±), then a lemma about adjoining separable elements implies the whole extension is separable). Structurally, the informal proof is about separability of a generated field extension and uses a two-step tower argument, while the formal proof is a closure-properties construction with no mention of adjoining elements or field extensions like k(Œ±,Œ≤). There is only a loose thematic connection (separability is stable under certain constructions), but the specific statement and proof strategy do not correspond.""}"
157,030K,"instance separableClosure.isSeparable : Algebra.IsSeparable F (separableClosure F E) :=
  ‚ü®fun x ‚Ü¶ by simpa only [IsSeparable, minpoly_eq] using x.2‚ü©
",Formal Proof of Stacks Project Tag 030K,$E_{sep}/F$ is separable,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableClosure.lean#L150-L151,Q27041,,9.14.6,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n      Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n",\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n,"Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n","
  ‚ü®fun x ‚Ü¶ by simpa only [IsSeparable, minpoly_eq] using x.2‚ü©
",instance separableClosure.isSeparable : Algebra.IsSeparable F (separableClosure F E) ,"Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 [[\n  Lemma 9.12.13. Let $E/k$ be a field extension. Then the elements of $E$ separable over $k$ form a subextension of $E/k$. \n\n    \n]] and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]]. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n","Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 [[\n  Lemma 9.12.13. Let $E/k$ be a field extension. Then the elements of $E$ separable over $k$ form a subextension of $E/k$. \n\n    \n]] and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]]. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: $E_{sep}/F$ is separable","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term proves a very local statement: it constructs a function taking an element `x` (apparently of a subtype) and shows `IsSeparable` for it by rewriting with `[IsSeparable, minpoly_eq]` and using `x.2` (the stored proof in the subtype). This matches only the small claim that elements of `E_sep` are separable over `F` (i.e. `E_sep/F` is separable) and does not address the main informal argument about existence of a maximal separable subextension, the p-power `q` making Œ±^q separable, or the purely inseparable quotient and uniqueness. Structurally, the informal proof is a multi-step construction using lemmas about derivatives/minimal polynomials and subextensions, whereas the Lean proof is a one-line coercion/simplification extracting separability from a definition. Thus it aligns with the specified comment (\""E_sep/F is separable\"") but not with the full informal proof.""}"
158,0EXK,"instance separableClosure.isGalois [Normal F E] : IsGalois F (separableClosure F E) where
  to_isSeparable := separableClosure.isSeparable F E
  to_normal := by
    rw [‚Üê separableClosure.normalClosure_eq_self]
    exact normalClosure.normal F _ E
",Formal Proof of Stacks Project Tag 0EXK,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableClosure.lean#L186-L190,Q27041,,9.15.4,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.4. Let $E/F$ be a normal algebraic field extension. Then the subextension $E/E_{sep}/F$ of Lemma 9.14.6 is normal. \n\n    \n      Proof.\n      If the characteristic is zero, then $E_{sep} = E$, and the result is clear. If the characteristic is $p > 0$, then $E_{sep}$ is the set of elements of $E$ which are separable over $F$. Then if $\\alpha \\in E_{sep}$ has minimal polynomial $P$ write $P = c(x - \\alpha )(x - \\alpha _2) \\ldots (x - \\alpha _ d)$ with $\\alpha _2, \\ldots , \\alpha _ d \\in E$. Since $P$ is a separable polynomial and since $\\alpha _ i$ is a root of $P$, we conclude $\\alpha _ i \\in E_{sep}$ as desired. \n      $\\square$\n    \n",\n  Lemma 9.15.4. Let $E/F$ be a normal algebraic field extension. Then the subextension $E/E_{sep}/F$ of Lemma 9.14.6 is normal. \n\n    \n,"Proof.\n      If the characteristic is zero, then $E_{sep} = E$, and the result is clear. If the characteristic is $p > 0$, then $E_{sep}$ is the set of elements of $E$ which are separable over $F$. Then if $\\alpha \\in E_{sep}$ has minimal polynomial $P$ write $P = c(x - \\alpha )(x - \\alpha _2) \\ldots (x - \\alpha _ d)$ with $\\alpha _2, \\ldots , \\alpha _ d \\in E$. Since $P$ is a separable polynomial and since $\\alpha _ i$ is a root of $P$, we conclude $\\alpha _ i \\in E_{sep}$ as desired. \n      $\\square$\n    \n"," separableClosure.isSeparable F E
  to_normal := by
    rw [‚Üê separableClosure.normalClosure_eq_self]
    exact normalClosure.normal F _ E
","instance separableClosure.isGalois [Normal F E] : IsGalois F (separableClosure F E) where
  to_isSeparable ","Proof.\n      If the characteristic is zero, then $E_{sep} = E$, and the result is clear. If the characteristic is $p > 0$, then $E_{sep}$ is the set of elements of $E$ which are separable over $F$. Then if $\\alpha \\in E_{sep}$ has minimal polynomial $P$ write $P = c(x - \\alpha )(x - \\alpha _2) \\ldots (x - \\alpha _ d)$ with $\\alpha _2, \\ldots , \\alpha _ d \\in E$. Since $P$ is a separable polynomial and since $\\alpha _ i$ is a root of $P$, we conclude $\\alpha _ i \\in E_{sep}$ as desired. \n      $\\square$\n    \n","Proof.\n      If the characteristic is zero, then $E_{sep} = E$, and the result is clear. If the characteristic is $p > 0$, then $E_{sep}$ is the set of elements of $E$ which are separable over $F$. Then if $\\alpha \\in E_{sep}$ has minimal polynomial $P$ write $P = c(x - \\alpha )(x - \\alpha _2) \\ldots (x - \\alpha _ d)$ with $\\alpha _2, \\ldots , \\alpha _ d \\in E$. Since $P$ is a separable polynomial and since $\\alpha _ i$ is a root of $P$, we conclude $\\alpha _ i \\in E_{sep}$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that the separable closure is a normal extension by showing it contains all conjugates of any separable element (splitting of the minimal polynomial inside the separable closure), with a characteristic-based discussion. The Lean proof instead proves normality by rewriting the separable closure as its own normal closure (using `separableClosure.normalClosure_eq_self`) and then invoking a general lemma `normalClosure.normal`. This captures the end goal (normality of the separable closure) but does not reflect the informal argument‚Äôs content about minimal polynomials, conjugates, or characteristic cases. Structurally, the formal proof is a short lemma-chaining rewrite + application, whereas the informal proof is a direct elementwise polynomial-factorization argument. Thus there is partial semantic alignment on the theorem proved, but poor structural correspondence and missing the key reasoning steps from the informal proof.""}"
161,09HJ,"theorem finSepDegree_eq_of_isAlgClosed [Algebra.IsAlgebraic F E] [IsAlgClosed K] :
    finSepDegree F E = Nat.card (E ‚Üí‚Çê[F] K) := Nat.card_congr (embEquivOfIsAlgClosed F E K)
",Formal Proof of Stacks Project Tag 09HJ,We use `finSepDegree` to state a more general result.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableDegree.lean#L233-L234,Q27041,,9.14.8,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n      Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6. By Lemma 9.12.11 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n","\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n","Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6. By Lemma 9.12.11 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n"," Nat.card_congr (embEquivOfIsAlgClosed F E K)
","theorem finSepDegree_eq_of_isAlgClosed [Algebra.IsAlgebraic F E] [IsAlgClosed K] :
    finSepDegree F E = Nat.card (E ‚Üí‚Çê[F] K) ","Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 [[\n  Lemma 9.12.9. In Situation 9.12.7 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = \\prod _{i = 1}^ n \\deg _ s(P_ i)$. \n\n    \n]] we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]]. By Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n","Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 [[\n  Lemma 9.12.9. In Situation 9.12.7 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = \\prod _{i = 1}^ n \\deg _ s(P_ i)$. \n\n    \n]] we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]]. By Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: We use `finSepDegree` to state a more general result.","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof establishes a counting result for F-algebra homomorphisms from a finite extension K into an algebraic closure \\overline{F}, showing it equals the separable degree [K:F]_s by reducing to the purely inseparable case (unique extension) and then passing to the maximal separable subextension K_s. The Lean term `Nat.card_congr (embEquivOfIsAlgClosed F E K)` instead applies a cardinality-congruence induced by an equivalence `embEquivOfIsAlgClosed`, i.e. it proves two finite sets have the same cardinality because they are equivalent, without exhibiting the purely inseparable/separable tower argument or the inequality/equality characterization. Structurally, the informal proof is a multi-step reduction (purely inseparable case + separable subfield + extension uniqueness), whereas the formal proof is a one-line transport of cardinality along an equivalence. This could match a more general Lean statement (e.g. using `finSepDegree`) if `embEquivOfIsAlgClosed` already packages the whole argument into an equivalence between embeddings and a set of size `finSepDegree`, but that content is not reflected in the given Lean snippet. Hence partial semantic overlap (cardinality via equivalence) but weak structural correspondence and missing explicit components from the informal proof.""}"
162,09HK,"theorem finSepDegree_mul_finSepDegree_of_isAlgebraic
    [Algebra E K] [IsScalarTower F E K] [Algebra.IsAlgebraic E K] :
    finSepDegree F E * finSepDegree E K = finSepDegree F K := by
  simpa only [Nat.card_prod] using Nat.card_congr (embProdEmbOfIsAlgebraic F E K)
",Formal Proof of Stacks Project Tag 09HK,"Part 1, `finSepDegree` variant",https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableDegree.lean#L282-L285,Q27041,Multiplicativity,9.14.9,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n      Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n",\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n,"Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n"," by
  simpa only [Nat.card_prod] using Nat.card_congr (embProdEmbOfIsAlgebraic F E K)
","theorem finSepDegree_mul_finSepDegree_of_isAlgebraic
    [Algebra E K] [IsScalarTower F E K] [Algebra.IsAlgebraic E K] :
    finSepDegree F E * finSepDegree E K = finSepDegree F K ","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 1, `finSepDegree` variant","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues a multiplicativity statement for the separable degree in a tower by counting F-embeddings into an algebraic closure and showing the set of K-embeddings is a disjoint union over E-embeddings with fibers of size [K:E]_s. The Lean proof instead is a one-line cardinality argument: it uses `Nat.card_congr (embProdEmbOfIsAlgebraic F E K)` and then `Nat.card_prod` to conclude an equality of finite cardinals via an explicit equivalence between an embedding set and a product of embedding sets, assuming algebraicity. This matches the *idea* of counting embeddings and getting a product cardinality, but it does not reflect the informal structure (finite case reduction, use of multiplicativity of usual degree, and Lemma 9.14.8 about identifying separable degree with number of morphisms into an algebraic closure). Structurally, the Lean proof bypasses the intermediate lemmas and directly applies a prepackaged equivalence `embProdEmbOfIsAlgebraic`, so the correspondence to the step-by-step counting argument is weak. Completeness-wise, the informal proof discusses finite vs infinite extensions and uses algebraic closures; none of that appears explicitly in the Lean snippet. Hence only partial alignment.""}"
163,09HA,"theorem finSepDegree_le_finrank [FiniteDimensional F E] :
    finSepDegree F E ‚â§ finrank F E := Nat.le_of_dvd finrank_pos <| finSepDegree_dvd_finrank F E
",Formal Proof of Stacks Project Tag 09HA,The inequality,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableDegree.lean#L741-L742,Q27041,,9.12.11,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n      Proof.\n      This is a corollary of Lemma 9.12.10. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 and we get equality by Lemma 9.12.10. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n","\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n","Proof.\n      This is a corollary of Lemma 9.12.10. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 and we get equality by Lemma 9.12.10. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n"," Nat.le_of_dvd finrank_pos <| finSepDegree_dvd_finrank F E
","theorem finSepDegree_le_finrank [FiniteDimensional F E] :
    finSepDegree F E ‚â§ finrank F E ","Proof.\n      This is a corollary of Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]] and we get equality by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n","Proof.\n      This is a corollary of Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]] and we get equality by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: The inequality","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the Lean proof `Nat.le_of_dvd finrank_pos <| finSepDegree_dvd_finrank F E` establishes a simple numerical inequality: from positivity of `finrank` and a divisibility statement (`finSepDegree` divides `finrank`), it concludes `finSepDegree ‚â§ finrank`. The informal proof, however, is about a field-theoretic characterization of separability via equality/inequality between the number of F-embeddings into an algebraic closure and the degree `[K:F]`, using a tower of generators and Lemmas 9.12.3 and 9.12.10. Structurally, the informal argument is a multi-step equivalence proof (both directions) involving choice of generators and separability propagation, while the Lean code is a one-line application of a divisibility-to-inequality lemma with no mention of embeddings, generators, or separability criteria. Thus the formal proof does not reflect the informal proof‚Äôs content or structure, and appears to be proving a different statement (a divisibility-based inequality) rather than the separability/equality criterion discussed.""}"
164,09HA,"theorem finSepDegree_eq_finrank_iff [FiniteDimensional F E] :
    finSepDegree F E = finrank F E ‚Üî Algebra.IsSeparable F E :=
  ‚ü®fun heq ‚Ü¶ ‚ü®fun x ‚Ü¶ by
    have halg := IsAlgebraic.of_finite F x
    refine (finSepDegree_adjoin_simple_eq_finrank_iff F E x halg).1 <| le_antisymm
      (finSepDegree_adjoin_simple_le_finrank F E x halg) <| le_of_not_gt fun h ‚Ü¶ ?_
    have := Nat.mul_lt_mul_of_lt_of_le' h (finSepDegree_le_finrank F‚üÆx‚üØ E) Fin.pos'
    rw [finSepDegree_mul_finSepDegree_of_isAlgebraic F F‚üÆx‚üØ E,
      Module.finrank_mul_finrank F F‚üÆx‚üØ E] at this
    linarith only [heq, this]‚ü©, fun _ ‚Ü¶ finSepDegree_eq_finrank_of_isSeparable F E‚ü©
",Formal Proof of Stacks Project Tag 09HA,The equality condition,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableDegree.lean#L773-L782,Q27041,,9.12.11,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n      Proof.\n      This is a corollary of Lemma 9.12.10. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 and we get equality by Lemma 9.12.10. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n","\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n","Proof.\n      This is a corollary of Lemma 9.12.10. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 and we get equality by Lemma 9.12.10. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n","
  ‚ü®fun heq ‚Ü¶ ‚ü®fun x ‚Ü¶ by
    have halg := IsAlgebraic.of_finite F x
    refine (finSepDegree_adjoin_simple_eq_finrank_iff F E x halg).1 <| le_antisymm
      (finSepDegree_adjoin_simple_le_finrank F E x halg) <| le_of_not_gt fun h ‚Ü¶ ?_
    have := Nat.mul_lt_mul_of_lt_of_le' h (finSepDegree_le_finrank F‚üÆx‚üØ E) Fin.pos'
    rw [finSepDegree_mul_finSepDegree_of_isAlgebraic F F‚üÆx‚üØ E,
      Module.finrank_mul_finrank F F‚üÆx‚üØ E] at this
    linarith only [heq, this]‚ü©, fun _ ‚Ü¶ finSepDegree_eq_finrank_of_isSeparable F E‚ü©
","theorem finSepDegree_eq_finrank_iff [FiniteDimensional F E] :
    finSepDegree F E = finrank F E ‚Üî Algebra.IsSeparable F E ","Proof.\n      This is a corollary of Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]] and we get equality by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n","Proof.\n      This is a corollary of Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Namely, since $K/F$ is finite we can find finitely many elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ generating $K$ over $F$ (for example we can choose the $\\alpha _ i$ to be a basis of $K$ over $F$). If $K/F$ is separable, then each $\\alpha _ i$ is separable over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]] and we get equality by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. On the other hand, if we have equality, then no matter how we choose $\\alpha _1, \\ldots , \\alpha _ n$ we get that $\\alpha _1$ is separable over $F$ by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]]. Since we can start the sequence with an arbitrary element of $K$ it follows that $K$ is separable over $F$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: The equality condition","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs establish an equivalence between an equality condition (in Lean: finSepDegree = finrank, i.e. ‚Äúnumber of F-embeddings‚Äù equals degree) and separability of the extension. The Lean proof shows: (i) from the equality heq it derives that every element x is separable by proving finSepDegree(F‚üÆx‚üØ/F)=finrank(F‚üÆx‚üØ/F) via inequalities and a contradiction using multiplicativity in towers; (ii) conversely, from global separability it concludes finSepDegree = finrank using a lemma finSepDegree_eq_finrank_of_isSeparable. Structurally, however, the informal proof proceeds by choosing a finite generating sequence Œ±1,‚Ä¶,Œ±n and applying a lemma about strict inequality if any generator is inseparable, plus a tower lemma (separable over F ‚áí separable over intermediate fields). The Lean proof does not use a finite generating set argument or the ‚Äúif one Œ±i is not separable then strict inequality‚Äù lemma explicitly; instead it uses a simple-adjoin argument for arbitrary x and tower multiplicativity to force separability elementwise. Thus the overall theorem matches, but the internal structure and cited lemmas differ, and the informal proof‚Äôs explicit generator-sequence reasoning is not mirrored in Lean.""}"
165,09HB,"theorem Algebra.IsSeparable.trans [Algebra E K] [IsScalarTower F E K]
    [Algebra.IsSeparable F E] [Algebra.IsSeparable E K] : Algebra.IsSeparable F K :=
  ‚ü®fun x ‚Ü¶ IsSeparable.of_algebra_isSeparable_of_isSeparable F
    (Algebra.IsSeparable.isSeparable E x)‚ü©
",Formal Proof of Stacks Project Tag 09HB,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparableDegree.lean#L834-L837,Q27041,,9.12.12,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.12. Let $E/k$ and $F/E$ be separable algebraic extensions of fields. Then $F/k$ is a separable extension of fields. \n\n    \n      Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is separable algebraic over $E$. Let $P = x^ d + \\sum _{i < d} a_ i x^ i$ be the minimal polynomial of $\\alpha $ over $E$. Each $a_ i$ is separable algebraic over $k$. Consider the tower of fields \n    \n      \n  \\[  k \\subset k(a_0) \\subset k(a_0, a_1) \\subset \\ldots \\subset k(a_0, \\ldots , a_{d - 1}) \\subset k(a_0, \\ldots , a_{d - 1}, \\alpha )  \\]\n\n    \n       Because $a_ i$ is separable algebraic over $k$ it is separable algebraic over $k(a_0, \\ldots , a_{i - 1})$ by Lemma 9.12.3. Finally, $\\alpha $ is separable algebraic over $k(a_0, \\ldots , a_{d - 1})$ because it is a root of $P$ which is irreducible (as it is irreducible over the possibly bigger field $E$) and separable (as it is separable over $E$). Thus $k(a_0, \\ldots , a_{d - 1}, \\alpha )$ is separable over $k$ by Lemma 9.12.10 and we conclude that $\\alpha $ is separable over $k$ as desired. \n      $\\square$\n    \n",\n  Lemma 9.12.12. Let $E/k$ and $F/E$ be separable algebraic extensions of fields. Then $F/k$ is a separable extension of fields. \n\n    \n,"Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is separable algebraic over $E$. Let $P = x^ d + \\sum _{i < d} a_ i x^ i$ be the minimal polynomial of $\\alpha $ over $E$. Each $a_ i$ is separable algebraic over $k$. Consider the tower of fields \n    \n      \n  \\[  k \\subset k(a_0) \\subset k(a_0, a_1) \\subset \\ldots \\subset k(a_0, \\ldots , a_{d - 1}) \\subset k(a_0, \\ldots , a_{d - 1}, \\alpha )  \\]\n\n    \n       Because $a_ i$ is separable algebraic over $k$ it is separable algebraic over $k(a_0, \\ldots , a_{i - 1})$ by Lemma 9.12.3. Finally, $\\alpha $ is separable algebraic over $k(a_0, \\ldots , a_{d - 1})$ because it is a root of $P$ which is irreducible (as it is irreducible over the possibly bigger field $E$) and separable (as it is separable over $E$). Thus $k(a_0, \\ldots , a_{d - 1}, \\alpha )$ is separable over $k$ by Lemma 9.12.10 and we conclude that $\\alpha $ is separable over $k$ as desired. \n      $\\square$\n    \n","
  ‚ü®fun x ‚Ü¶ IsSeparable.of_algebra_isSeparable_of_isSeparable F
    (Algebra.IsSeparable.isSeparable E x)‚ü©
","theorem Algebra.IsSeparable.trans [Algebra E K] [IsScalarTower F E K]
    [Algebra.IsSeparable F E] [Algebra.IsSeparable E K] : Algebra.IsSeparable F K ","Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is separable algebraic over $E$. Let $P = x^ d + \\sum _{i < d} a_ i x^ i$ be the minimal polynomial of $\\alpha $ over $E$. Each $a_ i$ is separable algebraic over $k$. Consider the tower of fields \n    \n      \n  \\[  k \\subset k(a_0) \\subset k(a_0, a_1) \\subset \\ldots \\subset k(a_0, \\ldots , a_{d - 1}) \\subset k(a_0, \\ldots , a_{d - 1}, \\alpha )  \\]\n\n    \n       Because $a_ i$ is separable algebraic over $k$ it is separable algebraic over $k(a_0, \\ldots , a_{i - 1})$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]]. Finally, $\\alpha $ is separable algebraic over $k(a_0, \\ldots , a_{d - 1})$ because it is a root of $P$ which is irreducible (as it is irreducible over the possibly bigger field $E$) and separable (as it is separable over $E$). Thus $k(a_0, \\ldots , a_{d - 1}, \\alpha )$ is separable over $k$ by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]] and we conclude that $\\alpha $ is separable over $k$ as desired. \n      $\\square$\n    \n","Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is separable algebraic over $E$. Let $P = x^ d + \\sum _{i < d} a_ i x^ i$ be the minimal polynomial of $\\alpha $ over $E$. Each $a_ i$ is separable algebraic over $k$. Consider the tower of fields \n    \n      \n  \\[  k \\subset k(a_0) \\subset k(a_0, a_1) \\subset \\ldots \\subset k(a_0, \\ldots , a_{d - 1}) \\subset k(a_0, \\ldots , a_{d - 1}, \\alpha )  \\]\n\n    \n       Because $a_ i$ is separable algebraic over $k$ it is separable algebraic over $k(a_0, \\ldots , a_{i - 1})$ by Lemma 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]]. Finally, $\\alpha $ is separable algebraic over $k(a_0, \\ldots , a_{d - 1})$ because it is a root of $P$ which is irreducible (as it is irreducible over the possibly bigger field $E$) and separable (as it is separable over $E$). Thus $k(a_0, \\ldots , a_{d - 1}, \\alpha )$ is separable over $k$ by Lemma 9.12.10 [[\n  Lemma 9.12.10. Assumptions and notation as in Situation 9.12.7. If each $P_ i$ is separable, i.e., each $\\alpha _ i$ is separable over $K_{i - 1}$, then \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = [K : F]  \\]\n\n   and the field extension $K/F$ is separable. If one of the $\\alpha _ i$ is not separable over $K_{i - 1}$, then $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| < [K : F]$. \n\n    \n]] and we conclude that $\\alpha $ is separable over $k$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term proves a separability statement by directly applying a general lemma `IsSeparable.of_algebra_isSeparable_of_isSeparable` to an element `x`, using that `E` is separable over `F` and that `x` is separable over `E` (`Algebra.IsSeparable.isSeparable E x`). This matches the high-level idea ‚Äúseparable descends along a tower‚Äù (the informal Lemma 9.12.3-type step).\n\nStructurally, however, the informal proof is much more elaborate: it introduces a minimal polynomial over an intermediate field, adjoins coefficients step-by-step, and uses an additional lemma about separability of iterated simple extensions (Lemma 9.12.10). None of this tower/minimal-polynomial construction appears in the formal proof, which is a one-line application of a transitivity/descend lemma. So while the conclusion is in the same direction, the formal proof does not reflect the informal proof‚Äôs structure and omits its intermediate arguments.""}"
166,0H71,"lemma exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow_of_adjoin_eq_top
    (ha : IntermediateField.adjoin k (Set.range a) = ‚ä§)
    (ha' : IsTranscendenceBasis k fun i : {i // i ‚â† n} ‚Ü¶ a i) :
    ‚àÉ i : Œπ, IsTranscendenceBasis k (fun j : {j // j ‚â† i} ‚Ü¶ a j) ‚àß
      Algebra.IsSeparable (adjoin k (a '' {i}·∂ú)) K := by
  have ‚ü®i, hi‚ü© := exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow p hp H n ha'
  refine ‚ü®i, hi.1, ?_‚ü©
  rw [‚Üê separableClosure.eq_top_iff, ‚Üê (restrictScalars_injective k).eq_iff,
    restrictScalars_top, eq_top_iff, ‚Üê ha, adjoin_le_iff]
  rintro _ ‚ü®x, rfl‚ü©
  obtain rfl | ne := eq_or_ne x i
  ¬∑ exact hi.2
  ¬∑ exact isSeparable_algebraMap (F := adjoin k (a '' {i}·∂ú)) ‚ü®_, subset_adjoin _ _ ‚ü®x, ne, rfl‚ü©‚ü©
",Formal Proof of Stacks Project Tag 0H71,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparablyGenerated.lean#L255-L267,Q27041,,10.44.1,lemma,3.0,"['05DT', '00AO', '0ELQ']","\n  Lemma 10.44.1. Let $k$ be a field of characteristic $p > 1$. Let $K/k$ be a field extension generated by $x_1, \\ldots , x_{n + 1} \\in K$ such that \n  \n  \n$\\{ x_1, \\ldots , x_ n\\} $ is a transcendence base of $K/k$, \n\n\nfor every $k$-linearly independent subset $\\{ a_1, \\ldots , a_ m\\} $ of $K$ the set $\\{ a^ p_1, \\ldots , a_ m^ p\\} $ is $k$-linearly independent. \n\n\n\n   Then there is $1 \\leq j \\leq n+1$ such that $\\{  x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{n+1}\\} $ is a separating transcendence base for $K / k$. \n\n    \n      Proof.\n      By assumption $x_{n + 1}$ is algebraic over $k(x_1, \\ldots , x_ n)$ so there exists a non-zero polynomial $F \\in k[X_1, \\ldots , X_{n + 1}]$ such that $F(x_1, \\ldots , x_{n+1}) = 0$. Choose $F$ of minimal total degree. Then $F$ is irreducible, because at least one irreducible factor must also have the same property. \n    \n      We claim that, for some $i$, not all powers of $X_ i$ appearing in $F$ are multiples of $p$. Suppose for a contradiction that all the exponents appearing in $F$ were multiples of $p$, then the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1} \\ldots x^{\\alpha _{n+1}}_{n+1} \\mid \\lambda _\\alpha \\neq 0\\}  \\subset K  \\]\n\n    \n       is $k$-linearly dependent where $\\lambda _\\alpha $ are the coefficients of $F$. By assumption (2) we conclude the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1 / p} \\ldots x^{\\alpha _{n+1} / p}_{n+1} \\mid \\lambda _\\alpha \\neq 0 \\}   \\]\n\n    \n       is also $k$-linearly dependent, contradicting minimality of $\\deg (F)$. \n    \n      Choose $i$ for which a non-$p$th power of $X_ i$ appears in $F$. Then we see that $x_ i$ is algebraic over $L = k(x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1})$. By Fields, Lemma 9.26.3 we see that $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1}$ is a transcendence base of $K/k$. Thus $L$ is the fraction field of the polynomial ring over $k$ in $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n + 1}$. By Gauss\' Lemma we conclude that \n    \n      \n  \\[  P(T) = F(x_1, \\ldots , x_{i - 1}, T, x_{i + 1}, \\ldots , x_{n + 1}) \\in L[T]  \\]\n\n    \n       is irreducible. By construction $P(T)$ is not contained in $L[T^ p]$. Hence $K/L$ is separable as required. \n      $\\square$\n    \n","\n  Lemma 10.44.1. Let $k$ be a field of characteristic $p > 1$. Let $K/k$ be a field extension generated by $x_1, \\ldots , x_{n + 1} \\in K$ such that \n  \n  \n$\\{ x_1, \\ldots , x_ n\\} $ is a transcendence base of $K/k$, \n\n\nfor every $k$-linearly independent subset $\\{ a_1, \\ldots , a_ m\\} $ of $K$ the set $\\{ a^ p_1, \\ldots , a_ m^ p\\} $ is $k$-linearly independent. \n\n\n\n   Then there is $1 \\leq j \\leq n+1$ such that $\\{  x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{n+1}\\} $ is a separating transcendence base for $K / k$. \n\n    \n","Proof.\n      By assumption $x_{n + 1}$ is algebraic over $k(x_1, \\ldots , x_ n)$ so there exists a non-zero polynomial $F \\in k[X_1, \\ldots , X_{n + 1}]$ such that $F(x_1, \\ldots , x_{n+1}) = 0$. Choose $F$ of minimal total degree. Then $F$ is irreducible, because at least one irreducible factor must also have the same property. \n    \n      We claim that, for some $i$, not all powers of $X_ i$ appearing in $F$ are multiples of $p$. Suppose for a contradiction that all the exponents appearing in $F$ were multiples of $p$, then the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1} \\ldots x^{\\alpha _{n+1}}_{n+1} \\mid \\lambda _\\alpha \\neq 0\\}  \\subset K  \\]\n\n    \n       is $k$-linearly dependent where $\\lambda _\\alpha $ are the coefficients of $F$. By assumption (2) we conclude the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1 / p} \\ldots x^{\\alpha _{n+1} / p}_{n+1} \\mid \\lambda _\\alpha \\neq 0 \\}   \\]\n\n    \n       is also $k$-linearly dependent, contradicting minimality of $\\deg (F)$. \n    \n      Choose $i$ for which a non-$p$th power of $X_ i$ appears in $F$. Then we see that $x_ i$ is algebraic over $L = k(x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1})$. By Fields, Lemma 9.26.3 we see that $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1}$ is a transcendence base of $K/k$. Thus $L$ is the fraction field of the polynomial ring over $k$ in $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n + 1}$. By Gauss\' Lemma we conclude that \n    \n      \n  \\[  P(T) = F(x_1, \\ldots , x_{i - 1}, T, x_{i + 1}, \\ldots , x_{n + 1}) \\in L[T]  \\]\n\n    \n       is irreducible. By construction $P(T)$ is not contained in $L[T^ p]$. Hence $K/L$ is separable as required. \n      $\\square$\n    \n"," by
  have ‚ü®i, hi‚ü© := exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow p hp H n ha'
  refine ‚ü®i, hi.1, ?_‚ü©
  rw [‚Üê separableClosure.eq_top_iff, ‚Üê (restrictScalars_injective k).eq_iff,
    restrictScalars_top, eq_top_iff, ‚Üê ha, adjoin_le_iff]
  rintro _ ‚ü®x, rfl‚ü©
  obtain rfl | ne := eq_or_ne x i
  ¬∑ exact hi.2
  ¬∑ exact isSeparable_algebraMap (F := adjoin k (a '' {i}·∂ú)) ‚ü®_, subset_adjoin _ _ ‚ü®x, ne, rfl‚ü©‚ü©
","lemma exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow_of_adjoin_eq_top
    (ha : IntermediateField.adjoin k (Set.range a) = ‚ä§)
    (ha' : IsTranscendenceBasis k fun i : {i // i ‚â† n} ‚Ü¶ a i) :
    ‚àÉ i : Œπ, IsTranscendenceBasis k (fun j : {j // j ‚â† i} ‚Ü¶ a j) ‚àß
      Algebra.IsSeparable (adjoin k (a '' {i}·∂ú)) K ","Proof.\n      By assumption $x_{n + 1}$ is algebraic over $k(x_1, \\ldots , x_ n)$ so there exists a non-zero polynomial $F \\in k[X_1, \\ldots , X_{n + 1}]$ such that $F(x_1, \\ldots , x_{n+1}) = 0$. Choose $F$ of minimal total degree. Then $F$ is irreducible, because at least one irreducible factor must also have the same property. \n    \n      We claim that, for some $i$, not all powers of $X_ i$ appearing in $F$ are multiples of $p$. Suppose for a contradiction that all the exponents appearing in $F$ were multiples of $p$, then the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1} \\ldots x^{\\alpha _{n+1}}_{n+1} \\mid \\lambda _\\alpha \\neq 0\\}  \\subset K  \\]\n\n    \n       is $k$-linearly dependent where $\\lambda _\\alpha $ are the coefficients of $F$. By assumption (2) we conclude the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1 / p} \\ldots x^{\\alpha _{n+1} / p}_{n+1} \\mid \\lambda _\\alpha \\neq 0 \\}   \\]\n\n    \n       is also $k$-linearly dependent, contradicting minimality of $\\deg (F)$. \n    \n      Choose $i$ for which a non-$p$th power of $X_ i$ appears in $F$. Then we see that $x_ i$ is algebraic over $L = k(x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1})$. By Fields, Lemma 9.26.3 [[\n  Lemma 9.26.3. Let $E/F$ be a field extension. A transcendence basis of $E$ over $F$ exists. Any two transcendence bases have the same cardinality. \n\n    \n]] we see that $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1}$ is a transcendence base of $K/k$. Thus $L$ is the fraction field of the polynomial ring over $k$ in $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n + 1}$. By Gauss\' Lemma we conclude that \n    \n      \n  \\[  P(T) = F(x_1, \\ldots , x_{i - 1}, T, x_{i + 1}, \\ldots , x_{n + 1}) \\in L[T]  \\]\n\n    \n       is irreducible. By construction $P(T)$ is not contained in $L[T^ p]$. Hence $K/L$ is separable as required. \n      $\\square$\n    \n","Proof.\n      By assumption $x_{n + 1}$ is algebraic over $k(x_1, \\ldots , x_ n)$ so there exists a non-zero polynomial $F \\in k[X_1, \\ldots , X_{n + 1}]$ such that $F(x_1, \\ldots , x_{n+1}) = 0$. Choose $F$ of minimal total degree. Then $F$ is irreducible, because at least one irreducible factor must also have the same property. \n    \n      We claim that, for some $i$, not all powers of $X_ i$ appearing in $F$ are multiples of $p$. Suppose for a contradiction that all the exponents appearing in $F$ were multiples of $p$, then the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1} \\ldots x^{\\alpha _{n+1}}_{n+1} \\mid \\lambda _\\alpha \\neq 0\\}  \\subset K  \\]\n\n    \n       is $k$-linearly dependent where $\\lambda _\\alpha $ are the coefficients of $F$. By assumption (2) we conclude the set \n    \n      \n  \\[  \\{ x_1^{\\alpha _1 / p} \\ldots x^{\\alpha _{n+1} / p}_{n+1} \\mid \\lambda _\\alpha \\neq 0 \\}   \\]\n\n    \n       is also $k$-linearly dependent, contradicting minimality of $\\deg (F)$. \n    \n      Choose $i$ for which a non-$p$th power of $X_ i$ appears in $F$. Then we see that $x_ i$ is algebraic over $L = k(x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1})$. By Fields, Lemma 9.26.3 [[\n  Lemma 9.26.3. Let $E/F$ be a field extension. A transcendence basis of $E$ over $F$ exists. Any two transcendence bases have the same cardinality. \n\n    \n]] we see that $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n+1}$ is a transcendence base of $K/k$. Thus $L$ is the fraction field of the polynomial ring over $k$ in $x_1, \\ldots , x_{i - 1}, x_{i + 1}, \\ldots , x_{n + 1}$. By Gauss\' Lemma we conclude that \n    \n      \n  \\[  P(T) = F(x_1, \\ldots , x_{i - 1}, T, x_{i + 1}, \\ldots , x_{n + 1}) \\in L[T]  \\]\n\n    \n       is irreducible. By construction $P(T)$ is not contained in $L[T^ p]$. Hence $K/L$ is separable as required. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues via a minimal-degree polynomial relation, extracts an index i with an exponent not divisible by p, deduces x_i is algebraic over the field generated by the other variables, and then uses irreducibility + ‚Äúnot in L[T^p]‚Äù to conclude separability of K/L. The Lean proof instead invokes a packaged lemma `exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow` to obtain an index i together with (1) a transcendence-basis statement and (2) a separability statement, and then finishes by rewriting separable-closure/top conditions and checking separability for elements coming from an adjoin, splitting into the cases x = i and x ‚â† i.\n\nStructurally, the informal proof‚Äôs core steps (minimal polynomial, irreducibility, p-divisibility argument, Gauss lemma, and the L[T^p] criterion) are not reflected in the Lean script; they are hidden inside the invoked existence lemma. The final Lean steps about `separableClosure`, `restrictScalars`, and `adjoin` case-splitting do not correspond to the informal polynomial-minimality argument. Thus the overall goal (existence of i and separability over the complement) seems compatible, but the proof content and structure are largely different/opaque, giving only weak alignment.""}"
167,030W,"lemma exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow_of_essFiniteType
    [Algebra.EssFiniteType k K] :
    ‚àÉ s : Finset K, IsTranscendenceBasis k ((‚Üë) : s ‚Üí K) ‚àß
      Algebra.IsSeparable (adjoin k (s : Set K)) K := by
  have ‚ü®s, hs, Hs‚ü© := exists_finset_maximalFor_isTranscendenceBasis_separableClosure k K
  refine ‚ü®s, hs, ‚ü®fun n ‚Ü¶ of_not_not fun hn ‚Ü¶ ?_‚ü©‚ü©
  have hns : n ‚àâ s := fun h ‚Ü¶ hn (le_restrictScalars_separableClosure _ (subset_adjoin _ _ h))
  have ‚ü®i, hi‚ÇÅ, hi‚ÇÇ‚ü© := exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow'
    p hp (a := id) H s n hs hns
  rw [Set.image_id] at hi‚ÇÇ
  refine not_lt_iff_le_imp_ge.mpr (Hs hi‚ÇÅ) (SetLike.lt_iff_le_and_exists.mpr ‚ü®?_, n, ?_, hn‚ü©)
  ¬∑ rw [separableClosure_le_separableClosure_iff, adjoin_le_iff]
    intro x hx
    obtain rfl | ne := eq_or_ne x i
    exacts [hi‚ÇÇ, le_restrictScalars_separableClosure _ (subset_adjoin _ _ ‚ü®.inr hx, ne‚ü©)]
  ¬∑ obtain rfl | ne := eq_or_ne n i
    exacts [hi‚ÇÇ, le_restrictScalars_separableClosure _ (subset_adjoin _ _ ‚ü®.inl rfl, ne‚ü©)]
",Formal Proof of Stacks Project Tag 030W,(2) ‚áí (1) finitely genenerated case,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SeparablyGenerated.lean#L279-L295,Q27041,,10.44.2,lemma,3.0,"['05DT', '00AO', '0ELQ']","\n  Lemma 10.44.2. Let $k$ be a field of characteristic $p > 0$. Let $K/k$ be a field extension. The following are equivalent: \n  \n  \n$K$ is separable over $k$, \n\n\nfor every $k$-linearly independent subset $\\{ a_1, \\ldots , a_ m\\} $ of $K$ the set $\\{ a^ p_1, \\ldots , a_ m^ p\\} $ is $k$-linearly independent, \n\n\nthe ring $K \\otimes _ k k^{1/p}$ is reduced, and \n\n\n$K$ is geometrically reduced over $k$. \n\n\n\n\n    \n      Proof.\n      The implication (1) $\\Rightarrow $ (4) follows from Lemma 10.43.6. The implication (4) $\\Rightarrow $ (3) is immediate. \n    \n      Assume (3). Consider the ring homomorphism $m : K \\otimes _ k k^{1/p} \\rightarrow K$ given by \n    \n      \n  \\[  \\lambda \\otimes \\mu \\rightarrow \\lambda ^ p \\mu ^ p  \\]\n\n    \n       Note that $x^ p = m(x) \\otimes 1$ for all $x \\in K \\otimes _ k k^{1/p}$. Since $K \\otimes _ k k^{1/p}$ is reduced we see $m$ is injective. If $\\{ a_1, \\ldots , a_ m\\}  \\subset K$ is $k$-linearly independent, then $\\{ a_1 \\otimes 1, \\ldots , a_ m \\otimes 1\\} $ is $k^{1/p}$-linearly independent. By injectivity of $m$ we deduce that no nontrivial $k$-linear combination of $a_1^ p, \\ldots , a_ m^ p$ is is zero. Hence (3) implies (2). \n    \n      Assume (2). To prove (1) we may assume that $K$ is finitely generated over $k$ and we have to prove that $K$ is separably generated over $k$. Let $\\{ x_1, \\ldots , x_ d\\} $ be a transcendence base of $K/k$. By Fields, Lemma 9.8.6 we have $[K : K\'] < \\infty $ where $K\' = k(x_1, \\ldots , x_ d)$. Choose the transcendence base such that the degree of inseparability $[K : K\']_ i$ is minimal. If $K / K\'$ is separable then we win. Assume this is not the case to get a contradiction. Then there exists $x_{d + 1} \\in K$ which is not separable over $K\'$, and in particular $[K\'(x_{d+1}) : K\']_ i > 1$. Then by Lemma 10.44.1 there is $1 \\leq j \\leq n + 1$ such that $K\'\' = k(x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{d+1})$ satisfies $[K\'(x_{d+1}) : K\'\']_ i = 1$. By multiplicativity $[K : K\'\']_ i < [K : K\']_ i$ and we obtain the contradiction. \n      $\\square$\n    \n","\n  Lemma 10.44.2. Let $k$ be a field of characteristic $p > 0$. Let $K/k$ be a field extension. The following are equivalent: \n  \n  \n$K$ is separable over $k$, \n\n\nfor every $k$-linearly independent subset $\\{ a_1, \\ldots , a_ m\\} $ of $K$ the set $\\{ a^ p_1, \\ldots , a_ m^ p\\} $ is $k$-linearly independent, \n\n\nthe ring $K \\otimes _ k k^{1/p}$ is reduced, and \n\n\n$K$ is geometrically reduced over $k$. \n\n\n\n\n    \n","Proof.\n      The implication (1) $\\Rightarrow $ (4) follows from Lemma 10.43.6. The implication (4) $\\Rightarrow $ (3) is immediate. \n    \n      Assume (3). Consider the ring homomorphism $m : K \\otimes _ k k^{1/p} \\rightarrow K$ given by \n    \n      \n  \\[  \\lambda \\otimes \\mu \\rightarrow \\lambda ^ p \\mu ^ p  \\]\n\n    \n       Note that $x^ p = m(x) \\otimes 1$ for all $x \\in K \\otimes _ k k^{1/p}$. Since $K \\otimes _ k k^{1/p}$ is reduced we see $m$ is injective. If $\\{ a_1, \\ldots , a_ m\\}  \\subset K$ is $k$-linearly independent, then $\\{ a_1 \\otimes 1, \\ldots , a_ m \\otimes 1\\} $ is $k^{1/p}$-linearly independent. By injectivity of $m$ we deduce that no nontrivial $k$-linear combination of $a_1^ p, \\ldots , a_ m^ p$ is is zero. Hence (3) implies (2). \n    \n      Assume (2). To prove (1) we may assume that $K$ is finitely generated over $k$ and we have to prove that $K$ is separably generated over $k$. Let $\\{ x_1, \\ldots , x_ d\\} $ be a transcendence base of $K/k$. By Fields, Lemma 9.8.6 we have $[K : K\'] < \\infty $ where $K\' = k(x_1, \\ldots , x_ d)$. Choose the transcendence base such that the degree of inseparability $[K : K\']_ i$ is minimal. If $K / K\'$ is separable then we win. Assume this is not the case to get a contradiction. Then there exists $x_{d + 1} \\in K$ which is not separable over $K\'$, and in particular $[K\'(x_{d+1}) : K\']_ i > 1$. Then by Lemma 10.44.1 there is $1 \\leq j \\leq n + 1$ such that $K\'\' = k(x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{d+1})$ satisfies $[K\'(x_{d+1}) : K\'\']_ i = 1$. By multiplicativity $[K : K\'\']_ i < [K : K\']_ i$ and we obtain the contradiction. \n      $\\square$\n    \n"," by
  have ‚ü®s, hs, Hs‚ü© := exists_finset_maximalFor_isTranscendenceBasis_separableClosure k K
  refine ‚ü®s, hs, ‚ü®fun n ‚Ü¶ of_not_not fun hn ‚Ü¶ ?_‚ü©‚ü©
  have hns : n ‚àâ s := fun h ‚Ü¶ hn (le_restrictScalars_separableClosure _ (subset_adjoin _ _ h))
  have ‚ü®i, hi‚ÇÅ, hi‚ÇÇ‚ü© := exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow'
    p hp (a := id) H s n hs hns
  rw [Set.image_id] at hi‚ÇÇ
  refine not_lt_iff_le_imp_ge.mpr (Hs hi‚ÇÅ) (SetLike.lt_iff_le_and_exists.mpr ‚ü®?_, n, ?_, hn‚ü©)
  ¬∑ rw [separableClosure_le_separableClosure_iff, adjoin_le_iff]
    intro x hx
    obtain rfl | ne := eq_or_ne x i
    exacts [hi‚ÇÇ, le_restrictScalars_separableClosure _ (subset_adjoin _ _ ‚ü®.inr hx, ne‚ü©)]
  ¬∑ obtain rfl | ne := eq_or_ne n i
    exacts [hi‚ÇÇ, le_restrictScalars_separableClosure _ (subset_adjoin _ _ ‚ü®.inl rfl, ne‚ü©)]
","lemma exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow_of_essFiniteType
    [Algebra.EssFiniteType k K] :
    ‚àÉ s : Finset K, IsTranscendenceBasis k ((‚Üë) : s ‚Üí K) ‚àß
      Algebra.IsSeparable (adjoin k (s : Set K)) K ","Proof.\n      The implication (1) $\\Rightarrow $ (4) follows from Lemma 10.43.6 [[\n  Lemma 10.43.6. Let $k$ be a field. Let $S$ be a reduced $k$-algebra. Let $K/k$ be either a separable field extension, or a separably generated field extension. Then $K \\otimes _ k S$ is reduced. \n\n    \n]]. The implication (4) $\\Rightarrow $ (3) is immediate. \n    \n      Assume (3). Consider the ring homomorphism $m : K \\otimes _ k k^{1/p} \\rightarrow K$ given by \n    \n      \n  \\[  \\lambda \\otimes \\mu \\rightarrow \\lambda ^ p \\mu ^ p  \\]\n\n    \n       Note that $x^ p = m(x) \\otimes 1$ for all $x \\in K \\otimes _ k k^{1/p}$. Since $K \\otimes _ k k^{1/p}$ is reduced we see $m$ is injective. If $\\{ a_1, \\ldots , a_ m\\}  \\subset K$ is $k$-linearly independent, then $\\{ a_1 \\otimes 1, \\ldots , a_ m \\otimes 1\\} $ is $k^{1/p}$-linearly independent. By injectivity of $m$ we deduce that no nontrivial $k$-linear combination of $a_1^ p, \\ldots , a_ m^ p$ is is zero. Hence (3) implies (2). \n    \n      Assume (2). To prove (1) we may assume that $K$ is finitely generated over $k$ and we have to prove that $K$ is separably generated over $k$. Let $\\{ x_1, \\ldots , x_ d\\} $ be a transcendence base of $K/k$. By Fields, Lemma 9.8.6 [[\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n]] we have $[K : K\'] < \\infty $ where $K\' = k(x_1, \\ldots , x_ d)$. Choose the transcendence base such that the degree of inseparability $[K : K\']_ i$ is minimal. If $K / K\'$ is separable then we win. Assume this is not the case to get a contradiction. Then there exists $x_{d + 1} \\in K$ which is not separable over $K\'$, and in particular $[K\'(x_{d+1}) : K\']_ i > 1$. Then by Lemma 10.44.1 [[\n  Lemma 10.44.1. Let $k$ be a field of characteristic $p > 1$. Let $K/k$ be a field extension generated by $x_1, \\ldots , x_{n + 1} \\in K$ such that \n  \n  \n$\\{ x_1, \\ldots , x_ n\\} $ is a transcendence base of $K/k$, \n\n\nfor every $k$-linearly independent subset $\\{ a_1, \\ldots , a_ m\\} $ of $K$ the set $\\{ a^ p_1, \\ldots , a_ m^ p\\} $ is $k$-linearly independent. \n\n\n\n   Then there is $1 \\leq j \\leq n+1$ such that $\\{  x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{n+1}\\} $ is a separating transcendence base for $K / k$. \n\n    \n]] there is $1 \\leq j \\leq n + 1$ such that $K\'\' = k(x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{d+1})$ satisfies $[K\'(x_{d+1}) : K\'\']_ i = 1$. By multiplicativity $[K : K\'\']_ i < [K : K\']_ i$ and we obtain the contradiction. \n      $\\square$\n    \n","Proof.\n      The implication (1) $\\Rightarrow $ (4) follows from Lemma 10.43.6 [[\n  Lemma 10.43.6. Let $k$ be a field. Let $S$ be a reduced $k$-algebra. Let $K/k$ be either a separable field extension, or a separably generated field extension. Then $K \\otimes _ k S$ is reduced. \n\n    \n]]. The implication (4) $\\Rightarrow $ (3) is immediate. \n    \n      Assume (3). Consider the ring homomorphism $m : K \\otimes _ k k^{1/p} \\rightarrow K$ given by \n    \n      \n  \\[  \\lambda \\otimes \\mu \\rightarrow \\lambda ^ p \\mu ^ p  \\]\n\n    \n       Note that $x^ p = m(x) \\otimes 1$ for all $x \\in K \\otimes _ k k^{1/p}$. Since $K \\otimes _ k k^{1/p}$ is reduced we see $m$ is injective. If $\\{ a_1, \\ldots , a_ m\\}  \\subset K$ is $k$-linearly independent, then $\\{ a_1 \\otimes 1, \\ldots , a_ m \\otimes 1\\} $ is $k^{1/p}$-linearly independent. By injectivity of $m$ we deduce that no nontrivial $k$-linear combination of $a_1^ p, \\ldots , a_ m^ p$ is is zero. Hence (3) implies (2). \n    \n      Assume (2). To prove (1) we may assume that $K$ is finitely generated over $k$ and we have to prove that $K$ is separably generated over $k$. Let $\\{ x_1, \\ldots , x_ d\\} $ be a transcendence base of $K/k$. By Fields, Lemma 9.8.6 [[\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n]] we have $[K : K\'] < \\infty $ where $K\' = k(x_1, \\ldots , x_ d)$. Choose the transcendence base such that the degree of inseparability $[K : K\']_ i$ is minimal. If $K / K\'$ is separable then we win. Assume this is not the case to get a contradiction. Then there exists $x_{d + 1} \\in K$ which is not separable over $K\'$, and in particular $[K\'(x_{d+1}) : K\']_ i > 1$. Then by Lemma 10.44.1 [[\n  Lemma 10.44.1. Let $k$ be a field of characteristic $p > 1$. Let $K/k$ be a field extension generated by $x_1, \\ldots , x_{n + 1} \\in K$ such that \n  \n  \n$\\{ x_1, \\ldots , x_ n\\} $ is a transcendence base of $K/k$, \n\n\nfor every $k$-linearly independent subset $\\{ a_1, \\ldots , a_ m\\} $ of $K$ the set $\\{ a^ p_1, \\ldots , a_ m^ p\\} $ is $k$-linearly independent. \n\n\n\n   Then there is $1 \\leq j \\leq n+1$ such that $\\{  x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{n+1}\\} $ is a separating transcendence base for $K / k$. \n\n    \n]] there is $1 \\leq j \\leq n + 1$ such that $K\'\' = k(x_1, \\ldots , \\widehat{x}_ j, \\ldots , x_{d+1})$ satisfies $[K\'(x_{d+1}) : K\'\']_ i = 1$. By multiplicativity $[K : K\'\']_ i < [K : K\']_ i$ and we obtain the contradiction. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2) ‚áí (1) finitely genenerated case","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof‚Äôs (2) ‚áí (1) (finitely generated case) argues via choosing a transcendence basis with minimal inseparability degree, then replacing an element using a lemma (10.44.1) to get a separating transcendence basis and contradict minimality. The Lean proof instead constructs a finset maximal for being a transcendence basis inside the separable closure (using `exists_finset_maximalFor_isTranscendenceBasis_separableClosure`) and then uses a lemma about existence of a transcendence basis element and separability from linear independence of p-th powers (`exists_isTranscendenceBasis_and_isSeparable_of_linearIndepOn_pow'`) to derive a maximality contradiction by producing a strictly larger separable-closure subextension. Structurally, both are ‚Äúminimal/maximality + exchange step + contradiction‚Äù arguments, but the objects and key steps differ: the informal proof is about finitely generated extensions, inseparability degrees, and modifying a transcendence basis; the Lean proof is about maximal finsets and separable closure inclusions, with no explicit finite generation or inseparability-degree minimization. Thus there is partial thematic alignment (maximality/exchange to get separating basis), but significant mismatch in the specific argument and hypotheses used.""}"
168,09G5,"theorem right [hf : Module.Finite F A] : Module.Finite K A :=
  let ‚ü®‚ü®b, hb‚ü©‚ü© := hf
  ‚ü®‚ü®b, Submodule.restrictScalars_injective F _ _ <| by
    rw [Submodule.restrictScalars_top, eq_top_iff, ‚Üê hb, Submodule.span_le]
    exact Submodule.subset_span‚ü©‚ü©
",Formal Proof of Stacks Project Tag 09G5,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Tower.lean#L55-L59,Q27041,,9.7.3,lemma,3.0,"['09G2', '09FA', '0ELQ']","\n  Lemma 9.7.3. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is finite over $F$, then $K$ is finite over $E$. \n\n    \n      Proof.\n      Direct from the definition. \n      $\\square$\n    \n","\n  Lemma 9.7.3. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is finite over $F$, then $K$ is finite over $E$. \n\n    \n",Proof.\n      Direct from the definition. \n      $\\square$\n    \n,"
  let ‚ü®‚ü®b, hb‚ü©‚ü© := hf
  ‚ü®‚ü®b, Submodule.restrictScalars_injective F _ _ <| by
    rw [Submodule.restrictScalars_top, eq_top_iff, ‚Üê hb, Submodule.span_le]
    exact Submodule.subset_span‚ü©‚ü©
",theorem right [hf : Module.Finite F A] : Module.Finite K A ,Proof.\n      Direct from the definition. \n      $\\square$\n    \n,Proof.\n      Direct from the definition. \n      $\\square$\n    \n,"{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof claims the result follows immediately from unfolding definitions, with no additional lemmas or nontrivial steps. The formal proof, however, performs explicit destructuring of an existential witness ‚ü®b, hb‚ü© from hf and then constructs a new witness, using several non-definitional lemmas and rewrites (e.g., `Submodule.restrictScalars_injective`, `restrictScalars_top`, `eq_top_iff`, `span_le`, `subset_span`). Structurally, the informal proof is a one-line definitional argument, while the Lean code is a multi-step construction with rewriting and submodule-span reasoning. Although the formal proof may still prove the same statement, it is not presented as a purely definitional unfolding, so the correspondence is weak.""}"
171,09I3,"instance of_fixed_field (G : Type*) [Group G] [Finite G] [MulSemiringAction G E] :
    IsGalois (FixedPoints.subfield G E) E :=
  ‚ü®‚ü©
",Formal Proof of Stacks Project Tag 09I3,first part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Galois/Basic.lean#L94-L96,Q27041,,9.21.6,lemma,3.0,"['09DU', '09FA', '0ELQ']","\n  Lemma 9.21.6. Let $K$ be a field. Let $G$ be a finite group acting faithfully on $K$. Then the extension $K/K^ G$ is Galois, we have $[K : K^ G] = |G|$, and the Galois group of the extension is $G$. \n\n    \n      Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9. \n      $\\square$\n    \n","\n  Lemma 9.21.6. Let $K$ be a field. Let $G$ be a finite group acting faithfully on $K$. Then the extension $K/K^ G$ is Galois, we have $[K : K^ G] = |G|$, and the Galois group of the extension is $G$. \n\n    \n","Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9. \n      $\\square$\n    \n","
  ‚ü®‚ü©
","instance of_fixed_field (G : Type*) [Group G] [Finite G] [MulSemiringAction G E] :
    IsGalois (FixedPoints.subfield G E) E ","Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2 [[\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n]]. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 [[\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n]] we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Given $\\alpha \\in K$ consider the orbit $G \\cdot \\alpha \\subset K$ of $\\alpha $ under the group action. Consider the polynomial \n    \n      \n  \\[  P = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) \\in K[x]  \\]\n\n    \n       The key to the whole lemma is that this polynomial is invariant under the action of $G$ and hence has coefficients in $K^ G$. Namely, for $\\tau \\in G$ we have \n    \n      \n  \\[  P^\\tau = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\tau (\\beta )) = \\prod \\nolimits _{\\beta \\in G \\cdot \\alpha } (x - \\beta ) = P  \\]\n\n    \n       because the map $\\beta \\mapsto \\tau (\\beta )$ is a permutation of the orbit $G \\cdot \\alpha $. Thus $P \\in K^ G[x]$. Since also $P(\\alpha ) = 0$ as $\\alpha $ is an element of its orbit we conclude that the extension $K/K^ G$ is algebraic. Moreover, the minimal polynomial $Q$ of $\\alpha $ over $K^ G$ divides the polynomial $P$ just constructed. Hence $Q$ is separable (by Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] for example) and we conclude that $K/K^ G$ is separable. Thus $K/K^ G$ is Galois. To finish the proof it suffices to show that $[K : K^ G] = |G|$ since then $G$ will be the Galois group by Lemma 9.21.2 [[\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n]]. \n    \n      Pick finitely many elements $\\alpha _ i \\in K$, $i = 1, \\ldots , n$ such that $\\sigma (\\alpha _ i) = \\alpha _ i$ for $i = 1, \\ldots , n$ implies $\\sigma $ is the neutral element of $G$. Set \n    \n      \n  \\[  L = K^ G(\\{ \\sigma (\\alpha _ i); 1 \\leq i \\leq n, \\sigma \\in G\\} ) \\subset K  \\]\n\n    \n       and observe that the action of $G$ on $K$ induces an action of $G$ on $L$. We will show that $L$ has degree $|G|$ over $K^ G$. This will finish the proof, since if $L \\subset K$ is proper, then we can add an element $\\alpha \\in K$, $\\alpha \\not\\in L$ to our list of elements $\\alpha _1, \\ldots , \\alpha _ n$ without increasing $L$ which is absurd. This reduces us to the case that $K/K^ G$ is finite which is treated in the next paragraph. \n    \n      Assume $K/K^ G$ is finite. By Lemma 9.19.1 [[\n  Lemma 9.19.1 (Primitive element).  Let $E/F$ be a finite extension of fields. The following are equivalent \n  \n  \nthere exists a primitive element for $E$ over $F$, and \n\n\nthere are finitely many subextensions $E/K/F$. \n\n\n\n   Moreover, (1) and (2) hold if $E/F$ is separable. \n\n    \n]] we can find $\\alpha \\in K$ such that $K = K^ G(\\alpha )$. By the construction in the first paragraph of this proof we see that $\\alpha $ has degree at most $|G|$ over $K$. However, the degree cannot be less than $|G|$ as $G$ acts faithfully on $K^ G(\\alpha ) = L$ by construction and the inequality of Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: first part","{""Alignment Score"": ""1"", ""brief_justification"": ""The formal_proof is just the empty term `‚ü®‚ü©`, which in Lean typically constructs a trivial inhabitant of a structure like `PUnit`/`True`/an empty sigma, and contains no content corresponding to the informal argument. Semantically, the informal proof establishes substantial field-theoretic claims (invariants, algebraicity, separability, Galoisness, and degree/cardinality comparisons using orbit polynomials and several lemmas), while the formal proof proves at most a trivial proposition/structure with no relation to these claims. Structurally, the informal proof has multiple steps (orbit polynomial invariance, minimal polynomial divisibility, separability, reduction to finite case, primitive element, degree bounds), none of which appear in the Lean code. Thus there is essentially no semantic or structural alignment.""}"
172,09I1,"theorem card_aut_eq_finrank [FiniteDimensional F E] [IsGalois F E] :
    Nat.card Gal(E/F) = finrank F E := by
  obtain ‚ü®Œ±, hŒ±‚ü© := Field.exists_primitive_element F E
  let iso : F‚üÆŒ±‚üØ ‚âÉ‚Çê[F] E :=
    { toFun := fun e => e.val
      invFun := fun e => ‚ü®e, by rw [hŒ±]; exact IntermediateField.mem_top‚ü©
      map_mul' := fun _ _ => rfl
      map_add' := fun _ _ => rfl
      commutes' := fun _ => rfl }
  have H : IsIntegral F Œ± := IsGalois.integral F Œ±
  have h_sep : IsSeparable F Œ± := IsGalois.separable F Œ±
  have h_splits : ((minpoly F Œ±).map (algebraMap F E)).Splits := IsGalois.splits F Œ±
  replace h_splits : ((minpoly F Œ±).map (algebraMap F F‚üÆŒ±‚üØ)).Splits := by
    simpa [Polynomial.map_map] using h_splits.map iso.symm.toRingHom
  rw [‚Üê LinearEquiv.finrank_eq iso.toLinearEquiv]
  rw [‚Üê IntermediateField.AdjoinSimple.card_aut_eq_finrank F E H h_sep h_splits]
  apply Nat.card_congr
  exact Equiv.mk (fun œï => iso.trans (œï.trans iso.symm)) fun œï => iso.symm.trans (œï.trans iso)
",Formal Proof of Stacks Project Tag 09I1,'only if' part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Galois/Basic.lean#L109-L126,Q27041,,9.21.2,lemma,3.0,"['09DU', '09FA', '0ELQ']","\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n      Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n",\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n,"Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n"," by
  obtain ‚ü®Œ±, hŒ±‚ü© := Field.exists_primitive_element F E
  let iso : F‚üÆŒ±‚üØ ‚âÉ‚Çê[F] E :=
    { toFun := fun e => e.val
      invFun := fun e => ‚ü®e, by rw [hŒ±]; exact IntermediateField.mem_top‚ü©
      map_mul' := fun _ _ => rfl
      map_add' := fun _ _ => rfl
      commutes' := fun _ => rfl }
  have H : IsIntegral F Œ± := IsGalois.integral F Œ±
  have h_sep : IsSeparable F Œ± := IsGalois.separable F Œ±
  have h_splits : ((minpoly F Œ±).map (algebraMap F E)).Splits := IsGalois.splits F Œ±
  replace h_splits : ((minpoly F Œ±).map (algebraMap F F‚üÆŒ±‚üØ)).Splits := by
    simpa [Polynomial.map_map] using h_splits.map iso.symm.toRingHom
  rw [‚Üê LinearEquiv.finrank_eq iso.toLinearEquiv]
  rw [‚Üê IntermediateField.AdjoinSimple.card_aut_eq_finrank F E H h_sep h_splits]
  apply Nat.card_congr
  exact Equiv.mk (fun œï => iso.trans (œï.trans iso.symm)) fun œï => iso.symm.trans (œï.trans iso)
","theorem card_aut_eq_finrank [FiniteDimensional F E] [IsGalois F E] :
    Nat.card Gal(E/F) = finrank F E ","Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n","Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: 'only if' part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof‚Äôs ‚Äúonly if‚Äù direction argues from the equality |Aut(E/F)| = [E:F] (via an inequality involving the separable degree) to conclude E/F is separable and normal, hence Galois. The Lean proof, however, assumes/uses `IsGalois` facts (`IsGalois.integral`, `IsGalois.separable`, `IsGalois.splits`) and then proves an equality between the cardinality of automorphisms and the finrank by reducing to the simple-adjoin case using a primitive element and an explicit isomorphism. That corresponds to the ‚Äúif‚Äù direction (Galois ‚áí card_aut = finrank), not the ‚Äúonly if‚Äù direction.\n\nStructurally, the informal proof is a short inequality/equality characterization argument (using Lemma 9.15.9) to deduce normality/separability. The Lean proof instead constructs an isomorphism `F‚üÆŒ±‚üØ ‚âÉ‚Çê[F] E`, rewrites finrank via this isomorphism, applies `IntermediateField.AdjoinSimple.card_aut_eq_finrank` under integrality/separability/splitting hypotheses, and then transfers cardinalities by conjugation. There is no step mirroring the inequality lemma or deriving normality from equality. Hence the alignment is low: it proves a related but essentially opposite implication.""}"
173,09I2,"theorem IsGalois.tower_top_of_isGalois [IsGalois F E] : IsGalois K E :=
  { to_isSeparable := Algebra.isSeparable_tower_top_of_isSeparable F K E
    to_normal := Normal.tower_top_of_normal F K E }
",Formal Proof of Stacks Project Tag 09I2,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Galois/Basic.lean#L152-L154,Q27041,,9.21.4,lemma,3.0,"['09DU', '09FA', '0ELQ']","\n  Lemma 9.21.4. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is Galois over $F$, then $K$ is Galois over $E$. \n\n    \n      Proof.\n      Combine Lemmas 9.15.2 and 9.12.3. \n      $\\square$\n    \n","\n  Lemma 9.21.4. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is Galois over $F$, then $K$ is Galois over $E$. \n\n    \n",Proof.\n      Combine Lemmas 9.15.2 and 9.12.3. \n      $\\square$\n    \n,"
  { to_isSeparable := Algebra.isSeparable_tower_top_of_isSeparable F K E
    to_normal := Normal.tower_top_of_normal F K E }
",theorem IsGalois.tower_top_of_isGalois [IsGalois F E] : IsGalois K E ,"Proof.\n      Combine Lemmas 9.15.2 [[\n  Lemma 9.15.2. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is normal over $F$, then $K$ is normal over $E$. \n\n    \n]] and 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Combine Lemmas 9.15.2 [[\n  Lemma 9.15.2. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is normal over $F$, then $K$ is normal over $E$. \n\n    \n]] and 9.12.3 [[\n  Lemma 9.12.3. Let $K/E/F$ be a tower of algebraic field extensions. \n  \n  \nIf $\\alpha \\in K$ is separable over $F$, then $\\alpha $ is separable over $E$. \n\n\nif $K$ is separable over $F$, then $K$ is separable over $E$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""5"", ""brief_justification"": ""Semantically, the informal proof argues that in a tower F ‚äÜ E ‚äÜ K, normality and separability descend from the bottom field F to the intermediate field E by invoking two lemmas (normal descends; separability descends). The Lean code does exactly this: it constructs the required structure by providing `to_isSeparable := Algebra.isSeparable_tower_top_of_isSeparable F K E` (separability over F implies separability over E) and `to_normal := Normal.tower_top_of_normal F K E` (normal over F implies normal over E). Structurally, both proofs are just a combination of these two descent lemmas with no extra steps, matching the informal ‚Äúcombine Lemma 9.15.2 and 9.12.3‚Äù argument. No extraneous content is introduced.""}"
174,09I1,"theorem of_card_aut_eq_finrank [FiniteDimensional F E]
    (h : Nat.card Gal(E/F) = finrank F E) : IsGalois F E := by
  apply of_fixedField_eq_bot
  have p : 0 < finrank (IntermediateField.fixedField (‚ä§ : Subgroup Gal(E/F))) E := finrank_pos
  classical
  rw [‚Üê IntermediateField.finrank_eq_one_iff, ‚Üê mul_left_inj' (ne_of_lt p).symm,
    finrank_mul_finrank, ‚Üê h, one_mul, IntermediateField.finrank_fixedField_eq_card]
  apply Nat.card_congr
  exact { toFun := fun g => ‚ü®g, Subgroup.mem_top g‚ü©, invFun := (‚Üë) }
",Formal Proof of Stacks Project Tag 09I1,'if' part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Galois/Basic.lean#L489-L497,Q27041,,9.21.2,lemma,3.0,"['09DU', '09FA', '0ELQ']","\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n      Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n",\n  Lemma 9.21.2. Let $E/F$ be a finite extension of fields. Then $E$ is Galois over $F$ if and only if $|\\text{Aut}(E/F)| = [E : F]$. \n\n    \n,"Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n"," by
  apply of_fixedField_eq_bot
  have p : 0 < finrank (IntermediateField.fixedField (‚ä§ : Subgroup Gal(E/F))) E := finrank_pos
  classical
  rw [‚Üê IntermediateField.finrank_eq_one_iff, ‚Üê mul_left_inj' (ne_of_lt p).symm,
    finrank_mul_finrank, ‚Üê h, one_mul, IntermediateField.finrank_fixedField_eq_card]
  apply Nat.card_congr
  exact { toFun := fun g => ‚ü®g, Subgroup.mem_top g‚ü©, invFun := (‚Üë) }
","theorem of_card_aut_eq_finrank [FiniteDimensional F E]
    (h : Nat.card Gal(E/F) = finrank F E) : IsGalois F E ","Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n","Proof.\n      Assume $|\\text{Aut}(E/F)| = [E : F]$. By Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] this implies that $E/F$ is separable and normal, hence Galois. Conversely, if $E/F$ is separable then $[E : F] = [E : F]_ s$ and if $E/F$ is in addition normal, then Lemma 9.15.9 [[\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n]] implies that $|\\text{Aut}(E/F)| = [E : F]$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: 'if' part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof‚Äôs ‚Äúif‚Äù direction argues: assuming |Aut(E/F)| = [E:F], conclude E/F is separable and normal (hence Galois) via a lemma comparing |Aut(E/F)| to the separable degree with an equality characterization of normality. The Lean proof instead applies `of_fixedField_eq_bot` and then performs a finrank/cardinality computation involving the fixed field of the top subgroup of `Gal(E/F)`, using `finrank_mul_finrank`, a hypothesis `h`, and `IntermediateField.finrank_fixedField_eq_card`, ultimately reducing to a `Nat.card_congr` between the subgroup and its subtype. This is a different route: it shows a fixed-field condition (fixed field = ‚ä•) from a finrank/cardinality equality, rather than explicitly deriving separability and normality from the inequality/equality criterion in the informal lemma.\n\nStructurally, the informal proof is a two-step application of a specific inequality lemma (‚â§ separable degree, equality iff normal) plus the observation that equality forces separability. The Lean proof is a chain of rewrites and algebraic manipulations of finranks and cardinalities, with no explicit use of a separable-degree inequality or a normality characterization. It also does not mention separability/normality at all, but rather a fixed-field characterization.\n\nCompleteness/precision: the Lean proof captures at best a related consequence of an equality hypothesis `h` in a Galois-theoretic setting, but it omits the separability/normality reasoning central to the informal ‚Äúif‚Äù part and introduces extra machinery (fixedField of ‚ä§, card congruence) not reflected in the informal argument. Hence only weak alignment.""}"
175,0EXM,"instance IsGalois.normalClosure : IsGalois k (normalClosure k K F) where
  to_isSeparable := Algebra.isSeparable_tower_bot_of_isSeparable k _ F
",Formal Proof of Stacks Project Tag 0EXM,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Galois/Basic.lean#L608-L609,Q27041,,9.21.5,lemma,3.0,"['09DU', '09FA', '0ELQ']",\n  Lemma 9.21.5. Let $L/K$ be a finite separable extension of fields. Let $M$ be the normal closure of $L$ over $K$ (Definition 9.16.4). Then $M/K$ is Galois. \n\n    \n      Proof.\n      The subextension $M/M_{sep}/K$ of Lemma 9.14.6 is normal by Lemma 9.15.4. Since $L/K$ is separable we have $L \\subset M_{sep}$. By minimality $M = M_{sep}$ and the proof is done. \n      $\\square$\n    \n,\n  Lemma 9.21.5. Let $L/K$ be a finite separable extension of fields. Let $M$ be the normal closure of $L$ over $K$ (Definition 9.16.4). Then $M/K$ is Galois. \n\n    \n,Proof.\n      The subextension $M/M_{sep}/K$ of Lemma 9.14.6 is normal by Lemma 9.15.4. Since $L/K$ is separable we have $L \\subset M_{sep}$. By minimality $M = M_{sep}$ and the proof is done. \n      $\\square$\n    \n," Algebra.isSeparable_tower_bot_of_isSeparable k _ F
","instance IsGalois.normalClosure : IsGalois k (normalClosure k K F) where
  to_isSeparable ",Proof.\n      The subextension $M/M_{sep}/K$ of Lemma 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]] is normal by Lemma 9.15.4 [[\n  Lemma 9.15.4. Let $E/F$ be a normal algebraic field extension. Then the subextension $E/E_{sep}/F$ of Lemma 9.14.6 is normal. \n\n    \n]]. Since $L/K$ is separable we have $L \\subset M_{sep}$. By minimality $M = M_{sep}$ and the proof is done. \n      $\\square$\n    \n,Proof.\n      The subextension $M/M_{sep}/K$ of Lemma 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]] is normal by Lemma 9.15.4 [[\n  Lemma 9.15.4. Let $E/F$ be a normal algebraic field extension. Then the subextension $E/E_{sep}/F$ of Lemma 9.14.6 is normal. \n\n    \n]]. Since $L/K$ is separable we have $L \\subset M_{sep}$. By minimality $M = M_{sep}$ and the proof is done. \n      $\\square$\n    \n,"{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof argues about a separable closure subextension M_sep inside an algebraic normal extension M/K, uses normality of the separable subextension, then uses the assumption that L/K is separable to deduce L ‚äÜ M_sep and by minimality concludes M = M_sep. The Lean term `Algebra.isSeparable_tower_bot_of_isSeparable k _ F` instead looks like a generic lemma about separability in a tower (from the bottom field) and does not reference normality, the construction of a separable subextension, or a minimality argument. Structurally, the informal proof is a multi-step field-theoretic argument (existence/uniqueness of M_sep, normality, inclusion, minimality), while the formal proof is a one-line application of a separability-tower lemma, so it does not mirror the informal structure or key ingredients.""}"
176,09G1,"noncomputable def adjoinRootEquivAdjoin (h : IsIntegral F Œ±) :
    AdjoinRoot (minpoly F Œ±) ‚âÉ‚Çê[F] F‚üÆŒ±‚üØ :=
  AlgEquiv.ofBijective
    (AdjoinRoot.liftAlgHom (minpoly F Œ±) _ (AdjoinSimple.gen F Œ±) (aeval_gen_minpoly F Œ±))
    (by
      set f := AdjoinRoot.lift _ _ (aeval_gen_minpoly F Œ± :)
      haveI := Fact.mk (minpoly.irreducible h)
      constructor
      ¬∑ exact RingHom.injective f
      ¬∑ suffices F‚üÆŒ±‚üØ.toSubfield ‚â§ RingHom.fieldRange (F‚üÆŒ±‚üØ.toSubfield.subtype.comp f) by
          intro x
          obtain ‚ü®y, hy‚ü© := this (Subtype.mem x)
          exact ‚ü®y, Subtype.ext hy‚ü©
        refine Subfield.closure_le.mpr (Set.union_subset (fun x hx => ?_) ?_)
        ¬∑ obtain ‚ü®y, hy‚ü© := hx
          refine ‚ü®y, ?_‚ü©
          rw [RingHom.comp_apply]
          dsimp only [coe_type_toSubfield]
          rw [AdjoinRoot.lift_of (aeval_gen_minpoly F Œ±)]
          exact hy
        ¬∑ refine Set.singleton_subset_iff.mpr ‚ü®AdjoinRoot.root (minpoly F Œ±), ?_‚ü©
          rw [RingHom.comp_apply]
          dsimp only [coe_type_toSubfield]
          rw [AdjoinRoot.lift_root (aeval_gen_minpoly F Œ±)]
          rfl)
",Formal Proof of Stacks Project Tag 09G1,Algebraic case,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IntermediateField/Adjoin/Basic.lean#L388-L412,Q27041,Classification of simple extensions,9.6.8,lemma,3.0,"['09FT', '09FA', '0ELQ']","\n  Lemma 9.6.8 (Classification of simple extensions).  If a field extension $F/k$ is generated by one element, then it is $k$-isomorphic either to the rational function field $k(t)/k$ or to one of the extensions $k[t]/(P)$ for $P \\in k[t]$ irreducible. \n\n    \n      Proof.\n      Let $\\alpha \\in F$ be such that $F = k(\\alpha )$; by assumption, such an $\\alpha $ exists. There is a morphism of rings \n    \n      \n  \\[  k[t] \\to F  \\]\n\n    \n       sending the indeterminate $t$ to $\\alpha $. The image is a domain, so the kernel is a prime ideal. Thus, it is either $(0)$ or $(P)$ for $P \\in k[t]$ irreducible. \n    \n      If the kernel is $(P)$ for $P \\in k[t]$ irreducible, then the map factors through $k[t]/(P)$, and induces a morphism of fields $k[t]/(P) \\to F$. Since the image contains $\\alpha $, we see easily that the map is surjective, hence an isomorphism. In this case, $k[t]/(P) \\simeq F$. \n    \n      If the kernel is trivial, then we have an injection $k[t] \\to F$. One may thus define a morphism of the quotient field $k(t)$ into $F$; given a quotient $R(t)/Q(t)$ with $R(t), Q(t) \\in k[t]$, we map this to $R(\\alpha )/Q(\\alpha )$. The hypothesis that $k[t] \\to F$ is injective implies that $Q(\\alpha ) \\neq 0$ unless $Q$ is the zero polynomial. The quotient field of $k[t]$ is the rational function field $k(t)$, so we get a morphism $k(t) \\to F$ whose image contains $\\alpha $. It is thus surjective, hence an isomorphism. \n      $\\square$\n    \n","\n  Lemma 9.6.8 (Classification of simple extensions).  If a field extension $F/k$ is generated by one element, then it is $k$-isomorphic either to the rational function field $k(t)/k$ or to one of the extensions $k[t]/(P)$ for $P \\in k[t]$ irreducible. \n\n    \n","Proof.\n      Let $\\alpha \\in F$ be such that $F = k(\\alpha )$; by assumption, such an $\\alpha $ exists. There is a morphism of rings \n    \n      \n  \\[  k[t] \\to F  \\]\n\n    \n       sending the indeterminate $t$ to $\\alpha $. The image is a domain, so the kernel is a prime ideal. Thus, it is either $(0)$ or $(P)$ for $P \\in k[t]$ irreducible. \n    \n      If the kernel is $(P)$ for $P \\in k[t]$ irreducible, then the map factors through $k[t]/(P)$, and induces a morphism of fields $k[t]/(P) \\to F$. Since the image contains $\\alpha $, we see easily that the map is surjective, hence an isomorphism. In this case, $k[t]/(P) \\simeq F$. \n    \n      If the kernel is trivial, then we have an injection $k[t] \\to F$. One may thus define a morphism of the quotient field $k(t)$ into $F$; given a quotient $R(t)/Q(t)$ with $R(t), Q(t) \\in k[t]$, we map this to $R(\\alpha )/Q(\\alpha )$. The hypothesis that $k[t] \\to F$ is injective implies that $Q(\\alpha ) \\neq 0$ unless $Q$ is the zero polynomial. The quotient field of $k[t]$ is the rational function field $k(t)$, so we get a morphism $k(t) \\to F$ whose image contains $\\alpha $. It is thus surjective, hence an isomorphism. \n      $\\square$\n    \n","
  AlgEquiv.ofBijective
    (AdjoinRoot.liftAlgHom (minpoly F Œ±) _ (AdjoinSimple.gen F Œ±) (aeval_gen_minpoly F Œ±))
    (by
      set f := AdjoinRoot.lift _ _ (aeval_gen_minpoly F Œ± :)
      haveI := Fact.mk (minpoly.irreducible h)
      constructor
      ¬∑ exact RingHom.injective f
      ¬∑ suffices F‚üÆŒ±‚üØ.toSubfield ‚â§ RingHom.fieldRange (F‚üÆŒ±‚üØ.toSubfield.subtype.comp f) by
          intro x
          obtain ‚ü®y, hy‚ü© := this (Subtype.mem x)
          exact ‚ü®y, Subtype.ext hy‚ü©
        refine Subfield.closure_le.mpr (Set.union_subset (fun x hx => ?_) ?_)
        ¬∑ obtain ‚ü®y, hy‚ü© := hx
          refine ‚ü®y, ?_‚ü©
          rw [RingHom.comp_apply]
          dsimp only [coe_type_toSubfield]
          rw [AdjoinRoot.lift_of (aeval_gen_minpoly F Œ±)]
          exact hy
        ¬∑ refine Set.singleton_subset_iff.mpr ‚ü®AdjoinRoot.root (minpoly F Œ±), ?_‚ü©
          rw [RingHom.comp_apply]
          dsimp only [coe_type_toSubfield]
          rw [AdjoinRoot.lift_root (aeval_gen_minpoly F Œ±)]
          rfl)
","noncomputable def adjoinRootEquivAdjoin (h : IsIntegral F Œ±) :
    AdjoinRoot (minpoly F Œ±) ‚âÉ‚Çê[F] F‚üÆŒ±‚üØ ","Proof.\n      Let $\\alpha \\in F$ be such that $F = k(\\alpha )$; by assumption, such an $\\alpha $ exists. There is a morphism of rings \n    \n      \n  \\[  k[t] \\to F  \\]\n\n    \n       sending the indeterminate $t$ to $\\alpha $. The image is a domain, so the kernel is a prime ideal. Thus, it is either $(0)$ or $(P)$ for $P \\in k[t]$ irreducible. \n    \n      If the kernel is $(P)$ for $P \\in k[t]$ irreducible, then the map factors through $k[t]/(P)$, and induces a morphism of fields $k[t]/(P) \\to F$. Since the image contains $\\alpha $, we see easily that the map is surjective, hence an isomorphism. In this case, $k[t]/(P) \\simeq F$. \n    \n      If the kernel is trivial, then we have an injection $k[t] \\to F$. One may thus define a morphism of the quotient field $k(t)$ into $F$; given a quotient $R(t)/Q(t)$ with $R(t), Q(t) \\in k[t]$, we map this to $R(\\alpha )/Q(\\alpha )$. The hypothesis that $k[t] \\to F$ is injective implies that $Q(\\alpha ) \\neq 0$ unless $Q$ is the zero polynomial. The quotient field of $k[t]$ is the rational function field $k(t)$, so we get a morphism $k(t) \\to F$ whose image contains $\\alpha $. It is thus surjective, hence an isomorphism. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha \\in F$ be such that $F = k(\\alpha )$; by assumption, such an $\\alpha $ exists. There is a morphism of rings \n    \n      \n  \\[  k[t] \\to F  \\]\n\n    \n       sending the indeterminate $t$ to $\\alpha $. The image is a domain, so the kernel is a prime ideal. Thus, it is either $(0)$ or $(P)$ for $P \\in k[t]$ irreducible. \n    \n      If the kernel is $(P)$ for $P \\in k[t]$ irreducible, then the map factors through $k[t]/(P)$, and induces a morphism of fields $k[t]/(P) \\to F$. Since the image contains $\\alpha $, we see easily that the map is surjective, hence an isomorphism. In this case, $k[t]/(P) \\simeq F$. \n    \n      If the kernel is trivial, then we have an injection $k[t] \\to F$. One may thus define a morphism of the quotient field $k(t)$ into $F$; given a quotient $R(t)/Q(t)$ with $R(t), Q(t) \\in k[t]$, we map this to $R(\\alpha )/Q(\\alpha )$. The hypothesis that $k[t] \\to F$ is injective implies that $Q(\\alpha ) \\neq 0$ unless $Q$ is the zero polynomial. The quotient field of $k[t]$ is the rational function field $k(t)$, so we get a morphism $k(t) \\to F$ whose image contains $\\alpha $. It is thus surjective, hence an isomorphism. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Algebraic case","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues a dichotomy for a simple field extension F = k(Œ±): either Œ± is algebraic (kernel (P) with P irreducible, giving k[t]/(P) ‚âÖ F) or Œ± is transcendental (kernel 0, giving k(t) ‚âÖ F). The Lean proof, however, is entirely in the algebraic case: it constructs an `AlgEquiv` using `AdjoinRoot.liftAlgHom (minpoly F Œ±)` and bijectivity coming from irreducibility of the minimal polynomial, i.e. it proves an isomorphism between an adjoin-root construction k[t]/(minpoly) and the simple algebraic extension k‚üÆŒ±‚üØ. It does not address the transcendental/kernel-zero case or the rational function field k(t) at all. Structurally, the Lean proof follows the standard algebraic-case route (lift from AdjoinRoot, then prove injective/surjective via fieldRange and closure arguments), which corresponds only to the first branch of the informal argument (factor through k[t]/(P) and show surjective). Because the informal proof includes an essential second case and the Lean proof covers only the algebraic branch, the overall alignment is low, though within the algebraic case the constructions are broadly consistent.""}"
177,09GN,"theorem adjoin.finrank {x : L} (hx : IsIntegral K x) :
    Module.finrank K K‚üÆx‚üØ = (minpoly K x).natDegree := by
  rw [PowerBasis.finrank (adjoin.powerBasis hx :)]
  rfl
",Formal Proof of Stacks Project Tag 09GN,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IntermediateField/Adjoin/Basic.lean#L459-L462,Q27041,,9.9.2,lemma,3.0,"['09GL', '09FA', '0ELQ']","\n  Lemma 9.9.2. The degree of the minimal polynomial is $[k(\\alpha ) : k]$. \n\n    \n      Proof.\n      This is just a restatement of the argument in Lemma 9.6.8: the observation is that if $P$ is the minimal polynomial of $\\alpha $, then the map \n    \n      \n  \\[  k[x]/(P) \\to k(\\alpha ), \\quad x \\mapsto \\alpha  \\]\n\n    \n       is an isomorphism as in the aforementioned proof, and we have counted the degree of such an extension (see Example 9.7.6). \n      $\\square$\n    \n",\n  Lemma 9.9.2. The degree of the minimal polynomial is $[k(\\alpha ) : k]$. \n\n    \n,"Proof.\n      This is just a restatement of the argument in Lemma 9.6.8: the observation is that if $P$ is the minimal polynomial of $\\alpha $, then the map \n    \n      \n  \\[  k[x]/(P) \\to k(\\alpha ), \\quad x \\mapsto \\alpha  \\]\n\n    \n       is an isomorphism as in the aforementioned proof, and we have counted the degree of such an extension (see Example 9.7.6). \n      $\\square$\n    \n"," by
  rw [PowerBasis.finrank (adjoin.powerBasis hx :)]
  rfl
","theorem adjoin.finrank {x : L} (hx : IsIntegral K x) :
    Module.finrank K K‚üÆx‚üØ = (minpoly K x).natDegree ","Proof.\n      This is just a restatement of the argument in Lemma 9.6.8 [[\n  Lemma 9.6.8 (Classification of simple extensions).  If a field extension $F/k$ is generated by one element, then it is $k$-isomorphic either to the rational function field $k(t)/k$ or to one of the extensions $k[t]/(P)$ for $P \\in k[t]$ irreducible. \n\n    \n]]: the observation is that if $P$ is the minimal polynomial of $\\alpha $, then the map \n    \n      \n  \\[  k[x]/(P) \\to k(\\alpha ), \\quad x \\mapsto \\alpha  \\]\n\n    \n       is an isomorphism as in the aforementioned proof, and we have counted the degree of such an extension (see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]). \n      $\\square$\n    \n","Proof.\n      This is just a restatement of the argument in Lemma 9.6.8 [[\n  Lemma 9.6.8 (Classification of simple extensions).  If a field extension $F/k$ is generated by one element, then it is $k$-isomorphic either to the rational function field $k(t)/k$ or to one of the extensions $k[t]/(P)$ for $P \\in k[t]$ irreducible. \n\n    \n]]: the observation is that if $P$ is the minimal polynomial of $\\alpha $, then the map \n    \n      \n  \\[  k[x]/(P) \\to k(\\alpha ), \\quad x \\mapsto \\alpha  \\]\n\n    \n       is an isomorphism as in the aforementioned proof, and we have counted the degree of such an extension (see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]). \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues via the classification of simple extensions and the explicit isomorphism k[x]/(P) ‚âÖ k(Œ±), then computes the degree/finrank as deg(P) by exhibiting a basis {1,t,‚Ä¶,t^{d‚àí1}} and spanning/independence arguments. The Lean proof, however, is a very short rewrite using `PowerBasis.finrank (adjoin.powerBasis hx)` followed by `rfl`, which only restates a finrank computation already packaged in the `powerBasis` API; it does not reflect the classification/isomorphism-to-quotient or the basis/degree argument described informally. Structurally there is essentially no correspondence: the informal proof is multi-step (isomorphism + basis + dimension count), while the formal proof is a one-line rewrite relying on a pre-proved lemma. Thus it captures at most the final numerical equality but not the method or intermediate content.""}"
180,09GT,"def AlgebraicClosure : Type u :=
  MvPolynomial (Vars k) k ‚ß∏ maxIdeal k
",Formal Proof of Stacks Project Tag 09GT,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IsAlgClosed/AlgebraicClosure.lean#L127-L128,Q27041,,9.10.4,theorem,3.0,"['09GP', '09FA', '0ELQ']","\n  Theorem 9.10.4. Every field has an algebraic closure. \n\n    \n      Proof.\n      Let $F$ be a field. By Lemma 9.8.9 the cardinality of an algebraic extension of $F$ is bounded by $\\max (\\aleph _0, |F|)$. Choose a set $S$ containing $F$ with $|S| > \\max (\\aleph _0, |F|)$. Let\'s consider triples $(E, \\sigma _ E, \\mu _ E)$ where \n    \n      \n  \n$E$ is a set with $F \\subset E \\subset S$, and \n\n\n$\\sigma _ E : E \\times E \\to E$ and $\\mu _ E : E \\times E \\to E$ are maps of sets such that $(E, \\sigma _ E, \\mu _ E)$ defines the structure of a field extension of $F$ (in particular $\\sigma _ E(a, b) = a +_ F b$ for $a, b \\in F$ and similarly for $\\mu _ E$), and \n\n\n$E/F$ is an algebraic field extension. \n\n\n\n    \n       The collection of all triples $(E, \\sigma _ E, \\mu _ E)$ forms a set $I$. For $i \\in I$ we will denote $E_ i = (E_ i, \\sigma _ i, \\mu _ i)$ the corresponding field extension to $F$. We define a partial ordering on $I$ by declaring $i \\leq i\'$ if and only if $E_ i \\subset E_{i\'}$ (this makes sense as $E_ i$ and $E_{i\'}$ are subsets of the same set $S$) and we have $\\sigma _ i = \\sigma _{i\'}|_{E_ i \\times E_ i}$ and $\\mu _ i = \\mu _{i\'}|_{E_ i \\times E_ i}$, in other words, $E_{i\'}$ is a field extension of $E_ i$. \n    \n      Let $T \\subset I$ be a totally ordered subset. Then it is clear that $E_ T = \\bigcup _{i \\in T} E_ i$ with induced maps $\\sigma _ T = \\bigcup \\sigma _ i$ and $\\mu _ T = \\bigcup \\mu _ i$ is another element of $I$. In other words every totally order subset of $I$ has a upper bound in $I$. By Zorn\'s lemma there exists a maximal element $(E, \\sigma _ E, \\mu _ E)$ in $I$. We claim that $E$ is an algebraic closure. Since by definition of $I$ the extension $E/F$ is algebraic, it suffices to show that $E$ is algebraically closed. \n    \n      To see this we argue by contradiction. Namely, suppose that $E$ is not algebraically closed. Then there exists an irreducible polynomial $P$ over $E$ of degree $> 1$, see Lemma 9.10.2. By Lemma 9.8.5 we obtain a nontrivial finite extension $E\' = E[x]/(P)$. Observe that $E\'/F$ is algebraic by Lemma 9.8.8. Thus the cardinality of $E\'$ is $\\leq \\max (\\aleph _0, |F|)$. By elementary set theory we can extend the given injection $E \\subset S$ to an injection $E\' \\to S$. In other words, we may think of $E\'$ as an element of our set $I$ contradicting the maximality of $E$. This contradiction completes the proof. \n      $\\square$\n    \n",\n  Theorem 9.10.4. Every field has an algebraic closure. \n\n    \n,"Proof.\n      Let $F$ be a field. By Lemma 9.8.9 the cardinality of an algebraic extension of $F$ is bounded by $\\max (\\aleph _0, |F|)$. Choose a set $S$ containing $F$ with $|S| > \\max (\\aleph _0, |F|)$. Let\'s consider triples $(E, \\sigma _ E, \\mu _ E)$ where \n    \n      \n  \n$E$ is a set with $F \\subset E \\subset S$, and \n\n\n$\\sigma _ E : E \\times E \\to E$ and $\\mu _ E : E \\times E \\to E$ are maps of sets such that $(E, \\sigma _ E, \\mu _ E)$ defines the structure of a field extension of $F$ (in particular $\\sigma _ E(a, b) = a +_ F b$ for $a, b \\in F$ and similarly for $\\mu _ E$), and \n\n\n$E/F$ is an algebraic field extension. \n\n\n\n    \n       The collection of all triples $(E, \\sigma _ E, \\mu _ E)$ forms a set $I$. For $i \\in I$ we will denote $E_ i = (E_ i, \\sigma _ i, \\mu _ i)$ the corresponding field extension to $F$. We define a partial ordering on $I$ by declaring $i \\leq i\'$ if and only if $E_ i \\subset E_{i\'}$ (this makes sense as $E_ i$ and $E_{i\'}$ are subsets of the same set $S$) and we have $\\sigma _ i = \\sigma _{i\'}|_{E_ i \\times E_ i}$ and $\\mu _ i = \\mu _{i\'}|_{E_ i \\times E_ i}$, in other words, $E_{i\'}$ is a field extension of $E_ i$. \n    \n      Let $T \\subset I$ be a totally ordered subset. Then it is clear that $E_ T = \\bigcup _{i \\in T} E_ i$ with induced maps $\\sigma _ T = \\bigcup \\sigma _ i$ and $\\mu _ T = \\bigcup \\mu _ i$ is another element of $I$. In other words every totally order subset of $I$ has a upper bound in $I$. By Zorn\'s lemma there exists a maximal element $(E, \\sigma _ E, \\mu _ E)$ in $I$. We claim that $E$ is an algebraic closure. Since by definition of $I$ the extension $E/F$ is algebraic, it suffices to show that $E$ is algebraically closed. \n    \n      To see this we argue by contradiction. Namely, suppose that $E$ is not algebraically closed. Then there exists an irreducible polynomial $P$ over $E$ of degree $> 1$, see Lemma 9.10.2. By Lemma 9.8.5 we obtain a nontrivial finite extension $E\' = E[x]/(P)$. Observe that $E\'/F$ is algebraic by Lemma 9.8.8. Thus the cardinality of $E\'$ is $\\leq \\max (\\aleph _0, |F|)$. By elementary set theory we can extend the given injection $E \\subset S$ to an injection $E\' \\to S$. In other words, we may think of $E\'$ as an element of our set $I$ contradicting the maximality of $E$. This contradiction completes the proof. \n      $\\square$\n    \n","
  MvPolynomial (Vars k) k ‚ß∏ maxIdeal k
",def AlgebraicClosure : Type u ,"Proof.\n      Let $F$ be a field. By Lemma 9.8.9 [[\n  Lemma 9.8.9. Let $E/F$ be an algebraic extension of fields. Then the cardinality $|E|$ of $E$ is at most $\\max (\\aleph _0, |F|)$. \n\n    \n]] the cardinality of an algebraic extension of $F$ is bounded by $\\max (\\aleph _0, |F|)$. Choose a set $S$ containing $F$ with $|S| > \\max (\\aleph _0, |F|)$. Let\'s consider triples $(E, \\sigma _ E, \\mu _ E)$ where \n    \n      \n  \n$E$ is a set with $F \\subset E \\subset S$, and \n\n\n$\\sigma _ E : E \\times E \\to E$ and $\\mu _ E : E \\times E \\to E$ are maps of sets such that $(E, \\sigma _ E, \\mu _ E)$ defines the structure of a field extension of $F$ (in particular $\\sigma _ E(a, b) = a +_ F b$ for $a, b \\in F$ and similarly for $\\mu _ E$), and \n\n\n$E/F$ is an algebraic field extension. \n\n\n\n    \n       The collection of all triples $(E, \\sigma _ E, \\mu _ E)$ forms a set $I$. For $i \\in I$ we will denote $E_ i = (E_ i, \\sigma _ i, \\mu _ i)$ the corresponding field extension to $F$. We define a partial ordering on $I$ by declaring $i \\leq i\'$ if and only if $E_ i \\subset E_{i\'}$ (this makes sense as $E_ i$ and $E_{i\'}$ are subsets of the same set $S$) and we have $\\sigma _ i = \\sigma _{i\'}|_{E_ i \\times E_ i}$ and $\\mu _ i = \\mu _{i\'}|_{E_ i \\times E_ i}$, in other words, $E_{i\'}$ is a field extension of $E_ i$. \n    \n      Let $T \\subset I$ be a totally ordered subset. Then it is clear that $E_ T = \\bigcup _{i \\in T} E_ i$ with induced maps $\\sigma _ T = \\bigcup \\sigma _ i$ and $\\mu _ T = \\bigcup \\mu _ i$ is another element of $I$. In other words every totally order subset of $I$ has a upper bound in $I$. By Zorn\'s lemma there exists a maximal element $(E, \\sigma _ E, \\mu _ E)$ in $I$. We claim that $E$ is an algebraic closure. Since by definition of $I$ the extension $E/F$ is algebraic, it suffices to show that $E$ is algebraically closed. \n    \n      To see this we argue by contradiction. Namely, suppose that $E$ is not algebraically closed. Then there exists an irreducible polynomial $P$ over $E$ of degree $> 1$, see Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. By Lemma 9.8.5 [[\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n]] we obtain a nontrivial finite extension $E\' = E[x]/(P)$. Observe that $E\'/F$ is algebraic by Lemma 9.8.8 [[\n  Lemma 9.8.8. Let $E/k$ and $F/E$ be algebraic extensions of fields. Then $F/k$ is an algebraic extension of fields. \n\n    \n]]. Thus the cardinality of $E\'$ is $\\leq \\max (\\aleph _0, |F|)$. By elementary set theory we can extend the given injection $E \\subset S$ to an injection $E\' \\to S$. In other words, we may think of $E\'$ as an element of our set $I$ contradicting the maximality of $E$. This contradiction completes the proof. \n      $\\square$\n    \n","Proof.\n      Let $F$ be a field. By Lemma 9.8.9 [[\n  Lemma 9.8.9. Let $E/F$ be an algebraic extension of fields. Then the cardinality $|E|$ of $E$ is at most $\\max (\\aleph _0, |F|)$. \n\n    \n]] the cardinality of an algebraic extension of $F$ is bounded by $\\max (\\aleph _0, |F|)$. Choose a set $S$ containing $F$ with $|S| > \\max (\\aleph _0, |F|)$. Let\'s consider triples $(E, \\sigma _ E, \\mu _ E)$ where \n    \n      \n  \n$E$ is a set with $F \\subset E \\subset S$, and \n\n\n$\\sigma _ E : E \\times E \\to E$ and $\\mu _ E : E \\times E \\to E$ are maps of sets such that $(E, \\sigma _ E, \\mu _ E)$ defines the structure of a field extension of $F$ (in particular $\\sigma _ E(a, b) = a +_ F b$ for $a, b \\in F$ and similarly for $\\mu _ E$), and \n\n\n$E/F$ is an algebraic field extension. \n\n\n\n    \n       The collection of all triples $(E, \\sigma _ E, \\mu _ E)$ forms a set $I$. For $i \\in I$ we will denote $E_ i = (E_ i, \\sigma _ i, \\mu _ i)$ the corresponding field extension to $F$. We define a partial ordering on $I$ by declaring $i \\leq i\'$ if and only if $E_ i \\subset E_{i\'}$ (this makes sense as $E_ i$ and $E_{i\'}$ are subsets of the same set $S$) and we have $\\sigma _ i = \\sigma _{i\'}|_{E_ i \\times E_ i}$ and $\\mu _ i = \\mu _{i\'}|_{E_ i \\times E_ i}$, in other words, $E_{i\'}$ is a field extension of $E_ i$. \n    \n      Let $T \\subset I$ be a totally ordered subset. Then it is clear that $E_ T = \\bigcup _{i \\in T} E_ i$ with induced maps $\\sigma _ T = \\bigcup \\sigma _ i$ and $\\mu _ T = \\bigcup \\mu _ i$ is another element of $I$. In other words every totally order subset of $I$ has a upper bound in $I$. By Zorn\'s lemma there exists a maximal element $(E, \\sigma _ E, \\mu _ E)$ in $I$. We claim that $E$ is an algebraic closure. Since by definition of $I$ the extension $E/F$ is algebraic, it suffices to show that $E$ is algebraically closed. \n    \n      To see this we argue by contradiction. Namely, suppose that $E$ is not algebraically closed. Then there exists an irreducible polynomial $P$ over $E$ of degree $> 1$, see Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. By Lemma 9.8.5 [[\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n]] we obtain a nontrivial finite extension $E\' = E[x]/(P)$. Observe that $E\'/F$ is algebraic by Lemma 9.8.8 [[\n  Lemma 9.8.8. Let $E/k$ and $F/E$ be algebraic extensions of fields. Then $F/k$ is an algebraic extension of fields. \n\n    \n]]. Thus the cardinality of $E\'$ is $\\leq \\max (\\aleph _0, |F|)$. By elementary set theory we can extend the given injection $E \\subset S$ to an injection $E\' \\to S$. In other words, we may think of $E\'$ as an element of our set $I$ contradicting the maximality of $E$. This contradiction completes the proof. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is a Zorn‚Äôs lemma construction of an algebraic closure of a field: it defines a poset of algebraic extensions inside a large set, shows chains have upper bounds via unions, applies Zorn to get a maximal algebraic extension, and then proves it is algebraically closed by adjoining a root of an irreducible polynomial to contradict maximality (using cardinality bounds to embed the finite extension back into the ambient set).\n\nThe formal_proof is not a proof of that statement at all; it is just the expression/type `MvPolynomial (Vars k) k ‚ß∏ maxIdeal k`, i.e. a quotient of a multivariate polynomial ring by a maximal ideal. There is no Zorn‚Äôs lemma argument, no poset/chains/upper bound construction, no cardinality reasoning, and no contradiction via adjoining roots. Semantically it points to a different algebraic object (a residue field), and structurally it contains none of the steps of the informal proof.""}"
182,09GR,"theorem exists_root [IsAlgClosed k] (p : k[X]) (hp : p.degree ‚â† 0) : ‚àÉ x, IsRoot p x :=
  (IsAlgClosed.splits p).exists_eval_eq_zero hp
",Formal Proof of Stacks Project Tag 09GR,(4) ‚üπ (3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IsAlgClosed/Basic.lean#L91-L92,Q27041,,9.10.2,lemma,3.0,"['09GP', '09FA', '0ELQ']","\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n      Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","
  (IsAlgClosed.splits p).exists_eval_eq_zero hp
","theorem exists_root [IsAlgClosed k] (p : k[X]) (hp : p.degree ‚â† 0) : ‚àÉ x, IsRoot p x ","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (4) ‚üπ (3)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term `(IsAlgClosed.splits p).exists_eval_eq_zero hp` proves that over an algebraically closed field, a polynomial `p` satisfying `hp` (typically `p ‚â† 0` or `p` nonconstant) has a root: it uses the fact that `p` splits and then extracts a root with `eval = 0`. This corresponds to the direction (1) ‚áí (3) (algebraically closed ‚áí every nonconstant polynomial has a root), not to the requested direction (4) ‚áí (3) (product of linear factors ‚áí has a root). Structurally, the informal proof for (4) ‚áí (3) would argue: if `p` is a product of linear factors, pick one factor `(X - a)` and conclude `p(a)=0`. The Lean proof instead goes through `IsAlgClosed.splits`, which is a different hypothesis and proof route. Hence there is partial thematic overlap (concluding existence of a root) but the assumptions and structure do not match the specified implication.""}"
183,09GR,"theorem of_exists_root (H : ‚àÄ p : k[X], p.Monic ‚Üí Irreducible p ‚Üí ‚àÉ x, p.eval x = 0) :
    IsAlgClosed k := by
  replace H (p : k[X]) (hp : Irreducible p) : ‚àÉ x, p.eval x = 0 := by
    obtain ‚ü®x, hx‚ü© := H (p * C (leadingCoeff p)‚Åª¬π) (monic_mul_leadingCoeff_inv hp.ne_zero)
      (irreducible_mul_leadingCoeff_inv.mpr hp)
    exact ‚ü®x, by simpa [hp.ne_zero] using hx‚ü©
  refine ‚ü®fun p ‚Ü¶ ?_‚ü©
  by_cases hp0 : p = 0
  ¬∑ simp [hp0]
  obtain ‚ü®u, hu‚ü© := UniqueFactorizationMonoid.factors_prod hp0
  rw [‚Üê hu]
  refine (Splits.multisetProd fun f hf ‚Ü¶ ?_).mul u.isUnit.splits
  let h := UniqueFactorizationMonoid.irreducible_of_factor f hf
  obtain ‚ü®x, hx‚ü© := H f h
  exact Splits.of_degree_eq_one (degree_eq_one_of_irreducible_of_root h hx)
",Formal Proof of Stacks Project Tag 09GR,(3) ‚üπ (4),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IsAlgClosed/Basic.lean#L194-L208,Q27041,,9.10.2,lemma,3.0,"['09GP', '09FA', '0ELQ']","\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n      Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n"," by
  replace H (p : k[X]) (hp : Irreducible p) : ‚àÉ x, p.eval x = 0 := by
    obtain ‚ü®x, hx‚ü© := H (p * C (leadingCoeff p)‚Åª¬π) (monic_mul_leadingCoeff_inv hp.ne_zero)
      (irreducible_mul_leadingCoeff_inv.mpr hp)
    exact ‚ü®x, by simpa [hp.ne_zero] using hx‚ü©
  refine ‚ü®fun p ‚Ü¶ ?_‚ü©
  by_cases hp0 : p = 0
  ¬∑ simp [hp0]
  obtain ‚ü®u, hu‚ü© := UniqueFactorizationMonoid.factors_prod hp0
  rw [‚Üê hu]
  refine (Splits.multisetProd fun f hf ‚Ü¶ ?_).mul u.isUnit.splits
  let h := UniqueFactorizationMonoid.irreducible_of_factor f hf
  obtain ‚ü®x, hx‚ü© := H f h
  exact Splits.of_degree_eq_one (degree_eq_one_of_irreducible_of_root h hx)
","theorem of_exists_root (H : ‚àÄ p : k[X], p.Monic ‚Üí Irreducible p ‚Üí ‚àÉ x, p.eval x = 0) :
    IsAlgClosed k ","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3) ‚üπ (4)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the (3) ‚áí (4) direction: it assumes a hypothesis H giving a root for every irreducible polynomial (after normalizing to monic via multiplication by the inverse of the leading coefficient), and then proves that every polynomial splits into linear factors (a `Splits` statement). Structurally, it follows the standard factorization-based argument: handle the zero polynomial separately, write a nonzero polynomial as a unit times a product of irreducible factors using `UniqueFactorizationMonoid.factors_prod`, then show each irreducible factor splits by producing a root via H and concluding degree = 1, hence linear. This corresponds to the informal idea that having roots for all nonconstant polynomials yields complete linear factorization, though the informal proof uses induction on degree and division by (X-Œ±) rather than UFD factorization. The mismatch is mainly structural (UFD/multiset product vs degree induction) and the Lean hypothesis is effectively about irreducibles (with a monic normalization step) rather than directly ‚Äúevery nonconstant polynomial has a root,‚Äù but overall the mathematical content of (3) ‚áí (4) is captured.""}"
184,09GR,"theorem degree_eq_one_of_irreducible [IsAlgClosed k] {p : k[X]} (hp : Irreducible p) :
    p.degree = 1 :=
  (IsAlgClosed.splits p).degree_eq_one_of_irreducible hp
",Formal Proof of Stacks Project Tag 09GR,(4) ‚üπ (2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IsAlgClosed/Basic.lean#L229-L231,Q27041,,9.10.2,lemma,3.0,"['09GP', '09FA', '0ELQ']","\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n      Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","
  (IsAlgClosed.splits p).degree_eq_one_of_irreducible hp
","theorem degree_eq_one_of_irreducible [IsAlgClosed k] {p : k[X]} (hp : Irreducible p) :
    p.degree = 1 ","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n","Proof.\n      If $F$ is algebraically closed, then every irreducible polynomial is linear. Namely, if there exists an irreducible polynomial of degree $> 1$, then this generates a nontrivial finite (hence algebraic) field extension, see Example 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. Thus (1) implies (2). If every irreducible polynomial is linear, then every irreducible polynomial has a root, whence every nonconstant polynomial has a root. Thus (2) implies (3). \n    \n      Assume every nonconstant polynomial has a root. Let $P \\in F[x]$ be nonconstant. If $P(\\alpha ) = 0$ with $\\alpha \\in F$, then we see that $P = (x - \\alpha )Q$ for some $Q \\in F[x]$ (by division with remainder). Thus we can argue by induction on the degree that any nonconstant polynomial can be written as a product $c \\prod (x - \\alpha _ i)$. \n    \n      Finally, suppose that every nonconstant polynomial over $F$ is a product of linear factors. Let $E/F$ be an algebraic extension. Then all the simple subextensions $F(\\alpha )/F$ of $E$ are necessarily trivial (because the only irreducible polynomials are linear by assumption). Thus $E = F$. We see that (4) implies (1) and we are done. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (4) ‚üπ (2)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean term ` (IsAlgClosed.splits p).degree_eq_one_of_irreducible hp` proves that over an algebraically closed field, an irreducible polynomial `p` has degree 1 (i.e., is linear). This matches the informal direction (4) ‚üπ (2) in the sense that ‚Äúsplits into linear factors‚Äù (captured by `splits`) implies irreducibles must be linear. Structurally, however, the informal proof argues via field extensions/contradiction, while the Lean proof uses the standard lemma that an irreducible polynomial that splits must have degree 1, so the proof strategy differs though the logical content aligns. The Lean proof is also narrower than the full informal excerpt (which discusses multiple equivalences), but it correctly targets the specified implication without extraneous claims.""}"
187,09GU,"noncomputable irreducible_def lift : S ‚Üí‚Çê[R] M := by
  letI : IsDomain R := (FaithfulSMul.algebraMap_injective R S).isDomain _
  letI := FractionRing.liftAlgebra R M
  letI := FractionRing.liftAlgebra R (FractionRing S)
  have := FractionRing.isScalarTower_liftAlgebra R M
  have := FractionRing.isScalarTower_liftAlgebra R (FractionRing S)
  let f : FractionRing S ‚Üí‚Çê[FractionRing R] M := liftAux (FractionRing R) (FractionRing S) M
  exact (f.restrictScalars R).comp ((Algebra.ofId S (FractionRing S)).restrictScalars R)
",Formal Proof of Stacks Project Tag 09GU,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IsAlgClosed/Basic.lean#L360-L367,Q27041,,9.10.5,lemma,3.0,"['09GP', '09FA', '0ELQ']","\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n      Proof.\n      Consider the set $I$ of pairs $(E, \\varphi )$ where $F \\subset E \\subset M$ is a subextension and $\\varphi : E \\to \\overline{F}$ is a morphism of $F$-extensions. We partially order the set $I$ by declaring $(E, \\varphi ) \\leq (E\', \\varphi \')$ if and only if $E \\subset E\'$ and $\\varphi \'|_ E = \\varphi $. If $T = \\{ (E_ t, \\varphi _ t)\\}  \\subset I$ is a totally ordered subset, then $\\bigcup \\varphi _ t : \\bigcup E_ t \\to \\overline{F}$ is an element of $I$. Thus every totally ordered subset of $I$ has an upper bound. By Zorn\'s lemma there exists a maximal element $(E, \\varphi )$ in $I$. We claim that $E = M$, which will finish the proof. If not, then pick $\\alpha \\in M$, $\\alpha \\not\\in E$. The $\\alpha $ is algebraic over $E$, see Lemma 9.8.4. Let $P$ be the minimal polynomial of $\\alpha $ over $E$. Let $P^\\varphi $ be the image of $P$ by $\\varphi $ in $\\overline{F}[x]$. Since $\\overline{F}$ is algebraically closed there is a root $\\beta $ of $P^\\varphi $ in $\\overline{F}$. Then we can extend $\\varphi $ to $\\varphi \' : E(\\alpha ) = E[x]/(P) \\to \\overline{F}$ by mapping $x$ to $\\beta $. This contradicts the maximality of $(E, \\varphi )$ as desired. \n      $\\square$\n    \n",\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n,"Proof.\n      Consider the set $I$ of pairs $(E, \\varphi )$ where $F \\subset E \\subset M$ is a subextension and $\\varphi : E \\to \\overline{F}$ is a morphism of $F$-extensions. We partially order the set $I$ by declaring $(E, \\varphi ) \\leq (E\', \\varphi \')$ if and only if $E \\subset E\'$ and $\\varphi \'|_ E = \\varphi $. If $T = \\{ (E_ t, \\varphi _ t)\\}  \\subset I$ is a totally ordered subset, then $\\bigcup \\varphi _ t : \\bigcup E_ t \\to \\overline{F}$ is an element of $I$. Thus every totally ordered subset of $I$ has an upper bound. By Zorn\'s lemma there exists a maximal element $(E, \\varphi )$ in $I$. We claim that $E = M$, which will finish the proof. If not, then pick $\\alpha \\in M$, $\\alpha \\not\\in E$. The $\\alpha $ is algebraic over $E$, see Lemma 9.8.4. Let $P$ be the minimal polynomial of $\\alpha $ over $E$. Let $P^\\varphi $ be the image of $P$ by $\\varphi $ in $\\overline{F}[x]$. Since $\\overline{F}$ is algebraically closed there is a root $\\beta $ of $P^\\varphi $ in $\\overline{F}$. Then we can extend $\\varphi $ to $\\varphi \' : E(\\alpha ) = E[x]/(P) \\to \\overline{F}$ by mapping $x$ to $\\beta $. This contradicts the maximality of $(E, \\varphi )$ as desired. \n      $\\square$\n    \n"," by
  letI : IsDomain R := (FaithfulSMul.algebraMap_injective R S).isDomain _
  letI := FractionRing.liftAlgebra R M
  letI := FractionRing.liftAlgebra R (FractionRing S)
  have := FractionRing.isScalarTower_liftAlgebra R M
  have := FractionRing.isScalarTower_liftAlgebra R (FractionRing S)
  let f : FractionRing S ‚Üí‚Çê[FractionRing R] M := liftAux (FractionRing R) (FractionRing S) M
  exact (f.restrictScalars R).comp ((Algebra.ofId S (FractionRing S)).restrictScalars R)
",noncomputable irreducible_def lift : S ‚Üí‚Çê[R] M ,"Proof.\n      Consider the set $I$ of pairs $(E, \\varphi )$ where $F \\subset E \\subset M$ is a subextension and $\\varphi : E \\to \\overline{F}$ is a morphism of $F$-extensions. We partially order the set $I$ by declaring $(E, \\varphi ) \\leq (E\', \\varphi \')$ if and only if $E \\subset E\'$ and $\\varphi \'|_ E = \\varphi $. If $T = \\{ (E_ t, \\varphi _ t)\\}  \\subset I$ is a totally ordered subset, then $\\bigcup \\varphi _ t : \\bigcup E_ t \\to \\overline{F}$ is an element of $I$. Thus every totally ordered subset of $I$ has an upper bound. By Zorn\'s lemma there exists a maximal element $(E, \\varphi )$ in $I$. We claim that $E = M$, which will finish the proof. If not, then pick $\\alpha \\in M$, $\\alpha \\not\\in E$. The $\\alpha $ is algebraic over $E$, see Lemma 9.8.4 [[\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n]]. Let $P$ be the minimal polynomial of $\\alpha $ over $E$. Let $P^\\varphi $ be the image of $P$ by $\\varphi $ in $\\overline{F}[x]$. Since $\\overline{F}$ is algebraically closed there is a root $\\beta $ of $P^\\varphi $ in $\\overline{F}$. Then we can extend $\\varphi $ to $\\varphi \' : E(\\alpha ) = E[x]/(P) \\to \\overline{F}$ by mapping $x$ to $\\beta $. This contradicts the maximality of $(E, \\varphi )$ as desired. \n      $\\square$\n    \n","Proof.\n      Consider the set $I$ of pairs $(E, \\varphi )$ where $F \\subset E \\subset M$ is a subextension and $\\varphi : E \\to \\overline{F}$ is a morphism of $F$-extensions. We partially order the set $I$ by declaring $(E, \\varphi ) \\leq (E\', \\varphi \')$ if and only if $E \\subset E\'$ and $\\varphi \'|_ E = \\varphi $. If $T = \\{ (E_ t, \\varphi _ t)\\}  \\subset I$ is a totally ordered subset, then $\\bigcup \\varphi _ t : \\bigcup E_ t \\to \\overline{F}$ is an element of $I$. Thus every totally ordered subset of $I$ has an upper bound. By Zorn\'s lemma there exists a maximal element $(E, \\varphi )$ in $I$. We claim that $E = M$, which will finish the proof. If not, then pick $\\alpha \\in M$, $\\alpha \\not\\in E$. The $\\alpha $ is algebraic over $E$, see Lemma 9.8.4 [[\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n]]. Let $P$ be the minimal polynomial of $\\alpha $ over $E$. Let $P^\\varphi $ be the image of $P$ by $\\varphi $ in $\\overline{F}[x]$. Since $\\overline{F}$ is algebraically closed there is a root $\\beta $ of $P^\\varphi $ in $\\overline{F}$. Then we can extend $\\varphi $ to $\\varphi \' : E(\\alpha ) = E[x]/(P) \\to \\overline{F}$ by mapping $x$ to $\\beta $. This contradicts the maximality of $(E, \\varphi )$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is a Zorn‚Äôs lemma argument about extending an embedding of intermediate field extensions into an algebraic closure, using algebraicity, minimal polynomials, and extension of homomorphisms to get a contradiction to maximality. The formal Lean proof instead constructs algebra/algebra-hom structures involving fraction rings, scalar towers, and a specific algebra hom `FractionRing S ‚Üí‚Çê[FractionRing R] M` via `liftAux`, then composes with `Algebra.ofId`. Structurally, there is no correspondence: the informal proof‚Äôs chain/union/maximal element/extension step is absent, and the formal proof contains only fraction ring lifting and scalar restriction/composition. Thus the formal proof does not capture the content or structure of the informal proof and appears to be proving a different statement.""}"
188,09GV,"noncomputable def equiv : L ‚âÉ‚Çê[R] M :=
  AlgEquiv.ofBijective _ (IsAlgClosure.isAlgebraic.algHom_bijective‚ÇÇ
    (IsAlgClosed.lift : L ‚Üí‚Çê[R] M)
    (IsAlgClosed.lift : M ‚Üí‚Çê[R] L)).1
",Formal Proof of Stacks Project Tag 09GV,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/IsAlgClosed/Basic.lean#L415-L418,Q27041,,9.10.6,lemma,3.0,"['09GP', '09FA', '0ELQ']","\n  Lemma 9.10.6. Any two algebraic closures of a field are isomorphic. \n\n    \n      Proof.\n      Let $F$ be a field. If $M$ and $\\overline{F}$ are algebraic closures of $F$, then there exists a morphism of $F$-extensions $\\varphi : M \\to \\overline{F}$ by Lemma 9.10.5. Now the image $\\varphi (M)$ is algebraically closed. On the other hand, the extension $\\varphi (M) \\subset \\overline{F}$ is algebraic by Lemma 9.8.4. Thus $\\varphi (M) = \\overline{F}$. \n      $\\square$\n    \n",\n  Lemma 9.10.6. Any two algebraic closures of a field are isomorphic. \n\n    \n,"Proof.\n      Let $F$ be a field. If $M$ and $\\overline{F}$ are algebraic closures of $F$, then there exists a morphism of $F$-extensions $\\varphi : M \\to \\overline{F}$ by Lemma 9.10.5. Now the image $\\varphi (M)$ is algebraically closed. On the other hand, the extension $\\varphi (M) \\subset \\overline{F}$ is algebraic by Lemma 9.8.4. Thus $\\varphi (M) = \\overline{F}$. \n      $\\square$\n    \n","
  AlgEquiv.ofBijective _ (IsAlgClosure.isAlgebraic.algHom_bijective‚ÇÇ
    (IsAlgClosed.lift : L ‚Üí‚Çê[R] M)
    (IsAlgClosed.lift : M ‚Üí‚Çê[R] L)).1
",noncomputable def equiv : L ‚âÉ‚Çê[R] M ,"Proof.\n      Let $F$ be a field. If $M$ and $\\overline{F}$ are algebraic closures of $F$, then there exists a morphism of $F$-extensions $\\varphi : M \\to \\overline{F}$ by Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]]. Now the image $\\varphi (M)$ is algebraically closed. On the other hand, the extension $\\varphi (M) \\subset \\overline{F}$ is algebraic by Lemma 9.8.4 [[\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n]]. Thus $\\varphi (M) = \\overline{F}$. \n      $\\square$\n    \n","Proof.\n      Let $F$ be a field. If $M$ and $\\overline{F}$ are algebraic closures of $F$, then there exists a morphism of $F$-extensions $\\varphi : M \\to \\overline{F}$ by Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]]. Now the image $\\varphi (M)$ is algebraically closed. On the other hand, the extension $\\varphi (M) \\subset \\overline{F}$ is algebraic by Lemma 9.8.4 [[\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n]]. Thus $\\varphi (M) = \\overline{F}$. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean term constructs an algebra equivalence via `AlgEquiv.ofBijective` from a bijectivity statement `IsAlgClosure.isAlgebraic.algHom_bijective‚ÇÇ` applied to the canonical lifts between two algebraically closed/algebraic-closure objects. This matches the informal goal of showing two algebraic closures are isomorphic over the base field, i.e. existence of an F-isomorphism.\nStructurally, however, the informal proof proceeds by first producing an F-embedding M ‚Üí \\overline{F}, then proving surjectivity by arguing the image is algebraically closed and the extension is algebraic, hence the image must be all of \\overline{F}. The Lean proof does not mirror this image/algebraic-closedness argument; instead it invokes a packaged lemma (`algHom_bijective‚ÇÇ`) that directly yields bijectivity of the lift maps, and then wraps it into an equivalence. So the high-level conclusion aligns, but the internal reasoning steps in the informal proof are not explicitly reflected in the formal proof.""}"
190,09HU,"theorem Normal.of_isSplittingField (p : F[X]) [hFEp : IsSplittingField F E p] : Normal F E := by
  rcases eq_or_ne p 0 with (rfl | hp)
  ¬∑ have := hFEp.adjoin_rootSet
    rw [rootSet_zero, Algebra.adjoin_empty] at this
    exact Normal.of_algEquiv
      (AlgEquiv.ofBijective (Algebra.ofId F E) (Algebra.bijective_algebraMap_iff.2 this.symm))
  refine normal_iff.mpr fun x ‚Ü¶ ?_
  haveI : FiniteDimensional F E := IsSplittingField.finiteDimensional E p
  have hx := IsIntegral.of_finite F x
  let L := (p * minpoly F x).SplittingField
  have hL := SplittingField.splits (p * minpoly F x)
  rw [Polynomial.map_mul, splits_mul_iff _ (map_ne_zero (minpoly.ne_zero hx))] at hL
  ¬∑ obtain ‚ü®hL1, hL2‚ü© := hL
    let j : E ‚Üí‚Çê[F] L := IsSplittingField.lift E p hL1
    rw [‚Üê j.comp_algebraMap, ‚Üê Polynomial.map_map] at hL2
    refine ‚ü®hx, Splits.of_splits_map (j : E ‚Üí+* L) hL2 fun a ha ‚Ü¶ ?_‚ü©
    rw [Polynomial.map_map, j.comp_algebraMap] at ha
    letI : Algebra F‚üÆx‚üØ L := ((algHomAdjoinIntegralEquiv F hx).symm ‚ü®a, ha‚ü©).toRingHom.toAlgebra
    let j' : E ‚Üí‚Çê[F‚üÆx‚üØ] L := IsSplittingField.lift E (p.map (algebraMap F F‚üÆx‚üØ)) ?_
    ¬∑ change a ‚àà j.range
      rw [‚Üê IsSplittingField.adjoin_rootSet_eq_range E p j,
            IsSplittingField.adjoin_rootSet_eq_range E p (j'.restrictScalars F)]
      exact ‚ü®x, (j'.commutes _).trans (algHomAdjoinIntegralEquiv_symm_apply_gen F hx _)‚ü©
    ¬∑ rwa [Polynomial.map_map, ‚Üê IsScalarTower.algebraMap_eq]
  ¬∑ exact Polynomial.map_ne_zero hp
",Formal Proof of Stacks Project Tag 09HU,Normal part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Basic.lean#L63-L87,Q27041,,9.16.1,lemma,3.0,"['09HT', '09FA', '0ELQ']","\n  Lemma 9.16.1. Let $F$ be a field. Let $P \\in F[x]$ be a nonconstant polynomial. There exists a smallest field extension $E/F$ such that $P$ splits completely over $E$. Moreover, the field extension $E/F$ is normal and unique up to (nonunique) isomorphism. \n\n    \n      Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n","\n  Lemma 9.16.1. Let $F$ be a field. Let $P \\in F[x]$ be a nonconstant polynomial. There exists a smallest field extension $E/F$ such that $P$ splits completely over $E$. Moreover, the field extension $E/F$ is normal and unique up to (nonunique) isomorphism. \n\n    \n","Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n"," by
  rcases eq_or_ne p 0 with (rfl | hp)
  ¬∑ have := hFEp.adjoin_rootSet
    rw [rootSet_zero, Algebra.adjoin_empty] at this
    exact Normal.of_algEquiv
      (AlgEquiv.ofBijective (Algebra.ofId F E) (Algebra.bijective_algebraMap_iff.2 this.symm))
  refine normal_iff.mpr fun x ‚Ü¶ ?_
  haveI : FiniteDimensional F E := IsSplittingField.finiteDimensional E p
  have hx := IsIntegral.of_finite F x
  let L := (p * minpoly F x).SplittingField
  have hL := SplittingField.splits (p * minpoly F x)
  rw [Polynomial.map_mul, splits_mul_iff _ (map_ne_zero (minpoly.ne_zero hx))] at hL
  ¬∑ obtain ‚ü®hL1, hL2‚ü© := hL
    let j : E ‚Üí‚Çê[F] L := IsSplittingField.lift E p hL1
    rw [‚Üê j.comp_algebraMap, ‚Üê Polynomial.map_map] at hL2
    refine ‚ü®hx, Splits.of_splits_map (j : E ‚Üí+* L) hL2 fun a ha ‚Ü¶ ?_‚ü©
    rw [Polynomial.map_map, j.comp_algebraMap] at ha
    letI : Algebra F‚üÆx‚üØ L := ((algHomAdjoinIntegralEquiv F hx).symm ‚ü®a, ha‚ü©).toRingHom.toAlgebra
    let j' : E ‚Üí‚Çê[F‚üÆx‚üØ] L := IsSplittingField.lift E (p.map (algebraMap F F‚üÆx‚üØ)) ?_
    ¬∑ change a ‚àà j.range
      rw [‚Üê IsSplittingField.adjoin_rootSet_eq_range E p j,
            IsSplittingField.adjoin_rootSet_eq_range E p (j'.restrictScalars F)]
      exact ‚ü®x, (j'.commutes _).trans (algHomAdjoinIntegralEquiv_symm_apply_gen F hx _)‚ü©
    ¬∑ rwa [Polynomial.map_map, ‚Üê IsScalarTower.algebraMap_eq]
  ¬∑ exact Polynomial.map_ne_zero hp
",theorem Normal.of_isSplittingField (p : F[X]) [hFEp : IsSplittingField F E p] : Normal F E ,"Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]]) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n","Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]]) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Normal part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is establishing a field extension is normal (it uses `normal_iff`, splitting fields, and `IsSplittingField.lift`), which matches the user comment that we are only comparing the ‚ÄúNormal part‚Äù. However, the informal proof‚Äôs normality argument is based on embedding a minimal splitting field into an algebraic closure and showing all F-embeddings have the same image (via permuting roots), then invoking a characterization of normality in terms of equal images of embeddings. The Lean proof instead proves normality via the standard criterion: for any integral element `x`, its minimal polynomial splits in the extension, by passing to a splitting field of `p * minpoly F x` and constructing suitable lifts; it does not use algebraic closures, permutations of roots, or the ‚Äúall embeddings have same image‚Äù characterization. Structurally, the informal proof is about uniqueness/minimality of splitting fields and comparing two minimal extensions, while the Lean code is a direct normality proof for a given splitting field (with a special case `p = 0`). Thus there is partial semantic overlap (both conclude normality), but the main method and structure differ substantially, and the Lean proof omits the informal proof‚Äôs uniqueness/isomorphism discussion.""}"
191,0BR3,"theorem splits_of_mem_adjoin {L} [Field L] [Algebra F L] {S : Set K}
    (splits : ‚àÄ x ‚àà S, IsIntegral F x ‚àß ((minpoly F x).map (algebraMap F L)).Splits) {x : K}
    (hx : x ‚àà adjoin F S) : ((minpoly F x).map (algebraMap F L)).Splits := by
  let E : IntermediateField F L := ‚®Ü x : S, adjoin F ((minpoly F x.val).rootSet L)
  have normal : Normal F E := normal_iSup (h := fun x ‚Ü¶
    Normal.of_isSplittingField (hFEp := adjoin_rootSet_isSplittingField (splits x x.2).2))
  have : ‚àÄ x ‚àà S, ((minpoly F x).map (algebraMap F E)).Splits := fun x hx ‚Ü¶ splits_of_splits
    (splits x hx).2 fun y hy ‚Ü¶ (le_iSup _ ‚ü®x, hx‚ü© : _ ‚â§ E) (subset_adjoin F _ <| by exact hy)
  obtain ‚ü®œÜ‚ü© := nonempty_algHom_adjoin_of_splits fun x hx ‚Ü¶ ‚ü®(splits x hx).1, this x hx‚ü©
  convert (normal.splits <| œÜ ‚ü®x, hx‚ü©).map E.val.toRingHom
  simp [minpoly.algHom_eq _ œÜ.injective, ‚Üê minpoly.algHom_eq _ (adjoin F S).val.injective,
    Polynomial.map_map]
",Formal Proof of Stacks Project Tag 0BR3,first part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Basic.lean#L121-L132,Q27041,,9.15.6,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.6. Let $E/F$ be an algebraic extension of fields. If $E$ is generated by $\\alpha _ i \\in E$, $i \\in I$ over $F$ and if for each $i$ the minimal polynomial of $\\alpha _ i$ over $F$ splits completely in $E$, then $E/F$ is normal. \n\n    \n      Proof.\n      Let $P_ i$ be the minimal polynomial of $\\alpha _ i$ over $F$. Let $\\alpha _ i = \\alpha _{i, 1}, \\alpha _{i, 2}, \\ldots , \\alpha _{i, d_ i}$ be the roots of $P_ i$ over $E$. Given two embeddings $\\sigma , \\sigma \' : E \\to \\overline{F}$ over $F$ we see that \n    \n      \n  \\[  \\{ \\sigma (\\alpha _{i, 1}), \\ldots , \\sigma (\\alpha _{i, d_ i})\\}  = \\{ \\sigma \'(\\alpha _{i, 1}), \\ldots , \\sigma \'(\\alpha _{i, d_ i})\\}   \\]\n\n    \n       because both sides are equal to the set of roots of $P_ i$ in $\\overline{F}$. The elements $\\alpha _{i, j}$ generate $E$ over $F$ and we find that $\\sigma (E) = \\sigma \'(E)$. Hence $E/F$ is normal by Lemma 9.15.5. \n      $\\square$\n    \n","\n  Lemma 9.15.6. Let $E/F$ be an algebraic extension of fields. If $E$ is generated by $\\alpha _ i \\in E$, $i \\in I$ over $F$ and if for each $i$ the minimal polynomial of $\\alpha _ i$ over $F$ splits completely in $E$, then $E/F$ is normal. \n\n    \n","Proof.\n      Let $P_ i$ be the minimal polynomial of $\\alpha _ i$ over $F$. Let $\\alpha _ i = \\alpha _{i, 1}, \\alpha _{i, 2}, \\ldots , \\alpha _{i, d_ i}$ be the roots of $P_ i$ over $E$. Given two embeddings $\\sigma , \\sigma \' : E \\to \\overline{F}$ over $F$ we see that \n    \n      \n  \\[  \\{ \\sigma (\\alpha _{i, 1}), \\ldots , \\sigma (\\alpha _{i, d_ i})\\}  = \\{ \\sigma \'(\\alpha _{i, 1}), \\ldots , \\sigma \'(\\alpha _{i, d_ i})\\}   \\]\n\n    \n       because both sides are equal to the set of roots of $P_ i$ in $\\overline{F}$. The elements $\\alpha _{i, j}$ generate $E$ over $F$ and we find that $\\sigma (E) = \\sigma \'(E)$. Hence $E/F$ is normal by Lemma 9.15.5. \n      $\\square$\n    \n"," by
  let E : IntermediateField F L := ‚®Ü x : S, adjoin F ((minpoly F x.val).rootSet L)
  have normal : Normal F E := normal_iSup (h := fun x ‚Ü¶
    Normal.of_isSplittingField (hFEp := adjoin_rootSet_isSplittingField (splits x x.2).2))
  have : ‚àÄ x ‚àà S, ((minpoly F x).map (algebraMap F E)).Splits := fun x hx ‚Ü¶ splits_of_splits
    (splits x hx).2 fun y hy ‚Ü¶ (le_iSup _ ‚ü®x, hx‚ü© : _ ‚â§ E) (subset_adjoin F _ <| by exact hy)
  obtain ‚ü®œÜ‚ü© := nonempty_algHom_adjoin_of_splits fun x hx ‚Ü¶ ‚ü®(splits x hx).1, this x hx‚ü©
  convert (normal.splits <| œÜ ‚ü®x, hx‚ü©).map E.val.toRingHom
  simp [minpoly.algHom_eq _ œÜ.injective, ‚Üê minpoly.algHom_eq _ (adjoin F S).val.injective,
    Polynomial.map_map]
","theorem splits_of_mem_adjoin {L} [Field L] [Algebra F L] {S : Set K}
    (splits : ‚àÄ x ‚àà S, IsIntegral F x ‚àß ((minpoly F x).map (algebraMap F L)).Splits) {x : K}
    (hx : x ‚àà adjoin F S) : ((minpoly F x).map (algebraMap F L)).Splits ","Proof.\n      Let $P_ i$ be the minimal polynomial of $\\alpha _ i$ over $F$. Let $\\alpha _ i = \\alpha _{i, 1}, \\alpha _{i, 2}, \\ldots , \\alpha _{i, d_ i}$ be the roots of $P_ i$ over $E$. Given two embeddings $\\sigma , \\sigma \' : E \\to \\overline{F}$ over $F$ we see that \n    \n      \n  \\[  \\{ \\sigma (\\alpha _{i, 1}), \\ldots , \\sigma (\\alpha _{i, d_ i})\\}  = \\{ \\sigma \'(\\alpha _{i, 1}), \\ldots , \\sigma \'(\\alpha _{i, d_ i})\\}   \\]\n\n    \n       because both sides are equal to the set of roots of $P_ i$ in $\\overline{F}$. The elements $\\alpha _{i, j}$ generate $E$ over $F$ and we find that $\\sigma (E) = \\sigma \'(E)$. Hence $E/F$ is normal by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Let $P_ i$ be the minimal polynomial of $\\alpha _ i$ over $F$. Let $\\alpha _ i = \\alpha _{i, 1}, \\alpha _{i, 2}, \\ldots , \\alpha _{i, d_ i}$ be the roots of $P_ i$ over $E$. Given two embeddings $\\sigma , \\sigma \' : E \\to \\overline{F}$ over $F$ we see that \n    \n      \n  \\[  \\{ \\sigma (\\alpha _{i, 1}), \\ldots , \\sigma (\\alpha _{i, d_ i})\\}  = \\{ \\sigma \'(\\alpha _{i, 1}), \\ldots , \\sigma \'(\\alpha _{i, d_ i})\\}   \\]\n\n    \n       because both sides are equal to the set of roots of $P_ i$ in $\\overline{F}$. The elements $\\alpha _{i, j}$ generate $E$ over $F$ and we find that $\\sigma (E) = \\sigma \'(E)$. Hence $E/F$ is normal by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: first part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues normality of an algebraic extension E/F by comparing images of E under two F-embeddings into an algebraic closure, using the fact that embeddings permute the roots of each minimal polynomial of generators and then invoking an equivalence criterion for normality (Lemma 9.15.5). The Lean proof instead constructs an intermediate field E as a supremum of fields obtained by adjoining full root sets of minimal polynomials, proves E/F is normal via `normal_iSup` and `Normal.of_isSplittingField`, and then derives splitting of mapped minimal polynomials using existence of an algebra hom from an adjoin-of-splits lemma. Structurally, the Lean proof is a splitting-field/adjunction-based normality argument, not an embeddings-into-closure argument; it does not mirror the key step of comparing two embeddings‚Äô images or invoking the stated equivalence lemma. While both are about normality and use minimal polynomials/roots, the mechanisms and constructed objects differ substantially, so the correspondence is weak.""}"
192,09HP,"instance normal_inf
    (E E' : IntermediateField F K) [Normal F E] [Normal F E'] :
    Normal F (E ‚äì E' : IntermediateField F K) :=
  iInf_bool_eq (f := Bool.rec E' E) ‚ñ∏ normal_iInf (h := by rintro (_ | _) <;> infer_instance)
",Formal Proof of Stacks Project Tag 09HP,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Basic.lean#L156-L159,Q27041,,9.15.3,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.3. Let $F$ be a field. Let $M/F$ be an algebraic extension. Let $M/E_ i/F$, $i \\in I$ be subextensions with $E_ i/F$ normal. Then $\\bigcap E_ i$ is normal over $F$. \n\n    \n      Proof.\n      Direct from the definitions. \n      $\\square$\n    \n","\n  Lemma 9.15.3. Let $F$ be a field. Let $M/F$ be an algebraic extension. Let $M/E_ i/F$, $i \\in I$ be subextensions with $E_ i/F$ normal. Then $\\bigcap E_ i$ is normal over $F$. \n\n    \n",Proof.\n      Direct from the definitions. \n      $\\square$\n    \n,"
  iInf_bool_eq (f := Bool.rec E' E) ‚ñ∏ normal_iInf (h := by rintro (_ | _) <;> infer_instance)
","instance normal_inf
    (E E' : IntermediateField F K) [Normal F E] [Normal F E'] :
    Normal F (E ‚äì E' : IntermediateField F K) ",Proof.\n      Direct from the definitions. \n      $\\square$\n    \n,Proof.\n      Direct from the definitions. \n      $\\square$\n    \n,"{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the informal proof claims the result follows directly from unfolding definitions. The Lean proof achieves this by rewriting the boolean indexed infimum via `iInf_bool_eq` (a definitional-style lemma for `iInf` over `Bool`) and then applying `normal_iInf` with a case split on `Bool` to discharge the required instances. Structurally, both are very short and rely on definitional/standard simplification rather than substantive argument. The only mild mismatch is that the formal proof is not purely `rfl`/unfolding: it uses specific helper lemmas (`iInf_bool_eq`, `normal_iInf`) and an explicit `rintro (_ | _)` split, which is slightly more than ‚Äújust definitions,‚Äù but still in the same spirit.""}"
193,0BME,"noncomputable def AlgHom.liftNormal [h : Normal F E] : E ‚Üí‚Çê[F] E :=
  @AlgHom.restrictScalars F K‚ÇÅ E E _ _ _ _ _ _
      ((IsScalarTower.toAlgHom F K‚ÇÇ E).comp œï).toRingHom.toAlgebra _ _ _ _ <|
    Nonempty.some <|
      @IntermediateField.nonempty_algHom_of_adjoin_splits _ _ _ _ _ _ _
        ((IsScalarTower.toAlgHom F K‚ÇÇ E).comp œï).toRingHom.toAlgebra _
        (fun x _ ‚Ü¶ ‚ü®(h.out x).1.tower_top,
          @IsIntegral.minpoly_splits_tower_top F K‚ÇÅ E E _ _ _ _ _ _ _ _ x
            (RingHom.toAlgebra _) _ _ (h.out x).1 (h.out x).2‚ü©)
        (IntermediateField.adjoin_univ _ _)
",Formal Proof of Stacks Project Tag 0BME,Part 2,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Basic.lean#L190-L199,Q27041,,9.15.7,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.7. Let $L/M/K$ be a tower of algebraic extensions. \n  \n  \nIf $M/K$ is normal, then any automorphism $\\tau $ of $L/K$ induces an automorphism $\\tau |_ M : M \\to M$. \n\n\nIf $L/K$ is normal, then any $K$-algebra map $\\sigma : M \\to L$ extends to an automorphism of $L$. \n\n\n\n\n    \n      Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n","\n  Lemma 9.15.7. Let $L/M/K$ be a tower of algebraic extensions. \n  \n  \nIf $M/K$ is normal, then any automorphism $\\tau $ of $L/K$ induces an automorphism $\\tau |_ M : M \\to M$. \n\n\nIf $L/K$ is normal, then any $K$-algebra map $\\sigma : M \\to L$ extends to an automorphism of $L$. \n\n\n\n\n    \n","Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n","
  @AlgHom.restrictScalars F K‚ÇÅ E E _ _ _ _ _ _
      ((IsScalarTower.toAlgHom F K‚ÇÇ E).comp œï).toRingHom.toAlgebra _ _ _ _ <|
    Nonempty.some <|
      @IntermediateField.nonempty_algHom_of_adjoin_splits _ _ _ _ _ _ _
        ((IsScalarTower.toAlgHom F K‚ÇÇ E).comp œï).toRingHom.toAlgebra _
        (fun x _ ‚Ü¶ ‚ü®(h.out x).1.tower_top,
          @IsIntegral.minpoly_splits_tower_top F K‚ÇÅ E E _ _ _ _ _ _ _ _ x
            (RingHom.toAlgebra _) _ _ (h.out x).1 (h.out x).2‚ü©)
        (IntermediateField.adjoin_univ _ _)
",noncomputable def AlgHom.liftNormal [h : Normal F E] : E ‚Üí‚Çê[F] E ,"Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4 [[\n  Theorem 9.10.4. Every field has an algebraic closure. \n\n    \n]]). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]] we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n","Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4 [[\n  Theorem 9.10.4. Every field has an algebraic closure. \n\n    \n]]). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]] we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 2","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean term is constructing an algebra homomorphism by restricting scalars and then using a lemma of the form `IntermediateField.nonempty_algHom_of_adjoin_splits`, together with a `minpoly_splits_tower_top` argument, to obtain existence of an `AlgHom` out of an intermediate field generated by adjoining elements whose minimal polynomials split in the top field. This matches the *core existence/extension* theme in the informal proof (extend a given embedding/morphism using splitting of minimal polynomials in an algebraic closure / normality). Structurally, however, the informal proof for Part (2) proceeds by: choose an algebraic closure, extend a morphism into it, then use normality to show the image is the base field and hence get an automorphism extending the original map. The Lean proof does not mention algebraic closures, normality, or the image-stability argument; instead it uses an adjoin/splitting lemma directly to produce a homomorphism, and the restriction-of-scalars scaffolding suggests a different setup (tower of fields and intermediate field adjoin). So while there is partial semantic overlap (existence of an extension via splitting), the overall structure and key normality/image arguments from the informal proof are not reflected, and the Lean proof appears to formalize a more algebraic-closure-free existence lemma rather than the full automorphism/normality reasoning.""}"
196,0BMG,"instance normal [h : Normal F L] : Normal F (normalClosure F K L) := by
  obtain _ | œÜ := isEmpty_or_nonempty (K ‚Üí‚Çê[F] L)
  ¬∑ rw [normalClosure, iSup_of_empty]; exact Normal.of_algEquiv (botEquiv F L).symm
  ¬∑ exact (isNormalClosure_normalClosure F K L).normal
",Formal Proof of Stacks Project Tag 0BMG,(1) normality.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Closure.lean#L168-L171,Q27041,,9.16.5,lemma,3.0,"['09HT', '09FA', '0ELQ']","\n  Lemma 9.16.5. Let $L/K$ be an algebraic normal extension. \n  \n  \nIf $L/M/K$ is a subextension with $M/K$ finite, then there exists a tower $L/M\'/M/K$ with $M\'/K$ finite and normal. \n\n\nIf $L/M\'/M/K$ is a tower with $M/K$ normal and $M\'/M$ finite, then there exists a tower $L/M\'\'/M\'/M/K$ with $M\'\'/M$ finite and $M\'\'/K$ normal. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n","\n  Lemma 9.16.5. Let $L/K$ be an algebraic normal extension. \n  \n  \nIf $L/M/K$ is a subextension with $M/K$ finite, then there exists a tower $L/M\'/M/K$ with $M\'/K$ finite and normal. \n\n\nIf $L/M\'/M/K$ is a tower with $M/K$ normal and $M\'/M$ finite, then there exists a tower $L/M\'\'/M\'/M/K$ with $M\'\'/M$ finite and $M\'\'/K$ normal. \n\n\n\n\n    \n","Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n"," by
  obtain _ | œÜ := isEmpty_or_nonempty (K ‚Üí‚Çê[F] L)
  ¬∑ rw [normalClosure, iSup_of_empty]; exact Normal.of_algEquiv (botEquiv F L).symm
  ¬∑ exact (isNormalClosure_normalClosure F K L).normal
",instance normal [h : Normal F L] : Normal F (normalClosure F K L) ,"Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 [[\n       \n      \n  Lemma 9.16.3. Let $E/F$ be a finite extension of fields. There exists a unique smallest finite extension $K/E$ such that $K$ is normal over $F$. \n\n    \n]] this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 [[\n  Lemma 9.15.6. Let $E/F$ be an algebraic extension of fields. If $E$ is generated by $\\alpha _ i \\in E$, $i \\in I$ over $F$ and if for each $i$ the minimal polynomial of $\\alpha _ i$ over $F$ splits completely in $E$, then $E/F$ is normal. \n\n    \n]] (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n","Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 [[\n       \n      \n  Lemma 9.16.3. Let $E/F$ be a finite extension of fields. There exists a unique smallest finite extension $K/E$ such that $K$ is normal over $F$. \n\n    \n]] this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 [[\n  Lemma 9.15.6. Let $E/F$ be an algebraic extension of fields. If $E$ is generated by $\\alpha _ i \\in E$, $i \\in I$ over $F$ and if for each $i$ the minimal polynomial of $\\alpha _ i$ over $F$ splits completely in $E$, then $E/F$ is normal. \n\n    \n]] (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) normality.","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof establishes normality of the normal closure (it concludes `(isNormalClosure_normalClosure F K L).normal`, and handles the degenerate case when there are no `K ‚Üí‚Çê[F] L`-embeddings by rewriting the `iSup` over an empty set and producing a trivial `Normal` instance via `botEquiv`). This matches the user‚Äôs note that the relevant informal target is ‚Äú(1) normality.‚Äù\n\nStructurally, however, the informal proof argues via constructing the smallest normal subextension and then using generators/minimal polynomials and a splitting criterion (Lemma 9.15.6) to prove normality. None of that construction (generators, minimal polynomials, splitting) appears in the Lean proof; instead Lean uses the library lemma `isNormalClosure_normalClosure` and a case split on emptiness of algebra homs. So the overall meaning (normality of the normal closure) aligns, but the proof strategy and intermediate content do not correspond closely, and the Lean proof omits the informal argument‚Äôs key steps.""}"
197,0BMG,"instance is_finiteDimensional [FiniteDimensional F K] :
    FiniteDimensional F (normalClosure F K L) := by
  haveI : ‚àÄ f : K ‚Üí‚Çê[F] L, FiniteDimensional F f.fieldRange := fun f ‚Ü¶
    f.toLinearMap.finiteDimensional_range
  apply IntermediateField.finiteDimensional_iSup_of_finite
",Formal Proof of Stacks Project Tag 0BMG,"When `L` is normal over `K`, this agrees with 0BMG (1) finiteness.",https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Closure.lean#L174-L178,Q27041,,9.16.5,lemma,3.0,"['09HT', '09FA', '0ELQ']","\n  Lemma 9.16.5. Let $L/K$ be an algebraic normal extension. \n  \n  \nIf $L/M/K$ is a subextension with $M/K$ finite, then there exists a tower $L/M\'/M/K$ with $M\'/K$ finite and normal. \n\n\nIf $L/M\'/M/K$ is a tower with $M/K$ normal and $M\'/M$ finite, then there exists a tower $L/M\'\'/M\'/M/K$ with $M\'\'/M$ finite and $M\'\'/K$ normal. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n","\n  Lemma 9.16.5. Let $L/K$ be an algebraic normal extension. \n  \n  \nIf $L/M/K$ is a subextension with $M/K$ finite, then there exists a tower $L/M\'/M/K$ with $M\'/K$ finite and normal. \n\n\nIf $L/M\'/M/K$ is a tower with $M/K$ normal and $M\'/M$ finite, then there exists a tower $L/M\'\'/M\'/M/K$ with $M\'\'/M$ finite and $M\'\'/K$ normal. \n\n\n\n\n    \n","Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n"," by
  haveI : ‚àÄ f : K ‚Üí‚Çê[F] L, FiniteDimensional F f.fieldRange := fun f ‚Ü¶
    f.toLinearMap.finiteDimensional_range
  apply IntermediateField.finiteDimensional_iSup_of_finite
","instance is_finiteDimensional [FiniteDimensional F K] :
    FiniteDimensional F (normalClosure F K L) ","Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 [[\n       \n      \n  Lemma 9.16.3. Let $E/F$ be a finite extension of fields. There exists a unique smallest finite extension $K/E$ such that $K$ is normal over $F$. \n\n    \n]] this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 [[\n  Lemma 9.15.6. Let $E/F$ be an algebraic extension of fields. If $E$ is generated by $\\alpha _ i \\in E$, $i \\in I$ over $F$ and if for each $i$ the minimal polynomial of $\\alpha _ i$ over $F$ splits completely in $E$, then $E/F$ is normal. \n\n    \n]] (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n","Proof.\n      Proof of (1). Let $M\'$ be the smallest subextension of $L/K$ containing $M$ which is normal over $K$. By Lemma 9.16.3 [[\n       \n      \n  Lemma 9.16.3. Let $E/F$ be a finite extension of fields. There exists a unique smallest finite extension $K/E$ such that $K$ is normal over $F$. \n\n    \n]] this is the normal closure of $M/K$ and is finite over $K$. \n    \n      Proof of (2). Let $\\alpha _1, \\ldots , \\alpha _ n \\in M\'$ generate $M\'$ over $M$. Let $P_1, \\ldots , P_ n$ be the minimal polynomials of $\\alpha _1, \\ldots , \\alpha _ n$ over $K$. Let $\\alpha _{i, j}$ be the roots of $P_ i$ in $L$. Let $M\'\' = M(\\alpha _{i, j})$. It follows from Lemma 9.15.6 [[\n  Lemma 9.15.6. Let $E/F$ be an algebraic extension of fields. If $E$ is generated by $\\alpha _ i \\in E$, $i \\in I$ over $F$ and if for each $i$ the minimal polynomial of $\\alpha _ i$ over $F$ splits completely in $E$, then $E/F$ is normal. \n\n    \n]] (applied with the set of generators $M \\cup \\{ \\alpha _{i, j}\\} $) that $M\'\'$ is normal over $K$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: When `L` is normal over `K`, this agrees with 0BMG (1) finiteness.","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof establishes a finiteness result about an iSup of intermediate fields (via `IntermediateField.finiteDimensional_iSup_of_finite`) assuming each component fieldRange is finite-dimensional. This matches only the very high-level theme ‚Äúnormal/closure gives finiteness‚Äù mentioned in the informal proof comment, but it does not construct a normal closure or argue about normality at all. Structurally, the informal proof has two parts: (1) existence/uniqueness of a smallest normal closure and its finiteness, and (2) an explicit construction using generators, minimal polynomials, and splitting to prove normality. None of these steps (normal closure, generators, minimal polynomials, splitting) appear in the Lean code; instead it uses a general finite-dimensionality lemma about ranges of algebra homomorphisms and an iSup lemma. Thus the formal proof is at best loosely related to the finiteness aspect (especially under the comment about normality implying finiteness), but it does not reflect the informal argument‚Äôs content or structure.""}"
198,09HQ,"lemma normal_iff_forall_fieldRange_eq : Normal F K ‚Üî ‚àÄ œÉ : K ‚Üí‚Çê[F] L, œÉ.fieldRange = K :=
‚ü®@AlgHom.fieldRange_of_normal (E := K), normal_iff_forall_fieldRange_le.2 ‚àò fun h œÉ ‚Ü¶ (h œÉ).le‚ü©
",Formal Proof of Stacks Project Tag 09HQ,stronger version replacing an algebraic closure by a normal extension,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Closure.lean#L287-L288,Q27041,,9.15.5,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n      Proof.\n      Let $\\mathcal{P}$ be the set of all minimal polynomials over $F$ of all elements of $E$. Set \n    \n      \n  \\[  T = \\{ \\beta \\in \\overline{F} \\mid P(\\beta ) = 0\\text{ for some }P \\in \\mathcal{P}\\}   \\]\n\n    \n       It is clear that if $E$ is normal over $F$, then $\\sigma (E) = T$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we see that (1) implies (2). \n    \n      Conversely, assume (2). Pick $\\beta \\in T$. We can find a corresponding $\\alpha \\in E$ whose minimal polynomial $P \\in \\mathcal{P}$ annihilates $\\beta $. Because $F(\\alpha ) = F[x]/(P)$ we can find an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})$ mapping $\\alpha $ to $\\beta $. By Lemma 9.10.5 we can extend $\\sigma _0$ to a $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Whence we see that $\\beta $ is in the common image of all embeddings $\\sigma : E \\to \\overline{F}$. It follows that $\\sigma (E) = T$ for any $\\sigma $. Fix a $\\sigma $. Now let $P \\in \\mathcal{P}$. Then we can write \n    \n      \n  \\[  P = (x - \\beta _1) \\ldots (x - \\beta _ n)  \\]\n\n    \n       for some $n$ and $\\beta _ i \\in \\overline{F}$ by Lemma 9.10.2. Observe that $\\beta _ i \\in T$. Thus $\\beta _ i = \\sigma (\\alpha _ i)$ for some $\\alpha _ i \\in E$. Thus $P = (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ splits completely over $E$. This finishes the proof. \n      $\\square$\n    \n","\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n","Proof.\n      Let $\\mathcal{P}$ be the set of all minimal polynomials over $F$ of all elements of $E$. Set \n    \n      \n  \\[  T = \\{ \\beta \\in \\overline{F} \\mid P(\\beta ) = 0\\text{ for some }P \\in \\mathcal{P}\\}   \\]\n\n    \n       It is clear that if $E$ is normal over $F$, then $\\sigma (E) = T$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we see that (1) implies (2). \n    \n      Conversely, assume (2). Pick $\\beta \\in T$. We can find a corresponding $\\alpha \\in E$ whose minimal polynomial $P \\in \\mathcal{P}$ annihilates $\\beta $. Because $F(\\alpha ) = F[x]/(P)$ we can find an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})$ mapping $\\alpha $ to $\\beta $. By Lemma 9.10.5 we can extend $\\sigma _0$ to a $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Whence we see that $\\beta $ is in the common image of all embeddings $\\sigma : E \\to \\overline{F}$. It follows that $\\sigma (E) = T$ for any $\\sigma $. Fix a $\\sigma $. Now let $P \\in \\mathcal{P}$. Then we can write \n    \n      \n  \\[  P = (x - \\beta _1) \\ldots (x - \\beta _ n)  \\]\n\n    \n       for some $n$ and $\\beta _ i \\in \\overline{F}$ by Lemma 9.10.2. Observe that $\\beta _ i \\in T$. Thus $\\beta _ i = \\sigma (\\alpha _ i)$ for some $\\alpha _ i \\in E$. Thus $P = (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ splits completely over $E$. This finishes the proof. \n      $\\square$\n    \n","
‚ü®@AlgHom.fieldRange_of_normal (E := K), normal_iff_forall_fieldRange_le.2 ‚àò fun h œÉ ‚Ü¶ (h œÉ).le‚ü©
","lemma normal_iff_forall_fieldRange_eq : Normal F K ‚Üî ‚àÄ œÉ : K ‚Üí‚Çê[F] L, œÉ.fieldRange = K ","Proof.\n      Let $\\mathcal{P}$ be the set of all minimal polynomials over $F$ of all elements of $E$. Set \n    \n      \n  \\[  T = \\{ \\beta \\in \\overline{F} \\mid P(\\beta ) = 0\\text{ for some }P \\in \\mathcal{P}\\}   \\]\n\n    \n       It is clear that if $E$ is normal over $F$, then $\\sigma (E) = T$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we see that (1) implies (2). \n    \n      Conversely, assume (2). Pick $\\beta \\in T$. We can find a corresponding $\\alpha \\in E$ whose minimal polynomial $P \\in \\mathcal{P}$ annihilates $\\beta $. Because $F(\\alpha ) = F[x]/(P)$ we can find an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})$ mapping $\\alpha $ to $\\beta $. By Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]] we can extend $\\sigma _0$ to a $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Whence we see that $\\beta $ is in the common image of all embeddings $\\sigma : E \\to \\overline{F}$. It follows that $\\sigma (E) = T$ for any $\\sigma $. Fix a $\\sigma $. Now let $P \\in \\mathcal{P}$. Then we can write \n    \n      \n  \\[  P = (x - \\beta _1) \\ldots (x - \\beta _ n)  \\]\n\n    \n       for some $n$ and $\\beta _ i \\in \\overline{F}$ by Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. Observe that $\\beta _ i \\in T$. Thus $\\beta _ i = \\sigma (\\alpha _ i)$ for some $\\alpha _ i \\in E$. Thus $P = (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ splits completely over $E$. This finishes the proof. \n      $\\square$\n    \n","Proof.\n      Let $\\mathcal{P}$ be the set of all minimal polynomials over $F$ of all elements of $E$. Set \n    \n      \n  \\[  T = \\{ \\beta \\in \\overline{F} \\mid P(\\beta ) = 0\\text{ for some }P \\in \\mathcal{P}\\}   \\]\n\n    \n       It is clear that if $E$ is normal over $F$, then $\\sigma (E) = T$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we see that (1) implies (2). \n    \n      Conversely, assume (2). Pick $\\beta \\in T$. We can find a corresponding $\\alpha \\in E$ whose minimal polynomial $P \\in \\mathcal{P}$ annihilates $\\beta $. Because $F(\\alpha ) = F[x]/(P)$ we can find an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(F(\\alpha ), \\overline{F})$ mapping $\\alpha $ to $\\beta $. By Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]] we can extend $\\sigma _0$ to a $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Whence we see that $\\beta $ is in the common image of all embeddings $\\sigma : E \\to \\overline{F}$. It follows that $\\sigma (E) = T$ for any $\\sigma $. Fix a $\\sigma $. Now let $P \\in \\mathcal{P}$. Then we can write \n    \n      \n  \\[  P = (x - \\beta _1) \\ldots (x - \\beta _ n)  \\]\n\n    \n       for some $n$ and $\\beta _ i \\in \\overline{F}$ by Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. Observe that $\\beta _ i \\in T$. Thus $\\beta _ i = \\sigma (\\alpha _ i)$ for some $\\alpha _ i \\in E$. Thus $P = (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ splits completely over $E$. This finishes the proof. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: stronger version replacing an algebraic closure by a normal extension","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term proves a normality characterization via `normal_iff_forall_fieldRange_le` together with `AlgHom.fieldRange_of_normal`, i.e. it shows that for every F-algebra homomorphism œÉ the fieldRange is contained in (or equal to) a fixed normal fieldRange, which is a standard Lean reformulation of ‚Äúall embeddings have the same image‚Äù but stated using `fieldRange` and an order relation `‚â§`. The informal proof, however, is the classical equivalence between normality and the condition that all F-embeddings into an algebraic closure have the same image T (the set of all conjugates), and it explicitly uses algebraic closure, extension of embeddings, and splitting of minimal polynomials. Structurally, the Lean proof is a one-line composition of existing lemmas and does not mirror the constructive steps (defining T, picking Œ≤, extending œÉ0, factoring P, etc.). With the given comment (Lean uses a stronger version replacing the algebraic closure by a normal extension), there is some conceptual overlap (normality ‚Üî invariance of images/fieldRanges under embeddings), but the formal proof does not correspond closely to the specific argument and intermediate objects in the informal proof, so alignment is low-to-moderate rather than strong.""}"
200,09HN,"theorem Normal.tower_top_of_normal [h : Normal F E] : Normal K E :=
  normal_iff.2 fun x => by
    obtain ‚ü®hx, hhx‚ü© := h.out x
    rw [algebraMap_eq F K E, ‚Üê map_map] at hhx
    exact ‚ü®hx.tower_top, hhx.of_dvd (map_ne_zero (map_ne_zero (minpoly.ne_zero hx)))
      ((map_dvd_map' _).mpr (minpoly.dvd_map_of_isScalarTower F K x))‚ü©
",Formal Proof of Stacks Project Tag 09HN,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Defs.lean#L67-L72,Q27041,,9.15.2,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.2. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is normal over $F$, then $K$ is normal over $E$. \n\n    \n      Proof.\n      Let $\\alpha \\in K$. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Hence, if $P$ splits completely over $K$, then so does $Q$. \n      $\\square$\n    \n","\n  Lemma 9.15.2. Let $K/E/F$ be a tower of algebraic field extensions. If $K$ is normal over $F$, then $K$ is normal over $E$. \n\n    \n","Proof.\n      Let $\\alpha \\in K$. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Hence, if $P$ splits completely over $K$, then so does $Q$. \n      $\\square$\n    \n","
  normal_iff.2 fun x => by
    obtain ‚ü®hx, hhx‚ü© := h.out x
    rw [algebraMap_eq F K E, ‚Üê map_map] at hhx
    exact ‚ü®hx.tower_top, hhx.of_dvd (map_ne_zero (map_ne_zero (minpoly.ne_zero hx)))
      ((map_dvd_map' _).mpr (minpoly.dvd_map_of_isScalarTower F K x))‚ü©
",theorem Normal.tower_top_of_normal [h : Normal F E] : Normal K E ,"Proof.\n      Let $\\alpha \\in K$. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Hence, if $P$ splits completely over $K$, then so does $Q$. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha \\in K$. Let $P$ be the minimal polynomial of $\\alpha $ over $F$. Let $Q$ be the minimal polynomial of $\\alpha $ over $E$. Then $Q$ divides $P$ in the polynomial ring $E[x]$, say $P = QR$. Hence, if $P$ splits completely over $K$, then so does $Q$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish the same key idea: for an element x (Œ±) in K, the minimal polynomial over the larger base field E divides the minimal polynomial over the smaller base field F after mapping to E[X]; therefore, if the F-minpoly splits (or has the required property) over K, then the E-minpoly also does. The Lean proof explicitly uses `minpoly.dvd_map_of_isScalarTower F K x` (capturing ‚ÄúQ divides P in E[x]‚Äù) and then applies `hhx.of_dvd ...` to transfer the splitting/normality property along this divisibility, matching the informal argument ‚ÄúP = Q R, so splitting of P implies splitting of Q.‚Äù Structurally, the informal proof is a short divisibility-then-splitting argument, and the formal proof follows the same structure but with additional bookkeeping: rewriting algebra maps (`rw [algebraMap_eq ..., ‚Üê map_map]`), nonzero conditions, and tower coercions (`hx.tower_top`) needed in Lean. The only mismatch is that the informal proof is phrased purely in terms of splitting of minimal polynomials, while the formal proof is embedded in a `normal_iff` characterization and uses auxiliary lemmas about mapping and nonzero polynomials; these are implementation details rather than a different mathematical strategy.""}"
201,0BME,"def AlgHom.restrictNormal [Normal F E] : E ‚Üí‚Çê[F] E :=
  ((AlgEquiv.ofInjectiveField (IsScalarTower.toAlgHom F E K‚ÇÇ)).symm.toAlgHom.comp
        (œï.restrictNormalAux E)).comp
    (AlgEquiv.ofInjectiveField (IsScalarTower.toAlgHom F E K‚ÇÅ)).toAlgHom
",Formal Proof of Stacks Project Tag 0BME,Part 1,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/Normal/Defs.lean#L147-L150,Q27041,,9.15.7,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.7. Let $L/M/K$ be a tower of algebraic extensions. \n  \n  \nIf $M/K$ is normal, then any automorphism $\\tau $ of $L/K$ induces an automorphism $\\tau |_ M : M \\to M$. \n\n\nIf $L/K$ is normal, then any $K$-algebra map $\\sigma : M \\to L$ extends to an automorphism of $L$. \n\n\n\n\n    \n      Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n","\n  Lemma 9.15.7. Let $L/M/K$ be a tower of algebraic extensions. \n  \n  \nIf $M/K$ is normal, then any automorphism $\\tau $ of $L/K$ induces an automorphism $\\tau |_ M : M \\to M$. \n\n\nIf $L/K$ is normal, then any $K$-algebra map $\\sigma : M \\to L$ extends to an automorphism of $L$. \n\n\n\n\n    \n","Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n","
  ((AlgEquiv.ofInjectiveField (IsScalarTower.toAlgHom F E K‚ÇÇ)).symm.toAlgHom.comp
        (œï.restrictNormalAux E)).comp
    (AlgEquiv.ofInjectiveField (IsScalarTower.toAlgHom F E K‚ÇÅ)).toAlgHom
",def AlgHom.restrictNormal [Normal F E] : E ‚Üí‚Çê[F] E ,"Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4 [[\n  Theorem 9.10.4. Every field has an algebraic closure. \n\n    \n]]). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]] we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n","Proof.\n      Choose an algebraic closure $\\overline{L}$ of $L$ (Theorem 9.10.4 [[\n  Theorem 9.10.4. Every field has an algebraic closure. \n\n    \n]]). \n    \n      Let $\\tau $ be as in (1). Then $\\tau (M) = M$ as subfields of $\\overline{L}$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and hence $\\tau |_ M : M \\to M$ is an automorphism. \n    \n      Let $\\sigma : M \\to L$ be as in (2). By Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]] we can extend $\\sigma $ to a map $\\tau : L \\to \\overline{L}$, i.e., such that \n    \n      \n  \\[  \\xymatrix{ L \\ar[r]_\\tau &  \\overline{L} \\\\  M \\ar[u] \\ar[ru]_\\sigma &  K \\ar[l] \\ar[u] }  \\]\n\n    \n       is commutative. By Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] we see that $\\tau (L) = L$. Hence $\\tau : L \\to L$ is an automorphism which extends $\\sigma $. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 1","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues about extending an F-embedding œÉ : M ‚Üí L to an automorphism œÑ of L (via an algebraic closure) and uses normality to conclude œÑ(L)=L and œÑ(M)=M, hence restriction/extension properties. The Lean term, however, is just an explicit composition of algebra homomorphisms built from `AlgEquiv.ofInjectiveField (IsScalarTower.toAlgHom ...)` and `œï.restrictNormalAux E`, with a symmetry/inverse and two base-change maps; it does not reflect the key informal steps (choosing an algebraic closure, extending to it, then using normality to land back in L). Structurally, the informal proof is a two-part existence/extension argument, while the Lean proof is a point-free definition of a map via conjugation/restriction, with no visible existential construction. There is some thematic overlap (restriction to a normal subextension and composing with tower maps), but the formal proof does not clearly encode the extension-to-closure argument or the normality lemma used in the informal proof, so alignment is weak.""}"
203,02JJ,"theorem IsPurelyInseparable.trans [Algebra E K] [IsScalarTower F E K]
    [h1 : IsPurelyInseparable F E] [h2 : IsPurelyInseparable E K] : IsPurelyInseparable F K := by
  obtain ‚ü®q, _‚ü© := ExpChar.exists F
  haveI := expChar_of_injective_algebraMap (algebraMap F E).injective q
  rw [isPurelyInseparable_iff_pow_mem _ q] at h1 h2 ‚ä¢
  intro x
  obtain ‚ü®n, y, h2‚ü© := h2 x
  obtain ‚ü®m, z, h1‚ü© := h1 y
  refine ‚ü®n + m, z, ?_‚ü©
  rw [IsScalarTower.algebraMap_apply F E K, h1, map_pow, h2, ‚Üê pow_mul, ‚Üê pow_add]
",Formal Proof of Stacks Project Tag 02JJ,See also 00GM,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PurelyInseparable/Basic.lean#L260-L269,Q27041,,10.36.5,lemma,3.0,"['00GH', '00AO', '0ELQ']","\n  Lemma 10.36.5. Let $R \\to S$ be a ring map. The following are equivalent \n  \n  \n$R \\to S$ is finite, \n\n\n$R \\to S$ is integral and of finite type, and \n\n\nthere exist $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an algebra over $R$ such that each $x_ i$ is integral over $R$. \n\n\n\n\n    \n      Proof.\n      Clear from Lemma 10.36.4. \n      $\\square$\n    \n","\n  Lemma 10.36.5. Let $R \\to S$ be a ring map. The following are equivalent \n  \n  \n$R \\to S$ is finite, \n\n\n$R \\to S$ is integral and of finite type, and \n\n\nthere exist $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an algebra over $R$ such that each $x_ i$ is integral over $R$. \n\n\n\n\n    \n",Proof.\n      Clear from Lemma 10.36.4. \n      $\\square$\n    \n," by
  obtain ‚ü®q, _‚ü© := ExpChar.exists F
  haveI := expChar_of_injective_algebraMap (algebraMap F E).injective q
  rw [isPurelyInseparable_iff_pow_mem _ q] at h1 h2 ‚ä¢
  intro x
  obtain ‚ü®n, y, h2‚ü© := h2 x
  obtain ‚ü®m, z, h1‚ü© := h1 y
  refine ‚ü®n + m, z, ?_‚ü©
  rw [IsScalarTower.algebraMap_apply F E K, h1, map_pow, h2, ‚Üê pow_mul, ‚Üê pow_add]
","theorem IsPurelyInseparable.trans [Algebra E K] [IsScalarTower F E K]
    [h1 : IsPurelyInseparable F E] [h2 : IsPurelyInseparable E K] : IsPurelyInseparable F K ","Proof.\n      Clear from Lemma 10.36.4 [[\n  Lemma 10.36.4. Let $\\varphi : R \\to S$ be a ring map. Let $s_1, \\ldots , s_ n$ be a finite set of elements of $S$. In this case $s_ i$ is integral over $R$ for all $i = 1, \\ldots , n$ if and only if there exists an $R$-subalgebra $S\' \\subset S$ finite over $R$ containing all of the $s_ i$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Clear from Lemma 10.36.4 [[\n  Lemma 10.36.4. Let $\\varphi : R \\to S$ be a ring map. Let $s_1, \\ldots , s_ n$ be a finite set of elements of $S$. In this case $s_ i$ is integral over $R$ for all $i = 1, \\ldots , n$ if and only if there exists an $R$-subalgebra $S\' \\subset S$ finite over $R$ containing all of the $s_ i$. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: See also 00GM","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the Lean proof is about purely inseparable extensions: it picks an exponential characteristic q, rewrites hypotheses using `isPurelyInseparable_iff_pow_mem`, and then combines two ‚Äúpower lies in the base‚Äù witnesses by adding exponents (n+m) and using scalar tower/algebra map and power identities. The informal proof instead cites a lemma characterizing integrality of finitely many elements via existence of a finite subalgebra containing them (a finiteness/integrality criterion). These are different mathematical statements (purely inseparable vs integrality/finite subalgebra), with no corresponding objects or steps. Structurally, the Lean proof is a constructive witness-chasing argument with exponents, while the informal proof is a one-line citation to Lemma 10.36.4. Thus there is essentially no semantic or structural correspondence.""}"
204,030K,"instance separableClosure.isPurelyInseparable [Algebra.IsAlgebraic F E] :
    IsPurelyInseparable (separableClosure F E) E := isPurelyInseparable_iff.2 fun x ‚Ü¶ by
  set L := separableClosure F E
  refine ‚ü®(IsAlgebraic.tower_top L (Algebra.IsAlgebraic.isAlgebraic (R := F) x)).isIntegral,
    fun h ‚Ü¶ ?_‚ü©
  haveI := (isSeparable_adjoin_simple_iff_isSeparable L E).2 h
  haveI : Algebra.IsSeparable F (restrictScalars F L‚üÆx‚üØ) := Algebra.IsSeparable.trans F L L‚üÆx‚üØ
  have hx : x ‚àà restrictScalars F L‚üÆx‚üØ := mem_adjoin_simple_self _ x
  exact ‚ü®‚ü®x, mem_separableClosure_iff.2 <| isSeparable_of_mem_isSeparable F E hx‚ü©, rfl‚ü©
",Formal Proof of Stacks Project Tag 030K,$E/E_{sep}$ is purely inseparable.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PurelyInseparable/Basic.lean#L473-L481,Q27041,,9.14.6,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n      Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n",\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n,"Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n"," isPurelyInseparable_iff.2 fun x ‚Ü¶ by
  set L := separableClosure F E
  refine ‚ü®(IsAlgebraic.tower_top L (Algebra.IsAlgebraic.isAlgebraic (R := F) x)).isIntegral,
    fun h ‚Ü¶ ?_‚ü©
  haveI := (isSeparable_adjoin_simple_iff_isSeparable L E).2 h
  haveI : Algebra.IsSeparable F (restrictScalars F L‚üÆx‚üØ) := Algebra.IsSeparable.trans F L L‚üÆx‚üØ
  have hx : x ‚àà restrictScalars F L‚üÆx‚üØ := mem_adjoin_simple_self _ x
  exact ‚ü®‚ü®x, mem_separableClosure_iff.2 <| isSeparable_of_mem_isSeparable F E hx‚ü©, rfl‚ü©
","instance separableClosure.isPurelyInseparable [Algebra.IsAlgebraic F E] :
    IsPurelyInseparable (separableClosure F E) E ","Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 [[\n  Lemma 9.12.13. Let $E/k$ be a field extension. Then the elements of $E$ separable over $k$ form a subextension of $E/k$. \n\n    \n]] and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]]. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n","Proof.\n      If the characteristic is zero we set $E_{sep} = E$. Assume the characteristic is $p > 0$. Let $E_{sep}$ be the set of elements of $E$ which are separable over $F$. This is a subextension by Lemma 9.12.13 [[\n  Lemma 9.12.13. Let $E/k$ be a field extension. Then the elements of $E$ separable over $k$ form a subextension of $E/k$. \n\n    \n]] and of course $E_{sep}$ is separable over $F$. Given an $\\alpha $ in $E$ there exists a $p$-power $q$ such that $\\alpha ^ q$ is separable over $F$. Namely, $q$ is that power of $p$ such that the minimal polynomial of $\\alpha $ is of the form $P(x^ q)$ with $P$ separable algebraic, see Lemma 9.12.1 [[\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n]]. Hence $E/E_{sep}$ is purely inseparable. Uniqueness is clear. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: $E/E_{sep}$ is purely inseparable.","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is about showing a purely inseparable condition via `isPurelyInseparable_iff` using the separable closure `L := separableClosure F E`, and it concludes that an element `x` actually lies in the separable closure when a separability hypothesis `h` holds for the simple extension. This matches the *direction* needed to show that the extension over the separable closure is purely inseparable (i.e., separable elements over the base must already be in the base). However, the informal proof‚Äôs main content is the characteristic-p argument: for each Œ± there exists a p-power q such that Œ±^q is separable over F (using minimal polynomial/derivative lemmas), yielding pure inseparability of E/E_sep. None of that p-power/minimal-polynomial structure appears in the Lean proof; instead it uses abstract separability-closure machinery and separability transfer lemmas. Structurally, the informal proof constructs E_sep and proves the p-power separability property, while the Lean proof fixes L as separableClosure and proves a closure property about elements under a separability assumption. So the conclusion aligns, but the method and key intermediate steps from the informal proof are not reflected, making the alignment partial rather than perfect.""}"
205,09HJ,"theorem finSepDegree_eq [Algebra.IsAlgebraic F E] :
    finSepDegree F E = Cardinal.toNat (sepDegree F E) := by
  have h := finSepDegree_mul_finSepDegree_of_isAlgebraic F (separableClosure F E) E |>.symm
  rwa [finSepDegree_eq_finrank_of_isSeparable F (separableClosure F E),
    IsPurelyInseparable.finSepDegree_eq_one (separableClosure F E) E, mul_one] at h
",Formal Proof of Stacks Project Tag 09HJ,`sepDegree` is defined as the right-hand side of 09HJ,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PurelyInseparable/Basic.lean#L572-L576,Q27041,,9.14.8,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n      Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6. By Lemma 9.12.11 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n","\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n","Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6. By Lemma 9.12.11 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n"," by
  have h := finSepDegree_mul_finSepDegree_of_isAlgebraic F (separableClosure F E) E |>.symm
  rwa [finSepDegree_eq_finrank_of_isSeparable F (separableClosure F E),
    IsPurelyInseparable.finSepDegree_eq_one (separableClosure F E) E, mul_one] at h
","theorem finSepDegree_eq [Algebra.IsAlgebraic F E] :
    finSepDegree F E = Cardinal.toNat (sepDegree F E) ","Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 [[\n  Lemma 9.12.9. In Situation 9.12.7 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = \\prod _{i = 1}^ n \\deg _ s(P_ i)$. \n\n    \n]] we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]]. By Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n","Proof.\n      We first prove this when $K/F$ is purely inseparable. Namely, we claim that in this case there is a unique map $K \\to \\overline{F}$. This can be seen by choosing a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in K$ as in Lemma 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. The irreducible polynomial of $\\alpha _ i$ over $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is $x^ p - \\alpha _ i^ p$. Applying Lemma 9.12.9 [[\n  Lemma 9.12.9. In Situation 9.12.7 we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = \\prod _{i = 1}^ n \\deg _ s(P_ i)$. \n\n    \n]] we see that $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = 1$. On the other hand, $[K : F]_ s = 1$ in this case hence the equality holds. \n    \n      Let\'s return to a general finite extension $K/F$. In this case choose $F \\subset K_ s \\subset K$ as in Lemma 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]]. By Lemma 9.12.11 [[\n  Lemma 9.12.11. Let $K/F$ be a finite extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. Then we have \n  \n  \\[  |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| \\leq [K : F]  \\]\n\n   with equality if and only if $K$ is separable over $F$. \n\n    \n]] we have $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})| = [K_ s : F] = [K : F]_ s$. On the other hand, every field map $\\sigma \' : K_ s \\to \\overline{F}$ extends to a unique field map $\\sigma : K \\to \\overline{F}$ by the result of the previous paragraph. In other words $|\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})| = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K_ s, \\overline{F})|$ and the proof is done. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: `sepDegree` is defined as the right-hand side of 09HJ","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is proving a multiplicativity statement for `finSepDegree` along the tower F ‚äÇ separableClosure F E ‚äÇ E, then rewrites using (i) `finSepDegree_eq_finrank_of_isSeparable` for the separable closure over F and (ii) `IsPurelyInseparable.finSepDegree_eq_one` for E over its separable closure, yielding a simplification by `mul_one`. This matches the informal proof‚Äôs high-level strategy: reduce to the separable subextension K_s and use that the purely inseparable part contributes factor 1 to the separable degree, so the relevant count/degree is determined by the separable part.\nStructurally, however, the informal proof proceeds via counting F-morphisms into an algebraic closure, first handling the purely inseparable case by an explicit tower and then extending embeddings uniquely; the Lean proof does not mention morphism counts or extension of maps, and instead uses abstract lemmas about `finSepDegree` and separable/purely inseparable properties of the separable closure. So the core idea (separable part times 1) aligns, but the detailed argument and intermediate lemmas differ substantially, and the purely inseparable ‚Äúunique extension of maps‚Äù step is not reflected in the Lean code.""}"
206,09HH,"def perfectClosure : IntermediateField F E where
  __ := have := expChar_of_injective_algebraMap (algebraMap F E).injective (ringExpChar F)
    Subalgebra.perfectClosure F E (ringExpChar F)
  inv_mem' := by
    rintro x ‚ü®n, hx‚ü©
    use n; rw [inv_pow]
    apply inv_mem (id hx : _ ‚àà (‚ä• : IntermediateField F E))
",Formal Proof of Stacks Project Tag 09HH,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PurelyInseparable/PerfectClosure.lean#L62-L68,Q27041,,9.14.4,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.4. Let $E/k$ be a field extension. Then the elements of $E$ purely-inseparable over $k$ form a subextension of $E/k$. \n\n    \n      Proof.\n      Let $p$ be the characteristic of $k$. Let $\\alpha , \\beta \\in E$ be purely inseparable over $k$. Say $\\alpha ^ q \\in k$ and $\\beta ^{q\'} \\in k$ for some $p$-powers $q, q\'$. If $q\'\'$ is a $p$-power, then $(\\alpha + \\beta )^{q\'\'} = \\alpha ^{q\'\'} + \\beta ^{q\'\'}$. Hence if $q\'\' \\geq q, q\'$, then we conclude that $\\alpha + \\beta $ is purely inseparable over $k$. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n",\n  Lemma 9.14.4. Let $E/k$ be a field extension. Then the elements of $E$ purely-inseparable over $k$ form a subextension of $E/k$. \n\n    \n,"Proof.\n      Let $p$ be the characteristic of $k$. Let $\\alpha , \\beta \\in E$ be purely inseparable over $k$. Say $\\alpha ^ q \\in k$ and $\\beta ^{q\'} \\in k$ for some $p$-powers $q, q\'$. If $q\'\'$ is a $p$-power, then $(\\alpha + \\beta )^{q\'\'} = \\alpha ^{q\'\'} + \\beta ^{q\'\'}$. Hence if $q\'\' \\geq q, q\'$, then we conclude that $\\alpha + \\beta $ is purely inseparable over $k$. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n"," have := expChar_of_injective_algebraMap (algebraMap F E).injective (ringExpChar F)
    Subalgebra.perfectClosure F E (ringExpChar F)
  inv_mem' := by
    rintro x ‚ü®n, hx‚ü©
    use n; rw [inv_pow]
    apply inv_mem (id hx : _ ‚àà (‚ä• : IntermediateField F E))
","def perfectClosure : IntermediateField F E where
  __ ","Proof.\n      Let $p$ be the characteristic of $k$. Let $\\alpha , \\beta \\in E$ be purely inseparable over $k$. Say $\\alpha ^ q \\in k$ and $\\beta ^{q\'} \\in k$ for some $p$-powers $q, q\'$. If $q\'\'$ is a $p$-power, then $(\\alpha + \\beta )^{q\'\'} = \\alpha ^{q\'\'} + \\beta ^{q\'\'}$. Hence if $q\'\' \\geq q, q\'$, then we conclude that $\\alpha + \\beta $ is purely inseparable over $k$. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n","Proof.\n      Let $p$ be the characteristic of $k$. Let $\\alpha , \\beta \\in E$ be purely inseparable over $k$. Say $\\alpha ^ q \\in k$ and $\\beta ^{q\'} \\in k$ for some $p$-powers $q, q\'$. If $q\'\'$ is a $p$-power, then $(\\alpha + \\beta )^{q\'\'} = \\alpha ^{q\'\'} + \\beta ^{q\'\'}$. Hence if $q\'\' \\geq q, q\'$, then we conclude that $\\alpha + \\beta $ is purely inseparable over $k$. Similarly for the difference, product and quotient of $\\alpha $ and $\\beta $. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof argues that the set of purely inseparable elements over a base field is closed under +, ‚àí, √ó, and √∑ by using the Frobenius/p-power identity (Œ±+Œ≤)^{p^n}=Œ±^{p^n}+Œ≤^{p^n} and choosing a large enough p-power. The Lean snippet instead constructs an `inv_mem'` field for a structure coming from `Subalgebra.perfectClosure` and proves closure under inverses using `inv_pow` and an `inv_mem` lemma, with no reasoning about sums/products or Frobenius additivity. Structurally, the informal proof is a case split over operations with a key p-power binomial argument, while the formal proof is a short tactic proof about membership under inversion in a specific closure object. Thus the formal proof does not reflect the main argument or scope of the informal proof and only touches a small, different aspect (inverses) without the characteristic-p power-sum reasoning.""}"
207,09HK,"theorem sepDegree_mul_sepDegree_of_isAlgebraic (K : Type v) [Field K] [Algebra F K]
    [Algebra E K] [IsScalarTower F E K] [Algebra.IsAlgebraic F E] :
    sepDegree F E * sepDegree E K = sepDegree F K := by
  simpa only [Cardinal.lift_id] using lift_sepDegree_mul_lift_sepDegree_of_isAlgebraic F E K
",Formal Proof of Stacks Project Tag 09HK,Part 1,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PurelyInseparable/Tower.lean#L185-L188,Q27041,Multiplicativity,9.14.9,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n      Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n",\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n,"Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n"," by
  simpa only [Cardinal.lift_id] using lift_sepDegree_mul_lift_sepDegree_of_isAlgebraic F E K
","theorem sepDegree_mul_sepDegree_of_isAlgebraic (K : Type v) [Field K] [Algebra F K]
    [Algebra E K] [IsScalarTower F E K] [Algebra.IsAlgebraic F E] :
    sepDegree F E * sepDegree E K = sepDegree F K ","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 1","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof establishes a multiplicativity statement for separable degrees in a tower under an algebraicity hypothesis, by directly invoking the lemma `lift_sepDegree_mul_lift_sepDegree_of_isAlgebraic F E K` and simplifying away `Cardinal.lift_id`. This matches the *conclusion* suggested by the informal proof (a product formula for separable degrees, expressed via cardinalities of F-embeddings).\n\nStructurally, however, the informal proof proceeds by reducing to the finite case, using multiplicativity of usual degrees, then identifying separable degree with the number of F-morphisms into an algebraic closure and counting extensions of embeddings. None of these intermediate steps (finite reduction, embedding-count argument, extension counting) appear in the Lean proof; it is a one-line wrapper around an existing lemma.\n\nCompleteness/precision: the Lean proof is complete for the Lean statement it targets, but it omits the informal proof‚Äôs case split and counting argument, and it relies on a stronger/different packaged lemma (algebraic rather than explicitly finite, and with `lift`s). There is no extraneous content, but the correspondence is mainly at the level of the final result rather than the method.""}"
208,09HK,"theorem insepDegree_mul_insepDegree_of_isAlgebraic (K : Type v) [Field K] [Algebra F K]
    [Algebra E K] [IsScalarTower F E K] [Algebra.IsAlgebraic F E] :
    insepDegree F E * insepDegree E K = insepDegree F K := by
  simpa only [Cardinal.lift_id] using lift_insepDegree_mul_lift_insepDegree_of_isAlgebraic F E K
",Formal Proof of Stacks Project Tag 09HK,Part 2,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PurelyInseparable/Tower.lean#L200-L203,Q27041,Multiplicativity,9.14.9,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n      Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n",\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n,"Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n"," by
  simpa only [Cardinal.lift_id] using lift_insepDegree_mul_lift_insepDegree_of_isAlgebraic F E K
","theorem insepDegree_mul_insepDegree_of_isAlgebraic (K : Type v) [Field K] [Algebra F K]
    [Algebra E K] [IsScalarTower F E K] [Algebra.IsAlgebraic F E] :
    insepDegree F E * insepDegree E K = insepDegree F K ","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 2","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is a one-line `simpa` reduction to an existing lemma `lift_insepDegree_mul_lift_insepDegree_of_isAlgebraic F E K`, so it proves the target statement only by directly invoking a pre-proved multiplicativity result for (lifted) inseparable degrees under an algebraicity hypothesis. The informal proof, however, argues via a finite-extension case, uses multiplicativity of the usual degree, identifies separable degree with the cardinality of F-morphisms into an algebraic closure, and counts extensions of embeddings; it also explicitly mentions omitting the infinite case. Structurally, there is essentially no correspondence: the Lean proof contains none of the intermediate steps (finite case reduction, morphism-counting, extension counting) and does not mirror the proof strategy, instead relying entirely on a library lemma. While the end theorem may match (depending on the stated goal and the 'Part 2' relation), the proof content and structure are not aligned beyond both aiming at a multiplicativity statement.""}"
209,09HK,"theorem finInsepDegree_mul_finInsepDegree_of_isAlgebraic [Algebra.IsAlgebraic F E] :
    finInsepDegree F E * finInsepDegree E K = finInsepDegree F K := by
  simpa only [map_mul, Cardinal.toNat_lift] using
    congr(Cardinal.toNat $(lift_insepDegree_mul_lift_insepDegree_of_isAlgebraic F E K))
",Formal Proof of Stacks Project Tag 09HK,"Part 2, `finInsepDegree` variant",https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/PurelyInseparable/Tower.lean#L208-L211,Q27041,Multiplicativity,9.14.9,lemma,3.0,"['09HD', '09FA', '0ELQ']","\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n      Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n",\n  Lemma 9.14.9 (Multiplicativity).  Suppose given a tower of algebraic field extensions $K/E/F$. Then \n  \n  \\[  [K : F]_ s = [K : E]_ s [E : F]_ s \\quad \\text{and}\\quad [K : F]_ i = [K : E]_ i [E : F]_ i  \\]\n\n\n    \n,"Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7) it suffices to prove one of the two formulas. By Lemma 9.14.8 we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n"," by
  simpa only [map_mul, Cardinal.toNat_lift] using
    congr(Cardinal.toNat $(lift_insepDegree_mul_lift_insepDegree_of_isAlgebraic F E K))
","theorem finInsepDegree_mul_finInsepDegree_of_isAlgebraic [Algebra.IsAlgebraic F E] :
    finInsepDegree F E * finInsepDegree E K = finInsepDegree F K ","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n","Proof.\n      We first prove this in case $K$ is finite over $F$. Since we have multiplicativity for the usual degree (by Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove one of the two formulas. By Lemma 9.14.8 [[\n  Lemma 9.14.8. Let $K/F$ be a finite extension. Let $\\overline{F}$ be an algebraic closure of $F$. Then $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. \n\n    \n]] we have $[K : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(K, \\overline{F})|$. By the same lemma, given any $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ the number of extensions of $\\sigma $ to a map $\\tau : K \\to \\overline{F}$ is $[K : E]_ s$. Namely, via $E \\cong \\sigma (E) \\subset \\overline{F}$ we can view $\\overline{F}$ as an algebraic closure of $E$. Combined with the fact that there are $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$ choices for $\\sigma $ we obtain the result. \n    \n      We omit the proof if the extensions are infinite. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 2, `finInsepDegree` variant","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is proving a multiplicativity statement for (finite) inseparable degrees in a tower by directly invoking an existing lemma `lift_insepDegree_mul_lift_insepDegree_of_isAlgebraic F E K`, then applying `Cardinal.toNat` and simplifying (`map_mul`, `Cardinal.toNat_lift`). This matches the *result* (a multiplicativity formula) but not the informal argument.\n\nStructurally, the informal proof proceeds by reducing to the finite case, using multiplicativity of usual degrees, then identifying separable degree with the cardinality of F-algebra morphisms into an algebraic closure and counting extensions of embeddings. None of these steps (finite reduction, morphism-counting, extension counting) appear in the Lean proof; instead it is a one-line wrapper around a pre-proved lemma about lifted inseparable degrees under an algebraicity assumption.\n\nCompleteness/precision: the Lean proof omits the informal proof‚Äôs key ingredients and also targets the inseparable-degree/toNat-of-cardinal-lift formulation (as per the comment about the `finInsepDegree` variant), whereas the informal text is about separable degree and explicitly discusses the finite case and omits the infinite case. Thus there is only partial semantic overlap (multiplicativity in a tower), with significant mismatch in proof method and some mismatch in which degree notion is being justified.""}"
212,09HU,"protected theorem splits : Splits (f.map (algebraMap K (SplittingField f))) :=
  IsSplittingField.splits f.SplittingField f
",Formal Proof of Stacks Project Tag 09HU,Splitting part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/FieldTheory/SplittingField/Construction.lean#L272-L273,Q27041,,9.16.1,lemma,3.0,"['09HT', '09FA', '0ELQ']","\n  Lemma 9.16.1. Let $F$ be a field. Let $P \\in F[x]$ be a nonconstant polynomial. There exists a smallest field extension $E/F$ such that $P$ splits completely over $E$. Moreover, the field extension $E/F$ is normal and unique up to (nonunique) isomorphism. \n\n    \n      Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n","\n  Lemma 9.16.1. Let $F$ be a field. Let $P \\in F[x]$ be a nonconstant polynomial. There exists a smallest field extension $E/F$ such that $P$ splits completely over $E$. Moreover, the field extension $E/F$ is normal and unique up to (nonunique) isomorphism. \n\n    \n","Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n","
  IsSplittingField.splits f.SplittingField f
",protected theorem splits : Splits (f.map (algebraMap K (SplittingField f))) ,"Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]]) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n","Proof.\n      Choose an algebraic closure $\\overline{F}$. Then we can write $P = c (x - \\beta _1) \\ldots (x - \\beta _ n)$ in $\\overline{F}[x]$, see Lemma 9.10.2 [[\n  Lemma 9.10.2. Let $F$ be a field. The following are equivalent \n  \n  \n$F$ is algebraically closed, \n\n\nevery irreducible polynomial over $F$ is linear, \n\n\nevery nonconstant polynomial over $F$ has a root, \n\n\nevery nonconstant polynomial over $F$ is a product of linear factors. \n\n\n\n\n    \n]]. Note that $c \\in F^*$. Set $E = F(\\beta _1, \\ldots , \\beta _ n)$. Then it is clear that $E$ is minimal with the requirement that $P$ splits completely over $E$. \n    \n      Next, let $E\'$ be another minimal field extension of $F$ such that $P$ splits completely over $E\'$. Write $P = c (x - \\alpha _1) \\ldots (x - \\alpha _ n)$ with $c \\in F$ and $\\alpha _ i \\in E\'$. Again it follows from minimality that $E\' = F(\\alpha _1, \\ldots , \\alpha _ n)$. Moreover, if we pick any $\\sigma : E\' \\to \\overline{F}$ (Lemma 9.10.5 [[\n  Lemma 9.10.5. Let $F$ be a field. Let $\\overline{F}$ be an algebraic closure of $F$. Let $M/F$ be an algebraic extension. Then there is a morphism of $F$-extensions $M \\to \\overline{F}$. \n\n    \n]]) then we immediately see that $\\sigma (\\alpha _ i) = \\beta _{\\tau (i)}$ for some permutation $\\tau : \\{ 1, \\ldots , n\\}  \\to \\{ 1, \\ldots , n\\} $. Thus $\\sigma (E\') = E$. This implies that $E\'$ is a normal extension of $F$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] and that $E \\cong E\'$ as extensions of $F$ thereby finishing the proof. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Splitting part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term `IsSplittingField.splits f.SplittingField f` only establishes that the polynomial `f` splits over its constructed splitting field `f.SplittingField`. This matches just the ‚Äúsplitting part‚Äù of the informal proof (i.e., that the polynomial factors into linear factors over the chosen extension), but it does not address the informal proof‚Äôs main additional content: constructing the field as generated by roots, minimality of the extension, comparison with another minimal splitting field, embedding into an algebraic closure, normality, and uniqueness up to F-isomorphism. Structurally, the informal proof proceeds via algebraic closure, explicit factorization, minimality, and uniqueness/normality arguments, whereas the Lean proof is a one-line invocation of a library lemma about splitting in the canonical splitting field, with none of that structure reflected. Thus there is partial semantic overlap (splits over splitting field) but substantial mismatch in scope and structure.""}"
214,09FN,"instance (priority := 100) _root_.Module.Free.of_divisionRing : Module.Free K V :=
  Module.Free.of_basis (ofVectorSpace K V)
",Formal Proof of Stacks Project Tag 09FN,Generalized from fields to division rings.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/LinearAlgebra/Basis/VectorSpace.lean#L153-L154,Q27041,,9.4.1,lemma,3.0,"['09FM', '09FA', '0ELQ']","\n  Lemma 9.4.1. If $k$ is a field, then every $k$-module is free. \n\n    \n      Proof.\n      Indeed, by linear algebra we know that a $k$-module (i.e. vector space) $V$ has a basis $\\mathcal{B} \\subset V$, which defines an isomorphism from the free vector space on $\\mathcal{B}$ to $V$. \n      $\\square$\n    \n","\n  Lemma 9.4.1. If $k$ is a field, then every $k$-module is free. \n\n    \n","Proof.\n      Indeed, by linear algebra we know that a $k$-module (i.e. vector space) $V$ has a basis $\\mathcal{B} \\subset V$, which defines an isomorphism from the free vector space on $\\mathcal{B}$ to $V$. \n      $\\square$\n    \n"," 100) _root_.Module.Free.of_divisionRing : Module.Free K V :=
  Module.Free.of_basis (ofVectorSpace K V)
",instance (priority ,"Proof.\n      Indeed, by linear algebra we know that a $k$-module (i.e. vector space) $V$ has a basis $\\mathcal{B} \\subset V$, which defines an isomorphism from the free vector space on $\\mathcal{B}$ to $V$. \n      $\\square$\n    \n","Proof.\n      Indeed, by linear algebra we know that a $k$-module (i.e. vector space) $V$ has a basis $\\mathcal{B} \\subset V$, which defines an isomorphism from the free vector space on $\\mathcal{B}$ to $V$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Generalized from fields to division rings.","{""Alignment Score"": ""5"", ""brief_justification"": ""Semantically, the informal proof argues that a vector space over a field has a basis, hence is free; the Lean proof constructs `Module.Free K V` by applying `Module.Free.of_basis` to the canonical basis existence `ofVectorSpace K V`. This matches the same mathematical content (existence of a basis implies freeness). Structurally, both are a one-step argument: obtain a basis from linear algebra and conclude freeness from that basis. The Lean version is slightly more general (division rings instead of fields), consistent with the provided comment, and does not introduce extraneous steps beyond the basis-to-free construction.""}"
216,09G9,"theorem rank_mul_rank (A : Type v) [AddCommMonoid A]
    [Module K A] [Module F A] [IsScalarTower F K A] [Module.Free K A] :
    Module.rank F K * Module.rank K A = Module.rank F A := by
  convert lift_rank_mul_lift_rank F K A <;> rw [lift_id]
",Formal Proof of Stacks Project Tag 09G9,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/LinearAlgebra/Dimension/Free.lean#L58-L61,Q27041,Multiplicativity,9.7.7,lemma,3.0,"['09G2', '09FA', '0ELQ']","\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n      Proof.\n      Let $\\alpha _1, \\ldots , \\alpha _ n \\in F$ be an $E$-basis for $F$. Let $\\beta _1, \\ldots , \\beta _ m \\in E$ be a $k$-basis for $E$. Then the claim is that the set of products $\\{ \\alpha _ i \\beta _ j, 1 \\leq i \\leq n, 1 \\leq j \\leq m\\} $ is a $k$-basis for $F$. Indeed, let us check first that they span $F$ over $k$. \n    \n      By assumption, the $\\{ \\alpha _ i\\} $ span $F$ over $E$. So if $f \\in F$, there are $a_ i \\in E$ with \n    \n      \n  \\[  f = \\sum \\nolimits _ i a_ i \\alpha _ i,  \\]\n\n    \n       and, for each $i$, we can write $a_ i = \\sum b_{ij} \\beta _ j$ for some $b_{ij} \\in k$. Putting these together, we find \n    \n      \n  \\[  f = \\sum \\nolimits _{i,j} b_{ij} \\alpha _ i \\beta _ j,  \\]\n\n    \n       proving that the $\\{ \\alpha _ i \\beta _ j\\} $ span $F$ over $k$. \n    \n      Suppose now that there existed a nontrivial relation \n    \n      \n  \\[  \\sum \\nolimits _{i,j} c_{ij} \\alpha _ i \\beta _ j = 0  \\]\n\n    \n       for the $c_{ij} \\in k$. In that case, we would have \n    \n      \n  \\[  \\sum \\nolimits _ i \\alpha _ i \\left( \\sum \\nolimits _ j c_{ij} \\beta _ j \\right) = 0,  \\]\n\n    \n       and the inner terms lie in $E$ as the $\\beta _ j$ do. Now $E$-linear independence of the $\\{ \\alpha _ i\\} $ shows that the inner sums are all zero. Then $k$-linear independence of the $\\{ \\beta _ j\\} $ shows that the $c_{ij}$ all vanish. \n      $\\square$\n    \n",\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n,"Proof.\n      Let $\\alpha _1, \\ldots , \\alpha _ n \\in F$ be an $E$-basis for $F$. Let $\\beta _1, \\ldots , \\beta _ m \\in E$ be a $k$-basis for $E$. Then the claim is that the set of products $\\{ \\alpha _ i \\beta _ j, 1 \\leq i \\leq n, 1 \\leq j \\leq m\\} $ is a $k$-basis for $F$. Indeed, let us check first that they span $F$ over $k$. \n    \n      By assumption, the $\\{ \\alpha _ i\\} $ span $F$ over $E$. So if $f \\in F$, there are $a_ i \\in E$ with \n    \n      \n  \\[  f = \\sum \\nolimits _ i a_ i \\alpha _ i,  \\]\n\n    \n       and, for each $i$, we can write $a_ i = \\sum b_{ij} \\beta _ j$ for some $b_{ij} \\in k$. Putting these together, we find \n    \n      \n  \\[  f = \\sum \\nolimits _{i,j} b_{ij} \\alpha _ i \\beta _ j,  \\]\n\n    \n       proving that the $\\{ \\alpha _ i \\beta _ j\\} $ span $F$ over $k$. \n    \n      Suppose now that there existed a nontrivial relation \n    \n      \n  \\[  \\sum \\nolimits _{i,j} c_{ij} \\alpha _ i \\beta _ j = 0  \\]\n\n    \n       for the $c_{ij} \\in k$. In that case, we would have \n    \n      \n  \\[  \\sum \\nolimits _ i \\alpha _ i \\left( \\sum \\nolimits _ j c_{ij} \\beta _ j \\right) = 0,  \\]\n\n    \n       and the inner terms lie in $E$ as the $\\beta _ j$ do. Now $E$-linear independence of the $\\{ \\alpha _ i\\} $ shows that the inner sums are all zero. Then $k$-linear independence of the $\\{ \\beta _ j\\} $ shows that the $c_{ij}$ all vanish. \n      $\\square$\n    \n"," by
  convert lift_rank_mul_lift_rank F K A <;> rw [lift_id]
","theorem rank_mul_rank (A : Type v) [AddCommMonoid A]
    [Module K A] [Module F A] [IsScalarTower F K A] [Module.Free K A] :
    Module.rank F K * Module.rank K A = Module.rank F A ","Proof.\n      Let $\\alpha _1, \\ldots , \\alpha _ n \\in F$ be an $E$-basis for $F$. Let $\\beta _1, \\ldots , \\beta _ m \\in E$ be a $k$-basis for $E$. Then the claim is that the set of products $\\{ \\alpha _ i \\beta _ j, 1 \\leq i \\leq n, 1 \\leq j \\leq m\\} $ is a $k$-basis for $F$. Indeed, let us check first that they span $F$ over $k$. \n    \n      By assumption, the $\\{ \\alpha _ i\\} $ span $F$ over $E$. So if $f \\in F$, there are $a_ i \\in E$ with \n    \n      \n  \\[  f = \\sum \\nolimits _ i a_ i \\alpha _ i,  \\]\n\n    \n       and, for each $i$, we can write $a_ i = \\sum b_{ij} \\beta _ j$ for some $b_{ij} \\in k$. Putting these together, we find \n    \n      \n  \\[  f = \\sum \\nolimits _{i,j} b_{ij} \\alpha _ i \\beta _ j,  \\]\n\n    \n       proving that the $\\{ \\alpha _ i \\beta _ j\\} $ span $F$ over $k$. \n    \n      Suppose now that there existed a nontrivial relation \n    \n      \n  \\[  \\sum \\nolimits _{i,j} c_{ij} \\alpha _ i \\beta _ j = 0  \\]\n\n    \n       for the $c_{ij} \\in k$. In that case, we would have \n    \n      \n  \\[  \\sum \\nolimits _ i \\alpha _ i \\left( \\sum \\nolimits _ j c_{ij} \\beta _ j \\right) = 0,  \\]\n\n    \n       and the inner terms lie in $E$ as the $\\beta _ j$ do. Now $E$-linear independence of the $\\{ \\alpha _ i\\} $ shows that the inner sums are all zero. Then $k$-linear independence of the $\\{ \\beta _ j\\} $ shows that the $c_{ij}$ all vanish. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha _1, \\ldots , \\alpha _ n \\in F$ be an $E$-basis for $F$. Let $\\beta _1, \\ldots , \\beta _ m \\in E$ be a $k$-basis for $E$. Then the claim is that the set of products $\\{ \\alpha _ i \\beta _ j, 1 \\leq i \\leq n, 1 \\leq j \\leq m\\} $ is a $k$-basis for $F$. Indeed, let us check first that they span $F$ over $k$. \n    \n      By assumption, the $\\{ \\alpha _ i\\} $ span $F$ over $E$. So if $f \\in F$, there are $a_ i \\in E$ with \n    \n      \n  \\[  f = \\sum \\nolimits _ i a_ i \\alpha _ i,  \\]\n\n    \n       and, for each $i$, we can write $a_ i = \\sum b_{ij} \\beta _ j$ for some $b_{ij} \\in k$. Putting these together, we find \n    \n      \n  \\[  f = \\sum \\nolimits _{i,j} b_{ij} \\alpha _ i \\beta _ j,  \\]\n\n    \n       proving that the $\\{ \\alpha _ i \\beta _ j\\} $ span $F$ over $k$. \n    \n      Suppose now that there existed a nontrivial relation \n    \n      \n  \\[  \\sum \\nolimits _{i,j} c_{ij} \\alpha _ i \\beta _ j = 0  \\]\n\n    \n       for the $c_{ij} \\in k$. In that case, we would have \n    \n      \n  \\[  \\sum \\nolimits _ i \\alpha _ i \\left( \\sum \\nolimits _ j c_{ij} \\beta _ j \\right) = 0,  \\]\n\n    \n       and the inner terms lie in $E$ as the $\\beta _ j$ do. Now $E$-linear independence of the $\\{ \\alpha _ i\\} $ shows that the inner sums are all zero. Then $k$-linear independence of the $\\{ \\beta _ j\\} $ shows that the $c_{ij}$ all vanish. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof appears to establish a rank/dimension multiplicativity statement via the lemma `lift_rank_mul_lift_rank F K A`, which is plausibly the formal counterpart of the informal argument that a basis of products gives `dim_k F = dim_E F * dim_k E` (tower law). However, the informal proof explicitly constructs the product basis and proves spanning and linear independence, while the formal proof does not mirror this structure at all: it simply `convert`s to an existing lemma and rewrites with `lift_id`. Thus the conclusion likely matches, but the formal proof is a short lemma-application with rewriting rather than the constructive basis argument given informally, and it omits the spanning/independence reasoning present in the augmented proof.""}"
217,09HS,"theorem card_algHom_le_finrank : Nat.card (M ‚Üí‚Çê[K] L) ‚â§ finrank K M := by
  convert toNat_le_toNat (cardinalMk_algHom_le_rank K M L) ?_
  ¬∑ rw [toNat_lift, finrank]
  ¬∑ rw [lift_lt_aleph0]; have := Module.nontrivial K L; apply Module.rank_lt_aleph0
",Formal Proof of Stacks Project Tag 09HS,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/LinearAlgebra/FreeModule/Finite/Matrix.lean#L91-L94,Q27041,,9.15.9,lemma,3.0,"['09HL', '09FA', '0ELQ']","\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n      Proof.\n      Choose an algebraic closure $\\overline{F}$ of $F$. Recall that $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$. Pick an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Then the map \n    \n      \n  \\[  \\text{Aut}(E/F) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F}),\\quad \\tau \\longmapsto \\sigma _0 \\circ \\tau  \\]\n\n    \n       is injective. Thus the inequality. If equality holds, then every $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ is gotten by precomposing $\\sigma _0$ by an automorphism. Hence $\\sigma (E) = \\sigma _0(E)$. Thus $E$ is normal over $F$ by Lemma 9.15.5. \n    \n      Conversely, assume that $E/F$ is normal. Then by Lemma 9.15.5 we have $\\sigma (E) = \\sigma _0(E)$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we get an automorphism of $E$ over $F$ by setting $\\tau = \\sigma _0^{-1} \\circ \\sigma $. Whence the map displayed above is surjective. \n      $\\square$\n    \n",\n  Lemma 9.15.9. Let $E/F$ be a finite extension. We have \n  \n  \\[  |\\text{Aut}(E/F)| \\leq [E : F]_ s  \\]\n\n   with equality if and only if $E$ is normal over $F$. \n\n    \n,"Proof.\n      Choose an algebraic closure $\\overline{F}$ of $F$. Recall that $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$. Pick an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Then the map \n    \n      \n  \\[  \\text{Aut}(E/F) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F}),\\quad \\tau \\longmapsto \\sigma _0 \\circ \\tau  \\]\n\n    \n       is injective. Thus the inequality. If equality holds, then every $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ is gotten by precomposing $\\sigma _0$ by an automorphism. Hence $\\sigma (E) = \\sigma _0(E)$. Thus $E$ is normal over $F$ by Lemma 9.15.5. \n    \n      Conversely, assume that $E/F$ is normal. Then by Lemma 9.15.5 we have $\\sigma (E) = \\sigma _0(E)$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we get an automorphism of $E$ over $F$ by setting $\\tau = \\sigma _0^{-1} \\circ \\sigma $. Whence the map displayed above is surjective. \n      $\\square$\n    \n"," by
  convert toNat_le_toNat (cardinalMk_algHom_le_rank K M L) ?_
  ¬∑ rw [toNat_lift, finrank]
  ¬∑ rw [lift_lt_aleph0]; have := Module.nontrivial K L; apply Module.rank_lt_aleph0
",theorem card_algHom_le_finrank : Nat.card (M ‚Üí‚Çê[K] L) ‚â§ finrank K M ,"Proof.\n      Choose an algebraic closure $\\overline{F}$ of $F$. Recall that $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$. Pick an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Then the map \n    \n      \n  \\[  \\text{Aut}(E/F) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F}),\\quad \\tau \\longmapsto \\sigma _0 \\circ \\tau  \\]\n\n    \n       is injective. Thus the inequality. If equality holds, then every $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ is gotten by precomposing $\\sigma _0$ by an automorphism. Hence $\\sigma (E) = \\sigma _0(E)$. Thus $E$ is normal over $F$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]]. \n    \n      Conversely, assume that $E/F$ is normal. Then by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] we have $\\sigma (E) = \\sigma _0(E)$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we get an automorphism of $E$ over $F$ by setting $\\tau = \\sigma _0^{-1} \\circ \\sigma $. Whence the map displayed above is surjective. \n      $\\square$\n    \n","Proof.\n      Choose an algebraic closure $\\overline{F}$ of $F$. Recall that $[E : F]_ s = |\\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})|$. Pick an element $\\sigma _0 \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Then the map \n    \n      \n  \\[  \\text{Aut}(E/F) \\longrightarrow \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F}),\\quad \\tau \\longmapsto \\sigma _0 \\circ \\tau  \\]\n\n    \n       is injective. Thus the inequality. If equality holds, then every $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ is gotten by precomposing $\\sigma _0$ by an automorphism. Hence $\\sigma (E) = \\sigma _0(E)$. Thus $E$ is normal over $F$ by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]]. \n    \n      Conversely, assume that $E/F$ is normal. Then by Lemma 9.15.5 [[\n  Lemma 9.15.5. Let $E/F$ be an algebraic extension of fields. Let $\\overline{F}$ be an algebraic closure of $F$. The following are equivalent \n  \n  \n$E$ is normal over $F$, and \n\n\nfor every pair $\\sigma , \\sigma \' \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$ we have $\\sigma (E) = \\sigma \'(E)$. \n\n\n\n\n    \n]] we have $\\sigma (E) = \\sigma _0(E)$ for all $\\sigma \\in \\mathop{\\mathrm{Mor}}\\nolimits _ F(E, \\overline{F})$. Thus we get an automorphism of $E$ over $F$ by setting $\\tau = \\sigma _0^{-1} \\circ \\sigma $. Whence the map displayed above is surjective. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about field theory: comparing |Aut(E/F)| with the number of F-embeddings Mor_F(E, FÃÑ), proving an inequality via an injective map œÑ ‚Ü¶ œÉ0 ‚àò œÑ, and characterizing equality in terms of normality using a lemma about images œÉ(E). The formal Lean proof instead converts an inequality about `toNat` of cardinals coming from `cardinalMk_algHom_le_rank K M L`, then rewrites with `toNat_lift`, `finrank`, and uses `Module.rank_lt_aleph0` (a finiteness/rank/aleph0 argument). There is no mention of automorphism groups, embeddings into an algebraic closure, injectivity/surjectivity arguments, or normality/equality characterization. Structurally, the informal proof has a two-part argument (inequality then equality iff normal), while the formal proof is a short cardinal/rank conversion with a finiteness lemma. Thus they do not correspond in meaning or structure.""}"
218,0CKL,"theorem linearIndependent_monoidHom (G : Type*) [MulOneClass G] (L : Type*) [CommRing L]
    [IsDomain L] : LinearIndependent L (M := G ‚Üí L) (fun f => f : (G ‚Üí* L) ‚Üí G ‚Üí L) := by
  letI := Classical.decEq (G ‚Üí* L)
  letI : MulAction L L := DistribMulAction.toMulAction
  -- We prove linear independence by showing that only the trivial linear combination vanishes.
  apply linearIndependent_iff'.2
  intro s
  induction s using Finset.induction_on with
  | empty => simp
  | insert a s has ih =>
  intro g hg
  -- Here
  -- * `a` is a new character we will insert into the `Finset` of characters `s`,
  -- * `ih` is the fact that only the trivial linear combination of characters in `s` is zero
  -- * `hg` is the fact that `g` are the coefficients of a linear combination summing to zero
  -- and it remains to prove that `g` vanishes on `insert a s`.
  -- We now make the key calculation:
  -- For any character `i` in the original `Finset`, we have `g i ‚Ä¢ i = g i ‚Ä¢ a` as functions
  -- on the monoid `G`.
  have h1 (i) (his : i ‚àà s) : (g i ‚Ä¢ i : G ‚Üí L) = g i ‚Ä¢ a := by
    ext x
    rw [‚Üê sub_eq_zero]
    apply ih (fun j => g j * j x - g j * a x) _ i his
    ext y
    -- After that, it's just a chase scene.
    calc
      (‚àë i ‚àà s, (g i * i x - g i * a x) ‚Ä¢ i : G ‚Üí L) y =
          (‚àë i ‚àà s, g i * i x * i y) - ‚àë i ‚àà s, g i * a x * i y := by simp [sub_mul]
      _ = (‚àë i ‚àà insert a s, g i * i x * i y) -
            ‚àë i ‚àà insert a s, g i * a x * i y := by simp [Finset.sum_insert has]
      _ = (‚àë i ‚àà insert a s, g i * (i x * i y)) -
            ‚àë i ‚àà insert a s, a x * (g i * i y) := by
        congrm ‚àë i ‚àà insert a s, ?_ - ‚àë i ‚àà insert a s, ?_
        ¬∑ rw [mul_assoc]
        ¬∑ rw [mul_assoc, mul_left_comm]
      _ = (‚àë i ‚àà insert a s, g i ‚Ä¢ i : G ‚Üí L) (x * y) -
            a x * (‚àë i ‚àà insert a s, (g i ‚Ä¢ (i : G ‚Üí L))) y := by simp [Finset.mul_sum]
      _ = 0 := by rw [hg]; simp
  -- On the other hand, since `a` is not already in `s`, for any character `i ‚àà s`
  -- there is some element of the monoid on which it differs from `a`.
  have h2 (i) (his : i ‚àà s) : ‚àÉ y, i y ‚â† a y := by
    by_contra! hia
    obtain rfl : i = a := MonoidHom.ext hia
    contradiction
  -- From these two facts we deduce that `g` actually vanishes on `s`,
  have h3 (i) (his : i ‚àà s) : g i = 0 := by
    let ‚ü®y, hy‚ü© := h2 i his
    have h : g i ‚Ä¢ i y = g i ‚Ä¢ a y := congr_fun (h1 i his) y
    rw [‚Üê sub_eq_zero, ‚Üê smul_sub, smul_eq_zero] at h
    exact h.resolve_right (sub_ne_zero_of_ne hy)
  -- And so, using the fact that the linear combination over `s` and over `insert a s` both
  -- vanish, we deduce that `g a = 0`.
  have h4 : g a = 0 :=
    calc
      g a = g a * 1 := (mul_one _).symm
      _ = (g a ‚Ä¢ a : G ‚Üí L) 1 := by rw [‚Üê a.map_one]; rfl
      _ = (‚àë i ‚àà insert a s, g i ‚Ä¢ i : G ‚Üí L) 1 := by
        rw [Finset.sum_insert has, Finset.sum_eq_zero, add_zero]
        simp +contextual [h3]
      _ = 0 := by rw [hg]; rfl
  -- Now we're done; the last two facts together imply that `g` vanishes on every element
  -- of `insert a s`.
  exact (Finset.forall_mem_insert ..).2 ‚ü®h4, h3‚ü©
",Formal Proof of Stacks Project Tag 0CKL,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/LinearAlgebra/LinearIndependent/Basic.lean#L486-L548,Q27041,,9.13.1,lemma,3.0,"['0CKK', '09FA', '0ELQ']","\n  Lemma 9.13.1. Let $L$ be a field. Let $G$ be a monoid, for example a group. Let $\\chi _1, \\ldots , \\chi _ n : G \\to L$ be pairwise distinct homomorphisms of monoids where $L$ is regarded as a monoid by multiplication. Then $\\chi _1, \\ldots , \\chi _ n$ are $L$-linearly independent: if $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero, then $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$. \n\n    \n      Proof.\n      If $n = 1$ this is true because $\\chi _1(e) = 1$ if $e \\in G$ is the neutral (identity) element. We prove the result by induction for $n > 1$. Suppose that $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero. If $\\lambda _ i = 0$ for some, then we win by induction on $n$. Since we want to show that $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$ we may after dividing by $-\\lambda _ n$ assume that $\\lambda _ n = -1$. Then the only way we get in trouble is if \n    \n      \n  \\[  \\chi _ n(g) = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Fix $h \\in G$. Then we would also get \n    \n      \n  \\begin{align*}  \\chi _ n(h)\\chi _ n(g) &  = \\chi _ n(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(h) \\chi _ i(g) \\end{align*}\n\n    \n       Multiplying the previous relation by $\\chi _ n(h)$ and subtracting we obtain \n    \n      \n  \\[  0 = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i (\\chi _ n(h) - \\chi _ i(h)) \\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Since $\\lambda _ i \\not= 0$ we conclude that $\\chi _ n(h) = \\chi _ i(h)$ for all $i$ by induction. The choice of $h$ above was arbitrary, so we conclude that $\\chi _ i = \\chi _ n$ for $i \\leq n - 1$ which contradicts the assumption that our characters $\\chi _ i$ are pairwise distinct. \n      $\\square$\n    \n","\n  Lemma 9.13.1. Let $L$ be a field. Let $G$ be a monoid, for example a group. Let $\\chi _1, \\ldots , \\chi _ n : G \\to L$ be pairwise distinct homomorphisms of monoids where $L$ is regarded as a monoid by multiplication. Then $\\chi _1, \\ldots , \\chi _ n$ are $L$-linearly independent: if $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero, then $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$. \n\n    \n","Proof.\n      If $n = 1$ this is true because $\\chi _1(e) = 1$ if $e \\in G$ is the neutral (identity) element. We prove the result by induction for $n > 1$. Suppose that $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero. If $\\lambda _ i = 0$ for some, then we win by induction on $n$. Since we want to show that $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$ we may after dividing by $-\\lambda _ n$ assume that $\\lambda _ n = -1$. Then the only way we get in trouble is if \n    \n      \n  \\[  \\chi _ n(g) = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Fix $h \\in G$. Then we would also get \n    \n      \n  \\begin{align*}  \\chi _ n(h)\\chi _ n(g) &  = \\chi _ n(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(h) \\chi _ i(g) \\end{align*}\n\n    \n       Multiplying the previous relation by $\\chi _ n(h)$ and subtracting we obtain \n    \n      \n  \\[  0 = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i (\\chi _ n(h) - \\chi _ i(h)) \\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Since $\\lambda _ i \\not= 0$ we conclude that $\\chi _ n(h) = \\chi _ i(h)$ for all $i$ by induction. The choice of $h$ above was arbitrary, so we conclude that $\\chi _ i = \\chi _ n$ for $i \\leq n - 1$ which contradicts the assumption that our characters $\\chi _ i$ are pairwise distinct. \n      $\\square$\n    \n"," G ‚Üí L) (fun f => f : (G ‚Üí* L) ‚Üí G ‚Üí L) := by
  letI := Classical.decEq (G ‚Üí* L)
  letI : MulAction L L := DistribMulAction.toMulAction
  -- We prove linear independence by showing that only the trivial linear combination vanishes.
  apply linearIndependent_iff'.2
  intro s
  induction s using Finset.induction_on with
  | empty => simp
  | insert a s has ih =>
  intro g hg
  -- Here
  -- * `a` is a new character we will insert into the `Finset` of characters `s`,
  -- * `ih` is the fact that only the trivial linear combination of characters in `s` is zero
  -- * `hg` is the fact that `g` are the coefficients of a linear combination summing to zero
  -- and it remains to prove that `g` vanishes on `insert a s`.
  -- We now make the key calculation:
  -- For any character `i` in the original `Finset`, we have `g i ‚Ä¢ i = g i ‚Ä¢ a` as functions
  -- on the monoid `G`.
  have h1 (i) (his : i ‚àà s) : (g i ‚Ä¢ i : G ‚Üí L) = g i ‚Ä¢ a := by
    ext x
    rw [‚Üê sub_eq_zero]
    apply ih (fun j => g j * j x - g j * a x) _ i his
    ext y
    -- After that, it's just a chase scene.
    calc
      (‚àë i ‚àà s, (g i * i x - g i * a x) ‚Ä¢ i : G ‚Üí L) y =
          (‚àë i ‚àà s, g i * i x * i y) - ‚àë i ‚àà s, g i * a x * i y := by simp [sub_mul]
      _ = (‚àë i ‚àà insert a s, g i * i x * i y) -
            ‚àë i ‚àà insert a s, g i * a x * i y := by simp [Finset.sum_insert has]
      _ = (‚àë i ‚àà insert a s, g i * (i x * i y)) -
            ‚àë i ‚àà insert a s, a x * (g i * i y) := by
        congrm ‚àë i ‚àà insert a s, ?_ - ‚àë i ‚àà insert a s, ?_
        ¬∑ rw [mul_assoc]
        ¬∑ rw [mul_assoc, mul_left_comm]
      _ = (‚àë i ‚àà insert a s, g i ‚Ä¢ i : G ‚Üí L) (x * y) -
            a x * (‚àë i ‚àà insert a s, (g i ‚Ä¢ (i : G ‚Üí L))) y := by simp [Finset.mul_sum]
      _ = 0 := by rw [hg]; simp
  -- On the other hand, since `a` is not already in `s`, for any character `i ‚àà s`
  -- there is some element of the monoid on which it differs from `a`.
  have h2 (i) (his : i ‚àà s) : ‚àÉ y, i y ‚â† a y := by
    by_contra! hia
    obtain rfl : i = a := MonoidHom.ext hia
    contradiction
  -- From these two facts we deduce that `g` actually vanishes on `s`,
  have h3 (i) (his : i ‚àà s) : g i = 0 := by
    let ‚ü®y, hy‚ü© := h2 i his
    have h : g i ‚Ä¢ i y = g i ‚Ä¢ a y := congr_fun (h1 i his) y
    rw [‚Üê sub_eq_zero, ‚Üê smul_sub, smul_eq_zero] at h
    exact h.resolve_right (sub_ne_zero_of_ne hy)
  -- And so, using the fact that the linear combination over `s` and over `insert a s` both
  -- vanish, we deduce that `g a = 0`.
  have h4 : g a = 0 :=
    calc
      g a = g a * 1 := (mul_one _).symm
      _ = (g a ‚Ä¢ a : G ‚Üí L) 1 := by rw [‚Üê a.map_one]; rfl
      _ = (‚àë i ‚àà insert a s, g i ‚Ä¢ i : G ‚Üí L) 1 := by
        rw [Finset.sum_insert has, Finset.sum_eq_zero, add_zero]
        simp +contextual [h3]
      _ = 0 := by rw [hg]; rfl
  -- Now we're done; the last two facts together imply that `g` vanishes on every element
  -- of `insert a s`.
  exact (Finset.forall_mem_insert ..).2 ‚ü®h4, h3‚ü©
","theorem linearIndependent_monoidHom (G : Type*) [MulOneClass G] (L : Type*) [CommRing L]
    [IsDomain L] : LinearIndependent L (M ","Proof.\n      If $n = 1$ this is true because $\\chi _1(e) = 1$ if $e \\in G$ is the neutral (identity) element. We prove the result by induction for $n > 1$. Suppose that $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero. If $\\lambda _ i = 0$ for some, then we win by induction on $n$. Since we want to show that $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$ we may after dividing by $-\\lambda _ n$ assume that $\\lambda _ n = -1$. Then the only way we get in trouble is if \n    \n      \n  \\[  \\chi _ n(g) = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Fix $h \\in G$. Then we would also get \n    \n      \n  \\begin{align*}  \\chi _ n(h)\\chi _ n(g) &  = \\chi _ n(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(h) \\chi _ i(g) \\end{align*}\n\n    \n       Multiplying the previous relation by $\\chi _ n(h)$ and subtracting we obtain \n    \n      \n  \\[  0 = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i (\\chi _ n(h) - \\chi _ i(h)) \\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Since $\\lambda _ i \\not= 0$ we conclude that $\\chi _ n(h) = \\chi _ i(h)$ for all $i$ by induction. The choice of $h$ above was arbitrary, so we conclude that $\\chi _ i = \\chi _ n$ for $i \\leq n - 1$ which contradicts the assumption that our characters $\\chi _ i$ are pairwise distinct. \n      $\\square$\n    \n","Proof.\n      If $n = 1$ this is true because $\\chi _1(e) = 1$ if $e \\in G$ is the neutral (identity) element. We prove the result by induction for $n > 1$. Suppose that $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero. If $\\lambda _ i = 0$ for some, then we win by induction on $n$. Since we want to show that $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$ we may after dividing by $-\\lambda _ n$ assume that $\\lambda _ n = -1$. Then the only way we get in trouble is if \n    \n      \n  \\[  \\chi _ n(g) = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Fix $h \\in G$. Then we would also get \n    \n      \n  \\begin{align*}  \\chi _ n(h)\\chi _ n(g) &  = \\chi _ n(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(hg) \\\\ &  = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i\\chi _ i(h) \\chi _ i(g) \\end{align*}\n\n    \n       Multiplying the previous relation by $\\chi _ n(h)$ and subtracting we obtain \n    \n      \n  \\[  0 = \\sum \\nolimits _{i = 1, \\ldots , n - 1} \\lambda _ i (\\chi _ n(h) - \\chi _ i(h)) \\chi _ i(g)  \\]\n\n    \n       for all $g \\in G$. Since $\\lambda _ i \\not= 0$ we conclude that $\\chi _ n(h) = \\chi _ i(h)$ for all $i$ by induction. The choice of $h$ above was arbitrary, so we conclude that $\\chi _ i = \\chi _ n$ for $i \\leq n - 1$ which contradicts the assumption that our characters $\\chi _ i$ are pairwise distinct. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish linear independence of distinct characters (monoid homs into a field/ring) by induction on a finite set/list and show that a vanishing linear combination forces all coefficients to be zero. The formal proof uses `linearIndependent_iff'` and Finset induction, matching the informal induction on n.\n\nStructurally, the key step corresponds: the informal proof assumes a relation expressing one character as a linear combination of the others, then evaluates at products (hg) and subtracts to get a new relation with modified coefficients involving differences of character values, and applies the induction hypothesis to conclude coefficients vanish unless characters coincide. The formal proof mirrors this via the construction `fun j => g j * j x - g j * a x` (analog of multiplying by œá_n(h) and subtracting) and applies `ih` to deduce an equality of functions `g i ‚Ä¢ i = g i ‚Ä¢ a`, then uses existence of a point where `i y ‚â† a y` (pairwise distinct) to force `g i = 0`.\n\nDifferences: the informal proof normalizes coefficients (divide by ‚àíŒª_n, set Œª_n = ‚àí1) and argues via ‚Äúnot all zero‚Äù and contradiction, while the formal proof directly proves all coefficients are zero from the vanishing sum without normalization. Also, the informal proof explicitly uses Œª_i ‚â† 0 to conclude œá_n(h)=œá_i(h), whereas the formal proof instead derives g i = 0 using a pointwise inequality. These are equivalent routes, but not identical in presentation. Overall the main idea and induction/subtraction trick align well, with some divergence in coefficient-handling details.""}"
219,0CKM,"lemma linearIndependent_algHom_toLinearMap
    (K M L) [CommSemiring K] [Semiring M] [Algebra K M] [CommRing L] [IsDomain L] [Algebra K L] :
    LinearIndependent L (AlgHom.toLinearMap : (M ‚Üí‚Çê[K] L) ‚Üí M ‚Üí‚Çó[K] L) := by
  apply LinearIndependent.of_comp (LinearMap.ltoFun K M L L)
  exact (linearIndependent_monoidHom M L).comp
    (RingHom.toMonoidHom ‚àò AlgHom.toRingHom)
    (fun _ _ e ‚Ü¶ AlgHom.ext (DFunLike.congr_fun e :))
",Formal Proof of Stacks Project Tag 0CKM,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/LinearAlgebra/LinearIndependent/Lemmas.lean#L469-L475,Q27041,,9.13.3,lemma,3.0,"['0CKK', '09FA', '0ELQ']","\n  Lemma 9.13.3. Let $K/F$ and $L/F$ be field extensions. Let $\\sigma _1, \\ldots , \\sigma _ n : K \\to L$ be pairwise distinct morphisms of $F$-extensions. Then $\\sigma _1, \\ldots , \\sigma _ n$ are $L$-linearly independent: if $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero, then $\\sum \\lambda _ i\\sigma _ i(\\alpha ) \\not= 0$ for some $\\alpha \\in K$. \n\n    \n      Proof.\n      Apply Lemma 9.13.1 to the restrictions of $\\sigma _ i$ to the groups of units. \n      $\\square$\n    \n","\n  Lemma 9.13.3. Let $K/F$ and $L/F$ be field extensions. Let $\\sigma _1, \\ldots , \\sigma _ n : K \\to L$ be pairwise distinct morphisms of $F$-extensions. Then $\\sigma _1, \\ldots , \\sigma _ n$ are $L$-linearly independent: if $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero, then $\\sum \\lambda _ i\\sigma _ i(\\alpha ) \\not= 0$ for some $\\alpha \\in K$. \n\n    \n",Proof.\n      Apply Lemma 9.13.1 to the restrictions of $\\sigma _ i$ to the groups of units. \n      $\\square$\n    \n," by
  apply LinearIndependent.of_comp (LinearMap.ltoFun K M L L)
  exact (linearIndependent_monoidHom M L).comp
    (RingHom.toMonoidHom ‚àò AlgHom.toRingHom)
    (fun _ _ e ‚Ü¶ AlgHom.ext (DFunLike.congr_fun e :))
","lemma linearIndependent_algHom_toLinearMap
    (K M L) [CommSemiring K] [Semiring M] [Algebra K M] [CommRing L] [IsDomain L] [Algebra K L] :
    LinearIndependent L (AlgHom.toLinearMap : (M ‚Üí‚Çê[K] L) ‚Üí M ‚Üí‚Çó[K] L) ","Proof.\n      Apply Lemma 9.13.1 [[\n  Lemma 9.13.1. Let $L$ be a field. Let $G$ be a monoid, for example a group. Let $\\chi _1, \\ldots , \\chi _ n : G \\to L$ be pairwise distinct homomorphisms of monoids where $L$ is regarded as a monoid by multiplication. Then $\\chi _1, \\ldots , \\chi _ n$ are $L$-linearly independent: if $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero, then $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$. \n\n    \n]] to the restrictions of $\\sigma _ i$ to the groups of units. \n      $\\square$\n    \n","Proof.\n      Apply Lemma 9.13.1 [[\n  Lemma 9.13.1. Let $L$ be a field. Let $G$ be a monoid, for example a group. Let $\\chi _1, \\ldots , \\chi _ n : G \\to L$ be pairwise distinct homomorphisms of monoids where $L$ is regarded as a monoid by multiplication. Then $\\chi _1, \\ldots , \\chi _ n$ are $L$-linearly independent: if $\\lambda _1, \\ldots , \\lambda _ n \\in L$ not all zero, then $\\sum \\lambda _ i\\chi _ i(g) \\not= 0$ for some $g \\in G$. \n\n    \n]] to the restrictions of $\\sigma _ i$ to the groups of units. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the formal proof is proving linear independence by reducing to a known lemma about linear independence of (distinct) monoid homomorphisms into a field, via composition: it uses `linearIndependent_monoidHom M L` and then composes along `AlgHom.toRingHom`/`RingHom.toMonoidHom`, matching the informal idea of applying a lemma like 9.13.1 about distinct monoid homomorphisms being linearly independent. Structurally, both proofs are a one-step reduction: ‚Äúapply the lemma to suitable restrictions/underlying monoid maps.‚Äù The Lean proof implements this through `LinearIndependent.of_comp` and an extensionality argument (`AlgHom.ext`) to handle equality after composition, which corresponds to ensuring distinctness is preserved. The main mismatch is that the informal proof explicitly mentions restricting the œÉ_i to the group of units, while the Lean code instead composes with `LinearMap.ltoFun` and coercions from `AlgHom` to monoid homs; the restriction-to-units step is not visibly present, so the correspondence is not perfect.""}"
223,0561,"theorem of_restrict_scalars_finitePresentation [Algebra A B] [IsScalarTower R A B]
    [FinitePresentation.{w‚ÇÅ, w‚ÇÉ} R B] [FiniteType R A] :
    FinitePresentation.{w‚ÇÇ, w‚ÇÉ} A B := by
  classical
  obtain ‚ü®n, f, hf, s, hs‚ü© := FinitePresentation.out (R := R) (A := B)
  letI RX := MvPolynomial (Fin n) R
  letI AX := MvPolynomial (Fin n) A
  refine ‚ü®n, MvPolynomial.aeval (f ‚àò X), ?_, ?_‚ü©
  ¬∑ rw [‚Üê AlgHom.range_eq_top, ‚Üê Algebra.adjoin_range_eq_range_aeval,
      Set.range_comp f MvPolynomial.X, eq_top_iff, ‚Üê @adjoin_adjoin_of_tower R A B,
      adjoin_image, adjoin_range_X, Algebra.map_top, (AlgHom.range_eq_top _).mpr hf]
    exact fun {x} => subset_adjoin ‚ü®‚ü©
  ¬∑ obtain ‚ü®t, ht‚ü© := FiniteType.out (R := R) (A := A)
    have := fun i : t => hf (algebraMap A B i)
    choose t' ht' using this
    have ht'' : Algebra.adjoin R (algebraMap A AX '' t ‚à™ Set.range (X : _ ‚Üí AX)) = ‚ä§ := by
      rw [adjoin_union_eq_adjoin_adjoin, ‚Üê Subalgebra.restrictScalars_top R (A := AX)
        (S := { x // x ‚àà adjoin R ((algebraMap A AX) '' t) })]
      refine congrArg (Subalgebra.restrictScalars R) ?_
      rw [adjoin_algebraMap, ht]
      apply Subalgebra.restrictScalars_injective R
      rw [‚Üê adjoin_restrictScalars, adjoin_range_X, Subalgebra.restrictScalars_top,
        Subalgebra.restrictScalars_top]
    letI g : t ‚Üí AX := fun x => MvPolynomial.C (x : A) - map (algebraMap R A) (t' x)
    refine ‚ü®s.image (map (algebraMap R A)) ‚à™ t.attach.image g, ?_‚ü©
    rw [Finset.coe_union, Finset.coe_image, Finset.coe_image, Finset.attach_eq_univ,
      Finset.coe_univ, Set.image_univ]
    let s‚ÇÄ := (MvPolynomial.map (algebraMap R A)) '' s ‚à™ Set.range g
    let I := RingHom.ker (MvPolynomial.aeval (R := A) (f ‚àò MvPolynomial.X))
    change Ideal.span s‚ÇÄ = I
    have leI : Ideal.span ((MvPolynomial.map (algebraMap R A)) '' s ‚à™ Set.range g) ‚â§
      RingHom.ker (MvPolynomial.aeval (R := A) (f ‚àò MvPolynomial.X)) := by
      rw [Ideal.span_le]
      rintro _ (‚ü®x, hx, rfl‚ü© | ‚ü®‚ü®x, hx‚ü©, rfl‚ü©) <;>
      rw [SetLike.mem_coe, RingHom.mem_ker]
      ¬∑ rw [MvPolynomial.aeval_map_algebraMap (R := R) (A := A), ‚Üê aeval_unique]
        have := Ideal.subset_span hx
        rwa [hs] at this
      ¬∑ rw [map_sub, MvPolynomial.aeval_map_algebraMap, ‚Üê aeval_unique,
          MvPolynomial.aeval_C, ht', Subtype.coe_mk, sub_self]
    apply leI.antisymm
    intro x hx
    rw [RingHom.mem_ker] at hx
    let s‚ÇÄ := (MvPolynomial.map (algebraMap R A)) '' ‚Üës ‚à™ Set.range g
    change x ‚àà Ideal.span s‚ÇÄ
    have : x ‚àà (MvPolynomial.map (algebraMap R A) : _ ‚Üí+* AX).range.toAddSubmonoid ‚äî
      (Ideal.span s‚ÇÄ).toAddSubmonoid := by
      have : x ‚àà (‚ä§ : Subalgebra R AX) := trivial
      rw [‚Üê ht''] at this
      refine adjoin_induction ?_ ?_ ?_ ?_ this
      ¬∑ rintro _ (‚ü®x, hx, rfl‚ü© | ‚ü®i, rfl‚ü©)
        ¬∑ rw [MvPolynomial.algebraMap_eq, ‚Üê sub_add_cancel (MvPolynomial.C x)
            (map (algebraMap R A) (t' ‚ü®x, hx‚ü©)), add_comm]
          apply AddSubmonoid.add_mem_sup
          ¬∑ exact Set.mem_range_self _
          ¬∑ apply Ideal.subset_span
            apply Set.mem_union_right
            exact Set.mem_range_self _
        ¬∑ apply AddSubmonoid.mem_sup_left
          exact ‚ü®X i, map_X _ _‚ü©
      ¬∑ intro r
        apply AddSubmonoid.mem_sup_left
        exact ‚ü®C r, map_C _ _‚ü©
      ¬∑ intro _ _ _ _ h‚ÇÅ h‚ÇÇ
        exact add_mem h‚ÇÅ h‚ÇÇ
      ¬∑ intro x‚ÇÅ x‚ÇÇ _ _ h‚ÇÅ h‚ÇÇ
        obtain ‚ü®_, ‚ü®p‚ÇÅ, rfl‚ü©, q‚ÇÅ, hq‚ÇÅ, rfl‚ü© := AddSubmonoid.mem_sup.mp h‚ÇÅ
        obtain ‚ü®_, ‚ü®p‚ÇÇ, rfl‚ü©, q‚ÇÇ, hq‚ÇÇ, rfl‚ü© := AddSubmonoid.mem_sup.mp h‚ÇÇ
        rw [add_mul, mul_add, add_assoc, ‚Üê map_mul]
        apply AddSubmonoid.add_mem_sup
        ¬∑ exact Set.mem_range_self _
        ¬∑ refine add_mem (Ideal.mul_mem_left _ _ hq‚ÇÇ) (Ideal.mul_mem_right _ _ hq‚ÇÅ)
    obtain ‚ü®_, ‚ü®p, rfl‚ü©, q, hq, rfl‚ü© := AddSubmonoid.mem_sup.mp this
    rw [map_add, aeval_map_algebraMap, ‚Üê aeval_unique, show MvPolynomial.aeval (f ‚àò X) q = 0
      from leI hq, add_zero] at hx
    suffices Ideal.span (s : Set RX) ‚â§ (Ideal.span s‚ÇÄ).comap (MvPolynomial.map <| algebraMap R A) by
      refine add_mem ?_ hq
      rw [hs] at this
      exact this hx
    rw [Ideal.span_le]
    intro x hx
    apply Ideal.subset_span
    apply Set.mem_union_left
    exact Set.mem_image_of_mem _ hx
",Formal Proof of Stacks Project Tag 0561,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/FinitePresentation.lean#L210-L293,Q27041,,10.6.4,lemma,3.0,"['00F2', '00AO', '0ELQ']","\n  Lemma 10.6.4. Let $R \\to S$ be a ring map. Let $M$ be an $S$-module. Assume $R \\to S$ is of finite type and $M$ is finitely presented as an $R$-module. Then $M$ is finitely presented as an $S$-module. \n\n    \n      Proof.\n      This is similar to the proof of part (4) of Lemma 10.6.2. We may assume $S = R[x_1, \\ldots , x_ n]/J$. Choose $y_1, \\ldots , y_ m \\in M$ which generate $M$ as an $R$-module and choose relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ which generate the kernel of $R^{\\oplus m} \\to M$. For any $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$ write \n    \n      \n  \\[  x_ i y_ j = \\sum a_{ijk} y_ k  \\]\n\n    \n       for some $a_{ijk} \\in R$. Consider the $S$-module $N$ generated by $y_1, \\ldots , y_ m$ subject to the relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ and $x_ i y_ j = \\sum a_{ijk} y_ k$, $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$. Then $N$ has a presentation \n    \n      \n  \\[  S^{\\oplus nm + t} \\longrightarrow S^{\\oplus m} \\longrightarrow N \\longrightarrow 0  \\]\n\n    \n       By construction there is a surjective map $\\varphi : N \\to M$. To finish the proof we show $\\varphi $ is injective. Suppose $z = \\sum b_ j y_ j \\in N$ for some $b_ j \\in S$. We may think of $b_ j$ as a polynomial in $x_1, \\ldots , x_ n$ with coefficients in $R$. By applying the relations of the form $x_ i y_ j = \\sum a_{ijk} y_ k$ we can inductively lower the degree of the polynomials. Hence we see that $z = \\sum c_ j y_ j$ for some $c_ j \\in R$. Hence if $\\varphi (z) = 0$ then the vector $(c_1, \\ldots , c_ m)$ is an $R$-linear combination of the vectors $(a_{i1}, \\ldots , a_{im})$ and we conclude that $z = 0$ as desired. \n      $\\square$\n    \n",\n  Lemma 10.6.4. Let $R \\to S$ be a ring map. Let $M$ be an $S$-module. Assume $R \\to S$ is of finite type and $M$ is finitely presented as an $R$-module. Then $M$ is finitely presented as an $S$-module. \n\n    \n,"Proof.\n      This is similar to the proof of part (4) of Lemma 10.6.2. We may assume $S = R[x_1, \\ldots , x_ n]/J$. Choose $y_1, \\ldots , y_ m \\in M$ which generate $M$ as an $R$-module and choose relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ which generate the kernel of $R^{\\oplus m} \\to M$. For any $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$ write \n    \n      \n  \\[  x_ i y_ j = \\sum a_{ijk} y_ k  \\]\n\n    \n       for some $a_{ijk} \\in R$. Consider the $S$-module $N$ generated by $y_1, \\ldots , y_ m$ subject to the relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ and $x_ i y_ j = \\sum a_{ijk} y_ k$, $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$. Then $N$ has a presentation \n    \n      \n  \\[  S^{\\oplus nm + t} \\longrightarrow S^{\\oplus m} \\longrightarrow N \\longrightarrow 0  \\]\n\n    \n       By construction there is a surjective map $\\varphi : N \\to M$. To finish the proof we show $\\varphi $ is injective. Suppose $z = \\sum b_ j y_ j \\in N$ for some $b_ j \\in S$. We may think of $b_ j$ as a polynomial in $x_1, \\ldots , x_ n$ with coefficients in $R$. By applying the relations of the form $x_ i y_ j = \\sum a_{ijk} y_ k$ we can inductively lower the degree of the polynomials. Hence we see that $z = \\sum c_ j y_ j$ for some $c_ j \\in R$. Hence if $\\varphi (z) = 0$ then the vector $(c_1, \\ldots , c_ m)$ is an $R$-linear combination of the vectors $(a_{i1}, \\ldots , a_{im})$ and we conclude that $z = 0$ as desired. \n      $\\square$\n    \n"," by
  classical
  obtain ‚ü®n, f, hf, s, hs‚ü© := FinitePresentation.out (R := R) (A := B)
  letI RX := MvPolynomial (Fin n) R
  letI AX := MvPolynomial (Fin n) A
  refine ‚ü®n, MvPolynomial.aeval (f ‚àò X), ?_, ?_‚ü©
  ¬∑ rw [‚Üê AlgHom.range_eq_top, ‚Üê Algebra.adjoin_range_eq_range_aeval,
      Set.range_comp f MvPolynomial.X, eq_top_iff, ‚Üê @adjoin_adjoin_of_tower R A B,
      adjoin_image, adjoin_range_X, Algebra.map_top, (AlgHom.range_eq_top _).mpr hf]
    exact fun {x} => subset_adjoin ‚ü®‚ü©
  ¬∑ obtain ‚ü®t, ht‚ü© := FiniteType.out (R := R) (A := A)
    have := fun i : t => hf (algebraMap A B i)
    choose t' ht' using this
    have ht'' : Algebra.adjoin R (algebraMap A AX '' t ‚à™ Set.range (X : _ ‚Üí AX)) = ‚ä§ := by
      rw [adjoin_union_eq_adjoin_adjoin, ‚Üê Subalgebra.restrictScalars_top R (A := AX)
        (S := { x // x ‚àà adjoin R ((algebraMap A AX) '' t) })]
      refine congrArg (Subalgebra.restrictScalars R) ?_
      rw [adjoin_algebraMap, ht]
      apply Subalgebra.restrictScalars_injective R
      rw [‚Üê adjoin_restrictScalars, adjoin_range_X, Subalgebra.restrictScalars_top,
        Subalgebra.restrictScalars_top]
    letI g : t ‚Üí AX := fun x => MvPolynomial.C (x : A) - map (algebraMap R A) (t' x)
    refine ‚ü®s.image (map (algebraMap R A)) ‚à™ t.attach.image g, ?_‚ü©
    rw [Finset.coe_union, Finset.coe_image, Finset.coe_image, Finset.attach_eq_univ,
      Finset.coe_univ, Set.image_univ]
    let s‚ÇÄ := (MvPolynomial.map (algebraMap R A)) '' s ‚à™ Set.range g
    let I := RingHom.ker (MvPolynomial.aeval (R := A) (f ‚àò MvPolynomial.X))
    change Ideal.span s‚ÇÄ = I
    have leI : Ideal.span ((MvPolynomial.map (algebraMap R A)) '' s ‚à™ Set.range g) ‚â§
      RingHom.ker (MvPolynomial.aeval (R := A) (f ‚àò MvPolynomial.X)) := by
      rw [Ideal.span_le]
      rintro _ (‚ü®x, hx, rfl‚ü© | ‚ü®‚ü®x, hx‚ü©, rfl‚ü©) <;>
      rw [SetLike.mem_coe, RingHom.mem_ker]
      ¬∑ rw [MvPolynomial.aeval_map_algebraMap (R := R) (A := A), ‚Üê aeval_unique]
        have := Ideal.subset_span hx
        rwa [hs] at this
      ¬∑ rw [map_sub, MvPolynomial.aeval_map_algebraMap, ‚Üê aeval_unique,
          MvPolynomial.aeval_C, ht', Subtype.coe_mk, sub_self]
    apply leI.antisymm
    intro x hx
    rw [RingHom.mem_ker] at hx
    let s‚ÇÄ := (MvPolynomial.map (algebraMap R A)) '' ‚Üës ‚à™ Set.range g
    change x ‚àà Ideal.span s‚ÇÄ
    have : x ‚àà (MvPolynomial.map (algebraMap R A) : _ ‚Üí+* AX).range.toAddSubmonoid ‚äî
      (Ideal.span s‚ÇÄ).toAddSubmonoid := by
      have : x ‚àà (‚ä§ : Subalgebra R AX) := trivial
      rw [‚Üê ht''] at this
      refine adjoin_induction ?_ ?_ ?_ ?_ this
      ¬∑ rintro _ (‚ü®x, hx, rfl‚ü© | ‚ü®i, rfl‚ü©)
        ¬∑ rw [MvPolynomial.algebraMap_eq, ‚Üê sub_add_cancel (MvPolynomial.C x)
            (map (algebraMap R A) (t' ‚ü®x, hx‚ü©)), add_comm]
          apply AddSubmonoid.add_mem_sup
          ¬∑ exact Set.mem_range_self _
          ¬∑ apply Ideal.subset_span
            apply Set.mem_union_right
            exact Set.mem_range_self _
        ¬∑ apply AddSubmonoid.mem_sup_left
          exact ‚ü®X i, map_X _ _‚ü©
      ¬∑ intro r
        apply AddSubmonoid.mem_sup_left
        exact ‚ü®C r, map_C _ _‚ü©
      ¬∑ intro _ _ _ _ h‚ÇÅ h‚ÇÇ
        exact add_mem h‚ÇÅ h‚ÇÇ
      ¬∑ intro x‚ÇÅ x‚ÇÇ _ _ h‚ÇÅ h‚ÇÇ
        obtain ‚ü®_, ‚ü®p‚ÇÅ, rfl‚ü©, q‚ÇÅ, hq‚ÇÅ, rfl‚ü© := AddSubmonoid.mem_sup.mp h‚ÇÅ
        obtain ‚ü®_, ‚ü®p‚ÇÇ, rfl‚ü©, q‚ÇÇ, hq‚ÇÇ, rfl‚ü© := AddSubmonoid.mem_sup.mp h‚ÇÇ
        rw [add_mul, mul_add, add_assoc, ‚Üê map_mul]
        apply AddSubmonoid.add_mem_sup
        ¬∑ exact Set.mem_range_self _
        ¬∑ refine add_mem (Ideal.mul_mem_left _ _ hq‚ÇÇ) (Ideal.mul_mem_right _ _ hq‚ÇÅ)
    obtain ‚ü®_, ‚ü®p, rfl‚ü©, q, hq, rfl‚ü© := AddSubmonoid.mem_sup.mp this
    rw [map_add, aeval_map_algebraMap, ‚Üê aeval_unique, show MvPolynomial.aeval (f ‚àò X) q = 0
      from leI hq, add_zero] at hx
    suffices Ideal.span (s : Set RX) ‚â§ (Ideal.span s‚ÇÄ).comap (MvPolynomial.map <| algebraMap R A) by
      refine add_mem ?_ hq
      rw [hs] at this
      exact this hx
    rw [Ideal.span_le]
    intro x hx
    apply Ideal.subset_span
    apply Set.mem_union_left
    exact Set.mem_image_of_mem _ hx
","theorem of_restrict_scalars_finitePresentation [Algebra A B] [IsScalarTower R A B]
    [FinitePresentation.{w‚ÇÅ, w‚ÇÉ} R B] [FiniteType R A] :
    FinitePresentation.{w‚ÇÇ, w‚ÇÉ} A B ","Proof.\n      This is similar to the proof of part (4) of Lemma 10.6.2 [[\n  Lemma 10.6.2. The notions finite type and finite presentation have the following permanence properties. \n  \n  \nA composition of ring maps of finite type is of finite type. \n\n\nA composition of ring maps of finite presentation is of finite presentation. \n\n\nGiven $R \\to S\' \\to S$ with $R \\to S$ of finite type, then $S\' \\to S$ is of finite type. \n\n\nGiven $R \\to S\' \\to S$, with $R \\to S$ of finite presentation, and $R \\to S\'$ of finite type, then $S\' \\to S$ is of finite presentation. \n\n\n\n\n    \n]]. We may assume $S = R[x_1, \\ldots , x_ n]/J$. Choose $y_1, \\ldots , y_ m \\in M$ which generate $M$ as an $R$-module and choose relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ which generate the kernel of $R^{\\oplus m} \\to M$. For any $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$ write \n    \n      \n  \\[  x_ i y_ j = \\sum a_{ijk} y_ k  \\]\n\n    \n       for some $a_{ijk} \\in R$. Consider the $S$-module $N$ generated by $y_1, \\ldots , y_ m$ subject to the relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ and $x_ i y_ j = \\sum a_{ijk} y_ k$, $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$. Then $N$ has a presentation \n    \n      \n  \\[  S^{\\oplus nm + t} \\longrightarrow S^{\\oplus m} \\longrightarrow N \\longrightarrow 0  \\]\n\n    \n       By construction there is a surjective map $\\varphi : N \\to M$. To finish the proof we show $\\varphi $ is injective. Suppose $z = \\sum b_ j y_ j \\in N$ for some $b_ j \\in S$. We may think of $b_ j$ as a polynomial in $x_1, \\ldots , x_ n$ with coefficients in $R$. By applying the relations of the form $x_ i y_ j = \\sum a_{ijk} y_ k$ we can inductively lower the degree of the polynomials. Hence we see that $z = \\sum c_ j y_ j$ for some $c_ j \\in R$. Hence if $\\varphi (z) = 0$ then the vector $(c_1, \\ldots , c_ m)$ is an $R$-linear combination of the vectors $(a_{i1}, \\ldots , a_{im})$ and we conclude that $z = 0$ as desired. \n      $\\square$\n    \n","Proof.\n      This is similar to the proof of part (4) of Lemma 10.6.2 [[\n  Lemma 10.6.2. The notions finite type and finite presentation have the following permanence properties. \n  \n  \nA composition of ring maps of finite type is of finite type. \n\n\nA composition of ring maps of finite presentation is of finite presentation. \n\n\nGiven $R \\to S\' \\to S$ with $R \\to S$ of finite type, then $S\' \\to S$ is of finite type. \n\n\nGiven $R \\to S\' \\to S$, with $R \\to S$ of finite presentation, and $R \\to S\'$ of finite type, then $S\' \\to S$ is of finite presentation. \n\n\n\n\n    \n]]. We may assume $S = R[x_1, \\ldots , x_ n]/J$. Choose $y_1, \\ldots , y_ m \\in M$ which generate $M$ as an $R$-module and choose relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ which generate the kernel of $R^{\\oplus m} \\to M$. For any $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$ write \n    \n      \n  \\[  x_ i y_ j = \\sum a_{ijk} y_ k  \\]\n\n    \n       for some $a_{ijk} \\in R$. Consider the $S$-module $N$ generated by $y_1, \\ldots , y_ m$ subject to the relations $\\sum a_{ij} y_ j = 0$, $i = 1, \\ldots , t$ and $x_ i y_ j = \\sum a_{ijk} y_ k$, $i = 1, \\ldots , n$ and $j = 1, \\ldots , m$. Then $N$ has a presentation \n    \n      \n  \\[  S^{\\oplus nm + t} \\longrightarrow S^{\\oplus m} \\longrightarrow N \\longrightarrow 0  \\]\n\n    \n       By construction there is a surjective map $\\varphi : N \\to M$. To finish the proof we show $\\varphi $ is injective. Suppose $z = \\sum b_ j y_ j \\in N$ for some $b_ j \\in S$. We may think of $b_ j$ as a polynomial in $x_1, \\ldots , x_ n$ with coefficients in $R$. By applying the relations of the form $x_ i y_ j = \\sum a_{ijk} y_ k$ we can inductively lower the degree of the polynomials. Hence we see that $z = \\sum c_ j y_ j$ for some $c_ j \\in R$. Hence if $\\varphi (z) = 0$ then the vector $(c_1, \\ldots , c_ m)$ is an $R$-linear combination of the vectors $(a_{i1}, \\ldots , a_{im})$ and we conclude that $z = 0$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about constructing a finite presentation of an S-module M (choosing module generators y_j, relations among them, additional relations x_i y_j = Œ£ a_ijk y_k, building an S-module N with a surjection N ‚Üí M and proving injectivity by degree-lowering). The Lean formal_proof, however, is about finite presentation of an algebra/map: it starts from `FinitePresentation.out (R := R) (A := B)` producing data ‚ü®n,f,hf,s,hs‚ü© for an algebra B, then constructs polynomial algebras `MvPolynomial (Fin n) R` and `MvPolynomial (Fin n) A`, uses `AlgHom.range_eq_top`, `Algebra.adjoin`, and identifies an ideal kernel of an `aeval` map, building a finite set of relations in an ideal. Structurally, the Lean proof follows the standard algebraic finite-presentation permanence argument via polynomial rings, adjoin/range, and ideal kernels, with no module presentation, no generators y_j, no relations matrix a_ij, no degree-lowering argument, and no injectivity proof of a map N ‚Üí M. Thus both the mathematical objects and proof strategy differ substantially, indicating essentially no alignment.""}"
224,089R,"  finite_quotient : Module.Finite R (M ‚ß∏ toSubmodule)
  projective_quotient : Projective R (M ‚ß∏ toSubmodule)
  rankAtStalk_eq : ‚àÄ p, rankAtStalk (R := R) (M ‚ß∏ toSubmodule) p = k
",Formal Proof of Stacks Project Tag 089R, structure Grassmannian extends Submodule R M wher,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Grassmannian.lean#L65-L67,Q27041,Grassmannians,27.22,section,2.0,"['01LE', '0ELP']","27.22 Grassmannians\n\n\nIn this section we introduce the standard Grassmannian functors and we show that they are represented by schemes. Pick integers $k$, $n$ with $0 < k < n$. We will construct a functor \n\n\n    27.22.0.1\n  \\begin{equation}  \\label{constructions-equation-gkn} G(k, n) : \\mathit{Sch}\\longrightarrow \\textit{Sets} \\end{equation}\n\n\n which will loosely speaking parametrize $k$-dimensional subspaces of $n$-space. However, for technical reasons it is more convenient to parametrize $(n - k)$-dimensional quotients and this is what we will do. \n\n\nMore precisely, $G(k, n)$ associates to a scheme $S$ the set $G(k, n)(S)$ of isomorphism classes of surjections \n\n\n  \\[  q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{Q}  \\]\n\n\n where $\\mathcal{Q}$ is a finite locally free $\\mathcal{O}_ S$-module of rank $n - k$. Note that this is indeed a set, for example by Modules, Lemma 17.9.8 or by the observation that the isomorphism class of the surjection $q$ is determined by the kernel of $q$ (and given a sheaf there is a set of subsheaves). Given a morphism of schemes $f : T \\to S$ we let $G(k, n)(f) : G(k, n)(S) \\to G(k, n)(T)$ which sends the isomorphism class of $q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{Q}$ to the isomorphism class of $f^*q : \\mathcal{O}_ T^{\\oplus n} \\longrightarrow f^*\\mathcal{Q}$. This makes sense since (1) $f^*\\mathcal{O}_ S = \\mathcal{O}_ T$, (2) $f^*$ is additive, (3) $f^*$ preserves locally free modules (Modules, Lemma 17.14.3), and (4) $f^*$ is right exact (Modules, Lemma 17.3.3). \n\n\n\n  Lemma 27.22.1. Let $0 < k < n$. The functor $G(k, n)$ of (27.22.0.1) is representable by a scheme. \n \n\n\n    \n      Proof.\n      Set $F = G(k, n)$. To prove the lemma we will use the criterion of Schemes, Lemma 26.15.4. The reason $F$ satisfies the sheaf property for the Zariski topology is that we can glue sheaves, see Sheaves, Section 6.33 (some details omitted). \n    \n      The family of subfunctors $F_ i$. Let $I$ be the set of subsets of $\\{ 1, \\ldots , n\\} $ of cardinality $n - k$. Given a scheme $S$ and $j \\in \\{ 1, \\ldots , n\\} $ we denote $e_ j$ the global section \n    \n      \n  \\[  e_ j = (0, \\ldots , 0, 1, 0, \\ldots , 0)\\quad (1\\text{ in }j\\text{th spot})  \\]\n\n    \n       of $\\mathcal{O}_ S^{\\oplus n}$. Of course these sections freely generate $\\mathcal{O}_ S^{\\oplus n}$. Similarly, for $j \\in \\{ 1, \\ldots , n - k\\} $ we denote $f_ j$ the global section of $\\mathcal{O}_ S^{\\oplus n - k}$ which is zero in all summands except the $j$th where we put a $1$. For $i \\in I$ we let \n    \n      \n  \\[  s_ i : \\mathcal{O}_ S^{\\oplus n - k} \\longrightarrow \\mathcal{O}_ S^{\\oplus n}  \\]\n\n    \n       which is the direct sum of the coprojections $\\mathcal{O}_ S \\to \\mathcal{O}_ S^{\\oplus n}$ corresponding to elements of $I$. More precisely, if $i = \\{ i_1, \\ldots , i_{n - k}\\} $ with $i_1 < i_2 < \\ldots < i_{n - k}$ then $s_ i$ maps $f_ j$ to $e_{i_ j}$ for $j \\in \\{ 1, \\ldots , n - k\\} $. With this notation we can set \n    \n      \n  \\[  F_ i(S) = \\{ q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q} \\in F(S) \\mid q \\circ s_ i \\text{ is surjective}\\}  \\subset F(S)  \\]\n\n    \n       Given a morphism $f : T \\to S$ of schemes the pullback $f^*s_ i$ is the corresponding map over $T$. Since $f^*$ is right exact (Modules, Lemma 17.3.3) we conclude that $F_ i$ is a subfunctor of $F$. \n    \n      Representability of $F_ i$. To prove this we may assume (after renumbering) that $i = \\{ 1, \\ldots , n - k\\} $. This means $s_ i$ is the inclusion of the first $n - k$ summands. Observe that if $q \\circ s_ i$ is surjective, then $q \\circ s_ i$ is an isomorphism as a surjective map between finite locally free modules of the same rank (Modules, Lemma 17.14.5). Thus if $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ is an element of $F_ i(S)$, then we can use $q \\circ s_ i$ to identify $\\mathcal{Q}$ with $\\mathcal{O}_ S^{\\oplus n - k}$. After doing so we obtain \n    \n      \n  \\[  q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{O}_ S^{\\oplus n - k}  \\]\n\n    \n       mapping $e_ j$ to $f_ j$ (notation as above) for $j = 1, \\ldots , n - k$. To determine $q$ completely we have to fix the images $q(e_{n - k + 1}), \\ldots , q(e_ n)$ in $\\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})$. It follows that $F_ i$ is isomorphic to the functor \n    \n      \n  \\[  S \\longmapsto \\prod \\nolimits _{j = n - k + 1, \\ldots , n} \\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})  \\]\n\n    \n       This functor is isomorphic to the $k(n - k)$-fold self product of the functor $S \\mapsto \\Gamma (S, \\mathcal{O}_ S)$. By Schemes, Example 26.15.2 the latter is representable by $\\mathbf{A}^1_\\mathbf {Z}$. It follows $F_ i$ is representable by $\\mathbf{A}^{k(n - k)}_\\mathbf {Z}$ since fibred product over $\\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is the product in the category of schemes. \n    \n      The inclusion $F_ i \\subset F$ is representable by open immersions. Let $S$ be a scheme and let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. By Modules, Lemma 17.9.4. the set $U_ i = \\{ s \\in S \\mid (q \\circ s_ i)_ s\\text{ surjective}\\} $ is open in $S$. Since $\\mathcal{O}_{S, s}$ is a local ring and $\\mathcal{Q}_ s$ a finite $\\mathcal{O}_{S, s}$-module by Nakayama\'s lemma (Algebra, Lemma 10.20.1) we have \n    \n      \n  \\[  s \\in U_ i \\Leftrightarrow \\left( \\text{the map } \\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s \\text{ induced by } (q \\circ s_ i)_ s \\text{ is surjective} \\right)  \\]\n\n    \n       Let $f : T \\to S$ be a morphism of schemes and let $t \\in T$ be a point mapping to $s \\in S$. We have $(f^*\\mathcal{Q})_ t = \\mathcal{Q}_ s \\otimes _{\\mathcal{O}_{S, s}} \\mathcal{O}_{T, t}$ (Sheaves, Lemma 6.26.4) and so on. Thus the map \n    \n      \n  \\[  \\kappa (t)^{\\oplus n - k} \\to (f^*\\mathcal{Q})_ t/\\mathfrak m_ t(f^*\\mathcal{Q})_ t  \\]\n\n    \n       induced by $(f^*q \\circ f^*s_ i)_ t$ is the base change of the map $\\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ above by the field extension $\\kappa (t)/\\kappa (s)$. It follows that $s \\in U_ i$ if and only if $t$ is in the corresponding open for $f^*q$. In particular $T \\to S$ factors through $U_ i$ if and only if $f^*q \\in F_ i(T)$ as desired. \n    \n      The collection $F_ i$, $i \\in I$ covers $F$. Let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. We have to show that for every point $s$ of $S$ there exists an $i \\in I$ such that $s_ i$ is surjective in a neighbourhood of $s$. Thus we have to show that one of the compositions \n    \n      \n  \\[  \\kappa (s)^{\\oplus n - k} \\xrightarrow {s_ i} \\kappa (s)^{\\oplus n} \\rightarrow \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s  \\]\n\n    \n       is surjective (see previous paragraph). As $\\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ is a vector space of dimension $n - k$ this follows from the theory of vector spaces. \n      $\\square$\n    \n\n\n\n  Definition 27.22.2. Let $0 < k < n$. The scheme $\\mathbf{G}(k, n)$ representing the functor $G(k, n)$ is called Grassmannian over $\\mathbf{Z}$. Its base change $\\mathbf{G}(k, n)_ S$ to a scheme $S$ is called Grassmannian over $S$. If $R$ is a ring the base change to $\\mathop{\\mathrm{Spec}}(R)$ is denoted $\\mathbf{G}(k, n)_ R$ and called Grassmannian over $R$. \n \n\n\nThe definition makes sense as we\'ve shown in Lemma 27.22.1 that these functors are indeed representable. \n\n\n\n  Lemma 27.22.3. Let $n \\geq 1$. There is a canonical isomorphism $\\mathbf{G}(n, n + 1) = \\mathbf{P}^ n_\\mathbf {Z}$. \n \n\n\n    \n      Proof.\n      According to Lemma 27.13.1 the scheme $\\mathbf{P}^ n_\\mathbf {Z}$ represents the functor which assigns to a scheme $S$ the set of isomorphisms classes of pairs $(\\mathcal{L}, (s_0, \\ldots , s_ n))$ consisting of an invertible module $\\mathcal{L}$ and an $(n + 1)$-tuple of global sections generating $\\mathcal{L}$. Given such a pair we obtain a quotient \n    \n      \n  \\[  \\mathcal{O}_ S^{\\oplus n + 1} \\longrightarrow \\mathcal{L},\\quad (h_0, \\ldots , h_ n) \\longmapsto \\sum h_ i s_ i.  \\]\n\n    \n       Conversely, given an element $q : \\mathcal{O}_ S^{\\oplus n + 1} \\to \\mathcal{Q}$ of $G(n, n + 1)(S)$ we obtain such a pair, namely $(\\mathcal{Q}, (q(e_1), \\ldots , q(e_{n + 1})))$. Here $e_ i$, $i = 1, \\ldots , n + 1$ are the standard generating sections of the free module $\\mathcal{O}_ S^{\\oplus n + 1}$. We omit the verification that these constructions define mutually inverse transformations of functors. \n      $\\square$\n    \n\n","27.22 Grassmannians\n\n\nIn this section we introduce the standard Grassmannian functors and we show that they are represented by schemes. Pick integers $k$, $n$ with $0 < k < n$. We will construct a functor \n\n\n    27.22.0.1\n  \\begin{equation}  \\label{constructions-equation-gkn} G(k, n) : \\mathit{Sch}\\longrightarrow \\textit{Sets} \\end{equation}\n\n\n which will loosely speaking parametrize $k$-dimensional subspaces of $n$-space. However, for technical reasons it is more convenient to parametrize $(n - k)$-dimensional quotients and this is what we will do. \n\n\nMore precisely, $G(k, n)$ associates to a scheme $S$ the set $G(k, n)(S)$ of isomorphism classes of surjections \n\n\n  \\[  q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{Q}  \\]\n\n\n where $\\mathcal{Q}$ is a finite locally free $\\mathcal{O}_ S$-module of rank $n - k$. Note that this is indeed a set, for example by Modules, Lemma 17.9.8 or by the observation that the isomorphism class of the surjection $q$ is determined by the kernel of $q$ (and given a sheaf there is a set of subsheaves). Given a morphism of schemes $f : T \\to S$ we let $G(k, n)(f) : G(k, n)(S) \\to G(k, n)(T)$ which sends the isomorphism class of $q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{Q}$ to the isomorphism class of $f^*q : \\mathcal{O}_ T^{\\oplus n} \\longrightarrow f^*\\mathcal{Q}$. This makes sense since (1) $f^*\\mathcal{O}_ S = \\mathcal{O}_ T$, (2) $f^*$ is additive, (3) $f^*$ preserves locally free modules (Modules, Lemma 17.14.3), and (4) $f^*$ is right exact (Modules, Lemma 17.3.3). \n\n\n\n  Lemma 27.22.1. Let $0 < k < n$. The functor $G(k, n)$ of (27.22.0.1) is representable by a scheme. \n \n\n\n    \n","Proof.\n      Set $F = G(k, n)$. To prove the lemma we will use the criterion of Schemes, Lemma 26.15.4. The reason $F$ satisfies the sheaf property for the Zariski topology is that we can glue sheaves, see Sheaves, Section 6.33 (some details omitted). \n    \n      The family of subfunctors $F_ i$. Let $I$ be the set of subsets of $\\{ 1, \\ldots , n\\} $ of cardinality $n - k$. Given a scheme $S$ and $j \\in \\{ 1, \\ldots , n\\} $ we denote $e_ j$ the global section \n    \n      \n  \\[  e_ j = (0, \\ldots , 0, 1, 0, \\ldots , 0)\\quad (1\\text{ in }j\\text{th spot})  \\]\n\n    \n       of $\\mathcal{O}_ S^{\\oplus n}$. Of course these sections freely generate $\\mathcal{O}_ S^{\\oplus n}$. Similarly, for $j \\in \\{ 1, \\ldots , n - k\\} $ we denote $f_ j$ the global section of $\\mathcal{O}_ S^{\\oplus n - k}$ which is zero in all summands except the $j$th where we put a $1$. For $i \\in I$ we let \n    \n      \n  \\[  s_ i : \\mathcal{O}_ S^{\\oplus n - k} \\longrightarrow \\mathcal{O}_ S^{\\oplus n}  \\]\n\n    \n       which is the direct sum of the coprojections $\\mathcal{O}_ S \\to \\mathcal{O}_ S^{\\oplus n}$ corresponding to elements of $I$. More precisely, if $i = \\{ i_1, \\ldots , i_{n - k}\\} $ with $i_1 < i_2 < \\ldots < i_{n - k}$ then $s_ i$ maps $f_ j$ to $e_{i_ j}$ for $j \\in \\{ 1, \\ldots , n - k\\} $. With this notation we can set \n    \n      \n  \\[  F_ i(S) = \\{ q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q} \\in F(S) \\mid q \\circ s_ i \\text{ is surjective}\\}  \\subset F(S)  \\]\n\n    \n       Given a morphism $f : T \\to S$ of schemes the pullback $f^*s_ i$ is the corresponding map over $T$. Since $f^*$ is right exact (Modules, Lemma 17.3.3) we conclude that $F_ i$ is a subfunctor of $F$. \n    \n      Representability of $F_ i$. To prove this we may assume (after renumbering) that $i = \\{ 1, \\ldots , n - k\\} $. This means $s_ i$ is the inclusion of the first $n - k$ summands. Observe that if $q \\circ s_ i$ is surjective, then $q \\circ s_ i$ is an isomorphism as a surjective map between finite locally free modules of the same rank (Modules, Lemma 17.14.5). Thus if $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ is an element of $F_ i(S)$, then we can use $q \\circ s_ i$ to identify $\\mathcal{Q}$ with $\\mathcal{O}_ S^{\\oplus n - k}$. After doing so we obtain \n    \n      \n  \\[  q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{O}_ S^{\\oplus n - k}  \\]\n\n    \n       mapping $e_ j$ to $f_ j$ (notation as above) for $j = 1, \\ldots , n - k$. To determine $q$ completely we have to fix the images $q(e_{n - k + 1}), \\ldots , q(e_ n)$ in $\\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})$. It follows that $F_ i$ is isomorphic to the functor \n    \n      \n  \\[  S \\longmapsto \\prod \\nolimits _{j = n - k + 1, \\ldots , n} \\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})  \\]\n\n    \n       This functor is isomorphic to the $k(n - k)$-fold self product of the functor $S \\mapsto \\Gamma (S, \\mathcal{O}_ S)$. By Schemes, Example 26.15.2 the latter is representable by $\\mathbf{A}^1_\\mathbf {Z}$. It follows $F_ i$ is representable by $\\mathbf{A}^{k(n - k)}_\\mathbf {Z}$ since fibred product over $\\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is the product in the category of schemes. \n    \n      The inclusion $F_ i \\subset F$ is representable by open immersions. Let $S$ be a scheme and let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. By Modules, Lemma 17.9.4. the set $U_ i = \\{ s \\in S \\mid (q \\circ s_ i)_ s\\text{ surjective}\\} $ is open in $S$. Since $\\mathcal{O}_{S, s}$ is a local ring and $\\mathcal{Q}_ s$ a finite $\\mathcal{O}_{S, s}$-module by Nakayama\'s lemma (Algebra, Lemma 10.20.1) we have \n    \n      \n  \\[  s \\in U_ i \\Leftrightarrow \\left( \\text{the map } \\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s \\text{ induced by } (q \\circ s_ i)_ s \\text{ is surjective} \\right)  \\]\n\n    \n       Let $f : T \\to S$ be a morphism of schemes and let $t \\in T$ be a point mapping to $s \\in S$. We have $(f^*\\mathcal{Q})_ t = \\mathcal{Q}_ s \\otimes _{\\mathcal{O}_{S, s}} \\mathcal{O}_{T, t}$ (Sheaves, Lemma 6.26.4) and so on. Thus the map \n    \n      \n  \\[  \\kappa (t)^{\\oplus n - k} \\to (f^*\\mathcal{Q})_ t/\\mathfrak m_ t(f^*\\mathcal{Q})_ t  \\]\n\n    \n       induced by $(f^*q \\circ f^*s_ i)_ t$ is the base change of the map $\\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ above by the field extension $\\kappa (t)/\\kappa (s)$. It follows that $s \\in U_ i$ if and only if $t$ is in the corresponding open for $f^*q$. In particular $T \\to S$ factors through $U_ i$ if and only if $f^*q \\in F_ i(T)$ as desired. \n    \n      The collection $F_ i$, $i \\in I$ covers $F$. Let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. We have to show that for every point $s$ of $S$ there exists an $i \\in I$ such that $s_ i$ is surjective in a neighbourhood of $s$. Thus we have to show that one of the compositions \n    \n      \n  \\[  \\kappa (s)^{\\oplus n - k} \\xrightarrow {s_ i} \\kappa (s)^{\\oplus n} \\rightarrow \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s  \\]\n\n    \n       is surjective (see previous paragraph). As $\\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ is a vector space of dimension $n - k$ this follows from the theory of vector spaces. \n      $\\square$\n    \n\n\n\n  Definition 27.22.2. Let $0 < k < n$. The scheme $\\mathbf{G}(k, n)$ representing the functor $G(k, n)$ is called Grassmannian over $\\mathbf{Z}$. Its base change $\\mathbf{G}(k, n)_ S$ to a scheme $S$ is called Grassmannian over $S$. If $R$ is a ring the base change to $\\mathop{\\mathrm{Spec}}(R)$ is denoted $\\mathbf{G}(k, n)_ R$ and called Grassmannian over $R$. \n \n\n\nThe definition makes sense as we\'ve shown in Lemma 27.22.1 that these functors are indeed representable. \n\n\n\n  Lemma 27.22.3. Let $n \\geq 1$. There is a canonical isomorphism $\\mathbf{G}(n, n + 1) = \\mathbf{P}^ n_\\mathbf {Z}$. \n \n\n\n    \n      Proof.\n      According to Lemma 27.13.1 the scheme $\\mathbf{P}^ n_\\mathbf {Z}$ represents the functor which assigns to a scheme $S$ the set of isomorphisms classes of pairs $(\\mathcal{L}, (s_0, \\ldots , s_ n))$ consisting of an invertible module $\\mathcal{L}$ and an $(n + 1)$-tuple of global sections generating $\\mathcal{L}$. Given such a pair we obtain a quotient \n    \n      \n  \\[  \\mathcal{O}_ S^{\\oplus n + 1} \\longrightarrow \\mathcal{L},\\quad (h_0, \\ldots , h_ n) \\longmapsto \\sum h_ i s_ i.  \\]\n\n    \n       Conversely, given an element $q : \\mathcal{O}_ S^{\\oplus n + 1} \\to \\mathcal{Q}$ of $G(n, n + 1)(S)$ we obtain such a pair, namely $(\\mathcal{Q}, (q(e_1), \\ldots , q(e_{n + 1})))$. Here $e_ i$, $i = 1, \\ldots , n + 1$ are the standard generating sections of the free module $\\mathcal{O}_ S^{\\oplus n + 1}$. We omit the verification that these constructions define mutually inverse transformations of functors. \n      $\\square$\n    \n\n"," R) (M ‚ß∏ toSubmodule) p = k
","  finite_quotient : Module.Finite R (M ‚ß∏ toSubmodule)
  projective_quotient : Projective R (M ‚ß∏ toSubmodule)
  rankAtStalk_eq : ‚àÄ p, rankAtStalk (R ","Proof.\n      Set $F = G(k, n)$. To prove the lemma we will use the criterion of Schemes, Lemma 26.15.4 [[\n  Lemma 26.15.4. Let $F$ be a contravariant functor on the category of schemes with values in the category of sets. Suppose that \n  \n  \n$F$ satisfies the sheaf property for the Zariski topology, \n\n\nthere exists a set $I$ and a collection of subfunctors $F_ i \\subset F$ such that \n\n\n  \neach $F_ i$ is representable, \n\n\neach $F_ i \\subset F$ is representable by open immersions, and \n\n\nthe collection $(F_ i)_{i \\in I}$ covers $F$. \n\n\n\n\n\n   Then $F$ is representable. \n\n    \n]]. The reason $F$ satisfies the sheaf property for the Zariski topology is that we can glue sheaves, see Sheaves, Section 6.33 [[6.33 Glueing sheaves\n\n\nIn this section we glue sheaves defined on the members of a covering of $X$. We first deal with maps. \n\n\n\n  Lemma 6.33.1. Let $X$ be a topological space. Let $X = \\bigcup U_ i$ be an open covering. Let $\\mathcal{F}$, $\\mathcal{G}$ be sheaves of sets on $X$. Given a collection \n  \n  \\[  \\varphi _ i : \\mathcal{F}|_{U_ i} \\longrightarrow \\mathcal{G}|_{U_ i}  \\]\n\n   of maps of sheaves such that for all $i, j \\in I$ the maps $\\varphi _ i, \\varphi _ j$ restrict to the same map $\\mathcal{F}|_{U_ i \\cap U_ j} \\to \\mathcal{G}|_{U_ i \\cap U_ j}$ then there exists a unique map of sheaves \n  \n  \\[  \\varphi : \\mathcal{F} \\longrightarrow \\mathcal{G}  \\]\n\n   whose restriction to each $U_ i$ agrees with $\\varphi _ i$. \n \n\n\n    \n]] (some details omitted). \n    \n      The family of subfunctors $F_ i$. Let $I$ be the set of subsets of $\\{ 1, \\ldots , n\\} $ of cardinality $n - k$. Given a scheme $S$ and $j \\in \\{ 1, \\ldots , n\\} $ we denote $e_ j$ the global section \n    \n      \n  \\[  e_ j = (0, \\ldots , 0, 1, 0, \\ldots , 0)\\quad (1\\text{ in }j\\text{th spot})  \\]\n\n    \n       of $\\mathcal{O}_ S^{\\oplus n}$. Of course these sections freely generate $\\mathcal{O}_ S^{\\oplus n}$. Similarly, for $j \\in \\{ 1, \\ldots , n - k\\} $ we denote $f_ j$ the global section of $\\mathcal{O}_ S^{\\oplus n - k}$ which is zero in all summands except the $j$th where we put a $1$. For $i \\in I$ we let \n    \n      \n  \\[  s_ i : \\mathcal{O}_ S^{\\oplus n - k} \\longrightarrow \\mathcal{O}_ S^{\\oplus n}  \\]\n\n    \n       which is the direct sum of the coprojections $\\mathcal{O}_ S \\to \\mathcal{O}_ S^{\\oplus n}$ corresponding to elements of $I$. More precisely, if $i = \\{ i_1, \\ldots , i_{n - k}\\} $ with $i_1 < i_2 < \\ldots < i_{n - k}$ then $s_ i$ maps $f_ j$ to $e_{i_ j}$ for $j \\in \\{ 1, \\ldots , n - k\\} $. With this notation we can set \n    \n      \n  \\[  F_ i(S) = \\{ q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q} \\in F(S) \\mid q \\circ s_ i \\text{ is surjective}\\}  \\subset F(S)  \\]\n\n    \n       Given a morphism $f : T \\to S$ of schemes the pullback $f^*s_ i$ is the corresponding map over $T$. Since $f^*$ is right exact (Modules, Lemma 17.3.3 [[\n  Lemma 17.3.3. Let $f : (X, \\mathcal{O}_ X) \\to (Y, \\mathcal{O}_ Y)$ be a morphism of ringed spaces. \n  \n  \nThe functor $f_* : \\textit{Mod}(\\mathcal{O}_ X) \\to \\textit{Mod}(\\mathcal{O}_ Y)$ is left exact. In fact it commutes with all limits. \n\n\nThe functor $f^* : \\textit{Mod}(\\mathcal{O}_ Y) \\to \\textit{Mod}(\\mathcal{O}_ X)$ is right exact. In fact it commutes with all colimits. \n\n\nPullback $f^{-1} : \\textit{Ab}(Y) \\to \\textit{Ab}(X)$ on abelian sheaves is exact. \n\n\n\n\n    \n]]) we conclude that $F_ i$ is a subfunctor of $F$. \n    \n      Representability of $F_ i$. To prove this we may assume (after renumbering) that $i = \\{ 1, \\ldots , n - k\\} $. This means $s_ i$ is the inclusion of the first $n - k$ summands. Observe that if $q \\circ s_ i$ is surjective, then $q \\circ s_ i$ is an isomorphism as a surjective map between finite locally free modules of the same rank (Modules, Lemma 17.14.5 [[\n  Lemma 17.14.5. Let $(X, \\mathcal{O}_ X)$ be a ringed space. Let $r \\geq 0$. Let $\\varphi : \\mathcal{F} \\to \\mathcal{G}$ be a map of finite locally free $\\mathcal{O}_ X$-modules of rank $r$. Then $\\varphi $ is an isomorphism if and only if $\\varphi $ is surjective. \n\n    \n]]). Thus if $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ is an element of $F_ i(S)$, then we can use $q \\circ s_ i$ to identify $\\mathcal{Q}$ with $\\mathcal{O}_ S^{\\oplus n - k}$. After doing so we obtain \n    \n      \n  \\[  q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{O}_ S^{\\oplus n - k}  \\]\n\n    \n       mapping $e_ j$ to $f_ j$ (notation as above) for $j = 1, \\ldots , n - k$. To determine $q$ completely we have to fix the images $q(e_{n - k + 1}), \\ldots , q(e_ n)$ in $\\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})$. It follows that $F_ i$ is isomorphic to the functor \n    \n      \n  \\[  S \\longmapsto \\prod \\nolimits _{j = n - k + 1, \\ldots , n} \\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})  \\]\n\n    \n       This functor is isomorphic to the $k(n - k)$-fold self product of the functor $S \\mapsto \\Gamma (S, \\mathcal{O}_ S)$. By Schemes, Example 26.15.2 [[\n  Example 26.15.2. Consider the rule which associates to every scheme $T$ the set $F(T) = \\Gamma (T, \\mathcal{O}_ T)$. We can turn this into a contravariant functor by using for a morphism $f : T\' \\to T$ the pullback map $f^\\sharp : \\Gamma (T, \\mathcal{O}_ T) \\to \\Gamma (T\', \\mathcal{O}_{T\'})$. Given a ring $R$ and an element $t \\in R$ there exists a unique ring homomorphism $\\mathbf{Z}[x] \\to R$ which maps $x$ to $t$. Thus, using Lemma 26.6.4, we see that \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits (T, \\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])) = \\mathop{\\mathrm{Hom}}\\nolimits (\\mathbf{Z}[x], \\Gamma (T, \\mathcal{O}_ T)) = \\Gamma (T, \\mathcal{O}_ T).  \\]\n\n   This does indeed give an isomorphism $h_{\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])} \\to F$. What is the \xe2\x80\x9cuniversal family\xe2\x80\x9d $\\xi $? To get it we have to apply the identifications above to $\\text{id}_{\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])}$. Clearly under the identifications above this gives that $\\xi = x \\in \\Gamma (\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x]), \\mathcal{O}_{\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])}) = \\mathbf{Z}[x]$ as expected. \n]] the latter is representable by $\\mathbf{A}^1_\\mathbf {Z}$. It follows $F_ i$ is representable by $\\mathbf{A}^{k(n - k)}_\\mathbf {Z}$ since fibred product over $\\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is the product in the category of schemes. \n    \n      The inclusion $F_ i \\subset F$ is representable by open immersions. Let $S$ be a scheme and let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. By Modules, Lemma 17.9.4 [[\n  Lemma 17.9.4. Let $X$ be a ringed space. Let $\\varphi : \\mathcal{G} \\to \\mathcal{F}$ be a homomorphism of $\\mathcal{O}_ X$-modules. Let $x \\in X$. Assume $\\mathcal{F}$ of finite type and the map on stalks $\\varphi _ x : \\mathcal{G}_ x \\to \\mathcal{F}_ x$ surjective. Then there exists an open neighbourhood $x \\in U \\subset X$ such that $\\varphi |_ U$ is surjective. \n\n    \n]]. the set $U_ i = \\{ s \\in S \\mid (q \\circ s_ i)_ s\\text{ surjective}\\} $ is open in $S$. Since $\\mathcal{O}_{S, s}$ is a local ring and $\\mathcal{Q}_ s$ a finite $\\mathcal{O}_{S, s}$-module by Nakayama\'s lemma (Algebra, Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]) we have \n    \n      \n  \\[  s \\in U_ i \\Leftrightarrow \\left( \\text{the map } \\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s \\text{ induced by } (q \\circ s_ i)_ s \\text{ is surjective} \\right)  \\]\n\n    \n       Let $f : T \\to S$ be a morphism of schemes and let $t \\in T$ be a point mapping to $s \\in S$. We have $(f^*\\mathcal{Q})_ t = \\mathcal{Q}_ s \\otimes _{\\mathcal{O}_{S, s}} \\mathcal{O}_{T, t}$ (Sheaves, Lemma 6.26.4 [[\n  Lemma 6.26.4. Let $(f, f^\\sharp ) : (X, \\mathcal{O}_ X) \\to (Y, \\mathcal{O}_ Y)$ be a morphism of ringed spaces. Let $\\mathcal{G}$ be a sheaf of $\\mathcal{O}_ Y$-modules. Let $x \\in X$. Then \n  \n  \\[  (f^*\\mathcal{G})_ x = \\mathcal{G}_{f(x)} \\otimes _{\\mathcal{O}_{Y, f(x)}} \\mathcal{O}_{X, x}  \\]\n\n   as $\\mathcal{O}_{X, x}$-modules where the tensor product on the right uses $f^\\sharp _ x : \\mathcal{O}_{Y, f(x)} \\to \\mathcal{O}_{X, x}$. \n\n    \n]]) and so on. Thus the map \n    \n      \n  \\[  \\kappa (t)^{\\oplus n - k} \\to (f^*\\mathcal{Q})_ t/\\mathfrak m_ t(f^*\\mathcal{Q})_ t  \\]\n\n    \n       induced by $(f^*q \\circ f^*s_ i)_ t$ is the base change of the map $\\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ above by the field extension $\\kappa (t)/\\kappa (s)$. It follows that $s \\in U_ i$ if and only if $t$ is in the corresponding open for $f^*q$. In particular $T \\to S$ factors through $U_ i$ if and only if $f^*q \\in F_ i(T)$ as desired. \n    \n      The collection $F_ i$, $i \\in I$ covers $F$. Let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. We have to show that for every point $s$ of $S$ there exists an $i \\in I$ such that $s_ i$ is surjective in a neighbourhood of $s$. Thus we have to show that one of the compositions \n    \n      \n  \\[  \\kappa (s)^{\\oplus n - k} \\xrightarrow {s_ i} \\kappa (s)^{\\oplus n} \\rightarrow \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s  \\]\n\n    \n       is surjective (see previous paragraph). As $\\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ is a vector space of dimension $n - k$ this follows from the theory of vector spaces. \n      $\\square$\n    \n\n\n\n  Definition 27.22.2 [[\n  Definition 27.22.2. Let $0 < k < n$. The scheme $\\mathbf{G}(k, n)$ representing the functor $G(k, n)$ is called Grassmannian over $\\mathbf{Z}$. Its base change $\\mathbf{G}(k, n)_ S$ to a scheme $S$ is called Grassmannian over $S$. If $R$ is a ring the base change to $\\mathop{\\mathrm{Spec}}(R)$ is denoted $\\mathbf{G}(k, n)_ R$ and called Grassmannian over $R$. \n]]. Let $0 < k < n$. The scheme $\\mathbf{G}(k, n)$ representing the functor $G(k, n)$ is called Grassmannian over $\\mathbf{Z}$. Its base change $\\mathbf{G}(k, n)_ S$ to a scheme $S$ is called Grassmannian over $S$. If $R$ is a ring the base change to $\\mathop{\\mathrm{Spec}}(R)$ is denoted $\\mathbf{G}(k, n)_ R$ and called Grassmannian over $R$. \n \n\n\nThe definition makes sense as we\'ve shown in Lemma 27.22.1 [[\n  Lemma 27.22.1. Let $0 < k < n$. The functor $G(k, n)$ of (27.22.0.1) is representable by a scheme. \n\n    \n]] that these functors are indeed representable. \n\n\n\n  Lemma 27.22.3 [[\n  Lemma 27.22.3. Let $n \\geq 1$. There is a canonical isomorphism $\\mathbf{G}(n, n + 1) = \\mathbf{P}^ n_\\mathbf {Z}$. \n\n    \n]]. Let $n \\geq 1$. There is a canonical isomorphism $\\mathbf{G}(n, n + 1) = \\mathbf{P}^ n_\\mathbf {Z}$. \n \n\n\n    \n      Proof.\n      According to Lemma 27.13.1 [[\n  Lemma 27.13.1. Let $S = \\mathbf{Z}[T_0, \\ldots , T_ n]$ with $\\deg (T_ i) = 1$. The scheme \n  \n  \\[  \\mathbf{P}^ n_{\\mathbf{Z}} = \\text{Proj}(S)  \\]\n\n   represents the functor which associates to a scheme $Y$ the pairs $(\\mathcal{L}, (s_0, \\ldots , s_ n))$ where \n  \n  \n$\\mathcal{L}$ is an invertible $\\mathcal{O}_ Y$-module, and \n\n\n$s_0, \\ldots , s_ n$ are global sections of $\\mathcal{L}$ which generate $\\mathcal{L}$ \n\n\n\n   up to the following equivalence: $(\\mathcal{L}, (s_0, \\ldots , s_ n)) \\sim (\\mathcal{N}, (t_0, \\ldots , t_ n))$ $\\Leftrightarrow $ there exists an isomorphism $\\beta : \\mathcal{L} \\to \\mathcal{N}$ with $\\beta (s_ i) = t_ i$ for $i = 0, \\ldots , n$. \n\n    \n]] the scheme $\\mathbf{P}^ n_\\mathbf {Z}$ represents the functor which assigns to a scheme $S$ the set of isomorphisms classes of pairs $(\\mathcal{L}, (s_0, \\ldots , s_ n))$ consisting of an invertible module $\\mathcal{L}$ and an $(n + 1)$-tuple of global sections generating $\\mathcal{L}$. Given such a pair we obtain a quotient \n    \n      \n  \\[  \\mathcal{O}_ S^{\\oplus n + 1} \\longrightarrow \\mathcal{L},\\quad (h_0, \\ldots , h_ n) \\longmapsto \\sum h_ i s_ i.  \\]\n\n    \n       Conversely, given an element $q : \\mathcal{O}_ S^{\\oplus n + 1} \\to \\mathcal{Q}$ of $G(n, n + 1)(S)$ we obtain such a pair, namely $(\\mathcal{Q}, (q(e_1), \\ldots , q(e_{n + 1})))$. Here $e_ i$, $i = 1, \\ldots , n + 1$ are the standard generating sections of the free module $\\mathcal{O}_ S^{\\oplus n + 1}$. We omit the verification that these constructions define mutually inverse transformations of functors. \n      $\\square$\n    \n\n","Proof.\n      Set $F = G(k, n)$. To prove the lemma we will use the criterion of Schemes, Lemma 26.15.4 [[\n  Lemma 26.15.4. Let $F$ be a contravariant functor on the category of schemes with values in the category of sets. Suppose that \n  \n  \n$F$ satisfies the sheaf property for the Zariski topology, \n\n\nthere exists a set $I$ and a collection of subfunctors $F_ i \\subset F$ such that \n\n\n  \neach $F_ i$ is representable, \n\n\neach $F_ i \\subset F$ is representable by open immersions, and \n\n\nthe collection $(F_ i)_{i \\in I}$ covers $F$. \n\n\n\n\n\n   Then $F$ is representable. \n\n    \n]]. The reason $F$ satisfies the sheaf property for the Zariski topology is that we can glue sheaves, see Sheaves, Section 6.33 [[6.33 Glueing sheaves\n\n\nIn this section we glue sheaves defined on the members of a covering of $X$. We first deal with maps. \n\n\n\n  Lemma 6.33.1. Let $X$ be a topological space. Let $X = \\bigcup U_ i$ be an open covering. Let $\\mathcal{F}$, $\\mathcal{G}$ be sheaves of sets on $X$. Given a collection \n  \n  \\[  \\varphi _ i : \\mathcal{F}|_{U_ i} \\longrightarrow \\mathcal{G}|_{U_ i}  \\]\n\n   of maps of sheaves such that for all $i, j \\in I$ the maps $\\varphi _ i, \\varphi _ j$ restrict to the same map $\\mathcal{F}|_{U_ i \\cap U_ j} \\to \\mathcal{G}|_{U_ i \\cap U_ j}$ then there exists a unique map of sheaves \n  \n  \\[  \\varphi : \\mathcal{F} \\longrightarrow \\mathcal{G}  \\]\n\n   whose restriction to each $U_ i$ agrees with $\\varphi _ i$. \n \n\n\n    \n]] (some details omitted). \n    \n      The family of subfunctors $F_ i$. Let $I$ be the set of subsets of $\\{ 1, \\ldots , n\\} $ of cardinality $n - k$. Given a scheme $S$ and $j \\in \\{ 1, \\ldots , n\\} $ we denote $e_ j$ the global section \n    \n      \n  \\[  e_ j = (0, \\ldots , 0, 1, 0, \\ldots , 0)\\quad (1\\text{ in }j\\text{th spot})  \\]\n\n    \n       of $\\mathcal{O}_ S^{\\oplus n}$. Of course these sections freely generate $\\mathcal{O}_ S^{\\oplus n}$. Similarly, for $j \\in \\{ 1, \\ldots , n - k\\} $ we denote $f_ j$ the global section of $\\mathcal{O}_ S^{\\oplus n - k}$ which is zero in all summands except the $j$th where we put a $1$. For $i \\in I$ we let \n    \n      \n  \\[  s_ i : \\mathcal{O}_ S^{\\oplus n - k} \\longrightarrow \\mathcal{O}_ S^{\\oplus n}  \\]\n\n    \n       which is the direct sum of the coprojections $\\mathcal{O}_ S \\to \\mathcal{O}_ S^{\\oplus n}$ corresponding to elements of $I$. More precisely, if $i = \\{ i_1, \\ldots , i_{n - k}\\} $ with $i_1 < i_2 < \\ldots < i_{n - k}$ then $s_ i$ maps $f_ j$ to $e_{i_ j}$ for $j \\in \\{ 1, \\ldots , n - k\\} $. With this notation we can set \n    \n      \n  \\[  F_ i(S) = \\{ q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q} \\in F(S) \\mid q \\circ s_ i \\text{ is surjective}\\}  \\subset F(S)  \\]\n\n    \n       Given a morphism $f : T \\to S$ of schemes the pullback $f^*s_ i$ is the corresponding map over $T$. Since $f^*$ is right exact (Modules, Lemma 17.3.3 [[\n  Lemma 17.3.3. Let $f : (X, \\mathcal{O}_ X) \\to (Y, \\mathcal{O}_ Y)$ be a morphism of ringed spaces. \n  \n  \nThe functor $f_* : \\textit{Mod}(\\mathcal{O}_ X) \\to \\textit{Mod}(\\mathcal{O}_ Y)$ is left exact. In fact it commutes with all limits. \n\n\nThe functor $f^* : \\textit{Mod}(\\mathcal{O}_ Y) \\to \\textit{Mod}(\\mathcal{O}_ X)$ is right exact. In fact it commutes with all colimits. \n\n\nPullback $f^{-1} : \\textit{Ab}(Y) \\to \\textit{Ab}(X)$ on abelian sheaves is exact. \n\n\n\n\n    \n]]) we conclude that $F_ i$ is a subfunctor of $F$. \n    \n      Representability of $F_ i$. To prove this we may assume (after renumbering) that $i = \\{ 1, \\ldots , n - k\\} $. This means $s_ i$ is the inclusion of the first $n - k$ summands. Observe that if $q \\circ s_ i$ is surjective, then $q \\circ s_ i$ is an isomorphism as a surjective map between finite locally free modules of the same rank (Modules, Lemma 17.14.5 [[\n  Lemma 17.14.5. Let $(X, \\mathcal{O}_ X)$ be a ringed space. Let $r \\geq 0$. Let $\\varphi : \\mathcal{F} \\to \\mathcal{G}$ be a map of finite locally free $\\mathcal{O}_ X$-modules of rank $r$. Then $\\varphi $ is an isomorphism if and only if $\\varphi $ is surjective. \n\n    \n]]). Thus if $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ is an element of $F_ i(S)$, then we can use $q \\circ s_ i$ to identify $\\mathcal{Q}$ with $\\mathcal{O}_ S^{\\oplus n - k}$. After doing so we obtain \n    \n      \n  \\[  q : \\mathcal{O}_ S^{\\oplus n} \\longrightarrow \\mathcal{O}_ S^{\\oplus n - k}  \\]\n\n    \n       mapping $e_ j$ to $f_ j$ (notation as above) for $j = 1, \\ldots , n - k$. To determine $q$ completely we have to fix the images $q(e_{n - k + 1}), \\ldots , q(e_ n)$ in $\\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})$. It follows that $F_ i$ is isomorphic to the functor \n    \n      \n  \\[  S \\longmapsto \\prod \\nolimits _{j = n - k + 1, \\ldots , n} \\Gamma (S, \\mathcal{O}_ S^{\\oplus n - k})  \\]\n\n    \n       This functor is isomorphic to the $k(n - k)$-fold self product of the functor $S \\mapsto \\Gamma (S, \\mathcal{O}_ S)$. By Schemes, Example 26.15.2 [[\n  Example 26.15.2. Consider the rule which associates to every scheme $T$ the set $F(T) = \\Gamma (T, \\mathcal{O}_ T)$. We can turn this into a contravariant functor by using for a morphism $f : T\' \\to T$ the pullback map $f^\\sharp : \\Gamma (T, \\mathcal{O}_ T) \\to \\Gamma (T\', \\mathcal{O}_{T\'})$. Given a ring $R$ and an element $t \\in R$ there exists a unique ring homomorphism $\\mathbf{Z}[x] \\to R$ which maps $x$ to $t$. Thus, using Lemma 26.6.4, we see that \n  \n  \\[  \\mathop{\\mathrm{Mor}}\\nolimits (T, \\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])) = \\mathop{\\mathrm{Hom}}\\nolimits (\\mathbf{Z}[x], \\Gamma (T, \\mathcal{O}_ T)) = \\Gamma (T, \\mathcal{O}_ T).  \\]\n\n   This does indeed give an isomorphism $h_{\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])} \\to F$. What is the \xe2\x80\x9cuniversal family\xe2\x80\x9d $\\xi $? To get it we have to apply the identifications above to $\\text{id}_{\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])}$. Clearly under the identifications above this gives that $\\xi = x \\in \\Gamma (\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x]), \\mathcal{O}_{\\mathop{\\mathrm{Spec}}(\\mathbf{Z}[x])}) = \\mathbf{Z}[x]$ as expected. \n]] the latter is representable by $\\mathbf{A}^1_\\mathbf {Z}$. It follows $F_ i$ is representable by $\\mathbf{A}^{k(n - k)}_\\mathbf {Z}$ since fibred product over $\\mathop{\\mathrm{Spec}}(\\mathbf{Z})$ is the product in the category of schemes. \n    \n      The inclusion $F_ i \\subset F$ is representable by open immersions. Let $S$ be a scheme and let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. By Modules, Lemma 17.9.4 [[\n  Lemma 17.9.4. Let $X$ be a ringed space. Let $\\varphi : \\mathcal{G} \\to \\mathcal{F}$ be a homomorphism of $\\mathcal{O}_ X$-modules. Let $x \\in X$. Assume $\\mathcal{F}$ of finite type and the map on stalks $\\varphi _ x : \\mathcal{G}_ x \\to \\mathcal{F}_ x$ surjective. Then there exists an open neighbourhood $x \\in U \\subset X$ such that $\\varphi |_ U$ is surjective. \n\n    \n]]. the set $U_ i = \\{ s \\in S \\mid (q \\circ s_ i)_ s\\text{ surjective}\\} $ is open in $S$. Since $\\mathcal{O}_{S, s}$ is a local ring and $\\mathcal{Q}_ s$ a finite $\\mathcal{O}_{S, s}$-module by Nakayama\'s lemma (Algebra, Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]) we have \n    \n      \n  \\[  s \\in U_ i \\Leftrightarrow \\left( \\text{the map } \\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s \\text{ induced by } (q \\circ s_ i)_ s \\text{ is surjective} \\right)  \\]\n\n    \n       Let $f : T \\to S$ be a morphism of schemes and let $t \\in T$ be a point mapping to $s \\in S$. We have $(f^*\\mathcal{Q})_ t = \\mathcal{Q}_ s \\otimes _{\\mathcal{O}_{S, s}} \\mathcal{O}_{T, t}$ (Sheaves, Lemma 6.26.4 [[\n  Lemma 6.26.4. Let $(f, f^\\sharp ) : (X, \\mathcal{O}_ X) \\to (Y, \\mathcal{O}_ Y)$ be a morphism of ringed spaces. Let $\\mathcal{G}$ be a sheaf of $\\mathcal{O}_ Y$-modules. Let $x \\in X$. Then \n  \n  \\[  (f^*\\mathcal{G})_ x = \\mathcal{G}_{f(x)} \\otimes _{\\mathcal{O}_{Y, f(x)}} \\mathcal{O}_{X, x}  \\]\n\n   as $\\mathcal{O}_{X, x}$-modules where the tensor product on the right uses $f^\\sharp _ x : \\mathcal{O}_{Y, f(x)} \\to \\mathcal{O}_{X, x}$. \n\n    \n]]) and so on. Thus the map \n    \n      \n  \\[  \\kappa (t)^{\\oplus n - k} \\to (f^*\\mathcal{Q})_ t/\\mathfrak m_ t(f^*\\mathcal{Q})_ t  \\]\n\n    \n       induced by $(f^*q \\circ f^*s_ i)_ t$ is the base change of the map $\\kappa (s)^{\\oplus n - k} \\to \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ above by the field extension $\\kappa (t)/\\kappa (s)$. It follows that $s \\in U_ i$ if and only if $t$ is in the corresponding open for $f^*q$. In particular $T \\to S$ factors through $U_ i$ if and only if $f^*q \\in F_ i(T)$ as desired. \n    \n      The collection $F_ i$, $i \\in I$ covers $F$. Let $q : \\mathcal{O}_ S^{\\oplus n} \\to \\mathcal{Q}$ be an element of $F(S)$. We have to show that for every point $s$ of $S$ there exists an $i \\in I$ such that $s_ i$ is surjective in a neighbourhood of $s$. Thus we have to show that one of the compositions \n    \n      \n  \\[  \\kappa (s)^{\\oplus n - k} \\xrightarrow {s_ i} \\kappa (s)^{\\oplus n} \\rightarrow \\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s  \\]\n\n    \n       is surjective (see previous paragraph). As $\\mathcal{Q}_ s/\\mathfrak m_ s\\mathcal{Q}_ s$ is a vector space of dimension $n - k$ this follows from the theory of vector spaces. \n      $\\square$\n    \n\n\n\n  Definition 27.22.2 [[\n  Definition 27.22.2. Let $0 < k < n$. The scheme $\\mathbf{G}(k, n)$ representing the functor $G(k, n)$ is called Grassmannian over $\\mathbf{Z}$. Its base change $\\mathbf{G}(k, n)_ S$ to a scheme $S$ is called Grassmannian over $S$. If $R$ is a ring the base change to $\\mathop{\\mathrm{Spec}}(R)$ is denoted $\\mathbf{G}(k, n)_ R$ and called Grassmannian over $R$. \n]]. Let $0 < k < n$. The scheme $\\mathbf{G}(k, n)$ representing the functor $G(k, n)$ is called Grassmannian over $\\mathbf{Z}$. Its base change $\\mathbf{G}(k, n)_ S$ to a scheme $S$ is called Grassmannian over $S$. If $R$ is a ring the base change to $\\mathop{\\mathrm{Spec}}(R)$ is denoted $\\mathbf{G}(k, n)_ R$ and called Grassmannian over $R$. \n \n\n\nThe definition makes sense as we\'ve shown in Lemma 27.22.1 [[\n  Lemma 27.22.1. Let $0 < k < n$. The functor $G(k, n)$ of (27.22.0.1) is representable by a scheme. \n\n    \n]] that these functors are indeed representable. \n\n\n\n  Lemma 27.22.3 [[\n  Lemma 27.22.3. Let $n \\geq 1$. There is a canonical isomorphism $\\mathbf{G}(n, n + 1) = \\mathbf{P}^ n_\\mathbf {Z}$. \n\n    \n]]. Let $n \\geq 1$. There is a canonical isomorphism $\\mathbf{G}(n, n + 1) = \\mathbf{P}^ n_\\mathbf {Z}$. \n \n\n\n    \n      Proof.\n      According to Lemma 27.13.1 [[\n  Lemma 27.13.1. Let $S = \\mathbf{Z}[T_0, \\ldots , T_ n]$ with $\\deg (T_ i) = 1$. The scheme \n  \n  \\[  \\mathbf{P}^ n_{\\mathbf{Z}} = \\text{Proj}(S)  \\]\n\n   represents the functor which associates to a scheme $Y$ the pairs $(\\mathcal{L}, (s_0, \\ldots , s_ n))$ where \n  \n  \n$\\mathcal{L}$ is an invertible $\\mathcal{O}_ Y$-module, and \n\n\n$s_0, \\ldots , s_ n$ are global sections of $\\mathcal{L}$ which generate $\\mathcal{L}$ \n\n\n\n   up to the following equivalence: $(\\mathcal{L}, (s_0, \\ldots , s_ n)) \\sim (\\mathcal{N}, (t_0, \\ldots , t_ n))$ $\\Leftrightarrow $ there exists an isomorphism $\\beta : \\mathcal{L} \\to \\mathcal{N}$ with $\\beta (s_ i) = t_ i$ for $i = 0, \\ldots , n$. \n\n    \n]] the scheme $\\mathbf{P}^ n_\\mathbf {Z}$ represents the functor which assigns to a scheme $S$ the set of isomorphisms classes of pairs $(\\mathcal{L}, (s_0, \\ldots , s_ n))$ consisting of an invertible module $\\mathcal{L}$ and an $(n + 1)$-tuple of global sections generating $\\mathcal{L}$. Given such a pair we obtain a quotient \n    \n      \n  \\[  \\mathcal{O}_ S^{\\oplus n + 1} \\longrightarrow \\mathcal{L},\\quad (h_0, \\ldots , h_ n) \\longmapsto \\sum h_ i s_ i.  \\]\n\n    \n       Conversely, given an element $q : \\mathcal{O}_ S^{\\oplus n + 1} \\to \\mathcal{Q}$ of $G(n, n + 1)(S)$ we obtain such a pair, namely $(\\mathcal{Q}, (q(e_1), \\ldots , q(e_{n + 1})))$. Here $e_ i$, $i = 1, \\ldots , n + 1$ are the standard generating sections of the free module $\\mathcal{O}_ S^{\\oplus n + 1}$. We omit the verification that these constructions define mutually inverse transformations of functors. \n      $\\square$\n    \n\n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: structure Grassmannian extends Submodule R M wher","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about representability of the Grassmannian functor G(k,n) by a scheme, constructing an open cover by representable subfunctors Fi and invoking a representability criterion, and then identifying G(n,n+1) with projective space. The formal_proof fragment `R) (M ‚ß∏ toSubmodule) p = k` instead looks like a statement about a quotient module/submodule and an equality to k (likely a rank/dimension/cardinality assertion) and does not express representability, functors, open immersions, or the Grassmannian‚Äìprojective space identification. Structurally, the informal proof has a multi-step argument (sheaf property, define Fi, show representable, open immersion, cover), while the formal proof is a single line with no corresponding steps. The added comment about `structure Grassmannian extends Submodule R M` suggests the Lean development models a Grassmannian as a submodule, but the given formal_proof still does not align with the informal scheme-theoretic representability argument or the specific lemma about G(n,n+1)=P^n.""}"
225,00JB,"theorem isArtinianRing_iff_isFiniteLength : IsArtinianRing R ‚Üî IsFiniteLength R R :=
  ‚ü®fun h ‚Ü¶ ((IsArtinianRing.tfae R R).out 2 3).mp h,
    fun h ‚Ü¶ (isFiniteLength_iff_isNoetherian_isArtinian.mp h).2‚ü©
",Formal Proof of Stacks Project Tag 00JB,A ring is Artinian if and only if it has finite length as a module over itself.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/HopkinsLevitzki.lean#L135-L137,Q27041,,10.53.6,lemma,3.0,"['00J4', '00AO', '0ELQ']","\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n      Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3, 10.53.4, and 10.53.5. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n","\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n","Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3, 10.53.4, and 10.53.5. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n","
  ‚ü®fun h ‚Ü¶ ((IsArtinianRing.tfae R R).out 2 3).mp h,
    fun h ‚Ü¶ (isFiniteLength_iff_isNoetherian_isArtinian.mp h).2‚ü©
",theorem isArtinianRing_iff_isFiniteLength : IsArtinianRing R ‚Üî IsFiniteLength R R ,"Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3 [[\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n]], 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]], and 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]]. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]] we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 [[\n  Lemma 10.52.6. Let $R$ be a ring with maximal ideal $\\mathfrak m$. Suppose that $M$ is an $R$-module with $\\mathfrak m M = 0$. Then the length of $M$ as an $R$-module agrees with the dimension of $M$ as a $R/\\mathfrak m$ vector space. The length is finite if and only if $M$ is a finite $R$-module. \n\n    \n]] the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n","Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3 [[\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n]], 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]], and 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]]. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]] we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 [[\n  Lemma 10.52.6. Let $R$ be a ring with maximal ideal $\\mathfrak m$. Suppose that $M$ is an $R$-module with $\\mathfrak m M = 0$. Then the length of $M$ as an $R$-module agrees with the dimension of $M$ as a $R/\\mathfrak m$ vector space. The length is finite if and only if $M$ is a finite $R$-module. \n\n    \n]] the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: A ring is Artinian if and only if it has finite length as a module over itself.","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean term proves (at least) one direction of the intended equivalence: from finite length it derives Artinian via `isFiniteLength_iff_isNoetherian_isArtinian.mp h).2`, which matches the informal opening argument that finite length implies both ACC and DCC hence Artinian. However, the other direction in Lean is `((IsArtinianRing.tfae R R).out 2 3).mp h`, which uses a packaged `tfae` equivalence for Artinian rings, not the informal argument (decomposition into local factors, nilpotent maximal ideal, filtration by powers, and finite-dimensionality of subquotients). Structurally, the informal proof is long and constructive for Artinian ‚Üí finite length, while the Lean proof is a short composition of existing equivalences; it does not reflect the localization/nilpotence/filtration steps. Completeness-wise, the Lean proof omits the detailed reasoning and intermediate lemmas used informally, though it may rely on library results encapsulating them. Overall: correct high-level statement but weak structural correspondence, hence moderate alignment.""}"
226,00JB,"**Any such ring is both Artinian and Noetherian.**""]
instance [IsArtinianRing R] : IsNoetherianRing R := ((IsArtinianRing.tfae R R).out 2 1).mp ‚Äπ_‚Ä∫
",Formal Proof of Stacks Project Tag 00JB,A ring is Artinian if and only if it has finite length as a module over itself,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/HopkinsLevitzki.lean#L140-L141,Q27041,,10.53.6,lemma,3.0,"['00J4', '00AO', '0ELQ']","\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n      Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3, 10.53.4, and 10.53.5. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n","\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n","Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3, 10.53.4, and 10.53.5. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n"," ((IsArtinianRing.tfae R R).out 2 1).mp ‚Äπ_‚Ä∫
","**Any such ring is both Artinian and Noetherian.**""]
instance [IsArtinianRing R] : IsNoetherianRing R ","Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3 [[\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n]], 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]], and 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]]. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]] we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 [[\n  Lemma 10.52.6. Let $R$ be a ring with maximal ideal $\\mathfrak m$. Suppose that $M$ is an $R$-module with $\\mathfrak m M = 0$. Then the length of $M$ as an $R$-module agrees with the dimension of $M$ as a $R/\\mathfrak m$ vector space. The length is finite if and only if $M$ is a finite $R$-module. \n\n    \n]] the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n","Proof.\n      If $R$ has finite length over itself then it satisfies both the ascending chain condition and the descending chain condition for ideals. Hence it is both Noetherian and Artinian. Any Artinian ring is equal to product of its localizations at maximal ideals by Lemmas 10.53.3 [[\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n]], 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]], and 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]]. \n    \n      Suppose that $R$ is Artinian. We will show $R$ has finite length over itself. It suffices to exhibit a chain of submodules whose successive quotients have finite length. By what we said above we may assume that $R$ is local, with maximal ideal $\\mathfrak m$. By Lemma 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]] we have $\\mathfrak m^ n =0$ for some $n$. Consider the sequence $0 = \\mathfrak m^ n \\subset \\mathfrak m^{n-1} \\subset \\ldots \\subset \\mathfrak m \\subset R$. By Lemma 10.52.6 [[\n  Lemma 10.52.6. Let $R$ be a ring with maximal ideal $\\mathfrak m$. Suppose that $M$ is an $R$-module with $\\mathfrak m M = 0$. Then the length of $M$ as an $R$-module agrees with the dimension of $M$ as a $R/\\mathfrak m$ vector space. The length is finite if and only if $M$ is a finite $R$-module. \n\n    \n]] the length of each subquotient $\\mathfrak m^ j/\\mathfrak m^{j + 1}$ is the dimension of this as a vector space over $\\kappa (\\mathfrak m)$. This has to be finite since otherwise we would have an infinite descending chain of sub vector spaces which would correspond to an infinite descending chain of ideals in $R$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: A ring is Artinian if and only if it has finite length as a module over itself","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean term applies a direction of the equivalence packaged in `IsArtinianRing.tfae` for `R` (using `.out 2 1` and then `.mp`), which matches the stated goal ‚ÄúArtinian iff finite length as a module over itself‚Äù by extracting one implication from that equivalence. Structurally, however, the informal proof gives a detailed two-direction argument (finite length ‚áí ACC/DCC ‚áí Noetherian+Artinian, and Artinian ‚áí finite length via reduction to local and a nilpotent maximal ideal filtration), while the formal proof is a one-line invocation of an existing theorem and does not mirror those steps. Completeness is partial: it proves only the selected implication (2 ‚Üí 1) rather than both directions as written informally, but it is consistent with using a pre-proved equivalence. No extraneous content appears in the Lean proof.""}"
227,00KH,"    IsArtinianRing R ‚Üî IsNoetherianRing R ‚àß Ring.KrullDimLE 0 R :=
  ‚ü®fun _ ‚Ü¶ ‚ü®inferInstance, inferInstance‚ü©, fun ‚ü®h, _‚ü© ‚Ü¶ h.isArtinianRing_of_krullDimLE_zero‚ü©
",Formal Proof of Stacks Project Tag 00KH, theorem isArtinianRing_iff_isNoetherianRing_krullDimLE_zero {R} [CommRing R] ,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/HopkinsLevitzki.lean#L177-L178,Q27041,,10.60.5,lemma,3.0,"['00KD', '00AO', '0ELQ']","\n  Lemma 10.60.5. A Noetherian ring of dimension $0$ is Artinian. Conversely, any Artinian ring is Noetherian of dimension zero. \n\n    \n      Proof.\n      Assume $R$ is a Noetherian ring of dimension $0$. By Lemma 10.31.5 the space $\\mathop{\\mathrm{Spec}}(R)$ is Noetherian. By Topology, Lemma 5.9.2 we see that $\\mathop{\\mathrm{Spec}}(R)$ has finitely many irreducible components, say $\\mathop{\\mathrm{Spec}}(R) = Z_1 \\cup \\ldots \\cup Z_ r$. According to Lemma 10.26.1 each $Z_ i = V(\\mathfrak p_ i)$ with $\\mathfrak p_ i$ a minimal ideal. Since the dimension is $0$ these $\\mathfrak p_ i$ are also maximal. Thus $\\mathop{\\mathrm{Spec}}(R)$ is the discrete topological space with elements $\\mathfrak p_ i$. All elements $f$ of the Jacobson radical $\\bigcap \\mathfrak p_ i$ are nilpotent since otherwise $R_ f$ would not be the zero ring and we would have another prime. By Lemma 10.53.5 $R$ is equal to $\\prod R_{\\mathfrak p_ i}$. Since $R_{\\mathfrak p_ i}$ is also Noetherian and dimension $0$, the previous arguments show that its radical $\\mathfrak p_ iR_{\\mathfrak p_ i}$ is locally nilpotent. Lemma 10.32.5 gives $\\mathfrak p_ i^ nR_{\\mathfrak p_ i} = 0$ for some $n \\geq 1$. By Lemma 10.52.8 we conclude that $R_{\\mathfrak p_ i}$ has finite length over $R$. Hence we conclude that $R$ is Artinian by Lemma 10.53.6. \n    \n      If $R$ is an Artinian ring then by Lemma 10.53.6 it is Noetherian. All of its primes are maximal by a combination of Lemmas 10.53.3, 10.53.4 and 10.53.5. \n      $\\square$\n    \n","\n  Lemma 10.60.5. A Noetherian ring of dimension $0$ is Artinian. Conversely, any Artinian ring is Noetherian of dimension zero. \n\n    \n","Proof.\n      Assume $R$ is a Noetherian ring of dimension $0$. By Lemma 10.31.5 the space $\\mathop{\\mathrm{Spec}}(R)$ is Noetherian. By Topology, Lemma 5.9.2 we see that $\\mathop{\\mathrm{Spec}}(R)$ has finitely many irreducible components, say $\\mathop{\\mathrm{Spec}}(R) = Z_1 \\cup \\ldots \\cup Z_ r$. According to Lemma 10.26.1 each $Z_ i = V(\\mathfrak p_ i)$ with $\\mathfrak p_ i$ a minimal ideal. Since the dimension is $0$ these $\\mathfrak p_ i$ are also maximal. Thus $\\mathop{\\mathrm{Spec}}(R)$ is the discrete topological space with elements $\\mathfrak p_ i$. All elements $f$ of the Jacobson radical $\\bigcap \\mathfrak p_ i$ are nilpotent since otherwise $R_ f$ would not be the zero ring and we would have another prime. By Lemma 10.53.5 $R$ is equal to $\\prod R_{\\mathfrak p_ i}$. Since $R_{\\mathfrak p_ i}$ is also Noetherian and dimension $0$, the previous arguments show that its radical $\\mathfrak p_ iR_{\\mathfrak p_ i}$ is locally nilpotent. Lemma 10.32.5 gives $\\mathfrak p_ i^ nR_{\\mathfrak p_ i} = 0$ for some $n \\geq 1$. By Lemma 10.52.8 we conclude that $R_{\\mathfrak p_ i}$ has finite length over $R$. Hence we conclude that $R$ is Artinian by Lemma 10.53.6. \n    \n      If $R$ is an Artinian ring then by Lemma 10.53.6 it is Noetherian. All of its primes are maximal by a combination of Lemmas 10.53.3, 10.53.4 and 10.53.5. \n      $\\square$\n    \n","
  ‚ü®fun _ ‚Ü¶ ‚ü®inferInstance, inferInstance‚ü©, fun ‚ü®h, _‚ü© ‚Ü¶ h.isArtinianRing_of_krullDimLE_zero‚ü©
",    IsArtinianRing R ‚Üî IsNoetherianRing R ‚àß Ring.KrullDimLE 0 R ,"Proof.\n      Assume $R$ is a Noetherian ring of dimension $0$. By Lemma 10.31.5 [[\n  Lemma 10.31.5. If $R$ is a Noetherian ring then $\\mathop{\\mathrm{Spec}}(R)$ is a Noetherian topological space, see Topology, Definition 5.9.1. \n\n    \n]] the space $\\mathop{\\mathrm{Spec}}(R)$ is Noetherian. By Topology, Lemma 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]] we see that $\\mathop{\\mathrm{Spec}}(R)$ has finitely many irreducible components, say $\\mathop{\\mathrm{Spec}}(R) = Z_1 \\cup \\ldots \\cup Z_ r$. According to Lemma 10.26.1 [[\n  Lemma 10.26.1. Let $R$ be a ring. \n  \n  \nFor a prime $\\mathfrak p \\subset R$ the closure of $\\{ \\mathfrak p\\} $ in the Zariski topology is $V(\\mathfrak p)$. In a formula $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. \n\n\nThe irreducible closed subsets of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a prime. \n\n\nThe irreducible components (see Topology, Definition 5.8.1) of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a minimal prime. \n\n\n\n\n    \n]] each $Z_ i = V(\\mathfrak p_ i)$ with $\\mathfrak p_ i$ a minimal ideal. Since the dimension is $0$ these $\\mathfrak p_ i$ are also maximal. Thus $\\mathop{\\mathrm{Spec}}(R)$ is the discrete topological space with elements $\\mathfrak p_ i$. All elements $f$ of the Jacobson radical $\\bigcap \\mathfrak p_ i$ are nilpotent since otherwise $R_ f$ would not be the zero ring and we would have another prime. By Lemma 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]] $R$ is equal to $\\prod R_{\\mathfrak p_ i}$. Since $R_{\\mathfrak p_ i}$ is also Noetherian and dimension $0$, the previous arguments show that its radical $\\mathfrak p_ iR_{\\mathfrak p_ i}$ is locally nilpotent. Lemma 10.32.5 [[\n       \n      \n  Lemma 10.32.5. Let $R$ be a Noetherian ring. Let $I, J$ be ideals of $R$. Suppose $J \\subset \\sqrt{I}$. Then $J^ n \\subset I$ for some $n$. In particular, in a Noetherian ring the notions of \xe2\x80\x9clocally nilpotent ideal\xe2\x80\x9d and \xe2\x80\x9cnilpotent ideal\xe2\x80\x9d coincide. \n\n    \n]] gives $\\mathfrak p_ i^ nR_{\\mathfrak p_ i} = 0$ for some $n \\geq 1$. By Lemma 10.52.8 [[\n  Lemma 10.52.8. Let $R$ be a ring with finitely generated maximal ideal $\\mathfrak m$. (For example $R$ Noetherian.) Suppose that $M$ is a finite $R$-module with $\\mathfrak m^ n M = 0$ for some $n$. Then $\\text{length}_ R(M) < \\infty $. \n\n    \n]] we conclude that $R_{\\mathfrak p_ i}$ has finite length over $R$. Hence we conclude that $R$ is Artinian by Lemma 10.53.6 [[\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n]]. \n    \n      If $R$ is an Artinian ring then by Lemma 10.53.6 [[\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n]] it is Noetherian. All of its primes are maximal by a combination of Lemmas 10.53.3 [[\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n]], 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]] and 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Assume $R$ is a Noetherian ring of dimension $0$. By Lemma 10.31.5 [[\n  Lemma 10.31.5. If $R$ is a Noetherian ring then $\\mathop{\\mathrm{Spec}}(R)$ is a Noetherian topological space, see Topology, Definition 5.9.1. \n\n    \n]] the space $\\mathop{\\mathrm{Spec}}(R)$ is Noetherian. By Topology, Lemma 5.9.2 [[\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n]] we see that $\\mathop{\\mathrm{Spec}}(R)$ has finitely many irreducible components, say $\\mathop{\\mathrm{Spec}}(R) = Z_1 \\cup \\ldots \\cup Z_ r$. According to Lemma 10.26.1 [[\n  Lemma 10.26.1. Let $R$ be a ring. \n  \n  \nFor a prime $\\mathfrak p \\subset R$ the closure of $\\{ \\mathfrak p\\} $ in the Zariski topology is $V(\\mathfrak p)$. In a formula $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. \n\n\nThe irreducible closed subsets of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a prime. \n\n\nThe irreducible components (see Topology, Definition 5.8.1) of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a minimal prime. \n\n\n\n\n    \n]] each $Z_ i = V(\\mathfrak p_ i)$ with $\\mathfrak p_ i$ a minimal ideal. Since the dimension is $0$ these $\\mathfrak p_ i$ are also maximal. Thus $\\mathop{\\mathrm{Spec}}(R)$ is the discrete topological space with elements $\\mathfrak p_ i$. All elements $f$ of the Jacobson radical $\\bigcap \\mathfrak p_ i$ are nilpotent since otherwise $R_ f$ would not be the zero ring and we would have another prime. By Lemma 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]] $R$ is equal to $\\prod R_{\\mathfrak p_ i}$. Since $R_{\\mathfrak p_ i}$ is also Noetherian and dimension $0$, the previous arguments show that its radical $\\mathfrak p_ iR_{\\mathfrak p_ i}$ is locally nilpotent. Lemma 10.32.5 [[\n       \n      \n  Lemma 10.32.5. Let $R$ be a Noetherian ring. Let $I, J$ be ideals of $R$. Suppose $J \\subset \\sqrt{I}$. Then $J^ n \\subset I$ for some $n$. In particular, in a Noetherian ring the notions of \xe2\x80\x9clocally nilpotent ideal\xe2\x80\x9d and \xe2\x80\x9cnilpotent ideal\xe2\x80\x9d coincide. \n\n    \n]] gives $\\mathfrak p_ i^ nR_{\\mathfrak p_ i} = 0$ for some $n \\geq 1$. By Lemma 10.52.8 [[\n  Lemma 10.52.8. Let $R$ be a ring with finitely generated maximal ideal $\\mathfrak m$. (For example $R$ Noetherian.) Suppose that $M$ is a finite $R$-module with $\\mathfrak m^ n M = 0$ for some $n$. Then $\\text{length}_ R(M) < \\infty $. \n\n    \n]] we conclude that $R_{\\mathfrak p_ i}$ has finite length over $R$. Hence we conclude that $R$ is Artinian by Lemma 10.53.6 [[\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n]]. \n    \n      If $R$ is an Artinian ring then by Lemma 10.53.6 [[\n  Lemma 10.53.6. A ring $R$ is Artinian if and only if it has finite length as a module over itself. Any such ring $R$ is both Artinian and Noetherian, any prime ideal of $R$ is a maximal ideal, and $R$ is equal to the (finite) product of its localizations at its maximal ideals. \n\n    \n]] it is Noetherian. All of its primes are maximal by a combination of Lemmas 10.53.3 [[\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n]], 10.53.4 [[\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n]] and 10.53.5 [[\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem isArtinianRing_iff_isNoetherianRing_krullDimLE_zero {R} [CommRing R]","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish the same equivalence: for a commutative ring R, being Artinian is equivalent to being Noetherian together with Krull dimension ‚â§ 0. The Lean term is a concise constructor for an iff: the forward direction produces (IsNoetherianRing R) and (krullDimLE 0) via typeclass inference, matching the informal argument that an Artinian ring is Noetherian and has all primes maximal (hence dim ‚â§ 0). The backward direction takes ‚ü®h, _‚ü© (Noetherian plus dim ‚â§ 0) and applies a lemma h.isArtinianRing_of_krullDimLE_zero, matching the informal direction ‚ÄòNoetherian + dim 0 ‚áí Artinian‚Äô. Structurally, however, the informal proof gives a long geometric/topological decomposition of Spec(R) and uses several intermediate lemmas (finite irreducible components, minimal=maximal primes, Jacobson radical nilpotent, product decomposition, finite length) whereas the Lean proof collapses this entire direction into a single existing lemma. So the high-level structure (two implications) aligns, but the internal steps do not correspond one-to-one, and the Lean proof omits the detailed reasoning present informally (though not semantically necessary if encapsulated in the lemma). No extraneous content appears in the Lean proof.""}"
229,00DV,"theorem eq_bot_of_le_smul_of_le_jacobson_bot (I : Ideal R) (N : Submodule R M) (hN : N.FG)
    (hIN : N ‚â§ I ‚Ä¢ N) (hIjac : I ‚â§ jacobson ‚ä•) : N = ‚ä• := by
  rw [eq_smul_of_le_smul_of_le_jacobson hN hIN hIjac, Submodule.bot_smul]
",Formal Proof of Stacks Project Tag 00DV,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Nakayama.lean#L118-L120,Q27041,Nakayama's lemma,10.20.1,lemma,3.0,"['07RC', '00AO', '0ELQ']","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n"," by
  rw [eq_smul_of_le_smul_of_le_jacobson hN hIN hIjac, Submodule.bot_smul]
","theorem eq_bot_of_le_smul_of_le_jacobson_bot (I : Ideal R) (N : Submodule R M) (hN : N.FG)
    (hIN : N ‚â§ I ‚Ä¢ N) (hIjac : I ‚â§ jacobson ‚ä•) : N = ‚ä• ","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is a one-line rewrite using a lemma `eq_smul_of_le_smul_of_le_jacobson hN hIN hIjac` and then `Submodule.bot_smul`, i.e. it concludes an equality of the form ‚Äú(something) = (‚ä• : Submodule ‚Ä¶) ‚Ä¢ (something)‚Äù and simplifies ‚ä•-scalar action. This matches only a very high-level Jacobson-radical/Nakayama-style conclusion (likely the informal statement‚Äôs item (2) about invertibility or a consequence like N = ‚ä•/M = 0), but it does not reflect the informal proof‚Äôs actual argument.\nStructurally, the informal proof for (1) (and then (1)‚áí(2)) proceeds via choosing generators, building a matrix A with entries in I, taking its determinant f ‚àà 1+I, using a minors/determinant lemma to get BA = f¬∑Id, deducing f annihilates M, and then using the Jacobson radical criterion to conclude f is a unit and hence M = 0 (or the relevant consequence). None of these steps (generators, matrices, determinant, annihilator, unit argument) appear in the Lean proof; instead it relies on a prepackaged lemma encapsulating the whole reasoning. Thus the Lean proof is at best a compressed invocation of a result corresponding to the informal theorem, but it is not structurally aligned and omits essentially all intermediate content.""}"
230,00DV,"theorem smul_le_of_le_smul_of_le_jacobson_bot {I : Ideal R} {N N' : Submodule R M} (hN' : N'.FG)
    (hIJ : I ‚â§ jacobson ‚ä•) (hNN : N' ‚â§ N ‚äî I ‚Ä¢ N') : I ‚Ä¢ N' ‚â§ N :=
  smul_le_right.trans (le_of_le_smul_of_le_jacobson_bot hN' hIJ hNN)
",Formal Proof of Stacks Project Tag 00DV,(4),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Nakayama.lean#L156-L158,Q27041,Nakayama's lemma,10.20.1,lemma,3.0,"['07RC', '00AO', '0ELQ']","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","
  smul_le_right.trans (le_of_le_smul_of_le_jacobson_bot hN' hIJ hNN)
","theorem smul_le_of_le_smul_of_le_jacobson_bot {I : Ideal R} {N N' : Submodule R M} (hN' : N'.FG)
    (hIJ : I ‚â§ jacobson ‚ä•) (hNN : N' ‚â§ N ‚äî I ‚Ä¢ N') : I ‚Ä¢ N' ‚â§ N ","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (4)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof is a long argument (Nakayama-style) using generators, a determinant f ‚àà 1+I, a matrix lemma to get BA = f¬∑Id, concluding f annihilates M, and then using Jacobson radical/unit arguments to derive several numbered implications (including the referenced part (4) via applying (2) to M/N). The Lean snippet, however, is a one-line order/inequality-style composition: `smul_le_right.trans (le_of_le_smul_of_le_jacobson_bot hN' hIJ hNN)`, which appears to chain two lemmas about scalar multiplication preserving an order and a Jacobson-radical-related inequality. Structurally, it does not reflect the generator/matrix/determinant construction nor the multi-step implication chain in the informal proof; it looks like a local monotonicity/transitivity step inside a larger formal development. While the mention of `jacobson_bot` suggests some thematic connection to Jacobson radical arguments (relevant to Nakayama), the provided Lean line alone does not capture the core content or structure of the informal proof for (4), and omits the key constructions and reasoning. Hence only weak thematic/semantic overlap and poor structural correspondence.""}"
231,00DV,"lemma exists_sub_one_mem_and_smul_le_of_fg_of_le_sup {I : Ideal R}
    {N N' P : Submodule R M} (hN' : N'.FG) (hN'le : N' ‚â§ P) (hNN' : P ‚â§ N ‚äî I ‚Ä¢ N') :
    ‚àÉ r : R, r - 1 ‚àà I ‚àß r ‚Ä¢ P ‚â§ N := by
  have hNN'' : P ‚â§ N ‚äî N' := le_trans hNN' (by simpa using le_trans smul_le_right le_sup_right)
  have h1 : P.map N.mkQ = N'.map N.mkQ := by
    refine le_antisymm ?_ (map_mono hN'le)
    simpa using map_mono (f := N.mkQ) hNN''
  have h2 : P.map N.mkQ = (I ‚Ä¢ N').map N.mkQ := by
    apply le_antisymm
    ¬∑ simpa using map_mono (f := N.mkQ) hNN'
    ¬∑ rw [h1]
      simp [smul_le_right]
  have hle : (P.map N.mkQ) ‚â§ I ‚Ä¢ P.map N.mkQ := by
    conv_lhs => rw [h2]
    simp [‚Üê h1]
  obtain ‚ü®r, hmem, hr‚ü© := exists_sub_one_mem_and_smul_eq_zero_of_fg_of_le_smul I _
    (h1 ‚ñ∏ hN'.map _) hle
  refine ‚ü®r, hmem, fun x hx ‚Ü¶ ?_‚ü©
  induction hx using Submodule.smul_inductionOn_pointwise with
  | smul‚ÇÄ p hp =>
    rw [‚Üê Submodule.Quotient.mk_eq_zero, Quotient.mk_smul]
    exact hr _ ‚ü®p, hp, rfl‚ü©
  | smul‚ÇÅ _ _ _ h => exact N.smul_mem _ h
  | add _ _ _ _ hx hy => exact N.add_mem hx hy
  | zero => exact N.zero_mem
",Formal Proof of Stacks Project Tag 00DV,(3) see `Submodule.localized‚ÇÄ_le_localized‚ÇÄ_of_smul_le` for the second conclusion.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Nakayama.lean#L162-L186,Q27041,Nakayama's lemma,10.20.1,lemma,3.0,"['07RC', '00AO', '0ELQ']","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n"," by
  have hNN'' : P ‚â§ N ‚äî N' := le_trans hNN' (by simpa using le_trans smul_le_right le_sup_right)
  have h1 : P.map N.mkQ = N'.map N.mkQ := by
    refine le_antisymm ?_ (map_mono hN'le)
    simpa using map_mono (f := N.mkQ) hNN''
  have h2 : P.map N.mkQ = (I ‚Ä¢ N').map N.mkQ := by
    apply le_antisymm
    ¬∑ simpa using map_mono (f := N.mkQ) hNN'
    ¬∑ rw [h1]
      simp [smul_le_right]
  have hle : (P.map N.mkQ) ‚â§ I ‚Ä¢ P.map N.mkQ := by
    conv_lhs => rw [h2]
    simp [‚Üê h1]
  obtain ‚ü®r, hmem, hr‚ü© := exists_sub_one_mem_and_smul_eq_zero_of_fg_of_le_smul I _
    (h1 ‚ñ∏ hN'.map _) hle
  refine ‚ü®r, hmem, fun x hx ‚Ü¶ ?_‚ü©
  induction hx using Submodule.smul_inductionOn_pointwise with
  | smul‚ÇÄ p hp =>
    rw [‚Üê Submodule.Quotient.mk_eq_zero, Quotient.mk_smul]
    exact hr _ ‚ü®p, hp, rfl‚ü©
  | smul‚ÇÅ _ _ _ h => exact N.smul_mem _ h
  | add _ _ _ _ hx hy => exact N.add_mem hx hy
  | zero => exact N.zero_mem
","lemma exists_sub_one_mem_and_smul_le_of_fg_of_le_sup {I : Ideal R}
    {N N' P : Submodule R M} (hN' : N'.FG) (hN'le : N' ‚â§ P) (hNN' : P ‚â§ N ‚äî I ‚Ä¢ N') :
    ‚àÉ r : R, r - 1 ‚àà I ‚àß r ‚Ä¢ P ‚â§ N ","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3) see `Submodule.localized‚ÇÄ_le_localized‚ÇÄ_of_smul_le` for the second conclusion.","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about submodules under a quotient/localization-like map `N.mkQ`, comparing images `P.map N.mkQ` and `N'.map N.mkQ`, deriving a condition `P.map ‚â§ I ‚Ä¢ P.map`, and then using a finite-generation Nakayama-style lemma (`exists_sub_one_mem_and_smul_eq_zero_of_fg_of_le_smul`) to produce an element `r ‚àà 1 + I` annihilating something, followed by an induction showing closure under smul/add/zero. The informal proof, however, is the classical determinant/matrix proof of Nakayama‚Äôs lemma: choose generators, form a matrix congruent to identity mod I, take its determinant in `1+I`, use a minors lemma to get a matrix inverse up to scalar, and conclude the determinant annihilates M; then it discusses implications (1)‚Üí(2) via Jacobson radical and derives other numbered parts.\n\nStructurally, the informal proof‚Äôs key steps (constructing the matrix A, determinant f, applying the minors lemma, and concluding f kills generators) do not appear in the Lean proof. The Lean proof instead relies on an existing lemma that packages the finite-generation argument, and it works in a mapped/quotient setting rather than explicitly on generators. There is some thematic overlap (producing `r ‚àà 1+I` with a smul-equals-zero conclusion, consistent with Nakayama-type results, and the user comment about a ‚Äúsecond conclusion‚Äù suggests this is part (3) in the informal list), but the specific argument and intermediate objects are different.\n\nCompleteness/precision: the Lean proof does not cover the informal proof‚Äôs later implications (Jacobson radical/unit argument, parts (4)‚Äì(12)), and it omits the determinant/minors construction entirely. Thus it only partially matches the informal proof‚Äôs content and structure, even if it proves a related Nakayama-style statement.""}"
232,00DV,"theorem exists_injOn_mkQ_image_span_eq_of_span_eq_map_mkQ_of_le_jacobson_bot
    {I : Ideal R} {N : Submodule R M} (s : Set (M ‚ß∏ (I ‚Ä¢ N)))
    (hN : N.FG) (hIjac : I ‚â§ jacobson ‚ä•) (hsspan : span R s = map (I ‚Ä¢ N).mkQ N) :
    ‚àÉ (t : Set M), t.InjOn (I ‚Ä¢ N).mkQ ‚àß (I ‚Ä¢ N).mkQ '' t = s ‚àß span R t = N := by
  use Quotient.out '' s
  split_ands
  ¬∑ simp [Set.InjOn]
  ¬∑ simp [Set.image_image]
  ¬∑ symm; apply eq_of_map_mkQ_eq_map_mkQ_of_le_jacobson_bot hN hIjac
    simp [‚Üê hsspan, map_span, Set.image_image]
",Formal Proof of Stacks Project Tag 00DV,(8),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Nakayama.lean#L220-L229,Q27041,Nakayama's lemma,10.20.1,lemma,3.0,"['07RC', '00AO', '0ELQ']","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n"," by
  use Quotient.out '' s
  split_ands
  ¬∑ simp [Set.InjOn]
  ¬∑ simp [Set.image_image]
  ¬∑ symm; apply eq_of_map_mkQ_eq_map_mkQ_of_le_jacobson_bot hN hIjac
    simp [‚Üê hsspan, map_span, Set.image_image]
","theorem exists_injOn_mkQ_image_span_eq_of_span_eq_map_mkQ_of_le_jacobson_bot
    {I : Ideal R} {N : Submodule R M} (s : Set (M ‚ß∏ (I ‚Ä¢ N)))
    (hN : N.FG) (hIjac : I ‚â§ jacobson ‚ä•) (hsspan : span R s = map (I ‚Ä¢ N).mkQ N) :
    ‚àÉ (t : Set M), t.InjOn (I ‚Ä¢ N).mkQ ‚àß (I ‚Ä¢ N).mkQ '' t = s ‚àß span R t = N ","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (8)","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is a commutative algebra argument (Nakayama-style): choose generators of a finite module M, build a matrix A ‚â° I mod I, take its determinant f ‚àà 1+I, use a minors/determinant lemma to get BA = f¬∑Id, deduce f annihilates M, then use a Jacobson-radical/unit lemma to conclude. It then derives further numbered parts (including (8)) by applying earlier parts to quotients/maps.\n\nThe Lean proof instead constructs an object using `Quotient.out '' s`, proves injectivity-on and image-image simp facts, and finishes by an equality obtained via `eq_of_map_mkQ_eq_map_mkQ_of_le_jacobson_bot hN hIjac` plus span/map manipulations. This is about quotients, images, and spans under a quotient map, not about finite generation, matrices, determinants, annihilators, or units in 1+I.\n\nSemantically, the goals and key ideas do not match: the Lean code does not formalize the determinant/unit/Nakayama argument nor the reduction steps described for part (8). Structurally, the Lean proof is a short set/image/quotient manipulation, whereas the informal proof is a multi-step algebraic construction. Hence the alignment is essentially absent.""}"
233,00OW,"theorem exists_integral_inj_algHom_of_fg : ‚àÉ s, ‚àÉ g : (MvPolynomial (Fin s) k) ‚Üí‚Çê[k] R,
    Function.Injective g ‚àß g.IsIntegral := by
  obtain ‚ü®n, f, fsurj‚ü© := Algebra.FiniteType.iff_quotient_mvPolynomial''.mp fin
  set œï := quotientKerAlgEquivOfSurjective fsurj
  obtain ‚ü®s, _, g, injg, intg‚ü© := exists_integral_inj_algHom_of_quotient (ker f) (ker_ne_top _)
  use s, œï.toAlgHom.comp g
  simp only [AlgEquiv.toAlgHom_eq_coe, AlgHom.coe_comp, AlgHom.coe_coe,
    EmbeddingLike.comp_injective, AlgHom.toRingHom_eq_coe]
  exact ‚ü®injg, intg.trans _ _ (isIntegral_of_surjective _ œï.surjective)‚ü©
",Formal Proof of Stacks Project Tag 00OW,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/NoetherNormalization.lean#L275-L283,Q27041,Noether normalization,10.115,section,2.0,"['00AO', '0ELQ']","10.115 Noether normalization\n\n\nIn this section we prove variants of the Noether normalization lemma. The key ingredient we will use is contained in the following two lemmas. \n\n\n\n  Lemma 10.115.1. Let $n \\in \\mathbf{N}$. Let $N$ be a finite nonempty set of multi-indices $\\nu = (\\nu _1, \\ldots , \\nu _ n)$. Given $e = (e_1, \\ldots , e_ n)$ we set $e \\cdot \\nu = \\sum e_ i\\nu _ i$. Then for $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n$ we have: If $\\nu , \\nu \' \\in N$ then \n  \n  \\[  (e \\cdot \\nu = e \\cdot \\nu \') \\Leftrightarrow (\\nu = \\nu \')  \\]\n\n \n\n\n    \n      Proof.\n      Say $N = \\{ \\nu _ j\\} $ with $\\nu _ j = (\\nu _{j1}, \\ldots , \\nu _{jn})$. Let $A_ i = \\max _ j \\nu _{ji} - \\min _ j \\nu _{ji}$. If for each $i$ we have $e_{i - 1} > A_ ie_ i + A_{i + 1}e_{i + 1} + \\ldots + A_ ne_ n$ then the lemma holds. For suppose that $e \\cdot (\\nu - \\nu \') = 0$. Then for $n \\ge 2$, \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) = \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       We may assume that $(\\nu _1 - \\nu \'_1) \\ge 0$. If $(\\nu _1 - \\nu \'_1) > 0$, then \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) \\ge e_1 > A_2e_2 + \\ldots + A_ ne_ n \\ge \\sum \\nolimits _{i = 2}^ n e_ i|\\nu \'_ i - \\nu _ i| \\ge \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       This contradiction implies that $\\nu \'_1 = \\nu _1$. By induction, $\\nu \'_ i = \\nu _ i$ for $2 \\le i \\le n$. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n \n\n\n    \n      Proof.\n      Write $g = \\sum _{\\nu \\in N} a_\\nu x^\\nu $ with $a_\\nu \\in R$ not zero. Here $N$ is a finite set of multi-indices as in Lemma 10.115.1 and $x^\\nu = x_1^{\\nu _1} \\ldots x_ n^{\\nu _ n}$. Note that the leading term in \n    \n      \n  \\[  (x_1 + x_ n^{e_1})^{\\nu _1} \\ldots (x_{n-1} + x_ n^{e_{n-1}})^{\\nu _{n-1}} x_ n^{\\nu _ n} \\quad \\text{is}\\quad x_ n^{e_1\\nu _1 + \\ldots + e_{n-1}\\nu _{n-1} + \\nu _ n}.  \\]\n\n    \n       Hence the lemma follows from Lemma 10.115.1 which guarantees that there is exactly one nonzero term $a_\\nu x^\\nu $ of $g$ which gives rise to the leading term of $g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n)$, i.e., $a = a_\\nu $ for the unique $\\nu \\in N$ such that $e \\cdot \\nu $ is maximal. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.3. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      Pick $f \\in I$, $f\\not= 0$. It suffices to show the lemma for $k[x_1, \\ldots , x_ n]/(f)$ since $S$ is a quotient of that ring. We will take $y_ i = x_ i - x_ n^{e_ i}$, $i = 1, \\ldots , n-1$ for suitable integers $e_ i$. When does this work? It suffices to show that $\\overline{x_ n} \\in k[x_1, \\ldots , x_ n]/(f)$ is integral over the ring $k[y_1, \\ldots , y_{n-1}]$. The equation for $\\overline{x_ n}$ over this ring is \n    \n      \n  \\[  f(y_1 + x_ n^{e_1}, \\ldots , y_{n-1} + x_ n^{e_{n-1}}, x_ n) = 0.  \\]\n\n    \n       Hence we are done if we can show there exists integers $e_ i$ such that the leading coefficient with respect to $x_ n$ of the equation above is a nonzero element of $k$. This can be achieved for example by choosing $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1}$, see Lemma 10.115.2. \n      $\\square$\n    \n\n\n\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      By induction on $n$, with $n = 0$ being trivial. If $I = 0$, then take $r = n$ and $y_ i = x_ i$. If $I \\not= 0$, then choose $y_1, \\ldots , y_{n-1}$ as in Lemma 10.115.3. Let $S\' \\subset S$ be the subring generated by the images of the $y_ i$. By induction we can choose $r$ and $z_1, \\ldots , z_ r \\in k[y_1, \\ldots , y_{n-1}]$ such that (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S\'$. Since $S\' \\to S$ is injective and finite we see (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S$. The last assertion follows from Lemma 10.112.4. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.5. Let $k$ be a field. Let $S$ be a finite type $k$ algebra and denote $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q$ be a prime of $S$, and let $x \\in X$ be the corresponding point. There exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $\\dim (S_ g) = \\dim _ x(X) =: d$ and such that there exists a finite injective map $k[y_1, \\ldots , y_ d] \\to S_ g$. \n \n\n\n    \n      Proof.\n      Note that by definition $\\dim _ x(X)$ is the minimum of the dimensions of $S_ g$ for $g \\in S$, $g \\not\\in \\mathfrak q$, i.e., the minimum is attained. Thus the lemma follows from Lemma 10.115.4. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.6. Let $k$ be a field. Let $\\mathfrak q \\subset k[x_1, \\ldots , x_ n]$ be a prime ideal. Set $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak q)$. Then there exists a finite ring map $\\varphi : k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]$ such that $\\varphi ^{-1}(\\mathfrak q) = (y_{r + 1}, \\ldots , y_ n)$. \n \n\n\n    \n      Proof.\n      By induction on $n$. The case $n = 0$ is clear. Assume $n > 0$. If $r = n$, then $\\mathfrak q = (0)$ and the result is clear. Choose a nonzero $f \\in \\mathfrak q$. Of course $f$ is nonconstant. After applying an automorphism of the form \n    \n      \n  \\[  k[x_1, \\ldots , x_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad x_ n \\mapsto x_ n, \\quad x_ i \\mapsto x_ i + x_ n^{e_ i}\\  (i < n)  \\]\n\n    \n       we may assume that $f$ is monic in $x_ n$ over $k[x_1, \\ldots , x_ n]$, see Lemma 10.115.2. Hence the ring map \n    \n      \n  \\[  k[y_1, \\ldots , y_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad y_ n \\mapsto f, \\quad y_ i \\mapsto x_ i\\  (i < n)  \\]\n\n    \n       is finite. Moreover $y_ n \\in \\mathfrak q \\cap k[y_1, \\ldots , y_ n]$ by construction. Thus $\\mathfrak q \\cap k[y_1, \\ldots , y_ n] = \\mathfrak pk[y_1, \\ldots , y_ n] + (y_ n)$ where $\\mathfrak p \\subset k[y_1, \\ldots , y_{n - 1}]$ is a prime ideal. Note that $\\kappa (\\mathfrak p) \\subset \\kappa (\\mathfrak q)$ is finite, and hence $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak p)$. Apply the induction hypothesis to the pair $(k[y_1, \\ldots , y_{n - 1}], \\mathfrak p)$ and we obtain a finite ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ such that $\\mathfrak p \\cap k[z_1, \\ldots , z_{n - 1}] = (z_{r + 1}, \\ldots , z_{n - 1})$. We extend the ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ to a ring map $k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n]$ by mapping $z_ n$ to $y_ n$. The composition of the ring maps \n    \n      \n  \\[  k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]  \\]\n\n    \n       solves the problem. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.7. Let $R \\to S$ be an injective finite type ring map. Assume $R$ is a domain. Then there exists an integer $d$ and a factorization \n  \n  \\[  R \\to R[y_1, \\ldots , y_ d] \\to S\' \\to S  \\]\n\n   by injective maps such that $S\'$ is finite over $R[y_1, \\ldots , y_ d]$ and such that $S\'_ f \\cong S_ f$ for some nonzero $f \\in R$. \n \n\n\n    \n      Proof.\n      Pick $x_1, \\ldots , x_ n \\in S$ which generate $S$ over $R$. Let $K$ be the fraction field of $R$ and $S_ K = S \\otimes _ R K$. By Lemma 10.115.4 we can find $y_1, \\ldots , y_ d \\in S$ such that $K[y_1, \\ldots , y_ d] \\to S_ K$ is a finite injective map. Note that $y_ i \\in S$ because we may pick the $y_ j$ in the $\\mathbf{Z}$-algebra generated by $x_1, \\ldots , x_ n$. As a finite ring map is integral (see Lemma 10.36.3) we can find monic $P_ i \\in K[y_1, \\ldots , y_ d][T]$ such that $P_ i(x_ i) = 0$ in $S_ K$. Let $f \\in R$ be a nonzero element such that $fP_ i \\in R[y_1, \\ldots , y_ d][T]$ for all $i$. Then $fP_ i(x_ i)$ maps to zero in $S_ K$. Hence after replacing $f$ by another nonzero element of $R$ we may also assume $fP_ i(x_ i)$ is zero in $S$. Set $x_ i\' = fx_ i$ and let $S\' \\subset S$ be the $R$-subalgebra generated by $y_1, \\ldots , y_ d$ and $x\'_1, \\ldots , x\'_ n$. Note that $x\'_ i$ is integral over $R[y_1, \\ldots , y_ d]$ as we have $Q_ i(x_ i\') = 0$ where $Q_ i = f^{\\deg _ T(P_ i)}P_ i(T/f)$ which is a monic polynomial in $T$ with coefficients in $R[y_1, \\ldots , y_ d]$ by our choice of $f$. Hence $R[y_1, \\ldots , y_ d] \\subset S\'$ is finite by Lemma 10.36.5. Since $S\' \\subset S$ we have $S\'_ f \\subset S_ f$ (localization is exact). On the other hand, the elements $x_ i = x\'_ i/f$ in $S\'_ f$ generate $S_ f$ over $R_ f$ and hence $S\'_ f \\to S_ f$ is surjective. Whence $S\'_ f \\cong S_ f$ and we win. \n      $\\square$\n    \n\n","10.115 Noether normalization\n\n\nIn this section we prove variants of the Noether normalization lemma. The key ingredient we will use is contained in the following two lemmas. \n\n\n\n  Lemma 10.115.1. Let $n \\in \\mathbf{N}$. Let $N$ be a finite nonempty set of multi-indices $\\nu = (\\nu _1, \\ldots , \\nu _ n)$. Given $e = (e_1, \\ldots , e_ n)$ we set $e \\cdot \\nu = \\sum e_ i\\nu _ i$. Then for $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n$ we have: If $\\nu , \\nu \' \\in N$ then \n  \n  \\[  (e \\cdot \\nu = e \\cdot \\nu \') \\Leftrightarrow (\\nu = \\nu \')  \\]\n\n \n\n\n    \n","Proof.\n      Say $N = \\{ \\nu _ j\\} $ with $\\nu _ j = (\\nu _{j1}, \\ldots , \\nu _{jn})$. Let $A_ i = \\max _ j \\nu _{ji} - \\min _ j \\nu _{ji}$. If for each $i$ we have $e_{i - 1} > A_ ie_ i + A_{i + 1}e_{i + 1} + \\ldots + A_ ne_ n$ then the lemma holds. For suppose that $e \\cdot (\\nu - \\nu \') = 0$. Then for $n \\ge 2$, \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) = \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       We may assume that $(\\nu _1 - \\nu \'_1) \\ge 0$. If $(\\nu _1 - \\nu \'_1) > 0$, then \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) \\ge e_1 > A_2e_2 + \\ldots + A_ ne_ n \\ge \\sum \\nolimits _{i = 2}^ n e_ i|\\nu \'_ i - \\nu _ i| \\ge \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       This contradiction implies that $\\nu \'_1 = \\nu _1$. By induction, $\\nu \'_ i = \\nu _ i$ for $2 \\le i \\le n$. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n \n\n\n    \n      Proof.\n      Write $g = \\sum _{\\nu \\in N} a_\\nu x^\\nu $ with $a_\\nu \\in R$ not zero. Here $N$ is a finite set of multi-indices as in Lemma 10.115.1 and $x^\\nu = x_1^{\\nu _1} \\ldots x_ n^{\\nu _ n}$. Note that the leading term in \n    \n      \n  \\[  (x_1 + x_ n^{e_1})^{\\nu _1} \\ldots (x_{n-1} + x_ n^{e_{n-1}})^{\\nu _{n-1}} x_ n^{\\nu _ n} \\quad \\text{is}\\quad x_ n^{e_1\\nu _1 + \\ldots + e_{n-1}\\nu _{n-1} + \\nu _ n}.  \\]\n\n    \n       Hence the lemma follows from Lemma 10.115.1 which guarantees that there is exactly one nonzero term $a_\\nu x^\\nu $ of $g$ which gives rise to the leading term of $g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n)$, i.e., $a = a_\\nu $ for the unique $\\nu \\in N$ such that $e \\cdot \\nu $ is maximal. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.3. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      Pick $f \\in I$, $f\\not= 0$. It suffices to show the lemma for $k[x_1, \\ldots , x_ n]/(f)$ since $S$ is a quotient of that ring. We will take $y_ i = x_ i - x_ n^{e_ i}$, $i = 1, \\ldots , n-1$ for suitable integers $e_ i$. When does this work? It suffices to show that $\\overline{x_ n} \\in k[x_1, \\ldots , x_ n]/(f)$ is integral over the ring $k[y_1, \\ldots , y_{n-1}]$. The equation for $\\overline{x_ n}$ over this ring is \n    \n      \n  \\[  f(y_1 + x_ n^{e_1}, \\ldots , y_{n-1} + x_ n^{e_{n-1}}, x_ n) = 0.  \\]\n\n    \n       Hence we are done if we can show there exists integers $e_ i$ such that the leading coefficient with respect to $x_ n$ of the equation above is a nonzero element of $k$. This can be achieved for example by choosing $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1}$, see Lemma 10.115.2. \n      $\\square$\n    \n\n\n\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      By induction on $n$, with $n = 0$ being trivial. If $I = 0$, then take $r = n$ and $y_ i = x_ i$. If $I \\not= 0$, then choose $y_1, \\ldots , y_{n-1}$ as in Lemma 10.115.3. Let $S\' \\subset S$ be the subring generated by the images of the $y_ i$. By induction we can choose $r$ and $z_1, \\ldots , z_ r \\in k[y_1, \\ldots , y_{n-1}]$ such that (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S\'$. Since $S\' \\to S$ is injective and finite we see (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S$. The last assertion follows from Lemma 10.112.4. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.5. Let $k$ be a field. Let $S$ be a finite type $k$ algebra and denote $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q$ be a prime of $S$, and let $x \\in X$ be the corresponding point. There exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $\\dim (S_ g) = \\dim _ x(X) =: d$ and such that there exists a finite injective map $k[y_1, \\ldots , y_ d] \\to S_ g$. \n \n\n\n    \n      Proof.\n      Note that by definition $\\dim _ x(X)$ is the minimum of the dimensions of $S_ g$ for $g \\in S$, $g \\not\\in \\mathfrak q$, i.e., the minimum is attained. Thus the lemma follows from Lemma 10.115.4. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.6. Let $k$ be a field. Let $\\mathfrak q \\subset k[x_1, \\ldots , x_ n]$ be a prime ideal. Set $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak q)$. Then there exists a finite ring map $\\varphi : k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]$ such that $\\varphi ^{-1}(\\mathfrak q) = (y_{r + 1}, \\ldots , y_ n)$. \n \n\n\n    \n      Proof.\n      By induction on $n$. The case $n = 0$ is clear. Assume $n > 0$. If $r = n$, then $\\mathfrak q = (0)$ and the result is clear. Choose a nonzero $f \\in \\mathfrak q$. Of course $f$ is nonconstant. After applying an automorphism of the form \n    \n      \n  \\[  k[x_1, \\ldots , x_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad x_ n \\mapsto x_ n, \\quad x_ i \\mapsto x_ i + x_ n^{e_ i}\\  (i < n)  \\]\n\n    \n       we may assume that $f$ is monic in $x_ n$ over $k[x_1, \\ldots , x_ n]$, see Lemma 10.115.2. Hence the ring map \n    \n      \n  \\[  k[y_1, \\ldots , y_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad y_ n \\mapsto f, \\quad y_ i \\mapsto x_ i\\  (i < n)  \\]\n\n    \n       is finite. Moreover $y_ n \\in \\mathfrak q \\cap k[y_1, \\ldots , y_ n]$ by construction. Thus $\\mathfrak q \\cap k[y_1, \\ldots , y_ n] = \\mathfrak pk[y_1, \\ldots , y_ n] + (y_ n)$ where $\\mathfrak p \\subset k[y_1, \\ldots , y_{n - 1}]$ is a prime ideal. Note that $\\kappa (\\mathfrak p) \\subset \\kappa (\\mathfrak q)$ is finite, and hence $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak p)$. Apply the induction hypothesis to the pair $(k[y_1, \\ldots , y_{n - 1}], \\mathfrak p)$ and we obtain a finite ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ such that $\\mathfrak p \\cap k[z_1, \\ldots , z_{n - 1}] = (z_{r + 1}, \\ldots , z_{n - 1})$. We extend the ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ to a ring map $k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n]$ by mapping $z_ n$ to $y_ n$. The composition of the ring maps \n    \n      \n  \\[  k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]  \\]\n\n    \n       solves the problem. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.7. Let $R \\to S$ be an injective finite type ring map. Assume $R$ is a domain. Then there exists an integer $d$ and a factorization \n  \n  \\[  R \\to R[y_1, \\ldots , y_ d] \\to S\' \\to S  \\]\n\n   by injective maps such that $S\'$ is finite over $R[y_1, \\ldots , y_ d]$ and such that $S\'_ f \\cong S_ f$ for some nonzero $f \\in R$. \n \n\n\n    \n      Proof.\n      Pick $x_1, \\ldots , x_ n \\in S$ which generate $S$ over $R$. Let $K$ be the fraction field of $R$ and $S_ K = S \\otimes _ R K$. By Lemma 10.115.4 we can find $y_1, \\ldots , y_ d \\in S$ such that $K[y_1, \\ldots , y_ d] \\to S_ K$ is a finite injective map. Note that $y_ i \\in S$ because we may pick the $y_ j$ in the $\\mathbf{Z}$-algebra generated by $x_1, \\ldots , x_ n$. As a finite ring map is integral (see Lemma 10.36.3) we can find monic $P_ i \\in K[y_1, \\ldots , y_ d][T]$ such that $P_ i(x_ i) = 0$ in $S_ K$. Let $f \\in R$ be a nonzero element such that $fP_ i \\in R[y_1, \\ldots , y_ d][T]$ for all $i$. Then $fP_ i(x_ i)$ maps to zero in $S_ K$. Hence after replacing $f$ by another nonzero element of $R$ we may also assume $fP_ i(x_ i)$ is zero in $S$. Set $x_ i\' = fx_ i$ and let $S\' \\subset S$ be the $R$-subalgebra generated by $y_1, \\ldots , y_ d$ and $x\'_1, \\ldots , x\'_ n$. Note that $x\'_ i$ is integral over $R[y_1, \\ldots , y_ d]$ as we have $Q_ i(x_ i\') = 0$ where $Q_ i = f^{\\deg _ T(P_ i)}P_ i(T/f)$ which is a monic polynomial in $T$ with coefficients in $R[y_1, \\ldots , y_ d]$ by our choice of $f$. Hence $R[y_1, \\ldots , y_ d] \\subset S\'$ is finite by Lemma 10.36.5. Since $S\' \\subset S$ we have $S\'_ f \\subset S_ f$ (localization is exact). On the other hand, the elements $x_ i = x\'_ i/f$ in $S\'_ f$ generate $S_ f$ over $R_ f$ and hence $S\'_ f \\to S_ f$ is surjective. Whence $S\'_ f \\cong S_ f$ and we win. \n      $\\square$\n    \n\n"," by
  obtain ‚ü®n, f, fsurj‚ü© := Algebra.FiniteType.iff_quotient_mvPolynomial''.mp fin
  set œï := quotientKerAlgEquivOfSurjective fsurj
  obtain ‚ü®s, _, g, injg, intg‚ü© := exists_integral_inj_algHom_of_quotient (ker f) (ker_ne_top _)
  use s, œï.toAlgHom.comp g
  simp only [AlgEquiv.toAlgHom_eq_coe, AlgHom.coe_comp, AlgHom.coe_coe,
    EmbeddingLike.comp_injective, AlgHom.toRingHom_eq_coe]
  exact ‚ü®injg, intg.trans _ _ (isIntegral_of_surjective _ œï.surjective)‚ü©
","theorem exists_integral_inj_algHom_of_fg : ‚àÉ s, ‚àÉ g : (MvPolynomial (Fin s) k) ‚Üí‚Çê[k] R,
    Function.Injective g ‚àß g.IsIntegral ","Proof.\n      Say $N = \\{ \\nu _ j\\} $ with $\\nu _ j = (\\nu _{j1}, \\ldots , \\nu _{jn})$. Let $A_ i = \\max _ j \\nu _{ji} - \\min _ j \\nu _{ji}$. If for each $i$ we have $e_{i - 1} > A_ ie_ i + A_{i + 1}e_{i + 1} + \\ldots + A_ ne_ n$ then the lemma holds. For suppose that $e \\cdot (\\nu - \\nu \') = 0$. Then for $n \\ge 2$, \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) = \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       We may assume that $(\\nu _1 - \\nu \'_1) \\ge 0$. If $(\\nu _1 - \\nu \'_1) > 0$, then \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) \\ge e_1 > A_2e_2 + \\ldots + A_ ne_ n \\ge \\sum \\nolimits _{i = 2}^ n e_ i|\\nu \'_ i - \\nu _ i| \\ge \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       This contradiction implies that $\\nu \'_1 = \\nu _1$. By induction, $\\nu \'_ i = \\nu _ i$ for $2 \\le i \\le n$. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.2 [[\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n\n    \n]]. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n \n\n\n    \n      Proof.\n      Write $g = \\sum _{\\nu \\in N} a_\\nu x^\\nu $ with $a_\\nu \\in R$ not zero. Here $N$ is a finite set of multi-indices as in Lemma 10.115.1 [[\n  Lemma 10.115.1. Let $n \\in \\mathbf{N}$. Let $N$ be a finite nonempty set of multi-indices $\\nu = (\\nu _1, \\ldots , \\nu _ n)$. Given $e = (e_1, \\ldots , e_ n)$ we set $e \\cdot \\nu = \\sum e_ i\\nu _ i$. Then for $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n$ we have: If $\\nu , \\nu \' \\in N$ then \n  \n  \\[  (e \\cdot \\nu = e \\cdot \\nu \') \\Leftrightarrow (\\nu = \\nu \')  \\]\n\n\n    \n]] and $x^\\nu = x_1^{\\nu _1} \\ldots x_ n^{\\nu _ n}$. Note that the leading term in \n    \n      \n  \\[  (x_1 + x_ n^{e_1})^{\\nu _1} \\ldots (x_{n-1} + x_ n^{e_{n-1}})^{\\nu _{n-1}} x_ n^{\\nu _ n} \\quad \\text{is}\\quad x_ n^{e_1\\nu _1 + \\ldots + e_{n-1}\\nu _{n-1} + \\nu _ n}.  \\]\n\n    \n       Hence the lemma follows from Lemma 10.115.1 [[\n  Lemma 10.115.1. Let $n \\in \\mathbf{N}$. Let $N$ be a finite nonempty set of multi-indices $\\nu = (\\nu _1, \\ldots , \\nu _ n)$. Given $e = (e_1, \\ldots , e_ n)$ we set $e \\cdot \\nu = \\sum e_ i\\nu _ i$. Then for $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n$ we have: If $\\nu , \\nu \' \\in N$ then \n  \n  \\[  (e \\cdot \\nu = e \\cdot \\nu \') \\Leftrightarrow (\\nu = \\nu \')  \\]\n\n\n    \n]] which guarantees that there is exactly one nonzero term $a_\\nu x^\\nu $ of $g$ which gives rise to the leading term of $g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n)$, i.e., $a = a_\\nu $ for the unique $\\nu \\in N$ such that $e \\cdot \\nu $ is maximal. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.3 [[\n  Lemma 10.115.3. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      Pick $f \\in I$, $f\\not= 0$. It suffices to show the lemma for $k[x_1, \\ldots , x_ n]/(f)$ since $S$ is a quotient of that ring. We will take $y_ i = x_ i - x_ n^{e_ i}$, $i = 1, \\ldots , n-1$ for suitable integers $e_ i$. When does this work? It suffices to show that $\\overline{x_ n} \\in k[x_1, \\ldots , x_ n]/(f)$ is integral over the ring $k[y_1, \\ldots , y_{n-1}]$. The equation for $\\overline{x_ n}$ over this ring is \n    \n      \n  \\[  f(y_1 + x_ n^{e_1}, \\ldots , y_{n-1} + x_ n^{e_{n-1}}, x_ n) = 0.  \\]\n\n    \n       Hence we are done if we can show there exists integers $e_ i$ such that the leading coefficient with respect to $x_ n$ of the equation above is a nonzero element of $k$. This can be achieved for example by choosing $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1}$, see Lemma 10.115.2 [[\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n\n    \n]]. \n      $\\square$\n    \n\n\n\n       \n      \n  Lemma 10.115.4 [[\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      By induction on $n$, with $n = 0$ being trivial. If $I = 0$, then take $r = n$ and $y_ i = x_ i$. If $I \\not= 0$, then choose $y_1, \\ldots , y_{n-1}$ as in Lemma 10.115.3 [[\n  Lemma 10.115.3. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. Let $S\' \\subset S$ be the subring generated by the images of the $y_ i$. By induction we can choose $r$ and $z_1, \\ldots , z_ r \\in k[y_1, \\ldots , y_{n-1}]$ such that (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S\'$. Since $S\' \\to S$ is injective and finite we see (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S$. The last assertion follows from Lemma 10.112.4 [[\n  Lemma 10.112.4. Suppose $R \\subset S$ and $S$ integral over $R$. Then $\\dim (R) = \\dim (S)$. \n\n    \n]]. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.5 [[\n  Lemma 10.115.5. Let $k$ be a field. Let $S$ be a finite type $k$ algebra and denote $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q$ be a prime of $S$, and let $x \\in X$ be the corresponding point. There exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $\\dim (S_ g) = \\dim _ x(X) =: d$ and such that there exists a finite injective map $k[y_1, \\ldots , y_ d] \\to S_ g$. \n\n    \n]]. Let $k$ be a field. Let $S$ be a finite type $k$ algebra and denote $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q$ be a prime of $S$, and let $x \\in X$ be the corresponding point. There exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $\\dim (S_ g) = \\dim _ x(X) =: d$ and such that there exists a finite injective map $k[y_1, \\ldots , y_ d] \\to S_ g$. \n \n\n\n    \n      Proof.\n      Note that by definition $\\dim _ x(X)$ is the minimum of the dimensions of $S_ g$ for $g \\in S$, $g \\not\\in \\mathfrak q$, i.e., the minimum is attained. Thus the lemma follows from Lemma 10.115.4 [[\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.6 [[\n  Lemma 10.115.6. Let $k$ be a field. Let $\\mathfrak q \\subset k[x_1, \\ldots , x_ n]$ be a prime ideal. Set $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak q)$. Then there exists a finite ring map $\\varphi : k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]$ such that $\\varphi ^{-1}(\\mathfrak q) = (y_{r + 1}, \\ldots , y_ n)$. \n\n    \n]]. Let $k$ be a field. Let $\\mathfrak q \\subset k[x_1, \\ldots , x_ n]$ be a prime ideal. Set $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak q)$. Then there exists a finite ring map $\\varphi : k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]$ such that $\\varphi ^{-1}(\\mathfrak q) = (y_{r + 1}, \\ldots , y_ n)$. \n \n\n\n    \n      Proof.\n      By induction on $n$. The case $n = 0$ is clear. Assume $n > 0$. If $r = n$, then $\\mathfrak q = (0)$ and the result is clear. Choose a nonzero $f \\in \\mathfrak q$. Of course $f$ is nonconstant. After applying an automorphism of the form \n    \n      \n  \\[  k[x_1, \\ldots , x_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad x_ n \\mapsto x_ n, \\quad x_ i \\mapsto x_ i + x_ n^{e_ i}\\  (i < n)  \\]\n\n    \n       we may assume that $f$ is monic in $x_ n$ over $k[x_1, \\ldots , x_ n]$, see Lemma 10.115.2 [[\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n\n    \n]]. Hence the ring map \n    \n      \n  \\[  k[y_1, \\ldots , y_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad y_ n \\mapsto f, \\quad y_ i \\mapsto x_ i\\  (i < n)  \\]\n\n    \n       is finite. Moreover $y_ n \\in \\mathfrak q \\cap k[y_1, \\ldots , y_ n]$ by construction. Thus $\\mathfrak q \\cap k[y_1, \\ldots , y_ n] = \\mathfrak pk[y_1, \\ldots , y_ n] + (y_ n)$ where $\\mathfrak p \\subset k[y_1, \\ldots , y_{n - 1}]$ is a prime ideal. Note that $\\kappa (\\mathfrak p) \\subset \\kappa (\\mathfrak q)$ is finite, and hence $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak p)$. Apply the induction hypothesis to the pair $(k[y_1, \\ldots , y_{n - 1}], \\mathfrak p)$ and we obtain a finite ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ such that $\\mathfrak p \\cap k[z_1, \\ldots , z_{n - 1}] = (z_{r + 1}, \\ldots , z_{n - 1})$. We extend the ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ to a ring map $k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n]$ by mapping $z_ n$ to $y_ n$. The composition of the ring maps \n    \n      \n  \\[  k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]  \\]\n\n    \n       solves the problem. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.7 [[\n  Lemma 10.115.7. Let $R \\to S$ be an injective finite type ring map. Assume $R$ is a domain. Then there exists an integer $d$ and a factorization \n  \n  \\[  R \\to R[y_1, \\ldots , y_ d] \\to S\' \\to S  \\]\n\n   by injective maps such that $S\'$ is finite over $R[y_1, \\ldots , y_ d]$ and such that $S\'_ f \\cong S_ f$ for some nonzero $f \\in R$. \n\n    \n]]. Let $R \\to S$ be an injective finite type ring map. Assume $R$ is a domain. Then there exists an integer $d$ and a factorization \n  \n  \\[  R \\to R[y_1, \\ldots , y_ d] \\to S\' \\to S  \\]\n\n   by injective maps such that $S\'$ is finite over $R[y_1, \\ldots , y_ d]$ and such that $S\'_ f \\cong S_ f$ for some nonzero $f \\in R$. \n \n\n\n    \n      Proof.\n      Pick $x_1, \\ldots , x_ n \\in S$ which generate $S$ over $R$. Let $K$ be the fraction field of $R$ and $S_ K = S \\otimes _ R K$. By Lemma 10.115.4 [[\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]] we can find $y_1, \\ldots , y_ d \\in S$ such that $K[y_1, \\ldots , y_ d] \\to S_ K$ is a finite injective map. Note that $y_ i \\in S$ because we may pick the $y_ j$ in the $\\mathbf{Z}$-algebra generated by $x_1, \\ldots , x_ n$. As a finite ring map is integral (see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]) we can find monic $P_ i \\in K[y_1, \\ldots , y_ d][T]$ such that $P_ i(x_ i) = 0$ in $S_ K$. Let $f \\in R$ be a nonzero element such that $fP_ i \\in R[y_1, \\ldots , y_ d][T]$ for all $i$. Then $fP_ i(x_ i)$ maps to zero in $S_ K$. Hence after replacing $f$ by another nonzero element of $R$ we may also assume $fP_ i(x_ i)$ is zero in $S$. Set $x_ i\' = fx_ i$ and let $S\' \\subset S$ be the $R$-subalgebra generated by $y_1, \\ldots , y_ d$ and $x\'_1, \\ldots , x\'_ n$. Note that $x\'_ i$ is integral over $R[y_1, \\ldots , y_ d]$ as we have $Q_ i(x_ i\') = 0$ where $Q_ i = f^{\\deg _ T(P_ i)}P_ i(T/f)$ which is a monic polynomial in $T$ with coefficients in $R[y_1, \\ldots , y_ d]$ by our choice of $f$. Hence $R[y_1, \\ldots , y_ d] \\subset S\'$ is finite by Lemma 10.36.5 [[\n  Lemma 10.36.5. Let $R \\to S$ be a ring map. The following are equivalent \n  \n  \n$R \\to S$ is finite, \n\n\n$R \\to S$ is integral and of finite type, and \n\n\nthere exist $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an algebra over $R$ such that each $x_ i$ is integral over $R$. \n\n\n\n\n    \n]]. Since $S\' \\subset S$ we have $S\'_ f \\subset S_ f$ (localization is exact). On the other hand, the elements $x_ i = x\'_ i/f$ in $S\'_ f$ generate $S_ f$ over $R_ f$ and hence $S\'_ f \\to S_ f$ is surjective. Whence $S\'_ f \\cong S_ f$ and we win. \n      $\\square$\n    \n\n","Proof.\n      Say $N = \\{ \\nu _ j\\} $ with $\\nu _ j = (\\nu _{j1}, \\ldots , \\nu _{jn})$. Let $A_ i = \\max _ j \\nu _{ji} - \\min _ j \\nu _{ji}$. If for each $i$ we have $e_{i - 1} > A_ ie_ i + A_{i + 1}e_{i + 1} + \\ldots + A_ ne_ n$ then the lemma holds. For suppose that $e \\cdot (\\nu - \\nu \') = 0$. Then for $n \\ge 2$, \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) = \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       We may assume that $(\\nu _1 - \\nu \'_1) \\ge 0$. If $(\\nu _1 - \\nu \'_1) > 0$, then \n    \n      \n  \\[  e_1(\\nu _1 - \\nu \'_1) \\ge e_1 > A_2e_2 + \\ldots + A_ ne_ n \\ge \\sum \\nolimits _{i = 2}^ n e_ i|\\nu \'_ i - \\nu _ i| \\ge \\sum \\nolimits _{i = 2}^ n e_ i(\\nu \'_ i - \\nu _ i).  \\]\n\n    \n       This contradiction implies that $\\nu \'_1 = \\nu _1$. By induction, $\\nu \'_ i = \\nu _ i$ for $2 \\le i \\le n$. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.2 [[\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n\n    \n]]. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n \n\n\n    \n      Proof.\n      Write $g = \\sum _{\\nu \\in N} a_\\nu x^\\nu $ with $a_\\nu \\in R$ not zero. Here $N$ is a finite set of multi-indices as in Lemma 10.115.1 [[\n  Lemma 10.115.1. Let $n \\in \\mathbf{N}$. Let $N$ be a finite nonempty set of multi-indices $\\nu = (\\nu _1, \\ldots , \\nu _ n)$. Given $e = (e_1, \\ldots , e_ n)$ we set $e \\cdot \\nu = \\sum e_ i\\nu _ i$. Then for $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n$ we have: If $\\nu , \\nu \' \\in N$ then \n  \n  \\[  (e \\cdot \\nu = e \\cdot \\nu \') \\Leftrightarrow (\\nu = \\nu \')  \\]\n\n\n    \n]] and $x^\\nu = x_1^{\\nu _1} \\ldots x_ n^{\\nu _ n}$. Note that the leading term in \n    \n      \n  \\[  (x_1 + x_ n^{e_1})^{\\nu _1} \\ldots (x_{n-1} + x_ n^{e_{n-1}})^{\\nu _{n-1}} x_ n^{\\nu _ n} \\quad \\text{is}\\quad x_ n^{e_1\\nu _1 + \\ldots + e_{n-1}\\nu _{n-1} + \\nu _ n}.  \\]\n\n    \n       Hence the lemma follows from Lemma 10.115.1 [[\n  Lemma 10.115.1. Let $n \\in \\mathbf{N}$. Let $N$ be a finite nonempty set of multi-indices $\\nu = (\\nu _1, \\ldots , \\nu _ n)$. Given $e = (e_1, \\ldots , e_ n)$ we set $e \\cdot \\nu = \\sum e_ i\\nu _ i$. Then for $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n$ we have: If $\\nu , \\nu \' \\in N$ then \n  \n  \\[  (e \\cdot \\nu = e \\cdot \\nu \') \\Leftrightarrow (\\nu = \\nu \')  \\]\n\n\n    \n]] which guarantees that there is exactly one nonzero term $a_\\nu x^\\nu $ of $g$ which gives rise to the leading term of $g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n)$, i.e., $a = a_\\nu $ for the unique $\\nu \\in N$ such that $e \\cdot \\nu $ is maximal. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.3 [[\n  Lemma 10.115.3. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      Pick $f \\in I$, $f\\not= 0$. It suffices to show the lemma for $k[x_1, \\ldots , x_ n]/(f)$ since $S$ is a quotient of that ring. We will take $y_ i = x_ i - x_ n^{e_ i}$, $i = 1, \\ldots , n-1$ for suitable integers $e_ i$. When does this work? It suffices to show that $\\overline{x_ n} \\in k[x_1, \\ldots , x_ n]/(f)$ is integral over the ring $k[y_1, \\ldots , y_{n-1}]$. The equation for $\\overline{x_ n}$ over this ring is \n    \n      \n  \\[  f(y_1 + x_ n^{e_1}, \\ldots , y_{n-1} + x_ n^{e_{n-1}}, x_ n) = 0.  \\]\n\n    \n       Hence we are done if we can show there exists integers $e_ i$ such that the leading coefficient with respect to $x_ n$ of the equation above is a nonzero element of $k$. This can be achieved for example by choosing $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1}$, see Lemma 10.115.2 [[\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n\n    \n]]. \n      $\\square$\n    \n\n\n\n       \n      \n  Lemma 10.115.4 [[\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n \n\n\n    \n      Proof.\n      By induction on $n$, with $n = 0$ being trivial. If $I = 0$, then take $r = n$ and $y_ i = x_ i$. If $I \\not= 0$, then choose $y_1, \\ldots , y_{n-1}$ as in Lemma 10.115.3 [[\n  Lemma 10.115.3. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some proper ideal $I$. If $I \\not= 0$, then there exist $y_1, \\ldots , y_{n-1} \\in k[x_1, \\ldots , x_ n]$ such that $S$ is finite over $k[y_1, \\ldots , y_{n-1}]$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. Let $S\' \\subset S$ be the subring generated by the images of the $y_ i$. By induction we can choose $r$ and $z_1, \\ldots , z_ r \\in k[y_1, \\ldots , y_{n-1}]$ such that (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S\'$. Since $S\' \\to S$ is injective and finite we see (a), (b) hold for $k[z_1, \\ldots , z_ r] \\to S$. The last assertion follows from Lemma 10.112.4 [[\n  Lemma 10.112.4. Suppose $R \\subset S$ and $S$ integral over $R$. Then $\\dim (R) = \\dim (S)$. \n\n    \n]]. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.5 [[\n  Lemma 10.115.5. Let $k$ be a field. Let $S$ be a finite type $k$ algebra and denote $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q$ be a prime of $S$, and let $x \\in X$ be the corresponding point. There exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $\\dim (S_ g) = \\dim _ x(X) =: d$ and such that there exists a finite injective map $k[y_1, \\ldots , y_ d] \\to S_ g$. \n\n    \n]]. Let $k$ be a field. Let $S$ be a finite type $k$ algebra and denote $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q$ be a prime of $S$, and let $x \\in X$ be the corresponding point. There exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $\\dim (S_ g) = \\dim _ x(X) =: d$ and such that there exists a finite injective map $k[y_1, \\ldots , y_ d] \\to S_ g$. \n \n\n\n    \n      Proof.\n      Note that by definition $\\dim _ x(X)$ is the minimum of the dimensions of $S_ g$ for $g \\in S$, $g \\not\\in \\mathfrak q$, i.e., the minimum is attained. Thus the lemma follows from Lemma 10.115.4 [[\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]]. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.6 [[\n  Lemma 10.115.6. Let $k$ be a field. Let $\\mathfrak q \\subset k[x_1, \\ldots , x_ n]$ be a prime ideal. Set $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak q)$. Then there exists a finite ring map $\\varphi : k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]$ such that $\\varphi ^{-1}(\\mathfrak q) = (y_{r + 1}, \\ldots , y_ n)$. \n\n    \n]]. Let $k$ be a field. Let $\\mathfrak q \\subset k[x_1, \\ldots , x_ n]$ be a prime ideal. Set $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak q)$. Then there exists a finite ring map $\\varphi : k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]$ such that $\\varphi ^{-1}(\\mathfrak q) = (y_{r + 1}, \\ldots , y_ n)$. \n \n\n\n    \n      Proof.\n      By induction on $n$. The case $n = 0$ is clear. Assume $n > 0$. If $r = n$, then $\\mathfrak q = (0)$ and the result is clear. Choose a nonzero $f \\in \\mathfrak q$. Of course $f$ is nonconstant. After applying an automorphism of the form \n    \n      \n  \\[  k[x_1, \\ldots , x_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad x_ n \\mapsto x_ n, \\quad x_ i \\mapsto x_ i + x_ n^{e_ i}\\  (i < n)  \\]\n\n    \n       we may assume that $f$ is monic in $x_ n$ over $k[x_1, \\ldots , x_ n]$, see Lemma 10.115.2 [[\n  Lemma 10.115.2. Let $R$ be a ring. Let $g \\in R[x_1, \\ldots , x_ n]$ be an element which is nonconstant, i.e., $g \\not\\in R$. For $e_1 \\gg e_2 \\gg \\ldots \\gg e_{n-1} \\gg e_ n = 1$ the polynomial \n  \n  \\[  g(x_1 + x_ n^{e_1}, x_2 + x_ n^{e_2}, \\ldots , x_{n - 1} + x_ n^{e_{n - 1}}, x_ n) = ax_ n^ d + \\text{lower order terms in }x_ n  \\]\n\n   where $d > 0$ and $a \\in R$ is one of the nonzero coefficients of $g$. \n\n    \n]]. Hence the ring map \n    \n      \n  \\[  k[y_1, \\ldots , y_ n] \\longrightarrow k[x_1, \\ldots , x_ n], \\quad y_ n \\mapsto f, \\quad y_ i \\mapsto x_ i\\  (i < n)  \\]\n\n    \n       is finite. Moreover $y_ n \\in \\mathfrak q \\cap k[y_1, \\ldots , y_ n]$ by construction. Thus $\\mathfrak q \\cap k[y_1, \\ldots , y_ n] = \\mathfrak pk[y_1, \\ldots , y_ n] + (y_ n)$ where $\\mathfrak p \\subset k[y_1, \\ldots , y_{n - 1}]$ is a prime ideal. Note that $\\kappa (\\mathfrak p) \\subset \\kappa (\\mathfrak q)$ is finite, and hence $r = \\text{trdeg}_ k\\  \\kappa (\\mathfrak p)$. Apply the induction hypothesis to the pair $(k[y_1, \\ldots , y_{n - 1}], \\mathfrak p)$ and we obtain a finite ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ such that $\\mathfrak p \\cap k[z_1, \\ldots , z_{n - 1}] = (z_{r + 1}, \\ldots , z_{n - 1})$. We extend the ring map $k[z_1, \\ldots , z_{n - 1}] \\to k[y_1, \\ldots , y_{n - 1}]$ to a ring map $k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n]$ by mapping $z_ n$ to $y_ n$. The composition of the ring maps \n    \n      \n  \\[  k[z_1, \\ldots , z_ n] \\to k[y_1, \\ldots , y_ n] \\to k[x_1, \\ldots , x_ n]  \\]\n\n    \n       solves the problem. \n      $\\square$\n    \n\n\n\n  Lemma 10.115.7 [[\n  Lemma 10.115.7. Let $R \\to S$ be an injective finite type ring map. Assume $R$ is a domain. Then there exists an integer $d$ and a factorization \n  \n  \\[  R \\to R[y_1, \\ldots , y_ d] \\to S\' \\to S  \\]\n\n   by injective maps such that $S\'$ is finite over $R[y_1, \\ldots , y_ d]$ and such that $S\'_ f \\cong S_ f$ for some nonzero $f \\in R$. \n\n    \n]]. Let $R \\to S$ be an injective finite type ring map. Assume $R$ is a domain. Then there exists an integer $d$ and a factorization \n  \n  \\[  R \\to R[y_1, \\ldots , y_ d] \\to S\' \\to S  \\]\n\n   by injective maps such that $S\'$ is finite over $R[y_1, \\ldots , y_ d]$ and such that $S\'_ f \\cong S_ f$ for some nonzero $f \\in R$. \n \n\n\n    \n      Proof.\n      Pick $x_1, \\ldots , x_ n \\in S$ which generate $S$ over $R$. Let $K$ be the fraction field of $R$ and $S_ K = S \\otimes _ R K$. By Lemma 10.115.4 [[\n       \n      \n  Lemma 10.115.4. Let $k$ be a field. Let $S = k[x_1, \\ldots , x_ n]/I$ for some ideal $I$. If $I \\neq (1)$, there exist $r\\geq 0$, and $y_1, \\ldots , y_ r \\in k[x_1, \\ldots , x_ n]$ such that (a) the map $k[y_1, \\ldots , y_ r] \\to S$ is injective where the source is the polynomial ring on $y_1, \\ldots , y_ r$, and (b) the map $k[y_1, \\ldots , y_ r] \\to S$ is finite. In this case the integer $r$ is the dimension of $S$. Moreover we may choose $y_ i$ to be in the $\\mathbf{Z}$-subalgebra of $k[x_1, \\ldots , x_ n]$ generated by $x_1, \\ldots , x_ n$. \n\n    \n]] we can find $y_1, \\ldots , y_ d \\in S$ such that $K[y_1, \\ldots , y_ d] \\to S_ K$ is a finite injective map. Note that $y_ i \\in S$ because we may pick the $y_ j$ in the $\\mathbf{Z}$-algebra generated by $x_1, \\ldots , x_ n$. As a finite ring map is integral (see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]) we can find monic $P_ i \\in K[y_1, \\ldots , y_ d][T]$ such that $P_ i(x_ i) = 0$ in $S_ K$. Let $f \\in R$ be a nonzero element such that $fP_ i \\in R[y_1, \\ldots , y_ d][T]$ for all $i$. Then $fP_ i(x_ i)$ maps to zero in $S_ K$. Hence after replacing $f$ by another nonzero element of $R$ we may also assume $fP_ i(x_ i)$ is zero in $S$. Set $x_ i\' = fx_ i$ and let $S\' \\subset S$ be the $R$-subalgebra generated by $y_1, \\ldots , y_ d$ and $x\'_1, \\ldots , x\'_ n$. Note that $x\'_ i$ is integral over $R[y_1, \\ldots , y_ d]$ as we have $Q_ i(x_ i\') = 0$ where $Q_ i = f^{\\deg _ T(P_ i)}P_ i(T/f)$ which is a monic polynomial in $T$ with coefficients in $R[y_1, \\ldots , y_ d]$ by our choice of $f$. Hence $R[y_1, \\ldots , y_ d] \\subset S\'$ is finite by Lemma 10.36.5 [[\n  Lemma 10.36.5. Let $R \\to S$ be a ring map. The following are equivalent \n  \n  \n$R \\to S$ is finite, \n\n\n$R \\to S$ is integral and of finite type, and \n\n\nthere exist $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an algebra over $R$ such that each $x_ i$ is integral over $R$. \n\n\n\n\n    \n]]. Since $S\' \\subset S$ we have $S\'_ f \\subset S_ f$ (localization is exact). On the other hand, the elements $x_ i = x\'_ i/f$ in $S\'_ f$ generate $S_ f$ over $R_ f$ and hence $S\'_ f \\to S_ f$ is surjective. Whence $S\'_ f \\cong S_ f$ and we win. \n      $\\square$\n    \n\n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the Lean proof is about finite type algebras being presented as a quotient of a multivariable polynomial ring, then using a surjective quotient map and an auxiliary lemma `exists_integral_inj_algHom_of_quotient` to produce an element set `s` and an injective algebra homomorphism whose target is integral/finite via `isIntegral_of_surjective`. The informal proof, however, is a sequence of lemmas (10.115.1‚Äì10.115.7) about choosing large exponents to separate multi-indices, producing a leading term after a coordinate change, and then using this to prove Noether normalization‚Äìtype finiteness/injectivity statements for quotients of polynomial rings over a field/domain. Structurally, the informal proof relies on explicit combinatorial exponent inequalities and induction on the number of variables, while the Lean proof contains none of these steps and instead invokes abstract existing lemmas about quotients, kernels, and integrality under surjections. Thus the formal proof does not reflect the content or structure of the informal argument and appears to be proving a different statement (or at best a very high-level corollary) without the key constructions described informally.""}"
236,00L3,"lemma Module.support_subset_of_injective (hf : Function.Injective f) :
    Module.support R M ‚äÜ Module.support R N := by
  simp_rw [Set.subset_def, mem_support_iff']
  rintro x ‚ü®m, hm‚ü©
  exact ‚ü®f m, fun r hr ‚Ü¶ by simpa using hf.ne (hm r hr)‚ü©
",Formal Proof of Stacks Project Tag 00L3,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Support.lean#L154-L158,Q27041,,10.40.9,lemma,3.0,"['080S', '00AO', '0ELQ']","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n      Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n",Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n," by
  simp_rw [Set.subset_def, mem_support_iff']
  rintro x ‚ü®m, hm‚ü©
  exact ‚ü®f m, fun r hr ‚Ü¶ by simpa using hf.ne (hm r hr)‚ü©
","lemma Module.support_subset_of_injective (hf : Function.Injective f) :
    Module.support R M ‚äÜ Module.support R N ","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is about exactness of localization functors and a nonvanishing statement deduced via Nakayama‚Äôs lemma (modules localized at a prime, quotient by an ideal, Jacobson radical conditions, etc.). The Lean proof, however, is a short set-theoretic/simp proof about supports: it rewrites `Set.subset_def` and `mem_support_iff'`, then constructs an element in a support using `rintro x ‚ü®m, hm‚ü©` and `‚ü®f m, ...‚ü©`, relying on a hypothesis `hf.ne` to show non-vanishing. There is no appearance of localization, exactness, primes, ideals, quotients, or Nakayama‚Äôs lemma. Structurally, the informal argument is a multi-step algebraic reasoning invoking a major lemma, while the Lean code is a direct pointwise proof by unfolding definitions and applying a nonzero condition. Hence the semantic content and structure do not correspond, and the Lean proof omits essentially all key components of the informal proof.""}"
237,00L3,"lemma Module.support_subset_of_surjective (hf : Function.Surjective f) :
    Module.support R N ‚äÜ Module.support R M := by
  simp_rw [Set.subset_def, mem_support_iff']
  rintro x ‚ü®m, hm‚ü©
  obtain ‚ü®m, rfl‚ü© := hf m
  exact ‚ü®m, fun r hr e ‚Ü¶ hm r hr (by simpa using congr(f $e))‚ü©
",Formal Proof of Stacks Project Tag 00L3,(3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Support.lean#L161-L166,Q27041,,10.40.9,lemma,3.0,"['080S', '00AO', '0ELQ']","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n      Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n",Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n," by
  simp_rw [Set.subset_def, mem_support_iff']
  rintro x ‚ü®m, hm‚ü©
  obtain ‚ü®m, rfl‚ü© := hf m
  exact ‚ü®m, fun r hr e ‚Ü¶ hm r hr (by simpa using congr(f $e))‚ü©
","lemma Module.support_subset_of_surjective (hf : Function.Surjective f) :
    Module.support R N ‚äÜ Module.support R M ","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3)","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantic consistency is very low: the informal proof is about exactness of localization functors, nonvanishing of localized modules, and an application of Nakayama‚Äôs lemma to deduce ‚Äú(M/IM)_p ‚â† 0‚Äù from ‚ÄúM_p ‚â† 0‚Äù under I ‚äÜ p. The Lean proof, by contrast, is a short set-theoretic/simp argument about subset membership in a support set (using `Set.subset_def`, `mem_support_iff'`) and constructs an element/witness via `rintro`/`obtain`/`congr`. Structurally, the informal proof has a two-part argument (exactness handles most assertions; first assertion via Nakayama), while the Lean proof is a single local rewriting and witness extraction with no trace of exactness, localization, ideals, primes, or Nakayama. The Lean code therefore does not reflect the key steps or content of the informal proof and appears to be proving a different lemma (likely a support inclusion), so the alignment is essentially absent.""}"
238,00L3,"lemma Module.support_of_exact (h : Function.Exact f g)
    (hf : Function.Injective f) (hg : Function.Surjective g) :
    Module.support R N = Module.support R M ‚à™ Module.support R P := by
  refine subset_antisymm ?_ (Set.union_subset (Module.support_subset_of_injective f hf)
    (Module.support_subset_of_surjective g hg))
  intro x
  contrapose
  simp only [Set.mem_union, not_or, and_imp, notMem_support_iff']
  intro H‚ÇÅ H‚ÇÇ m
  obtain ‚ü®r, hr, e‚ÇÅ‚ü© := H‚ÇÇ (g m)
  rw [‚Üê map_smul, h] at e‚ÇÅ
  obtain ‚ü®m', hm'‚ü© := e‚ÇÅ
  obtain ‚ü®s, hs, e‚ÇÅ‚ü© := H‚ÇÅ m'
  exact ‚ü®_, x.asIdeal.primeCompl.mul_mem hs hr, by rw [mul_smul, ‚Üê hm', ‚Üê map_smul, e‚ÇÅ, map_zero]‚ü©
",Formal Proof of Stacks Project Tag 00L3,(4),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Support.lean#L171-L184,Q27041,,10.40.9,lemma,3.0,"['080S', '00AO', '0ELQ']","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n      Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n",Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n," by
  refine subset_antisymm ?_ (Set.union_subset (Module.support_subset_of_injective f hf)
    (Module.support_subset_of_surjective g hg))
  intro x
  contrapose
  simp only [Set.mem_union, not_or, and_imp, notMem_support_iff']
  intro H‚ÇÅ H‚ÇÇ m
  obtain ‚ü®r, hr, e‚ÇÅ‚ü© := H‚ÇÇ (g m)
  rw [‚Üê map_smul, h] at e‚ÇÅ
  obtain ‚ü®m', hm'‚ü© := e‚ÇÅ
  obtain ‚ü®s, hs, e‚ÇÅ‚ü© := H‚ÇÅ m'
  exact ‚ü®_, x.asIdeal.primeCompl.mul_mem hs hr, by rw [mul_smul, ‚Üê hm', ‚Üê map_smul, e‚ÇÅ, map_zero]‚ü©
","lemma Module.support_of_exact (h : Function.Exact f g)
    (hf : Function.Injective f) (hg : Function.Surjective g) :
    Module.support R N = Module.support R M ‚à™ Module.support R P ","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (4)","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof argues about exactness of localization functors and then uses Nakayama‚Äôs lemma to deduce a nonvanishing statement after localizing a quotient (showing (M/IM)_p ‚âÖ M_p/IM_p ‚â† 0 under hypotheses). The Lean proof, however, is a set-theoretic `subset_antisymm` argument about supports and unions, using lemmas `Module.support_subset_of_injective` and `Module.support_subset_of_surjective`, plus a contrapositive `notMem_support_iff'`-style elementwise argument involving `map_smul` and prime complement multiplication. Structurally, the Lean code proves an equality of sets via two inclusions and a contrapositive element-chasing step; it does not reflect the informal structure (exactness + Nakayama) and contains no trace of Nakayama‚Äôs lemma, finiteness, Jacobson radical, or the quotient/localization nonzero claim. Thus the formal proof appears to be about support behavior in a short exact sequence (or similar), not the Nakayama-based localization nonvanishing statement, so the alignment is essentially absent.""}"
239,00L2,"lemma Module.support_eq_zeroLocus :
    Module.support R M = zeroLocus (Module.annihilator R M) :=
  Set.ext fun _ ‚Ü¶ mem_support_iff_of_finite
",Formal Proof of Stacks Project Tag 00L2,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Support.lean#L214-L216,Q27041,,10.40.5,lemma,3.0,"['080S', '00AO', '0ELQ']","\n  Lemma 10.40.5. Let $R$ be a ring and let $M$ be an $R$-module. If $M$ is finite, then $\\text{Supp}(M)$ is closed. More precisely, if $I = \\text{Ann}(M)$ is the annihilator of $M$, then $V(I) = \\text{Supp}(M)$. \n\n    \n      Proof.\n      We will show that $V(I) = \\text{Supp}(M)$. \n    \n      Suppose $\\mathfrak p \\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} \\not= 0$. Choose an element $m \\in M$ whose image in $M_\\mathfrak p$ is nonzero. Then the annihilator of $m$ is contained in $\\mathfrak p$ by construction of the localization $M_\\mathfrak p$. Hence a fortiori $I = \\text{Ann}(M)$ must be contained in $\\mathfrak p$. \n    \n      Conversely, suppose that $\\mathfrak p \\not\\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} = 0$. Let $x_1, \\ldots , x_ r \\in M$ be generators. By Lemma 10.9.9 there exists an $f \\in R$, $f\\not\\in \\mathfrak p$ such that $x_ i/1 = 0$ in $M_ f$. Hence $f^{n_ i} x_ i = 0$ for some $n_ i \\geq 1$. Hence $f^ nM = 0$ for $n = \\max \\{ n_ i\\} $ as desired. \n      $\\square$\n    \n","\n  Lemma 10.40.5. Let $R$ be a ring and let $M$ be an $R$-module. If $M$ is finite, then $\\text{Supp}(M)$ is closed. More precisely, if $I = \\text{Ann}(M)$ is the annihilator of $M$, then $V(I) = \\text{Supp}(M)$. \n\n    \n","Proof.\n      We will show that $V(I) = \\text{Supp}(M)$. \n    \n      Suppose $\\mathfrak p \\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} \\not= 0$. Choose an element $m \\in M$ whose image in $M_\\mathfrak p$ is nonzero. Then the annihilator of $m$ is contained in $\\mathfrak p$ by construction of the localization $M_\\mathfrak p$. Hence a fortiori $I = \\text{Ann}(M)$ must be contained in $\\mathfrak p$. \n    \n      Conversely, suppose that $\\mathfrak p \\not\\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} = 0$. Let $x_1, \\ldots , x_ r \\in M$ be generators. By Lemma 10.9.9 there exists an $f \\in R$, $f\\not\\in \\mathfrak p$ such that $x_ i/1 = 0$ in $M_ f$. Hence $f^{n_ i} x_ i = 0$ for some $n_ i \\geq 1$. Hence $f^ nM = 0$ for $n = \\max \\{ n_ i\\} $ as desired. \n      $\\square$\n    \n","
  Set.ext fun _ ‚Ü¶ mem_support_iff_of_finite
","lemma Module.support_eq_zeroLocus :
    Module.support R M = zeroLocus (Module.annihilator R M) ","Proof.\n      We will show that $V(I) = \\text{Supp}(M)$. \n    \n      Suppose $\\mathfrak p \\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} \\not= 0$. Choose an element $m \\in M$ whose image in $M_\\mathfrak p$ is nonzero. Then the annihilator of $m$ is contained in $\\mathfrak p$ by construction of the localization $M_\\mathfrak p$. Hence a fortiori $I = \\text{Ann}(M)$ must be contained in $\\mathfrak p$. \n    \n      Conversely, suppose that $\\mathfrak p \\not\\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} = 0$. Let $x_1, \\ldots , x_ r \\in M$ be generators. By Lemma 10.9.9 [[\n  Lemma 10.9.9. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. Let $M$ be an $R$-module. Then \n  \n  \\[  S^{-1}M = \\mathop{\\mathrm{colim}}\\nolimits _{f \\in S} M_ f  \\]\n\n   where the preorder on $S$ is given by $f \\geq f\' \\Leftrightarrow f = f\'f\'\'$ for some $f\'\' \\in R$ in which case the map $M_{f\'} \\to M_ f$ is given by $m/(f\')^ e \\mapsto m(f\'\')^ e/f^ e$. \n\n    \n]] there exists an $f \\in R$, $f\\not\\in \\mathfrak p$ such that $x_ i/1 = 0$ in $M_ f$. Hence $f^{n_ i} x_ i = 0$ for some $n_ i \\geq 1$. Hence $f^ nM = 0$ for $n = \\max \\{ n_ i\\} $ as desired. \n      $\\square$\n    \n","Proof.\n      We will show that $V(I) = \\text{Supp}(M)$. \n    \n      Suppose $\\mathfrak p \\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} \\not= 0$. Choose an element $m \\in M$ whose image in $M_\\mathfrak p$ is nonzero. Then the annihilator of $m$ is contained in $\\mathfrak p$ by construction of the localization $M_\\mathfrak p$. Hence a fortiori $I = \\text{Ann}(M)$ must be contained in $\\mathfrak p$. \n    \n      Conversely, suppose that $\\mathfrak p \\not\\in \\text{Supp}(M)$. Then $M_{\\mathfrak p} = 0$. Let $x_1, \\ldots , x_ r \\in M$ be generators. By Lemma 10.9.9 [[\n  Lemma 10.9.9. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. Let $M$ be an $R$-module. Then \n  \n  \\[  S^{-1}M = \\mathop{\\mathrm{colim}}\\nolimits _{f \\in S} M_ f  \\]\n\n   where the preorder on $S$ is given by $f \\geq f\' \\Leftrightarrow f = f\'f\'\'$ for some $f\'\' \\in R$ in which case the map $M_{f\'} \\to M_ f$ is given by $m/(f\')^ e \\mapsto m(f\'\')^ e/f^ e$. \n\n    \n]] there exists an $f \\in R$, $f\\not\\in \\mathfrak p$ such that $x_ i/1 = 0$ in $M_ f$. Hence $f^{n_ i} x_ i = 0$ for some $n_ i \\geq 1$. Hence $f^ nM = 0$ for $n = \\max \\{ n_ i\\} $ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof establishes an equality of sets of primes (V(I) = Supp(M)) by proving both inclusions using localization, annihilators, and a finite generation argument. The formal proof is just `Set.ext fun _ ‚Ü¶ mem_support_iff_of_finite`, i.e. it proves a set equality by extensionality and then applies a single lemma characterizing membership in the support under a finiteness hypothesis. This matches the *goal* (set equality) and compresses the two-direction argument into a lemma, but it does not reflect the informal structure (no explicit two inclusions, no localization/annihilator reasoning, no use of generators/colimit lemma). Completeness/precision: the formal proof omits the detailed steps present informally and relies entirely on an external lemma; without seeing that lemma‚Äôs statement, it‚Äôs unclear it captures all hypotheses and conclusions exactly, so alignment is only partial.""}"
240,00L3,"theorem Module.support_quotient (I : Ideal R) :
    support R (M ‚ß∏ (I ‚Ä¢ ‚ä§ : Submodule R M)) = support R M ‚à© zeroLocus I := by
  apply subset_antisymm
  ¬∑ refine Set.subset_inter ?_ ?_
    ¬∑ exact Module.support_subset_of_surjective _ (Submodule.mkQ_surjective _)
    ¬∑ rw [support_eq_zeroLocus]
      apply PrimeSpectrum.zeroLocus_anti_mono_ideal
      rw [Submodule.annihilator_quotient]
      exact fun x hx ‚Ü¶ Submodule.mem_colon.mpr fun p hp ‚Ü¶ Submodule.smul_mem_smul hx hp
  ¬∑ rintro p ‚ü®hp‚ÇÅ, hp‚ÇÇ‚ü©
    rw [Module.mem_support_iff] at hp‚ÇÅ ‚ä¢
    let R‚Çö := Localization.AtPrime p.asIdeal
    let M‚Çö := LocalizedModule p.asIdeal.primeCompl M
    set M‚Çö' := LocalizedModule p.asIdeal.primeCompl (M ‚ß∏ (I ‚Ä¢ ‚ä§ : Submodule R M))
    let M‚Çö'' := M‚Çö ‚ß∏ I.map (algebraMap R R‚Çö) ‚Ä¢ (‚ä§ : Submodule R‚Çö M‚Çö)
    let e : M‚Çö' ‚âÉ‚Çó[R‚Çö] M‚Çö'' := (localizedQuotientEquiv _ _).symm ‚â™‚â´‚Çó
      Submodule.quotEquivOfEq _ _ (by rw [Submodule.localized,
        Submodule.localized'_smul, Ideal.localized'_eq_map, Submodule.localized'_top])
    have : Nontrivial M‚Çö'' := by
      rw [Submodule.Quotient.nontrivial_iff, ne_comm]
      apply Submodule.top_ne_ideal_smul_of_le_jacobson_annihilator
      refine trans ?_ (IsLocalRing.maximalIdeal_le_jacobson _)
      rw [‚Üê Localization.AtPrime.map_eq_maximalIdeal]
      exact Ideal.map_mono hp‚ÇÇ
    exact e.nontrivial
",Formal Proof of Stacks Project Tag 00L3,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Support.lean#L241-L265,Q27041,,10.40.9,lemma,3.0,"['080S', '00AO', '0ELQ']","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n      Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n","\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n",Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1. \n      $\\square$\n    \n," by
  apply subset_antisymm
  ¬∑ refine Set.subset_inter ?_ ?_
    ¬∑ exact Module.support_subset_of_surjective _ (Submodule.mkQ_surjective _)
    ¬∑ rw [support_eq_zeroLocus]
      apply PrimeSpectrum.zeroLocus_anti_mono_ideal
      rw [Submodule.annihilator_quotient]
      exact fun x hx ‚Ü¶ Submodule.mem_colon.mpr fun p hp ‚Ü¶ Submodule.smul_mem_smul hx hp
  ¬∑ rintro p ‚ü®hp‚ÇÅ, hp‚ÇÇ‚ü©
    rw [Module.mem_support_iff] at hp‚ÇÅ ‚ä¢
    let R‚Çö := Localization.AtPrime p.asIdeal
    let M‚Çö := LocalizedModule p.asIdeal.primeCompl M
    set M‚Çö' := LocalizedModule p.asIdeal.primeCompl (M ‚ß∏ (I ‚Ä¢ ‚ä§ : Submodule R M))
    let M‚Çö'' := M‚Çö ‚ß∏ I.map (algebraMap R R‚Çö) ‚Ä¢ (‚ä§ : Submodule R‚Çö M‚Çö)
    let e : M‚Çö' ‚âÉ‚Çó[R‚Çö] M‚Çö'' := (localizedQuotientEquiv _ _).symm ‚â™‚â´‚Çó
      Submodule.quotEquivOfEq _ _ (by rw [Submodule.localized,
        Submodule.localized'_smul, Ideal.localized'_eq_map, Submodule.localized'_top])
    have : Nontrivial M‚Çö'' := by
      rw [Submodule.Quotient.nontrivial_iff, ne_comm]
      apply Submodule.top_ne_ideal_smul_of_le_jacobson_annihilator
      refine trans ?_ (IsLocalRing.maximalIdeal_le_jacobson _)
      rw [‚Üê Localization.AtPrime.map_eq_maximalIdeal]
      exact Ideal.map_mono hp‚ÇÇ
    exact e.nontrivial
","theorem Module.support_quotient (I : Ideal R) :
    support R (M ‚ß∏ (I ‚Ä¢ ‚ä§ : Submodule R M)) = support R M ‚à© zeroLocus I ","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      The functors $M \\mapsto M_{\\mathfrak p}$ are exact. This immediately implies all but the first assertion. For the first assertion we need to show that $M_\\mathfrak p \\not= 0$ and $I \\subset \\mathfrak p$ implies $(M/IM)_{\\mathfrak p} = M_\\mathfrak p/IM_\\mathfrak p \\not= 0$. This follows from Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is establishing a set-theoretic equality via `subset_antisymm` between a support condition and an intersection condition involving the quotient by `I ‚Ä¢ ‚ä§` and the zero locus of an annihilator/ideal condition. This matches the informal argument‚Äôs key claim: if \\(M_\\mathfrak p \\neq 0\\) and \\(I \\subset \\mathfrak p\\), then \\((M/IM)_\\mathfrak p \\cong M_\\mathfrak p/IM_\\mathfrak p \\neq 0\\), i.e. membership in the support of the quotient is implied by membership in the support of \\(M\\) plus the condition \\(I \\subset \\mathfrak p\\). Structurally, the Lean proof splits into two inclusions: (1) support of the quotient is contained in support of \\(M\\) (using `Module.support_subset_of_surjective` and the surjection to the quotient) and contained in a zero-locus condition (using `support_eq_zeroLocus`, `annihilator_quotient`, and anti-monotonicity of `zeroLocus`), corresponding to the ‚Äúexactness gives all but the first assertion‚Äù part. (2) For the reverse inclusion, it localizes at \\(p\\), constructs the equivalence between localized quotient and quotient of localized module (`localizedQuotientEquiv`), and proves nontriviality of the localized quotient using a Nakayama-style lemma (`top_ne_ideal_smul_of_le_jacobson_annihilator` plus Jacobson radical containment in a local ring), which corresponds to the informal use of Nakayama to show the localized quotient is nonzero. \n\nThe main mismatch is that the informal proof explicitly cites exactness of localization and Nakayama‚Äôs lemma in a general form, while the Lean proof uses specific support/zeroLocus/annihilator lemmas and a particular Nakayama corollary about `top_ne_ideal_smul_of_le_jacobson_annihilator`. The overall mathematical content aligns well, but the informal proof is higher-level and does not mention the intermediate zero-locus/annihilator manipulations present in Lean.""}"
241,00IS,"theorem fg_of_fg_of_fg [IsNoetherianRing A] (hAC : (‚ä§ : Subalgebra A C).FG)
    (hBC : (‚ä§ : Submodule B C).FG) (hBCi : Function.Injective (algebraMap B C)) :
    (‚ä§ : Subalgebra A B).FG :=
  let ‚ü®B‚ÇÄ, hAB‚ÇÄ, hB‚ÇÄC‚ü© := exists_subalgebra_of_fg A B C hAC hBC
  Algebra.fg_trans' (B‚ÇÄ.fg_top.2 hAB‚ÇÄ) <|
    Subalgebra.fg_of_submodule_fg <|
      have : IsNoetherianRing B‚ÇÄ := isNoetherianRing_of_fg hAB‚ÇÄ
      have : Module.Finite B‚ÇÄ C := ‚ü®hB‚ÇÄC‚ü©
      fg_of_injective (IsScalarTower.toAlgHom B‚ÇÄ B C).toLinearMap hBCi
",Formal Proof of Stacks Project Tag 00IS,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Adjoin/Tower.lean#L150-L158,Q27041,Artin-Tate,10.51.7,lemma,3.0,"['00IJ', '00AO', '0ELQ']","\n  Lemma 10.51.7 (Artin-Tate).  Let $R$ be a Noetherian ring. Let $S$ be a finitely generated $R$-algebra. If $T \\subset S$ is an $R$-subalgebra such that $S$ is finitely generated as a $T$-module, then $T$ is of finite type over $R$. \n\n    \n      Proof.\n      Choose elements $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an $R$-algebra. Choose $y_1, \\ldots , y_ m$ in $S$ which generate $S$ as a $T$-module. Thus there exist $a_{ij} \\in T$ such that $x_ i = \\sum a_{ij} y_ j$. There also exist $b_{ijk} \\in T$ such that $y_ i y_ j = \\sum b_{ijk} y_ k$. Let $T\' \\subset T$ be the sub $R$-algebra generated by $a_{ij}$ and $b_{ijk}$. This is a finitely generated $R$-algebra, hence Noetherian. Consider the algebra \n    \n      \n  \\[  S\' = T\'[Y_1, \\ldots , Y_ m]/(Y_ i Y_ j - \\sum b_{ijk} Y_ k).  \\]\n\n    \n       Note that $S\'$ is finite over $T\'$, namely as a $T\'$-module it is generated by the classes of $1, Y_1, \\ldots , Y_ m$. Consider the $T\'$-algebra homomorphism $S\' \\to S$ which maps $Y_ i$ to $y_ i$. Because $a_{ij} \\in T\'$ we see that $x_ j$ is in the image of this map. Thus $S\' \\to S$ is surjective. Therefore $S$ is finite over $T\'$ as well. Since $T\'$ is Noetherian we conclude that $T \\subset S$ is finite over $T\'$ and we win. \n      $\\square$\n    \n","\n  Lemma 10.51.7 (Artin-Tate).  Let $R$ be a Noetherian ring. Let $S$ be a finitely generated $R$-algebra. If $T \\subset S$ is an $R$-subalgebra such that $S$ is finitely generated as a $T$-module, then $T$ is of finite type over $R$. \n\n    \n","Proof.\n      Choose elements $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an $R$-algebra. Choose $y_1, \\ldots , y_ m$ in $S$ which generate $S$ as a $T$-module. Thus there exist $a_{ij} \\in T$ such that $x_ i = \\sum a_{ij} y_ j$. There also exist $b_{ijk} \\in T$ such that $y_ i y_ j = \\sum b_{ijk} y_ k$. Let $T\' \\subset T$ be the sub $R$-algebra generated by $a_{ij}$ and $b_{ijk}$. This is a finitely generated $R$-algebra, hence Noetherian. Consider the algebra \n    \n      \n  \\[  S\' = T\'[Y_1, \\ldots , Y_ m]/(Y_ i Y_ j - \\sum b_{ijk} Y_ k).  \\]\n\n    \n       Note that $S\'$ is finite over $T\'$, namely as a $T\'$-module it is generated by the classes of $1, Y_1, \\ldots , Y_ m$. Consider the $T\'$-algebra homomorphism $S\' \\to S$ which maps $Y_ i$ to $y_ i$. Because $a_{ij} \\in T\'$ we see that $x_ j$ is in the image of this map. Thus $S\' \\to S$ is surjective. Therefore $S$ is finite over $T\'$ as well. Since $T\'$ is Noetherian we conclude that $T \\subset S$ is finite over $T\'$ and we win. \n      $\\square$\n    \n","
  let ‚ü®B‚ÇÄ, hAB‚ÇÄ, hB‚ÇÄC‚ü© := exists_subalgebra_of_fg A B C hAC hBC
  Algebra.fg_trans' (B‚ÇÄ.fg_top.2 hAB‚ÇÄ) <|
    Subalgebra.fg_of_submodule_fg <|
      have : IsNoetherianRing B‚ÇÄ := isNoetherianRing_of_fg hAB‚ÇÄ
      have : Module.Finite B‚ÇÄ C := ‚ü®hB‚ÇÄC‚ü©
      fg_of_injective (IsScalarTower.toAlgHom B‚ÇÄ B C).toLinearMap hBCi
","theorem fg_of_fg_of_fg [IsNoetherianRing A] (hAC : (‚ä§ : Subalgebra A C).FG)
    (hBC : (‚ä§ : Submodule B C).FG) (hBCi : Function.Injective (algebraMap B C)) :
    (‚ä§ : Subalgebra A B).FG ","Proof.\n      Choose elements $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an $R$-algebra. Choose $y_1, \\ldots , y_ m$ in $S$ which generate $S$ as a $T$-module. Thus there exist $a_{ij} \\in T$ such that $x_ i = \\sum a_{ij} y_ j$. There also exist $b_{ijk} \\in T$ such that $y_ i y_ j = \\sum b_{ijk} y_ k$. Let $T\' \\subset T$ be the sub $R$-algebra generated by $a_{ij}$ and $b_{ijk}$. This is a finitely generated $R$-algebra, hence Noetherian. Consider the algebra \n    \n      \n  \\[  S\' = T\'[Y_1, \\ldots , Y_ m]/(Y_ i Y_ j - \\sum b_{ijk} Y_ k).  \\]\n\n    \n       Note that $S\'$ is finite over $T\'$, namely as a $T\'$-module it is generated by the classes of $1, Y_1, \\ldots , Y_ m$. Consider the $T\'$-algebra homomorphism $S\' \\to S$ which maps $Y_ i$ to $y_ i$. Because $a_{ij} \\in T\'$ we see that $x_ j$ is in the image of this map. Thus $S\' \\to S$ is surjective. Therefore $S$ is finite over $T\'$ as well. Since $T\'$ is Noetherian we conclude that $T \\subset S$ is finite over $T\'$ and we win. \n      $\\square$\n    \n","Proof.\n      Choose elements $x_1, \\ldots , x_ n \\in S$ which generate $S$ as an $R$-algebra. Choose $y_1, \\ldots , y_ m$ in $S$ which generate $S$ as a $T$-module. Thus there exist $a_{ij} \\in T$ such that $x_ i = \\sum a_{ij} y_ j$. There also exist $b_{ijk} \\in T$ such that $y_ i y_ j = \\sum b_{ijk} y_ k$. Let $T\' \\subset T$ be the sub $R$-algebra generated by $a_{ij}$ and $b_{ijk}$. This is a finitely generated $R$-algebra, hence Noetherian. Consider the algebra \n    \n      \n  \\[  S\' = T\'[Y_1, \\ldots , Y_ m]/(Y_ i Y_ j - \\sum b_{ijk} Y_ k).  \\]\n\n    \n       Note that $S\'$ is finite over $T\'$, namely as a $T\'$-module it is generated by the classes of $1, Y_1, \\ldots , Y_ m$. Consider the $T\'$-algebra homomorphism $S\' \\to S$ which maps $Y_ i$ to $y_ i$. Because $a_{ij} \\in T\'$ we see that $x_ j$ is in the image of this map. Thus $S\' \\to S$ is surjective. Therefore $S$ is finite over $T\'$ as well. Since $T\'$ is Noetherian we conclude that $T \\subset S$ is finite over $T\'$ and we win. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs follow the same strategy: construct an intermediate finitely generated subalgebra B‚ÇÄ (the informal T‚Ä≤) inside B/T so that (i) A‚ÜíB‚ÇÄ is finitely generated (hence B‚ÇÄ is Noetherian) and (ii) C/S is finite over B‚ÇÄ, then conclude A‚ÜíC is finitely generated by combining finite-over-Noetherian with transitivity. The Lean proof uses `exists_subalgebra_of_fg` to obtain ‚ü®B‚ÇÄ, hAB‚ÇÄ, hB‚ÇÄC‚ü©, then derives `IsNoetherianRing B‚ÇÄ` from `isNoetherianRing_of_fg hAB‚ÇÄ`, and uses `Module.Finite B‚ÇÄ C` plus `fg_of_injective ... hBCi` to get the needed finiteness/f.g. statement, matching the informal ‚ÄúT‚Ä≤ Noetherian, S finite over T‚Ä≤, then conclude‚Äù. Structurally, the informal proof explicitly builds generators a_ij, b_ijk and a quotient algebra S‚Ä≤ with a surjection to S; the Lean proof abstracts this construction into the existence lemma `exists_subalgebra_of_fg` and does not mirror the explicit polynomial/quotient presentation. So the high-level structure aligns, but the detailed constructive steps in the informal proof are not reflected directly in the formal code.""}"
242,09GF,"theorem IsAlgebraic.tower_top {x : A} (A_alg : IsAlgebraic K x) :
    IsAlgebraic L x :=
  A_alg.extendScalars (algebraMap K L).injective
",Formal Proof of Stacks Project Tag 09GF,part one,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Basic.lean#L450-L452,Q27041,,9.8.4,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n      Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n","\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n",Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n,"
  A_alg.extendScalars (algebraMap K L).injective
","theorem IsAlgebraic.tower_top {x : A} (A_alg : IsAlgebraic K x) :
    IsAlgebraic L x ",Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n,"Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: part one","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean term `A_alg.extendScalars (algebraMap K L).injective` asserts injectivity of an `extendScalars` map, derived directly from the injectivity of `algebraMap K L`. This matches the informal claim that the result is ‚Äúimmediate from the definitions,‚Äù i.e., a one-line consequence without further argument. Structurally, both are extremely short and rely on a direct application of a definition/lemma rather than a multi-step derivation. The only slight mismatch is that the informal proof explicitly cites ‚Äúdefinitions,‚Äù while the Lean proof uses a named lemma/field (`extendScalars ... .injective`) which may encapsulate more than mere unfolding, but it still functions as an immediate, definition-level fact in practice.""}"
243,09GF,"theorem Algebra.IsAlgebraic.tower_top [Algebra.IsAlgebraic K A] : Algebra.IsAlgebraic L A :=
  Algebra.IsAlgebraic.extendScalars (algebraMap K L).injective
",Formal Proof of Stacks Project Tag 09GF,part two,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Basic.lean#L462-L463,Q27041,,9.8.4,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n      Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n","\n  Lemma 9.8.4. Let $K/E/F$ be a tower of field extensions. \n  \n  \nIf $\\alpha \\in K$ is algebraic over $F$, then $\\alpha $ is algebraic over $E$. \n\n\nIf $K$ is algebraic over $F$, then $K$ is algebraic over $E$. \n\n\n\n\n    \n",Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n,"
  Algebra.IsAlgebraic.extendScalars (algebraMap K L).injective
",theorem Algebra.IsAlgebraic.tower_top [Algebra.IsAlgebraic K A] : Algebra.IsAlgebraic L A ,Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n,"Proof.\n      This is immediate from the definitions. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: part two","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof claims the result is ‚Äúimmediate from the definitions,‚Äù but it does not specify what the result is. The Lean term `Algebra.IsAlgebraic.extendScalars (algebraMap K L).injective` proves a very specific statement: injectivity of the `extendScalars` map associated to `algebraMap K L` under an `IsAlgebraic` hypothesis. Without the underlying statement (and given only ‚Äúpart two‚Äù as a vague reference), it‚Äôs unclear that this is the same claim as the informal proof. Structurally, the informal proof is a one-line definitional argument, while the Lean proof is a direct invocation of an existing lemma about `extendScalars` injectivity, not an explicit unfolding of definitions. Thus there is at best partial alignment: it could match if the intended statement is exactly that lemma, but the correspondence is not demonstrated.""}"
244,0BID,"theorem Subalgebra.isField_of_algebraic [Algebra.IsAlgebraic K L] : IsField A :=
  { show Nontrivial A by infer_instance, Subalgebra.toCommRing A with
    mul_inv_cancel := fun {a} ha =>
      ‚ü®‚ü®a‚Åª¬π, A.inv_mem_of_algebraic (Algebra.IsAlgebraic.isAlgebraic (a : L))‚ü©,
        Subtype.ext (mul_inv_cancel‚ÇÄ (mt (Subalgebra.coe_eq_zero _).mp ha))‚ü© }
",Formal Proof of Stacks Project Tag 0BID,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Basic.lean#L648-L652,Q27041,,9.8.10,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n  Lemma 9.8.10. Let $E/F$ be a finite or more generally an algebraic extension of fields. Any subring $F \\subset R \\subset E$ is a field. \n\n    \n      Proof.\n      Let $\\alpha \\in R$ be nonzero. Then $1, \\alpha , \\alpha ^2, \\ldots $ are contained in $R$. By Lemma 9.8.5 we find a nontrivial relation $a_0 + a_1 \\alpha + \\ldots + a_ d \\alpha ^ d = 0$ with $a_ i \\in F$. We may assume $a_0 \\not= 0$ because if not we can divide the relation by $\\alpha $ to decrease $d$. Then we see that \n    \n      \n  \\[  a_0 = \\alpha (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})  \\]\n\n    \n       which proves that the inverse of $\\alpha $ is the element $a_0^{-1} (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})$ of $R$. \n      $\\square$\n    \n",\n  Lemma 9.8.10. Let $E/F$ be a finite or more generally an algebraic extension of fields. Any subring $F \\subset R \\subset E$ is a field. \n\n    \n,"Proof.\n      Let $\\alpha \\in R$ be nonzero. Then $1, \\alpha , \\alpha ^2, \\ldots $ are contained in $R$. By Lemma 9.8.5 we find a nontrivial relation $a_0 + a_1 \\alpha + \\ldots + a_ d \\alpha ^ d = 0$ with $a_ i \\in F$. We may assume $a_0 \\not= 0$ because if not we can divide the relation by $\\alpha $ to decrease $d$. Then we see that \n    \n      \n  \\[  a_0 = \\alpha (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})  \\]\n\n    \n       which proves that the inverse of $\\alpha $ is the element $a_0^{-1} (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})$ of $R$. \n      $\\square$\n    \n","
  { show Nontrivial A by infer_instance, Subalgebra.toCommRing A with
    mul_inv_cancel := fun {a} ha =>
      ‚ü®‚ü®a‚Åª¬π, A.inv_mem_of_algebraic (Algebra.IsAlgebraic.isAlgebraic (a : L))‚ü©,
        Subtype.ext (mul_inv_cancel‚ÇÄ (mt (Subalgebra.coe_eq_zero _).mp ha))‚ü© }
",theorem Subalgebra.isField_of_algebraic [Algebra.IsAlgebraic K L] : IsField A ,"Proof.\n      Let $\\alpha \\in R$ be nonzero. Then $1, \\alpha , \\alpha ^2, \\ldots $ are contained in $R$. By Lemma 9.8.5 [[\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n]] we find a nontrivial relation $a_0 + a_1 \\alpha + \\ldots + a_ d \\alpha ^ d = 0$ with $a_ i \\in F$. We may assume $a_0 \\not= 0$ because if not we can divide the relation by $\\alpha $ to decrease $d$. Then we see that \n    \n      \n  \\[  a_0 = \\alpha (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})  \\]\n\n    \n       which proves that the inverse of $\\alpha $ is the element $a_0^{-1} (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})$ of $R$. \n      $\\square$\n    \n","Proof.\n      Let $\\alpha \\in R$ be nonzero. Then $1, \\alpha , \\alpha ^2, \\ldots $ are contained in $R$. By Lemma 9.8.5 [[\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n]] we find a nontrivial relation $a_0 + a_1 \\alpha + \\ldots + a_ d \\alpha ^ d = 0$ with $a_ i \\in F$. We may assume $a_0 \\not= 0$ because if not we can divide the relation by $\\alpha $ to decrease $d$. Then we see that \n    \n      \n  \\[  a_0 = \\alpha (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})  \\]\n\n    \n       which proves that the inverse of $\\alpha $ is the element $a_0^{-1} (- a_1 - \\ldots - a_ d \\alpha ^{d - 1})$ of $R$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish that a certain subalgebra/subring is a commutative ring in which every nonzero element has an inverse lying in the same subalgebra: the informal proof constructs the inverse of a nonzero element Œ± using an algebraic dependence relation, while the Lean proof uses `A.inv_mem_of_algebraic` (fed by `Algebra.IsAlgebraic.isAlgebraic`) to assert that a‚Åª¬π lies in the subalgebra and then proves `a * a‚Åª¬π = 1` via `mul_inv_cancel‚ÇÄ` after reducing nonzeroness through coercions. Structurally, the informal argument explicitly derives an inverse from a polynomial relation and a0 ‚â† 0, whereas the formal proof does not mirror this construction and instead relies on a library lemma that packages the algebraic-inverse-in-subalgebra fact. Thus the core mathematical content aligns well, but the formal proof is more abstract/lemma-driven and omits the explicit polynomial manipulation present in the informal proof.""}"
247,09GG,"instance Algebra.IsAlgebraic.of_finite [Module.Finite R A] : Algebra.IsAlgebraic R A :=
  (IsIntegral.of_finite R A).isAlgebraic
",Formal Proof of Stacks Project Tag 09GG,first part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Integral.lean#L107-L108,Q27041,,9.8.5,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n      Proof.\n      Let $E/k$ be finite, say of degree $n$. Choose $\\alpha \\in E$. Then the elements $1, \\alpha , \\ldots , \\alpha ^ n$ are linearly dependent over $k$, or we would necessarily have $[E : k] > n$. A relation of linear dependence now gives the desired polynomial that $\\alpha $ must satisfy. \n    \n      For the last assertion, note that a monogenic extension $k(\\alpha )/k$ is finite if and only if $\\alpha $ is algebraic over $k$, by Examples 9.7.4 and 9.7.6. So if $E/k$ is algebraic, then each $k(\\alpha )/k$, $\\alpha \\in E$, is a finite extension, and conversely. \n      $\\square$\n    \n","\n  Lemma 9.8.5. A finite extension is algebraic. In fact, an extension $E/k$ is algebraic if and only if every subextension $k(\\alpha )/k$ generated by some $\\alpha \\in E$ is finite. \n\n    \n","Proof.\n      Let $E/k$ be finite, say of degree $n$. Choose $\\alpha \\in E$. Then the elements $1, \\alpha , \\ldots , \\alpha ^ n$ are linearly dependent over $k$, or we would necessarily have $[E : k] > n$. A relation of linear dependence now gives the desired polynomial that $\\alpha $ must satisfy. \n    \n      For the last assertion, note that a monogenic extension $k(\\alpha )/k$ is finite if and only if $\\alpha $ is algebraic over $k$, by Examples 9.7.4 and 9.7.6. So if $E/k$ is algebraic, then each $k(\\alpha )/k$, $\\alpha \\in E$, is a finite extension, and conversely. \n      $\\square$\n    \n","
  (IsIntegral.of_finite R A).isAlgebraic
",instance Algebra.IsAlgebraic.of_finite [Module.Finite R A] : Algebra.IsAlgebraic R A ,"Proof.\n      Let $E/k$ be finite, say of degree $n$. Choose $\\alpha \\in E$. Then the elements $1, \\alpha , \\ldots , \\alpha ^ n$ are linearly dependent over $k$, or we would necessarily have $[E : k] > n$. A relation of linear dependence now gives the desired polynomial that $\\alpha $ must satisfy. \n    \n      For the last assertion, note that a monogenic extension $k(\\alpha )/k$ is finite if and only if $\\alpha $ is algebraic over $k$, by Examples 9.7.4 [[\n  Example 9.7.4 (Degree of a rational function field).  If $k$ is any field, then the rational function field $k(t)$ is not a finite extension. For example the elements $\\left\\{ t^ n, n \\in \\mathbf{Z}\\right\\} $ are linearly independent over $k$. \n  In fact, if $k$ is uncountable, then $k(t)$ is uncountably dimensional as a $k$-vector space. To show this, we claim that the family of elements $\\{ 1/(t- \\alpha ), \\alpha \\in k\\}  \\subset k(t)$ is linearly independent over $k$. A nontrivial relation between them would lead to a contradiction: for instance, if one works over $\\mathbf{C}$, then this follows because $\\frac{1}{t-\\alpha }$, when considered as a meromorphic function on $\\mathbf{C}$, has a pole at $\\alpha $ and nowhere else. Consequently any sum $\\sum c_ i \\frac{1}{t - \\alpha _ i}$ for the $c_ i \\in k^*$, and $\\alpha _ i \\in k$ distinct, would have poles at each of the $\\alpha _ i$. In particular, it could not be zero. \n  Amusingly, this leads to a quick proof of the Hilbert Nullstellensatz over the complex numbers. For a slightly more general result, see Algebra, Theorem 10.35.11. \n]] and 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. So if $E/k$ is algebraic, then each $k(\\alpha )/k$, $\\alpha \\in E$, is a finite extension, and conversely. \n      $\\square$\n    \n","Proof.\n      Let $E/k$ be finite, say of degree $n$. Choose $\\alpha \\in E$. Then the elements $1, \\alpha , \\ldots , \\alpha ^ n$ are linearly dependent over $k$, or we would necessarily have $[E : k] > n$. A relation of linear dependence now gives the desired polynomial that $\\alpha $ must satisfy. \n    \n      For the last assertion, note that a monogenic extension $k(\\alpha )/k$ is finite if and only if $\\alpha $ is algebraic over $k$, by Examples 9.7.4 [[\n  Example 9.7.4 (Degree of a rational function field).  If $k$ is any field, then the rational function field $k(t)$ is not a finite extension. For example the elements $\\left\\{ t^ n, n \\in \\mathbf{Z}\\right\\} $ are linearly independent over $k$. \n  In fact, if $k$ is uncountable, then $k(t)$ is uncountably dimensional as a $k$-vector space. To show this, we claim that the family of elements $\\{ 1/(t- \\alpha ), \\alpha \\in k\\}  \\subset k(t)$ is linearly independent over $k$. A nontrivial relation between them would lead to a contradiction: for instance, if one works over $\\mathbf{C}$, then this follows because $\\frac{1}{t-\\alpha }$, when considered as a meromorphic function on $\\mathbf{C}$, has a pole at $\\alpha $ and nowhere else. Consequently any sum $\\sum c_ i \\frac{1}{t - \\alpha _ i}$ for the $c_ i \\in k^*$, and $\\alpha _ i \\in k$ distinct, would have poles at each of the $\\alpha _ i$. In particular, it could not be zero. \n  Amusingly, this leads to a quick proof of the Hilbert Nullstellensatz over the complex numbers. For a slightly more general result, see Algebra, Theorem 10.35.11. \n]] and 9.7.6 [[\n  Example 9.7.6 (Degree of a simple algebraic extension).  Consider a monogenic field extension $E/k$ of the form discussed in Example 9.6.4. In other words, $E = k[t]/(P)$ for $P \\in k[t]$ an irreducible polynomial. Then the degree $[E : k]$ is just the degree $d = \\deg (P)$ of the polynomial $P$. Indeed, say \n  \n    9.7.6.1\n  \\begin{equation}  \\label{fields-equation-P} P = a_ d t^ d + a_{d - 1} t^{d - 1} + \\ldots + a_0. \\end{equation}\n\n   with $a_ d \\not= 0$. Then the images of $1, t, \\ldots , t^{d - 1}$ in $k[t]/(P)$ are linearly independent over $k$, because any relation involving them would have degree strictly smaller than that of $P$, and $P$ is the element of smallest degree in the ideal $(P)$. \n  Conversely, the set $S = \\{ 1, t, \\ldots , t^{d - 1}\\} $ (or more properly their images) spans $k[t]/(P)$ as a vector space. Indeed, we have by (9.7.6.1) that $a_ d t^ d$ lies in the span of $S$. Since $a_ d$ is invertible, we see that $t^ d$ is in the span of $S$. Similarly, the relation $t P(t) = 0$ shows that the image of $t^{d + 1}$ lies in the span of $\\{ 1, t, \\ldots , t^ d\\} $ \xe2\x80\x94 by what was just shown, thus in the span of $S$. Working upward inductively, we find that the image of $t^ n$ for $n \\geq d$ lies in the span of $S$. \n]]. So if $E/k$ is algebraic, then each $k(\\alpha )/k$, $\\alpha \\in E$, is a finite extension, and conversely. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: first part","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean term `(IsIntegral.of_finite R A).isAlgebraic` proves that a finite (module-finite) algebra extension is algebraic by going through integrality: `of_finite` gives `IsIntegral` for every element, and `isAlgebraic` converts integrality to algebraicity. This matches the informal first part: in a finite extension every element satisfies a polynomial over the base field (constructed via linear dependence). Structurally, the informal proof explicitly uses linear dependence of powers to build a polynomial, while the Lean proof uses the standard lemma chain ‚Äúfinite ‚áí integral ‚áí algebraic‚Äù without reproducing the linear-dependence argument. It also does not address the informal ‚Äòlast assertion‚Äô about monogenic extensions, but the user note says to consider only the first part, so that omission is acceptable.""}"
248,09GJ,"    Algebra.IsAlgebraic R A :=
  ‚ü®fun _ ‚Ü¶ (alg.1 _).restrictScalars _‚ü©
",Formal Proof of Stacks Project Tag 09GJ, theorem IsAlgebraic.trans [Algebra.IsAlgebraic R S] [alg : Algebra.IsAlgebraic S A] ,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Integral.lean#L324-L325,Q27041,,9.8.8,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n  Lemma 9.8.8. Let $E/k$ and $F/E$ be algebraic extensions of fields. Then $F/k$ is an algebraic extension of fields. \n\n    \n      Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is algebraic over $E$. The key observation is that $\\alpha $ is algebraic over a finitely generated subextension of $k$. That is, there is a finite set $S \\subset E$ such that $\\alpha $ is algebraic over $k(S)$: this is clear because being algebraic means that a certain polynomial in $E[x]$ that $\\alpha $ satisfies exists, and as $S$ we can take the coefficients of this polynomial. It follows that $\\alpha $ is algebraic over $k(S)$. In particular, the extension $k(S, \\alpha )/ k(S)$ is finite. Since $S$ is a finite set, and $k(S)/k$ is algebraic, Lemma 9.8.6 shows that $k(S)/k$ is finite. Using multiplicativity (Lemma 9.7.7) we find that $k(S,\\alpha )/k$ is finite, so $\\alpha $ is algebraic over $k$. \n      $\\square$\n    \n",\n  Lemma 9.8.8. Let $E/k$ and $F/E$ be algebraic extensions of fields. Then $F/k$ is an algebraic extension of fields. \n\n    \n,"Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is algebraic over $E$. The key observation is that $\\alpha $ is algebraic over a finitely generated subextension of $k$. That is, there is a finite set $S \\subset E$ such that $\\alpha $ is algebraic over $k(S)$: this is clear because being algebraic means that a certain polynomial in $E[x]$ that $\\alpha $ satisfies exists, and as $S$ we can take the coefficients of this polynomial. It follows that $\\alpha $ is algebraic over $k(S)$. In particular, the extension $k(S, \\alpha )/ k(S)$ is finite. Since $S$ is a finite set, and $k(S)/k$ is algebraic, Lemma 9.8.6 shows that $k(S)/k$ is finite. Using multiplicativity (Lemma 9.7.7) we find that $k(S,\\alpha )/k$ is finite, so $\\alpha $ is algebraic over $k$. \n      $\\square$\n    \n","
  ‚ü®fun _ ‚Ü¶ (alg.1 _).restrictScalars _‚ü©
",    Algebra.IsAlgebraic R A ,"Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is algebraic over $E$. The key observation is that $\\alpha $ is algebraic over a finitely generated subextension of $k$. That is, there is a finite set $S \\subset E$ such that $\\alpha $ is algebraic over $k(S)$: this is clear because being algebraic means that a certain polynomial in $E[x]$ that $\\alpha $ satisfies exists, and as $S$ we can take the coefficients of this polynomial. It follows that $\\alpha $ is algebraic over $k(S)$. In particular, the extension $k(S, \\alpha )/ k(S)$ is finite. Since $S$ is a finite set, and $k(S)/k$ is algebraic, Lemma 9.8.6 [[\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n]] shows that $k(S)/k$ is finite. Using multiplicativity (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) we find that $k(S,\\alpha )/k$ is finite, so $\\alpha $ is algebraic over $k$. \n      $\\square$\n    \n","Proof.\n      Choose $\\alpha \\in F$. Then $\\alpha $ is algebraic over $E$. The key observation is that $\\alpha $ is algebraic over a finitely generated subextension of $k$. That is, there is a finite set $S \\subset E$ such that $\\alpha $ is algebraic over $k(S)$: this is clear because being algebraic means that a certain polynomial in $E[x]$ that $\\alpha $ satisfies exists, and as $S$ we can take the coefficients of this polynomial. It follows that $\\alpha $ is algebraic over $k(S)$. In particular, the extension $k(S, \\alpha )/ k(S)$ is finite. Since $S$ is a finite set, and $k(S)/k$ is algebraic, Lemma 9.8.6 [[\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n]] shows that $k(S)/k$ is finite. Using multiplicativity (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) we find that $k(S,\\alpha )/k$ is finite, so $\\alpha $ is algebraic over $k$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem IsAlgebraic.trans [Algebra.IsAlgebraic R S] [alg : Algebra.IsAlgebraic S A]","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues a nontrivial transitivity result for algebraicity in a tower (showing an element algebraic over an intermediate field is algebraic over the base, via finitely generated subextensions, finiteness, and degree multiplicativity). The Lean term `‚ü®fun _ ‚Ü¶ (alg.1 _).restrictScalars _‚ü©` instead constructs an instance by taking an existing `alg : Algebra.IsAlgebraic S A` and restricting scalars, i.e. it uses a library lemma that algebraicity is preserved under `restrictScalars`. This matches the *statement* of `IsAlgebraic.trans` only at a high level (it produces the transitive instance), but it does not reflect the informal argument‚Äôs structure (no finite set of coefficients, no finiteness lemma, no multiplicativity). Structurally it is a one-line instance construction rather than the multi-step field-degree argument. Completeness-wise, all key intermediate reasoning from the informal proof is absent, though it may be encapsulated in the library lemma used. Hence low-to-moderate alignment.""}"
249,0G1M,"    Module.rank (FractionRing R[X]) (FractionRing S[X]) = Module.rank R S := by
  have := (FaithfulSMul.algebraMap_injective R S).isDomain
  rw [rank_fractionRing, rank_polynomial_polynomial]
",Formal Proof of Stacks Project Tag 0G1M, theorem rank_fractionRing_polynomial ,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Integral.lean#L631-L633,Q27041,,9.26.10,lemma,3.0,"['030D', '09FA', '0ELQ']","\n  Lemma 9.26.10. Let $k\'/k$ be a finite extension of fields. Let $k\'(x_1, \\ldots , x_ r)/k(x_1, \\ldots , x_ r)$ be the induced extension of purely transcendental extensions. Then $[k\'(x_1, \\ldots , x_ r) : k(x_1, \\ldots , x_ r)] = [k\' : k] < \\infty $. \n\n    \n      Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n","\n  Lemma 9.26.10. Let $k\'/k$ be a finite extension of fields. Let $k\'(x_1, \\ldots , x_ r)/k(x_1, \\ldots , x_ r)$ be the induced extension of purely transcendental extensions. Then $[k\'(x_1, \\ldots , x_ r) : k(x_1, \\ldots , x_ r)] = [k\' : k] < \\infty $. \n\n    \n","Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n"," by
  have := (FaithfulSMul.algebraMap_injective R S).isDomain
  rw [rank_fractionRing, rank_polynomial_polynomial]
",    Module.rank (FractionRing R[X]) (FractionRing S[X]) = Module.rank R S ,"Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n","Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem rank_fractionRing_polynomial","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof argues about degrees of field extensions in a tower, reduction to a simple extension, minimal polynomials, irreducibility persisting after adjoining transcendental elements, and uses Gauss' lemma. The Lean proof instead invokes `FaithfulSMul.algebraMap_injective R S).isDomain` (establishing a domain property via injectivity) and then finishes by rewriting with lemmas `rank_fractionRing` and `rank_polynomial_polynomial`. There is no trace of the tower/multiplicativity argument, minimal polynomial reasoning, or Gauss lemma/irreducibility preservation. Structurally, the informal proof is a multi-step reduction and irreducibility argument, while the Lean proof is a short domain fact plus two `rw` steps, suggesting it is proving the result by existing rank lemmas rather than reproducing the informal strategy. Thus the formal proof does not reflect the content or structure of the informal proof, beyond (at best) targeting a related statement about ranks/fraction fields and polynomials.""}"
250,0G1M,"    Module.rank (FractionRing (MvPolynomial œÉ R)) (FractionRing (MvPolynomial œÉ S)) =
    lift.{u} (Module.rank R S) := by
  have := (FaithfulSMul.algebraMap_injective R S).isDomain
  rw [rank_fractionRing, rank_mvPolynomial_mvPolynomial]
",Formal Proof of Stacks Project Tag 0G1M, theorem rank_fractionRing_mvPolynomial (œÉ : Type u) ,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/Integral.lean#L637-L640,Q27041,,9.26.10,lemma,3.0,"['030D', '09FA', '0ELQ']","\n  Lemma 9.26.10. Let $k\'/k$ be a finite extension of fields. Let $k\'(x_1, \\ldots , x_ r)/k(x_1, \\ldots , x_ r)$ be the induced extension of purely transcendental extensions. Then $[k\'(x_1, \\ldots , x_ r) : k(x_1, \\ldots , x_ r)] = [k\' : k] < \\infty $. \n\n    \n      Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n","\n  Lemma 9.26.10. Let $k\'/k$ be a finite extension of fields. Let $k\'(x_1, \\ldots , x_ r)/k(x_1, \\ldots , x_ r)$ be the induced extension of purely transcendental extensions. Then $[k\'(x_1, \\ldots , x_ r) : k(x_1, \\ldots , x_ r)] = [k\' : k] < \\infty $. \n\n    \n","Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n"," by
  have := (FaithfulSMul.algebraMap_injective R S).isDomain
  rw [rank_fractionRing, rank_mvPolynomial_mvPolynomial]
","    Module.rank (FractionRing (MvPolynomial œÉ R)) (FractionRing (MvPolynomial œÉ S)) =
    lift.{u} (Module.rank R S) ","Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n","Proof.\n      By multiplicativity of degrees of extensions (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) it suffices to prove this when $k\'$ is generated by a single element $\\alpha \\in k\'$ over $k$. Let $f \\in k[T]$ be the minimal polynomial of $\\alpha $ over $k$. Then $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha , x_1, \\ldots , x_ r$ over $k$ and hence $k\'(x_1, \\ldots , x_ r)$ is generated by $\\alpha $ over $k(x_1, \\ldots , x_ r)$. Thus it suffices to show that $f$ is still irreducible as an element of $k(x_1, \\ldots , x_ r)[T]$. We only sketch the proof. It is clear that $f$ is irreducible as an element of $k[x_1, \\ldots , x_ r, T]$ for example because $f$ is monic as a polynomial in $T$ and any putative factorization in $k[x_1, \\ldots , x_ r, T]$ would lead to a factorization in $k[T]$ by setting $x_ i$ equal to $0$. By Gauss\' lemma we conclude. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem rank_fractionRing_mvPolynomial (œÉ : Type u)","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof argues about degrees of field extensions in a tower, reduction to a simple algebraic extension, and preservation of irreducibility via Gauss‚Äô lemma to conclude a degree/rank statement for adjoining rational function variables. The Lean proof instead invokes `FaithfulSMul.algebraMap_injective R S).isDomain` (a domain/injectivity fact) and then finishes by rewriting with `rank_fractionRing` and `rank_mvPolynomial_mvPolynomial`, i.e. it is a short proof by existing lemmas and simp-style rewriting, with no visible correspondence to multiplicativity of degrees, minimal polynomials, or Gauss‚Äô lemma. Structurally, the informal proof is a multi-step reduction and irreducibility argument, while the Lean proof is a two-line lemma-application plus rewrite; the `have` line is not even used in the subsequent `rw`, suggesting it is either extraneous or relies on typeclass inference rather than mirroring the informal reasoning. Overall, the formal proof may prove the same theorem via library results, but it does not reflect the content or structure of the informal proof, so alignment is very low.""}"
252,00Q0,"lemma isStronglyTranscendental_mk_of_mem_minimalPrimes [IsReduced S]
    {x : S} (hx : IsStronglyTranscendental R x) (q : Ideal S) (hq : q ‚àà minimalPrimes S) :
    IsStronglyTranscendental R (Ideal.Quotient.mk q x) := by
  refine Ideal.Quotient.mk_surjective.forall.mpr fun u p e ‚Ü¶ ?_
  rw [‚Üê Ideal.Quotient.algebraMap_eq, aeval_algebraMap_apply, Ideal.Quotient.algebraMap_eq,
    ‚Üê map_mul, Ideal.Quotient.eq_zero_iff_mem] at e
  have := hq.1.1
  have : Ring.KrullDimLE 0 (Localization.AtPrime q) := .of_isLocalization _ hq _
  let : Field (Localization.AtPrime q) := Ring.KrullDimLE.isField_of_isReduced.toField
  obtain ‚ü®‚ü®m, hmq‚ü©, hm‚ü© := (IsLocalization.map_eq_zero_iff q.primeCompl (Localization.AtPrime q)
    (aeval x p * u)).mp (by rw [‚Üê Ideal.mem_bot, ‚Üê IsLocalRing.maximalIdeal_eq_bot,
      ‚Üê Localization.AtPrime.map_eq_maximalIdeal]; exact Ideal.mem_map_of_mem _ e)
  ext i
  simp only [coeff_mul_C, coeff_map, coeff_zero, ‚Üê Ideal.Quotient.mk_algebraMap, ‚Üê map_mul,
    Ideal.Quotient.eq_zero_iff_mem]
  have : algebraMap R S (p.coeff i) * u * m = 0 := by
    simpa [‚Üê mul_assoc] using congr(($(hx (u * m) p (by linear_combination hm))).coeff i)
  exact (Ideal.IsPrime.mem_or_mem_of_mul_eq_zero ‚Äπ_‚Ä∫ (by linear_combination this)).resolve_left hmq
",Formal Proof of Stacks Project Tag 00Q0,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Algebraic/StronglyTranscendental.lean#L123,Q27041,,10.123.8,lemma,3.0,"['00PI', '00AO', '0ELQ']","\n  Lemma 10.123.8. Suppose $R \\subset S$ is an inclusion of reduced rings and suppose that $x \\in S$ is strongly transcendental over $R$. Let $\\mathfrak q \\subset S$ be a minimal prime and let $\\mathfrak p = R \\cap \\mathfrak q$. Then the image of $x$ in $S/\\mathfrak q$ is strongly transcendental over the subring $R/\\mathfrak p$. \n\n    \n      Proof.\n      Suppose $u(a_0 + a_1x + \\ldots + a_ k x^ k) \\in \\mathfrak q$. By Lemma 10.25.1 the local ring $S_{\\mathfrak q}$ is a field, and hence $u(a_0 + a_1x + \\ldots + a_ k x^ k) $ is zero in $S_{\\mathfrak q}$. Thus $uu\'(a_0 + a_1x + \\ldots + a_ k x^ k) = 0$ for some $u\' \\in S$, $u\' \\not\\in \\mathfrak q$. Since $x$ is strongly transcendental over $R$ we get $uu\'a_ i = 0$ for all $i$. This in turn implies that $ua_ i \\in \\mathfrak q$. \n      $\\square$\n    \n",\n  Lemma 10.123.8. Suppose $R \\subset S$ is an inclusion of reduced rings and suppose that $x \\in S$ is strongly transcendental over $R$. Let $\\mathfrak q \\subset S$ be a minimal prime and let $\\mathfrak p = R \\cap \\mathfrak q$. Then the image of $x$ in $S/\\mathfrak q$ is strongly transcendental over the subring $R/\\mathfrak p$. \n\n    \n,"Proof.\n      Suppose $u(a_0 + a_1x + \\ldots + a_ k x^ k) \\in \\mathfrak q$. By Lemma 10.25.1 the local ring $S_{\\mathfrak q}$ is a field, and hence $u(a_0 + a_1x + \\ldots + a_ k x^ k) $ is zero in $S_{\\mathfrak q}$. Thus $uu\'(a_0 + a_1x + \\ldots + a_ k x^ k) = 0$ for some $u\' \\in S$, $u\' \\not\\in \\mathfrak q$. Since $x$ is strongly transcendental over $R$ we get $uu\'a_ i = 0$ for all $i$. This in turn implies that $ua_ i \\in \\mathfrak q$. \n      $\\square$\n    \n"," by
  refine Ideal.Quotient.mk_surjective.forall.mpr fun u p e ‚Ü¶ ?_
  rw [‚Üê Ideal.Quotient.algebraMap_eq, aeval_algebraMap_apply, Ideal.Quotient.algebraMap_eq,
    ‚Üê map_mul, Ideal.Quotient.eq_zero_iff_mem] at e
  have := hq.1.1
  have : Ring.KrullDimLE 0 (Localization.AtPrime q) := .of_isLocalization _ hq _
  let : Field (Localization.AtPrime q) := Ring.KrullDimLE.isField_of_isReduced.toField
  obtain ‚ü®‚ü®m, hmq‚ü©, hm‚ü© := (IsLocalization.map_eq_zero_iff q.primeCompl (Localization.AtPrime q)
    (aeval x p * u)).mp (by rw [‚Üê Ideal.mem_bot, ‚Üê IsLocalRing.maximalIdeal_eq_bot,
      ‚Üê Localization.AtPrime.map_eq_maximalIdeal]; exact Ideal.mem_map_of_mem _ e)
  ext i
  simp only [coeff_mul_C, coeff_map, coeff_zero, ‚Üê Ideal.Quotient.mk_algebraMap, ‚Üê map_mul,
    Ideal.Quotient.eq_zero_iff_mem]
  have : algebraMap R S (p.coeff i) * u * m = 0 := by
    simpa [‚Üê mul_assoc] using congr(($(hx (u * m) p (by linear_combination hm))).coeff i)
  exact (Ideal.IsPrime.mem_or_mem_of_mul_eq_zero ‚Äπ_‚Ä∫ (by linear_combination this)).resolve_left hmq
","lemma isStronglyTranscendental_mk_of_mem_minimalPrimes [IsReduced S]
    {x : S} (hx : IsStronglyTranscendental R x) (q : Ideal S) (hq : q ‚àà minimalPrimes S) :
    IsStronglyTranscendental R (Ideal.Quotient.mk q x) ","Proof.\n      Suppose $u(a_0 + a_1x + \\ldots + a_ k x^ k) \\in \\mathfrak q$. By Lemma 10.25.1 [[\n  Lemma 10.25.1. Let $\\mathfrak p$ be a minimal prime of a ring $R$. Every element of the maximal ideal of $R_{\\mathfrak p}$ is nilpotent. If $R$ is reduced then $R_{\\mathfrak p}$ is a field. \n\n    \n]] the local ring $S_{\\mathfrak q}$ is a field, and hence $u(a_0 + a_1x + \\ldots + a_ k x^ k) $ is zero in $S_{\\mathfrak q}$. Thus $uu\'(a_0 + a_1x + \\ldots + a_ k x^ k) = 0$ for some $u\' \\in S$, $u\' \\not\\in \\mathfrak q$. Since $x$ is strongly transcendental over $R$ we get $uu\'a_ i = 0$ for all $i$. This in turn implies that $ua_ i \\in \\mathfrak q$. \n      $\\square$\n    \n","Proof.\n      Suppose $u(a_0 + a_1x + \\ldots + a_ k x^ k) \\in \\mathfrak q$. By Lemma 10.25.1 [[\n  Lemma 10.25.1. Let $\\mathfrak p$ be a minimal prime of a ring $R$. Every element of the maximal ideal of $R_{\\mathfrak p}$ is nilpotent. If $R$ is reduced then $R_{\\mathfrak p}$ is a field. \n\n    \n]] the local ring $S_{\\mathfrak q}$ is a field, and hence $u(a_0 + a_1x + \\ldots + a_ k x^ k) $ is zero in $S_{\\mathfrak q}$. Thus $uu\'(a_0 + a_1x + \\ldots + a_ k x^ k) = 0$ for some $u\' \\in S$, $u\' \\not\\in \\mathfrak q$. Since $x$ is strongly transcendental over $R$ we get $uu\'a_ i = 0$ for all $i$. This in turn implies that $ua_ i \\in \\mathfrak q$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the informal argument: it assumes an element of the form (aeval x p) * u maps to 0 in the quotient/localization at a prime q, uses a Krull-dimension/minimal-prime hypothesis (via `Ring.KrullDimLE 0 (Localization.AtPrime q)` and `...toField`) to treat the localization `S_q` as a field, then applies the localization ‚Äúmap_eq_zero_iff‚Äù to obtain a multiplier `m ‚àâ q` such that `m * (aeval x p * u) = 0`. It then invokes the strong transcendence hypothesis `hx` to deduce coefficientwise vanishing, and finally uses primality to conclude each coefficient term lies in q (corresponding to `ua_i ‚àà q`). Structurally, it follows the same steps: (1) reduce to a statement in the localization/quotient, (2) use fieldness to get a denominator-clearing element outside q, (3) apply strong transcendence to get coefficientwise zero, (4) conclude membership in q. The main mismatch is that the informal proof is phrased directly in terms of membership in q and fieldness of the local ring, while the Lean proof works through `Ideal.Quotient.mk_surjective.forall` and `Ideal.Quotient.eq_zero_iff_mem` rewrites and uses `Ideal.IsPrime.mem_or_mem_of_mul_eq_zero` to resolve membership; these are formalization details but not extra mathematical content. Overall the correspondence is strong, with minor presentational/structural differences.""}"
256,030F,"theorem lift_cardinalMk_eq (hx : IsTranscendenceBasis R x) (hy : IsTranscendenceBasis R y) :
    lift.{u'} #Œπ = lift.{u} #Œπ' := by
  rw [‚Üê lift_inj.{_, w}, lift_lift, lift_lift, ‚Üê lift_lift.{w, u'}, hx.lift_cardinalMk_eq_trdeg,
    ‚Üê lift_lift.{w, u}, hy.lift_cardinalMk_eq_trdeg, lift_lift, lift_lift]
",Formal Proof of Stacks Project Tag 030F,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/AlgebraicIndependent/TranscendenceBasis.lean#L431-L434,Q27041,,9.26.3,lemma,3.0,"['030D', '09FA', '0ELQ']","\n  Lemma 9.26.3. Let $E/F$ be a field extension. A transcendence basis of $E$ over $F$ exists. Any two transcendence bases have the same cardinality. \n\n    \n      Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n",\n  Lemma 9.26.3. Let $E/F$ be a field extension. A transcendence basis of $E$ over $F$ exists. Any two transcendence bases have the same cardinality. \n\n    \n,"Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n"," by
  rw [‚Üê lift_inj.{_, w}, lift_lift, lift_lift, ‚Üê lift_lift.{w, u'}, hx.lift_cardinalMk_eq_trdeg,
    ‚Üê lift_lift.{w, u}, hy.lift_cardinalMk_eq_trdeg, lift_lift, lift_lift]
","theorem lift_cardinalMk_eq (hx : IsTranscendenceBasis R x) (hy : IsTranscendenceBasis R y) :
    lift.{u'} #Œπ = lift.{u} #Œπ' ","Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n","Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is a substantial argument about existence and cardinality of transcendence bases (Zorn‚Äôs lemma to extend an algebraically independent set to a transcendence basis, then a multi-case cardinality comparison between two bases using finite-support arguments and induction). The formal Lean proof, by contrast, is only a chain of `rw` rewrites involving `lift`, `lift_inj`, and equalities like `lift_cardinalMk_eq_trdeg` for two hypotheses `hx` and `hy`. Semantically, it appears to be proving an equality of lifted cardinals/trdeg values, not constructing bases or doing Zorn/induction. Structurally, there is no correspondence to the Zorn‚Äôs lemma maximality argument or the finite/infinite case split; it is purely rewriting. Thus the formal proof does not capture the content or structure of the informal proof, beyond perhaps relating to a final cardinal/trdeg equality in a very indirect way.""}"
257,030F,"    (hx : IsTranscendenceBasis R x) (hy : IsTranscendenceBasis R y) :
    #Œπ = #Œπ' := by
  rw [‚Üê lift_id #Œπ, lift_cardinalMk_eq hx hy, lift_id]
",Formal Proof of Stacks Project Tag 030F, theorem cardinalMk_eq {Œπ' : Type u} {y : Œπ' ‚Üí A,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/AlgebraicIndependent/TranscendenceBasis.lean#L437-L439,Q27041,,9.26.3,lemma,3.0,"['030D', '09FA', '0ELQ']","\n  Lemma 9.26.3. Let $E/F$ be a field extension. A transcendence basis of $E$ over $F$ exists. Any two transcendence bases have the same cardinality. \n\n    \n      Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n",\n  Lemma 9.26.3. Let $E/F$ be a field extension. A transcendence basis of $E$ over $F$ exists. Any two transcendence bases have the same cardinality. \n\n    \n,"Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n"," by
  rw [‚Üê lift_id #Œπ, lift_cardinalMk_eq hx hy, lift_id]
","    (hx : IsTranscendenceBasis R x) (hy : IsTranscendenceBasis R y) :
    #Œπ = #Œπ' ","Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n","Proof.\n      Let $A$ be an algebraically independent subset of $E$. Let $G$ be a subset of $E$ containing $A$ that generates $E/F$. We claim we can find a transcendence basis $B$ such that $A \\subset B \\subset G$. To prove this, consider the collection $\\mathcal{B}$ of algebraically independent subsets whose members are subsets of $G$ that contain $A$. Define a partial ordering on $\\mathcal{B}$ using inclusion. Then $\\mathcal{B}$ contains at least one element $A$. The union of the elements of a totally ordered subset $T$ of $\\mathcal{B}$ is an algebraically independent subset of $E$ over $F$ since any algebraic dependence relation would have occurred in one of the elements of $T$ (since polynomials only involve finitely many variables). The union also contains $A$ and is contained in $G$. By Zorn\'s lemma, there is a maximal element $B \\in \\mathcal{B}$. Now we claim $E$ is algebraic over $F(B)$. This is because if it wasn\'t then there would be an element $f \\in G$ transcendental over $F(B)$ since $F(G) = E$. Then $B \\cup \\{ f\\} $ would be algebraically independent contradicting the maximality of $B$. Thus $B$ is our transcendence basis. \n    \n      Let $B$ and $B\'$ be two transcendence bases. Without loss of generality, we can assume that $|B\'| \\leq |B|$. Now we divide the proof into two cases: the first case is that $B$ is an infinite set. Then for each $\\alpha \\in B\'$, there is a finite set $B_{\\alpha } \\subset B$ such that $\\alpha $ is algebraic over $F(B_{\\alpha })$ since any algebraic dependence relation only uses finitely many indeterminates. Then we define $B^* = \\bigcup _{\\alpha \\in B\'} B_{\\alpha }$. By construction, $B^* \\subset B$, but we claim that in fact the two sets are equal. To see this, suppose that they are not equal, say there is an element $\\beta \\in B \\setminus B^*$. We know $\\beta $ is algebraic over $F(B\')$ which is algebraic over $F(B^*)$. Therefore $\\beta $ is algebraic over $F(B^*)$, a contradiction. So $|B| \\leq |\\bigcup _{\\alpha \\in B\'} B_{\\alpha }|$. Now if $B\'$ is finite, then so is $B$ so we can assume $B\'$ is infinite; this means \n    \n      \n  \\[  |B| \\leq |\\bigcup \\nolimits _{\\alpha \\in B\'} B_{\\alpha }| = |B\'|  \\]\n\n    \n       because each $B_\\alpha $ is finite and $B\'$ is infinite. Therefore in the infinite case, $|B| = |B\'|$. \n    \n      Now we need to look at the case where $B$ is finite. In this case, $B\'$ is also finite, so suppose $B = \\{ \\alpha _1, \\ldots , \\alpha _ n\\} $ and $B\' = \\{ \\beta _1, \\ldots , \\beta _ m\\} $ with $m \\leq n$. We perform induction on $m$: if $m = 0$ then $E/F$ is algebraic so $B = \\emptyset $ so $n = 0$. If $m > 0$, there is an irreducible polynomial $f \\in F[x, y_1, \\ldots , y_ n]$ such that $f(\\beta _1, \\alpha _1, \\ldots , \\alpha _ n) = 0$ and such that $x$ occurs in $f$. Since $\\beta _1$ is not algebraic over $F$, $f$ must involve some $y_ i$ so without loss of generality, assume $f$ uses $y_1$. Let $B^* = \\{ \\beta _1, \\alpha _2, \\ldots , \\alpha _ n\\} $. We claim that $B^*$ is a basis for $E/F$. To prove this claim, we see that we have a tower of algebraic extensions \n    \n      \n  \\[  E/ F(B^*, \\alpha _1) / F(B^*)  \\]\n\n    \n       since $\\alpha _1$ is algebraic over $F(B^*)$. Now we claim that $B^*$ (counting multiplicity of elements) is algebraically independent over $F$ because if it weren\'t, then there would be an irreducible $g\\in F[x, y_2, \\ldots , y_ n]$ such that $g(\\beta _1, \\alpha _2, \\ldots , \\alpha _ n) = 0$ which must involve $x$ making $\\beta _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which would make $\\alpha _1$ algebraic over $F(\\alpha _2, \\ldots , \\alpha _ n)$ which is impossible. So this means that $\\{ \\alpha _2, \\ldots , \\alpha _ n\\} $ and $\\{ \\beta _2, \\ldots , \\beta _ m\\} $ are bases for $E$ over $F(\\beta _1)$ which means by induction, $m = n$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem cardinalMk_eq {Œπ' : Type u} {y : Œπ' ‚Üí A","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the Lean proof is a short rewrite chain using lemmas about `lift` and `cardinalMk` (e.g. `lift_cardinalMk_eq hx hy`), so it is proving an equality of lifted cardinalities under hypotheses `hx hy`. The informal proof, however, is a full field-theoretic argument about transcendence bases: existence of a basis extending an algebraically independent set via Zorn‚Äôs lemma, and then the exchange/uniqueness-of-cardinality argument splitting into infinite/finite cases. There is no correspondence between these mathematical contents.\n\nStructurally, the Lean proof has no Zorn‚Äôs lemma step, no maximality argument, no algebraic independence reasoning, and no case split/induction; it is purely a `rw`-based simplification. Even if the final informal goal is a cardinality equality, the Lean script does not reflect the proof strategy described (it just rewrites using a prepackaged lemma). Thus the formal proof is not aligned with the augmented proof in either meaning or structure.""}"
258,030H,"    [FaithfulSMul S A] : lift.{w} (trdeg R S) + lift.{v} (trdeg S A) = lift.{v} (trdeg R A) := by
  have ‚ü®s, hs‚ü© := exists_isTranscendenceBasis R S
  have ‚ü®t, ht‚ü© := exists_isTranscendenceBasis S A
  have := (FaithfulSMul.algebraMap_injective S A).noZeroDivisors _ (map_zero _) (map_mul _)
  have := (FaithfulSMul.algebraMap_injective R S).nontrivial
  rw [‚Üê hs.cardinalMk_eq_trdeg, ‚Üê ht.cardinalMk_eq_trdeg, ‚Üê lift_umax.{w}, add_comm,
    ‚Üê (hs.sumElim_comp ht).lift_cardinalMk_eq_trdeg, mk_sum, lift_add, lift_lift, lift_lift]
",Formal Proof of Stacks Project Tag 030H, theorem lift_trdeg_add_eq [Nontrivial R] [NoZeroDivisors A] [FaithfulSMul R S,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/AlgebraicIndependent/TranscendenceBasis.lean#L540-L546,Q27041,,9.26.5,lemma,3.0,"['030D', '09FA', '0ELQ']",\n  Lemma 9.26.5. Let $L/K/k$ be field extensions. Then \n  \n  \\[  \\text{trdeg}_ k(L) = \\text{trdeg}_ K(L) + \\text{trdeg}_ k(K).  \\]\n\n\n    \n      Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n,\n  Lemma 9.26.5. Let $L/K/k$ be field extensions. Then \n  \n  \\[  \\text{trdeg}_ k(L) = \\text{trdeg}_ K(L) + \\text{trdeg}_ k(K).  \\]\n\n\n    \n,Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n," by
  have ‚ü®s, hs‚ü© := exists_isTranscendenceBasis R S
  have ‚ü®t, ht‚ü© := exists_isTranscendenceBasis S A
  have := (FaithfulSMul.algebraMap_injective S A).noZeroDivisors _ (map_zero _) (map_mul _)
  have := (FaithfulSMul.algebraMap_injective R S).nontrivial
  rw [‚Üê hs.cardinalMk_eq_trdeg, ‚Üê ht.cardinalMk_eq_trdeg, ‚Üê lift_umax.{w}, add_comm,
    ‚Üê (hs.sumElim_comp ht).lift_cardinalMk_eq_trdeg, mk_sum, lift_add, lift_lift, lift_lift]
",    [FaithfulSMul S A] : lift.{w} (trdeg R S) + lift.{v} (trdeg S A) = lift.{v} (trdeg R A) ,Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n,"Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem lift_trdeg_add_eq [Nontrivial R] [NoZeroDivisors A] [FaithfulSMul R S","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the informal proof argues that if A is a transcendence basis of S over R and B is a transcendence basis of A over S, then their union is a transcendence basis of A over R, yielding an additivity statement for transcendence degree. The Lean proof follows the same core idea: it obtains transcendence bases `s` for `S/R` and `t` for `A/S` via `exists_isTranscendenceBasis`, then uses `hs.sumElim_comp ht` (a construction corresponding to combining bases, i.e. union/sum) to relate the transcendence degree of `A/R` to those of `S/R` and `A/S`, and finishes by rewriting cardinalities (`cardinalMk_eq_trdeg`, `mk_sum`, `lift_add`, commutativity of addition). Structurally, both proofs proceed by choosing two bases and combining them; Lean‚Äôs proof is more algebraic/cardinal-arithmetic heavy due to `lift` and `mk_sum` bookkeeping, but this matches the intended theorem `lift_trdeg_add_eq`. The extra Lean lines establishing `Nontrivial` and `NoZeroDivisors` via `FaithfulSMul.algebraMap_injective` are not mentioned in the informal proof, but they are standard typeclass prerequisites rather than a different argument. Overall the alignment is strong, with minor mismatch only in the explicit handling of technical hypotheses and cardinal lifts.""}"
259,030H,"    [Algebra R A] [Algebra S A] [FaithfulSMul R S] [FaithfulSMul S A] [IsScalarTower R S A] :
    trdeg R S + trdeg S A = trdeg R A := by
  rw [‚Üê (trdeg R S).lift_id, ‚Üê (trdeg S A).lift_id, ‚Üê (trdeg R A).lift_id]
  exact lift_trdeg_add_eq R S A
",Formal Proof of Stacks Project Tag 030H, theorem trdeg_add_eq [Nontrivial R] {A : Type v} [CommRing A] [NoZeroDivisors A,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/AlgebraicIndependent/TranscendenceBasis.lean#L549-L552,Q27041,,9.26.5,lemma,3.0,"['030D', '09FA', '0ELQ']",\n  Lemma 9.26.5. Let $L/K/k$ be field extensions. Then \n  \n  \\[  \\text{trdeg}_ k(L) = \\text{trdeg}_ K(L) + \\text{trdeg}_ k(K).  \\]\n\n\n    \n      Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n,\n  Lemma 9.26.5. Let $L/K/k$ be field extensions. Then \n  \n  \\[  \\text{trdeg}_ k(L) = \\text{trdeg}_ K(L) + \\text{trdeg}_ k(K).  \\]\n\n\n    \n,Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n," by
  rw [‚Üê (trdeg R S).lift_id, ‚Üê (trdeg S A).lift_id, ‚Üê (trdeg R A).lift_id]
  exact lift_trdeg_add_eq R S A
","    [Algebra R A] [Algebra S A] [FaithfulSMul R S] [FaithfulSMul S A] [IsScalarTower R S A] :
    trdeg R S + trdeg S A = trdeg R A ",Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n,"Proof.\n      Choose a transcendence basis $A \\subset K$ of $K$ over $k$. Choose a transcendence basis $B \\subset L$ of $L$ over $K$. Then it is straightforward to see that $A \\cup B$ is a transcendence basis of $L$ over $k$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem trdeg_add_eq [Nontrivial R] {A : Type v} [CommRing A] [NoZeroDivisors A","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish an additivity formula for transcendence degree in a tower (trdeg R A = trdeg R S + trdeg S A, up to the appropriate coercions/lifts). The informal proof argues by choosing transcendence bases in the intermediate extensions and showing their union is a transcendence basis of the top extension, which is the standard mathematical justification for additivity.\n\nStructurally, the Lean proof does not explicitly construct bases or unions; instead it reduces the goal by rewriting with `lift_id` (handling universe/coe/lift issues for `trdeg`) and then applies a pre-proved lemma `lift_trdeg_add_eq R S A` that encapsulates the additivity result. This matches the informal argument at a high level (both rely on the same underlying theorem), but the formal proof is more of a wrapper around an existing lemma rather than mirroring the basis-selection steps.\n\nCompleteness/precision: the Lean proof is concise and contains only technical rewrites plus the final lemma application; it omits the explicit basis reasoning present informally but is not adding unrelated content. The main mismatch is the lack of explicit correspondence to the union-of-bases construction, hence not a perfect structural match.""}"
261,00J7,"lemma setOf_isMaximal_finite : {I : Ideal R | I.IsMaximal}.Finite := by
  have ‚ü®s, H‚ü© := Finset.exists_inf_le (Subtype.val (p := fun I : Ideal R ‚Ü¶ I.IsMaximal))
  refine Set.finite_def.2 ‚ü®s, fun p ‚Ü¶ ?_‚ü©
  have ‚ü®q, hq1, hq2‚ü© := p.2.isPrime.inf_le'.mp (H p)
  rwa [‚Üê Subtype.ext <| q.2.eq_of_le p.2.ne_top hq2]
",Formal Proof of Stacks Project Tag 00J7,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Artinian/Module.lean#L556-L560,Q27041,,10.53.3,lemma,3.0,"['00J4', '00AO', '0ELQ']","\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n      Proof.\n      Suppose that $\\mathfrak m_ i$, $i = 1, 2, 3, \\ldots $ are pairwise distinct maximal ideals. Then $\\mathfrak m_1 \\supset \\mathfrak m_1\\cap \\mathfrak m_2 \\supset \\mathfrak m_1 \\cap \\mathfrak m_2 \\cap \\mathfrak m_3 \\supset \\ldots $ is an infinite descending sequence (because by the Chinese remainder theorem all the maps $R \\to \\oplus _{i = 1}^ n R/\\mathfrak m_ i$ are surjective). \n      $\\square$\n    \n",\n  Lemma 10.53.3. If $R$ is Artinian then $R$ has only finitely many maximal ideals. \n\n    \n,"Proof.\n      Suppose that $\\mathfrak m_ i$, $i = 1, 2, 3, \\ldots $ are pairwise distinct maximal ideals. Then $\\mathfrak m_1 \\supset \\mathfrak m_1\\cap \\mathfrak m_2 \\supset \\mathfrak m_1 \\cap \\mathfrak m_2 \\cap \\mathfrak m_3 \\supset \\ldots $ is an infinite descending sequence (because by the Chinese remainder theorem all the maps $R \\to \\oplus _{i = 1}^ n R/\\mathfrak m_ i$ are surjective). \n      $\\square$\n    \n"," by
  have ‚ü®s, H‚ü© := Finset.exists_inf_le (Subtype.val (p := fun I : Ideal R ‚Ü¶ I.IsMaximal))
  refine Set.finite_def.2 ‚ü®s, fun p ‚Ü¶ ?_‚ü©
  have ‚ü®q, hq1, hq2‚ü© := p.2.isPrime.inf_le'.mp (H p)
  rwa [‚Üê Subtype.ext <| q.2.eq_of_le p.2.ne_top hq2]
",lemma setOf_isMaximal_finite : {I : Ideal R | I.IsMaximal}.Finite ,"Proof.\n      Suppose that $\\mathfrak m_ i$, $i = 1, 2, 3, \\ldots $ are pairwise distinct maximal ideals. Then $\\mathfrak m_1 \\supset \\mathfrak m_1\\cap \\mathfrak m_2 \\supset \\mathfrak m_1 \\cap \\mathfrak m_2 \\cap \\mathfrak m_3 \\supset \\ldots $ is an infinite descending sequence (because by the Chinese remainder theorem all the maps $R \\to \\oplus _{i = 1}^ n R/\\mathfrak m_ i$ are surjective). \n      $\\square$\n    \n","Proof.\n      Suppose that $\\mathfrak m_ i$, $i = 1, 2, 3, \\ldots $ are pairwise distinct maximal ideals. Then $\\mathfrak m_1 \\supset \\mathfrak m_1\\cap \\mathfrak m_2 \\supset \\mathfrak m_1 \\cap \\mathfrak m_2 \\cap \\mathfrak m_3 \\supset \\ldots $ is an infinite descending sequence (because by the Chinese remainder theorem all the maps $R \\to \\oplus _{i = 1}^ n R/\\mathfrak m_ i$ are surjective). \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof argues by contradiction: assuming infinitely many pairwise distinct maximal ideals, it constructs an infinite strictly descending chain of finite intersections using surjectivity from the Chinese remainder theorem. The formal proof instead uses a finiteness characterization (`Set.finite_def.2`) and a finset lemma `Finset.exists_inf_le` to produce a finite set `s` and then, for an arbitrary maximal ideal `p`, uses primality/maximality facts about `inf_le'` to relate `p` to some `q` and conclude equality via `Subtype.ext`. There is no construction of an infinite descending chain, no use of CRT/surjectivity, and the overall strategy is completely different. Structurally, the informal proof is a chain argument, while the Lean proof is a compactness/finite-subcover style argument with infimum in a finset. Thus they do not correspond in method or key lemmas.""}"
262,00J8,"theorem isNilpotent_jacobson_bot {R} [Ring R] [IsArtinianRing R] :
    IsNilpotent (Ideal.jacobson (‚ä• : Ideal R)) :=
  Ideal.jacobson_bot (R := R) ‚ñ∏ IsSemiprimaryRing.isNilpotent
",Formal Proof of Stacks Project Tag 00J8,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Artinian/Ring.lean#L54-L56,Q27041,,10.53.4,lemma,3.0,"['00J4', '00AO', '0ELQ']","\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n      Proof.\n      Let $I \\subset R$ be the Jacobson radical. Note that $I \\supset I^2 \\supset I^3 \\supset \\ldots $ is a descending sequence. Thus $I^ n = I^{n + 1}$ for some $n$. Set $J = \\{  x\\in R \\mid xI^ n = 0\\} $. We have to show $J = R$. If not, choose an ideal $J\' \\not= J$, $J \\subset J\'$ minimal (possible by the Artinian property). Then $J\' = J + Rx$ for some $x \\in R$. By minimality we have $J + IJ\' = J$ or $J + IJ\' = J\'$. In the latter case we get $J\' = J + Ix$ and by Lemma 10.20.1 we obtain $J = J\'$ a contradiction. Hence $xI^{n + 1} \\subset xI \\cdot I^ n \\subset J \\cdot I^ n = 0$. Since $I^{n + 1} = I^ n$ we conclude $x \\in J$. Contradiction. \n      $\\square$\n    \n",\n  Lemma 10.53.4. Let $R$ be Artinian. The Jacobson radical of $R$ is a nilpotent ideal. \n\n    \n,"Proof.\n      Let $I \\subset R$ be the Jacobson radical. Note that $I \\supset I^2 \\supset I^3 \\supset \\ldots $ is a descending sequence. Thus $I^ n = I^{n + 1}$ for some $n$. Set $J = \\{  x\\in R \\mid xI^ n = 0\\} $. We have to show $J = R$. If not, choose an ideal $J\' \\not= J$, $J \\subset J\'$ minimal (possible by the Artinian property). Then $J\' = J + Rx$ for some $x \\in R$. By minimality we have $J + IJ\' = J$ or $J + IJ\' = J\'$. In the latter case we get $J\' = J + Ix$ and by Lemma 10.20.1 we obtain $J = J\'$ a contradiction. Hence $xI^{n + 1} \\subset xI \\cdot I^ n \\subset J \\cdot I^ n = 0$. Since $I^{n + 1} = I^ n$ we conclude $x \\in J$. Contradiction. \n      $\\square$\n    \n","
  Ideal.jacobson_bot (R := R) ‚ñ∏ IsSemiprimaryRing.isNilpotent
","theorem isNilpotent_jacobson_bot {R} [Ring R] [IsArtinianRing R] :
    IsNilpotent (Ideal.jacobson (‚ä• : Ideal R)) ","Proof.\n      Let $I \\subset R$ be the Jacobson radical. Note that $I \\supset I^2 \\supset I^3 \\supset \\ldots $ is a descending sequence. Thus $I^ n = I^{n + 1}$ for some $n$. Set $J = \\{  x\\in R \\mid xI^ n = 0\\} $. We have to show $J = R$. If not, choose an ideal $J\' \\not= J$, $J \\subset J\'$ minimal (possible by the Artinian property). Then $J\' = J + Rx$ for some $x \\in R$. By minimality we have $J + IJ\' = J$ or $J + IJ\' = J\'$. In the latter case we get $J\' = J + Ix$ and by Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]] we obtain $J = J\'$ a contradiction. Hence $xI^{n + 1} \\subset xI \\cdot I^ n \\subset J \\cdot I^ n = 0$. Since $I^{n + 1} = I^ n$ we conclude $x \\in J$. Contradiction. \n      $\\square$\n    \n","Proof.\n      Let $I \\subset R$ be the Jacobson radical. Note that $I \\supset I^2 \\supset I^3 \\supset \\ldots $ is a descending sequence. Thus $I^ n = I^{n + 1}$ for some $n$. Set $J = \\{  x\\in R \\mid xI^ n = 0\\} $. We have to show $J = R$. If not, choose an ideal $J\' \\not= J$, $J \\subset J\'$ minimal (possible by the Artinian property). Then $J\' = J + Rx$ for some $x \\in R$. By minimality we have $J + IJ\' = J$ or $J + IJ\' = J\'$. In the latter case we get $J\' = J + Ix$ and by Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]] we obtain $J = J\'$ a contradiction. Hence $xI^{n + 1} \\subset xI \\cdot I^ n \\subset J \\cdot I^ n = 0$. Since $I^{n + 1} = I^ n$ we conclude $x \\in J$. Contradiction. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, both proofs aim at the same kind of conclusion: nilpotency of the Jacobson radical in a semiprimary/Artinian-type setting. However, the informal proof gives a detailed argument using stabilization of powers of the Jacobson radical in an Artinian ring, construction of an annihilator ideal J, a minimal counterexample ideal J‚Ä≤, and an application of Nakayama‚Äôs lemma to derive a contradiction. The formal proof, by contrast, is a one-line invocation: it rewrites using `Ideal.jacobson_bot (R := R)` and then applies `IsSemiprimaryRing.isNilpotent`. This does not mirror the informal structure (no chain stabilization, no J/J‚Ä≤ construction, no Nakayama step), and it relies on a prepackaged lemma rather than reproducing the argument. So while the end result likely matches, the structural correspondence and completeness relative to the informal proof are poor.""}"
264,00UJ,"lemma Algebra.exists_etale_isIdempotentElem_forall_liesOver_eq [Module.Finite R S]
    (p : Ideal R) [p.IsPrime] (q : Ideal S) [q.IsPrime] [q.LiesOver p] :
    ‚àÉ (R' : Type u) (_ : CommRing R') (_ : Algebra R R') (_ : Algebra.Etale R R') (P : Ideal R')
      (_ : P.IsPrime) (_ : P.LiesOver p) (e : R' ‚äó[R] S) (_ : IsIdempotentElem e)
      (P' : Ideal (R' ‚äó[R] S)) (_ : P'.IsPrime) (_ : P'.LiesOver P), P'.comap
        Algebra.TensorProduct.includeRight.toRingHom = q ‚àß e ‚àâ P' ‚àß
      Function.Bijective (Ideal.ResidueField.map‚Çê p P (Algebra.ofId _ _) (P.over_def p)) ‚àß
      ‚àÄ P'' : Ideal (R' ‚äó[R] S), P''.IsPrime ‚Üí P''.LiesOver P ‚Üí e ‚àâ P'' ‚Üí P'' = P' := by
  classical
  obtain ‚ü®s, hsq, hs‚ü© := Ideal.exists_not_mem_forall_mem_of_ne_of_liesOver p q
  obtain ‚ü®m, f, b, hfm, hbm, hab, hfab, hf‚ü© : ‚àÉ (m : ‚Ñï) (f : R[X])
      (b : p.ResidueField[X]), f.Monic ‚àß b.Monic ‚àß IsCoprime (X ^ (m + 1)) b ‚àß
        f.map (algebraMap _ _) = X ^ (m + 1) * b ‚àß aeval s f = 0 := by
    have hs := Algebra.IsIntegral.isIntegral (R := R) s
    let f := X * minpoly R s
    obtain ‚ü®q, hq, hq'‚ü© := exists_eq_pow_rootMultiplicity_mul_and_not_dvd
      ((minpoly R s).map (algebraMap R p.ResidueField)) ((minpoly.monic hs).map _).ne_zero 0
    have hqm : q.Monic := by
      simpa [((minpoly.monic hs).map _).leadingCoeff] using congr(leadingCoeff $hq).symm
    set m' := rootMultiplicity 0 ((minpoly R s).map (algebraMap R p.ResidueField))
    refine ‚ü®m', f, q, monic_X.mul (minpoly.monic hs), hqm, ?_,
      by simp [f, hq, pow_succ', mul_assoc], by simp [f]‚ü©
    simpa [IsCoprime.pow_left_iff,
      (prime_X (R := p.ResidueField)).irreducible.coprime_iff_not_dvd] using hq'
  obtain ‚ü®R', _, _, _, P, _, _, a', b', hP, ha'm, hb'm, hfab', ‚ü®c, d, hcd‚ü©, ha', hb'‚ü© :=
    exists_etale_bijective_residueFieldMap_and_map_eq_mul_and_isCoprime p f
      (X ^ (m + 1)) b hfm (monic_X.pow _) hbm hfab hab
  let s' : R' ‚äó[R] S := 1 ‚äó‚Çú s
  have hs'f : aeval s' f = 0 :=
    show aeval (Algebra.TensorProduct.includeRight s) f = 0 by rw [aeval_algHom_apply, hf, map_zero]
  let e := aeval s' (c * a')
  have he : IsIdempotentElem e := by
    dsimp only [e, IsIdempotentElem]
    nth_rw 2 [eq_sub_iff_add_eq.mpr hcd]
    rw [‚Üê map_mul, mul_sub, mul_one, mul_mul_mul_comm, ‚Üê hfab']
    simp only [map_mul, map_sub, aeval_map_algebraMap, hs'f, mul_zero, sub_zero]
  let P' := (Ideal.fiberIsoOfBijectiveResidueField hP).symm ‚ü®q, ‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫‚ü©
  have hP'q : P'.1.comap Algebra.TensorProduct.includeRight.toRingHom = q :=
    Ideal.comap_fiberIsoOfBijectiveResidueField_symm ..
  have hs'P' : s' ‚àâ P'.1 := mt (fun h ‚Ü¶ hP'q.le h) hsq
  have ha'P' : aeval s' a' ‚àâ P'.1 := by
    simpa using show IsScalarTower.toAlgHom R' _ P'.1.ResidueField (aeval s' a') ‚â† 0 by
      rw [‚Üê aeval_algHom_apply, ‚Üê aeval_map_algebraMap P.ResidueField, ‚Üê ha']; simpa
  have hb'P' : aeval s' b' ‚àà P'.1 := by
    rw [‚Üê Ideal.IsPrime.mul_mem_left_iff ha'P', ‚Üê map_mul, ‚Üê hfab']
    simp [hs'f]
  have heP' : e ‚àâ P'.1 := by
    intro H
    have := P'.1.mul_mem_left (aeval s' d) hb'P'
    rw [‚Üê map_mul, eq_sub_iff_add_eq'.mpr hcd, map_sub, Submodule.sub_mem_iff_left _ H,
      map_one] at this
    exact Ideal.one_notMem _ this
  refine ‚ü®_, inferInstance, inferInstance, inferInstance, P, ‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫,
    e, he, P', inferInstance, P'.2.2, hP'q, heP', hP, fun P'' _ _ H ‚Ü¶ ?_‚ü©
  apply Ideal.eq_of_comap_eq_comap_of_bijective_residueFieldMap hP
  rw [hP'q]
  contrapose! H
  have : s' ‚àà P'' := hs _ inferInstance H (by simp [Ideal.liesOver_iff, Ideal.under,
    Ideal.comap_comap, Ideal.over_def P p, Ideal.over_def P'' P, ‚Üê IsScalarTower.algebraMap_eq])
  rw [‚Üê Ideal.algebraMap_residueField_eq_zero, ‚Üê aeval_algebraMap_apply,
    Ideal.algebraMap_residueField_eq_zero.mpr this, ‚Üê eval_map_algebraMap, Polynomial.map_mul,
    mul_comm, ‚Üê (Ideal.ResidueField.map‚Çê P P'' (Algebra.ofId _ _) (P''.over_def P)).comp_algebraMap,
    ‚Üê Polynomial.map_map, ‚Üê ha']
  simp
",Formal Proof of Stacks Project Tag 00UJ,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Etale/QuasiFinite.lean#L115-L178,Q27041,,10.145.2,lemma,3.0,"['0G1B', '00AO', '0ELQ']","\n  Lemma 10.145.2. Let $R \\to S$ be a ring map. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p \\subset R$. Assume $R \\to S$ finite type and quasi-finite at $\\mathfrak q$. Then there exists \n  \n  \nan \xc3\xa9tale ring map $R \\to R\'$, \n\n\na prime $\\mathfrak p\' \\subset R\'$ lying over $\\mathfrak p$, \n\n\na product decomposition \n\n\n  \\[  R\' \\otimes _ R S = A \\times B  \\]\n\n\n\n   with the following properties \n  \n  \n$\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, \n\n\n$R\' \\to A$ is finite, \n\n\n$A$ has exactly one prime $\\mathfrak r$ lying over $\\mathfrak p\'$, \n\n\n$\\mathfrak r$ lies over $\\mathfrak q$, and \n\n\n$B$ does not have a prime lying over $\\mathfrak q$ and $\\mathfrak p\'$. \n\n\n\n\n    \n      Proof.\n      Let $S\' \\subset S$ be the integral closure of $R$ in $S$. Let $\\mathfrak q\' = S\' \\cap \\mathfrak q$. By Zariski\'s Main Theorem 10.123.12 there exists a $g \\in S\'$, $g \\not\\in \\mathfrak q\'$ such that $S\'_ g \\cong S_ g$. Consider the fibre rings $F = S \\otimes _ R \\kappa (\\mathfrak p)$ and $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$. Denote $\\overline{\\mathfrak q}\'$ the prime of $F\'$ corresponding to $\\mathfrak q\'$. Since $F\'$ is integral over $\\kappa (\\mathfrak p)$ we see that $\\overline{\\mathfrak q}\'$ is a closed point of $\\mathop{\\mathrm{Spec}}(F\')$, see Lemma 10.36.19. Note that $\\mathfrak q$ defines an isolated closed point $\\overline{\\mathfrak q}$ of $\\mathop{\\mathrm{Spec}}(F)$ (see Definition 10.122.3). Since $S\'_ g \\cong S_ g$ we have $F\'_ g \\cong F_ g$, so $\\overline{\\mathfrak q}$ and $\\overline{\\mathfrak q}\'$ have isomorphic open neighbourhoods in $\\mathop{\\mathrm{Spec}}(F)$ and $\\mathop{\\mathrm{Spec}}(F\')$. We conclude the set $\\{ \\overline{\\mathfrak q}\'\\}  \\subset \\mathop{\\mathrm{Spec}}(F\')$ is open. Combined with $\\mathfrak q\'$ being closed (shown above) we conclude that $\\overline{\\mathfrak q}\'$ defines an isolated closed point of $\\mathop{\\mathrm{Spec}}(F\')$ as well. \n    \n      An additional small remark is that under the map $\\mathop{\\mathrm{Spec}}(F) \\to \\mathop{\\mathrm{Spec}}(F\')$ the point $\\overline{\\mathfrak q}$ is the only point mapping to $\\overline{\\mathfrak q}\'$. This follows from the discussion above. \n    \n      By Lemma 10.24.3 we may write $F\' = F\'_1 \\times F\'_2$ with $\\mathop{\\mathrm{Spec}}(F\'_1) = \\{ \\overline{\\mathfrak q}\'\\} $. Since $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$, there exists an $s\' \\in S\'$ which maps to the element $(r, 0) \\in F\'_1 \\times F\'_2 = F\'$ for some $r \\in R$, $r \\not\\in \\mathfrak p$. In fact, what we will use about $s\'$ is that it is an element of $S\'$, not contained in $\\mathfrak q\'$, and contained in any other prime lying over $\\mathfrak p$. \n    \n      Let $f(x) \\in R[x]$ be a monic polynomial such that $f(s\') = 0$. Denote $\\overline{f} \\in \\kappa (\\mathfrak p)[x]$ the image. We can factor it as $\\overline{f} = x^ e \\overline{h}$ where $\\overline{h}(0) \\not= 0$. After replacing $f$ by $x f$ if necessary, we may assume $e \\geq 1$. By Lemma 10.143.13 we can find an \xc3\xa9tale ring extension $R \\to R\'$, a prime $\\mathfrak p\'$ lying over $\\mathfrak p$, and a factorization $f = h i$ in $R\'[x]$ such that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, $\\overline{h} = h \\bmod \\mathfrak p\'$, $x^ e = i \\bmod \\mathfrak p\'$, and we can write $a h + b i = 1$ in $R\'[x]$ (for suitable $a, b$). \n    \n      Consider the elements $h(s\'), i(s\') \\in R\' \\otimes _ R S\'$. By construction we have $h(s\')i(s\') = f(s\') = 0$. On the other hand they generate the unit ideal since $a(s\')h(s\') + b(s\')i(s\') = 1$. Thus we see that $R\' \\otimes _ R S\'$ is the product of the localizations at these elements: \n    \n      \n  \\[  R\' \\otimes _ R S\' = (R\' \\otimes _ R S\')_{i(s\')} \\times (R\' \\otimes _ R S\')_{h(s\')} = S\'_1 \\times S\'_2  \\]\n\n    \n       Moreover this product decomposition is compatible with the product decomposition we found for the fibre ring $F\'$; this comes from our choices of $s\', i, h$ which guarantee that $\\overline{\\mathfrak q}\'$ is the only prime of $F\'$ which does not contain the image of $i(s\')$ in $F\'$. Here we use that the fibre ring of $R\'\\otimes _ R S\'$ over $R\'$ at $\\mathfrak p\'$ is the same as $F\'$ due to the fact that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$. It follows that $S\'_1$ has exactly one prime, say $\\mathfrak r\'$, lying over $\\mathfrak p\'$ and that this prime lies over $\\mathfrak q\'$. Hence the element $g \\in S\'$ maps to an element of $S\'_1$ not contained in $\\mathfrak r\'$. \n    \n      The base change $R\'\\otimes _ R S$ inherits a similar product decomposition \n    \n      \n  \\[  R\' \\otimes _ R S = (R\' \\otimes _ R S)_{i(s\')} \\times (R\' \\otimes _ R S)_{h(s\')} = S_1 \\times S_2  \\]\n\n    \n       It follows from the above that $S_1$ has exactly one prime, say $\\mathfrak r$, lying over $\\mathfrak p\'$ (consider the fibre ring as above), and that this prime lies over $\\mathfrak q$. \n    \n      Now we may apply Lemma 10.145.1 to the ring maps $R\' \\to S\'_1 \\to S_1$, the prime $\\mathfrak p\'$ and the element $g$ to see that after replacing $R\'$ by a principal localization we can assume that $S_1$ is finite over $R\'$ as desired. \n      $\\square$\n    \n","\n  Lemma 10.145.2. Let $R \\to S$ be a ring map. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p \\subset R$. Assume $R \\to S$ finite type and quasi-finite at $\\mathfrak q$. Then there exists \n  \n  \nan \xc3\xa9tale ring map $R \\to R\'$, \n\n\na prime $\\mathfrak p\' \\subset R\'$ lying over $\\mathfrak p$, \n\n\na product decomposition \n\n\n  \\[  R\' \\otimes _ R S = A \\times B  \\]\n\n\n\n   with the following properties \n  \n  \n$\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, \n\n\n$R\' \\to A$ is finite, \n\n\n$A$ has exactly one prime $\\mathfrak r$ lying over $\\mathfrak p\'$, \n\n\n$\\mathfrak r$ lies over $\\mathfrak q$, and \n\n\n$B$ does not have a prime lying over $\\mathfrak q$ and $\\mathfrak p\'$. \n\n\n\n\n    \n","Proof.\n      Let $S\' \\subset S$ be the integral closure of $R$ in $S$. Let $\\mathfrak q\' = S\' \\cap \\mathfrak q$. By Zariski\'s Main Theorem 10.123.12 there exists a $g \\in S\'$, $g \\not\\in \\mathfrak q\'$ such that $S\'_ g \\cong S_ g$. Consider the fibre rings $F = S \\otimes _ R \\kappa (\\mathfrak p)$ and $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$. Denote $\\overline{\\mathfrak q}\'$ the prime of $F\'$ corresponding to $\\mathfrak q\'$. Since $F\'$ is integral over $\\kappa (\\mathfrak p)$ we see that $\\overline{\\mathfrak q}\'$ is a closed point of $\\mathop{\\mathrm{Spec}}(F\')$, see Lemma 10.36.19. Note that $\\mathfrak q$ defines an isolated closed point $\\overline{\\mathfrak q}$ of $\\mathop{\\mathrm{Spec}}(F)$ (see Definition 10.122.3). Since $S\'_ g \\cong S_ g$ we have $F\'_ g \\cong F_ g$, so $\\overline{\\mathfrak q}$ and $\\overline{\\mathfrak q}\'$ have isomorphic open neighbourhoods in $\\mathop{\\mathrm{Spec}}(F)$ and $\\mathop{\\mathrm{Spec}}(F\')$. We conclude the set $\\{ \\overline{\\mathfrak q}\'\\}  \\subset \\mathop{\\mathrm{Spec}}(F\')$ is open. Combined with $\\mathfrak q\'$ being closed (shown above) we conclude that $\\overline{\\mathfrak q}\'$ defines an isolated closed point of $\\mathop{\\mathrm{Spec}}(F\')$ as well. \n    \n      An additional small remark is that under the map $\\mathop{\\mathrm{Spec}}(F) \\to \\mathop{\\mathrm{Spec}}(F\')$ the point $\\overline{\\mathfrak q}$ is the only point mapping to $\\overline{\\mathfrak q}\'$. This follows from the discussion above. \n    \n      By Lemma 10.24.3 we may write $F\' = F\'_1 \\times F\'_2$ with $\\mathop{\\mathrm{Spec}}(F\'_1) = \\{ \\overline{\\mathfrak q}\'\\} $. Since $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$, there exists an $s\' \\in S\'$ which maps to the element $(r, 0) \\in F\'_1 \\times F\'_2 = F\'$ for some $r \\in R$, $r \\not\\in \\mathfrak p$. In fact, what we will use about $s\'$ is that it is an element of $S\'$, not contained in $\\mathfrak q\'$, and contained in any other prime lying over $\\mathfrak p$. \n    \n      Let $f(x) \\in R[x]$ be a monic polynomial such that $f(s\') = 0$. Denote $\\overline{f} \\in \\kappa (\\mathfrak p)[x]$ the image. We can factor it as $\\overline{f} = x^ e \\overline{h}$ where $\\overline{h}(0) \\not= 0$. After replacing $f$ by $x f$ if necessary, we may assume $e \\geq 1$. By Lemma 10.143.13 we can find an \xc3\xa9tale ring extension $R \\to R\'$, a prime $\\mathfrak p\'$ lying over $\\mathfrak p$, and a factorization $f = h i$ in $R\'[x]$ such that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, $\\overline{h} = h \\bmod \\mathfrak p\'$, $x^ e = i \\bmod \\mathfrak p\'$, and we can write $a h + b i = 1$ in $R\'[x]$ (for suitable $a, b$). \n    \n      Consider the elements $h(s\'), i(s\') \\in R\' \\otimes _ R S\'$. By construction we have $h(s\')i(s\') = f(s\') = 0$. On the other hand they generate the unit ideal since $a(s\')h(s\') + b(s\')i(s\') = 1$. Thus we see that $R\' \\otimes _ R S\'$ is the product of the localizations at these elements: \n    \n      \n  \\[  R\' \\otimes _ R S\' = (R\' \\otimes _ R S\')_{i(s\')} \\times (R\' \\otimes _ R S\')_{h(s\')} = S\'_1 \\times S\'_2  \\]\n\n    \n       Moreover this product decomposition is compatible with the product decomposition we found for the fibre ring $F\'$; this comes from our choices of $s\', i, h$ which guarantee that $\\overline{\\mathfrak q}\'$ is the only prime of $F\'$ which does not contain the image of $i(s\')$ in $F\'$. Here we use that the fibre ring of $R\'\\otimes _ R S\'$ over $R\'$ at $\\mathfrak p\'$ is the same as $F\'$ due to the fact that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$. It follows that $S\'_1$ has exactly one prime, say $\\mathfrak r\'$, lying over $\\mathfrak p\'$ and that this prime lies over $\\mathfrak q\'$. Hence the element $g \\in S\'$ maps to an element of $S\'_1$ not contained in $\\mathfrak r\'$. \n    \n      The base change $R\'\\otimes _ R S$ inherits a similar product decomposition \n    \n      \n  \\[  R\' \\otimes _ R S = (R\' \\otimes _ R S)_{i(s\')} \\times (R\' \\otimes _ R S)_{h(s\')} = S_1 \\times S_2  \\]\n\n    \n       It follows from the above that $S_1$ has exactly one prime, say $\\mathfrak r$, lying over $\\mathfrak p\'$ (consider the fibre ring as above), and that this prime lies over $\\mathfrak q$. \n    \n      Now we may apply Lemma 10.145.1 to the ring maps $R\' \\to S\'_1 \\to S_1$, the prime $\\mathfrak p\'$ and the element $g$ to see that after replacing $R\'$ by a principal localization we can assume that $S_1$ is finite over $R\'$ as desired. \n      $\\square$\n    \n"," by
  classical
  obtain ‚ü®s, hsq, hs‚ü© := Ideal.exists_not_mem_forall_mem_of_ne_of_liesOver p q
  obtain ‚ü®m, f, b, hfm, hbm, hab, hfab, hf‚ü© : ‚àÉ (m : ‚Ñï) (f : R[X])
      (b : p.ResidueField[X]), f.Monic ‚àß b.Monic ‚àß IsCoprime (X ^ (m + 1)) b ‚àß
        f.map (algebraMap _ _) = X ^ (m + 1) * b ‚àß aeval s f = 0 := by
    have hs := Algebra.IsIntegral.isIntegral (R := R) s
    let f := X * minpoly R s
    obtain ‚ü®q, hq, hq'‚ü© := exists_eq_pow_rootMultiplicity_mul_and_not_dvd
      ((minpoly R s).map (algebraMap R p.ResidueField)) ((minpoly.monic hs).map _).ne_zero 0
    have hqm : q.Monic := by
      simpa [((minpoly.monic hs).map _).leadingCoeff] using congr(leadingCoeff $hq).symm
    set m' := rootMultiplicity 0 ((minpoly R s).map (algebraMap R p.ResidueField))
    refine ‚ü®m', f, q, monic_X.mul (minpoly.monic hs), hqm, ?_,
      by simp [f, hq, pow_succ', mul_assoc], by simp [f]‚ü©
    simpa [IsCoprime.pow_left_iff,
      (prime_X (R := p.ResidueField)).irreducible.coprime_iff_not_dvd] using hq'
  obtain ‚ü®R', _, _, _, P, _, _, a', b', hP, ha'm, hb'm, hfab', ‚ü®c, d, hcd‚ü©, ha', hb'‚ü© :=
    exists_etale_bijective_residueFieldMap_and_map_eq_mul_and_isCoprime p f
      (X ^ (m + 1)) b hfm (monic_X.pow _) hbm hfab hab
  let s' : R' ‚äó[R] S := 1 ‚äó‚Çú s
  have hs'f : aeval s' f = 0 :=
    show aeval (Algebra.TensorProduct.includeRight s) f = 0 by rw [aeval_algHom_apply, hf, map_zero]
  let e := aeval s' (c * a')
  have he : IsIdempotentElem e := by
    dsimp only [e, IsIdempotentElem]
    nth_rw 2 [eq_sub_iff_add_eq.mpr hcd]
    rw [‚Üê map_mul, mul_sub, mul_one, mul_mul_mul_comm, ‚Üê hfab']
    simp only [map_mul, map_sub, aeval_map_algebraMap, hs'f, mul_zero, sub_zero]
  let P' := (Ideal.fiberIsoOfBijectiveResidueField hP).symm ‚ü®q, ‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫‚ü©
  have hP'q : P'.1.comap Algebra.TensorProduct.includeRight.toRingHom = q :=
    Ideal.comap_fiberIsoOfBijectiveResidueField_symm ..
  have hs'P' : s' ‚àâ P'.1 := mt (fun h ‚Ü¶ hP'q.le h) hsq
  have ha'P' : aeval s' a' ‚àâ P'.1 := by
    simpa using show IsScalarTower.toAlgHom R' _ P'.1.ResidueField (aeval s' a') ‚â† 0 by
      rw [‚Üê aeval_algHom_apply, ‚Üê aeval_map_algebraMap P.ResidueField, ‚Üê ha']; simpa
  have hb'P' : aeval s' b' ‚àà P'.1 := by
    rw [‚Üê Ideal.IsPrime.mul_mem_left_iff ha'P', ‚Üê map_mul, ‚Üê hfab']
    simp [hs'f]
  have heP' : e ‚àâ P'.1 := by
    intro H
    have := P'.1.mul_mem_left (aeval s' d) hb'P'
    rw [‚Üê map_mul, eq_sub_iff_add_eq'.mpr hcd, map_sub, Submodule.sub_mem_iff_left _ H,
      map_one] at this
    exact Ideal.one_notMem _ this
  refine ‚ü®_, inferInstance, inferInstance, inferInstance, P, ‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫,
    e, he, P', inferInstance, P'.2.2, hP'q, heP', hP, fun P'' _ _ H ‚Ü¶ ?_‚ü©
  apply Ideal.eq_of_comap_eq_comap_of_bijective_residueFieldMap hP
  rw [hP'q]
  contrapose! H
  have : s' ‚àà P'' := hs _ inferInstance H (by simp [Ideal.liesOver_iff, Ideal.under,
    Ideal.comap_comap, Ideal.over_def P p, Ideal.over_def P'' P, ‚Üê IsScalarTower.algebraMap_eq])
  rw [‚Üê Ideal.algebraMap_residueField_eq_zero, ‚Üê aeval_algebraMap_apply,
    Ideal.algebraMap_residueField_eq_zero.mpr this, ‚Üê eval_map_algebraMap, Polynomial.map_mul,
    mul_comm, ‚Üê (Ideal.ResidueField.map‚Çê P P'' (Algebra.ofId _ _) (P''.over_def P)).comp_algebraMap,
    ‚Üê Polynomial.map_map, ‚Üê ha']
  simp
","lemma Algebra.exists_etale_isIdempotentElem_forall_liesOver_eq [Module.Finite R S]
    (p : Ideal R) [p.IsPrime] (q : Ideal S) [q.IsPrime] [q.LiesOver p] :
    ‚àÉ (R' : Type u) (_ : CommRing R') (_ : Algebra R R') (_ : Algebra.Etale R R') (P : Ideal R')
      (_ : P.IsPrime) (_ : P.LiesOver p) (e : R' ‚äó[R] S) (_ : IsIdempotentElem e)
      (P' : Ideal (R' ‚äó[R] S)) (_ : P'.IsPrime) (_ : P'.LiesOver P), P'.comap
        Algebra.TensorProduct.includeRight.toRingHom = q ‚àß e ‚àâ P' ‚àß
      Function.Bijective (Ideal.ResidueField.map‚Çê p P (Algebra.ofId _ _) (P.over_def p)) ‚àß
      ‚àÄ P'' : Ideal (R' ‚äó[R] S), P''.IsPrime ‚Üí P''.LiesOver P ‚Üí e ‚àâ P'' ‚Üí P'' = P' ","Proof.\n      Let $S\' \\subset S$ be the integral closure of $R$ in $S$. Let $\\mathfrak q\' = S\' \\cap \\mathfrak q$. By Zariski\'s Main Theorem 10.123.12 [[\n  Theorem 10.123.12 (Zariski\'s Main Theorem).  Let $R$ be a ring. Let $R \\to S$ be a finite type $R$-algebra. Let $S\' \\subset S$ be the integral closure of $R$ in $S$. Let $\\mathfrak q \\subset S$ be a prime of $S$. If $R \\to S$ is quasi-finite at $\\mathfrak q$ then there exists a $g \\in S\'$, $g \\not\\in \\mathfrak q$ such that $S\'_ g \\cong S_ g$. \n\n    \n]] there exists a $g \\in S\'$, $g \\not\\in \\mathfrak q\'$ such that $S\'_ g \\cong S_ g$. Consider the fibre rings $F = S \\otimes _ R \\kappa (\\mathfrak p)$ and $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$. Denote $\\overline{\\mathfrak q}\'$ the prime of $F\'$ corresponding to $\\mathfrak q\'$. Since $F\'$ is integral over $\\kappa (\\mathfrak p)$ we see that $\\overline{\\mathfrak q}\'$ is a closed point of $\\mathop{\\mathrm{Spec}}(F\')$, see Lemma 10.36.19 [[\n  Lemma 10.36.19. Let $k$ be a field. Let $S$ be a $k$-algebra over $k$. \n  \n  \nIf $S$ is a domain and finite dimensional over $k$, then $S$ is a field. \n\n\nIf $S$ is integral over $k$ and a domain, then $S$ is a field. \n\n\nIf $S$ is integral over $k$ then every prime of $S$ is a maximal ideal (see Lemma 10.26.5 for more consequences). \n\n\n\n\n    \n]]. Note that $\\mathfrak q$ defines an isolated closed point $\\overline{\\mathfrak q}$ of $\\mathop{\\mathrm{Spec}}(F)$ (see Definition 10.122.3 [[\n  Definition 10.122.3. Let $R \\to S$ be a finite type ring map. Let $\\mathfrak q \\subset S$ be a prime. \n  \n  \nIf the equivalent conditions of Lemma 10.122.2 are satisfied then we say $R \\to S$ is quasi-finite at $\\mathfrak q$. \n\n\nWe say a ring map $A \\to B$ is quasi-finite if it is of finite type and quasi-finite at all primes of $B$. \n\n\n\n]]). Since $S\'_ g \\cong S_ g$ we have $F\'_ g \\cong F_ g$, so $\\overline{\\mathfrak q}$ and $\\overline{\\mathfrak q}\'$ have isomorphic open neighbourhoods in $\\mathop{\\mathrm{Spec}}(F)$ and $\\mathop{\\mathrm{Spec}}(F\')$. We conclude the set $\\{ \\overline{\\mathfrak q}\'\\}  \\subset \\mathop{\\mathrm{Spec}}(F\')$ is open. Combined with $\\mathfrak q\'$ being closed (shown above) we conclude that $\\overline{\\mathfrak q}\'$ defines an isolated closed point of $\\mathop{\\mathrm{Spec}}(F\')$ as well. \n    \n      An additional small remark is that under the map $\\mathop{\\mathrm{Spec}}(F) \\to \\mathop{\\mathrm{Spec}}(F\')$ the point $\\overline{\\mathfrak q}$ is the only point mapping to $\\overline{\\mathfrak q}\'$. This follows from the discussion above. \n    \n      By Lemma 10.24.3 [[\n  Lemma 10.24.3. Let $R$ be a ring. If $\\mathop{\\mathrm{Spec}}(R) = U \\amalg V$ with both $U$ and $V$ open then $R \\cong R_1 \\times R_2$ with $U \\cong \\mathop{\\mathrm{Spec}}(R_1)$ and $V \\cong \\mathop{\\mathrm{Spec}}(R_2)$ via the maps in Lemma 10.21.2. Moreover, both $R_1$ and $R_2$ are localizations as well as quotients of the ring $R$. \n\n    \n]] we may write $F\' = F\'_1 \\times F\'_2$ with $\\mathop{\\mathrm{Spec}}(F\'_1) = \\{ \\overline{\\mathfrak q}\'\\} $. Since $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$, there exists an $s\' \\in S\'$ which maps to the element $(r, 0) \\in F\'_1 \\times F\'_2 = F\'$ for some $r \\in R$, $r \\not\\in \\mathfrak p$. In fact, what we will use about $s\'$ is that it is an element of $S\'$, not contained in $\\mathfrak q\'$, and contained in any other prime lying over $\\mathfrak p$. \n    \n      Let $f(x) \\in R[x]$ be a monic polynomial such that $f(s\') = 0$. Denote $\\overline{f} \\in \\kappa (\\mathfrak p)[x]$ the image. We can factor it as $\\overline{f} = x^ e \\overline{h}$ where $\\overline{h}(0) \\not= 0$. After replacing $f$ by $x f$ if necessary, we may assume $e \\geq 1$. By Lemma 10.143.13 [[\n  Lemma 10.143.13. Let $R$ be a ring. Let $f \\in R[x]$ be a monic polynomial. Let $\\mathfrak p$ be a prime of $R$. Let $f \\bmod \\mathfrak p = \\overline{g} \\overline{h}$ be a factorization of the image of $f$ in $\\kappa (\\mathfrak p)[x]$. If $\\gcd (\\overline{g}, \\overline{h}) = 1$, then there exist \n  \n  \nan \xc3\xa9tale ring map $R \\to R\'$, \n\n\na prime $\\mathfrak p\' \\subset R\'$ lying over $\\mathfrak p$, and \n\n\na factorization $f = g h$ in $R\'[x]$ \n\n\n\n   such that \n  \n  \n$\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, \n\n\n$\\overline{g} = g \\bmod \\mathfrak p\'$, $\\overline{h} = h \\bmod \\mathfrak p\'$, and \n\n\nthe polynomials $g, h$ generate the unit ideal in $R\'[x]$. \n\n\n\n\n    \n]] we can find an \xc3\xa9tale ring extension $R \\to R\'$, a prime $\\mathfrak p\'$ lying over $\\mathfrak p$, and a factorization $f = h i$ in $R\'[x]$ such that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, $\\overline{h} = h \\bmod \\mathfrak p\'$, $x^ e = i \\bmod \\mathfrak p\'$, and we can write $a h + b i = 1$ in $R\'[x]$ (for suitable $a, b$). \n    \n      Consider the elements $h(s\'), i(s\') \\in R\' \\otimes _ R S\'$. By construction we have $h(s\')i(s\') = f(s\') = 0$. On the other hand they generate the unit ideal since $a(s\')h(s\') + b(s\')i(s\') = 1$. Thus we see that $R\' \\otimes _ R S\'$ is the product of the localizations at these elements: \n    \n      \n  \\[  R\' \\otimes _ R S\' = (R\' \\otimes _ R S\')_{i(s\')} \\times (R\' \\otimes _ R S\')_{h(s\')} = S\'_1 \\times S\'_2  \\]\n\n    \n       Moreover this product decomposition is compatible with the product decomposition we found for the fibre ring $F\'$; this comes from our choices of $s\', i, h$ which guarantee that $\\overline{\\mathfrak q}\'$ is the only prime of $F\'$ which does not contain the image of $i(s\')$ in $F\'$. Here we use that the fibre ring of $R\'\\otimes _ R S\'$ over $R\'$ at $\\mathfrak p\'$ is the same as $F\'$ due to the fact that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$. It follows that $S\'_1$ has exactly one prime, say $\\mathfrak r\'$, lying over $\\mathfrak p\'$ and that this prime lies over $\\mathfrak q\'$. Hence the element $g \\in S\'$ maps to an element of $S\'_1$ not contained in $\\mathfrak r\'$. \n    \n      The base change $R\'\\otimes _ R S$ inherits a similar product decomposition \n    \n      \n  \\[  R\' \\otimes _ R S = (R\' \\otimes _ R S)_{i(s\')} \\times (R\' \\otimes _ R S)_{h(s\')} = S_1 \\times S_2  \\]\n\n    \n       It follows from the above that $S_1$ has exactly one prime, say $\\mathfrak r$, lying over $\\mathfrak p\'$ (consider the fibre ring as above), and that this prime lies over $\\mathfrak q$. \n    \n      Now we may apply Lemma 10.145.1 [[\n  Lemma 10.145.1. Let $R \\to S\' \\to S$ be ring maps. Let $\\mathfrak p \\subset R$ be a prime. Let $g \\in S\'$ be an element. Assume \n  \n  \n$R \\to S\'$ is integral, \n\n\n$R \\to S$ is finite type, \n\n\n$S\'_ g \\cong S_ g$, and \n\n\n$g$ invertible in $S\' \\otimes _ R \\kappa (\\mathfrak p)$. \n\n\n\n   Then there exists a $f \\in R$, $f \\not\\in \\mathfrak p$ such that $R_ f \\to S_ f$ is finite. \n\n    \n]] to the ring maps $R\' \\to S\'_1 \\to S_1$, the prime $\\mathfrak p\'$ and the element $g$ to see that after replacing $R\'$ by a principal localization we can assume that $S_1$ is finite over $R\'$ as desired. \n      $\\square$\n    \n","Proof.\n      Let $S\' \\subset S$ be the integral closure of $R$ in $S$. Let $\\mathfrak q\' = S\' \\cap \\mathfrak q$. By Zariski\'s Main Theorem 10.123.12 [[\n  Theorem 10.123.12 (Zariski\'s Main Theorem).  Let $R$ be a ring. Let $R \\to S$ be a finite type $R$-algebra. Let $S\' \\subset S$ be the integral closure of $R$ in $S$. Let $\\mathfrak q \\subset S$ be a prime of $S$. If $R \\to S$ is quasi-finite at $\\mathfrak q$ then there exists a $g \\in S\'$, $g \\not\\in \\mathfrak q$ such that $S\'_ g \\cong S_ g$. \n\n    \n]] there exists a $g \\in S\'$, $g \\not\\in \\mathfrak q\'$ such that $S\'_ g \\cong S_ g$. Consider the fibre rings $F = S \\otimes _ R \\kappa (\\mathfrak p)$ and $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$. Denote $\\overline{\\mathfrak q}\'$ the prime of $F\'$ corresponding to $\\mathfrak q\'$. Since $F\'$ is integral over $\\kappa (\\mathfrak p)$ we see that $\\overline{\\mathfrak q}\'$ is a closed point of $\\mathop{\\mathrm{Spec}}(F\')$, see Lemma 10.36.19 [[\n  Lemma 10.36.19. Let $k$ be a field. Let $S$ be a $k$-algebra over $k$. \n  \n  \nIf $S$ is a domain and finite dimensional over $k$, then $S$ is a field. \n\n\nIf $S$ is integral over $k$ and a domain, then $S$ is a field. \n\n\nIf $S$ is integral over $k$ then every prime of $S$ is a maximal ideal (see Lemma 10.26.5 for more consequences). \n\n\n\n\n    \n]]. Note that $\\mathfrak q$ defines an isolated closed point $\\overline{\\mathfrak q}$ of $\\mathop{\\mathrm{Spec}}(F)$ (see Definition 10.122.3 [[\n  Definition 10.122.3. Let $R \\to S$ be a finite type ring map. Let $\\mathfrak q \\subset S$ be a prime. \n  \n  \nIf the equivalent conditions of Lemma 10.122.2 are satisfied then we say $R \\to S$ is quasi-finite at $\\mathfrak q$. \n\n\nWe say a ring map $A \\to B$ is quasi-finite if it is of finite type and quasi-finite at all primes of $B$. \n\n\n\n]]). Since $S\'_ g \\cong S_ g$ we have $F\'_ g \\cong F_ g$, so $\\overline{\\mathfrak q}$ and $\\overline{\\mathfrak q}\'$ have isomorphic open neighbourhoods in $\\mathop{\\mathrm{Spec}}(F)$ and $\\mathop{\\mathrm{Spec}}(F\')$. We conclude the set $\\{ \\overline{\\mathfrak q}\'\\}  \\subset \\mathop{\\mathrm{Spec}}(F\')$ is open. Combined with $\\mathfrak q\'$ being closed (shown above) we conclude that $\\overline{\\mathfrak q}\'$ defines an isolated closed point of $\\mathop{\\mathrm{Spec}}(F\')$ as well. \n    \n      An additional small remark is that under the map $\\mathop{\\mathrm{Spec}}(F) \\to \\mathop{\\mathrm{Spec}}(F\')$ the point $\\overline{\\mathfrak q}$ is the only point mapping to $\\overline{\\mathfrak q}\'$. This follows from the discussion above. \n    \n      By Lemma 10.24.3 [[\n  Lemma 10.24.3. Let $R$ be a ring. If $\\mathop{\\mathrm{Spec}}(R) = U \\amalg V$ with both $U$ and $V$ open then $R \\cong R_1 \\times R_2$ with $U \\cong \\mathop{\\mathrm{Spec}}(R_1)$ and $V \\cong \\mathop{\\mathrm{Spec}}(R_2)$ via the maps in Lemma 10.21.2. Moreover, both $R_1$ and $R_2$ are localizations as well as quotients of the ring $R$. \n\n    \n]] we may write $F\' = F\'_1 \\times F\'_2$ with $\\mathop{\\mathrm{Spec}}(F\'_1) = \\{ \\overline{\\mathfrak q}\'\\} $. Since $F\' = S\' \\otimes _ R \\kappa (\\mathfrak p)$, there exists an $s\' \\in S\'$ which maps to the element $(r, 0) \\in F\'_1 \\times F\'_2 = F\'$ for some $r \\in R$, $r \\not\\in \\mathfrak p$. In fact, what we will use about $s\'$ is that it is an element of $S\'$, not contained in $\\mathfrak q\'$, and contained in any other prime lying over $\\mathfrak p$. \n    \n      Let $f(x) \\in R[x]$ be a monic polynomial such that $f(s\') = 0$. Denote $\\overline{f} \\in \\kappa (\\mathfrak p)[x]$ the image. We can factor it as $\\overline{f} = x^ e \\overline{h}$ where $\\overline{h}(0) \\not= 0$. After replacing $f$ by $x f$ if necessary, we may assume $e \\geq 1$. By Lemma 10.143.13 [[\n  Lemma 10.143.13. Let $R$ be a ring. Let $f \\in R[x]$ be a monic polynomial. Let $\\mathfrak p$ be a prime of $R$. Let $f \\bmod \\mathfrak p = \\overline{g} \\overline{h}$ be a factorization of the image of $f$ in $\\kappa (\\mathfrak p)[x]$. If $\\gcd (\\overline{g}, \\overline{h}) = 1$, then there exist \n  \n  \nan \xc3\xa9tale ring map $R \\to R\'$, \n\n\na prime $\\mathfrak p\' \\subset R\'$ lying over $\\mathfrak p$, and \n\n\na factorization $f = g h$ in $R\'[x]$ \n\n\n\n   such that \n  \n  \n$\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, \n\n\n$\\overline{g} = g \\bmod \\mathfrak p\'$, $\\overline{h} = h \\bmod \\mathfrak p\'$, and \n\n\nthe polynomials $g, h$ generate the unit ideal in $R\'[x]$. \n\n\n\n\n    \n]] we can find an \xc3\xa9tale ring extension $R \\to R\'$, a prime $\\mathfrak p\'$ lying over $\\mathfrak p$, and a factorization $f = h i$ in $R\'[x]$ such that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, $\\overline{h} = h \\bmod \\mathfrak p\'$, $x^ e = i \\bmod \\mathfrak p\'$, and we can write $a h + b i = 1$ in $R\'[x]$ (for suitable $a, b$). \n    \n      Consider the elements $h(s\'), i(s\') \\in R\' \\otimes _ R S\'$. By construction we have $h(s\')i(s\') = f(s\') = 0$. On the other hand they generate the unit ideal since $a(s\')h(s\') + b(s\')i(s\') = 1$. Thus we see that $R\' \\otimes _ R S\'$ is the product of the localizations at these elements: \n    \n      \n  \\[  R\' \\otimes _ R S\' = (R\' \\otimes _ R S\')_{i(s\')} \\times (R\' \\otimes _ R S\')_{h(s\')} = S\'_1 \\times S\'_2  \\]\n\n    \n       Moreover this product decomposition is compatible with the product decomposition we found for the fibre ring $F\'$; this comes from our choices of $s\', i, h$ which guarantee that $\\overline{\\mathfrak q}\'$ is the only prime of $F\'$ which does not contain the image of $i(s\')$ in $F\'$. Here we use that the fibre ring of $R\'\\otimes _ R S\'$ over $R\'$ at $\\mathfrak p\'$ is the same as $F\'$ due to the fact that $\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$. It follows that $S\'_1$ has exactly one prime, say $\\mathfrak r\'$, lying over $\\mathfrak p\'$ and that this prime lies over $\\mathfrak q\'$. Hence the element $g \\in S\'$ maps to an element of $S\'_1$ not contained in $\\mathfrak r\'$. \n    \n      The base change $R\'\\otimes _ R S$ inherits a similar product decomposition \n    \n      \n  \\[  R\' \\otimes _ R S = (R\' \\otimes _ R S)_{i(s\')} \\times (R\' \\otimes _ R S)_{h(s\')} = S_1 \\times S_2  \\]\n\n    \n       It follows from the above that $S_1$ has exactly one prime, say $\\mathfrak r$, lying over $\\mathfrak p\'$ (consider the fibre ring as above), and that this prime lies over $\\mathfrak q$. \n    \n      Now we may apply Lemma 10.145.1 [[\n  Lemma 10.145.1. Let $R \\to S\' \\to S$ be ring maps. Let $\\mathfrak p \\subset R$ be a prime. Let $g \\in S\'$ be an element. Assume \n  \n  \n$R \\to S\'$ is integral, \n\n\n$R \\to S$ is finite type, \n\n\n$S\'_ g \\cong S_ g$, and \n\n\n$g$ invertible in $S\' \\otimes _ R \\kappa (\\mathfrak p)$. \n\n\n\n   Then there exists a $f \\in R$, $f \\not\\in \\mathfrak p$ such that $R_ f \\to S_ f$ is finite. \n\n    \n]] to the ring maps $R\' \\to S\'_1 \\to S_1$, the prime $\\mathfrak p\'$ and the element $g$ to see that after replacing $R\'$ by a principal localization we can assume that $S_1$ is finite over $R\'$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof is organized around Zariski‚Äôs Main Theorem to get an element g in the integral closure S‚Ä≤ with S‚Ä≤_g ‚âÖ S_g, then uses fiber rings over Œ∫(p) to show an isolated closed point, deduces a product decomposition F‚Ä≤ ‚âÖ F‚Ä≤‚ÇÅ √ó F‚Ä≤‚ÇÇ, chooses s‚Ä≤ mapping to (r,0), picks a monic polynomial f with f(s‚Ä≤)=0, factors ÃÑf = x^e ÃÑh with gcd condition, applies an √©tale lifting lemma to get an √©tale R‚ÜíR‚Ä≤ and a factorization f=hi with coprime relation, then uses idempotents/localizations to split R‚Ä≤‚äó_R S‚Ä≤ and R‚Ä≤‚äó_R S, and finally applies a finiteness lemma (10.145.1) to conclude finiteness after localization.\n\nThe Lean proof instead starts by producing an element s with a non-membership property via `Ideal.exists_not_mem_forall_mem_of_ne_of_liesOver p q`, then constructs a specific monic polynomial f (X * minpoly R s) and a factorization in the residue field involving root multiplicity at 0, yielding data (m,f,b) with `IsCoprime (X^(m+1)) b` and `f.map = X^(m+1)*b` and `aeval s f = 0`. It then applies a lemma `exists_etale_bijective_residueFieldMap_and_map_eq_mul_and_isCoprime` to obtain an √©tale extension R‚Ä≤, primes, polynomials a‚Ä≤, b‚Ä≤, and a B√©zout relation c,d giving an idempotent element e in the tensor product; the remainder is a prime-ideal argument showing e avoids a distinguished prime and uniqueness of a prime over p via comap/residue field bijectivity.\n\nStructurally there is partial correspondence: both proofs use (1) an integral element satisfying a monic polynomial, (2) a factorization mod p with a coprimality condition, (3) an √©tale extension with residue field control, and (4) a B√©zout relation producing an idempotent and hence a decomposition isolating a prime. However, major components of the informal proof (explicit use of Zariski‚Äôs Main Theorem, the open/closed point argument on Spec of fiber rings, the product decomposition F‚Ä≤ = F‚Ä≤‚ÇÅ√óF‚Ä≤‚ÇÇ via Spec decomposition, and the final application of Lemma 10.145.1 to deduce finiteness after localization) are not visibly present in the Lean script. Conversely, the Lean proof contains technical steps (rootMultiplicity at 0, explicit polynomial identity f.map = X^(m+1)*b, detailed comap/fiberIso machinery) that are not reflected in the informal narrative.\n\nOverall, the Lean proof seems to formalize a related ‚Äú√©tale + idempotent isolates a unique prime over p‚Äù construction, but it does not track the same ZMT/fiber-ring/topological decomposition-to-finiteness storyline, so alignment is low-to-moderate rather than strong.""}"
265,07CF,"public lemma exists_presentation_of_free_cotangent [Algebra.FinitePresentation R S]
    {Œ± : Type*} (P : Generators R S Œ±) [Finite Œ±]
    [Module.Free S P.toExtension.Cotangent] :
    ‚àÉ (P' : Presentation R S (Unit ‚äï Œ±) (Unit ‚äï Fin (Module.finrank S P.toExtension.Cotangent)))
      (b : Module.Basis (Unit ‚äï Fin (Module.finrank S P.toExtension.Cotangent))
        S P'.toExtension.Cotangent),
      P'.val ‚àò Sum.inr = P.val ‚àß
      ‚àÄ r, b r = Extension.Cotangent.mk ‚ü®P'.relation r, P'.relation_mem_ker r‚ü© := by
  cases subsingleton_or_nontrivial S
  ¬∑ let P' : Presentation R S (Unit ‚äï Œ±) (Unit ‚äï Fin (Module.finrank S P.toExtension.Cotangent)) :=
      { toGenerators := .ofSurjective (fun i : Unit ‚äï Œ± ‚Ü¶ 0) (Function.surjective_to_subsingleton _)
        relation _ := 1
        span_range_relation_eq_ker := by simpa using (RingHom.ker_eq_top_of_subsingleton _).symm }
    have : Subsingleton P'.toExtension.Cotangent := Module.subsingleton S _
    exact ‚ü®P', default, by subsingleton, by subsingleton‚ü©
  have : Module.Finite S P.toExtension.Cotangent :=
    Algebra.Extension.Cotangent.finite P.fg_ker_of_finitePresentation
  exact exists_presentation_of_basis_cotangent _ <| Module.finBasis S P.toExtension.Cotangent
",Formal Proof of Stacks Project Tag 07CF,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Extension/Cotangent/Basis.lean#L302-L319,Q27041,,10.136.6,lemma,3.0,"['00SK', '00AO', '0ELQ']","\n  Lemma 10.136.6. Let $S$ be a finitely presented $R$-algebra which has a presentation $S = R[x_1, \\ldots , x_ n]/I$ such that $I/I^2$ is free over $S$. Then $S$ has a presentation $S = R[y_1, \\ldots , y_ m]/(f_1, \\ldots , f_ c)$ such that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free with basis given by the classes of $f_1, \\ldots , f_ c$. \n\n    \n      Proof.\n      Note that $I$ is a finitely generated ideal by Lemma 10.6.3. Let $f_1, \\ldots , f_ c \\in I$ be elements which map to a basis of $I/I^2$. By Nakayama\'s lemma (Lemma 10.20.1) there exists a $g \\in 1 + I$ such that \n    \n      \n  \\[  g \\cdot I \\subset (f_1, \\ldots , f_ c)  \\]\n\n    \n       and $I_ g \\cong (f_1, \\ldots , f_ c)_ g$. Hence we see that \n    \n      \n  \\[  S \\cong R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)[1/g] \\cong R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)  \\]\n\n    \n       as desired. It follows that $f_1, \\ldots , f_ c,gx_{n + 1} - 1$ form a basis for $(f_1, \\ldots , f_ c, gx_{n + 1} - 1)/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)^2$ for example by applying Lemma 10.134.12. \n      $\\square$\n    \n","\n  Lemma 10.136.6. Let $S$ be a finitely presented $R$-algebra which has a presentation $S = R[x_1, \\ldots , x_ n]/I$ such that $I/I^2$ is free over $S$. Then $S$ has a presentation $S = R[y_1, \\ldots , y_ m]/(f_1, \\ldots , f_ c)$ such that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free with basis given by the classes of $f_1, \\ldots , f_ c$. \n\n    \n","Proof.\n      Note that $I$ is a finitely generated ideal by Lemma 10.6.3. Let $f_1, \\ldots , f_ c \\in I$ be elements which map to a basis of $I/I^2$. By Nakayama\'s lemma (Lemma 10.20.1) there exists a $g \\in 1 + I$ such that \n    \n      \n  \\[  g \\cdot I \\subset (f_1, \\ldots , f_ c)  \\]\n\n    \n       and $I_ g \\cong (f_1, \\ldots , f_ c)_ g$. Hence we see that \n    \n      \n  \\[  S \\cong R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)[1/g] \\cong R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)  \\]\n\n    \n       as desired. It follows that $f_1, \\ldots , f_ c,gx_{n + 1} - 1$ form a basis for $(f_1, \\ldots , f_ c, gx_{n + 1} - 1)/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)^2$ for example by applying Lemma 10.134.12. \n      $\\square$\n    \n"," by
  cases subsingleton_or_nontrivial S
  ¬∑ let P' : Presentation R S (Unit ‚äï Œ±) (Unit ‚äï Fin (Module.finrank S P.toExtension.Cotangent)) :=
      { toGenerators := .ofSurjective (fun i : Unit ‚äï Œ± ‚Ü¶ 0) (Function.surjective_to_subsingleton _)
        relation _ := 1
        span_range_relation_eq_ker := by simpa using (RingHom.ker_eq_top_of_subsingleton _).symm }
    have : Subsingleton P'.toExtension.Cotangent := Module.subsingleton S _
    exact ‚ü®P', default, by subsingleton, by subsingleton‚ü©
  have : Module.Finite S P.toExtension.Cotangent :=
    Algebra.Extension.Cotangent.finite P.fg_ker_of_finitePresentation
  exact exists_presentation_of_basis_cotangent _ <| Module.finBasis S P.toExtension.Cotangent
","public lemma exists_presentation_of_free_cotangent [Algebra.FinitePresentation R S]
    {Œ± : Type*} (P : Generators R S Œ±) [Finite Œ±]
    [Module.Free S P.toExtension.Cotangent] :
    ‚àÉ (P' : Presentation R S (Unit ‚äï Œ±) (Unit ‚äï Fin (Module.finrank S P.toExtension.Cotangent)))
      (b : Module.Basis (Unit ‚äï Fin (Module.finrank S P.toExtension.Cotangent))
        S P'.toExtension.Cotangent),
      P'.val ‚àò Sum.inr = P.val ‚àß
      ‚àÄ r, b r = Extension.Cotangent.mk ‚ü®P'.relation r, P'.relation_mem_ker r‚ü© ","Proof.\n      Note that $I$ is a finitely generated ideal by Lemma 10.6.3 [[\n  Lemma 10.6.3. Let $R \\to S$ be a ring map of finite presentation. For any surjection $\\alpha : R[x_1, \\ldots , x_ n] \\to S$ the kernel of $\\alpha $ is a finitely generated ideal in $R[x_1, \\ldots , x_ n]$. \n\n    \n]]. Let $f_1, \\ldots , f_ c \\in I$ be elements which map to a basis of $I/I^2$. By Nakayama\'s lemma (Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]) there exists a $g \\in 1 + I$ such that \n    \n      \n  \\[  g \\cdot I \\subset (f_1, \\ldots , f_ c)  \\]\n\n    \n       and $I_ g \\cong (f_1, \\ldots , f_ c)_ g$. Hence we see that \n    \n      \n  \\[  S \\cong R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)[1/g] \\cong R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)  \\]\n\n    \n       as desired. It follows that $f_1, \\ldots , f_ c,gx_{n + 1} - 1$ form a basis for $(f_1, \\ldots , f_ c, gx_{n + 1} - 1)/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)^2$ for example by applying Lemma 10.134.12 [[\n       \n      \n  Lemma 10.134.12. Let $A \\to B$ be a ring map. Let $g \\in B$. Suppose $\\alpha : P \\to B$ is a presentation with kernel $I$. Then a presentation of $B_ g$ over $A$ is the map \n  \n  \\[  \\beta : P[x] \\longrightarrow B_ g  \\]\n\n   extending $\\alpha $ and sending $x$ to $1/g$. The kernel $J$ of $\\beta $ is generated by $I$ and the element $f x - 1$ where $f \\in P$ is an element mapped to $g \\in B$ by $\\alpha $. In this situation we have \n  \n  \n$J/J^2 = (I/I^2)_ g \\oplus B_ g (f x - 1)$, \n\n\n$\\Omega _{P[x]/A} \\otimes _{P[x]} B_ g = \\Omega _{P/A} \\otimes _ P B_ g \\oplus B_ g \\text{d}x$, \n\n\n$\\mathop{N\\! L}\\nolimits (\\beta ) \\cong \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\oplus (B_ g \\xrightarrow {g} B_ g)$ \n\n\n\n   Hence the canonical map $\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits _{B_ g/A}$ is a homotopy equivalence. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Note that $I$ is a finitely generated ideal by Lemma 10.6.3 [[\n  Lemma 10.6.3. Let $R \\to S$ be a ring map of finite presentation. For any surjection $\\alpha : R[x_1, \\ldots , x_ n] \\to S$ the kernel of $\\alpha $ is a finitely generated ideal in $R[x_1, \\ldots , x_ n]$. \n\n    \n]]. Let $f_1, \\ldots , f_ c \\in I$ be elements which map to a basis of $I/I^2$. By Nakayama\'s lemma (Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]]) there exists a $g \\in 1 + I$ such that \n    \n      \n  \\[  g \\cdot I \\subset (f_1, \\ldots , f_ c)  \\]\n\n    \n       and $I_ g \\cong (f_1, \\ldots , f_ c)_ g$. Hence we see that \n    \n      \n  \\[  S \\cong R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)[1/g] \\cong R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)  \\]\n\n    \n       as desired. It follows that $f_1, \\ldots , f_ c,gx_{n + 1} - 1$ form a basis for $(f_1, \\ldots , f_ c, gx_{n + 1} - 1)/(f_1, \\ldots , f_ c, gx_{n + 1} - 1)^2$ for example by applying Lemma 10.134.12 [[\n       \n      \n  Lemma 10.134.12. Let $A \\to B$ be a ring map. Let $g \\in B$. Suppose $\\alpha : P \\to B$ is a presentation with kernel $I$. Then a presentation of $B_ g$ over $A$ is the map \n  \n  \\[  \\beta : P[x] \\longrightarrow B_ g  \\]\n\n   extending $\\alpha $ and sending $x$ to $1/g$. The kernel $J$ of $\\beta $ is generated by $I$ and the element $f x - 1$ where $f \\in P$ is an element mapped to $g \\in B$ by $\\alpha $. In this situation we have \n  \n  \n$J/J^2 = (I/I^2)_ g \\oplus B_ g (f x - 1)$, \n\n\n$\\Omega _{P[x]/A} \\otimes _{P[x]} B_ g = \\Omega _{P/A} \\otimes _ P B_ g \\oplus B_ g \\text{d}x$, \n\n\n$\\mathop{N\\! L}\\nolimits (\\beta ) \\cong \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\oplus (B_ g \\xrightarrow {g} B_ g)$ \n\n\n\n   Hence the canonical map $\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits _{B_ g/A}$ is a homotopy equivalence. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof constructs an explicit localized presentation: starting from a finite presentation R[x]‚ÜíS with kernel I finitely generated, choosing f_i mapping to a basis of I/I^2, applying Nakayama to find g‚àà1+I so that after localizing I_g is generated by the f_i, and then rewriting S as a quotient with an extra variable x_{n+1} and relation gx_{n+1}-1; it also argues about a basis of J/J^2 using a lemma about localization.\n\nThe formal proof instead splits into the subsingleton/nontrivial cases. In the subsingleton case it builds a trivial presentation with zero generators and uses subsingleton facts about the cotangent module. In the nontrivial case it uses abstract finiteness of the cotangent module (Algebra.Extension.Cotangent.finite) and then applies an existence lemma (exists_presentation_of_basis_cotangent) using a finite basis of the cotangent module. This is a different strategy: it does not perform the explicit kernel/I/I^2, Nakayama, localization-by-g, or adjoining-inverse construction that is central to the informal proof. Structurally, the formal proof is a case split plus an existence theorem from finiteness, whereas the informal proof is a constructive localization argument. The only real overlap is the use of finiteness (finite presentation ‚áí finiteness properties), but the main steps and objects (g, f_i, I/I^2 basis, gx_{n+1}-1) are absent in the formal proof.""}"
266,08JZ,"lemma liftBaseChange_injective_of_isLocalizationAway :
    Function.Injective (LinearMap.liftBaseChange T
      (Extension.Cotangent.map
        ((Generators.localizationAway T g).toComp P).toExtensionHom)) := by
  set Q := Generators.localizationAway T g
  algebraize [((Generators.localizationAway T g).toComp P).toAlgHom.toRingHom]
  let f : P.Ring ‚ß∏ P.ker ^ 2 := P.œÉ g
  let œÄ := compLocalizationAwayAlgHom T g P
  refine IsLocalizedModule.injective_of_map_zero (Submonoid.powers g)
    (TensorProduct.mk S T P.toExtension.Cotangent 1) (fun x hx ‚Ü¶ ?_)
  obtain ‚ü®x, rfl‚ü© := Algebra.Extension.Cotangent.mk_surjective x
  suffices h : algebraMap P.Ring (Localization.Away f) x.val = 0 by
    rw [IsScalarTower.algebraMap_apply _ (P.Ring ‚ß∏ P.ker ^ 2) _,
      IsLocalization.map_eq_zero_iff (Submonoid.powers f) (Localization.Away f)] at h
    obtain ‚ü®‚ü®m, ‚ü®n, rfl‚ü©‚ü©, hm‚ü© := h
    rw [IsLocalizedModule.eq_zero_iff (Submonoid.powers g)]
    use ‚ü®g ^ n, n, rfl‚ü©
    dsimp [f] at hm
    rw [‚Üê map_pow, ‚Üê map_mul, Ideal.Quotient.eq_zero_iff_mem] at hm
    simp only [Submonoid.smul_def]
    rw [show g = algebraMap P.Ring S (P.œÉ g) by simp, ‚Üê map_pow, algebraMap_smul, ‚Üê map_smul,
      Extension.Cotangent.mk_eq_zero_iff]
    simpa using hm
  rw [‚Üê compLocalizationAwayAlgHom_toAlgHom_toComp (T := T)]
  apply sq_ker_comp_le_ker_compLocalizationAwayAlgHom
  simpa only [LinearEquiv.coe_coe, LinearMap.ringLmapEquivSelf_symm_apply,
    mk_apply, lift.tmul, LinearMap.coe_restrictScalars, LinearMap.coe_smulRight,
    Module.End.one_apply, LinearMap.smul_apply, one_smul, Algebra.Extension.Cotangent.map_mk,
    Extension.Cotangent.mk_eq_zero_iff] using hx
",Formal Proof of Stacks Project Tag 08JZ,part of (1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Extension/Cotangent/LocalizationAway.lean#L126-L154,Q27041,,10.134.12,lemma,3.0,"['00S0', '00AO', '0ELQ']","\n       \n      \n  Lemma 10.134.12. Let $A \\to B$ be a ring map. Let $g \\in B$. Suppose $\\alpha : P \\to B$ is a presentation with kernel $I$. Then a presentation of $B_ g$ over $A$ is the map \n  \n  \\[  \\beta : P[x] \\longrightarrow B_ g  \\]\n\n   extending $\\alpha $ and sending $x$ to $1/g$. The kernel $J$ of $\\beta $ is generated by $I$ and the element $f x - 1$ where $f \\in P$ is an element mapped to $g \\in B$ by $\\alpha $. In this situation we have \n  \n  \n$J/J^2 = (I/I^2)_ g \\oplus B_ g (f x - 1)$, \n\n\n$\\Omega _{P[x]/A} \\otimes _{P[x]} B_ g = \\Omega _{P/A} \\otimes _ P B_ g \\oplus B_ g \\text{d}x$, \n\n\n$\\mathop{N\\! L}\\nolimits (\\beta ) \\cong \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\oplus (B_ g \\xrightarrow {g} B_ g)$ \n\n\n\n   Hence the canonical map $\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits _{B_ g/A}$ is a homotopy equivalence. \n\n    \n      Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2.) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n","\n       \n      \n  Lemma 10.134.12. Let $A \\to B$ be a ring map. Let $g \\in B$. Suppose $\\alpha : P \\to B$ is a presentation with kernel $I$. Then a presentation of $B_ g$ over $A$ is the map \n  \n  \\[  \\beta : P[x] \\longrightarrow B_ g  \\]\n\n   extending $\\alpha $ and sending $x$ to $1/g$. The kernel $J$ of $\\beta $ is generated by $I$ and the element $f x - 1$ where $f \\in P$ is an element mapped to $g \\in B$ by $\\alpha $. In this situation we have \n  \n  \n$J/J^2 = (I/I^2)_ g \\oplus B_ g (f x - 1)$, \n\n\n$\\Omega _{P[x]/A} \\otimes _{P[x]} B_ g = \\Omega _{P/A} \\otimes _ P B_ g \\oplus B_ g \\text{d}x$, \n\n\n$\\mathop{N\\! L}\\nolimits (\\beta ) \\cong \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\oplus (B_ g \\xrightarrow {g} B_ g)$ \n\n\n\n   Hence the canonical map $\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits _{B_ g/A}$ is a homotopy equivalence. \n\n    \n","Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2.) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n"," by
  set Q := Generators.localizationAway T g
  algebraize [((Generators.localizationAway T g).toComp P).toAlgHom.toRingHom]
  let f : P.Ring ‚ß∏ P.ker ^ 2 := P.œÉ g
  let œÄ := compLocalizationAwayAlgHom T g P
  refine IsLocalizedModule.injective_of_map_zero (Submonoid.powers g)
    (TensorProduct.mk S T P.toExtension.Cotangent 1) (fun x hx ‚Ü¶ ?_)
  obtain ‚ü®x, rfl‚ü© := Algebra.Extension.Cotangent.mk_surjective x
  suffices h : algebraMap P.Ring (Localization.Away f) x.val = 0 by
    rw [IsScalarTower.algebraMap_apply _ (P.Ring ‚ß∏ P.ker ^ 2) _,
      IsLocalization.map_eq_zero_iff (Submonoid.powers f) (Localization.Away f)] at h
    obtain ‚ü®‚ü®m, ‚ü®n, rfl‚ü©‚ü©, hm‚ü© := h
    rw [IsLocalizedModule.eq_zero_iff (Submonoid.powers g)]
    use ‚ü®g ^ n, n, rfl‚ü©
    dsimp [f] at hm
    rw [‚Üê map_pow, ‚Üê map_mul, Ideal.Quotient.eq_zero_iff_mem] at hm
    simp only [Submonoid.smul_def]
    rw [show g = algebraMap P.Ring S (P.œÉ g) by simp, ‚Üê map_pow, algebraMap_smul, ‚Üê map_smul,
      Extension.Cotangent.mk_eq_zero_iff]
    simpa using hm
  rw [‚Üê compLocalizationAwayAlgHom_toAlgHom_toComp (T := T)]
  apply sq_ker_comp_le_ker_compLocalizationAwayAlgHom
  simpa only [LinearEquiv.coe_coe, LinearMap.ringLmapEquivSelf_symm_apply,
    mk_apply, lift.tmul, LinearMap.coe_restrictScalars, LinearMap.coe_smulRight,
    Module.End.one_apply, LinearMap.smul_apply, one_smul, Algebra.Extension.Cotangent.map_mk,
    Extension.Cotangent.mk_eq_zero_iff] using hx
","lemma liftBaseChange_injective_of_isLocalizationAway :
    Function.Injective (LinearMap.liftBaseChange T
      (Extension.Cotangent.map
        ((Generators.localizationAway T g).toComp P).toExtensionHom)) ","Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4 [[\n  Lemma 10.134.4 (Jacobi-Zariski sequence).  Let $A \\to B \\to C$ be ring maps. Choose a presentation $\\alpha : A[x_ s, s \\in S] \\to B$ with kernel $I$. Choose a presentation $\\beta : B[y_ t, t \\in T] \\to C$ with kernel $J$. Let $\\gamma : A[x_ s, y_ t] \\to C$ be the induced presentation of $C$ with kernel $K$. Then we get a canonical commutative diagram \n  \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{A[x_ s]/A} \\otimes C \\ar[r] &  \\Omega _{A[x_ s, y_ t]/A} \\otimes C \\ar[r] &  \\Omega _{B[y_ t]/B} \\otimes C \\ar[r] &  0 \\\\  &  I/I^2 \\otimes C \\ar[r] \\ar[u] &  K/K^2 \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n   with exact rows. We get the following exact sequence of homology groups \n  \n  \\[  H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) \\to H_1(L_{C/A}) \\to H_1(L_{C/B}) \\to C \\otimes _ B \\Omega _{B/A} \\to \\Omega _{C/A} \\to \\Omega _{C/B} \\to 0  \\]\n\n   of $C$-modules extending the sequence of Lemma 10.131.7. If $\\text{Tor}_1^ B(\\Omega _{B/A}, C) = 0$ and $\\text{Tor}_2^ B(\\Omega _{B/A}, C) = 0$, then $H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) = H_1(L_{B/A}) \\otimes _ B C$. \n\n    \n]]. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2 [[\n  Lemma 10.69.2. Let $R$ be a ring. \n  \n  \nA regular sequence $f_1, \\ldots , f_ c$ of $R$ is a quasi-regular sequence. \n\n\nSuppose that $M$ is an $R$-module and that $f_1, \\ldots , f_ c$ is an $M$-regular sequence. Then $f_1, \\ldots , f_ c$ is an $M$-quasi-regular sequence. \n\n\n\n\n    \n]].) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n","Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4 [[\n  Lemma 10.134.4 (Jacobi-Zariski sequence).  Let $A \\to B \\to C$ be ring maps. Choose a presentation $\\alpha : A[x_ s, s \\in S] \\to B$ with kernel $I$. Choose a presentation $\\beta : B[y_ t, t \\in T] \\to C$ with kernel $J$. Let $\\gamma : A[x_ s, y_ t] \\to C$ be the induced presentation of $C$ with kernel $K$. Then we get a canonical commutative diagram \n  \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{A[x_ s]/A} \\otimes C \\ar[r] &  \\Omega _{A[x_ s, y_ t]/A} \\otimes C \\ar[r] &  \\Omega _{B[y_ t]/B} \\otimes C \\ar[r] &  0 \\\\  &  I/I^2 \\otimes C \\ar[r] \\ar[u] &  K/K^2 \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n   with exact rows. We get the following exact sequence of homology groups \n  \n  \\[  H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) \\to H_1(L_{C/A}) \\to H_1(L_{C/B}) \\to C \\otimes _ B \\Omega _{B/A} \\to \\Omega _{C/A} \\to \\Omega _{C/B} \\to 0  \\]\n\n   of $C$-modules extending the sequence of Lemma 10.131.7. If $\\text{Tor}_1^ B(\\Omega _{B/A}, C) = 0$ and $\\text{Tor}_2^ B(\\Omega _{B/A}, C) = 0$, then $H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) = H_1(L_{B/A}) \\otimes _ B C$. \n\n    \n]]. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2 [[\n  Lemma 10.69.2. Let $R$ be a ring. \n  \n  \nA regular sequence $f_1, \\ldots , f_ c$ of $R$ is a quasi-regular sequence. \n\n\nSuppose that $M$ is an $R$-module and that $f_1, \\ldots , f_ c$ is an $M$-regular sequence. Then $f_1, \\ldots , f_ c$ is an $M$-quasi-regular sequence. \n\n\n\n\n    \n]].) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: part of (1)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is proving the key claim highlighted in the informal argument: the injectivity of the map (I/I^2)_g ‚Üí J/J^2 (the ‚Äúpart of (1)‚Äù mentioned). The informal proof‚Äôs core mechanism is: define a P-algebra map œÄ : P[x] ‚Üí (P/I^2)_f sending x ‚Ü¶ 1/f, observe œÄ(J) lands in a square-zero ideal so œÄ(J^2)=0, and conclude that if a‚ààI maps into J^2 then œÄ(a)=0 hence a=0 in the localized conormal module, giving injectivity. The Lean proof mirrors this: it defines f := P.œÉ g and œÄ := compLocalizationAwayAlgHom T g P (a localization-away map), then uses an injectivity criterion for localized modules (IsLocalizedModule.injective_of_map_zero / eq_zero_iff) to reduce injectivity to showing an element maps to 0 after localization; it then applies a lemma sq_ker_comp_le_ker_compLocalizationAwayAlgHom, which corresponds exactly to the informal step ‚ÄúœÄ(J^2)=0 because the target ideal is square-zero,‚Äù and finishes by translating ‚Äúmap is zero in localization‚Äù into ‚Äúkilled by a power of g‚Äù (the standard localization argument). Structurally, the Lean proof is more algebraic/technical (tensor/cotangent packaging, mk_surjective, map_eq_zero_iff, powers g) and does not reproduce the Jacobi‚ÄìZariski diagram/splitting discussion from the informal proof, but that extra material is not needed for the injectivity subclaim. There is little extraneous content beyond the formal infrastructure for cotangent/conormal modules and localization, so overall it is strongly aligned but not a perfect structural match to the full informal narrative.""}"
267,08JZ,"noncomputable
def cotangentCompLocalizationAwayEquiv :
    ((localizationAway T g).comp P).toExtension.Cotangent ‚âÉ‚Çó[T]
      T ‚äó[S] P.toExtension.Cotangent √ó (Generators.localizationAway T g).toExtension.Cotangent :=
  ((Cotangent.exact (localizationAway g (S := T)) P).splitSurjectiveEquiv
    (liftBaseChange_injective_of_isLocalizationAway _ P)
    ‚ü®cotangentCompAwaySec g P x, map_comp_cotangentCompAwaySec g P hx‚ü©).1
",Formal Proof of Stacks Project Tag 08JZ,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Extension/Cotangent/LocalizationAway.lean#L197-L203,Q27041,,10.134.12,lemma,3.0,"['00S0', '00AO', '0ELQ']","\n       \n      \n  Lemma 10.134.12. Let $A \\to B$ be a ring map. Let $g \\in B$. Suppose $\\alpha : P \\to B$ is a presentation with kernel $I$. Then a presentation of $B_ g$ over $A$ is the map \n  \n  \\[  \\beta : P[x] \\longrightarrow B_ g  \\]\n\n   extending $\\alpha $ and sending $x$ to $1/g$. The kernel $J$ of $\\beta $ is generated by $I$ and the element $f x - 1$ where $f \\in P$ is an element mapped to $g \\in B$ by $\\alpha $. In this situation we have \n  \n  \n$J/J^2 = (I/I^2)_ g \\oplus B_ g (f x - 1)$, \n\n\n$\\Omega _{P[x]/A} \\otimes _{P[x]} B_ g = \\Omega _{P/A} \\otimes _ P B_ g \\oplus B_ g \\text{d}x$, \n\n\n$\\mathop{N\\! L}\\nolimits (\\beta ) \\cong \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\oplus (B_ g \\xrightarrow {g} B_ g)$ \n\n\n\n   Hence the canonical map $\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits _{B_ g/A}$ is a homotopy equivalence. \n\n    \n      Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2.) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n","\n       \n      \n  Lemma 10.134.12. Let $A \\to B$ be a ring map. Let $g \\in B$. Suppose $\\alpha : P \\to B$ is a presentation with kernel $I$. Then a presentation of $B_ g$ over $A$ is the map \n  \n  \\[  \\beta : P[x] \\longrightarrow B_ g  \\]\n\n   extending $\\alpha $ and sending $x$ to $1/g$. The kernel $J$ of $\\beta $ is generated by $I$ and the element $f x - 1$ where $f \\in P$ is an element mapped to $g \\in B$ by $\\alpha $. In this situation we have \n  \n  \n$J/J^2 = (I/I^2)_ g \\oplus B_ g (f x - 1)$, \n\n\n$\\Omega _{P[x]/A} \\otimes _{P[x]} B_ g = \\Omega _{P/A} \\otimes _ P B_ g \\oplus B_ g \\text{d}x$, \n\n\n$\\mathop{N\\! L}\\nolimits (\\beta ) \\cong \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\oplus (B_ g \\xrightarrow {g} B_ g)$ \n\n\n\n   Hence the canonical map $\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits _{B_ g/A}$ is a homotopy equivalence. \n\n    \n","Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2.) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n","
  ((Cotangent.exact (localizationAway g (S := T)) P).splitSurjectiveEquiv
    (liftBaseChange_injective_of_isLocalizationAway _ P)
    ‚ü®cotangentCompAwaySec g P x, map_comp_cotangentCompAwaySec g P hx‚ü©).1
","noncomputable
def cotangentCompLocalizationAwayEquiv :
    ((localizationAway T g).comp P).toExtension.Cotangent ‚âÉ‚Çó[T]
      T ‚äó[S] P.toExtension.Cotangent √ó (Generators.localizationAway T g).toExtension.Cotangent ","Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4 [[\n  Lemma 10.134.4 (Jacobi-Zariski sequence).  Let $A \\to B \\to C$ be ring maps. Choose a presentation $\\alpha : A[x_ s, s \\in S] \\to B$ with kernel $I$. Choose a presentation $\\beta : B[y_ t, t \\in T] \\to C$ with kernel $J$. Let $\\gamma : A[x_ s, y_ t] \\to C$ be the induced presentation of $C$ with kernel $K$. Then we get a canonical commutative diagram \n  \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{A[x_ s]/A} \\otimes C \\ar[r] &  \\Omega _{A[x_ s, y_ t]/A} \\otimes C \\ar[r] &  \\Omega _{B[y_ t]/B} \\otimes C \\ar[r] &  0 \\\\  &  I/I^2 \\otimes C \\ar[r] \\ar[u] &  K/K^2 \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n   with exact rows. We get the following exact sequence of homology groups \n  \n  \\[  H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) \\to H_1(L_{C/A}) \\to H_1(L_{C/B}) \\to C \\otimes _ B \\Omega _{B/A} \\to \\Omega _{C/A} \\to \\Omega _{C/B} \\to 0  \\]\n\n   of $C$-modules extending the sequence of Lemma 10.131.7. If $\\text{Tor}_1^ B(\\Omega _{B/A}, C) = 0$ and $\\text{Tor}_2^ B(\\Omega _{B/A}, C) = 0$, then $H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) = H_1(L_{B/A}) \\otimes _ B C$. \n\n    \n]]. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2 [[\n  Lemma 10.69.2. Let $R$ be a ring. \n  \n  \nA regular sequence $f_1, \\ldots , f_ c$ of $R$ is a quasi-regular sequence. \n\n\nSuppose that $M$ is an $R$-module and that $f_1, \\ldots , f_ c$ is an $M$-regular sequence. Then $f_1, \\ldots , f_ c$ is an $M$-quasi-regular sequence. \n\n\n\n\n    \n]].) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n","Proof.\n      Since $P[x]/(I, fx - 1) = B[x]/(gx - 1) = B_ g$ we get the statement about $I$ and $fx - 1$ generating $J$. Consider the commutative diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{P/A} \\otimes B_ g \\ar[r] &  \\Omega _{P[x]/A} \\otimes B_ g \\ar[r] &  \\Omega _{B[x]/B} \\otimes B_ g \\ar[r] &  0 \\\\  &  (I/I^2)_ g \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  (gx - 1)/(gx - 1)^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n    \n       with exact rows of Lemma 10.134.4 [[\n  Lemma 10.134.4 (Jacobi-Zariski sequence).  Let $A \\to B \\to C$ be ring maps. Choose a presentation $\\alpha : A[x_ s, s \\in S] \\to B$ with kernel $I$. Choose a presentation $\\beta : B[y_ t, t \\in T] \\to C$ with kernel $J$. Let $\\gamma : A[x_ s, y_ t] \\to C$ be the induced presentation of $C$ with kernel $K$. Then we get a canonical commutative diagram \n  \n  \\[  \\xymatrix{ 0 \\ar[r] &  \\Omega _{A[x_ s]/A} \\otimes C \\ar[r] &  \\Omega _{A[x_ s, y_ t]/A} \\otimes C \\ar[r] &  \\Omega _{B[y_ t]/B} \\otimes C \\ar[r] &  0 \\\\  &  I/I^2 \\otimes C \\ar[r] \\ar[u] &  K/K^2 \\ar[r] \\ar[u] &  J/J^2 \\ar[r] \\ar[u] &  0 }  \\]\n\n   with exact rows. We get the following exact sequence of homology groups \n  \n  \\[  H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) \\to H_1(L_{C/A}) \\to H_1(L_{C/B}) \\to C \\otimes _ B \\Omega _{B/A} \\to \\Omega _{C/A} \\to \\Omega _{C/B} \\to 0  \\]\n\n   of $C$-modules extending the sequence of Lemma 10.131.7. If $\\text{Tor}_1^ B(\\Omega _{B/A}, C) = 0$ and $\\text{Tor}_2^ B(\\Omega _{B/A}, C) = 0$, then $H_1(\\mathop{N\\! L}\\nolimits _{B/A} \\otimes _ B C) = H_1(L_{B/A}) \\otimes _ B C$. \n\n    \n]]. The $B_ g$-module $\\Omega _{B[x]/B} \\otimes B_ g$ is free of rank $1$ on $\\text{d}x$. The element $\\text{d}x$ in the $B_ g$-module $\\Omega _{P[x]/A} \\otimes B_ g$ provides a splitting for the top row. The element $gx - 1 \\in (gx - 1)/(gx - 1)^2$ is mapped to $g\\text{d}x$ in $\\Omega _{B[x]/B} \\otimes B_ g$ and hence $(gx - 1)/(gx - 1)^2$ is free of rank $1$ over $B_ g$. (This can also be seen by arguing that $gx - 1$ is a nonzerodivisor in $B[x]$ because it is a polynomial with invertible constant term and any nonzerodivisor gives a quasi-regular sequence of length $1$ by Lemma 10.69.2 [[\n  Lemma 10.69.2. Let $R$ be a ring. \n  \n  \nA regular sequence $f_1, \\ldots , f_ c$ of $R$ is a quasi-regular sequence. \n\n\nSuppose that $M$ is an $R$-module and that $f_1, \\ldots , f_ c$ is an $M$-regular sequence. Then $f_1, \\ldots , f_ c$ is an $M$-quasi-regular sequence. \n\n\n\n\n    \n]].) \n    \n      Let us prove $(I/I^2)_ g \\to J/J^2$ injective. Consider the $P$-algebra map \n    \n      \n  \\[  \\pi : P[x] \\to (P/I^2)_ f = P_ f/I_ f^2  \\]\n\n    \n       sending $x$ to $1/f$. Since $J$ is generated by $I$ and $fx - 1$ we see that $\\pi (J) \\subset (I/I^2)_ f = (I/I^2)_ g$. Since this is an ideal of square zero we see that $\\pi (J^2) = 0$. If $a \\in I$ maps to an element of $J^2$ in $J$, then $\\pi (a) = 0$, which implies that $a$ maps to zero in $I_ f/I_ f^2$. This proves the desired injectivity. \n    \n      Thus we have a short exact sequence of two term complexes \n    \n      \n  \\[  0 \\to \\mathop{N\\! L}\\nolimits (\\alpha ) \\otimes _ B B_ g \\to \\mathop{N\\! L}\\nolimits (\\beta ) \\to (B_ g \\xrightarrow {g} B_ g) \\to 0  \\]\n\n    \n       Such a short exact sequence can always be split in the category of complexes. In our particular case we can take as splittings \n    \n      \n  \\[  J/J^2 = (I/I^2)_ g \\oplus B_ g (fx - 1)\\quad \\text{and}\\quad \\Omega _{P[x]/A} \\otimes B_ g = \\Omega _{P/A} \\otimes B_ g \\oplus B_ g (g^{-2}\\text{d}f + \\text{d}x)  \\]\n\n    \n       This works because $\\text{d}(fx - 1) = x\\text{d}f + f \\text{d}x = g(g^{-2}\\text{d}f + \\text{d}x)$ in $\\Omega _{P[x]/A} \\otimes B_ g$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean term applies `Cotangent.exact` for a localization-away situation and then uses `splitSurjectiveEquiv` together with an injectivity lemma (`liftBaseChange_injective_of_isLocalizationAway`) and an explicit splitting datum `‚ü®cotangentCompAwaySec ‚Ä¶, map_comp_cotangentCompAwaySec ‚Ä¶‚ü©`. This matches the informal proof‚Äôs core goal: after establishing injectivity of the left vertical map, one gets a short exact sequence of (two-term) complexes and then explicitly splits it by providing sections (using the element corresponding to `dx` / a chosen complement and checking the differential identity). Structurally, both proofs proceed by: (i) invoking an exactness result for the cotangent/Jacobi‚ÄìZariski-type sequence under localization, (ii) proving/using injectivity after base change, and (iii) constructing an explicit splitting and verifying a compatibility equation. The main mismatch is that the informal proof contains substantial additional ring-theoretic arguments (identifying generators of J, freeness of a rank-1 module, the explicit map œÄ and its use to prove injectivity, and the explicit decompositions), while the Lean proof packages these into named lemmas/definitions (`liftBaseChange_injective_of_isLocalizationAway`, `cotangentCompAwaySec`, and the `map_comp_‚Ä¶` verification) without reflecting those intermediate steps. So the Lean proof captures the same mathematical content but at a more abstract/condensed level.""}"
268,0564,"lemma Module.FinitePresentation.of_finite_of_finitePresentation
    [Module.Finite R S] [Algebra.FinitePresentation R S] :
    Module.FinitePresentation R S := by
  classical
  obtain ‚ü®R', _, _, _, _, _, f, hf‚ü© := Module.Finite.exists_free_surjective R S
  letI := f.toRingHom.toAlgebra
  have : IsScalarTower R R' S := .of_algebraMap_eq' f.comp_algebraMap.symm
  have : Module.FinitePresentation R R' :=
    Module.finitePresentation_of_projective R R'
  have : Module.FinitePresentation R' S :=
    Module.finitePresentation_of_surjective (Algebra.linearMap R' S) hf
      (Algebra.FinitePresentation.ker_fG_of_surjective f hf)
  exact .trans R S R'
",Formal Proof of Stacks Project Tag 0564,The case M = S,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Finiteness/ModuleFinitePresentation.lean#L80-L92,Q27041,,10.36.23,lemma,3.0,"['00GH', '00AO', '0ELQ']","\n  Lemma 10.36.23. Let $R \\to S$ be a finite and finitely presented ring map. Let $M$ be an $S$-module. Then $M$ is finitely presented as an $R$-module if and only if $M$ is finitely presented as an $S$-module. \n\n    \n      Proof.\n      One of the implications follows from Lemma 10.6.4. To see the other assume that $M$ is finitely presented as an $S$-module. Pick a presentation \n    \n      \n  \\[  S^{\\oplus m} \\longrightarrow S^{\\oplus n} \\longrightarrow M \\longrightarrow 0  \\]\n\n    \n       As $S$ is finite as an $R$-module, the kernel of $S^{\\oplus n} \\to M$ is a finite $R$-module. Thus from Lemma 10.5.3 we see that it suffices to prove that $S$ is finitely presented as an $R$-module. \n    \n      Pick $y_1, \\ldots , y_ n \\in S$ such that $y_1, \\ldots , y_ n$ generate $S$ as an $R$-module. By Lemma 10.36.2 each $y_ i$ is integral over $R$. Choose monic polynomials $P_ i(x) \\in R[x]$ with $P_ i(y_ i) = 0$. Consider the ring \n    \n      \n  \\[  S\' = R[x_1, \\ldots , x_ n]/(P_1(x_1), \\ldots , P_ n(x_ n))  \\]\n\n    \n       Then we see that $S$ is of finite presentation as an $S\'$-algebra by Lemma 10.6.2. Since $S\' \\to S$ is surjective, the kernel $J = \\mathop{\\mathrm{Ker}}(S\' \\to S)$ is finitely generated as an ideal by Lemma 10.6.3. Hence $J$ is a finite $S\'$-module (immediate from the definitions). Thus $S = \\mathop{\\mathrm{Coker}}(J \\to S\')$ is of finite presentation as an $S\'$-module by Lemma 10.5.3. Hence, arguing as in the first paragraph, it suffices to show that $S\'$ is of finite presentation as an $R$-module. Actually, $S\'$ is free as an $R$-module with basis the monomials $x_1^{e_1} \\ldots x_ n^{e_ n}$ for $0 \\leq e_ i < \\deg (P_ i)$. Namely, write $R \\to S\'$ as the composition \n    \n      \n  \\[  R \\to R[x_1]/(P_1(x_1)) \\to R[x_1, x_2]/(P_1(x_1), P_2(x_2)) \\to \\ldots \\to S\'  \\]\n\n    \n       This shows that the $i$th ring in this sequence is free as a module over the $(i - 1)$st one with basis $1, x_ i, \\ldots , x_ i^{\\deg (P_ i) - 1}$. The result follows easily from this by induction. Some details omitted. \n      $\\square$\n    \n",\n  Lemma 10.36.23. Let $R \\to S$ be a finite and finitely presented ring map. Let $M$ be an $S$-module. Then $M$ is finitely presented as an $R$-module if and only if $M$ is finitely presented as an $S$-module. \n\n    \n,"Proof.\n      One of the implications follows from Lemma 10.6.4. To see the other assume that $M$ is finitely presented as an $S$-module. Pick a presentation \n    \n      \n  \\[  S^{\\oplus m} \\longrightarrow S^{\\oplus n} \\longrightarrow M \\longrightarrow 0  \\]\n\n    \n       As $S$ is finite as an $R$-module, the kernel of $S^{\\oplus n} \\to M$ is a finite $R$-module. Thus from Lemma 10.5.3 we see that it suffices to prove that $S$ is finitely presented as an $R$-module. \n    \n      Pick $y_1, \\ldots , y_ n \\in S$ such that $y_1, \\ldots , y_ n$ generate $S$ as an $R$-module. By Lemma 10.36.2 each $y_ i$ is integral over $R$. Choose monic polynomials $P_ i(x) \\in R[x]$ with $P_ i(y_ i) = 0$. Consider the ring \n    \n      \n  \\[  S\' = R[x_1, \\ldots , x_ n]/(P_1(x_1), \\ldots , P_ n(x_ n))  \\]\n\n    \n       Then we see that $S$ is of finite presentation as an $S\'$-algebra by Lemma 10.6.2. Since $S\' \\to S$ is surjective, the kernel $J = \\mathop{\\mathrm{Ker}}(S\' \\to S)$ is finitely generated as an ideal by Lemma 10.6.3. Hence $J$ is a finite $S\'$-module (immediate from the definitions). Thus $S = \\mathop{\\mathrm{Coker}}(J \\to S\')$ is of finite presentation as an $S\'$-module by Lemma 10.5.3. Hence, arguing as in the first paragraph, it suffices to show that $S\'$ is of finite presentation as an $R$-module. Actually, $S\'$ is free as an $R$-module with basis the monomials $x_1^{e_1} \\ldots x_ n^{e_ n}$ for $0 \\leq e_ i < \\deg (P_ i)$. Namely, write $R \\to S\'$ as the composition \n    \n      \n  \\[  R \\to R[x_1]/(P_1(x_1)) \\to R[x_1, x_2]/(P_1(x_1), P_2(x_2)) \\to \\ldots \\to S\'  \\]\n\n    \n       This shows that the $i$th ring in this sequence is free as a module over the $(i - 1)$st one with basis $1, x_ i, \\ldots , x_ i^{\\deg (P_ i) - 1}$. The result follows easily from this by induction. Some details omitted. \n      $\\square$\n    \n"," by
  classical
  obtain ‚ü®R', _, _, _, _, _, f, hf‚ü© := Module.Finite.exists_free_surjective R S
  letI := f.toRingHom.toAlgebra
  have : IsScalarTower R R' S := .of_algebraMap_eq' f.comp_algebraMap.symm
  have : Module.FinitePresentation R R' :=
    Module.finitePresentation_of_projective R R'
  have : Module.FinitePresentation R' S :=
    Module.finitePresentation_of_surjective (Algebra.linearMap R' S) hf
      (Algebra.FinitePresentation.ker_fG_of_surjective f hf)
  exact .trans R S R'
","lemma Module.FinitePresentation.of_finite_of_finitePresentation
    [Module.Finite R S] [Algebra.FinitePresentation R S] :
    Module.FinitePresentation R S ","Proof.\n      One of the implications follows from Lemma 10.6.4 [[\n  Lemma 10.6.4. Let $R \\to S$ be a ring map. Let $M$ be an $S$-module. Assume $R \\to S$ is of finite type and $M$ is finitely presented as an $R$-module. Then $M$ is finitely presented as an $S$-module. \n\n    \n]]. To see the other assume that $M$ is finitely presented as an $S$-module. Pick a presentation \n    \n      \n  \\[  S^{\\oplus m} \\longrightarrow S^{\\oplus n} \\longrightarrow M \\longrightarrow 0  \\]\n\n    \n       As $S$ is finite as an $R$-module, the kernel of $S^{\\oplus n} \\to M$ is a finite $R$-module. Thus from Lemma 10.5.3 [[\n  Lemma 10.5.3. Let $R$ be a ring. Let \n  \n  \\[  0 \\to M_1 \\to M_2 \\to M_3 \\to 0  \\]\n\n   be a short exact sequence of $R$-modules. \n  \n  \nIf $M_1$ and $M_3$ are finite $R$-modules, then $M_2$ is a finite $R$-module. \n\n\nIf $M_1$ and $M_3$ are finitely presented $R$-modules, then $M_2$ is a finitely presented $R$-module. \n\n\nIf $M_2$ is a finite $R$-module, then $M_3$ is a finite $R$-module. \n\n\nIf $M_2$ is a finitely presented $R$-module and $M_1$ is a finite $R$-module, then $M_3$ is a finitely presented $R$-module. \n\n\nIf $M_3$ is a finitely presented $R$-module and $M_2$ is a finite $R$-module, then $M_1$ is a finite $R$-module. \n\n\n\n\n    \n]] we see that it suffices to prove that $S$ is finitely presented as an $R$-module. \n    \n      Pick $y_1, \\ldots , y_ n \\in S$ such that $y_1, \\ldots , y_ n$ generate $S$ as an $R$-module. By Lemma 10.36.2 [[\n  Lemma 10.36.2. Let $\\varphi : R \\to S$ be a ring map. Let $y \\in S$. If there exists a finite $R$-submodule $M$ of $S$ such that $1 \\in M$ and $yM \\subset M$, then $y$ is integral over $R$. \n\n    \n]] each $y_ i$ is integral over $R$. Choose monic polynomials $P_ i(x) \\in R[x]$ with $P_ i(y_ i) = 0$. Consider the ring \n    \n      \n  \\[  S\' = R[x_1, \\ldots , x_ n]/(P_1(x_1), \\ldots , P_ n(x_ n))  \\]\n\n    \n       Then we see that $S$ is of finite presentation as an $S\'$-algebra by Lemma 10.6.2 [[\n  Lemma 10.6.2. The notions finite type and finite presentation have the following permanence properties. \n  \n  \nA composition of ring maps of finite type is of finite type. \n\n\nA composition of ring maps of finite presentation is of finite presentation. \n\n\nGiven $R \\to S\' \\to S$ with $R \\to S$ of finite type, then $S\' \\to S$ is of finite type. \n\n\nGiven $R \\to S\' \\to S$, with $R \\to S$ of finite presentation, and $R \\to S\'$ of finite type, then $S\' \\to S$ is of finite presentation. \n\n\n\n\n    \n]]. Since $S\' \\to S$ is surjective, the kernel $J = \\mathop{\\mathrm{Ker}}(S\' \\to S)$ is finitely generated as an ideal by Lemma 10.6.3 [[\n  Lemma 10.6.3. Let $R \\to S$ be a ring map of finite presentation. For any surjection $\\alpha : R[x_1, \\ldots , x_ n] \\to S$ the kernel of $\\alpha $ is a finitely generated ideal in $R[x_1, \\ldots , x_ n]$. \n\n    \n]]. Hence $J$ is a finite $S\'$-module (immediate from the definitions). Thus $S = \\mathop{\\mathrm{Coker}}(J \\to S\')$ is of finite presentation as an $S\'$-module by Lemma 10.5.3 [[\n  Lemma 10.5.3. Let $R$ be a ring. Let \n  \n  \\[  0 \\to M_1 \\to M_2 \\to M_3 \\to 0  \\]\n\n   be a short exact sequence of $R$-modules. \n  \n  \nIf $M_1$ and $M_3$ are finite $R$-modules, then $M_2$ is a finite $R$-module. \n\n\nIf $M_1$ and $M_3$ are finitely presented $R$-modules, then $M_2$ is a finitely presented $R$-module. \n\n\nIf $M_2$ is a finite $R$-module, then $M_3$ is a finite $R$-module. \n\n\nIf $M_2$ is a finitely presented $R$-module and $M_1$ is a finite $R$-module, then $M_3$ is a finitely presented $R$-module. \n\n\nIf $M_3$ is a finitely presented $R$-module and $M_2$ is a finite $R$-module, then $M_1$ is a finite $R$-module. \n\n\n\n\n    \n]]. Hence, arguing as in the first paragraph, it suffices to show that $S\'$ is of finite presentation as an $R$-module. Actually, $S\'$ is free as an $R$-module with basis the monomials $x_1^{e_1} \\ldots x_ n^{e_ n}$ for $0 \\leq e_ i < \\deg (P_ i)$. Namely, write $R \\to S\'$ as the composition \n    \n      \n  \\[  R \\to R[x_1]/(P_1(x_1)) \\to R[x_1, x_2]/(P_1(x_1), P_2(x_2)) \\to \\ldots \\to S\'  \\]\n\n    \n       This shows that the $i$th ring in this sequence is free as a module over the $(i - 1)$st one with basis $1, x_ i, \\ldots , x_ i^{\\deg (P_ i) - 1}$. The result follows easily from this by induction. Some details omitted. \n      $\\square$\n    \n","Proof.\n      One of the implications follows from Lemma 10.6.4 [[\n  Lemma 10.6.4. Let $R \\to S$ be a ring map. Let $M$ be an $S$-module. Assume $R \\to S$ is of finite type and $M$ is finitely presented as an $R$-module. Then $M$ is finitely presented as an $S$-module. \n\n    \n]]. To see the other assume that $M$ is finitely presented as an $S$-module. Pick a presentation \n    \n      \n  \\[  S^{\\oplus m} \\longrightarrow S^{\\oplus n} \\longrightarrow M \\longrightarrow 0  \\]\n\n    \n       As $S$ is finite as an $R$-module, the kernel of $S^{\\oplus n} \\to M$ is a finite $R$-module. Thus from Lemma 10.5.3 [[\n  Lemma 10.5.3. Let $R$ be a ring. Let \n  \n  \\[  0 \\to M_1 \\to M_2 \\to M_3 \\to 0  \\]\n\n   be a short exact sequence of $R$-modules. \n  \n  \nIf $M_1$ and $M_3$ are finite $R$-modules, then $M_2$ is a finite $R$-module. \n\n\nIf $M_1$ and $M_3$ are finitely presented $R$-modules, then $M_2$ is a finitely presented $R$-module. \n\n\nIf $M_2$ is a finite $R$-module, then $M_3$ is a finite $R$-module. \n\n\nIf $M_2$ is a finitely presented $R$-module and $M_1$ is a finite $R$-module, then $M_3$ is a finitely presented $R$-module. \n\n\nIf $M_3$ is a finitely presented $R$-module and $M_2$ is a finite $R$-module, then $M_1$ is a finite $R$-module. \n\n\n\n\n    \n]] we see that it suffices to prove that $S$ is finitely presented as an $R$-module. \n    \n      Pick $y_1, \\ldots , y_ n \\in S$ such that $y_1, \\ldots , y_ n$ generate $S$ as an $R$-module. By Lemma 10.36.2 [[\n  Lemma 10.36.2. Let $\\varphi : R \\to S$ be a ring map. Let $y \\in S$. If there exists a finite $R$-submodule $M$ of $S$ such that $1 \\in M$ and $yM \\subset M$, then $y$ is integral over $R$. \n\n    \n]] each $y_ i$ is integral over $R$. Choose monic polynomials $P_ i(x) \\in R[x]$ with $P_ i(y_ i) = 0$. Consider the ring \n    \n      \n  \\[  S\' = R[x_1, \\ldots , x_ n]/(P_1(x_1), \\ldots , P_ n(x_ n))  \\]\n\n    \n       Then we see that $S$ is of finite presentation as an $S\'$-algebra by Lemma 10.6.2 [[\n  Lemma 10.6.2. The notions finite type and finite presentation have the following permanence properties. \n  \n  \nA composition of ring maps of finite type is of finite type. \n\n\nA composition of ring maps of finite presentation is of finite presentation. \n\n\nGiven $R \\to S\' \\to S$ with $R \\to S$ of finite type, then $S\' \\to S$ is of finite type. \n\n\nGiven $R \\to S\' \\to S$, with $R \\to S$ of finite presentation, and $R \\to S\'$ of finite type, then $S\' \\to S$ is of finite presentation. \n\n\n\n\n    \n]]. Since $S\' \\to S$ is surjective, the kernel $J = \\mathop{\\mathrm{Ker}}(S\' \\to S)$ is finitely generated as an ideal by Lemma 10.6.3 [[\n  Lemma 10.6.3. Let $R \\to S$ be a ring map of finite presentation. For any surjection $\\alpha : R[x_1, \\ldots , x_ n] \\to S$ the kernel of $\\alpha $ is a finitely generated ideal in $R[x_1, \\ldots , x_ n]$. \n\n    \n]]. Hence $J$ is a finite $S\'$-module (immediate from the definitions). Thus $S = \\mathop{\\mathrm{Coker}}(J \\to S\')$ is of finite presentation as an $S\'$-module by Lemma 10.5.3 [[\n  Lemma 10.5.3. Let $R$ be a ring. Let \n  \n  \\[  0 \\to M_1 \\to M_2 \\to M_3 \\to 0  \\]\n\n   be a short exact sequence of $R$-modules. \n  \n  \nIf $M_1$ and $M_3$ are finite $R$-modules, then $M_2$ is a finite $R$-module. \n\n\nIf $M_1$ and $M_3$ are finitely presented $R$-modules, then $M_2$ is a finitely presented $R$-module. \n\n\nIf $M_2$ is a finite $R$-module, then $M_3$ is a finite $R$-module. \n\n\nIf $M_2$ is a finitely presented $R$-module and $M_1$ is a finite $R$-module, then $M_3$ is a finitely presented $R$-module. \n\n\nIf $M_3$ is a finitely presented $R$-module and $M_2$ is a finite $R$-module, then $M_1$ is a finite $R$-module. \n\n\n\n\n    \n]]. Hence, arguing as in the first paragraph, it suffices to show that $S\'$ is of finite presentation as an $R$-module. Actually, $S\'$ is free as an $R$-module with basis the monomials $x_1^{e_1} \\ldots x_ n^{e_ n}$ for $0 \\leq e_ i < \\deg (P_ i)$. Namely, write $R \\to S\'$ as the composition \n    \n      \n  \\[  R \\to R[x_1]/(P_1(x_1)) \\to R[x_1, x_2]/(P_1(x_1), P_2(x_2)) \\to \\ldots \\to S\'  \\]\n\n    \n       This shows that the $i$th ring in this sequence is free as a module over the $(i - 1)$st one with basis $1, x_ i, \\ldots , x_ i^{\\deg (P_ i) - 1}$. The result follows easily from this by induction. Some details omitted. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: The case M = S","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is about proving a finite-presentation statement for the algebra S over R in the special case M = S, by exhibiting an intermediate algebra R' that is free (hence projective) over R and surjects onto S, then using finite-presentation results for (1) R ‚Üí R' (projective/free implies finitely presented as an R-module) and (2) R' ‚Üí S (surjective map from a finitely presented algebra gives finite presentation), and finally composing via a transitivity lemma `.trans R S R'`. This matches the informal proof only at a high level: both introduce an auxiliary algebra mapping surjectively to S and reduce to showing finite presentation via a free construction.\n\nStructurally, however, the informal argument is much more specific: it constructs S' = R[x_1,‚Ä¶,x_n]/(P_i) using integrality of module generators, then argues about finite generation of the kernel ideal and uses exact-sequence lemmas to deduce finite presentation. The Lean proof instead uses the library lemma `Module.Finite.exists_free_surjective` to obtain a free algebra R' with a surjection to S, bypassing the integrality/polynomial quotient construction and the kernel/ideal finite generation steps. Thus the overall strategy (free surjection + surjectivity implies finite presentation + transitivity) corresponds, but many key intermediate steps in the informal proof are not reflected, and the Lean proof relies on different lemmas than those cited informally.""}"
269,00DV,"theorem exists_sub_one_mem_and_smul_eq_zero_of_fg_of_le_smul {R : Type*} [CommRing R] {M : Type*}
    [AddCommGroup M] [Module R M] (I : Ideal R) (N : Submodule R M) (hn : N.FG) (hin : N ‚â§ I ‚Ä¢ N) :
    ‚àÉ r : R, r - 1 ‚àà I ‚àß ‚àÄ n ‚àà N, r ‚Ä¢ n = (0 : M) := by
  rw [fg_def] at hn
  rcases hn with ‚ü®s, hfs, hs‚ü©
  have H : ‚àÉ r : R, r - 1 ‚àà I ‚àß N ‚â§ (I ‚Ä¢ span R s).comap (LinearMap.lsmul R M r) ‚àß s ‚äÜ N := by
    refine ‚ü®1, ?_, ?_, ?_‚ü©
    ¬∑ rw [sub_self]
      exact I.zero_mem
    ¬∑ rw [hs]
      intro n hn
      rw [mem_comap]
      change (1 : R) ‚Ä¢ n ‚àà I ‚Ä¢ N
      rw [one_smul]
      exact hin hn
    ¬∑ rw [‚Üê span_le, hs]
  clear hin hs
  induction s, hfs using Set.Finite.induction_on with
  | empty =>
    rcases H with ‚ü®r, hr1, hrn, _‚ü©
    refine ‚ü®r, hr1, fun n hn => ?_‚ü©
    specialize hrn hn
    rwa [mem_comap, span_empty, smul_bot, mem_bot] at hrn
  | @insert i s _ _ ih =>
  apply ih
  rcases H with ‚ü®r, hr1, hrn, hs‚ü©
  rw [‚Üê Set.singleton_union, span_union, smul_sup] at hrn
  rw [Set.insert_subset_iff] at hs
  have : ‚àÉ c : R, c - 1 ‚àà I ‚àß c ‚Ä¢ i ‚àà I ‚Ä¢ span R s := by
    specialize hrn hs.1
    rw [mem_comap, mem_sup] at hrn
    rcases hrn with ‚ü®y, hy, z, hz, hyz‚ü©
    dsimp at hyz
    rw [mem_smul_span_singleton] at hy
    rcases hy with ‚ü®c, hci, rfl‚ü©
    use r - c
    constructor
    ¬∑ rw [sub_right_comm]
      exact I.sub_mem hr1 hci
    ¬∑ rw [sub_smul, ‚Üê hyz, add_sub_cancel_left]
      exact hz
  rcases this with ‚ü®c, hc1, hci‚ü©
  refine ‚ü®c * r, ?_, ?_, hs.2‚ü©
  ¬∑ simpa only [mul_sub, mul_one, sub_add_sub_cancel] using I.add_mem (I.mul_mem_left c hr1) hc1
  ¬∑ intro n hn
    specialize hrn hn
    rw [mem_comap, mem_sup] at hrn
    rcases hrn with ‚ü®y, hy, z, hz, hyz‚ü©
    dsimp at hyz
    rw [mem_smul_span_singleton] at hy
    rcases hy with ‚ü®d, _, rfl‚ü©
    simp only [mem_comap, LinearMap.lsmul_apply]
    rw [mul_smul, ‚Üê hyz, smul_add, smul_smul, mul_comm, mul_smul]
    exact add_mem (smul_mem _ _ hci) (smul_mem _ _ hz)
",Formal Proof of Stacks Project Tag 00DV,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Finiteness/Nakayama.lean#L28-L81,Q27041,Nakayama's lemma,10.20.1,lemma,3.0,"['07RC', '00AO', '0ELQ']","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n"," by
  rw [fg_def] at hn
  rcases hn with ‚ü®s, hfs, hs‚ü©
  have H : ‚àÉ r : R, r - 1 ‚àà I ‚àß N ‚â§ (I ‚Ä¢ span R s).comap (LinearMap.lsmul R M r) ‚àß s ‚äÜ N := by
    refine ‚ü®1, ?_, ?_, ?_‚ü©
    ¬∑ rw [sub_self]
      exact I.zero_mem
    ¬∑ rw [hs]
      intro n hn
      rw [mem_comap]
      change (1 : R) ‚Ä¢ n ‚àà I ‚Ä¢ N
      rw [one_smul]
      exact hin hn
    ¬∑ rw [‚Üê span_le, hs]
  clear hin hs
  induction s, hfs using Set.Finite.induction_on with
  | empty =>
    rcases H with ‚ü®r, hr1, hrn, _‚ü©
    refine ‚ü®r, hr1, fun n hn => ?_‚ü©
    specialize hrn hn
    rwa [mem_comap, span_empty, smul_bot, mem_bot] at hrn
  | @insert i s _ _ ih =>
  apply ih
  rcases H with ‚ü®r, hr1, hrn, hs‚ü©
  rw [‚Üê Set.singleton_union, span_union, smul_sup] at hrn
  rw [Set.insert_subset_iff] at hs
  have : ‚àÉ c : R, c - 1 ‚àà I ‚àß c ‚Ä¢ i ‚àà I ‚Ä¢ span R s := by
    specialize hrn hs.1
    rw [mem_comap, mem_sup] at hrn
    rcases hrn with ‚ü®y, hy, z, hz, hyz‚ü©
    dsimp at hyz
    rw [mem_smul_span_singleton] at hy
    rcases hy with ‚ü®c, hci, rfl‚ü©
    use r - c
    constructor
    ¬∑ rw [sub_right_comm]
      exact I.sub_mem hr1 hci
    ¬∑ rw [sub_smul, ‚Üê hyz, add_sub_cancel_left]
      exact hz
  rcases this with ‚ü®c, hc1, hci‚ü©
  refine ‚ü®c * r, ?_, ?_, hs.2‚ü©
  ¬∑ simpa only [mul_sub, mul_one, sub_add_sub_cancel] using I.add_mem (I.mul_mem_left c hr1) hc1
  ¬∑ intro n hn
    specialize hrn hn
    rw [mem_comap, mem_sup] at hrn
    rcases hrn with ‚ü®y, hy, z, hz, hyz‚ü©
    dsimp at hyz
    rw [mem_smul_span_singleton] at hy
    rcases hy with ‚ü®d, _, rfl‚ü©
    simp only [mem_comap, LinearMap.lsmul_apply]
    rw [mul_smul, ‚Üê hyz, smul_add, smul_smul, mul_comm, mul_smul]
    exact add_mem (smul_mem _ _ hci) (smul_mem _ _ hz)
","theorem exists_sub_one_mem_and_smul_eq_zero_of_fg_of_le_smul {R : Type*} [CommRing R] {M : Type*}
    [AddCommGroup M] [Module R M] (I : Ideal R) (N : Submodule R M) (hn : N.FG) (hin : N ‚â§ I ‚Ä¢ N) :
    ‚àÉ r : R, r - 1 ‚àà I ‚àß ‚àÄ n ‚àà N, r ‚Ä¢ n = (0 : M) ","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","Proof.\n      Proof of (1). Choose generators $y_1, \\ldots , y_ m$ of $M$ over $R$. For each $i$ we can write $y_ i = \\sum z_{ij} y_ j$ with $z_{ij} \\in I$ (since $M = IM$). In other words $\\sum _ j (\\delta _{ij} - z_{ij})y_ j = 0$. Let $f$ be the determinant of the $m \\times m$ matrix $A = (\\delta _{ij} - z_{ij})$. Note that $f \\in 1 + I$ (since the matrix $A$ is entrywise congruent to the $m \\times m$ identity matrix modulo $I$). By Lemma 10.15.5 [[\n  Lemma 10.15.5. Let $R$ be a ring. Let $n \\geq m$. Let $A$ be an $n \\times m$ matrix with coefficients in $R$. Let $J \\subset R$ be the ideal generated by the $m \\times m$ minors of $A$. \n  \n  \nFor any $f \\in J$ there exists a $m \\times n$ matrix $B$ such that $BA = f 1_{m \\times m}$. \n\n\nIf $f \\in R$ and $BA = f 1_{m \\times m}$ for some $m \\times n$ matrix $B$, then $f^ m \\in J$. \n\n\n\n\n    \n]] (1), there exists an $m \\times m$ matrix $B$ such that $BA = f 1_{m \\times m}$. Writing out we see that $\\sum _{i} b_{hi} a_{ij} = f \\delta _{hj}$ for all $h$ and $j$; hence, $\\sum _{i, j} b_{hi} a_{ij} y_ j = \\sum _{j} f \\delta _{hj} y_ j = f y_ h$ for every $h$. In other words, $0 = f y_ h$ for every $h$ (since each $i$ satisfies $\\sum _ j a_{ij} y_ j = 0$). This implies that $f$ annihilates $M$. \n    \n      By Lemma 10.19.1 [[\n  Lemma 10.19.1. Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $I \\subset R$ be an ideal. The following are equivalent \n  \n  \n$I \\subset \\text{rad}(R)$, and \n\n\nevery element of $1 + I$ is a unit in $R$. \n\n\n\n   In this case every element of $R$ which maps to a unit of $R/I$ is a unit. \n\n    \n]] an element of $1 + \\text{rad}(R)$ is invertible element of $R$. Hence we see that (1) implies (2). We obtain (3) by applying (1) to $M/N$ which is finite as $N\'$ is finite. We obtain (4) by applying (2) to $M/N$ which is finite as $N\'$ is finite. We obtain (5) by applying (3) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (6) by applying (4) to $M$ and the submodules $\\mathop{\\mathrm{Im}}(N \\to M)$ and $M$. We obtain (7) by applying (5) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. We obtain (8) by applying (6) to the map $R^{\\oplus n} \\to M$, $(a_1, \\ldots , a_ n) \\mapsto a_1x_1 + \\ldots + a_ nx_ n$. \n    \n      Part (9) holds because if $M = IM$ then $M = I^ nM$ for all $n \\geq 0$ and $I$ being nilpotent means $I^ n = 0$ for some $n \\gg 0$. Parts (10), (11), and (12) follow from (9) by the arguments used above. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof is a determinant/matrix argument (choose generators of a finite module, build a matrix congruent to identity mod I, take its determinant f ‚àà 1+I, use a minors lemma to get BA = f¬∑Id, deduce f annihilates M, then use a Jacobson-radical/unit lemma to conclude). The Lean proof instead performs a finite-set induction on a generating set s and constructs an element r with r‚àí1‚ààI together with containment conditions involving comaps of scalar multiplication maps and submodule spans; it repeatedly decomposes membership in a sup and manipulates smul/span relations. Structurally, the informal proof is linear-algebraic (matrices, determinants, minors), while the formal proof is combinatorial/inductive on finite sets with submodule lattice operations, and it does not reflect the determinant/unit steps. There is at best a loose thematic connection (producing an element congruent to 1 mod I with an annihilation/containment property), but key ingredients of the informal proof (determinant, Lemma 10.15.5, Jacobson radical invertibility) are absent, and the formal proof introduces substantial machinery not present in the informal argument.""}"
270,00HK,"theorem tfae_equational_criterion : List.TFAE [
    Flat R M,
    ‚àÄ I : Ideal R, Function.Injective (rTensor M I.subtype),
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí R} {x : Fin l ‚Üí M}, ‚àë i, f i ‚äó‚Çú x i = (0 : R ‚äó[R] M) ‚Üí
      VanishesTrivially R f x,
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí R} {x : Fin l ‚Üí M}, ‚àë i, f i ‚Ä¢ x i = 0 ‚Üí IsTrivialRelation f x,
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí‚ÇÄ R} {x : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M}, x f = 0 ‚Üí
      ‚àÉ (k : ‚Ñï) (a : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
        x = y ‚àò‚Çó a ‚àß a f = 0] := by
  classical
  tfae_have 1 ‚Üî 2 := iff_rTensor_injective'
  tfae_have 3 ‚Üî 2 := forall_vanishesTrivially_iff_forall_rTensor_injective R
  tfae_have 3 ‚Üî 4 := by
    simp [(TensorProduct.lid R M).injective.eq_iff.symm, isTrivialRelation_iff_vanishesTrivially]
  tfae_have 4 ‚Üí 5
  | h‚ÇÑ, l, f, x, hfx => by
    let f' : Fin l ‚Üí R := f
    let x' : Fin l ‚Üí M := fun i ‚Ü¶ x (single i 1)
    have := calc
      ‚àë i, f' i ‚Ä¢ x' i
      _ = ‚àë i, f i ‚Ä¢ x (single i 1) := rfl
      _ = x (‚àë i, f i ‚Ä¢ Finsupp.single i 1) := by simp_rw [map_sum, map_smul]
      _ = x f := by simp_rw [smul_single, smul_eq_mul, mul_one, univ_sum_single]
      _ = 0 := hfx
    obtain ‚ü®k, a', y', ‚ü®ha'y', ha'‚ü©‚ü© := h‚ÇÑ this
    use k
    use Finsupp.linearCombination R (fun i ‚Ü¶ equivFunOnFinite.symm (a' i))
    use Finsupp.linearCombination R y'
    constructor
    ¬∑ apply Finsupp.basisSingleOne.ext
      intro i
      simpa [linearCombination_apply, sum_fintype, Finsupp.single_apply] using ha'y' i
    ¬∑ ext j
      simp only [linearCombination_apply, zero_smul, implies_true, sum_fintype, finset_sum_apply]
      exact ha' j
  tfae_have 5 ‚Üí 4
  | h‚ÇÖ, l, f, x, hfx => by
    let f' : Fin l ‚Üí‚ÇÄ R := equivFunOnFinite.symm f
    let x' : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M := Finsupp.linearCombination R x
    have : x' f' = 0 := by simpa [x', f', linearCombination_apply, sum_fintype] using hfx
    obtain ‚ü®k, a', y', ha'y', ha'‚ü© := h‚ÇÖ this
    refine ‚ü®k, fun i ‚Ü¶ a' (single i 1), fun j ‚Ü¶ y' (single j 1), fun i ‚Ü¶ ?_, fun j ‚Ü¶ ?_‚ü©
    ¬∑ simpa [x', ‚Üê map_smul, ‚Üê map_sum, smul_single] using
        LinearMap.congr_fun ha'y' (Finsupp.single i 1)
    ¬∑ simp_rw [‚Üê smul_eq_mul, ‚Üê Finsupp.smul_apply, ‚Üê map_smul, ‚Üê finset_sum_apply, ‚Üê map_sum,
        smul_single, smul_eq_mul, mul_one,
        ‚Üê (fun _ ‚Ü¶ equivFunOnFinite_symm_apply_apply _ _ : ‚àÄ x, f' x = f x), univ_sum_single]
      simpa using DFunLike.congr_fun ha' j
  tfae_finish
",Formal Proof of Stacks Project Tag 00HK, stacks 058D (1) ‚Üî (2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L117-L165,Q27041,Equational criterion of flatness,10.39.11,lemma,3.0,"['00H9', '00AO', '0ELQ']","\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n      Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n",\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n,"Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n"," by
  classical
  tfae_have 1 ‚Üî 2 := iff_rTensor_injective'
  tfae_have 3 ‚Üî 2 := forall_vanishesTrivially_iff_forall_rTensor_injective R
  tfae_have 3 ‚Üî 4 := by
    simp [(TensorProduct.lid R M).injective.eq_iff.symm, isTrivialRelation_iff_vanishesTrivially]
  tfae_have 4 ‚Üí 5
  | h‚ÇÑ, l, f, x, hfx => by
    let f' : Fin l ‚Üí R := f
    let x' : Fin l ‚Üí M := fun i ‚Ü¶ x (single i 1)
    have := calc
      ‚àë i, f' i ‚Ä¢ x' i
      _ = ‚àë i, f i ‚Ä¢ x (single i 1) := rfl
      _ = x (‚àë i, f i ‚Ä¢ Finsupp.single i 1) := by simp_rw [map_sum, map_smul]
      _ = x f := by simp_rw [smul_single, smul_eq_mul, mul_one, univ_sum_single]
      _ = 0 := hfx
    obtain ‚ü®k, a', y', ‚ü®ha'y', ha'‚ü©‚ü© := h‚ÇÑ this
    use k
    use Finsupp.linearCombination R (fun i ‚Ü¶ equivFunOnFinite.symm (a' i))
    use Finsupp.linearCombination R y'
    constructor
    ¬∑ apply Finsupp.basisSingleOne.ext
      intro i
      simpa [linearCombination_apply, sum_fintype, Finsupp.single_apply] using ha'y' i
    ¬∑ ext j
      simp only [linearCombination_apply, zero_smul, implies_true, sum_fintype, finset_sum_apply]
      exact ha' j
  tfae_have 5 ‚Üí 4
  | h‚ÇÖ, l, f, x, hfx => by
    let f' : Fin l ‚Üí‚ÇÄ R := equivFunOnFinite.symm f
    let x' : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M := Finsupp.linearCombination R x
    have : x' f' = 0 := by simpa [x', f', linearCombination_apply, sum_fintype] using hfx
    obtain ‚ü®k, a', y', ha'y', ha'‚ü© := h‚ÇÖ this
    refine ‚ü®k, fun i ‚Ü¶ a' (single i 1), fun j ‚Ü¶ y' (single j 1), fun i ‚Ü¶ ?_, fun j ‚Ü¶ ?_‚ü©
    ¬∑ simpa [x', ‚Üê map_smul, ‚Üê map_sum, smul_single] using
        LinearMap.congr_fun ha'y' (Finsupp.single i 1)
    ¬∑ simp_rw [‚Üê smul_eq_mul, ‚Üê Finsupp.smul_apply, ‚Üê map_smul, ‚Üê finset_sum_apply, ‚Üê map_sum,
        smul_single, smul_eq_mul, mul_one,
        ‚Üê (fun _ ‚Ü¶ equivFunOnFinite_symm_apply_apply _ _ : ‚àÄ x, f' x = f x), univ_sum_single]
      simpa using DFunLike.congr_fun ha' j
  tfae_finish
","theorem tfae_equational_criterion : List.TFAE [
    Flat R M,
    ‚àÄ I : Ideal R, Function.Injective (rTensor M I.subtype),
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí R} {x : Fin l ‚Üí M}, ‚àë i, f i ‚äó‚Çú x i = (0 : R ‚äó[R] M) ‚Üí
      VanishesTrivially R f x,
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí R} {x : Fin l ‚Üí M}, ‚àë i, f i ‚Ä¢ x i = 0 ‚Üí IsTrivialRelation f x,
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí‚ÇÄ R} {x : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M}, x f = 0 ‚Üí
      ‚àÉ (k : ‚Ñï) (a : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
        x = y ‚àò‚Çó a ‚àß a f = 0] ","Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n","Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: stacks 058D (1) ‚Üî (2)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is establishing a chain of equivalences in a TFAE package, matching the Stacks 058D theme: flatness/injectivity of tensoring with ideals (or related maps) ‚Üî ‚Äúevery relation is trivial‚Äù. In particular, the key informal directions are ‚Äúflat ‚áí relations trivial‚Äù and ‚Äúrelations trivial ‚áí injectivity for finitely generated ideals‚Äù, and the Lean proof contains the corresponding implications as the steps `4 ‚Üí 5` and `5 ‚Üí 4`, converting between a vanishing linear combination `‚àë f_i ‚Ä¢ x_i = 0` and an element of a tensor product / linear combination map, and extracting witnesses `k, a', y'` that encode the trivialization of the relation.\n\nStructurally, however, the Lean proof is more algebraically packaged: it works with `Finsupp`/`Fin l` encodings, `linearCombination`, and equivalences like `equivFunOnFinite`, and it uses general lemmas (`iff_rTensor_injective'`, `forall_vanishesTrivially_iff_forall_rTensor_injective`) to connect the numbered statements, rather than explicitly constructing the short exact sequence `0 ‚Üí K ‚Üí R^n ‚Üí I ‚Üí 0` and arguing via kernels as in the informal proof. The informal proof‚Äôs kernel/K‚äóM lifting argument is not mirrored explicitly; instead Lean uses pre-proved equivalences and then proves the relation-triviality ‚Üî injectivity steps by rewriting sums and applying extensionality.\n\nCompleteness is good for the core equivalence about relations and tensor-injectivity, but the explicit ideal/kernel narrative is absent (replaced by library lemmas), so it‚Äôs not a perfect structural match. There is no obvious extraneous content beyond the necessary Lean encodings.""}"
271,00HK,"theorem of_forall_isTrivialRelation (hfx : ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí R} {x : Fin l ‚Üí M},
    ‚àë i, f i ‚Ä¢ x i = 0 ‚Üí IsTrivialRelation f x) : Flat R M :=
  iff_forall_isTrivialRelation.mpr hfx
",Formal Proof of Stacks Project Tag 00HK,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L187-L189,Q27041,Equational criterion of flatness,10.39.11,lemma,3.0,"['00H9', '00AO', '0ELQ']","\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n      Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n",\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n,"Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n","
  iff_forall_isTrivialRelation.mpr hfx
","theorem of_forall_isTrivialRelation (hfx : ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí R} {x : Fin l ‚Üí M},
    ‚àë i, f i ‚Ä¢ x i = 0 ‚Üí IsTrivialRelation f x) : Flat R M ","Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n","Proof.\n      Assume $M$ is flat and let $\\sum f_ i x_ i = 0$ be a relation in $M$. Let $I = (f_1, \\ldots , f_ n)$, and let $K = \\mathop{\\mathrm{Ker}}(R^ n \\to I, (a_1, \\ldots , a_ n) \\mapsto \\sum _ i a_ i f_ i)$. So we have the short exact sequence $0 \\to K \\to R^ n \\to I \\to 0$. Then $\\sum f_ i \\otimes x_ i$ is an element of $I \\otimes _ R M$ which maps to zero in $R \\otimes _ R M = M$. By flatness $\\sum f_ i \\otimes x_ i$ is zero in $I \\otimes _ R M$. Thus there exists an element of $K \\otimes _ R M$ mapping to $\\sum e_ i \\otimes x_ i \\in R^ n \\otimes _ R M$ where $e_ i$ is the $i$th basis element of $R^ n$. Write this element as $\\sum k_ j \\otimes y_ j$ and then write the image of $k_ j$ in $R^ n$ as $\\sum a_{ij} e_ i$ to get the result. \n    \n      Assume every relation is trivial, let $I$ be a finitely generated ideal, and let $x = \\sum f_ i \\otimes x_ i$ be an element of $I \\otimes _ R M$ mapping to zero in $R \\otimes _ R M = M$. This just means exactly that $\\sum f_ i x_ i$ is a relation in $M$. And the fact that it is trivial implies easily that $x$ is zero, because \n    \n      \n  \\[  x = \\sum f_ i \\otimes x_ i = \\sum f_ i \\otimes \\left(\\sum a_{ij}y_ j\\right) = \\sum \\left(\\sum f_ i a_{ij}\\right) \\otimes y_ j = 0  \\]\n\n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof establishes an equivalence between flatness of M and the condition that every finite relation \\(\\sum f_i x_i = 0\\) is trivial, via tensoring a short exact sequence and using kernels, then conversely using triviality to prove injectivity for \\(I \\otimes_R M \\to M\\). The formal proof is just a one-line application of an existing lemma `iff_forall_isTrivialRelation.mpr hfx`, which corresponds only to the direction ‚Äú(forall relations trivial) ‚Üí (flatness)‚Äù (since `.mpr` applies the reverse implication of an `iff`). Structurally, it does not mirror the constructive steps (short exact sequence, kernel element, rewriting) and omits the forward direction (flat ‚Üí trivial relations) that is present in the informal proof. Thus it captures at best one half of the informal argument, with no internal correspondence to the detailed reasoning.""}"
272,058D,"theorem iff_forall_exists_factorization : Flat R M ‚Üî
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí‚ÇÄ R} {x : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M}, x f = 0 ‚Üí
      ‚àÉ (k : ‚Ñï) (a : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
        x = y ‚àò‚Çó a ‚àß a f = 0 := (tfae_equational_criterion R M).out 0 4
",Formal Proof of Stacks Project Tag 058D,(1) ‚Üî (2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L198-L201,Q27041,,10.81.1,lemma,3.0,"['058C', '00AO', '0ELQ']","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n      Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n"," (tfae_equational_criterion R M).out 0 4
","theorem iff_forall_exists_factorization : Flat R M ‚Üî
    ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí‚ÇÄ R} {x : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M}, x f = 0 ‚Üí
      ‚àÉ (k : ‚Ñï) (a : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
        x = y ‚àò‚Çó a ‚àß a f = 0 ","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) ‚Üî (2)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean term `(tfae_equational_criterion R M).out 0 4` extracts an implication/equivalence between items 0 and 4 in a `tfae` package for the equational criterion, i.e. it proves a specific link between two numbered conditions in the standard list. The informal proof discusses a chain of equivalences/implications among conditions (1)‚Äì(4), and the user comment clarifies that the relevant correspondence is (1) ‚Üî (2). Structurally, however, the Lean proof only provides one extracted step (from index 0 to 4) rather than the full chain (1)‚Üî(2), (2)‚Üí(3), (3)‚Üí(4), (4)‚Üí(2) described informally. So it matches the idea of using the prepackaged `tfae_equational_criterion` result, but it does not mirror the informal proof‚Äôs multi-step structure and may not target exactly the (1)‚Üî(2) link unless the indexing aligns accordingly. Hence good but not perfect alignment.""}"
273,058D,"theorem of_forall_exists_factorization
    (h : ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí‚ÇÄ R} {x : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M}, x f = 0 ‚Üí
      ‚àÉ (k : ‚Ñï) (a : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
      x = y ‚àò‚Çó a ‚àß a f = 0) : Flat R M := iff_forall_exists_factorization.mpr h
",Formal Proof of Stacks Project Tag 058D,(2) ‚Üí (1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L210-L213,Q27041,,10.81.1,lemma,3.0,"['058C', '00AO', '0ELQ']","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n      Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n"," iff_forall_exists_factorization.mpr h
","theorem of_forall_exists_factorization
    (h : ‚àÄ {l : ‚Ñï} {f : Fin l ‚Üí‚ÇÄ R} {x : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M}, x f = 0 ‚Üí
      ‚àÉ (k : ‚Ñï) (a : (Fin l ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
      x = y ‚àò‚Çó a ‚àß a f = 0) : Flat R M ","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2) ‚Üí (1)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term `iff_forall_exists_factorization.mpr h` proves one direction of an iff (it uses `.mpr`, i.e. the implication from the right-hand side to the left-hand side) from a hypothesis `h`. Given the user‚Äôs note that the intended relation is (2) ‚Üí (1), this could match that specific direction if `iff_forall_exists_factorization` is exactly the equivalence between statements (1) and (2) and `h` is statement (2). However, the informal proof discusses a whole chain of equivalences/implications (1)‚Üî(2), (2)‚Üí(3), (3)‚Üí(4), (4)‚Üí(2), with explicit constructions and an induction step. Structurally, the Lean proof is a single-line application of a prepackaged lemma and does not reflect the multi-step argument or cover (2)‚Üí(3) etc. Completeness is therefore low relative to the informal proof, though it may correctly capture just the (2)‚Üí(1) sub-implication. Precision is fine (no extra content), but overall alignment to the full informal proof is weak.""}"
274,058D,"theorem exists_factorization_of_apply_eq_zero_of_free [Flat R M] {N : Type*} [AddCommGroup N]
    [Module R N] [Free R N] [Module.Finite R N] {f : N} {x : N ‚Üí‚Çó[R] M} (h : x f = 0) :
    ‚àÉ (k : ‚Ñï) (a : N ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M), x = y ‚àò‚Çó a ‚àß a f = 0 :=
  have e := ((Module.Free.chooseBasis R N).reindex (Fintype.equivFin _)).repr.symm
  have ‚ü®k, a, y, hya, haf‚ü© := iff_forall_exists_factorization.mp ‚ÄπFlat R M‚Ä∫
    (f := e.symm f) (x := x ‚àò‚Çó e) (by simpa using h)
  ‚ü®k, a ‚àò‚Çó e.symm, y, by rwa [‚Üê comp_assoc, LinearEquiv.eq_comp_toLinearMap_symm], haf‚ü©
",Formal Proof of Stacks Project Tag 058D,(1) ‚Üí (2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L222-L228,Q27041,,10.81.1,lemma,3.0,"['058C', '00AO', '0ELQ']","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n      Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","
  have e := ((Module.Free.chooseBasis R N).reindex (Fintype.equivFin _)).repr.symm
  have ‚ü®k, a, y, hya, haf‚ü© := iff_forall_exists_factorization.mp ‚ÄπFlat R M‚Ä∫
    (f := e.symm f) (x := x ‚àò‚Çó e) (by simpa using h)
  ‚ü®k, a ‚àò‚Çó e.symm, y, by rwa [‚Üê comp_assoc, LinearEquiv.eq_comp_toLinearMap_symm], haf‚ü©
","theorem exists_factorization_of_apply_eq_zero_of_free [Flat R M] {N : Type*} [AddCommGroup N]
    [Module R N] [Free R N] [Module.Finite R N] {f : N} {x : N ‚Üí‚Çó[R] M} (h : x f = 0) :
    ‚àÉ (k : ‚Ñï) (a : N ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M), x = y ‚àò‚Çó a ‚àß a f = 0 ","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) ‚Üí (2)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean snippet is using the flatness factorization criterion (`iff_forall_exists_factorization.mp ‚ÄπFlat R M‚Ä∫`) to produce data ‚ü®k, a, y, ‚Ä¶‚ü© from a hypothesis `h`, which matches the informal step (1) ‚Üí (2) described as a reformulation of the equational criterion for flatness. The proof also performs a basis/reindexing change via `Module.Free.chooseBasis` and `Fintype.equivFin`, translating the problem to a standard finite free module and then back, which is consistent with reformulating the criterion.\nStructurally, the Lean proof is a direct extraction of the factorization witnesses from the flatness equivalence and then a transport along a linear equivalence `e`, whereas the informal proof just says ‚Äúis just a reformulation‚Äù without detailing the basis change. This extra reindexing/`repr.symm` machinery is not mentioned informally but serves the same reformulation purpose. The Lean snippet does not address the later informal implications (2)‚Üí(3)‚Üí(4)‚Üí(2), but the user note indicates we should compare only (1)‚Üí(2), for which the alignment is strong.""}"
275,058D,"theorem exists_factorization_of_comp_eq_zero_of_free [Flat R M] {K N : Type*} [AddCommGroup K]
    [Module R K] [Module.Finite R K] [AddCommGroup N] [Module R N] [Free R N] [Module.Finite R N]
    {f : K ‚Üí‚Çó[R] N} {x : N ‚Üí‚Çó[R] M} (h : x ‚àò‚Çó f = 0) :
    ‚àÉ (k : ‚Ñï) (a : N ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
      x = y ‚àò‚Çó a ‚àß a ‚àò‚Çó f = 0 :=
  have e := ((Module.Free.chooseBasis R N).reindex (Fintype.equivFin _)).repr.symm
  have ‚ü®k, a, y, hya, haf‚ü© := exists_factorization_of_comp_eq_zero_of_free_aux
    (f := e.symm ‚àò‚Çó f) (x := x ‚àò‚Çó e.toLinearMap) (by ext; simpa [comp_assoc] using congr($h _))
  ‚ü®k, a ‚àò‚Çó e.symm, y, by rwa [‚Üê comp_assoc, LinearEquiv.eq_comp_toLinearMap_symm], by
    rwa [comp_assoc]‚ü©
",Formal Proof of Stacks Project Tag 058D,(1) ‚Üí (4),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L258-L267,Q27041,,10.81.1,lemma,3.0,"['058C', '00AO', '0ELQ']","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n      Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","
  have e := ((Module.Free.chooseBasis R N).reindex (Fintype.equivFin _)).repr.symm
  have ‚ü®k, a, y, hya, haf‚ü© := exists_factorization_of_comp_eq_zero_of_free_aux
    (f := e.symm ‚àò‚Çó f) (x := x ‚àò‚Çó e.toLinearMap) (by ext; simpa [comp_assoc] using congr($h _))
  ‚ü®k, a ‚àò‚Çó e.symm, y, by rwa [‚Üê comp_assoc, LinearEquiv.eq_comp_toLinearMap_symm], by
    rwa [comp_assoc]‚ü©
","theorem exists_factorization_of_comp_eq_zero_of_free [Flat R M] {K N : Type*} [AddCommGroup K]
    [Module R K] [Module.Finite R K] [AddCommGroup N] [Module R N] [Free R N] [Module.Finite R N]
    {f : K ‚Üí‚Çó[R] N} {x : N ‚Üí‚Çó[R] M} (h : x ‚àò‚Çó f = 0) :
    ‚àÉ (k : ‚Ñï) (a : N ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (y : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M),
      x = y ‚àò‚Çó a ‚àß a ‚àò‚Çó f = 0 ","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n","Proof.\n      That (1) is equivalent to (2) is just a reformulation of the equational criterion for flatness1. To show (2) implies (3), let $g: R^ m \\to M$ be the map such that $f$ factors as $f = g \\circ h$. By (2) find $h\'\': R^ m \\to R^{m\'}$ such that $h\'\'$ kills $h(x)$ and $g: R^ m \\to M$ factors through $h\'\'$. Then taking $h\' = h\'\' \\circ h$ works. (3) implies (4) by induction on the number of generators of $N \\subset \\mathop{\\mathrm{Ker}}(f)$ in (4). Clearly (4) implies (2). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) ‚Üí (4)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean snippet is proving an existence/factorization statement in the special case where the relevant module is free: it picks a basis (`Module.Free.chooseBasis`), reindexes it to `Fin`, converts the problem via the associated linear equivalence `e`, applies an auxiliary lemma `exists_factorization_of_comp_eq_zero_of_free_aux` to get data `‚ü®k,a,y,hya,haf‚ü©`, and then transports the resulting factorization back along `e` (composing with `e.symm`, rewriting with `comp_assoc`, etc.). This matches a *technical reduction to the free case* and a construction of a factorization witnessing a kernel/zero-composition condition.\n\nStructurally, however, the informal proof for (1)‚Üí(4) (as indicated) proceeds via a chain of implications (equational criterion for flatness, then (2)‚Üí(3) by choosing g and h'', then (3)‚Üí(4) by induction on generators, etc.). None of that multi-step structure (equivalence (1)‚Üî(2), induction for (3)‚Üí(4), etc.) appears in the Lean code; instead it is a localized step using a free-module auxiliary lemma and basis change. So while the Lean code likely implements a sub-lemma used inside the overall (1)‚Üí(4) argument, it does not correspond closely to the informal proof‚Äôs stated structure and intermediate maps (g, h, h'', induction).""}"
276,058E,"theorem exists_factorization_of_isFinitelyPresented [Flat R M] {P : Type*} [AddCommGroup P]
    [Module R P] [FinitePresentation R P] (h‚ÇÅ : P ‚Üí‚Çó[R] M) :
      ‚àÉ (k : ‚Ñï) (h‚ÇÇ : P ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (h‚ÇÉ : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M), h‚ÇÅ = h‚ÇÉ ‚àò‚Çó h‚ÇÇ := by
  have ‚ü®_, K, œï, hK‚ü© := FinitePresentation.exists_fin R P
  haveI : Module.Finite R K := .of_fg hK
  have : (h‚ÇÅ ‚àò‚Çó œï.symm ‚àò‚Çó K.mkQ) ‚àò‚Çó K.subtype = 0 := by
    simp_rw [comp_assoc, (LinearMap.exact_subtype_mkQ K).linearMap_comp_eq_zero, comp_zero]
  obtain ‚ü®k, a, y, hay, ha‚ü© := exists_factorization_of_comp_eq_zero_of_free this
  use k, (K.liftQ a (by rwa [‚Üê range_le_ker_iff, Submodule.range_subtype] at ha)) ‚àò‚Çó œï, y
  apply (cancel_right œï.symm.surjective).mp
  apply (cancel_right K.mkQ_surjective).mp
  simpa [comp_assoc]
",Formal Proof of Stacks Project Tag 058E,only if,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L272-L283,Q27041,,10.81.2,lemma,3.0,"['058C', '00AO', '0ELQ']","\n  Lemma 10.81.2. Let $M$ be an $R$-module. Then $M$ is flat if and only if the following condition holds: if $P$ is a finitely presented $R$-module and $f: P \\to M$ a module map, then there is a free finite $R$-module $F$ and module maps $h: P \\to F$ and $g: F \\to M$ such that $f = g \\circ h$. \n\n    \n      Proof.\n      This is just a reformulation of condition (4) from Lemma 10.81.1. \n      $\\square$\n    \n","\n  Lemma 10.81.2. Let $M$ be an $R$-module. Then $M$ is flat if and only if the following condition holds: if $P$ is a finitely presented $R$-module and $f: P \\to M$ a module map, then there is a free finite $R$-module $F$ and module maps $h: P \\to F$ and $g: F \\to M$ such that $f = g \\circ h$. \n\n    \n",Proof.\n      This is just a reformulation of condition (4) from Lemma 10.81.1. \n      $\\square$\n    \n," by
  have ‚ü®_, K, œï, hK‚ü© := FinitePresentation.exists_fin R P
  haveI : Module.Finite R K := .of_fg hK
  have : (h‚ÇÅ ‚àò‚Çó œï.symm ‚àò‚Çó K.mkQ) ‚àò‚Çó K.subtype = 0 := by
    simp_rw [comp_assoc, (LinearMap.exact_subtype_mkQ K).linearMap_comp_eq_zero, comp_zero]
  obtain ‚ü®k, a, y, hay, ha‚ü© := exists_factorization_of_comp_eq_zero_of_free this
  use k, (K.liftQ a (by rwa [‚Üê range_le_ker_iff, Submodule.range_subtype] at ha)) ‚àò‚Çó œï, y
  apply (cancel_right œï.symm.surjective).mp
  apply (cancel_right K.mkQ_surjective).mp
  simpa [comp_assoc]
","theorem exists_factorization_of_isFinitelyPresented [Flat R M] {P : Type*} [AddCommGroup P]
    [Module R P] [FinitePresentation R P] (h‚ÇÅ : P ‚Üí‚Çó[R] M) :
      ‚àÉ (k : ‚Ñï) (h‚ÇÇ : P ‚Üí‚Çó[R] (Fin k ‚Üí‚ÇÄ R)) (h‚ÇÉ : (Fin k ‚Üí‚ÇÄ R) ‚Üí‚Çó[R] M), h‚ÇÅ = h‚ÇÉ ‚àò‚Çó h‚ÇÇ ","Proof.\n      This is just a reformulation of condition (4) from Lemma 10.81.1 [[\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      This is just a reformulation of condition (4) from Lemma 10.81.1 [[\n  Lemma 10.81.1. Let $M$ be an $R$-module. The following are equivalent: \n  \n  \n$M$ is flat. \n\n\nIf $f: R^ n \\to M$ is a module map and $x \\in \\mathop{\\mathrm{Ker}}(f)$, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $x \\in \\mathop{\\mathrm{Ker}}(h)$. \n\n\nSuppose $f: R^ n \\to M$ is a module map, $N \\subset \\mathop{\\mathrm{Ker}}(f)$ any submodule, and $h: R^ n \\to R^{m}$ a map such that $N \\subset \\mathop{\\mathrm{Ker}}(h)$ and $f$ factors through $h$. Then given any $x \\in \\mathop{\\mathrm{Ker}}(f)$ we can find a map $h\': R^ n \\to R^{m\'}$ such that $N + Rx \\subset \\mathop{\\mathrm{Ker}}(h\')$ and $f$ factors through $h\'$. \n\n\nIf $f: R^ n \\to M$ is a module map and $N \\subset \\mathop{\\mathrm{Ker}}(f)$ is a finitely generated submodule, then there are module maps $h: R^ n \\to R^ m$ and $g: R^ m \\to M$ such that $f = g \\circ h$ and $N \\subset \\mathop{\\mathrm{Ker}}(h)$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: only if","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is implementing the same factorization-through-a-free-module condition that appears as condition (4) in the cited lemma: it constructs a factorization of a map through some free module (via `exists_factorization_of_comp_eq_zero_of_free`) under a kernel/comp-equals-zero hypothesis, producing the data `k, a, y` and then packaging it into the required maps using `K.liftQ` and the presentation isomorphism `œï`. Structurally, it follows the informal ‚Äúreformulation‚Äù idea: reduce to a finite presentation (`FinitePresentation.exists_fin`), use exactness of `subtype`/`mkQ` to get a composition equal to zero, then apply an existence lemma to obtain the factorization and finally cancel surjections to conclude the desired equality. However, the informal proof as written is purely a citation (‚Äújust a reformulation of condition (4)‚Äù) and does not mention the intermediate steps (finite presentation, exactness, cancellations), so the correspondence is not perfect in structure and relies on additional Lean-specific machinery not reflected in the informal text.""}"
277,00NX,"theorem projective_of_finitePresentation [Flat R M] [FinitePresentation R M] : Projective R M :=
  have ‚ü®_, f, g, eq‚ü© := exists_factorization_of_isFinitelyPresented (.id (R := R) (M := M))
  .of_split f g eq.symm
",Formal Proof of Stacks Project Tag 00NX,(1) ‚Üí (2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/EquationalCriterion.lean#L286-L288,Q27041,,10.78.2,lemma,3.0,"['00NV', '00AO', '0ELQ']","\n  Lemma 10.78.2. Let $R$ be a ring and let $M$ be an $R$-module. The following are equivalent \n  \n  \n$M$ is finitely presented and $R$-flat, \n\n\n$M$ is finite projective, \n\n\n$M$ is a direct summand of a finite free $R$-module, \n\n\n$M$ is finitely presented and for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$ the localization $M_{\\mathfrak p}$ is free, \n\n\n$M$ is finitely presented and for all maximal ideals $\\mathfrak m \\subset R$ the localization $M_{\\mathfrak m}$ is free, \n\n\n$M$ is finite and locally free, \n\n\n$M$ is finite locally free, and \n\n\n$M$ is finite, for every prime $\\mathfrak p$ the module $M_{\\mathfrak p}$ is free, and the function \n\n\n  \\[  \\rho _ M : \\mathop{\\mathrm{Spec}}(R) \\to \\mathbf{Z}, \\quad \\mathfrak p \\longmapsto \\dim _{\\kappa (\\mathfrak p)} M \\otimes _ R \\kappa (\\mathfrak p)  \\]\n\n\n is locally constant in the Zariski topology. \n\n\n\n\n    \n      Proof.\n      First suppose $M$ is finite projective, i.e., (2) holds. Take a surjection $R^ n \\to M$ and let $K$ be the kernel. Since $M$ is projective, $0 \\to K \\to R^ n \\to M \\to 0$ splits. Hence (2) $\\Rightarrow $ (3). The implication (3) $\\Rightarrow $ (2) follows from the fact that a direct summand of a projective is projective, see Lemma 10.77.2. \n    \n      Assume (3), so we can write $K \\oplus M \\cong R^{\\oplus n}$. So $K$ is a direct summand of $R^ n$ and thus finitely generated. This shows $M = R^{\\oplus n}/K$ is finitely presented. In other words, (3) $\\Rightarrow $ (1). \n    \n      Assume $M$ is finitely presented and flat, i.e., (1) holds. We will prove that (7) holds. Pick any prime $\\mathfrak p$ and $x_1, \\ldots , x_ r \\in M$ which map to a basis of $M \\otimes _ R \\kappa (\\mathfrak p)$. By Nakayama\'s lemma (in the form of Lemma 10.20.2) these elements generate $M_ g$ for some $g \\in R$, $g \\not\\in \\mathfrak p$. The corresponding surjection $\\varphi : R_ g^{\\oplus r} \\to M_ g$ has the following two properties: (a) $\\mathop{\\mathrm{Ker}}(\\varphi )$ is a finite $R_ g$-module (see Lemma 10.5.3) and (b) $\\mathop{\\mathrm{Ker}}(\\varphi ) \\otimes \\kappa (\\mathfrak p) = 0$ by flatness of $M_ g$ over $R_ g$ (see Lemma 10.39.12). Hence by Nakayama\'s lemma again there exists a $g\' \\in R_ g$ such that $\\mathop{\\mathrm{Ker}}(\\varphi )_{g\'} = 0$. In other words, $M_{gg\'}$ is free. \n    \n      A finite locally free module is a finite module, see Lemma 10.23.2, hence (7) $\\Rightarrow $ (6). It is clear that (6) $\\Rightarrow $ (7) and that (7) $\\Rightarrow $ (8). \n    \n      A finite locally free module is a finitely presented module, see Lemma 10.23.2, hence (7) $\\Rightarrow $ (4). Of course (4) implies (5). Since we may check flatness locally (see Lemma 10.39.18) we conclude that (5) implies (1). At this point we have \n    \n      \n  \\[  \\xymatrix{ (2) \\ar@{<=>}[r] &  (3) \\ar@{=>}[r] &  (1) \\ar@{=>}[r] &  (7) \\ar@{<=>}[r] \\ar@{=>}[rd] \\ar@{=>}[d] &  (6) \\\\  &  &  (5) \\ar@{=>}[u] &  (4) \\ar@{=>}[l] &  (8) }  \\]\n\n    \n      Suppose that $M$ satisfies (1), (4), (5), (6), and (7). We will prove that (3) holds. It suffices to show that $M$ is projective. We have to show that $\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, -)$ is exact. Let $0 \\to N\'\' \\to N \\to N\'\\to 0$ be a short exact sequence of $R$-module. We have to show that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact. As $M$ is finite locally free there exist a covering $\\mathop{\\mathrm{Spec}}(R) = \\bigcup D(f_ i)$ such that $M_{f_ i}$ is finite free. By Lemma 10.10.2 we see that \n    \n      \n  \\[  0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\')_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N)_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\')_{f_ i} \\to 0  \\]\n\n    \n       is equal to $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'\'_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'_{f_ i}) \\to 0$ which is exact as $M_{f_ i}$ is free and as the localization $0 \\to N\'\'_{f_ i} \\to N_{f_ i} \\to N\'_{f_ i} \\to 0$ is exact (as localization is exact). Whence we see that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact by Lemma 10.23.2. \n    \n      Finally, assume that (8) holds. Pick a maximal ideal $\\mathfrak m \\subset R$. Pick $x_1, \\ldots , x_ r \\in M$ which map to a $\\kappa (\\mathfrak m)$-basis of $M \\otimes _ R \\kappa (\\mathfrak m) = M/\\mathfrak mM$. In particular $\\rho _ M(\\mathfrak m) = r$. By Nakayama\'s Lemma 10.20.1 there exists an $f \\in R$, $f \\not\\in \\mathfrak m$ such that $x_1, \\ldots , x_ r$ generate $M_ f$ over $R_ f$. By the assumption that $\\rho _ M$ is locally constant there exists a $g \\in R$, $g \\not\\in \\mathfrak m$ such that $\\rho _ M$ is constant equal to $r$ on $D(g)$. We claim that \n    \n      \n  \\[  \\Psi : R_{fg}^{\\oplus r} \\longrightarrow M_{fg}, \\quad (a_1, \\ldots , a_ r) \\longmapsto \\sum a_ i x_ i  \\]\n\n    \n       is an isomorphism. This claim will show that $M$ is finite locally free, i.e., that (7) holds. To see the claim it suffices to show that the induced map on localizations $\\Psi _{\\mathfrak p} : R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p}$ is an isomorphism for all $\\mathfrak p \\in D(fg)$, see Lemma 10.23.1. By our choice of $f$ the map $\\Psi _{\\mathfrak p}$ is surjective. By assumption (8) we have $M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus \\rho _ M(\\mathfrak p)}$ and by our choice of $g$ we have $\\rho _ M(\\mathfrak p) = r$. Hence $\\Psi _{\\mathfrak p}$ determines a surjection $R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus r}$ whence is an isomorphism by Lemma 10.16.4. (Of course this last fact follows from a simple matrix argument also.) \n      $\\square$\n    \n","\n  Lemma 10.78.2. Let $R$ be a ring and let $M$ be an $R$-module. The following are equivalent \n  \n  \n$M$ is finitely presented and $R$-flat, \n\n\n$M$ is finite projective, \n\n\n$M$ is a direct summand of a finite free $R$-module, \n\n\n$M$ is finitely presented and for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$ the localization $M_{\\mathfrak p}$ is free, \n\n\n$M$ is finitely presented and for all maximal ideals $\\mathfrak m \\subset R$ the localization $M_{\\mathfrak m}$ is free, \n\n\n$M$ is finite and locally free, \n\n\n$M$ is finite locally free, and \n\n\n$M$ is finite, for every prime $\\mathfrak p$ the module $M_{\\mathfrak p}$ is free, and the function \n\n\n  \\[  \\rho _ M : \\mathop{\\mathrm{Spec}}(R) \\to \\mathbf{Z}, \\quad \\mathfrak p \\longmapsto \\dim _{\\kappa (\\mathfrak p)} M \\otimes _ R \\kappa (\\mathfrak p)  \\]\n\n\n is locally constant in the Zariski topology. \n\n\n\n\n    \n","Proof.\n      First suppose $M$ is finite projective, i.e., (2) holds. Take a surjection $R^ n \\to M$ and let $K$ be the kernel. Since $M$ is projective, $0 \\to K \\to R^ n \\to M \\to 0$ splits. Hence (2) $\\Rightarrow $ (3). The implication (3) $\\Rightarrow $ (2) follows from the fact that a direct summand of a projective is projective, see Lemma 10.77.2. \n    \n      Assume (3), so we can write $K \\oplus M \\cong R^{\\oplus n}$. So $K$ is a direct summand of $R^ n$ and thus finitely generated. This shows $M = R^{\\oplus n}/K$ is finitely presented. In other words, (3) $\\Rightarrow $ (1). \n    \n      Assume $M$ is finitely presented and flat, i.e., (1) holds. We will prove that (7) holds. Pick any prime $\\mathfrak p$ and $x_1, \\ldots , x_ r \\in M$ which map to a basis of $M \\otimes _ R \\kappa (\\mathfrak p)$. By Nakayama\'s lemma (in the form of Lemma 10.20.2) these elements generate $M_ g$ for some $g \\in R$, $g \\not\\in \\mathfrak p$. The corresponding surjection $\\varphi : R_ g^{\\oplus r} \\to M_ g$ has the following two properties: (a) $\\mathop{\\mathrm{Ker}}(\\varphi )$ is a finite $R_ g$-module (see Lemma 10.5.3) and (b) $\\mathop{\\mathrm{Ker}}(\\varphi ) \\otimes \\kappa (\\mathfrak p) = 0$ by flatness of $M_ g$ over $R_ g$ (see Lemma 10.39.12). Hence by Nakayama\'s lemma again there exists a $g\' \\in R_ g$ such that $\\mathop{\\mathrm{Ker}}(\\varphi )_{g\'} = 0$. In other words, $M_{gg\'}$ is free. \n    \n      A finite locally free module is a finite module, see Lemma 10.23.2, hence (7) $\\Rightarrow $ (6). It is clear that (6) $\\Rightarrow $ (7) and that (7) $\\Rightarrow $ (8). \n    \n      A finite locally free module is a finitely presented module, see Lemma 10.23.2, hence (7) $\\Rightarrow $ (4). Of course (4) implies (5). Since we may check flatness locally (see Lemma 10.39.18) we conclude that (5) implies (1). At this point we have \n    \n      \n  \\[  \\xymatrix{ (2) \\ar@{<=>}[r] &  (3) \\ar@{=>}[r] &  (1) \\ar@{=>}[r] &  (7) \\ar@{<=>}[r] \\ar@{=>}[rd] \\ar@{=>}[d] &  (6) \\\\  &  &  (5) \\ar@{=>}[u] &  (4) \\ar@{=>}[l] &  (8) }  \\]\n\n    \n      Suppose that $M$ satisfies (1), (4), (5), (6), and (7). We will prove that (3) holds. It suffices to show that $M$ is projective. We have to show that $\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, -)$ is exact. Let $0 \\to N\'\' \\to N \\to N\'\\to 0$ be a short exact sequence of $R$-module. We have to show that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact. As $M$ is finite locally free there exist a covering $\\mathop{\\mathrm{Spec}}(R) = \\bigcup D(f_ i)$ such that $M_{f_ i}$ is finite free. By Lemma 10.10.2 we see that \n    \n      \n  \\[  0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\')_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N)_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\')_{f_ i} \\to 0  \\]\n\n    \n       is equal to $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'\'_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'_{f_ i}) \\to 0$ which is exact as $M_{f_ i}$ is free and as the localization $0 \\to N\'\'_{f_ i} \\to N_{f_ i} \\to N\'_{f_ i} \\to 0$ is exact (as localization is exact). Whence we see that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact by Lemma 10.23.2. \n    \n      Finally, assume that (8) holds. Pick a maximal ideal $\\mathfrak m \\subset R$. Pick $x_1, \\ldots , x_ r \\in M$ which map to a $\\kappa (\\mathfrak m)$-basis of $M \\otimes _ R \\kappa (\\mathfrak m) = M/\\mathfrak mM$. In particular $\\rho _ M(\\mathfrak m) = r$. By Nakayama\'s Lemma 10.20.1 there exists an $f \\in R$, $f \\not\\in \\mathfrak m$ such that $x_1, \\ldots , x_ r$ generate $M_ f$ over $R_ f$. By the assumption that $\\rho _ M$ is locally constant there exists a $g \\in R$, $g \\not\\in \\mathfrak m$ such that $\\rho _ M$ is constant equal to $r$ on $D(g)$. We claim that \n    \n      \n  \\[  \\Psi : R_{fg}^{\\oplus r} \\longrightarrow M_{fg}, \\quad (a_1, \\ldots , a_ r) \\longmapsto \\sum a_ i x_ i  \\]\n\n    \n       is an isomorphism. This claim will show that $M$ is finite locally free, i.e., that (7) holds. To see the claim it suffices to show that the induced map on localizations $\\Psi _{\\mathfrak p} : R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p}$ is an isomorphism for all $\\mathfrak p \\in D(fg)$, see Lemma 10.23.1. By our choice of $f$ the map $\\Psi _{\\mathfrak p}$ is surjective. By assumption (8) we have $M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus \\rho _ M(\\mathfrak p)}$ and by our choice of $g$ we have $\\rho _ M(\\mathfrak p) = r$. Hence $\\Psi _{\\mathfrak p}$ determines a surjection $R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus r}$ whence is an isomorphism by Lemma 10.16.4. (Of course this last fact follows from a simple matrix argument also.) \n      $\\square$\n    \n","
  have ‚ü®_, f, g, eq‚ü© := exists_factorization_of_isFinitelyPresented (.id (R := R) (M := M))
  .of_split f g eq.symm
",theorem projective_of_finitePresentation [Flat R M] [FinitePresentation R M] : Projective R M ,"Proof.\n      First suppose $M$ is finite projective, i.e., (2) holds. Take a surjection $R^ n \\to M$ and let $K$ be the kernel. Since $M$ is projective, $0 \\to K \\to R^ n \\to M \\to 0$ splits. Hence (2) $\\Rightarrow $ (3). The implication (3) $\\Rightarrow $ (2) follows from the fact that a direct summand of a projective is projective, see Lemma 10.77.2 [[\n  Lemma 10.77.2. Let $R$ be a ring. Let $P$ be an $R$-module. The following are equivalent \n  \n  \n$P$ is projective, \n\n\n$P$ is a direct summand of a free $R$-module, and \n\n\n$\\mathop{\\mathrm{Ext}}\\nolimits ^1_ R(P, M) = 0$ for every $R$-module $M$. \n\n\n\n\n    \n]]. \n    \n      Assume (3), so we can write $K \\oplus M \\cong R^{\\oplus n}$. So $K$ is a direct summand of $R^ n$ and thus finitely generated. This shows $M = R^{\\oplus n}/K$ is finitely presented. In other words, (3) $\\Rightarrow $ (1). \n    \n      Assume $M$ is finitely presented and flat, i.e., (1) holds. We will prove that (7) holds. Pick any prime $\\mathfrak p$ and $x_1, \\ldots , x_ r \\in M$ which map to a basis of $M \\otimes _ R \\kappa (\\mathfrak p)$. By Nakayama\'s lemma (in the form of Lemma 10.20.2 [[\n  Lemma 10.20.2. Let $R$ be a ring, let $S \\subset R$ be a multiplicative subset, let $I \\subset R$ be an ideal, and let $M$ be a finite $R$-module. If $x_1, \\ldots , x_ r \\in M$ generate $S^{-1}(M/IM)$ as an $S^{-1}(R/I)$-module, then there exists an $f \\in S + I$ such that $x_1, \\ldots , x_ r$ generate $M_ f$ as an $R_ f$-module.1 \n\n    \n]]) these elements generate $M_ g$ for some $g \\in R$, $g \\not\\in \\mathfrak p$. The corresponding surjection $\\varphi : R_ g^{\\oplus r} \\to M_ g$ has the following two properties: (a) $\\mathop{\\mathrm{Ker}}(\\varphi )$ is a finite $R_ g$-module (see Lemma 10.5.3 [[\n  Lemma 10.5.3. Let $R$ be a ring. Let \n  \n  \\[  0 \\to M_1 \\to M_2 \\to M_3 \\to 0  \\]\n\n   be a short exact sequence of $R$-modules. \n  \n  \nIf $M_1$ and $M_3$ are finite $R$-modules, then $M_2$ is a finite $R$-module. \n\n\nIf $M_1$ and $M_3$ are finitely presented $R$-modules, then $M_2$ is a finitely presented $R$-module. \n\n\nIf $M_2$ is a finite $R$-module, then $M_3$ is a finite $R$-module. \n\n\nIf $M_2$ is a finitely presented $R$-module and $M_1$ is a finite $R$-module, then $M_3$ is a finitely presented $R$-module. \n\n\nIf $M_3$ is a finitely presented $R$-module and $M_2$ is a finite $R$-module, then $M_1$ is a finite $R$-module. \n\n\n\n\n    \n]]) and (b) $\\mathop{\\mathrm{Ker}}(\\varphi ) \\otimes \\kappa (\\mathfrak p) = 0$ by flatness of $M_ g$ over $R_ g$ (see Lemma 10.39.12 [[\n  Lemma 10.39.12. Suppose that $R$ is a ring, $0 \\to M\'\' \\to M\' \\to M \\to 0$ a short exact sequence, and $N$ an $R$-module. If $M$ is flat then $N \\otimes _ R M\'\' \\to N \\otimes _ R M\'$ is injective, i.e., the sequence \n  \n  \\[  0 \\to N \\otimes _ R M\'\' \\to N \\otimes _ R M\' \\to N \\otimes _ R M \\to 0  \\]\n\n   is a short exact sequence. \n\n    \n]]). Hence by Nakayama\'s lemma again there exists a $g\' \\in R_ g$ such that $\\mathop{\\mathrm{Ker}}(\\varphi )_{g\'} = 0$. In other words, $M_{gg\'}$ is free. \n    \n      A finite locally free module is a finite module, see Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]], hence (7) $\\Rightarrow $ (6). It is clear that (6) $\\Rightarrow $ (7) and that (7) $\\Rightarrow $ (8). \n    \n      A finite locally free module is a finitely presented module, see Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]], hence (7) $\\Rightarrow $ (4). Of course (4) implies (5). Since we may check flatness locally (see Lemma 10.39.18 [[\n  Lemma 10.39.18. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. \n  \n  \nThe localization $S^{-1}R$ is a flat $R$-algebra. \n\n\nIf $M$ is an $S^{-1}R$-module, then $M$ is a flat $R$-module if and only if $M$ is a flat $S^{-1}R$-module. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak p}$ is a flat $R_{\\mathfrak p}$-module for all primes $\\mathfrak p$ of $R$. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak m}$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n\nSuppose $R \\to A$ is a ring map, $M$ is an $A$-module, and $g_1, \\ldots , g_ m \\in A$ are elements generating the unit ideal of $A$. Then $M$ is flat over $R$ if and only if each localization $M_{g_ i}$ is flat over $R$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak q}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p$ the prime of $R$ lying under $\\mathfrak q$) for all primes $\\mathfrak q$ of $A$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p = R \\cap \\mathfrak m$) for all maximal ideals $\\mathfrak m$ of $A$. \n\n\n\n\n    \n]]) we conclude that (5) implies (1). At this point we have \n    \n      \n  \\[  \\xymatrix{ (2) \\ar@{<=>}[r] &  (3) \\ar@{=>}[r] &  (1) \\ar@{=>}[r] &  (7) \\ar@{<=>}[r] \\ar@{=>}[rd] \\ar@{=>}[d] &  (6) \\\\  &  &  (5) \\ar@{=>}[u] &  (4) \\ar@{=>}[l] &  (8) }  \\]\n\n    \n      Suppose that $M$ satisfies (1), (4), (5), (6), and (7). We will prove that (3) holds. It suffices to show that $M$ is projective. We have to show that $\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, -)$ is exact. Let $0 \\to N\'\' \\to N \\to N\'\\to 0$ be a short exact sequence of $R$-module. We have to show that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact. As $M$ is finite locally free there exist a covering $\\mathop{\\mathrm{Spec}}(R) = \\bigcup D(f_ i)$ such that $M_{f_ i}$ is finite free. By Lemma 10.10.2 [[\n  Lemma 10.10.2. Let $R$ be a ring. Let $M$ be a finitely presented $R$-module. Let $N$ be an $R$-module. \n  \n  \nFor $f \\in R$ we have $\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N)_ f = \\mathop{\\mathrm{Hom}}\\nolimits _{R_ f}(M_ f, N_ f) = \\mathop{\\mathrm{Hom}}\\nolimits _ R(M_ f, N_ f)$, \n\n\nfor a multiplicative subset $S$ of $R$ we have \n\n\n  \\[  S^{-1}\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) = \\mathop{\\mathrm{Hom}}\\nolimits _{S^{-1}R}(S^{-1}M, S^{-1}N) = \\mathop{\\mathrm{Hom}}\\nolimits _ R(S^{-1}M, S^{-1}N).  \\]\n\n\n\n\n    \n]] we see that \n    \n      \n  \\[  0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\')_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N)_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\')_{f_ i} \\to 0  \\]\n\n    \n       is equal to $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'\'_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'_{f_ i}) \\to 0$ which is exact as $M_{f_ i}$ is free and as the localization $0 \\to N\'\'_{f_ i} \\to N_{f_ i} \\to N\'_{f_ i} \\to 0$ is exact (as localization is exact). Whence we see that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact by Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]]. \n    \n      Finally, assume that (8) holds. Pick a maximal ideal $\\mathfrak m \\subset R$. Pick $x_1, \\ldots , x_ r \\in M$ which map to a $\\kappa (\\mathfrak m)$-basis of $M \\otimes _ R \\kappa (\\mathfrak m) = M/\\mathfrak mM$. In particular $\\rho _ M(\\mathfrak m) = r$. By Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]] there exists an $f \\in R$, $f \\not\\in \\mathfrak m$ such that $x_1, \\ldots , x_ r$ generate $M_ f$ over $R_ f$. By the assumption that $\\rho _ M$ is locally constant there exists a $g \\in R$, $g \\not\\in \\mathfrak m$ such that $\\rho _ M$ is constant equal to $r$ on $D(g)$. We claim that \n    \n      \n  \\[  \\Psi : R_{fg}^{\\oplus r} \\longrightarrow M_{fg}, \\quad (a_1, \\ldots , a_ r) \\longmapsto \\sum a_ i x_ i  \\]\n\n    \n       is an isomorphism. This claim will show that $M$ is finite locally free, i.e., that (7) holds. To see the claim it suffices to show that the induced map on localizations $\\Psi _{\\mathfrak p} : R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p}$ is an isomorphism for all $\\mathfrak p \\in D(fg)$, see Lemma 10.23.1 [[\n  Lemma 10.23.1. Let $R$ be a ring. \n  \n  \nFor an element $x$ of an $R$-module $M$ the following are equivalent \n\n\n  \n$x = 0$, \n\n\n$x$ maps to zero in $M_\\mathfrak p$ for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$x$ maps to zero in $M_{\\mathfrak m}$ for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\n In other words, the map $M \\to \\prod _{\\mathfrak m} M_{\\mathfrak m}$ is injective. \n\n\nGiven an $R$-module $M$ the following are equivalent \n\n\n  \n$M$ is zero, \n\n\n$M_{\\mathfrak p}$ is zero for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$M_{\\mathfrak m}$ is zero for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\nGiven a complex $M_1 \\to M_2 \\to M_3$ of $R$-modules the following are equivalent \n\n\n  \n$M_1 \\to M_2 \\to M_3$ is exact, \n\n\nfor every prime $\\mathfrak p$ of $R$ the localization $M_{1, \\mathfrak p} \\to M_{2, \\mathfrak p} \\to M_{3, \\mathfrak p}$ is exact, \n\n\nfor every maximal ideal $\\mathfrak m$ of $R$ the localization $M_{1, \\mathfrak m} \\to M_{2, \\mathfrak m} \\to M_{3, \\mathfrak m}$ is exact. \n\n\n\n\nGiven a map $f : M \\to M\'$ of $R$-modules the following are equivalent \n\n\n  \n$f$ is injective, \n\n\n$f_{\\mathfrak p} : M_\\mathfrak p \\to M\'_\\mathfrak p$ is injective for all primes $\\mathfrak p$ of $R$, \n\n\n$f_{\\mathfrak m} : M_\\mathfrak m \\to M\'_\\mathfrak m$ is injective for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\nGiven a map $f : M \\to M\'$ of $R$-modules the following are equivalent \n\n\n  \n$f$ is surjective, \n\n\n$f_{\\mathfrak p} : M_\\mathfrak p \\to M\'_\\mathfrak p$ is surjective for all primes $\\mathfrak p$ of $R$, \n\n\n$f_{\\mathfrak m} : M_\\mathfrak m \\to M\'_\\mathfrak m$ is surjective for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\nGiven a map $f : M \\to M\'$ of $R$-modules the following are equivalent \n\n\n  \n$f$ is bijective, \n\n\n$f_{\\mathfrak p} : M_\\mathfrak p \\to M\'_\\mathfrak p$ is bijective for all primes $\\mathfrak p$ of $R$, \n\n\n$f_{\\mathfrak m} : M_\\mathfrak m \\to M\'_\\mathfrak m$ is bijective for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\n\n\n    \n]]. By our choice of $f$ the map $\\Psi _{\\mathfrak p}$ is surjective. By assumption (8) we have $M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus \\rho _ M(\\mathfrak p)}$ and by our choice of $g$ we have $\\rho _ M(\\mathfrak p) = r$. Hence $\\Psi _{\\mathfrak p}$ determines a surjection $R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus r}$ whence is an isomorphism by Lemma 10.16.4 [[\n  Lemma 10.16.4. Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $\\varphi : M \\to M$ be a surjective $R$-module map. Then $\\varphi $ is an isomorphism. \n\n    \n      First proof.\n       Write $R\' = R[x]$ and think of $M$ as a finite $R\'$-module with $x$ acting via $\\varphi $. Set $I = (x) \\subset R\'$. By our assumption that $\\varphi $ is surjective we have $IM = M$. Hence we may apply Lemma 10.16.3 to $M$ as an $R\'$-module, the ideal $I$ and the endomorphism $\\text{id}_ M$. We conclude that $(1 + a_1 + \\ldots + a_ n)\\text{id}_ M = 0$ with $a_ j \\in I$. Write $a_ j = b_ j(x)x$ for some $b_ j(x) \\in R[x]$. Translating back into $\\varphi $ we see that $\\text{id}_ M = -(\\sum _{j = 1, \\ldots , n} b_ j(\\varphi )) \\varphi $, and hence $\\varphi $ is invertible. \n      $\\square$\n    \n\n    \n      Second proof.\n       We perform induction on the number of generators of $M$ over $R$. If $M$ is generated by one element, then $M \\cong R/I$ for some ideal $I \\subset R$. In this case we may replace $R$ by $R/I$ so that $M = R$. In this case $\\varphi : R \\to R$ is given by multiplication on $M$ by an element $r \\in R$. The surjectivity of $\\varphi $ forces $r$ invertible, since $\\varphi $ must hit $1$, which implies that $\\varphi $ is invertible. \n    \n      Now assume that we have proven the lemma in the case of modules generated by $n - 1$ elements, and are examining a module $M$ generated by $n$ elements. Let $A$ mean the ring $R[t]$, and regard the module $M$ as an $A$-module by letting $t$ act via $\\varphi $; since $M$ is finite over $R$, it is finite over $R[t]$ as well, and since we\'re trying to prove $\\varphi $ injective, a set-theoretic property, we might as well prove the endomorphism $t : M \\to M$ over $A$ injective. We have reduced our problem to the case our endomorphism is multiplication by an element of the ground ring. Let $M\' \\subset M$ denote the sub-$A$-module generated by the first $n - 1$ of the generators of $M$, and consider the diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  M\' \\ar[r]\\ar[d]^{\\varphi \\mid _{M\'}} &  M\\ar[d]^\\varphi \\ar[r] &  M/M\' \\ar[d]^{\\varphi \\bmod M\'} \\ar[r] &  0 \\\\  0 \\ar[r] &  M\' \\ar[r] &  M \\ar[r] &  M/M\' \\ar[r] &  0, }  \\]\n\n    \n       where the restriction of $\\varphi $ to $M\'$ and the map induced by $\\varphi $ on the quotient $M/M\'$ are well-defined since $\\varphi $ is multiplication by an element in the base, and $M\'$ and $M/M\'$ are $A$-modules in their own right. By the case $n = 1$ the map $M/M\' \\to M/M\'$ is an isomorphism. A diagram chase implies that $\\varphi |_{M\'}$ is surjective hence by induction $\\varphi |_{M\'}$ is an isomorphism. This forces the middle column to be an isomorphism by the snake lemma. \n      $\\square$\n    \n]]. (Of course this last fact follows from a simple matrix argument also.) \n      $\\square$\n    \n","Proof.\n      First suppose $M$ is finite projective, i.e., (2) holds. Take a surjection $R^ n \\to M$ and let $K$ be the kernel. Since $M$ is projective, $0 \\to K \\to R^ n \\to M \\to 0$ splits. Hence (2) $\\Rightarrow $ (3). The implication (3) $\\Rightarrow $ (2) follows from the fact that a direct summand of a projective is projective, see Lemma 10.77.2 [[\n  Lemma 10.77.2. Let $R$ be a ring. Let $P$ be an $R$-module. The following are equivalent \n  \n  \n$P$ is projective, \n\n\n$P$ is a direct summand of a free $R$-module, and \n\n\n$\\mathop{\\mathrm{Ext}}\\nolimits ^1_ R(P, M) = 0$ for every $R$-module $M$. \n\n\n\n\n    \n]]. \n    \n      Assume (3), so we can write $K \\oplus M \\cong R^{\\oplus n}$. So $K$ is a direct summand of $R^ n$ and thus finitely generated. This shows $M = R^{\\oplus n}/K$ is finitely presented. In other words, (3) $\\Rightarrow $ (1). \n    \n      Assume $M$ is finitely presented and flat, i.e., (1) holds. We will prove that (7) holds. Pick any prime $\\mathfrak p$ and $x_1, \\ldots , x_ r \\in M$ which map to a basis of $M \\otimes _ R \\kappa (\\mathfrak p)$. By Nakayama\'s lemma (in the form of Lemma 10.20.2 [[\n  Lemma 10.20.2. Let $R$ be a ring, let $S \\subset R$ be a multiplicative subset, let $I \\subset R$ be an ideal, and let $M$ be a finite $R$-module. If $x_1, \\ldots , x_ r \\in M$ generate $S^{-1}(M/IM)$ as an $S^{-1}(R/I)$-module, then there exists an $f \\in S + I$ such that $x_1, \\ldots , x_ r$ generate $M_ f$ as an $R_ f$-module.1 \n\n    \n]]) these elements generate $M_ g$ for some $g \\in R$, $g \\not\\in \\mathfrak p$. The corresponding surjection $\\varphi : R_ g^{\\oplus r} \\to M_ g$ has the following two properties: (a) $\\mathop{\\mathrm{Ker}}(\\varphi )$ is a finite $R_ g$-module (see Lemma 10.5.3 [[\n  Lemma 10.5.3. Let $R$ be a ring. Let \n  \n  \\[  0 \\to M_1 \\to M_2 \\to M_3 \\to 0  \\]\n\n   be a short exact sequence of $R$-modules. \n  \n  \nIf $M_1$ and $M_3$ are finite $R$-modules, then $M_2$ is a finite $R$-module. \n\n\nIf $M_1$ and $M_3$ are finitely presented $R$-modules, then $M_2$ is a finitely presented $R$-module. \n\n\nIf $M_2$ is a finite $R$-module, then $M_3$ is a finite $R$-module. \n\n\nIf $M_2$ is a finitely presented $R$-module and $M_1$ is a finite $R$-module, then $M_3$ is a finitely presented $R$-module. \n\n\nIf $M_3$ is a finitely presented $R$-module and $M_2$ is a finite $R$-module, then $M_1$ is a finite $R$-module. \n\n\n\n\n    \n]]) and (b) $\\mathop{\\mathrm{Ker}}(\\varphi ) \\otimes \\kappa (\\mathfrak p) = 0$ by flatness of $M_ g$ over $R_ g$ (see Lemma 10.39.12 [[\n  Lemma 10.39.12. Suppose that $R$ is a ring, $0 \\to M\'\' \\to M\' \\to M \\to 0$ a short exact sequence, and $N$ an $R$-module. If $M$ is flat then $N \\otimes _ R M\'\' \\to N \\otimes _ R M\'$ is injective, i.e., the sequence \n  \n  \\[  0 \\to N \\otimes _ R M\'\' \\to N \\otimes _ R M\' \\to N \\otimes _ R M \\to 0  \\]\n\n   is a short exact sequence. \n\n    \n]]). Hence by Nakayama\'s lemma again there exists a $g\' \\in R_ g$ such that $\\mathop{\\mathrm{Ker}}(\\varphi )_{g\'} = 0$. In other words, $M_{gg\'}$ is free. \n    \n      A finite locally free module is a finite module, see Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]], hence (7) $\\Rightarrow $ (6). It is clear that (6) $\\Rightarrow $ (7) and that (7) $\\Rightarrow $ (8). \n    \n      A finite locally free module is a finitely presented module, see Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]], hence (7) $\\Rightarrow $ (4). Of course (4) implies (5). Since we may check flatness locally (see Lemma 10.39.18 [[\n  Lemma 10.39.18. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. \n  \n  \nThe localization $S^{-1}R$ is a flat $R$-algebra. \n\n\nIf $M$ is an $S^{-1}R$-module, then $M$ is a flat $R$-module if and only if $M$ is a flat $S^{-1}R$-module. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak p}$ is a flat $R_{\\mathfrak p}$-module for all primes $\\mathfrak p$ of $R$. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak m}$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n\nSuppose $R \\to A$ is a ring map, $M$ is an $A$-module, and $g_1, \\ldots , g_ m \\in A$ are elements generating the unit ideal of $A$. Then $M$ is flat over $R$ if and only if each localization $M_{g_ i}$ is flat over $R$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak q}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p$ the prime of $R$ lying under $\\mathfrak q$) for all primes $\\mathfrak q$ of $A$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p = R \\cap \\mathfrak m$) for all maximal ideals $\\mathfrak m$ of $A$. \n\n\n\n\n    \n]]) we conclude that (5) implies (1). At this point we have \n    \n      \n  \\[  \\xymatrix{ (2) \\ar@{<=>}[r] &  (3) \\ar@{=>}[r] &  (1) \\ar@{=>}[r] &  (7) \\ar@{<=>}[r] \\ar@{=>}[rd] \\ar@{=>}[d] &  (6) \\\\  &  &  (5) \\ar@{=>}[u] &  (4) \\ar@{=>}[l] &  (8) }  \\]\n\n    \n      Suppose that $M$ satisfies (1), (4), (5), (6), and (7). We will prove that (3) holds. It suffices to show that $M$ is projective. We have to show that $\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, -)$ is exact. Let $0 \\to N\'\' \\to N \\to N\'\\to 0$ be a short exact sequence of $R$-module. We have to show that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact. As $M$ is finite locally free there exist a covering $\\mathop{\\mathrm{Spec}}(R) = \\bigcup D(f_ i)$ such that $M_{f_ i}$ is finite free. By Lemma 10.10.2 [[\n  Lemma 10.10.2. Let $R$ be a ring. Let $M$ be a finitely presented $R$-module. Let $N$ be an $R$-module. \n  \n  \nFor $f \\in R$ we have $\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N)_ f = \\mathop{\\mathrm{Hom}}\\nolimits _{R_ f}(M_ f, N_ f) = \\mathop{\\mathrm{Hom}}\\nolimits _ R(M_ f, N_ f)$, \n\n\nfor a multiplicative subset $S$ of $R$ we have \n\n\n  \\[  S^{-1}\\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) = \\mathop{\\mathrm{Hom}}\\nolimits _{S^{-1}R}(S^{-1}M, S^{-1}N) = \\mathop{\\mathrm{Hom}}\\nolimits _ R(S^{-1}M, S^{-1}N).  \\]\n\n\n\n\n    \n]] we see that \n    \n      \n  \\[  0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\')_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N)_{f_ i} \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\')_{f_ i} \\to 0  \\]\n\n    \n       is equal to $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'\'_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N_{f_ i}) \\to \\mathop{\\mathrm{Hom}}\\nolimits _{R_{f_ i}}(M_{f_ i}, N\'_{f_ i}) \\to 0$ which is exact as $M_{f_ i}$ is free and as the localization $0 \\to N\'\'_{f_ i} \\to N_{f_ i} \\to N\'_{f_ i} \\to 0$ is exact (as localization is exact). Whence we see that $0 \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\'\') \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N) \\to \\mathop{\\mathrm{Hom}}\\nolimits _ R(M, N\') \\to 0$ is exact by Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]]. \n    \n      Finally, assume that (8) holds. Pick a maximal ideal $\\mathfrak m \\subset R$. Pick $x_1, \\ldots , x_ r \\in M$ which map to a $\\kappa (\\mathfrak m)$-basis of $M \\otimes _ R \\kappa (\\mathfrak m) = M/\\mathfrak mM$. In particular $\\rho _ M(\\mathfrak m) = r$. By Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]] there exists an $f \\in R$, $f \\not\\in \\mathfrak m$ such that $x_1, \\ldots , x_ r$ generate $M_ f$ over $R_ f$. By the assumption that $\\rho _ M$ is locally constant there exists a $g \\in R$, $g \\not\\in \\mathfrak m$ such that $\\rho _ M$ is constant equal to $r$ on $D(g)$. We claim that \n    \n      \n  \\[  \\Psi : R_{fg}^{\\oplus r} \\longrightarrow M_{fg}, \\quad (a_1, \\ldots , a_ r) \\longmapsto \\sum a_ i x_ i  \\]\n\n    \n       is an isomorphism. This claim will show that $M$ is finite locally free, i.e., that (7) holds. To see the claim it suffices to show that the induced map on localizations $\\Psi _{\\mathfrak p} : R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p}$ is an isomorphism for all $\\mathfrak p \\in D(fg)$, see Lemma 10.23.1 [[\n  Lemma 10.23.1. Let $R$ be a ring. \n  \n  \nFor an element $x$ of an $R$-module $M$ the following are equivalent \n\n\n  \n$x = 0$, \n\n\n$x$ maps to zero in $M_\\mathfrak p$ for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$x$ maps to zero in $M_{\\mathfrak m}$ for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\n In other words, the map $M \\to \\prod _{\\mathfrak m} M_{\\mathfrak m}$ is injective. \n\n\nGiven an $R$-module $M$ the following are equivalent \n\n\n  \n$M$ is zero, \n\n\n$M_{\\mathfrak p}$ is zero for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$M_{\\mathfrak m}$ is zero for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\nGiven a complex $M_1 \\to M_2 \\to M_3$ of $R$-modules the following are equivalent \n\n\n  \n$M_1 \\to M_2 \\to M_3$ is exact, \n\n\nfor every prime $\\mathfrak p$ of $R$ the localization $M_{1, \\mathfrak p} \\to M_{2, \\mathfrak p} \\to M_{3, \\mathfrak p}$ is exact, \n\n\nfor every maximal ideal $\\mathfrak m$ of $R$ the localization $M_{1, \\mathfrak m} \\to M_{2, \\mathfrak m} \\to M_{3, \\mathfrak m}$ is exact. \n\n\n\n\nGiven a map $f : M \\to M\'$ of $R$-modules the following are equivalent \n\n\n  \n$f$ is injective, \n\n\n$f_{\\mathfrak p} : M_\\mathfrak p \\to M\'_\\mathfrak p$ is injective for all primes $\\mathfrak p$ of $R$, \n\n\n$f_{\\mathfrak m} : M_\\mathfrak m \\to M\'_\\mathfrak m$ is injective for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\nGiven a map $f : M \\to M\'$ of $R$-modules the following are equivalent \n\n\n  \n$f$ is surjective, \n\n\n$f_{\\mathfrak p} : M_\\mathfrak p \\to M\'_\\mathfrak p$ is surjective for all primes $\\mathfrak p$ of $R$, \n\n\n$f_{\\mathfrak m} : M_\\mathfrak m \\to M\'_\\mathfrak m$ is surjective for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\nGiven a map $f : M \\to M\'$ of $R$-modules the following are equivalent \n\n\n  \n$f$ is bijective, \n\n\n$f_{\\mathfrak p} : M_\\mathfrak p \\to M\'_\\mathfrak p$ is bijective for all primes $\\mathfrak p$ of $R$, \n\n\n$f_{\\mathfrak m} : M_\\mathfrak m \\to M\'_\\mathfrak m$ is bijective for all maximal ideals $\\mathfrak m$ of $R$. \n\n\n\n\n\n\n    \n]]. By our choice of $f$ the map $\\Psi _{\\mathfrak p}$ is surjective. By assumption (8) we have $M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus \\rho _ M(\\mathfrak p)}$ and by our choice of $g$ we have $\\rho _ M(\\mathfrak p) = r$. Hence $\\Psi _{\\mathfrak p}$ determines a surjection $R_{\\mathfrak p}^{\\oplus r} \\to M_{\\mathfrak p} \\cong R_{\\mathfrak p}^{\\oplus r}$ whence is an isomorphism by Lemma 10.16.4 [[\n  Lemma 10.16.4. Let $R$ be a ring. Let $M$ be a finite $R$-module. Let $\\varphi : M \\to M$ be a surjective $R$-module map. Then $\\varphi $ is an isomorphism. \n\n    \n      First proof.\n       Write $R\' = R[x]$ and think of $M$ as a finite $R\'$-module with $x$ acting via $\\varphi $. Set $I = (x) \\subset R\'$. By our assumption that $\\varphi $ is surjective we have $IM = M$. Hence we may apply Lemma 10.16.3 to $M$ as an $R\'$-module, the ideal $I$ and the endomorphism $\\text{id}_ M$. We conclude that $(1 + a_1 + \\ldots + a_ n)\\text{id}_ M = 0$ with $a_ j \\in I$. Write $a_ j = b_ j(x)x$ for some $b_ j(x) \\in R[x]$. Translating back into $\\varphi $ we see that $\\text{id}_ M = -(\\sum _{j = 1, \\ldots , n} b_ j(\\varphi )) \\varphi $, and hence $\\varphi $ is invertible. \n      $\\square$\n    \n\n    \n      Second proof.\n       We perform induction on the number of generators of $M$ over $R$. If $M$ is generated by one element, then $M \\cong R/I$ for some ideal $I \\subset R$. In this case we may replace $R$ by $R/I$ so that $M = R$. In this case $\\varphi : R \\to R$ is given by multiplication on $M$ by an element $r \\in R$. The surjectivity of $\\varphi $ forces $r$ invertible, since $\\varphi $ must hit $1$, which implies that $\\varphi $ is invertible. \n    \n      Now assume that we have proven the lemma in the case of modules generated by $n - 1$ elements, and are examining a module $M$ generated by $n$ elements. Let $A$ mean the ring $R[t]$, and regard the module $M$ as an $A$-module by letting $t$ act via $\\varphi $; since $M$ is finite over $R$, it is finite over $R[t]$ as well, and since we\'re trying to prove $\\varphi $ injective, a set-theoretic property, we might as well prove the endomorphism $t : M \\to M$ over $A$ injective. We have reduced our problem to the case our endomorphism is multiplication by an element of the ground ring. Let $M\' \\subset M$ denote the sub-$A$-module generated by the first $n - 1$ of the generators of $M$, and consider the diagram \n    \n      \n  \\[  \\xymatrix{ 0 \\ar[r] &  M\' \\ar[r]\\ar[d]^{\\varphi \\mid _{M\'}} &  M\\ar[d]^\\varphi \\ar[r] &  M/M\' \\ar[d]^{\\varphi \\bmod M\'} \\ar[r] &  0 \\\\  0 \\ar[r] &  M\' \\ar[r] &  M \\ar[r] &  M/M\' \\ar[r] &  0, }  \\]\n\n    \n       where the restriction of $\\varphi $ to $M\'$ and the map induced by $\\varphi $ on the quotient $M/M\'$ are well-defined since $\\varphi $ is multiplication by an element in the base, and $M\'$ and $M/M\'$ are $A$-modules in their own right. By the case $n = 1$ the map $M/M\' \\to M/M\'$ is an isomorphism. A diagram chase implies that $\\varphi |_{M\'}$ is surjective hence by induction $\\varphi |_{M\'}$ is an isomorphism. This forces the middle column to be an isomorphism by the snake lemma. \n      $\\square$\n    \n]]. (Of course this last fact follows from a simple matrix argument also.) \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) ‚Üí (2)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean snippet is about obtaining a split factorization of the identity map on M from a lemma `exists_factorization_of_isFinitelyPresented` and then applying `.of_split f g eq.symm`, i.e. it uses a splitting datum (maps f,g with a composition equality) to conclude some finitely presented‚Äìrelated factorization. The informal proof for (1) ‚Üí (2) in the provided text is instead the classical argument that a finitely presented flat module is projective (hence finite projective), using local freeness via Nakayama and then exactness of Hom checked locally. Structurally, the informal proof is long and local (primes, localizations, Nakayama, kernels), whereas the Lean proof is a very short extraction of data from an existing lemma and a split argument; it does not mirror the local-free/Nakayama structure. While both involve ‚Äúsplitting implies projective‚Äù ideas at a high level, the Lean code does not visibly implement the (1)‚Üí(2) strategy described, and appears to rely on a different packaged lemma, so the correspondence is weak.""}"
278,0539,"theorem flat_iff_torsion_eq_bot_of_isBezout [IsBezout R] [IsDomain R] :
    Flat R M ‚Üî torsion R M = ‚ä• := by
  -- one way is true in general
  refine ‚ü®fun _ ‚Ü¶ torsion_eq_bot, ?_‚ü©
  -- now assume R is a Bezout domain and M is a torsionfree R-module
  intro htors
  -- we need to show that if I is an ideal of R then the natural map I ‚äó M ‚Üí M is injective
  rw [iff_lift_lsmul_comp_subtype_injective]
  rintro I hFG
  -- If I = 0 this is obvious because I ‚äó M is a subsingleton (i.e. has ‚â§1 element)
  obtain (rfl | h) := eq_or_ne I ‚ä•
  ¬∑ rintro x y -
    apply Subsingleton.elim
  ¬∑ -- If I ‚â† 0 then I ‚âÖ R because R is Bezout and I is finitely generated
    have hprinc : I.IsPrincipal := IsBezout.isPrincipal_of_FG I hFG
    have : IsPrincipal.generator I ‚â† 0 := by
      rwa [ne_eq, ‚Üê IsPrincipal.eq_bot_iff_generator_eq_zero]
    apply Function.Injective.of_comp_right _
      (LinearEquiv.rTensor M (Ideal.isoBaseOfIsPrincipal h)).surjective
    rw [‚Üê LinearEquiv.coe_toLinearMap, ‚Üê LinearMap.coe_comp, LinearEquiv.coe_rTensor, rTensor,
      lift_comp_map, LinearMap.compl‚ÇÇ_id, LinearMap.comp_assoc,
      Ideal.subtype_isoBaseOfIsPrincipal_eq_mul, LinearMap.lift_lsmul_mul_eq_lsmul_lift_lsmul,
      LinearMap.coe_comp]
    rw [‚Üê Submodule.isTorsionFree_iff_torsion_eq_bot] at htors
    refine Function.Injective.comp (LinearMap.lsmul_injective this) ?_
    rw [‚Üê Equiv.injective_comp (TensorProduct.lid R M).symm.toEquiv]
    convert Function.injective_id
    ext
    simp
",Formal Proof of Stacks Project Tag 0539,Generalized valuation ring to Bezout domain,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/TorsionFree.lean#L90-L118,Q27041,,15.22.10,lemma,3.0,"['0549', '05E3', '0ELQ']","\n  Lemma 15.22.10. Let $A$ be a valuation ring. An $A$-module $M$ is flat over $A$ if and only if $M$ is torsion free. \n\n    \n      Proof.\n      The implication \xe2\x80\x9cflat $\\Rightarrow $ torsion free\xe2\x80\x9d is Lemma 15.22.9. For the converse, assume $M$ is torsion free. By the equational criterion of flatness (see Algebra, Lemma 10.39.11) we have to show that every relation in $M$ is trivial. To do this assume that $\\sum _{i = 1, \\ldots , n} a_ i x_ i = 0$ with $x_ i \\in M$ and $a_ i \\in A$. After renumbering we may assume that $v(a_1) \\leq v(a_ i)$ for all $i$. Hence we can write $a_ i = a\'_ i a_1$ for some $a\'_ i \\in A$. Note that $a\'_1 = 1$. As $M$ is torsion free we see that $x_1 = - \\sum _{i \\geq 2} a\'_ i x_ i$. Thus, if we choose $y_ i = x_ i$, $i = 2, \\ldots , n$ then \n    \n      \n  \\[  x_1 = \\sum \\nolimits _{j \\geq 2} -a\'_ j y_ j, \\quad x_ i = y_ i, (i \\geq 2)\\quad 0 = a_1 \\cdot (-a\'_ j) + a_ j \\cdot 1 (j \\geq 2)  \\]\n\n    \n       shows that the relation was trivial (to be explicit the elements $a_{ij}$ are defined by setting $a_{11} = 0$, $a_{1j} = -a\'_ j$ for $j > 1$, and $a_{ij} = \\delta _{ij}$ for $i, j \\geq 2$). \n      $\\square$\n    \n",\n  Lemma 15.22.10. Let $A$ be a valuation ring. An $A$-module $M$ is flat over $A$ if and only if $M$ is torsion free. \n\n    \n,"Proof.\n      The implication \xe2\x80\x9cflat $\\Rightarrow $ torsion free\xe2\x80\x9d is Lemma 15.22.9. For the converse, assume $M$ is torsion free. By the equational criterion of flatness (see Algebra, Lemma 10.39.11) we have to show that every relation in $M$ is trivial. To do this assume that $\\sum _{i = 1, \\ldots , n} a_ i x_ i = 0$ with $x_ i \\in M$ and $a_ i \\in A$. After renumbering we may assume that $v(a_1) \\leq v(a_ i)$ for all $i$. Hence we can write $a_ i = a\'_ i a_1$ for some $a\'_ i \\in A$. Note that $a\'_1 = 1$. As $M$ is torsion free we see that $x_1 = - \\sum _{i \\geq 2} a\'_ i x_ i$. Thus, if we choose $y_ i = x_ i$, $i = 2, \\ldots , n$ then \n    \n      \n  \\[  x_1 = \\sum \\nolimits _{j \\geq 2} -a\'_ j y_ j, \\quad x_ i = y_ i, (i \\geq 2)\\quad 0 = a_1 \\cdot (-a\'_ j) + a_ j \\cdot 1 (j \\geq 2)  \\]\n\n    \n       shows that the relation was trivial (to be explicit the elements $a_{ij}$ are defined by setting $a_{11} = 0$, $a_{1j} = -a\'_ j$ for $j > 1$, and $a_{ij} = \\delta _{ij}$ for $i, j \\geq 2$). \n      $\\square$\n    \n"," by
  -- one way is true in general
  refine ‚ü®fun _ ‚Ü¶ torsion_eq_bot, ?_‚ü©
  -- now assume R is a Bezout domain and M is a torsionfree R-module
  intro htors
  -- we need to show that if I is an ideal of R then the natural map I ‚äó M ‚Üí M is injective
  rw [iff_lift_lsmul_comp_subtype_injective]
  rintro I hFG
  -- If I = 0 this is obvious because I ‚äó M is a subsingleton (i.e. has ‚â§1 element)
  obtain (rfl | h) := eq_or_ne I ‚ä•
  ¬∑ rintro x y -
    apply Subsingleton.elim
  ¬∑ -- If I ‚â† 0 then I ‚âÖ R because R is Bezout and I is finitely generated
    have hprinc : I.IsPrincipal := IsBezout.isPrincipal_of_FG I hFG
    have : IsPrincipal.generator I ‚â† 0 := by
      rwa [ne_eq, ‚Üê IsPrincipal.eq_bot_iff_generator_eq_zero]
    apply Function.Injective.of_comp_right _
      (LinearEquiv.rTensor M (Ideal.isoBaseOfIsPrincipal h)).surjective
    rw [‚Üê LinearEquiv.coe_toLinearMap, ‚Üê LinearMap.coe_comp, LinearEquiv.coe_rTensor, rTensor,
      lift_comp_map, LinearMap.compl‚ÇÇ_id, LinearMap.comp_assoc,
      Ideal.subtype_isoBaseOfIsPrincipal_eq_mul, LinearMap.lift_lsmul_mul_eq_lsmul_lift_lsmul,
      LinearMap.coe_comp]
    rw [‚Üê Submodule.isTorsionFree_iff_torsion_eq_bot] at htors
    refine Function.Injective.comp (LinearMap.lsmul_injective this) ?_
    rw [‚Üê Equiv.injective_comp (TensorProduct.lid R M).symm.toEquiv]
    convert Function.injective_id
    ext
    simp
","theorem flat_iff_torsion_eq_bot_of_isBezout [IsBezout R] [IsDomain R] :
    Flat R M ‚Üî torsion R M = ‚ä• ","Proof.\n      The implication \xe2\x80\x9cflat $\\Rightarrow $ torsion free\xe2\x80\x9d is Lemma 15.22.9 [[\n  Lemma 15.22.9. Let $R$ be a domain. Any flat $R$-module is torsion free. \n\n    \n]]. For the converse, assume $M$ is torsion free. By the equational criterion of flatness (see Algebra, Lemma 10.39.11 [[\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n]]) we have to show that every relation in $M$ is trivial. To do this assume that $\\sum _{i = 1, \\ldots , n} a_ i x_ i = 0$ with $x_ i \\in M$ and $a_ i \\in A$. After renumbering we may assume that $v(a_1) \\leq v(a_ i)$ for all $i$. Hence we can write $a_ i = a\'_ i a_1$ for some $a\'_ i \\in A$. Note that $a\'_1 = 1$. As $M$ is torsion free we see that $x_1 = - \\sum _{i \\geq 2} a\'_ i x_ i$. Thus, if we choose $y_ i = x_ i$, $i = 2, \\ldots , n$ then \n    \n      \n  \\[  x_1 = \\sum \\nolimits _{j \\geq 2} -a\'_ j y_ j, \\quad x_ i = y_ i, (i \\geq 2)\\quad 0 = a_1 \\cdot (-a\'_ j) + a_ j \\cdot 1 (j \\geq 2)  \\]\n\n    \n       shows that the relation was trivial (to be explicit the elements $a_{ij}$ are defined by setting $a_{11} = 0$, $a_{1j} = -a\'_ j$ for $j > 1$, and $a_{ij} = \\delta _{ij}$ for $i, j \\geq 2$). \n      $\\square$\n    \n","Proof.\n      The implication \xe2\x80\x9cflat $\\Rightarrow $ torsion free\xe2\x80\x9d is Lemma 15.22.9 [[\n  Lemma 15.22.9. Let $R$ be a domain. Any flat $R$-module is torsion free. \n\n    \n]]. For the converse, assume $M$ is torsion free. By the equational criterion of flatness (see Algebra, Lemma 10.39.11 [[\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n]]) we have to show that every relation in $M$ is trivial. To do this assume that $\\sum _{i = 1, \\ldots , n} a_ i x_ i = 0$ with $x_ i \\in M$ and $a_ i \\in A$. After renumbering we may assume that $v(a_1) \\leq v(a_ i)$ for all $i$. Hence we can write $a_ i = a\'_ i a_1$ for some $a\'_ i \\in A$. Note that $a\'_1 = 1$. As $M$ is torsion free we see that $x_1 = - \\sum _{i \\geq 2} a\'_ i x_ i$. Thus, if we choose $y_ i = x_ i$, $i = 2, \\ldots , n$ then \n    \n      \n  \\[  x_1 = \\sum \\nolimits _{j \\geq 2} -a\'_ j y_ j, \\quad x_ i = y_ i, (i \\geq 2)\\quad 0 = a_1 \\cdot (-a\'_ j) + a_ j \\cdot 1 (j \\geq 2)  \\]\n\n    \n       shows that the relation was trivial (to be explicit the elements $a_{ij}$ are defined by setting $a_{11} = 0$, $a_{1j} = -a\'_ j$ for $j > 1$, and $a_{ij} = \\delta _{ij}$ for $i, j \\geq 2$). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Generalized valuation ring to Bezout domain","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to show an equivalence between flatness and torsion-freeness over a special class of domains (informal: generalized valuation ring; Lean: B√©zout domain, per the comment). The forward direction matches well: the Lean proof uses `torsion_eq_bot` (flat ‚áí torsion-free) corresponding to the cited lemma in the informal proof.\n\nHowever, the converse direction differs substantially in method and structure. The informal proof uses the equational criterion of flatness and a valuation-based argument to trivialize relations by choosing a minimal-valuation coefficient and dividing others by it. The Lean proof instead proves flatness via an injectivity criterion for the maps I ‚äó M ‚Üí M for finitely generated ideals, splitting into cases I = ‚ä• and I ‚â† ‚ä•, and then using the B√©zout property to make I principal and reduce to injectivity of scalar multiplication by a nonzero generator together with torsion-freeness. This is a different criterion and does not reflect the valuation/minimality argument.\n\nCompleteness-wise, Lean covers both directions but omits the equational-criterion/valuation reasoning present informally; conversely, it introduces principal-ideal/isomorphism machinery not present in the informal proof. Thus the proofs are aligned on the overall statement and one direction, but structurally and in key ideas for the converse they diverge.""}"
279,0AUW,"theorem _root_.IsDedekindDomain.flat_iff_torsion_eq_bot [IsDedekindDomain R] :
    Flat R M ‚Üî torsion R M = ‚ä• := by
  apply flat_iff_torsion_eq_bot_of_valuationRing_localization_isMaximal
  exact fun P ‚Ü¶ inferInstance
",Formal Proof of Stacks Project Tag 0AUW,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Flat/TorsionFree.lean#L135-L138,Q27041,,15.22.11,lemma,3.0,"['0549', '05E3', '0ELQ']","\n  Lemma 15.22.11. Let $A$ be a Dedekind domain (for example a discrete valuation ring or more generally a PID). \n  \n  \nAn $A$-module is flat if and only if it is torsion free. \n\n\nA finite torsion free $A$-module is finite locally free. \n\n\nA finite torsion free $A$-module is finite free if $A$ is a PID. \n\n\n\n\n    \n      Proof.\n      (For the parenthetical remark in the statement of the lemma, see Algebra, Lemma 10.120.15.) Proof of (1). By Lemma 15.22.6 and Algebra, Lemma 10.39.18 it suffices to check the statement over $A_\\mathfrak m$ for $\\mathfrak m \\subset A$ maximal. Since $A_\\mathfrak m$ is a discrete valuation ring (Algebra, Lemma 10.120.17) we win by Lemma 15.22.10. \n    \n      Proof of (2). Follows from Algebra, Lemma 10.78.2 and (1). \n    \n      Proof of (3). Let $A$ be a PID and let $M$ be a finite torsion free module. By Lemma 15.22.7 we see that $M \\subset A^{\\oplus n}$ for some $n$. We argue that $M$ is free by induction on $n$. The case $n = 1$ expresses exactly the fact that $A$ is a PID. If $n > 1$ let $M\' \\subset A^{\\oplus n - 1}$ be the image of the projection onto the last $n - 1$ summands of $A^{\\oplus n}$. Then we obtain a short exact sequence $0 \\to I \\to M \\to M\' \\to 0$ where $I$ is the intersection of $M$ with the first summand $A$ of $A^{\\oplus n}$. By induction we see that $M$ is an extension of finite free $A$-modules, whence finite free. \n      $\\square$\n    \n",\n  Lemma 15.22.11. Let $A$ be a Dedekind domain (for example a discrete valuation ring or more generally a PID). \n  \n  \nAn $A$-module is flat if and only if it is torsion free. \n\n\nA finite torsion free $A$-module is finite locally free. \n\n\nA finite torsion free $A$-module is finite free if $A$ is a PID. \n\n\n\n\n    \n,"Proof.\n      (For the parenthetical remark in the statement of the lemma, see Algebra, Lemma 10.120.15.) Proof of (1). By Lemma 15.22.6 and Algebra, Lemma 10.39.18 it suffices to check the statement over $A_\\mathfrak m$ for $\\mathfrak m \\subset A$ maximal. Since $A_\\mathfrak m$ is a discrete valuation ring (Algebra, Lemma 10.120.17) we win by Lemma 15.22.10. \n    \n      Proof of (2). Follows from Algebra, Lemma 10.78.2 and (1). \n    \n      Proof of (3). Let $A$ be a PID and let $M$ be a finite torsion free module. By Lemma 15.22.7 we see that $M \\subset A^{\\oplus n}$ for some $n$. We argue that $M$ is free by induction on $n$. The case $n = 1$ expresses exactly the fact that $A$ is a PID. If $n > 1$ let $M\' \\subset A^{\\oplus n - 1}$ be the image of the projection onto the last $n - 1$ summands of $A^{\\oplus n}$. Then we obtain a short exact sequence $0 \\to I \\to M \\to M\' \\to 0$ where $I$ is the intersection of $M$ with the first summand $A$ of $A^{\\oplus n}$. By induction we see that $M$ is an extension of finite free $A$-modules, whence finite free. \n      $\\square$\n    \n"," by
  apply flat_iff_torsion_eq_bot_of_valuationRing_localization_isMaximal
  exact fun P ‚Ü¶ inferInstance
","theorem _root_.IsDedekindDomain.flat_iff_torsion_eq_bot [IsDedekindDomain R] :
    Flat R M ‚Üî torsion R M = ‚ä• ","Proof.\n      (For the parenthetical remark in the statement of the lemma, see Algebra, Lemma 10.120.15 [[\n  Lemma 10.120.15. A PID is a Dedekind domain. \n\n    \n]].) Proof of (1). By Lemma 15.22.6 [[\n  Lemma 15.22.6. Let $R$ be a domain. Let $M$ be an $R$-module. Then $M$ is torsion free if and only if $M_\\mathfrak m$ is a torsion free $R_\\mathfrak m$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n    \n]] and Algebra, Lemma 10.39.18 [[\n  Lemma 10.39.18. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. \n  \n  \nThe localization $S^{-1}R$ is a flat $R$-algebra. \n\n\nIf $M$ is an $S^{-1}R$-module, then $M$ is a flat $R$-module if and only if $M$ is a flat $S^{-1}R$-module. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak p}$ is a flat $R_{\\mathfrak p}$-module for all primes $\\mathfrak p$ of $R$. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak m}$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n\nSuppose $R \\to A$ is a ring map, $M$ is an $A$-module, and $g_1, \\ldots , g_ m \\in A$ are elements generating the unit ideal of $A$. Then $M$ is flat over $R$ if and only if each localization $M_{g_ i}$ is flat over $R$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak q}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p$ the prime of $R$ lying under $\\mathfrak q$) for all primes $\\mathfrak q$ of $A$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p = R \\cap \\mathfrak m$) for all maximal ideals $\\mathfrak m$ of $A$. \n\n\n\n\n    \n]] it suffices to check the statement over $A_\\mathfrak m$ for $\\mathfrak m \\subset A$ maximal. Since $A_\\mathfrak m$ is a discrete valuation ring (Algebra, Lemma 10.120.17 [[\n  Lemma 10.120.17. Let $R$ be a ring. The following are equivalent \n  \n  \n$R$ is a Dedekind domain, \n\n\n$R$ is a Noetherian domain and for every nonzero maximal ideal $\\mathfrak m$ the local ring $R_{\\mathfrak m}$ is a discrete valuation ring, and \n\n\n$R$ is a Noetherian, normal domain, and $\\dim (R) \\leq 1$. \n\n\n\n\n    \n]]) we win by Lemma 15.22.10 [[\n  Lemma 15.22.10. Let $A$ be a valuation ring. An $A$-module $M$ is flat over $A$ if and only if $M$ is torsion free. \n\n    \n]]. \n    \n      Proof of (2). Follows from Algebra, Lemma 10.78.2 [[\n  Lemma 10.78.2. Let $R$ be a ring and let $M$ be an $R$-module. The following are equivalent \n  \n  \n$M$ is finitely presented and $R$-flat, \n\n\n$M$ is finite projective, \n\n\n$M$ is a direct summand of a finite free $R$-module, \n\n\n$M$ is finitely presented and for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$ the localization $M_{\\mathfrak p}$ is free, \n\n\n$M$ is finitely presented and for all maximal ideals $\\mathfrak m \\subset R$ the localization $M_{\\mathfrak m}$ is free, \n\n\n$M$ is finite and locally free, \n\n\n$M$ is finite locally free, and \n\n\n$M$ is finite, for every prime $\\mathfrak p$ the module $M_{\\mathfrak p}$ is free, and the function \n\n\n  \\[  \\rho _ M : \\mathop{\\mathrm{Spec}}(R) \\to \\mathbf{Z}, \\quad \\mathfrak p \\longmapsto \\dim _{\\kappa (\\mathfrak p)} M \\otimes _ R \\kappa (\\mathfrak p)  \\]\n\n\n is locally constant in the Zariski topology. \n\n\n\n\n    \n]] and (1). \n    \n      Proof of (3). Let $A$ be a PID and let $M$ be a finite torsion free module. By Lemma 15.22.7 [[\n  Lemma 15.22.7. Let $R$ be a domain. Let $M$ be a finite $R$-module. Then $M$ is torsion free if and only if $M$ is a submodule of a finite free module. \n\n    \n]] we see that $M \\subset A^{\\oplus n}$ for some $n$. We argue that $M$ is free by induction on $n$. The case $n = 1$ expresses exactly the fact that $A$ is a PID. If $n > 1$ let $M\' \\subset A^{\\oplus n - 1}$ be the image of the projection onto the last $n - 1$ summands of $A^{\\oplus n}$. Then we obtain a short exact sequence $0 \\to I \\to M \\to M\' \\to 0$ where $I$ is the intersection of $M$ with the first summand $A$ of $A^{\\oplus n}$. By induction we see that $M$ is an extension of finite free $A$-modules, whence finite free. \n      $\\square$\n    \n","Proof.\n      (For the parenthetical remark in the statement of the lemma, see Algebra, Lemma 10.120.15 [[\n  Lemma 10.120.15. A PID is a Dedekind domain. \n\n    \n]].) Proof of (1). By Lemma 15.22.6 [[\n  Lemma 15.22.6. Let $R$ be a domain. Let $M$ be an $R$-module. Then $M$ is torsion free if and only if $M_\\mathfrak m$ is a torsion free $R_\\mathfrak m$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n    \n]] and Algebra, Lemma 10.39.18 [[\n  Lemma 10.39.18. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. \n  \n  \nThe localization $S^{-1}R$ is a flat $R$-algebra. \n\n\nIf $M$ is an $S^{-1}R$-module, then $M$ is a flat $R$-module if and only if $M$ is a flat $S^{-1}R$-module. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak p}$ is a flat $R_{\\mathfrak p}$-module for all primes $\\mathfrak p$ of $R$. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak m}$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n\nSuppose $R \\to A$ is a ring map, $M$ is an $A$-module, and $g_1, \\ldots , g_ m \\in A$ are elements generating the unit ideal of $A$. Then $M$ is flat over $R$ if and only if each localization $M_{g_ i}$ is flat over $R$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak q}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p$ the prime of $R$ lying under $\\mathfrak q$) for all primes $\\mathfrak q$ of $A$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p = R \\cap \\mathfrak m$) for all maximal ideals $\\mathfrak m$ of $A$. \n\n\n\n\n    \n]] it suffices to check the statement over $A_\\mathfrak m$ for $\\mathfrak m \\subset A$ maximal. Since $A_\\mathfrak m$ is a discrete valuation ring (Algebra, Lemma 10.120.17 [[\n  Lemma 10.120.17. Let $R$ be a ring. The following are equivalent \n  \n  \n$R$ is a Dedekind domain, \n\n\n$R$ is a Noetherian domain and for every nonzero maximal ideal $\\mathfrak m$ the local ring $R_{\\mathfrak m}$ is a discrete valuation ring, and \n\n\n$R$ is a Noetherian, normal domain, and $\\dim (R) \\leq 1$. \n\n\n\n\n    \n]]) we win by Lemma 15.22.10 [[\n  Lemma 15.22.10. Let $A$ be a valuation ring. An $A$-module $M$ is flat over $A$ if and only if $M$ is torsion free. \n\n    \n]]. \n    \n      Proof of (2). Follows from Algebra, Lemma 10.78.2 [[\n  Lemma 10.78.2. Let $R$ be a ring and let $M$ be an $R$-module. The following are equivalent \n  \n  \n$M$ is finitely presented and $R$-flat, \n\n\n$M$ is finite projective, \n\n\n$M$ is a direct summand of a finite free $R$-module, \n\n\n$M$ is finitely presented and for all $\\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R)$ the localization $M_{\\mathfrak p}$ is free, \n\n\n$M$ is finitely presented and for all maximal ideals $\\mathfrak m \\subset R$ the localization $M_{\\mathfrak m}$ is free, \n\n\n$M$ is finite and locally free, \n\n\n$M$ is finite locally free, and \n\n\n$M$ is finite, for every prime $\\mathfrak p$ the module $M_{\\mathfrak p}$ is free, and the function \n\n\n  \\[  \\rho _ M : \\mathop{\\mathrm{Spec}}(R) \\to \\mathbf{Z}, \\quad \\mathfrak p \\longmapsto \\dim _{\\kappa (\\mathfrak p)} M \\otimes _ R \\kappa (\\mathfrak p)  \\]\n\n\n is locally constant in the Zariski topology. \n\n\n\n\n    \n]] and (1). \n    \n      Proof of (3). Let $A$ be a PID and let $M$ be a finite torsion free module. By Lemma 15.22.7 [[\n  Lemma 15.22.7. Let $R$ be a domain. Let $M$ be a finite $R$-module. Then $M$ is torsion free if and only if $M$ is a submodule of a finite free module. \n\n    \n]] we see that $M \\subset A^{\\oplus n}$ for some $n$. We argue that $M$ is free by induction on $n$. The case $n = 1$ expresses exactly the fact that $A$ is a PID. If $n > 1$ let $M\' \\subset A^{\\oplus n - 1}$ be the image of the projection onto the last $n - 1$ summands of $A^{\\oplus n}$. Then we obtain a short exact sequence $0 \\to I \\to M \\to M\' \\to 0$ where $I$ is the intersection of $M$ with the first summand $A$ of $A^{\\oplus n}$. By induction we see that $M$ is an extension of finite free $A$-modules, whence finite free. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof applies a lemma `flat_iff_torsion_eq_bot_of_valuationRing_localization_isMaximal`, which suggests the target statement is a flatness ‚Üî torsion(-submodule)=‚ä• criterion under hypotheses involving valuation rings and localizations at maximal ideals. This matches the informal proof‚Äôs core idea for (1): reduce to localizations at maximal ideals and then use the valuation ring fact ‚Äúflat iff torsion free.‚Äù Structurally, however, the informal proof explicitly chains several localization/flatness lemmas (flatness local on maximal ideals; local rings are DVRs/valuation rings) before invoking the valuation-ring criterion, whereas the Lean proof compresses all of this into a single prepackaged lemma and only discharges an instance argument (`fun P ‚Ü¶ inferInstance`). Thus the Lean proof aligns with the high-level strategy but does not mirror the step-by-step structure or mention the intermediate reductions present in the informal argument.""}"
281,00HW,"lemma iff_generalizingMap_primeSpectrumComap :
    Algebra.HasGoingDown R S ‚Üî
      GeneralizingMap (PrimeSpectrum.comap (algebraMap R S)) := by
  refine ‚ü®?_, fun h ‚Ü¶ ‚ü®fun {p} hp Q hQ hlt ‚Ü¶ ?_‚ü©‚ü©
  ¬∑ intro h Q p hp
    rw [‚Üê PrimeSpectrum.le_iff_specializes] at hp
    obtain ‚ü®P, hle, hP, h‚ü© := Q.asIdeal.exists_ideal_le_liesOver_of_le (p := p.asIdeal)
      (q := Q.asIdeal.under R) hp
    refine ‚ü®‚ü®P, hP‚ü©, (PrimeSpectrum.le_iff_specializes _ Q).mp hle, ?_‚ü©
    ext : 1
    exact h.over.symm
  ¬∑ have : (‚ü®p, hp‚ü© : PrimeSpectrum R) ‚§≥ (PrimeSpectrum.comap (algebraMap R S) ‚ü®Q, hQ‚ü©) :=
      (PrimeSpectrum.le_iff_specializes _ _).mp hlt.le
    obtain ‚ü®P, hs, heq‚ü© := h this
    refine ‚ü®P.asIdeal, (PrimeSpectrum.le_iff_specializes _ _).mpr hs, P.2, ‚ü®?_‚ü©‚ü©
    simpa [PrimeSpectrum.ext_iff] using heq.symm
",Formal Proof of Stacks Project Tag 00HW,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/GoingDown.lean#L106-L121,Q27041,,10.41.3,lemma,3.0,"['00HU', '00AO', '0ELQ']","\n  Lemma 10.41.3. Let $R \\to S$ be a ring map. \n  \n  \n$R \\to S$ satisfies going down if and only if generalizations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n$R \\to S$ satisfies going up if and only if specializations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n\n\n    \n      Proof.\n      Omitted. \n      $\\square$\n    \n","\n  Lemma 10.41.3. Let $R \\to S$ be a ring map. \n  \n  \n$R \\to S$ satisfies going down if and only if generalizations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n$R \\to S$ satisfies going up if and only if specializations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n\n\n    \n",Proof.\n      Omitted. \n      $\\square$\n    \n," by
  refine ‚ü®?_, fun h ‚Ü¶ ‚ü®fun {p} hp Q hQ hlt ‚Ü¶ ?_‚ü©‚ü©
  ¬∑ intro h Q p hp
    rw [‚Üê PrimeSpectrum.le_iff_specializes] at hp
    obtain ‚ü®P, hle, hP, h‚ü© := Q.asIdeal.exists_ideal_le_liesOver_of_le (p := p.asIdeal)
      (q := Q.asIdeal.under R) hp
    refine ‚ü®‚ü®P, hP‚ü©, (PrimeSpectrum.le_iff_specializes _ Q).mp hle, ?_‚ü©
    ext : 1
    exact h.over.symm
  ¬∑ have : (‚ü®p, hp‚ü© : PrimeSpectrum R) ‚§≥ (PrimeSpectrum.comap (algebraMap R S) ‚ü®Q, hQ‚ü©) :=
      (PrimeSpectrum.le_iff_specializes _ _).mp hlt.le
    obtain ‚ü®P, hs, heq‚ü© := h this
    refine ‚ü®P.asIdeal, (PrimeSpectrum.le_iff_specializes _ _).mpr hs, P.2, ‚ü®?_‚ü©‚ü©
    simpa [PrimeSpectrum.ext_iff] using heq.symm
","lemma iff_generalizingMap_primeSpectrumComap :
    Algebra.HasGoingDown R S ‚Üî
      GeneralizingMap (PrimeSpectrum.comap (algebraMap R S)) ",Proof.\n      Omitted. \n      $\\square$\n    \n,"Proof.\n      Omitted. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is completely omitted (‚ÄúProof. Omitted.‚Äù), so it provides no semantic content or structure to compare against. The Lean proof is a detailed constructive argument involving specializations in `PrimeSpectrum`, existence of an ideal lying over, and comap properties. Since there is no corresponding informal reasoning or stated steps, neither semantic consistency nor structural correspondence can be assessed, and the formal proof cannot be said to align with the (nonexistent) informal proof.""}"
282,00HX,"lemma trans (T : Type*) [CommRing T] [Algebra R T] [Algebra S T] [IsScalarTower R S T]
    [Algebra.HasGoingDown R S] [Algebra.HasGoingDown S T] :
    Algebra.HasGoingDown R T := by
  rw [iff_generalizingMap_primeSpectrumComap, IsScalarTower.algebraMap_eq R S T]
  simp only [PrimeSpectrum.comap_comp]
  apply GeneralizingMap.comp
  ¬∑ rwa [‚Üê iff_generalizingMap_primeSpectrumComap]
  ¬∑ rwa [‚Üê iff_generalizingMap_primeSpectrumComap]
",Formal Proof of Stacks Project Tag 00HX,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/GoingDown.lean#L125-L132,Q27041,,10.41.4,lemma,3.0,"['00HU', '00AO', '0ELQ']","\n  Lemma 10.41.4. Suppose $R \\to S$ and $S \\to T$ are ring maps satisfying going down. Then so does $R \\to T$. Similarly for going up. \n\n    \n      Proof.\n      According to Lemma 10.41.3 this follows from Topology, Lemma 5.19.5 \n      $\\square$\n    \n",\n  Lemma 10.41.4. Suppose $R \\to S$ and $S \\to T$ are ring maps satisfying going down. Then so does $R \\to T$. Similarly for going up. \n\n    \n,"Proof.\n      According to Lemma 10.41.3 this follows from Topology, Lemma 5.19.5 \n      $\\square$\n    \n"," by
  rw [iff_generalizingMap_primeSpectrumComap, IsScalarTower.algebraMap_eq R S T]
  simp only [PrimeSpectrum.comap_comp]
  apply GeneralizingMap.comp
  ¬∑ rwa [‚Üê iff_generalizingMap_primeSpectrumComap]
  ¬∑ rwa [‚Üê iff_generalizingMap_primeSpectrumComap]
","lemma trans (T : Type*) [CommRing T] [Algebra R T] [Algebra S T] [IsScalarTower R S T]
    [Algebra.HasGoingDown R S] [Algebra.HasGoingDown S T] :
    Algebra.HasGoingDown R T ","Proof.\n      According to Lemma 10.41.3 [[\n  Lemma 10.41.3. Let $R \\to S$ be a ring map. \n  \n  \n$R \\to S$ satisfies going down if and only if generalizations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n$R \\to S$ satisfies going up if and only if specializations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n\n\n    \n]] this follows from Topology, Lemma 5.19.5 [[\n  Lemma 5.19.5. Suppose $f : X \\to Y$ and $g : Y \\to Z$ are continuous maps of topological spaces. If specializations lift along both $f$ and $g$ then specializations lift along $g \\circ f$. Similarly for \xe2\x80\x9cgeneralizations lift along\xe2\x80\x9d. \n\n    \n]] \n      $\\square$\n    \n","Proof.\n      According to Lemma 10.41.3 [[\n  Lemma 10.41.3. Let $R \\to S$ be a ring map. \n  \n  \n$R \\to S$ satisfies going down if and only if generalizations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n$R \\to S$ satisfies going up if and only if specializations lift along the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, see Topology, Definition 5.19.4. \n\n\n\n\n    \n]] this follows from Topology, Lemma 5.19.5 [[\n  Lemma 5.19.5. Suppose $f : X \\to Y$ and $g : Y \\to Z$ are continuous maps of topological spaces. If specializations lift along both $f$ and $g$ then specializations lift along $g \\circ f$. Similarly for \xe2\x80\x9cgeneralizations lift along\xe2\x80\x9d. \n\n    \n]] \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the formal proof shows that the property ‚Äúgeneralizations lift along Spec comap‚Äù is preserved under composition: it rewrites the goal using an iff characterizing a ring map property in terms of `GeneralizingMap` on `PrimeSpectrum.comap`, then applies `GeneralizingMap.comp` after rewriting `comap_comp`. This matches the informal argument: use the equivalence between going-down/going-up and lifting of generalizations/specializations, then use the lemma that lifting is stable under composition.\nStructurally, both proofs proceed by (1) translating the ring-map property to a topological lifting property via an iff lemma, and (2) applying a composition lemma. The Lean proof is specifically for generalizations (not specializations), and it also includes technical rewrites (`IsScalarTower.algebraMap_eq`, `PrimeSpectrum.comap_comp`) not mentioned informally. The informal proof mentions both going up and going down, whereas the formal proof only treats the generalizations case, so it is not a perfect match but is largely aligned.""}"
283,00HS,"instance of_flat [Module.Flat R S] : Algebra.HasGoingDown R S := by
  apply of_comap_localRingHom_surjective
  intro P hP
  have : IsLocalHom (algebraMap (Localization.AtPrime <| P.under R) (Localization.AtPrime P)) := by
    rw [RingHom.algebraMap_toAlgebra]
    exact Localization.isLocalHom_localRingHom (P.under R) P (algebraMap R S) Ideal.LiesOver.over
  have : Module.FaithfullyFlat (Localization.AtPrime (P.under R)) (Localization.AtPrime P) :=
    Module.FaithfullyFlat.of_flat_of_isLocalHom
  apply PrimeSpectrum.comap_surjective_of_faithfullyFlat
",Formal Proof of Stacks Project Tag 00HS,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/GoingDown.lean#L153-L161,Q27041,,10.39.19,lemma,3.0,"['00H9', '00AO', '0ELQ']",\n  Lemma 10.39.19. Let $R \\to S$ be flat. Let $\\mathfrak p \\subset \\mathfrak p\'$ be primes of $R$. Let $\\mathfrak q\' \\subset S$ be a prime of $S$ mapping to $\\mathfrak p\'$. Then there exists a prime $\\mathfrak q \\subset \\mathfrak q\'$ mapping to $\\mathfrak p$. \n\n    \n      Proof.\n      By Lemma 10.39.18 the local ring map $R_{\\mathfrak p\'} \\to S_{\\mathfrak q\'}$ is flat. By Lemma 10.39.17 this local ring map is faithfully flat. By Lemma 10.39.16 there is a prime mapping to $\\mathfrak p R_{\\mathfrak p\'}$. The inverse image of this prime in $S$ does the job. \n      $\\square$\n    \n,\n  Lemma 10.39.19. Let $R \\to S$ be flat. Let $\\mathfrak p \\subset \\mathfrak p\'$ be primes of $R$. Let $\\mathfrak q\' \\subset S$ be a prime of $S$ mapping to $\\mathfrak p\'$. Then there exists a prime $\\mathfrak q \\subset \\mathfrak q\'$ mapping to $\\mathfrak p$. \n\n    \n,Proof.\n      By Lemma 10.39.18 the local ring map $R_{\\mathfrak p\'} \\to S_{\\mathfrak q\'}$ is flat. By Lemma 10.39.17 this local ring map is faithfully flat. By Lemma 10.39.16 there is a prime mapping to $\\mathfrak p R_{\\mathfrak p\'}$. The inverse image of this prime in $S$ does the job. \n      $\\square$\n    \n," by
  apply of_comap_localRingHom_surjective
  intro P hP
  have : IsLocalHom (algebraMap (Localization.AtPrime <| P.under R) (Localization.AtPrime P)) := by
    rw [RingHom.algebraMap_toAlgebra]
    exact Localization.isLocalHom_localRingHom (P.under R) P (algebraMap R S) Ideal.LiesOver.over
  have : Module.FaithfullyFlat (Localization.AtPrime (P.under R)) (Localization.AtPrime P) :=
    Module.FaithfullyFlat.of_flat_of_isLocalHom
  apply PrimeSpectrum.comap_surjective_of_faithfullyFlat
",instance of_flat [Module.Flat R S] : Algebra.HasGoingDown R S ,"Proof.\n      By Lemma 10.39.18 [[\n  Lemma 10.39.18. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. \n  \n  \nThe localization $S^{-1}R$ is a flat $R$-algebra. \n\n\nIf $M$ is an $S^{-1}R$-module, then $M$ is a flat $R$-module if and only if $M$ is a flat $S^{-1}R$-module. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak p}$ is a flat $R_{\\mathfrak p}$-module for all primes $\\mathfrak p$ of $R$. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak m}$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n\nSuppose $R \\to A$ is a ring map, $M$ is an $A$-module, and $g_1, \\ldots , g_ m \\in A$ are elements generating the unit ideal of $A$. Then $M$ is flat over $R$ if and only if each localization $M_{g_ i}$ is flat over $R$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak q}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p$ the prime of $R$ lying under $\\mathfrak q$) for all primes $\\mathfrak q$ of $A$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p = R \\cap \\mathfrak m$) for all maximal ideals $\\mathfrak m$ of $A$. \n\n\n\n\n    \n]] the local ring map $R_{\\mathfrak p\'} \\to S_{\\mathfrak q\'}$ is flat. By Lemma 10.39.17 [[\n  Lemma 10.39.17. A flat local ring homomorphism of local rings is faithfully flat. \n\n    \n]] this local ring map is faithfully flat. By Lemma 10.39.16 [[\n  Lemma 10.39.16. Let $R \\to S$ be a flat ring map. The following are equivalent: \n  \n  \n$R \\to S$ is faithfully flat, \n\n\nthe induced map on $\\mathop{\\mathrm{Spec}}$ is surjective, and \n\n\nany closed point $x \\in \\mathop{\\mathrm{Spec}}(R)$ is in the image of the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. \n\n\n\n\n    \n]] there is a prime mapping to $\\mathfrak p R_{\\mathfrak p\'}$. The inverse image of this prime in $S$ does the job. \n      $\\square$\n    \n","Proof.\n      By Lemma 10.39.18 [[\n  Lemma 10.39.18. Let $R$ be a ring. Let $S \\subset R$ be a multiplicative subset. \n  \n  \nThe localization $S^{-1}R$ is a flat $R$-algebra. \n\n\nIf $M$ is an $S^{-1}R$-module, then $M$ is a flat $R$-module if and only if $M$ is a flat $S^{-1}R$-module. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak p}$ is a flat $R_{\\mathfrak p}$-module for all primes $\\mathfrak p$ of $R$. \n\n\nSuppose $M$ is an $R$-module. Then $M$ is a flat $R$-module if and only if $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak m}$-module for all maximal ideals $\\mathfrak m$ of $R$. \n\n\nSuppose $R \\to A$ is a ring map, $M$ is an $A$-module, and $g_1, \\ldots , g_ m \\in A$ are elements generating the unit ideal of $A$. Then $M$ is flat over $R$ if and only if each localization $M_{g_ i}$ is flat over $R$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak q}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p$ the prime of $R$ lying under $\\mathfrak q$) for all primes $\\mathfrak q$ of $A$. \n\n\nSuppose $R \\to A$ is a ring map, and $M$ is an $A$-module. Then $M$ is a flat $R$-module if and only if the localization $M_{\\mathfrak m}$ is a flat $R_{\\mathfrak p}$-module (with $\\mathfrak p = R \\cap \\mathfrak m$) for all maximal ideals $\\mathfrak m$ of $A$. \n\n\n\n\n    \n]] the local ring map $R_{\\mathfrak p\'} \\to S_{\\mathfrak q\'}$ is flat. By Lemma 10.39.17 [[\n  Lemma 10.39.17. A flat local ring homomorphism of local rings is faithfully flat. \n\n    \n]] this local ring map is faithfully flat. By Lemma 10.39.16 [[\n  Lemma 10.39.16. Let $R \\to S$ be a flat ring map. The following are equivalent: \n  \n  \n$R \\to S$ is faithfully flat, \n\n\nthe induced map on $\\mathop{\\mathrm{Spec}}$ is surjective, and \n\n\nany closed point $x \\in \\mathop{\\mathrm{Spec}}(R)$ is in the image of the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. \n\n\n\n\n    \n]] there is a prime mapping to $\\mathfrak p R_{\\mathfrak p\'}$. The inverse image of this prime in $S$ does the job. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs aim to show surjectivity on prime spectra by proving that for each prime P the induced localized map R_{p} ‚Üí S_{P} is faithfully flat, then invoking the standard result that faithfully flat maps induce surjective maps on Spec. The Lean proof constructs an `IsLocalHom` for the localization map, then uses `Module.FaithfullyFlat.of_flat_of_isLocalHom` (flat + local ‚áí faithfully flat) and finally applies `PrimeSpectrum.comap_surjective_of_faithfullyFlat`, matching the informal chain (flatness of localization ‚Üí faithfully flatness of local map ‚Üí Spec surjectivity). Structurally, the Lean proof is a compressed version: it does not explicitly reference the intermediate lemmas about flatness of localization (Lemma 10.39.18) or the equivalence characterization (Lemma 10.39.16), instead using bundled library lemmas that encapsulate these steps. Also, the informal proof mentions producing a prime over pRp and then pulling back to S; Lean directly concludes comap-surjectivity without describing that construction. Overall the core logical content aligns well, with minor differences in explicit intermediate steps.""}"
284,00OM,"lemma Ideal.height_le_height_add_of_liesOver [IsNoetherianRing S] (p : Ideal R) [p.IsPrime]
      (P : Ideal S) [P.IsPrime] [P.LiesOver p] :
    P.height ‚â§ p.height +
      (P.map (Ideal.Quotient.mk <| p.map (algebraMap R S))).height := by
  classical
  obtain ‚ü®s, hp, heq‚ü© := p.exists_finset_card_eq_height_of_isNoetherianRing
  let P' := P.map (Ideal.Quotient.mk <| p.map (algebraMap R S))
  obtain ‚ü®s', hP', heq'‚ü© := P'.exists_finset_card_eq_height_of_isNoetherianRing
  have hsP'sub : (s' : Set <| S ‚ß∏ (Ideal.map (algebraMap R S) p)) ‚äÜ (P' : Set <| S ‚ß∏ _) :=
    fun x hx ‚Ü¶ hP'.1.2 (Ideal.subset_span hx)
  have : Set.SurjOn (Ideal.Quotient.mk (p.map (algebraMap R S))) P s' := by
    refine Set.SurjOn.mono subset_rfl hsP'sub fun x hx ‚Ü¶ ?_
    obtain ‚ü®y, rfl‚ü© := Ideal.Quotient.mk_surjective x
    rw [SetLike.mem_coe, Ideal.mem_quotient_iff_mem] at hx
    ¬∑ use y, hx
    ¬∑ rw [Ideal.map_le_iff_le_comap, Ideal.LiesOver.over (p := p) (P := P)]
  obtain ‚ü®o, ho, hinj, himgo‚ü© := s'.exists_subset_injOn_image_eq_of_surjOn (P : Set S) this
  let t : Finset S := Finset.image (algebraMap R S) s ‚à™ o
  suffices h : P.height ‚â§ t.card by
    rw [‚Üê heq, ‚Üê heq']
    apply le_trans h
    norm_cast
    refine le_trans (Finset.card_union_le _ _) (add_le_add Finset.card_image_le ?_)
    rw [‚Üê himgo, Finset.card_image_of_injOn hinj]
  refine Ideal.height_le_card_of_mem_minimalPrimes_span_finset ?_
  have : Ideal.span t = Ideal.map (algebraMap R S) (.span s) ‚äî .span o := by
    simp [t, Ideal.span_union, Ideal.map_span]
  refine this ‚ñ∏ map_sup_mem_minimalPrimes_of_map_quotientMk_mem_minimalPrimes hp (span_le.mpr ho) ?_
  convert hP'
  simp [Ideal.map_span, ‚Üê himgo]
",Formal Proof of Stacks Project Tag 00OM,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/KrullsHeightTheorem.lean#L323-L352,Q27041,,10.112.6,lemma,3.0,"['00OG', '00AO', '0ELQ']","\n  Lemma 10.112.6. Let $R \\to S$ be a homomorphism of Noetherian rings. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p$. Then \n  \n  \\[  \\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}).  \\]\n\n\n    \n      Proof.\n      We use the characterization of dimension of Proposition 10.60.9. Let $x_1, \\ldots , x_ d$ be elements of $\\mathfrak p$ generating an ideal of definition of $R_{\\mathfrak p}$ with $d = \\dim (R_{\\mathfrak p})$. Let $y_1, \\ldots , y_ e$ be elements of $\\mathfrak q$ generating an ideal of definition of $S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}$ with $e = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. It is clear that $S_{\\mathfrak q}/(x_1, \\ldots , x_ d, y_1, \\ldots , y_ e)$ has a nilpotent maximal ideal. Hence $x_1, \\ldots , x_ d, y_1, \\ldots , y_ e$ generate an ideal of definition of $S_{\\mathfrak q}$. \n      $\\square$\n    \n",\n  Lemma 10.112.6. Let $R \\to S$ be a homomorphism of Noetherian rings. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p$. Then \n  \n  \\[  \\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}).  \\]\n\n\n    \n,"Proof.\n      We use the characterization of dimension of Proposition 10.60.9. Let $x_1, \\ldots , x_ d$ be elements of $\\mathfrak p$ generating an ideal of definition of $R_{\\mathfrak p}$ with $d = \\dim (R_{\\mathfrak p})$. Let $y_1, \\ldots , y_ e$ be elements of $\\mathfrak q$ generating an ideal of definition of $S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}$ with $e = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. It is clear that $S_{\\mathfrak q}/(x_1, \\ldots , x_ d, y_1, \\ldots , y_ e)$ has a nilpotent maximal ideal. Hence $x_1, \\ldots , x_ d, y_1, \\ldots , y_ e$ generate an ideal of definition of $S_{\\mathfrak q}$. \n      $\\square$\n    \n"," by
  classical
  obtain ‚ü®s, hp, heq‚ü© := p.exists_finset_card_eq_height_of_isNoetherianRing
  let P' := P.map (Ideal.Quotient.mk <| p.map (algebraMap R S))
  obtain ‚ü®s', hP', heq'‚ü© := P'.exists_finset_card_eq_height_of_isNoetherianRing
  have hsP'sub : (s' : Set <| S ‚ß∏ (Ideal.map (algebraMap R S) p)) ‚äÜ (P' : Set <| S ‚ß∏ _) :=
    fun x hx ‚Ü¶ hP'.1.2 (Ideal.subset_span hx)
  have : Set.SurjOn (Ideal.Quotient.mk (p.map (algebraMap R S))) P s' := by
    refine Set.SurjOn.mono subset_rfl hsP'sub fun x hx ‚Ü¶ ?_
    obtain ‚ü®y, rfl‚ü© := Ideal.Quotient.mk_surjective x
    rw [SetLike.mem_coe, Ideal.mem_quotient_iff_mem] at hx
    ¬∑ use y, hx
    ¬∑ rw [Ideal.map_le_iff_le_comap, Ideal.LiesOver.over (p := p) (P := P)]
  obtain ‚ü®o, ho, hinj, himgo‚ü© := s'.exists_subset_injOn_image_eq_of_surjOn (P : Set S) this
  let t : Finset S := Finset.image (algebraMap R S) s ‚à™ o
  suffices h : P.height ‚â§ t.card by
    rw [‚Üê heq, ‚Üê heq']
    apply le_trans h
    norm_cast
    refine le_trans (Finset.card_union_le _ _) (add_le_add Finset.card_image_le ?_)
    rw [‚Üê himgo, Finset.card_image_of_injOn hinj]
  refine Ideal.height_le_card_of_mem_minimalPrimes_span_finset ?_
  have : Ideal.span t = Ideal.map (algebraMap R S) (.span s) ‚äî .span o := by
    simp [t, Ideal.span_union, Ideal.map_span]
  refine this ‚ñ∏ map_sup_mem_minimalPrimes_of_map_quotientMk_mem_minimalPrimes hp (span_le.mpr ho) ?_
  convert hP'
  simp [Ideal.map_span, ‚Üê himgo]
","lemma Ideal.height_le_height_add_of_liesOver [IsNoetherianRing S] (p : Ideal R) [p.IsPrime]
      (P : Ideal S) [P.IsPrime] [P.LiesOver p] :
    P.height ‚â§ p.height +
      (P.map (Ideal.Quotient.mk <| p.map (algebraMap R S))).height ","Proof.\n      We use the characterization of dimension of Proposition 10.60.9 [[\n  Proposition 10.60.9. Let $R$ be a local Noetherian ring. Let $d \\geq 0$ be an integer. The following are equivalent: \n  \n  \n $\\dim (R) = d$, \n\n\n $d(R) = d$, \n\n\n there exists an ideal of definition generated by $d$ elements, and no ideal of definition is generated by fewer than $d$ elements. \n\n\n\n\n    \n]]. Let $x_1, \\ldots , x_ d$ be elements of $\\mathfrak p$ generating an ideal of definition of $R_{\\mathfrak p}$ with $d = \\dim (R_{\\mathfrak p})$. Let $y_1, \\ldots , y_ e$ be elements of $\\mathfrak q$ generating an ideal of definition of $S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}$ with $e = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. It is clear that $S_{\\mathfrak q}/(x_1, \\ldots , x_ d, y_1, \\ldots , y_ e)$ has a nilpotent maximal ideal. Hence $x_1, \\ldots , x_ d, y_1, \\ldots , y_ e$ generate an ideal of definition of $S_{\\mathfrak q}$. \n      $\\square$\n    \n","Proof.\n      We use the characterization of dimension of Proposition 10.60.9 [[\n  Proposition 10.60.9. Let $R$ be a local Noetherian ring. Let $d \\geq 0$ be an integer. The following are equivalent: \n  \n  \n $\\dim (R) = d$, \n\n\n $d(R) = d$, \n\n\n there exists an ideal of definition generated by $d$ elements, and no ideal of definition is generated by fewer than $d$ elements. \n\n\n\n\n    \n]]. Let $x_1, \\ldots , x_ d$ be elements of $\\mathfrak p$ generating an ideal of definition of $R_{\\mathfrak p}$ with $d = \\dim (R_{\\mathfrak p})$. Let $y_1, \\ldots , y_ e$ be elements of $\\mathfrak q$ generating an ideal of definition of $S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}$ with $e = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. It is clear that $S_{\\mathfrak q}/(x_1, \\ldots , x_ d, y_1, \\ldots , y_ e)$ has a nilpotent maximal ideal. Hence $x_1, \\ldots , x_ d, y_1, \\ldots , y_ e$ generate an ideal of definition of $S_{\\mathfrak q}$. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues via a dimension/ideal-of-definition characterization: choose d generators in p for an ideal of definition of R_p and e generators in q for an ideal of definition of S_q/pS_q, then conclude the combined set generates an ideal of definition of S_q (using the nilpotence of the maximal ideal in the quotient). The Lean proof instead works with heights of primes and finset-card characterizations of height in Noetherian rings, constructs a finset t as the union of images of generators from p and a subset o coming from a surjectivity/injectivity argument on quotients, and then proves an inequality P.height ‚â§ t.card using minimal primes of spans and mapping/quotient lemmas. Structurally, the informal proof is a direct generator-stacking argument in localizations/quotients, while the formal proof is a height/cardinality bound using finset and minimal-prime machinery; it does not explicitly mirror the localization/ideal-of-definition/nilpotent-maximal-ideal step. There is some thematic overlap (bounding dimension/height by number of generators and combining generators from p and the quotient), but key steps and objects (ideals of definition, local rings, nilpotence argument) are absent from the formal proof, and the formal proof introduces additional quotient-surjectivity/injOn-image constructions not present informally.""}"
285,00ON,"lemma Ideal.height_eq_height_add_of_liesOver_of_hasGoingDown [IsNoetherianRing S]
    [Algebra.HasGoingDown R S] (p : Ideal R) [p.IsPrime] (P : Ideal S) [P.IsPrime] [P.LiesOver p] :
    P.height = p.height +
      (P.map (Ideal.Quotient.mk <| p.map (algebraMap R S))).height := by
  refine le_antisymm (height_le_height_add_of_liesOver p P) ?_
  obtain ‚ü®lp, hlp, hlenp‚ü© := p.exists_ltSeries_length_eq_height
  obtain ‚ü®lq, hlq, hlenq‚ü© :=
    (P.map (Quotient.mk (p.map (algebraMap R S)))).exists_ltSeries_length_eq_height
  let l' : LTSeries (PrimeSpectrum S) :=
    lq.map (PrimeSpectrum.comap (Quotient.mk (p.map (algebraMap R S))))
      (RingHom.strictMono_comap_of_surjective Quotient.mk_surjective)
  have : l'.head.asIdeal.LiesOver lp.last.asIdeal := by
    simp only [LTSeries.head_map, hlp, l']
    refine ‚ü®?_‚ü©
    refine le_antisymm ?_ ?_
    ¬∑ rw [‚Üê map_le_iff_le_comap, PrimeSpectrum.comap_asIdeal, ‚Üê map_le_iff_le_comap]
      simp
    ¬∑ conv_rhs => rw [LiesOver.over (p := p) (P := P), under_def]
      refine comap_mono (le_trans (comap_mono (lq.head_le_last)) ?_)
      simp [hlq, map_le_iff_le_comap, LiesOver.over (p := p) (P := P)]
  obtain ‚ü®lp', hlp'len, hlp', _‚ü© := exists_ltSeries_of_hasGoingDown lp l'.head.asIdeal
  have : (lp'.smash l' hlp').length = lp.length + lq.length := by simp [hlp'len, l']
  rw [‚Üê hlenp, ‚Üê hlenq, ‚Üê Nat.cast_add, ‚Üê this, height_eq_primeHeight]
  apply Order.length_le_height
  simp [hlq, l', ‚Üê PrimeSpectrum.asIdeal_le_asIdeal, map_le_iff_le_comap,
    LiesOver.over (p := p) (P := P)]
",Formal Proof of Stacks Project Tag 00ON,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/KrullsHeightTheorem.lean#L360-L385,Q27041,,10.112.7,lemma,3.0,"['00OG', '00AO', '0ELQ']","\n  Lemma 10.112.7. Let $R \\to S$ be a homomorphism of Noetherian rings. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p$. Assume the going down property holds for $R \\to S$ (for example if $R \\to S$ is flat, see Lemma 10.39.19). Then \n  \n  \\[  \\dim (S_{\\mathfrak q}) = \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}).  \\]\n\n\n    \n      Proof.\n      By Lemma 10.112.6 we have an inequality $\\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. To get equality, choose a chain of primes $\\mathfrak pS \\subset \\mathfrak q_0 \\subset \\mathfrak q_1 \\subset \\ldots \\subset \\mathfrak q_ d = \\mathfrak q$ with $d = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. On the other hand, choose a chain of primes $\\mathfrak p_0 \\subset \\mathfrak p_1 \\subset \\ldots \\subset \\mathfrak p_ e = \\mathfrak p$ with $e = \\dim (R_{\\mathfrak p})$. By the going down theorem we may choose $\\mathfrak q_{-1} \\subset \\mathfrak q_0$ lying over $\\mathfrak p_{e-1}$. And then we may choose $\\mathfrak q_{-2} \\subset \\mathfrak q_{-1}$ lying over $\\mathfrak p_{e-2}$. Inductively we keep going until we get a chain $\\mathfrak q_{-e} \\subset \\ldots \\subset \\mathfrak q_ d$ of length $e + d$. \n      $\\square$\n    \n","\n  Lemma 10.112.7. Let $R \\to S$ be a homomorphism of Noetherian rings. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p$. Assume the going down property holds for $R \\to S$ (for example if $R \\to S$ is flat, see Lemma 10.39.19). Then \n  \n  \\[  \\dim (S_{\\mathfrak q}) = \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}).  \\]\n\n\n    \n","Proof.\n      By Lemma 10.112.6 we have an inequality $\\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. To get equality, choose a chain of primes $\\mathfrak pS \\subset \\mathfrak q_0 \\subset \\mathfrak q_1 \\subset \\ldots \\subset \\mathfrak q_ d = \\mathfrak q$ with $d = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. On the other hand, choose a chain of primes $\\mathfrak p_0 \\subset \\mathfrak p_1 \\subset \\ldots \\subset \\mathfrak p_ e = \\mathfrak p$ with $e = \\dim (R_{\\mathfrak p})$. By the going down theorem we may choose $\\mathfrak q_{-1} \\subset \\mathfrak q_0$ lying over $\\mathfrak p_{e-1}$. And then we may choose $\\mathfrak q_{-2} \\subset \\mathfrak q_{-1}$ lying over $\\mathfrak p_{e-2}$. Inductively we keep going until we get a chain $\\mathfrak q_{-e} \\subset \\ldots \\subset \\mathfrak q_ d$ of length $e + d$. \n      $\\square$\n    \n"," by
  refine le_antisymm (height_le_height_add_of_liesOver p P) ?_
  obtain ‚ü®lp, hlp, hlenp‚ü© := p.exists_ltSeries_length_eq_height
  obtain ‚ü®lq, hlq, hlenq‚ü© :=
    (P.map (Quotient.mk (p.map (algebraMap R S)))).exists_ltSeries_length_eq_height
  let l' : LTSeries (PrimeSpectrum S) :=
    lq.map (PrimeSpectrum.comap (Quotient.mk (p.map (algebraMap R S))))
      (RingHom.strictMono_comap_of_surjective Quotient.mk_surjective)
  have : l'.head.asIdeal.LiesOver lp.last.asIdeal := by
    simp only [LTSeries.head_map, hlp, l']
    refine ‚ü®?_‚ü©
    refine le_antisymm ?_ ?_
    ¬∑ rw [‚Üê map_le_iff_le_comap, PrimeSpectrum.comap_asIdeal, ‚Üê map_le_iff_le_comap]
      simp
    ¬∑ conv_rhs => rw [LiesOver.over (p := p) (P := P), under_def]
      refine comap_mono (le_trans (comap_mono (lq.head_le_last)) ?_)
      simp [hlq, map_le_iff_le_comap, LiesOver.over (p := p) (P := P)]
  obtain ‚ü®lp', hlp'len, hlp', _‚ü© := exists_ltSeries_of_hasGoingDown lp l'.head.asIdeal
  have : (lp'.smash l' hlp').length = lp.length + lq.length := by simp [hlp'len, l']
  rw [‚Üê hlenp, ‚Üê hlenq, ‚Üê Nat.cast_add, ‚Üê this, height_eq_primeHeight]
  apply Order.length_le_height
  simp [hlq, l', ‚Üê PrimeSpectrum.asIdeal_le_asIdeal, map_le_iff_le_comap,
    LiesOver.over (p := p) (P := P)]
","lemma Ideal.height_eq_height_add_of_liesOver_of_hasGoingDown [IsNoetherianRing S]
    [Algebra.HasGoingDown R S] (p : Ideal R) [p.IsPrime] (P : Ideal S) [P.IsPrime] [P.LiesOver p] :
    P.height = p.height +
      (P.map (Ideal.Quotient.mk <| p.map (algebraMap R S))).height ","Proof.\n      By Lemma 10.112.6 [[\n  Lemma 10.112.6. Let $R \\to S$ be a homomorphism of Noetherian rings. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p$. Then \n  \n  \\[  \\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}).  \\]\n\n\n    \n]] we have an inequality $\\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. To get equality, choose a chain of primes $\\mathfrak pS \\subset \\mathfrak q_0 \\subset \\mathfrak q_1 \\subset \\ldots \\subset \\mathfrak q_ d = \\mathfrak q$ with $d = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. On the other hand, choose a chain of primes $\\mathfrak p_0 \\subset \\mathfrak p_1 \\subset \\ldots \\subset \\mathfrak p_ e = \\mathfrak p$ with $e = \\dim (R_{\\mathfrak p})$. By the going down theorem we may choose $\\mathfrak q_{-1} \\subset \\mathfrak q_0$ lying over $\\mathfrak p_{e-1}$. And then we may choose $\\mathfrak q_{-2} \\subset \\mathfrak q_{-1}$ lying over $\\mathfrak p_{e-2}$. Inductively we keep going until we get a chain $\\mathfrak q_{-e} \\subset \\ldots \\subset \\mathfrak q_ d$ of length $e + d$. \n      $\\square$\n    \n","Proof.\n      By Lemma 10.112.6 [[\n  Lemma 10.112.6. Let $R \\to S$ be a homomorphism of Noetherian rings. Let $\\mathfrak q \\subset S$ be a prime lying over the prime $\\mathfrak p$. Then \n  \n  \\[  \\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q}).  \\]\n\n\n    \n]] we have an inequality $\\dim (S_{\\mathfrak q}) \\leq \\dim (R_{\\mathfrak p}) + \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. To get equality, choose a chain of primes $\\mathfrak pS \\subset \\mathfrak q_0 \\subset \\mathfrak q_1 \\subset \\ldots \\subset \\mathfrak q_ d = \\mathfrak q$ with $d = \\dim (S_{\\mathfrak q}/\\mathfrak pS_{\\mathfrak q})$. On the other hand, choose a chain of primes $\\mathfrak p_0 \\subset \\mathfrak p_1 \\subset \\ldots \\subset \\mathfrak p_ e = \\mathfrak p$ with $e = \\dim (R_{\\mathfrak p})$. By the going down theorem we may choose $\\mathfrak q_{-1} \\subset \\mathfrak q_0$ lying over $\\mathfrak p_{e-1}$. And then we may choose $\\mathfrak q_{-2} \\subset \\mathfrak q_{-1}$ lying over $\\mathfrak p_{e-2}$. Inductively we keep going until we get a chain $\\mathfrak q_{-e} \\subset \\ldots \\subset \\mathfrak q_ d$ of length $e + d$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is proving the same kind of dimension/height additivity statement under a LiesOver/going-down setup: it first establishes one inequality via `le_antisymm (height_le_height_add_of_liesOver p P)`, matching the informal proof‚Äôs use of a known lemma giving ‚Äú‚â§‚Äù. For the reverse inequality, it constructs maximal-length chains (`exists_ltSeries_length_eq_height` for both the base prime `p` and the fiber/quotient prime coming from `P.map (Quotient.mk ...)`), then uses going down (`exists_ltSeries_of_hasGoingDown`) to lift/extend the chain and finally smashes the chains (`lp'.smash l'`) to get a chain of length equal to the sum, concluding with `Order.length_le_height`. Structurally this mirrors the informal argument: pick a chain in the fiber of length d, pick a chain in the base of length e, use going down to extend downward and concatenate to get length e+d.\n\nDifferences: the informal proof is phrased in terms of Krull dimensions of localizations and quotients, while the Lean proof is phrased in terms of heights in `PrimeSpectrum` and uses explicit quotient/comap machinery (`Quotient.mk`, `PrimeSpectrum.comap`, `LiesOver.over/under_def`) to represent the fiber prime chain. These are implementation details rather than a different mathematical strategy, but they make the correspondence less direct. Overall the core lemma usage (‚â§ then chain construction + going down for ‚â•) aligns well.""}"
287,05KE,"theorem isPrime_of_maximal_not {I : Ideal R} (hI : Maximal (¬¨P ¬∑) I) : I.IsPrime where
  ne_top' hI' := hI.prop (hI' ‚ñ∏ hP.top)
  mem_or_mem' := by
    by_contra! ‚ü®a, b, hab, ha, hb‚ü©
    have h‚ÇÅ : P (I ‚äî span {a}) := of_not_not <| hI.not_prop_of_gt (Submodule.lt_sup_iff_notMem.2 ha)
    have h‚ÇÇ : P (I.colon (span {a})) := of_not_not <| hI.not_prop_of_gt <| lt_of_le_of_ne le_colon
      (fun H ‚Ü¶ hb <| H ‚ñ∏ mem_colon_span_singleton.2 (mul_comm a b ‚ñ∏ hab))
    exact hI.prop (hP.oka h‚ÇÅ h‚ÇÇ)
",Formal Proof of Stacks Project Tag 05KE,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/Oka.lean#L49-L56,Q27041,,10.28.8,proposition,3.0,"['05K7', '00AO', '0ELQ']","\n  Proposition 10.28.8. If $\\mathcal{F}$ is an Oka family of ideals, then any maximal element of the complement of $\\mathcal{F}$ is prime. \n\n    \n      Proof.\n      Suppose $I \\not\\in \\mathcal{F}$ is maximal with respect to not being in $\\mathcal{F}$ but $I$ is not prime. Note that $I \\not= R$ because $R \\in \\mathcal{F}$. Since $I$ is not prime we can find $a, b \\in R - I$ with $ab \\in I$. It follows that $(I, a) \\neq I$ and $(I : a)$ contains $b \\not\\in I$ so also $(I : a) \\neq I$. Thus $(I : a), (I, a)$ both strictly contain $I$, so they must belong to $\\mathcal{F}$. By the Oka condition, we have $I \\in \\mathcal{F}$, a contradiction. \n      $\\square$\n    \n","\n  Proposition 10.28.8. If $\\mathcal{F}$ is an Oka family of ideals, then any maximal element of the complement of $\\mathcal{F}$ is prime. \n\n    \n","Proof.\n      Suppose $I \\not\\in \\mathcal{F}$ is maximal with respect to not being in $\\mathcal{F}$ but $I$ is not prime. Note that $I \\not= R$ because $R \\in \\mathcal{F}$. Since $I$ is not prime we can find $a, b \\in R - I$ with $ab \\in I$. It follows that $(I, a) \\neq I$ and $(I : a)$ contains $b \\not\\in I$ so also $(I : a) \\neq I$. Thus $(I : a), (I, a)$ both strictly contain $I$, so they must belong to $\\mathcal{F}$. By the Oka condition, we have $I \\in \\mathcal{F}$, a contradiction. \n      $\\square$\n    \n"," hI.prop (hI' ‚ñ∏ hP.top)
  mem_or_mem' := by
    by_contra! ‚ü®a, b, hab, ha, hb‚ü©
    have h‚ÇÅ : P (I ‚äî span {a}) := of_not_not <| hI.not_prop_of_gt (Submodule.lt_sup_iff_notMem.2 ha)
    have h‚ÇÇ : P (I.colon (span {a})) := of_not_not <| hI.not_prop_of_gt <| lt_of_le_of_ne le_colon
      (fun H ‚Ü¶ hb <| H ‚ñ∏ mem_colon_span_singleton.2 (mul_comm a b ‚ñ∏ hab))
    exact hI.prop (hP.oka h‚ÇÅ h‚ÇÇ)
","theorem isPrime_of_maximal_not {I : Ideal R} (hI : Maximal (¬¨P ¬∑) I) : I.IsPrime where
  ne_top' hI' ","Proof.\n      Suppose $I \\not\\in \\mathcal{F}$ is maximal with respect to not being in $\\mathcal{F}$ but $I$ is not prime. Note that $I \\not= R$ because $R \\in \\mathcal{F}$. Since $I$ is not prime we can find $a, b \\in R - I$ with $ab \\in I$. It follows that $(I, a) \\neq I$ and $(I : a)$ contains $b \\not\\in I$ so also $(I : a) \\neq I$. Thus $(I : a), (I, a)$ both strictly contain $I$, so they must belong to $\\mathcal{F}$. By the Oka condition, we have $I \\in \\mathcal{F}$, a contradiction. \n      $\\square$\n    \n","Proof.\n      Suppose $I \\not\\in \\mathcal{F}$ is maximal with respect to not being in $\\mathcal{F}$ but $I$ is not prime. Note that $I \\not= R$ because $R \\in \\mathcal{F}$. Since $I$ is not prime we can find $a, b \\in R - I$ with $ab \\in I$. It follows that $(I, a) \\neq I$ and $(I : a)$ contains $b \\not\\in I$ so also $(I : a) \\neq I$. Thus $(I : a), (I, a)$ both strictly contain $I$, so they must belong to $\\mathcal{F}$. By the Oka condition, we have $I \\in \\mathcal{F}$, a contradiction. \n      $\\square$\n    \n","{""Alignment Score"": ""5"", ""brief_justification"": ""Semantically, the Lean proof matches the informal argument: it assumes by contradiction that the maximal counterexample I is not prime by producing a,b with ab‚ààI and a,b‚àâI, then shows the two larger ideals/submodules (I ‚äî span{a}) and (I.colon (span{a})) satisfy P (i.e., lie in the family), and finally applies the Oka condition to conclude P I, contradicting maximality.\n\nStructurally, the correspondence is very close: `by_contra! ‚ü®a,b,hab,ha,hb‚ü©` is the ‚Äúchoose a,b‚àâI with ab‚ààI‚Äù step; `Submodule.lt_sup_iff_notMem.2 ha` proves (I,a)‚â†I (strict containment) and `lt_of_le_of_ne le_colon ...` together with `mem_colon_span_singleton` and `hab`/`hb` proves (I:a)‚â†I (strict containment). Then `hI.not_prop_of_gt` + `of_not_not` implements ‚Äústrictly contain I ‚áí must be in F‚Äù, and `hP.oka h‚ÇÅ h‚ÇÇ` is exactly the Oka condition yielding P I, contradicting `hI.prop`/maximality. No extraneous steps beyond formalizing these containments and membership facts.""}"
288,00DS,"theorem subset_union_prime {R : Type u} [CommRing R] {s : Finset Œπ} {f : Œπ ‚Üí Ideal R} (a b : Œπ)
    (hp : ‚àÄ i ‚àà s, i ‚â† a ‚Üí i ‚â† b ‚Üí IsPrime (f i)) {I : Ideal R} :
    ((I : Set R) ‚äÜ ‚ãÉ i ‚àà (‚Üës : Set Œπ), f i) ‚Üî ‚àÉ i ‚àà s, I ‚â§ f i :=
  suffices ((I : Set R) ‚äÜ ‚ãÉ i ‚àà (‚Üës : Set Œπ), f i) ‚Üí ‚àÉ i, i ‚àà s ‚àß I ‚â§ f i by
    have aux := fun h => (bex_def.2 <| this h)
    simp_rw [exists_prop] at aux
    refine ‚ü®aux, fun ‚ü®i, his, hi‚ü© ‚Ü¶ Set.Subset.trans hi ?_‚ü©
    apply Set.subset_biUnion_of_mem (show i ‚àà (‚Üës : Set Œπ) from his)
  fun h : (I : Set R) ‚äÜ ‚ãÉ i ‚àà (‚Üës : Set Œπ), f i => by
  classical
    by_cases has : a ‚àà s
    ¬∑ obtain ‚ü®t, hat, rfl‚ü© : ‚àÉ t, a ‚àâ t ‚àß insert a t = s :=
        ‚ü®s.erase a, Finset.notMem_erase a s, Finset.insert_erase has‚ü©
      by_cases hbt : b ‚àà t
      ¬∑ obtain ‚ü®u, hbu, rfl‚ü© : ‚àÉ u, b ‚àâ u ‚àß insert b u = t :=
          ‚ü®t.erase b, Finset.notMem_erase b t, Finset.insert_erase hbt‚ü©
        have hp' : ‚àÄ i ‚àà u, IsPrime (f i) := by
          intro i hiu
          refine hp i (Finset.mem_insert_of_mem (Finset.mem_insert_of_mem hiu)) ?_ ?_ <;>
              rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Finset.coe_insert, Set.biUnion_insert, Set.biUnion_insert, ‚Üê
          Set.union_assoc, subset_union_prime' hp'] at h
        rwa [Finset.exists_mem_insert, Finset.exists_mem_insert]
      ¬∑ have hp' : ‚àÄ j ‚àà t, IsPrime (f j) := by
          intro j hj
          refine hp j (Finset.mem_insert_of_mem hj) ?_ ?_ <;> rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Set.biUnion_insert, ‚Üê Set.union_self (f a : Set R),
          subset_union_prime' hp', ‚Üê or_assoc, or_self_iff] at h
        rwa [Finset.exists_mem_insert]
    ¬∑ by_cases hbs : b ‚àà s
      ¬∑ obtain ‚ü®t, hbt, rfl‚ü© : ‚àÉ t, b ‚àâ t ‚àß insert b t = s :=
          ‚ü®s.erase b, Finset.notMem_erase b s, Finset.insert_erase hbs‚ü©
        have hp' : ‚àÄ j ‚àà t, IsPrime (f j) := by
          intro j hj
          refine hp j (Finset.mem_insert_of_mem hj) ?_ ?_ <;> rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Set.biUnion_insert, ‚Üê Set.union_self (f b : Set R),
          subset_union_prime' hp', ‚Üê or_assoc, or_self_iff] at h
        rwa [Finset.exists_mem_insert]
      rcases s.eq_empty_or_nonempty with hse | hsne
      ¬∑ subst hse
        rw [Finset.coe_empty, Set.biUnion_empty] at h
        exact (h I.zero_mem).elim
      ¬∑ obtain ‚ü®i, his‚ü© := hsne
        obtain ‚ü®t, _, rfl‚ü© : ‚àÉ t, i ‚àâ t ‚àß insert i t = s :=
          ‚ü®s.erase i, Finset.notMem_erase i s, Finset.insert_erase his‚ü©
        have hp' : ‚àÄ j ‚àà t, IsPrime (f j) := by
          intro j hj
          refine hp j (Finset.mem_insert_of_mem hj) ?_ ?_ <;> rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Set.biUnion_insert, ‚Üê Set.union_self (f i : Set R),
          subset_union_prime' hp', ‚Üê or_assoc, or_self_iff] at h
        rwa [Finset.exists_mem_insert]
",Formal Proof of Stacks Project Tag 00DS,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/Operations.lean#L1137-L1191,Q27041,Prime avoidance,10.15.2,lemma,3.0,"['00DR', '00AO', '0ELQ']","\n        \n      \n  Lemma 10.15.2 (Prime avoidance). Let $R$ be a ring. Let $I_ i \\subset R$, $i = 1, \\ldots , r$, and $J \\subset R$ be ideals. Assume \n  \n  \n$J \\not\\subset I_ i$ for $i = 1, \\ldots , r$, and \n\n\nall but two of $I_ i$ are prime ideals. \n\n\n\n   Then there exists an $x \\in J$, $x\\not\\in I_ i$ for all $i$. \n\n    \n      Proof.\n      The result is true for $r = 1$. If $r = 2$, then let $x, y \\in J$ with $x \\not\\in I_1$ and $y \\not\\in I_2$. We are done unless $x \\in I_2$ and $y \\in I_1$. Then the element $x + y$ cannot be in $I_1$ (since that would mean $x + y - y \\in I_1$) and it also cannot be in $I_2$. \n    \n      For $r \\geq 3$, assume the result holds for $r - 1$. After renumbering we may assume that $I_ r$ is prime. We may also assume there are no inclusions among the $I_ i$. Pick $x \\in J$, $x \\not\\in I_ i$ for all $i = 1, \\ldots , r - 1$. If $x \\not\\in I_ r$ we are done. So assume $x \\in I_ r$. If $J I_1 \\ldots I_{r - 1} \\subset I_ r$ then $J \\subset I_ r$ (by Lemma 10.15.1) a contradiction. Pick $y \\in J I_1 \\ldots I_{r - 1}$, $y \\not\\in I_ r$. Then $x + y$ works. \n      $\\square$\n    \n","\n        \n      \n  Lemma 10.15.2 (Prime avoidance). Let $R$ be a ring. Let $I_ i \\subset R$, $i = 1, \\ldots , r$, and $J \\subset R$ be ideals. Assume \n  \n  \n$J \\not\\subset I_ i$ for $i = 1, \\ldots , r$, and \n\n\nall but two of $I_ i$ are prime ideals. \n\n\n\n   Then there exists an $x \\in J$, $x\\not\\in I_ i$ for all $i$. \n\n    \n","Proof.\n      The result is true for $r = 1$. If $r = 2$, then let $x, y \\in J$ with $x \\not\\in I_1$ and $y \\not\\in I_2$. We are done unless $x \\in I_2$ and $y \\in I_1$. Then the element $x + y$ cannot be in $I_1$ (since that would mean $x + y - y \\in I_1$) and it also cannot be in $I_2$. \n    \n      For $r \\geq 3$, assume the result holds for $r - 1$. After renumbering we may assume that $I_ r$ is prime. We may also assume there are no inclusions among the $I_ i$. Pick $x \\in J$, $x \\not\\in I_ i$ for all $i = 1, \\ldots , r - 1$. If $x \\not\\in I_ r$ we are done. So assume $x \\in I_ r$. If $J I_1 \\ldots I_{r - 1} \\subset I_ r$ then $J \\subset I_ r$ (by Lemma 10.15.1) a contradiction. Pick $y \\in J I_1 \\ldots I_{r - 1}$, $y \\not\\in I_ r$. Then $x + y$ works. \n      $\\square$\n    \n","
  suffices ((I : Set R) ‚äÜ ‚ãÉ i ‚àà (‚Üës : Set Œπ), f i) ‚Üí ‚àÉ i, i ‚àà s ‚àß I ‚â§ f i by
    have aux := fun h => (bex_def.2 <| this h)
    simp_rw [exists_prop] at aux
    refine ‚ü®aux, fun ‚ü®i, his, hi‚ü© ‚Ü¶ Set.Subset.trans hi ?_‚ü©
    apply Set.subset_biUnion_of_mem (show i ‚àà (‚Üës : Set Œπ) from his)
  fun h : (I : Set R) ‚äÜ ‚ãÉ i ‚àà (‚Üës : Set Œπ), f i => by
  classical
    by_cases has : a ‚àà s
    ¬∑ obtain ‚ü®t, hat, rfl‚ü© : ‚àÉ t, a ‚àâ t ‚àß insert a t = s :=
        ‚ü®s.erase a, Finset.notMem_erase a s, Finset.insert_erase has‚ü©
      by_cases hbt : b ‚àà t
      ¬∑ obtain ‚ü®u, hbu, rfl‚ü© : ‚àÉ u, b ‚àâ u ‚àß insert b u = t :=
          ‚ü®t.erase b, Finset.notMem_erase b t, Finset.insert_erase hbt‚ü©
        have hp' : ‚àÄ i ‚àà u, IsPrime (f i) := by
          intro i hiu
          refine hp i (Finset.mem_insert_of_mem (Finset.mem_insert_of_mem hiu)) ?_ ?_ <;>
              rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Finset.coe_insert, Set.biUnion_insert, Set.biUnion_insert, ‚Üê
          Set.union_assoc, subset_union_prime' hp'] at h
        rwa [Finset.exists_mem_insert, Finset.exists_mem_insert]
      ¬∑ have hp' : ‚àÄ j ‚àà t, IsPrime (f j) := by
          intro j hj
          refine hp j (Finset.mem_insert_of_mem hj) ?_ ?_ <;> rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Set.biUnion_insert, ‚Üê Set.union_self (f a : Set R),
          subset_union_prime' hp', ‚Üê or_assoc, or_self_iff] at h
        rwa [Finset.exists_mem_insert]
    ¬∑ by_cases hbs : b ‚àà s
      ¬∑ obtain ‚ü®t, hbt, rfl‚ü© : ‚àÉ t, b ‚àâ t ‚àß insert b t = s :=
          ‚ü®s.erase b, Finset.notMem_erase b s, Finset.insert_erase hbs‚ü©
        have hp' : ‚àÄ j ‚àà t, IsPrime (f j) := by
          intro j hj
          refine hp j (Finset.mem_insert_of_mem hj) ?_ ?_ <;> rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Set.biUnion_insert, ‚Üê Set.union_self (f b : Set R),
          subset_union_prime' hp', ‚Üê or_assoc, or_self_iff] at h
        rwa [Finset.exists_mem_insert]
      rcases s.eq_empty_or_nonempty with hse | hsne
      ¬∑ subst hse
        rw [Finset.coe_empty, Set.biUnion_empty] at h
        exact (h I.zero_mem).elim
      ¬∑ obtain ‚ü®i, his‚ü© := hsne
        obtain ‚ü®t, _, rfl‚ü© : ‚àÉ t, i ‚àâ t ‚àß insert i t = s :=
          ‚ü®s.erase i, Finset.notMem_erase i s, Finset.insert_erase his‚ü©
        have hp' : ‚àÄ j ‚àà t, IsPrime (f j) := by
          intro j hj
          refine hp j (Finset.mem_insert_of_mem hj) ?_ ?_ <;> rintro rfl <;>
            solve_by_elim only [Finset.mem_insert_of_mem, *]
        rw [Finset.coe_insert, Set.biUnion_insert, ‚Üê Set.union_self (f i : Set R),
          subset_union_prime' hp', ‚Üê or_assoc, or_self_iff] at h
        rwa [Finset.exists_mem_insert]
","theorem subset_union_prime {R : Type u} [CommRing R] {s : Finset Œπ} {f : Œπ ‚Üí Ideal R} (a b : Œπ)
    (hp : ‚àÄ i ‚àà s, i ‚â† a ‚Üí i ‚â† b ‚Üí IsPrime (f i)) {I : Ideal R} :
    ((I : Set R) ‚äÜ ‚ãÉ i ‚àà (‚Üës : Set Œπ), f i) ‚Üî ‚àÉ i ‚àà s, I ‚â§ f i ","Proof.\n      The result is true for $r = 1$. If $r = 2$, then let $x, y \\in J$ with $x \\not\\in I_1$ and $y \\not\\in I_2$. We are done unless $x \\in I_2$ and $y \\in I_1$. Then the element $x + y$ cannot be in $I_1$ (since that would mean $x + y - y \\in I_1$) and it also cannot be in $I_2$. \n    \n      For $r \\geq 3$, assume the result holds for $r - 1$. After renumbering we may assume that $I_ r$ is prime. We may also assume there are no inclusions among the $I_ i$. Pick $x \\in J$, $x \\not\\in I_ i$ for all $i = 1, \\ldots , r - 1$. If $x \\not\\in I_ r$ we are done. So assume $x \\in I_ r$. If $J I_1 \\ldots I_{r - 1} \\subset I_ r$ then $J \\subset I_ r$ (by Lemma 10.15.1 [[\n  Lemma 10.15.1. Let $R$ be a ring, $I$ and $J$ two ideals and $\\mathfrak p$ a prime ideal containing the product $IJ$. Then $\\mathfrak {p}$ contains $I$ or $J$. \n\n    \n]]) a contradiction. Pick $y \\in J I_1 \\ldots I_{r - 1}$, $y \\not\\in I_ r$. Then $x + y$ works. \n      $\\square$\n    \n","Proof.\n      The result is true for $r = 1$. If $r = 2$, then let $x, y \\in J$ with $x \\not\\in I_1$ and $y \\not\\in I_2$. We are done unless $x \\in I_2$ and $y \\in I_1$. Then the element $x + y$ cannot be in $I_1$ (since that would mean $x + y - y \\in I_1$) and it also cannot be in $I_2$. \n    \n      For $r \\geq 3$, assume the result holds for $r - 1$. After renumbering we may assume that $I_ r$ is prime. We may also assume there are no inclusions among the $I_ i$. Pick $x \\in J$, $x \\not\\in I_ i$ for all $i = 1, \\ldots , r - 1$. If $x \\not\\in I_ r$ we are done. So assume $x \\in I_ r$. If $J I_1 \\ldots I_{r - 1} \\subset I_ r$ then $J \\subset I_ r$ (by Lemma 10.15.1 [[\n  Lemma 10.15.1. Let $R$ be a ring, $I$ and $J$ two ideals and $\\mathfrak p$ a prime ideal containing the product $IJ$. Then $\\mathfrak {p}$ contains $I$ or $J$. \n\n    \n]]) a contradiction. Pick $y \\in J I_1 \\ldots I_{r - 1}$, $y \\not\\in I_ r$. Then $x + y$ works. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof is an induction on the number r of ideals, using the prime-ideal property to handle the step r‚Üír‚àí1 and constructing an element x+y avoiding all ideals. The formal proof instead performs a detailed finite-set/Finset case split on membership of two distinguished indices a and b in a finite set s, repeatedly rewriting a union over an inserted element and applying a lemma `subset_union_prime'` (a prime-avoidance style lemma for unions) to extract an index i with I ‚â§ f i. This matches only a fragment of the informal argument (use of primeness to reduce a union/product situation), but it does not reflect the induction structure, the r=1/r=2 base cases, nor the explicit construction x+y and the product J I1‚Ä¶Ir‚àí1. Structurally the formal proof is about subset of a big union over a Finset and existence of a member, whereas the informal proof is about elements avoiding ideals and products of ideals. Thus there is partial thematic overlap (primeness used to split a containment), but overall the statements and proof architecture do not align well.""}"
289,02M3,"theorem subset_of_injective (hf : Function.Injective f) :
    associatedPrimes R M ‚äÜ associatedPrimes R M' := fun _I h => h.map_of_injective f hf
",Formal Proof of Stacks Project Tag 02M3,first part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/AssociatedPrime/Basic.lean#L103-L104,Q27041,,10.63.3,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.3. Let $R$ be a ring. Let $0 \\to M\' \\to M \\to M\'\' \\to 0$ be a short exact sequence of $R$-modules. Then $\\text{Ass}(M\') \\subset \\text{Ass}(M)$ and $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. Also $\\text{Ass}(M\' \\oplus M\'\') = \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. \n\n    \n      Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n",\n  Lemma 10.63.3. Let $R$ be a ring. Let $0 \\to M\' \\to M \\to M\'\' \\to 0$ be a short exact sequence of $R$-modules. Then $\\text{Ass}(M\') \\subset \\text{Ass}(M)$ and $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. Also $\\text{Ass}(M\' \\oplus M\'\') = \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. \n\n    \n,"Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n"," fun _I h => h.map_of_injective f hf
","theorem subset_of_injective (hf : Function.Injective f) :
    associatedPrimes R M ‚äÜ associatedPrimes R M' ","Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n","Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: first part","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about inclusions between sets of associated primes in a short exact sequence (showing Ass(M‚Ä≤) ‚äÜ Ass(M) and Ass(M) ‚äÜ Ass(M‚Ä≤) ‚à™ Ass(M‚Ä≥) via annihilators and localization-type arguments). The Lean term `fun _I h => h.map_of_injective f hf` instead applies a generic lemma `map_of_injective` to a hypothesis `h` using an injective map `f` (with proof `hf`), which is a very different statement (about mapping some structure along an injective function) and does not mention associated primes, annihilators, or the short exact sequence structure. Structurally, the informal proof has multiple case splits and set inclusions, while the Lean proof is a one-line function applying a lemma, with no reflection of the argument‚Äôs steps. Thus the formal proof does not capture the content of the informal proof‚Äôs first part beyond a vague possibility that an injective map is involved, so alignment is minimal.""}"
290,02M3,"theorem subset_union_of_exact (hf : Function.Injective f) (hfg : Function.Exact f g) :
    associatedPrimes R M' ‚äÜ associatedPrimes R M ‚à™ associatedPrimes R M'' := by
  rintro p ‚ü®_, x, hx‚ü©
  by_cases! h : ‚àÉ a ‚àà p.primeCompl, ‚àÉ y : M, f y = a ‚Ä¢ x
  ¬∑ obtain ‚ü®a, ha, y, h‚ü© := h
    left
    refine ‚ü®‚Äπ_‚Ä∫, y, le_antisymm (fun b hb ‚Ü¶ ?_) (fun b hb ‚Ü¶ ?_)‚ü©
    ¬∑ rw [hx] at hb
      rw [mem_colon_singleton, mem_bot] at hb ‚ä¢
      apply_fun _ using hf
      rw [map_smul, map_zero, h, smul_comm, hb, smul_zero]
    ¬∑ rw [mem_colon_singleton, mem_bot] at hb
      apply_fun f at hb
      rw [map_smul, map_zero, h, ‚Üê mul_smul, ‚Üê mem_bot R, ‚Üê mem_colon_singleton, ‚Üê hx] at hb
      contrapose hb
      exact p.primeCompl.mul_mem hb ha
  ¬∑ right
    refine ‚ü®‚Äπ_‚Ä∫, g x, le_antisymm (fun b hb ‚Ü¶ ?_) (fun b hb ‚Ü¶ ?_)‚ü©
    ¬∑ rw [hx] at hb
      rw [mem_colon_singleton, mem_bot] at hb ‚ä¢
      rw [‚Üê map_smul, hb, map_zero]
    ¬∑ rw [mem_colon_singleton, mem_bot, ‚Üê map_smul, ‚Üê LinearMap.mem_ker,
        hfg.linearMap_ker_eq] at hb
      obtain ‚ü®y, hy‚ü© := hb
      by_contra H
      exact h b H y hy
",Formal Proof of Stacks Project Tag 02M3,second part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/AssociatedPrime/Basic.lean#L109-L134,Q27041,,10.63.3,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.3. Let $R$ be a ring. Let $0 \\to M\' \\to M \\to M\'\' \\to 0$ be a short exact sequence of $R$-modules. Then $\\text{Ass}(M\') \\subset \\text{Ass}(M)$ and $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. Also $\\text{Ass}(M\' \\oplus M\'\') = \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. \n\n    \n      Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n",\n  Lemma 10.63.3. Let $R$ be a ring. Let $0 \\to M\' \\to M \\to M\'\' \\to 0$ be a short exact sequence of $R$-modules. Then $\\text{Ass}(M\') \\subset \\text{Ass}(M)$ and $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. Also $\\text{Ass}(M\' \\oplus M\'\') = \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. \n\n    \n,"Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n"," by
  rintro p ‚ü®_, x, hx‚ü©
  by_cases! h : ‚àÉ a ‚àà p.primeCompl, ‚àÉ y : M, f y = a ‚Ä¢ x
  ¬∑ obtain ‚ü®a, ha, y, h‚ü© := h
    left
    refine ‚ü®‚Äπ_‚Ä∫, y, le_antisymm (fun b hb ‚Ü¶ ?_) (fun b hb ‚Ü¶ ?_)‚ü©
    ¬∑ rw [hx] at hb
      rw [mem_colon_singleton, mem_bot] at hb ‚ä¢
      apply_fun _ using hf
      rw [map_smul, map_zero, h, smul_comm, hb, smul_zero]
    ¬∑ rw [mem_colon_singleton, mem_bot] at hb
      apply_fun f at hb
      rw [map_smul, map_zero, h, ‚Üê mul_smul, ‚Üê mem_bot R, ‚Üê mem_colon_singleton, ‚Üê hx] at hb
      contrapose hb
      exact p.primeCompl.mul_mem hb ha
  ¬∑ right
    refine ‚ü®‚Äπ_‚Ä∫, g x, le_antisymm (fun b hb ‚Ü¶ ?_) (fun b hb ‚Ü¶ ?_)‚ü©
    ¬∑ rw [hx] at hb
      rw [mem_colon_singleton, mem_bot] at hb ‚ä¢
      rw [‚Üê map_smul, hb, map_zero]
    ¬∑ rw [mem_colon_singleton, mem_bot, ‚Üê map_smul, ‚Üê LinearMap.mem_ker,
        hfg.linearMap_ker_eq] at hb
      obtain ‚ü®y, hy‚ü© := hb
      by_contra H
      exact h b H y hy
","theorem subset_union_of_exact (hf : Function.Injective f) (hfg : Function.Exact f g) :
    associatedPrimes R M' ‚äÜ associatedPrimes R M ‚à™ associatedPrimes R M'' ","Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n","Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: second part","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the informal ‚Äúsecond part‚Äù argument: starting from an associated prime p of M witnessed by an element x with ann(x)=p (the `rintro p ‚ü®_, x, hx‚ü©` pattern), it splits into two cases. The `by_cases! h : ‚àÉ a ‚àà p.primeCompl, ‚àÉ y, f y = a ‚Ä¢ x` corresponds exactly to the informal dichotomy ‚Äúthere exists g ‚àâ p with gm ‚àà M‚Ä≤‚Äù vs ‚Äúno such g exists‚Äù. In the first branch it produces a witness y in M‚Ä≤ (via f y = a‚Ä¢x) and proves ann(y)=p using `le_antisymm` and colon/annihilator rewriting, matching ‚Äúthen ann(m‚Ä≤)=p‚Äù. In the second branch it produces a witness in the quotient (using `g x` and kernel/image facts like `hfg.linearMap_ker_eq`) and shows ann(image)=p, matching ‚Äúotherwise ann(m‚Ä≥)=p‚Äù. Structurally, both proofs proceed by the same case split and conclude p lies in Ass(M‚Ä≤) or Ass(M‚Ä≥). The Lean code does not address the initial inclusion Ass(M‚Ä≤) ‚äÜ Ass(M) or the omitted final statement, but that is consistent with the note that we are comparing only the second part.""}"
291,02M3,"theorem prod : associatedPrimes R (M √ó M') = associatedPrimes R M ‚à™ associatedPrimes R M' :=
  (subset_union_of_exact LinearMap.inl_injective .inl_snd).antisymm (Set.union_subset_iff.2
    ‚ü®subset_of_injective LinearMap.inl_injective, subset_of_injective LinearMap.inr_injective‚ü©)
",Formal Proof of Stacks Project Tag 02M3,third part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/AssociatedPrime/Basic.lean#L140-L142,Q27041,,10.63.3,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.3. Let $R$ be a ring. Let $0 \\to M\' \\to M \\to M\'\' \\to 0$ be a short exact sequence of $R$-modules. Then $\\text{Ass}(M\') \\subset \\text{Ass}(M)$ and $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. Also $\\text{Ass}(M\' \\oplus M\'\') = \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. \n\n    \n      Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n",\n  Lemma 10.63.3. Let $R$ be a ring. Let $0 \\to M\' \\to M \\to M\'\' \\to 0$ be a short exact sequence of $R$-modules. Then $\\text{Ass}(M\') \\subset \\text{Ass}(M)$ and $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. Also $\\text{Ass}(M\' \\oplus M\'\') = \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. \n\n    \n,"Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n","
  (subset_union_of_exact LinearMap.inl_injective .inl_snd).antisymm (Set.union_subset_iff.2
    ‚ü®subset_of_injective LinearMap.inl_injective, subset_of_injective LinearMap.inr_injective‚ü©)
",theorem prod : associatedPrimes R (M √ó M') = associatedPrimes R M ‚à™ associatedPrimes R M' ,"Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n","Proof.\n      If $m\' \\in M\'$, then the annihilator of $m\'$ viewed as an element of $M\'$ is the same as the annihilator of $m\'$ viewed as an element of $M$. Hence the inclusion $\\text{Ass}(M\') \\subset \\text{Ass}(M)$. Let $m \\in M$ be an element whose annihilator is a prime ideal $\\mathfrak p$. If there exists a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $m\' = gm \\in M\'$ then the annihilator of $m\'$ is $\\mathfrak p$. If there does not exist a $g \\in R$, $g \\not\\in \\mathfrak p$ such that $gm \\in M\'$, then the annilator of the image $m\'\' \\in M\'\'$ of $m$ is $\\mathfrak p$. This proves the inclusion $\\text{Ass}(M) \\subset \\text{Ass}(M\') \\cup \\text{Ass}(M\'\')$. We omit the proof of the final statement. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: third part","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about inclusions between sets of associated primes in a short exact sequence (showing Ass(M‚Ä≤) ‚äÜ Ass(M) and Ass(M) ‚äÜ Ass(M‚Ä≤) ‚à™ Ass(M‚Ä≥), with a final statement omitted). The Lean term instead proves a set equality/antisymmetry involving unions and subsets derived from injectivity of the linear maps `inl` and `inr` (using lemmas like `subset_union_of_exact`, `subset_of_injective`, and `Set.union_subset_iff`). Structurally, the informal argument splits into cases on an element m and localization-like multiplication by g‚àâp, whereas the Lean proof is a purely set-theoretic manipulation of subset relations from exactness/injectivity, with no corresponding case analysis or annihilator/prime-ideal reasoning. Thus the formal proof does not capture the content of the informal third-part argument and appears to be about a different statement (a union/subset equality in a direct sum/exactness context), so alignment is very low.""}"
293,00LC,"theorem associatedPrimes.finite : (associatedPrimes A M).Finite := by
  induction ‚ÄπModule.Finite A M‚Ä∫ using
    IsNoetherianRing.induction_on_isQuotientEquivQuotientPrime A with
  | subsingleton N => simp [associatedPrimes.eq_empty_of_subsingleton]
  | quotient N p f =>
    have := associatedPrimes.eq_singleton_of_isPrimary p.2.isPrimary
    simp [LinearEquiv.AssociatedPrimes.eq f, this]
  | exact N‚ÇÅ N‚ÇÇ N‚ÇÉ f g hf _ hfg h‚ÇÅ h‚ÇÉ =>
    exact (h‚ÇÅ.union h‚ÇÉ).subset (associatedPrimes.subset_union_of_exact hf hfg)
",Formal Proof of Stacks Project Tag 00LC,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/AssociatedPrime/Finiteness.lean#L155-L163,Q27041,,10.63.5,lemma,3.0,"['00L9', '00AO', '0ELQ']",\n  Lemma 10.63.5. Let $R$ be a Noetherian ring. Let $M$ be a finite $R$-module. Then $\\text{Ass}(M)$ is finite. \n\n    \n      Proof.\n      Immediate from Lemma 10.63.4 and Lemma 10.62.1. \n      $\\square$\n    \n,\n  Lemma 10.63.5. Let $R$ be a Noetherian ring. Let $M$ be a finite $R$-module. Then $\\text{Ass}(M)$ is finite. \n\n    \n,Proof.\n      Immediate from Lemma 10.63.4 and Lemma 10.62.1. \n      $\\square$\n    \n," by
  induction ‚ÄπModule.Finite A M‚Ä∫ using
    IsNoetherianRing.induction_on_isQuotientEquivQuotientPrime A with
  | subsingleton N => simp [associatedPrimes.eq_empty_of_subsingleton]
  | quotient N p f =>
    have := associatedPrimes.eq_singleton_of_isPrimary p.2.isPrimary
    simp [LinearEquiv.AssociatedPrimes.eq f, this]
  | exact N‚ÇÅ N‚ÇÇ N‚ÇÉ f g hf _ hfg h‚ÇÅ h‚ÇÉ =>
    exact (h‚ÇÅ.union h‚ÇÉ).subset (associatedPrimes.subset_union_of_exact hf hfg)
",theorem associatedPrimes.finite : (associatedPrimes A M).Finite ,"Proof.\n      Immediate from Lemma 10.63.4 [[\n  Lemma 10.63.4. Let $R$ be a ring, and $M$ an $R$-module. Suppose there exists a filtration by $R$-submodules \n  \n  \\[  0 = M_0 \\subset M_1 \\subset \\ldots \\subset M_ n = M  \\]\n\n   such that each quotient $M_ i/M_{i-1}$ is isomorphic to $R/\\mathfrak p_ i$ for some prime ideal $\\mathfrak p_ i$ of $R$. Then $\\text{Ass}(M) \\subset \\{ \\mathfrak p_1, \\ldots , \\mathfrak p_ n\\} $. \n\n    \n]] and Lemma 10.62.1 [[\n  Lemma 10.62.1. Let $R$ be a Noetherian ring, and let $M$ be a finite $R$-module. There exists a filtration by $R$-submodules \n  \n  \\[  0 = M_0 \\subset M_1 \\subset \\ldots \\subset M_ n = M  \\]\n\n   such that each quotient $M_ i/M_{i-1}$ is isomorphic to $R/\\mathfrak p_ i$ for some prime ideal $\\mathfrak p_ i$ of $R$. \n\n    \n      Second proof.\n       For an $R$-module $M$ we say $P(M)$ holds if there exists a filtration as in the statement of the lemma. Observe that $P$ is stable under extensions and holds for $0$. By Lemma 10.5.4 it suffices to prove $P(R/I)$ holds for every ideal $I$. If not then because $R$ is Noetherian, there is a maximal counter example $J$. By Example 10.28.7 and Proposition 10.28.8 the ideal $J$ is prime which is a contradiction. \n      $\\square$\n    \n\n    \n      First proof.\n       By Lemma 10.5.4 it suffices to do the case $M = R/I$ for some ideal $I$. Consider the set $S$ of ideals $J$ such that the lemma does not hold for the module $R/J$, and order it by inclusion. To arrive at a contradiction, assume that $S$ is not empty. Because $R$ is Noetherian, $S$ has a maximal element $J$. By definition of $S$, the ideal $J$ cannot be prime. Pick $a, b\\in R$ such that $ab \\in J$, but neither $a \\in J$ nor $b\\in J$. Consider the filtration $0 \\subset aR/(J \\cap aR) \\subset R/J$. Note that both the submodule $aR/(J \\cap aR)$ and the quotient module $(R/J)/(aR/(J \\cap aR))$ are cyclic modules; write them as $R/J\'$ and $R/J\'\'$ so we have a short exact sequence $0 \\to R/J\' \\to R/J \\to R/J\'\' \\to 0$. The inclusion $J \\subset J\'$ is strict as $b \\in J\'$ and the inclusion $J \\subset J\'\'$ is strict as $a \\in J\'\'$. Hence by maximality of $J$, both $R/J\'$ and $R/J\'\'$ have a filtration as above and hence so does $R/J$. Contradiction. \n      $\\square$\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Immediate from Lemma 10.63.4 [[\n  Lemma 10.63.4. Let $R$ be a ring, and $M$ an $R$-module. Suppose there exists a filtration by $R$-submodules \n  \n  \\[  0 = M_0 \\subset M_1 \\subset \\ldots \\subset M_ n = M  \\]\n\n   such that each quotient $M_ i/M_{i-1}$ is isomorphic to $R/\\mathfrak p_ i$ for some prime ideal $\\mathfrak p_ i$ of $R$. Then $\\text{Ass}(M) \\subset \\{ \\mathfrak p_1, \\ldots , \\mathfrak p_ n\\} $. \n\n    \n]] and Lemma 10.62.1 [[\n  Lemma 10.62.1. Let $R$ be a Noetherian ring, and let $M$ be a finite $R$-module. There exists a filtration by $R$-submodules \n  \n  \\[  0 = M_0 \\subset M_1 \\subset \\ldots \\subset M_ n = M  \\]\n\n   such that each quotient $M_ i/M_{i-1}$ is isomorphic to $R/\\mathfrak p_ i$ for some prime ideal $\\mathfrak p_ i$ of $R$. \n\n    \n      Second proof.\n       For an $R$-module $M$ we say $P(M)$ holds if there exists a filtration as in the statement of the lemma. Observe that $P$ is stable under extensions and holds for $0$. By Lemma 10.5.4 it suffices to prove $P(R/I)$ holds for every ideal $I$. If not then because $R$ is Noetherian, there is a maximal counter example $J$. By Example 10.28.7 and Proposition 10.28.8 the ideal $J$ is prime which is a contradiction. \n      $\\square$\n    \n\n    \n      First proof.\n       By Lemma 10.5.4 it suffices to do the case $M = R/I$ for some ideal $I$. Consider the set $S$ of ideals $J$ such that the lemma does not hold for the module $R/J$, and order it by inclusion. To arrive at a contradiction, assume that $S$ is not empty. Because $R$ is Noetherian, $S$ has a maximal element $J$. By definition of $S$, the ideal $J$ cannot be prime. Pick $a, b\\in R$ such that $ab \\in J$, but neither $a \\in J$ nor $b\\in J$. Consider the filtration $0 \\subset aR/(J \\cap aR) \\subset R/J$. Note that both the submodule $aR/(J \\cap aR)$ and the quotient module $(R/J)/(aR/(J \\cap aR))$ are cyclic modules; write them as $R/J\'$ and $R/J\'\'$ so we have a short exact sequence $0 \\to R/J\' \\to R/J \\to R/J\'\' \\to 0$. The inclusion $J \\subset J\'$ is strict as $b \\in J\'$ and the inclusion $J \\subset J\'\'$ is strict as $a \\in J\'\'$. Hence by maximality of $J$, both $R/J\'$ and $R/J\'\'$ have a filtration as above and hence so does $R/J$. Contradiction. \n      $\\square$\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof establishes a containment statement about associated primes of a finite module by an induction principle that reduces to (i) the subsingleton/zero case (Ass = ‚àÖ), (ii) the quotient-by-prime(-primary) case (Ass is a singleton {p}), and (iii) an exact-sequence step where Ass of the middle term is contained in the union of Ass of the ends. This matches the informal strategy: existence of a prime-quotient filtration for finite modules (Lemma 10.62.1) plus the lemma that such a filtration bounds Ass(M) by the set of primes appearing (Lemma 10.63.4), which is proved via stability under extensions/short exact sequences and base cases R/p.\nStructurally, the formal proof does not explicitly build a filtration; instead it uses a specialized induction principle (\""induction_on_isQuotientEquivQuotientPrime\"") that packages the same reduction steps (zero, quotient by prime, extension) that underlie the filtration argument. The exact-case line corresponds to the extension-stability step in the informal proof. The main mismatch is that the informal proof emphasizes constructing a filtration using Noetherian maximal counterexample arguments, while the Lean proof bypasses that construction and uses an existing induction lemma; thus it is slightly less directly aligned in structure, though the core logical content is the same.""}"
294,0310,"lemma mem_associatedPrimes_of_comap_mem_associatedPrimes_of_isLocalizedModule
    (p : Ideal R') (ass : p.comap (algebraMap R R') ‚àà associatedPrimes R M) :
    p ‚àà associatedPrimes R' M' := by
  rcases ass with ‚ü®hp, x, hx‚ü©
  constructor
  ¬∑ refine (IsLocalization.isPrime_iff_isPrime_disjoint S _ _).mpr
      ‚ü®hp, (IsLocalization.disjoint_comap_iff S R' p).mpr ?_‚ü©
    by_contra eqtop
    simp [eqtop, Ideal.comap_top, Ideal.isPrime_iff] at hp
  ¬∑ use f x
    ext t
    rcases IsLocalization.exists_mk'_eq S t with ‚ü®r, s, hrs‚ü©
    rw [‚Üê IsLocalizedModule.mk'_one S, ‚Üê hrs, mem_colon_singleton, mem_bot,
      IsLocalizedModule.mk'_smul_mk', mul_one, IsLocalizedModule.mk'_eq_zero']
    refine ‚ü®fun h ‚Ü¶ ?_, fun ‚ü®t, ht‚ü© ‚Ü¶ ?_‚ü©
    ¬∑ use 1
      simp only [‚Üê mem_colon_singleton, one_smul, ‚Üê mem_bot R, ‚Üê hx, Ideal.mem_comap]
      have : (algebraMap R R') r =
        IsLocalization.mk' R' r s * IsLocalization.mk' R' s.1 (1 : S) := by
        rw [‚Üê IsLocalization.mk'_one (M := S) R', ‚Üê sub_eq_zero, ‚Üê IsLocalization.mk'_mul,
          ‚Üê IsLocalization.mk'_sub]
        simp
      rw [this]
      exact Ideal.IsTwoSided.mul_mem_of_left _ h
    ¬∑ have : t ‚Ä¢ r ‚Ä¢ x = (t.1 * r) ‚Ä¢ x := smul_smul t.1 r x
      rw [this, ‚Üê mem_bot R, ‚Üê mem_colon_singleton, ‚Üê hx, Ideal.mem_comap,
        ‚Üê IsLocalization.mk'_one (M := S) R'] at ht
      have : IsLocalization.mk' R' r s =
        IsLocalization.mk' (M := S) R' (t.1 * r) 1 * IsLocalization.mk' R' 1 (t * s) := by
        rw [‚Üê IsLocalization.mk'_mul, mul_one, one_mul, ‚Üê sub_eq_zero, ‚Üê IsLocalization.mk'_sub,
          Submonoid.coe_mul]
        simp [‚Üê mul_assoc, mul_comm r t.1, IsLocalization.mk'_zero]
      simpa [this] using Ideal.IsTwoSided.mul_mem_of_left _ ht
",Formal Proof of Stacks Project Tag 0310,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/AssociatedPrime/Localization.lean#L40-L72,Q27041,,10.63.15,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.15. Let $R$ be a ring. Let $M$ be an $R$-module. Let $\\mathfrak p \\subset R$ be a prime. \n  \n  \nIf $\\mathfrak p \\in \\text{Ass}(M)$ then $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$. \n\n\nIf $\\mathfrak p$ is finitely generated then the converse holds as well. \n\n\n\n\n    \n      Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n",\n  Lemma 10.63.15. Let $R$ be a ring. Let $M$ be an $R$-module. Let $\\mathfrak p \\subset R$ be a prime. \n  \n  \nIf $\\mathfrak p \\in \\text{Ass}(M)$ then $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$. \n\n\nIf $\\mathfrak p$ is finitely generated then the converse holds as well. \n\n\n\n\n    \n,"Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n"," by
  rcases ass with ‚ü®hp, x, hx‚ü©
  constructor
  ¬∑ refine (IsLocalization.isPrime_iff_isPrime_disjoint S _ _).mpr
      ‚ü®hp, (IsLocalization.disjoint_comap_iff S R' p).mpr ?_‚ü©
    by_contra eqtop
    simp [eqtop, Ideal.comap_top, Ideal.isPrime_iff] at hp
  ¬∑ use f x
    ext t
    rcases IsLocalization.exists_mk'_eq S t with ‚ü®r, s, hrs‚ü©
    rw [‚Üê IsLocalizedModule.mk'_one S, ‚Üê hrs, mem_colon_singleton, mem_bot,
      IsLocalizedModule.mk'_smul_mk', mul_one, IsLocalizedModule.mk'_eq_zero']
    refine ‚ü®fun h ‚Ü¶ ?_, fun ‚ü®t, ht‚ü© ‚Ü¶ ?_‚ü©
    ¬∑ use 1
      simp only [‚Üê mem_colon_singleton, one_smul, ‚Üê mem_bot R, ‚Üê hx, Ideal.mem_comap]
      have : (algebraMap R R') r =
        IsLocalization.mk' R' r s * IsLocalization.mk' R' s.1 (1 : S) := by
        rw [‚Üê IsLocalization.mk'_one (M := S) R', ‚Üê sub_eq_zero, ‚Üê IsLocalization.mk'_mul,
          ‚Üê IsLocalization.mk'_sub]
        simp
      rw [this]
      exact Ideal.IsTwoSided.mul_mem_of_left _ h
    ¬∑ have : t ‚Ä¢ r ‚Ä¢ x = (t.1 * r) ‚Ä¢ x := smul_smul t.1 r x
      rw [this, ‚Üê mem_bot R, ‚Üê mem_colon_singleton, ‚Üê hx, Ideal.mem_comap,
        ‚Üê IsLocalization.mk'_one (M := S) R'] at ht
      have : IsLocalization.mk' R' r s =
        IsLocalization.mk' (M := S) R' (t.1 * r) 1 * IsLocalization.mk' R' 1 (t * s) := by
        rw [‚Üê IsLocalization.mk'_mul, mul_one, one_mul, ‚Üê sub_eq_zero, ‚Üê IsLocalization.mk'_sub,
          Submonoid.coe_mul]
        simp [‚Üê mul_assoc, mul_comm r t.1, IsLocalization.mk'_zero]
      simpa [this] using Ideal.IsTwoSided.mul_mem_of_left _ ht
","lemma mem_associatedPrimes_of_comap_mem_associatedPrimes_of_isLocalizedModule
    (p : Ideal R') (ass : p.comap (algebraMap R R') ‚àà associatedPrimes R M) :
    p ‚àà associatedPrimes R' M' ","Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n","Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the informal argument: it starts from an associated prime datum ‚ü®hp, x, hx‚ü© (prime p and an element x with ann(x)=p), proves the localized/comapped ideal is prime via `IsLocalization.isPrime_iff_isPrime_disjoint` and a disjointness-by-contradiction step, and then constructs the witnessing element in the localized module (`use f x`) and proves the annihilator/colon ideal characterization by unpacking an arbitrary localized element `t` with `exists_mk'_eq` and manipulating the localization equalities (`mk'`, `mk'_eq_zero`, `mk'_smul_mk'`). Structurally, it follows the same two-part direction as the informal proof: (i) associated prime in M gives associated prime after localization, and (ii) associated prime after localization gives associated prime in M by clearing denominators (the informal product g1‚Ä¶gn corresponds to the Lean use of a single multiplier coming from the localization witness and `Ideal.IsTwoSided.mul_mem_of_left`). The main mismatch is that the informal proof explicitly uses exactness of localization and a finite generating set p=(f1,‚Ä¶,fn), while the Lean proof does not mention exactness or finite generation; instead it proves the annihilator statement directly via localization algebra and ideal/colon computations. So the core meaning aligns well, but the proof strategy/details differ.""}"
295,0310,"lemma comap_mem_associatedPrimes_of_mem_associatedPrimes_of_isLocalizedModule_of_fg (p : Ideal R')
    (ass : p ‚àà associatedPrimes R' M') (fg : (p.comap (algebraMap R R')).FG) :
    p.comap (algebraMap R R') ‚àà associatedPrimes R M := by
  rcases ass with ‚ü®hp, x, hx‚ü©
  rcases fg with ‚ü®T, hT‚ü©
  rcases IsLocalizedModule.mk'_surjective S f x with ‚ü®‚ü®m, s‚ü©, rfl‚ü©
  simp only [Function.uncurry_apply_pair] at hx
  have mem (a : T) : algebraMap R R' a ‚àà p := by
    simpa [‚Üê Ideal.mem_comap, ‚Üê hT] using Ideal.subset_span a.2
  simp only [hx, mem_bot, mem_colon_singleton, algebraMap_smul,
    ‚Üê IsLocalizedModule.mk'_smul, IsLocalizedModule.mk'_eq_zero' f] at mem
  choose g hg using mem
  refine ‚ü®.under R p, (‚àè a, g a).1 ‚Ä¢ m, le_antisymm ?_ fun r hr ‚Ü¶ ?_‚ü©
  ¬∑ rw [‚Üê hT, Ideal.span_le]
    intro a ha
    simp only [SetLike.mem_coe, mem_bot, mem_colon_singleton]
    obtain ‚ü®u, hu‚ü© : g ‚ü®a, ha‚ü© ‚à£ (‚àè a, g a) := by
      apply Finset.dvd_prod_of_mem g (Finset.mem_univ ‚ü®a, ha‚ü©)
    rw [hu, Submonoid.coe_mul, smul_smul, ‚Üê mul_assoc, mul_comm, ‚Üê smul_smul, mul_comm, ‚Üê smul_smul]
    exact smul_eq_zero_of_right u.1 (hg ‚ü®a, ha‚ü©)
  ¬∑ simp only [mem_bot, mem_colon_singleton, smul_smul] at hr
    have mem : r * (‚àè a, g a).1 ‚àà Ideal.comap (algebraMap R R') p := by
      simpa only [hx, Ideal.mem_comap, mem_bot, mem_colon_singleton, algebraMap_smul,
        ‚Üê IsLocalizedModule.mk'_smul, hr] using IsLocalizedModule.mk'_zero f s
    have := Set.disjoint_left.mp ((IsLocalization.disjoint_comap_iff S R' p).mpr hp.1) (‚àè a, g a).2
    have := (Ideal.IsPrime.under R p).mul_mem_iff_mem_or_mem.mp mem
    tauto
",Formal Proof of Stacks Project Tag 0310,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/AssociatedPrime/Localization.lean#L92-L118,Q27041,,10.63.15,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.15. Let $R$ be a ring. Let $M$ be an $R$-module. Let $\\mathfrak p \\subset R$ be a prime. \n  \n  \nIf $\\mathfrak p \\in \\text{Ass}(M)$ then $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$. \n\n\nIf $\\mathfrak p$ is finitely generated then the converse holds as well. \n\n\n\n\n    \n      Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n",\n  Lemma 10.63.15. Let $R$ be a ring. Let $M$ be an $R$-module. Let $\\mathfrak p \\subset R$ be a prime. \n  \n  \nIf $\\mathfrak p \\in \\text{Ass}(M)$ then $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$. \n\n\nIf $\\mathfrak p$ is finitely generated then the converse holds as well. \n\n\n\n\n    \n,"Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n"," by
  rcases ass with ‚ü®hp, x, hx‚ü©
  rcases fg with ‚ü®T, hT‚ü©
  rcases IsLocalizedModule.mk'_surjective S f x with ‚ü®‚ü®m, s‚ü©, rfl‚ü©
  simp only [Function.uncurry_apply_pair] at hx
  have mem (a : T) : algebraMap R R' a ‚àà p := by
    simpa [‚Üê Ideal.mem_comap, ‚Üê hT] using Ideal.subset_span a.2
  simp only [hx, mem_bot, mem_colon_singleton, algebraMap_smul,
    ‚Üê IsLocalizedModule.mk'_smul, IsLocalizedModule.mk'_eq_zero' f] at mem
  choose g hg using mem
  refine ‚ü®.under R p, (‚àè a, g a).1 ‚Ä¢ m, le_antisymm ?_ fun r hr ‚Ü¶ ?_‚ü©
  ¬∑ rw [‚Üê hT, Ideal.span_le]
    intro a ha
    simp only [SetLike.mem_coe, mem_bot, mem_colon_singleton]
    obtain ‚ü®u, hu‚ü© : g ‚ü®a, ha‚ü© ‚à£ (‚àè a, g a) := by
      apply Finset.dvd_prod_of_mem g (Finset.mem_univ ‚ü®a, ha‚ü©)
    rw [hu, Submonoid.coe_mul, smul_smul, ‚Üê mul_assoc, mul_comm, ‚Üê smul_smul, mul_comm, ‚Üê smul_smul]
    exact smul_eq_zero_of_right u.1 (hg ‚ü®a, ha‚ü©)
  ¬∑ simp only [mem_bot, mem_colon_singleton, smul_smul] at hr
    have mem : r * (‚àè a, g a).1 ‚àà Ideal.comap (algebraMap R R') p := by
      simpa only [hx, Ideal.mem_comap, mem_bot, mem_colon_singleton, algebraMap_smul,
        ‚Üê IsLocalizedModule.mk'_smul, hr] using IsLocalizedModule.mk'_zero f s
    have := Set.disjoint_left.mp ((IsLocalization.disjoint_comap_iff S R' p).mpr hp.1) (‚àè a, g a).2
    have := (Ideal.IsPrime.under R p).mul_mem_iff_mem_or_mem.mp mem
    tauto
","lemma comap_mem_associatedPrimes_of_mem_associatedPrimes_of_isLocalizedModule_of_fg (p : Ideal R')
    (ass : p ‚àà associatedPrimes R' M') (fg : (p.comap (algebraMap R R')).FG) :
    p.comap (algebraMap R R') ‚àà associatedPrimes R M ","Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n","Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the informal direction (2): assuming a prime p is associated after localization, it constructs an element in M whose annihilator is exactly p, hence p ‚àà Ass(M). The code unpacks the assumptions (ass, fg), takes a representative ‚ü®m,s‚ü© of the localized element x, and uses the hypothesis that each generator a of p kills x to obtain for each a a witness g(a) ‚àâ p with g(a)¬∑a¬∑m = 0 (via `IsLocalizedModule.mk'_eq_zero'` and `choose g hg`). It then multiplies these witnesses into a single product ‚àèa g(a) and uses (‚àèa g(a))‚Ä¢m as the global element, proving p ‚äÜ ann((‚àèg)‚Ä¢m) by a divisibility argument over the finite generating set, and the reverse inclusion by a primality/disjointness argument (`IsLocalization.disjoint_comap_iff`, `Ideal.IsPrime.under`, `mul_mem_iff_mem_or_mem`). Structurally, this mirrors the informal proof‚Äôs steps: pick m/g, for each generator fi get gi‚àâp with gi fi m=0, then take the product and conclude ann(product¬∑m)=p. The main mismatch is that the informal proof explicitly invokes exactness of localization and discusses the other direction (1) as well, while the Lean snippet focuses on the constructive generator/product argument for (2) and does not reflect the exactness discussion.""}"
296,0310,"lemma preimage_comap_associatedPrimes_eq_associatedPrimes_of_isLocalizedModule
    [IsNoetherianRing R] :
    (Ideal.comap (algebraMap R R')) ‚Åª¬π' (associatedPrimes R M) = associatedPrimes R' M' := by
  ext p
  exact ‚ü®mem_associatedPrimes_of_comap_mem_associatedPrimes_of_isLocalizedModule S f p,
    fun h ‚Ü¶ comap_mem_associatedPrimes_of_mem_associatedPrimes_of_isLocalizedModule_of_fg S f p h
    ((isNoetherianRing_iff_ideal_fg R).mp ‚Äπ_‚Ä∫ _)‚ü©
",Formal Proof of Stacks Project Tag 0310,(3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/AssociatedPrime/Localization.lean#L125-L131,Q27041,,10.63.15,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.15. Let $R$ be a ring. Let $M$ be an $R$-module. Let $\\mathfrak p \\subset R$ be a prime. \n  \n  \nIf $\\mathfrak p \\in \\text{Ass}(M)$ then $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$. \n\n\nIf $\\mathfrak p$ is finitely generated then the converse holds as well. \n\n\n\n\n    \n      Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n",\n  Lemma 10.63.15. Let $R$ be a ring. Let $M$ be an $R$-module. Let $\\mathfrak p \\subset R$ be a prime. \n  \n  \nIf $\\mathfrak p \\in \\text{Ass}(M)$ then $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$. \n\n\nIf $\\mathfrak p$ is finitely generated then the converse holds as well. \n\n\n\n\n    \n,"Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n"," by
  ext p
  exact ‚ü®mem_associatedPrimes_of_comap_mem_associatedPrimes_of_isLocalizedModule S f p,
    fun h ‚Ü¶ comap_mem_associatedPrimes_of_mem_associatedPrimes_of_isLocalizedModule_of_fg S f p h
    ((isNoetherianRing_iff_ideal_fg R).mp ‚Äπ_‚Ä∫ _)‚ü©
","lemma preimage_comap_associatedPrimes_eq_associatedPrimes_of_isLocalizedModule
    [IsNoetherianRing R] :
    (Ideal.comap (algebraMap R R')) ‚Åª¬π' (associatedPrimes R M) = associatedPrimes R' M' ","Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n","Proof.\n      If $\\mathfrak p \\in \\text{Ass}(M)$ there exists an element $m \\in M$ whose annihilator is $\\mathfrak p$. As localization is exact (Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]) we see that the annihilator of $m/1$ in $M_{\\mathfrak p}$ is $\\mathfrak pR_{\\mathfrak p}$ hence (1) holds. Assume $\\mathfrak pR_{\\mathfrak p} \\in \\text{Ass}(M_{\\mathfrak p})$ and $\\mathfrak p = (f_1, \\ldots , f_ n)$. Let $m/g$ be an element of $M_{\\mathfrak p}$ whose annihilator is $\\mathfrak pR_{\\mathfrak p}$. This implies that the annihilator of $m$ is contained in $\\mathfrak p$. As $f_ i m/g = 0$ in $M_{\\mathfrak p}$ we see there exists a $g_ i \\in R$, $g_ i \\not\\in \\mathfrak p$ such that $g_ i f_ i m = 0$ in $M$. Combined we see the annihilator of $g_1\\ldots g_ nm$ is $\\mathfrak p$. Hence $\\mathfrak p \\in \\text{Ass}(M)$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof establishes an extensional equality of sets of associated primes via a bidirectional implication: one direction uses `mem_associatedPrimes_of_comap_mem_associatedPrimes_of_isLocalizedModule` (showing membership in Ass before localization implies membership after comap/localization), and the other uses `comap_mem_associatedPrimes_of_mem_associatedPrimes_of_isLocalizedModule_of_fg` together with a finite-generation hypothesis obtained from Noetherianity (`isNoetherianRing_iff_ideal_fg`). This matches the informal proof‚Äôs two directions: (1) Ass(M) ‚áí Ass(localization) using exactness of localization, and (2) Ass(localization) ‚áí Ass(M) using that p is finitely generated (p = (f1,‚Ä¶,fn)) to clear denominators and recover an element with annihilator p.\nStructurally, both are ‚Äúext p; constructor; forward lemma; backward lemma with fg/Noetherian input‚Äù. The Lean proof is more abstract (delegating exactness/clearing denominators to library lemmas) and does not explicitly mention the element m/g or exactness, but these are encapsulated in the invoked lemmas. Completeness is good relative to the informal argument, with the key extra assumption (finite generation of the ideal) supplied explicitly in Lean. No obvious extraneous content beyond the Noetherian‚Üífg step.""}"
297,00FK,"    (hf : Function.Injective f) (p) (H : p ‚àà minimalPrimes R) :
    ‚àÉ p' : Ideal S, p'.IsPrime ‚àß p'.comap f = p :=
  have ‚ü®p', hp', _, eq‚ü© := exists_comap_eq_of_mem_minimalPrimes f (I := ‚ä•) p <| by
    rwa [comap_bot_of_injective f hf]
  ‚ü®p', hp', eq‚ü©
",Formal Proof of Stacks Project Tag 00FK, theorem Ideal.exists_comap_eq_of_mem_minimalPrimes_of_injective {f : R ‚Üí+* S,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Ideal/MinimalPrime/Localization.lean#L105-L109,Q27041,,10.30.5,lemma,3.0,"['00FF', '00AO', '0ELQ']","\n  Lemma 10.30.5. Let $R \\subset S$ be an injective ring map. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ hits all the minimal primes. \n\n    \n      Proof.\n      Let $\\mathfrak p \\subset R$ be a minimal prime. In this case $R_{\\mathfrak p}$ has a unique prime ideal. Hence it suffices to show that $S_{\\mathfrak p}$ is not zero. And this follows from the fact that localization is exact, see Proposition 10.9.12. \n      $\\square$\n    \n",\n  Lemma 10.30.5. Let $R \\subset S$ be an injective ring map. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ hits all the minimal primes. \n\n    \n,"Proof.\n      Let $\\mathfrak p \\subset R$ be a minimal prime. In this case $R_{\\mathfrak p}$ has a unique prime ideal. Hence it suffices to show that $S_{\\mathfrak p}$ is not zero. And this follows from the fact that localization is exact, see Proposition 10.9.12. \n      $\\square$\n    \n","
  have ‚ü®p', hp', _, eq‚ü© := exists_comap_eq_of_mem_minimalPrimes f (I := ‚ä•) p <| by
    rwa [comap_bot_of_injective f hf]
  ‚ü®p', hp', eq‚ü©
","    (hf : Function.Injective f) (p) (H : p ‚àà minimalPrimes R) :
    ‚àÉ p' : Ideal S, p'.IsPrime ‚àß p'.comap f = p ","Proof.\n      Let $\\mathfrak p \\subset R$ be a minimal prime. In this case $R_{\\mathfrak p}$ has a unique prime ideal. Hence it suffices to show that $S_{\\mathfrak p}$ is not zero. And this follows from the fact that localization is exact, see Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Let $\\mathfrak p \\subset R$ be a minimal prime. In this case $R_{\\mathfrak p}$ has a unique prime ideal. Hence it suffices to show that $S_{\\mathfrak p}$ is not zero. And this follows from the fact that localization is exact, see Proposition 10.9.12 [[\n       \n      \n  Proposition 10.9.12. Let $L\\xrightarrow {u} M\\xrightarrow {v} N$ be an exact sequence of $R$-modules. Then $S^{-1}L \\to S^{-1}M \\to S^{-1}N$ is also exact. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem Ideal.exists_comap_eq_of_mem_minimalPrimes_of_injective {f : R ‚Üí+* S","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the Lean snippet is about producing a prime ideal p' in S with p' ‚àà minimalPrimes and comap f p' = p (using `exists_comap_eq_of_mem_minimalPrimes` and a rewrite `comap_bot_of_injective` for I = ‚ä•). The informal proof instead argues via localization at a minimal prime, uniqueness of the prime in R_p, and non-zeroness of S_p using exactness of localization. These are different statements and methods: the Lean proof is an existence/comap statement about minimal primes under an injective ring map, while the informal proof is about properties of localizations and exactness. Structurally, the Lean proof is a short extraction of witnesses from an existence lemma, with no localization/exactness reasoning, so it does not reflect the informal argument‚Äôs steps. The Lean proof also contains no content corresponding to the exactness proposition cited informally.""}"
298,00H8,"instance [IsDomain S] [FaithfulSMul R S] [Algebra.IsIntegral R S] [IsIntegrallyClosed R] :
    Algebra.HasGoingDown R S := by
  have := (FaithfulSMul.algebraMap_injective R S).isDomain
  constructor
  intro p _ Q _ hpQ
  let SQ := Localization.AtPrime Q
  suffices (p.map (algebraMap _ SQ)).comap (algebraMap _ SQ) ‚â§ p by
    obtain ‚ü®P, hP, e‚ü© :=
      (Ideal.comap_map_eq_self_iff_of_isPrime _).mp (this.antisymm Ideal.le_comap_map)
    refine ‚ü®P.under S, ?_, inferInstance, ‚ü®by rw [Ideal.under_under, ‚Üê e]‚ü©‚ü©
    exact (Ideal.comap_mono (IsLocalRing.le_maximalIdeal_of_isPrime P)).trans_eq
      Localization.AtPrime.comap_maximalIdeal
  intro x hx
  obtain ‚ü®a, ha, haQ‚ü© : ‚àÉ a, x ‚Ä¢ a ‚àà Ideal.map (algebraMap R S) p ‚àß a ‚àâ Q := by
    simpa [Algebra.smul_def, IsScalarTower.algebraMap_eq R S SQ, ‚Üê Ideal.map_map,
      IsLocalization.mem_map_algebraMap_iff Q.primeCompl, ‚Üê map_mul] using hx
  obtain ‚ü®f, hfm, hfa, hf‚ü© := exists_monic_aeval_eq_zero_forall_mem_of_mem_map ha
  obtain ‚ü®i, hi, hip‚ü© : ‚àÉ i ‚â† (minpoly R a).natDegree, (minpoly R a).coeff i ‚àâ p := by
    set g := minpoly R a
    by_contra! H
    have : g.map (Ideal.Quotient.mk p) = X ^ g.natDegree := by
      ext i
      obtain hi | rfl | hi := lt_trichotomy i g.natDegree
      ¬∑ simpa [hi.ne, Ideal.Quotient.eq_zero_iff_mem] using H _ hi.ne
      ¬∑ simp [g, minpoly.monic (Algebra.IsIntegral.isIntegral _)]
      ¬∑ simp [coeff_eq_zero_of_natDegree_lt hi, hi.ne']
    have : Ideal.Quotient.mk (Ideal.map (algebraMap R S) p) (a ^ (minpoly R a).natDegree) = 0 := by
      simpa [‚Üê Ideal.Quotient.algebraMap_eq, aeval_algebraMap_apply, g] using
        congr(aeval (Ideal.Quotient.mk (Ideal.map (algebraMap R S) p) a) $this).symm
    exact haQ (‚ÄπQ.IsPrime‚Ä∫.mem_of_pow_mem _
      (Ideal.map_le_iff_le_comap.mpr hpQ.le (Ideal.Quotient.eq_zero_iff_mem.mp this)))
  by_cases hx0 : x = 0; ¬∑ simp [hx0]
  have := Polynomial.coeff_mem_radical_span_coeff_of_dvd _ _ hfm
    (minpoly.monic (Algebra.IsIntegral.isIntegral _))
    (minpoly.isIntegrallyClosed_dvd (Algebra.IsIntegral.isIntegral _) hfa)
  simp only [IsIntegrallyClosed.minpoly_smul hx0 (Algebra.IsIntegral.isIntegral _),
    natDegree_scaleRoots, coeff_scaleRoots, Ideal.radical_eq_sInf, Submodule.mem_sInf,
    Set.mem_setOf_eq, and_imp] at this
  refine ‚Äπp.IsPrime‚Ä∫.mem_of_pow_mem _ ((‚Äπp.IsPrime‚Ä∫.mem_or_mem
    (this i hi p ?_ inferInstance)).resolve_left hip)
  simp +contextual [Ideal.span_le, Set.subset_def, LT.lt.ne, hf]
",Formal Proof of Stacks Project Tag 00H8,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/IntegralClosure/GoingDown.lean#L48,Q27041,,10.38.7,proposition,3.0,"['037E', '00AO', '0ELQ']","\n  Proposition 10.38.7. Let $R \\subset S$ be an inclusion of domains. Assume $R$ is normal and $S$ integral over $R$. Let $\\mathfrak p \\subset \\mathfrak p\' \\subset R$ be primes. Let $\\mathfrak q\'$ be a prime of $S$ with $\\mathfrak p\' = R \\cap \\mathfrak q\'$. Then there exists a prime $\\mathfrak q$ with $\\mathfrak q \\subset \\mathfrak q\'$ such that $\\mathfrak p = R \\cap \\mathfrak q$. In other words: the going down property holds for $R \\to S$, see Definition 10.41.1. \n\n    \n      Proof.\n      Let $\\mathfrak p$, $\\mathfrak p\'$ and $\\mathfrak q\'$ be as in the statement. We have to show there is a prime $\\mathfrak q$, with $\\mathfrak q \\subset \\mathfrak q\'$ and $R \\cap \\mathfrak q = \\mathfrak p$. This is the same as finding a prime of $S_{\\mathfrak q\'}$ mapping to $\\mathfrak p$. According to Lemma 10.18.6 we have to show that $\\mathfrak p S_{\\mathfrak q\'} \\cap R = \\mathfrak p$. Pick $z \\in \\mathfrak p S_{\\mathfrak q\'} \\cap R$. We may write $z = y/g$ with $y \\in \\mathfrak pS$ and $g \\in S$, $g \\not\\in \\mathfrak q\'$. Written differently we have $zg = y$. \n    \n      By Lemma 10.38.4 there exists a monic polynomial $P = x^ m + b_{m-1} x^{m-1} + \\ldots + b_0$ with $b_ i \\in \\mathfrak p$ such that $P(y) = 0$. \n    \n      By Lemma 10.38.6 the minimal polynomial of $g$ over $K$ has coefficients in $R$. Write it as $Q = x^ n + a_{n-1} x^{n-1} + \\ldots + a_0$. Note that not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ since that would imply $g^ n = \\sum _{j < n} a_ j g^ j \\in \\mathfrak pS \\subset \\mathfrak p\'S \\subset \\mathfrak q\'$ which is a contradiction. \n    \n      Since $y = zg$ we see immediately from the above that $Q\' = x^ n + za_{n-1} x^{n-1} + \\ldots + z^{n}a_0$ is the minimal polynomial for $y$. Hence $Q\'$ divides $P$ and by Lemma 10.38.5 we see that $z^ ja_{n - j} \\in \\sqrt{(b_0, \\ldots , b_{m-1})} \\subset \\mathfrak p$, $j = 1, \\ldots , n$. Because not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ we conclude $z \\in \\mathfrak p$ as desired. \n      $\\square$\n    \n","\n  Proposition 10.38.7. Let $R \\subset S$ be an inclusion of domains. Assume $R$ is normal and $S$ integral over $R$. Let $\\mathfrak p \\subset \\mathfrak p\' \\subset R$ be primes. Let $\\mathfrak q\'$ be a prime of $S$ with $\\mathfrak p\' = R \\cap \\mathfrak q\'$. Then there exists a prime $\\mathfrak q$ with $\\mathfrak q \\subset \\mathfrak q\'$ such that $\\mathfrak p = R \\cap \\mathfrak q$. In other words: the going down property holds for $R \\to S$, see Definition 10.41.1. \n\n    \n","Proof.\n      Let $\\mathfrak p$, $\\mathfrak p\'$ and $\\mathfrak q\'$ be as in the statement. We have to show there is a prime $\\mathfrak q$, with $\\mathfrak q \\subset \\mathfrak q\'$ and $R \\cap \\mathfrak q = \\mathfrak p$. This is the same as finding a prime of $S_{\\mathfrak q\'}$ mapping to $\\mathfrak p$. According to Lemma 10.18.6 we have to show that $\\mathfrak p S_{\\mathfrak q\'} \\cap R = \\mathfrak p$. Pick $z \\in \\mathfrak p S_{\\mathfrak q\'} \\cap R$. We may write $z = y/g$ with $y \\in \\mathfrak pS$ and $g \\in S$, $g \\not\\in \\mathfrak q\'$. Written differently we have $zg = y$. \n    \n      By Lemma 10.38.4 there exists a monic polynomial $P = x^ m + b_{m-1} x^{m-1} + \\ldots + b_0$ with $b_ i \\in \\mathfrak p$ such that $P(y) = 0$. \n    \n      By Lemma 10.38.6 the minimal polynomial of $g$ over $K$ has coefficients in $R$. Write it as $Q = x^ n + a_{n-1} x^{n-1} + \\ldots + a_0$. Note that not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ since that would imply $g^ n = \\sum _{j < n} a_ j g^ j \\in \\mathfrak pS \\subset \\mathfrak p\'S \\subset \\mathfrak q\'$ which is a contradiction. \n    \n      Since $y = zg$ we see immediately from the above that $Q\' = x^ n + za_{n-1} x^{n-1} + \\ldots + z^{n}a_0$ is the minimal polynomial for $y$. Hence $Q\'$ divides $P$ and by Lemma 10.38.5 we see that $z^ ja_{n - j} \\in \\sqrt{(b_0, \\ldots , b_{m-1})} \\subset \\mathfrak p$, $j = 1, \\ldots , n$. Because not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ we conclude $z \\in \\mathfrak p$ as desired. \n      $\\square$\n    \n"," by
  have := (FaithfulSMul.algebraMap_injective R S).isDomain
  constructor
  intro p _ Q _ hpQ
  let SQ := Localization.AtPrime Q
  suffices (p.map (algebraMap _ SQ)).comap (algebraMap _ SQ) ‚â§ p by
    obtain ‚ü®P, hP, e‚ü© :=
      (Ideal.comap_map_eq_self_iff_of_isPrime _).mp (this.antisymm Ideal.le_comap_map)
    refine ‚ü®P.under S, ?_, inferInstance, ‚ü®by rw [Ideal.under_under, ‚Üê e]‚ü©‚ü©
    exact (Ideal.comap_mono (IsLocalRing.le_maximalIdeal_of_isPrime P)).trans_eq
      Localization.AtPrime.comap_maximalIdeal
  intro x hx
  obtain ‚ü®a, ha, haQ‚ü© : ‚àÉ a, x ‚Ä¢ a ‚àà Ideal.map (algebraMap R S) p ‚àß a ‚àâ Q := by
    simpa [Algebra.smul_def, IsScalarTower.algebraMap_eq R S SQ, ‚Üê Ideal.map_map,
      IsLocalization.mem_map_algebraMap_iff Q.primeCompl, ‚Üê map_mul] using hx
  obtain ‚ü®f, hfm, hfa, hf‚ü© := exists_monic_aeval_eq_zero_forall_mem_of_mem_map ha
  obtain ‚ü®i, hi, hip‚ü© : ‚àÉ i ‚â† (minpoly R a).natDegree, (minpoly R a).coeff i ‚àâ p := by
    set g := minpoly R a
    by_contra! H
    have : g.map (Ideal.Quotient.mk p) = X ^ g.natDegree := by
      ext i
      obtain hi | rfl | hi := lt_trichotomy i g.natDegree
      ¬∑ simpa [hi.ne, Ideal.Quotient.eq_zero_iff_mem] using H _ hi.ne
      ¬∑ simp [g, minpoly.monic (Algebra.IsIntegral.isIntegral _)]
      ¬∑ simp [coeff_eq_zero_of_natDegree_lt hi, hi.ne']
    have : Ideal.Quotient.mk (Ideal.map (algebraMap R S) p) (a ^ (minpoly R a).natDegree) = 0 := by
      simpa [‚Üê Ideal.Quotient.algebraMap_eq, aeval_algebraMap_apply, g] using
        congr(aeval (Ideal.Quotient.mk (Ideal.map (algebraMap R S) p) a) $this).symm
    exact haQ (‚ÄπQ.IsPrime‚Ä∫.mem_of_pow_mem _
      (Ideal.map_le_iff_le_comap.mpr hpQ.le (Ideal.Quotient.eq_zero_iff_mem.mp this)))
  by_cases hx0 : x = 0; ¬∑ simp [hx0]
  have := Polynomial.coeff_mem_radical_span_coeff_of_dvd _ _ hfm
    (minpoly.monic (Algebra.IsIntegral.isIntegral _))
    (minpoly.isIntegrallyClosed_dvd (Algebra.IsIntegral.isIntegral _) hfa)
  simp only [IsIntegrallyClosed.minpoly_smul hx0 (Algebra.IsIntegral.isIntegral _),
    natDegree_scaleRoots, coeff_scaleRoots, Ideal.radical_eq_sInf, Submodule.mem_sInf,
    Set.mem_setOf_eq, and_imp] at this
  refine ‚Äπp.IsPrime‚Ä∫.mem_of_pow_mem _ ((‚Äπp.IsPrime‚Ä∫.mem_or_mem
    (this i hi p ?_ inferInstance)).resolve_left hip)
  simp +contextual [Ideal.span_le, Set.subset_def, LT.lt.ne, hf]
","instance [IsDomain S] [FaithfulSMul R S] [Algebra.IsIntegral R S] [IsIntegrallyClosed R] :
    Algebra.HasGoingDown R S ","Proof.\n      Let $\\mathfrak p$, $\\mathfrak p\'$ and $\\mathfrak q\'$ be as in the statement. We have to show there is a prime $\\mathfrak q$, with $\\mathfrak q \\subset \\mathfrak q\'$ and $R \\cap \\mathfrak q = \\mathfrak p$. This is the same as finding a prime of $S_{\\mathfrak q\'}$ mapping to $\\mathfrak p$. According to Lemma 10.18.6 [[\n  Lemma 10.18.6. Let $\\varphi : R \\to S$ be a ring map. Let $\\mathfrak p$ be a prime of $R$. The following are equivalent \n  \n  \n$\\mathfrak p$ is in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$S \\otimes _ R \\kappa (\\mathfrak p) \\not= 0$, \n\n\n$S_{\\mathfrak p}/\\mathfrak p S_{\\mathfrak p} \\not= 0$, \n\n\n$(S/\\mathfrak pS)_{\\mathfrak p} \\not= 0$, and \n\n\n$\\mathfrak p = \\varphi ^{-1}(\\mathfrak pS)$. \n\n\n\n\n    \n]] we have to show that $\\mathfrak p S_{\\mathfrak q\'} \\cap R = \\mathfrak p$. Pick $z \\in \\mathfrak p S_{\\mathfrak q\'} \\cap R$. We may write $z = y/g$ with $y \\in \\mathfrak pS$ and $g \\in S$, $g \\not\\in \\mathfrak q\'$. Written differently we have $zg = y$. \n    \n      By Lemma 10.38.4 [[\n  Lemma 10.38.4. Suppose $\\varphi : R \\to S$ is integral. Suppose $I \\subset R$ is an ideal. Then every element of $IS$ is integral over $I$. \n\n    \n]] there exists a monic polynomial $P = x^ m + b_{m-1} x^{m-1} + \\ldots + b_0$ with $b_ i \\in \\mathfrak p$ such that $P(y) = 0$. \n    \n      By Lemma 10.38.6 [[\n  Lemma 10.38.6. Let $R \\subset S$ be an inclusion of domains. Assume $R$ is normal. Let $g \\in S$ be integral over $R$. Then the minimal polynomial of $g$ has coefficients in $R$. \n\n    \n]] the minimal polynomial of $g$ over $K$ has coefficients in $R$. Write it as $Q = x^ n + a_{n-1} x^{n-1} + \\ldots + a_0$. Note that not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ since that would imply $g^ n = \\sum _{j < n} a_ j g^ j \\in \\mathfrak pS \\subset \\mathfrak p\'S \\subset \\mathfrak q\'$ which is a contradiction. \n    \n      Since $y = zg$ we see immediately from the above that $Q\' = x^ n + za_{n-1} x^{n-1} + \\ldots + z^{n}a_0$ is the minimal polynomial for $y$. Hence $Q\'$ divides $P$ and by Lemma 10.38.5 [[\n  Lemma 10.38.5. Let $K$ be a field. Let $n, m \\in \\mathbf{N}$ and $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1} \\in K$. If the polynomial $x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0$ divides the polynomial $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0$ in $K[x]$ then \n  \n  \n$a_0, \\ldots , a_{n - 1}$ are integral over any subring $R_0$ of $K$ containing the elements $b_0, \\ldots , b_{m - 1}$, and \n\n\neach $a_ i$ lies in $\\sqrt{(b_0, \\ldots , b_{m-1})R}$ for any subring $R \\subset K$ containing the elements $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1}$. \n\n\n\n\n    \n]] we see that $z^ ja_{n - j} \\in \\sqrt{(b_0, \\ldots , b_{m-1})} \\subset \\mathfrak p$, $j = 1, \\ldots , n$. Because not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ we conclude $z \\in \\mathfrak p$ as desired. \n      $\\square$\n    \n","Proof.\n      Let $\\mathfrak p$, $\\mathfrak p\'$ and $\\mathfrak q\'$ be as in the statement. We have to show there is a prime $\\mathfrak q$, with $\\mathfrak q \\subset \\mathfrak q\'$ and $R \\cap \\mathfrak q = \\mathfrak p$. This is the same as finding a prime of $S_{\\mathfrak q\'}$ mapping to $\\mathfrak p$. According to Lemma 10.18.6 [[\n  Lemma 10.18.6. Let $\\varphi : R \\to S$ be a ring map. Let $\\mathfrak p$ be a prime of $R$. The following are equivalent \n  \n  \n$\\mathfrak p$ is in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$S \\otimes _ R \\kappa (\\mathfrak p) \\not= 0$, \n\n\n$S_{\\mathfrak p}/\\mathfrak p S_{\\mathfrak p} \\not= 0$, \n\n\n$(S/\\mathfrak pS)_{\\mathfrak p} \\not= 0$, and \n\n\n$\\mathfrak p = \\varphi ^{-1}(\\mathfrak pS)$. \n\n\n\n\n    \n]] we have to show that $\\mathfrak p S_{\\mathfrak q\'} \\cap R = \\mathfrak p$. Pick $z \\in \\mathfrak p S_{\\mathfrak q\'} \\cap R$. We may write $z = y/g$ with $y \\in \\mathfrak pS$ and $g \\in S$, $g \\not\\in \\mathfrak q\'$. Written differently we have $zg = y$. \n    \n      By Lemma 10.38.4 [[\n  Lemma 10.38.4. Suppose $\\varphi : R \\to S$ is integral. Suppose $I \\subset R$ is an ideal. Then every element of $IS$ is integral over $I$. \n\n    \n]] there exists a monic polynomial $P = x^ m + b_{m-1} x^{m-1} + \\ldots + b_0$ with $b_ i \\in \\mathfrak p$ such that $P(y) = 0$. \n    \n      By Lemma 10.38.6 [[\n  Lemma 10.38.6. Let $R \\subset S$ be an inclusion of domains. Assume $R$ is normal. Let $g \\in S$ be integral over $R$. Then the minimal polynomial of $g$ has coefficients in $R$. \n\n    \n]] the minimal polynomial of $g$ over $K$ has coefficients in $R$. Write it as $Q = x^ n + a_{n-1} x^{n-1} + \\ldots + a_0$. Note that not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ since that would imply $g^ n = \\sum _{j < n} a_ j g^ j \\in \\mathfrak pS \\subset \\mathfrak p\'S \\subset \\mathfrak q\'$ which is a contradiction. \n    \n      Since $y = zg$ we see immediately from the above that $Q\' = x^ n + za_{n-1} x^{n-1} + \\ldots + z^{n}a_0$ is the minimal polynomial for $y$. Hence $Q\'$ divides $P$ and by Lemma 10.38.5 [[\n  Lemma 10.38.5. Let $K$ be a field. Let $n, m \\in \\mathbf{N}$ and $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1} \\in K$. If the polynomial $x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0$ divides the polynomial $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0$ in $K[x]$ then \n  \n  \n$a_0, \\ldots , a_{n - 1}$ are integral over any subring $R_0$ of $K$ containing the elements $b_0, \\ldots , b_{m - 1}$, and \n\n\neach $a_ i$ lies in $\\sqrt{(b_0, \\ldots , b_{m-1})R}$ for any subring $R \\subset K$ containing the elements $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1}$. \n\n\n\n\n    \n]] we see that $z^ ja_{n - j} \\in \\sqrt{(b_0, \\ldots , b_{m-1})} \\subset \\mathfrak p$, $j = 1, \\ldots , n$. Because not all $a_ i$, $i = n-1, \\ldots , 0$ are in $\\mathfrak p$ we conclude $z \\in \\mathfrak p$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""5"", ""brief_justification"": ""Semantically, the Lean proof matches the informal argument: it localizes at the prime Q (SQ := Localization.AtPrime Q) and reduces the goal to showing (p.map _).comap _ ‚â§ p, i.e. p¬∑S_Q ‚à© R ‚äÜ p, exactly the condition needed to produce a prime over p inside Q‚Ä≤. It then takes x in the contraction, writes it via the localization membership criterion as x‚Ä¢a ‚àà pS with a ‚àâ Q (corresponding to z = y/g with g ‚àâ q‚Ä≤ and zg = y), uses integrality of elements of pS to obtain a monic polynomial annihilating that element (exists_monic_aeval_eq_zero_forall_mem_of_mem_map), introduces the minimal polynomial g = minpoly R a and proves not all coefficients lie in p by contradiction using primality of Q and the fact a ‚àâ Q (mirroring the ‚Äònot all a_i in p‚Äô step to avoid forcing a power into q‚Ä≤). Then it applies a lemma about coefficients lying in the radical of the ideal generated by the other polynomial‚Äôs coefficients (Polynomial.coeff_mem_radical_span_coeff_of_dvd together with minpoly.isIntegrallyClosed_dvd and IsIntegrallyClosed.minpoly_smul) to deduce a power of x lies in p, and finally uses p prime to conclude x ‚àà p‚Äîmatching the final deduction ‚Äòz ‚àà p‚Äô. Structurally, the sequence localization ‚Üí clear denominators ‚Üí monic polynomial for y ‚Üí minimal polynomial and coefficient argument ‚Üí divisibility/radical-of-coefficients lemma ‚Üí conclude element in p is closely mirrored. The formal proof is more detailed (handling x=0, quotient maps, comap/map bookkeeping), but these are implementation necessities rather than extraneous mathematical content.""}"
299,00GK,"theorem RingHom.Finite.to_isIntegral (h : f.Finite) : f.IsIntegral :=
  letI := f.toAlgebra
  fun _ ‚Ü¶ IsIntegral.of_mem_of_fg ‚ä§ h.1 _ trivial
",Formal Proof of Stacks Project Tag 00GK,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/IntegralClosure/Algebra/Basic.lean#L127-L129,Q27041,,10.36.3,lemma,3.0,"['00GH', '00AO', '0ELQ']",\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n      Proof.\n      Let $R \\to S$ be finite. Let $y \\in S$. Apply Lemma 10.36.2 to $M = S$ to see that $y$ is integral over $R$. \n      $\\square$\n    \n,\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n,Proof.\n      Let $R \\to S$ be finite. Let $y \\in S$. Apply Lemma 10.36.2 to $M = S$ to see that $y$ is integral over $R$. \n      $\\square$\n    \n,"
  letI := f.toAlgebra
  fun _ ‚Ü¶ IsIntegral.of_mem_of_fg ‚ä§ h.1 _ trivial
",theorem RingHom.Finite.to_isIntegral (h : f.Finite) : f.IsIntegral ,"Proof.\n      Let $R \\to S$ be finite. Let $y \\in S$. Apply Lemma 10.36.2 [[\n  Lemma 10.36.2. Let $\\varphi : R \\to S$ be a ring map. Let $y \\in S$. If there exists a finite $R$-submodule $M$ of $S$ such that $1 \\in M$ and $yM \\subset M$, then $y$ is integral over $R$. \n\n    \n]] to $M = S$ to see that $y$ is integral over $R$. \n      $\\square$\n    \n","Proof.\n      Let $R \\to S$ be finite. Let $y \\in S$. Apply Lemma 10.36.2 [[\n  Lemma 10.36.2. Let $\\varphi : R \\to S$ be a ring map. Let $y \\in S$. If there exists a finite $R$-submodule $M$ of $S$ such that $1 \\in M$ and $yM \\subset M$, then $y$ is integral over $R$. \n\n    \n]] to $M = S$ to see that $y$ is integral over $R$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish integrality of an element from finiteness: the informal argument uses the criterion ‚Äúif there is a finite R-submodule M with 1‚ààM and yM‚äÜM then y is integral‚Äù and takes M = S (since S is finite over R). The Lean proof applies `IsIntegral.of_mem_of_fg ‚ä§ h.1 _ trivial` after setting the algebra structure, which is the standard lemma that elements of a finitely generated (as module/algebra) extension are integral; this matches the same mathematical content.\nStructurally, the informal proof explicitly invokes the submodule-stability lemma with M=S, while the formal proof uses a more direct integrality-from-finite-generation lemma rather than explicitly constructing M and checking yM‚äÜM. So the core idea aligns, but the formal proof compresses/changes the route, hence not a perfect structural match.""}"
300,00H5,"lemma exists_monic_aeval_eq_zero_forall_mem_of_mem_map [Algebra.IsIntegral R S]
    {I : Ideal R} {x : S} (hx : x ‚àà I.map (algebraMap R S)) :
    ‚àÉ p : R[X], p.Monic ‚àß aeval x p = 0 ‚àß ‚àÄ i ‚â† p.natDegree, p.coeff i ‚àà I := by
  obtain ‚ü®p, hp, e, h‚ü© := exists_monic_aeval_eq_zero_forall_mem_pow_of_mem_map hx
  refine ‚ü®p, hp, e, fun i hi ‚Ü¶ ?_‚ü©
  obtain hi | hi := hi.lt_or_gt
  ¬∑ exact Ideal.pow_le_self (by lia) (h _)
  ¬∑ simp [coeff_eq_zero_of_natDegree_lt hi]
",Formal Proof of Stacks Project Tag 00H5,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/IntegralClosure/Algebra/Ideal.lean#L93-L100,Q27041,,10.38.4,lemma,3.0,"['037E', '00AO', '0ELQ']",\n  Lemma 10.38.4. Suppose $\\varphi : R \\to S$ is integral. Suppose $I \\subset R$ is an ideal. Then every element of $IS$ is integral over $I$. \n\n    \n      Proof.\n      Immediate from Lemma 10.38.3. \n      $\\square$\n    \n,\n  Lemma 10.38.4. Suppose $\\varphi : R \\to S$ is integral. Suppose $I \\subset R$ is an ideal. Then every element of $IS$ is integral over $I$. \n\n    \n,Proof.\n      Immediate from Lemma 10.38.3. \n      $\\square$\n    \n," by
  obtain ‚ü®p, hp, e, h‚ü© := exists_monic_aeval_eq_zero_forall_mem_pow_of_mem_map hx
  refine ‚ü®p, hp, e, fun i hi ‚Ü¶ ?_‚ü©
  obtain hi | hi := hi.lt_or_gt
  ¬∑ exact Ideal.pow_le_self (by lia) (h _)
  ¬∑ simp [coeff_eq_zero_of_natDegree_lt hi]
","lemma exists_monic_aeval_eq_zero_forall_mem_of_mem_map [Algebra.IsIntegral R S]
    {I : Ideal R} {x : S} (hx : x ‚àà I.map (algebraMap R S)) :
    ‚àÉ p : R[X], p.Monic ‚àß aeval x p = 0 ‚àß ‚àÄ i ‚â† p.natDegree, p.coeff i ‚àà I ","Proof.\n      Immediate from Lemma 10.38.3 [[\n  Lemma 10.38.3. Let $\\varphi : R \\to S$ be a ring map. Let $I \\subset R$ be an ideal. The set of elements of $S$ which are integral over $I$ form a $R$-submodule of $S$. Furthermore, if $s \\in S$ is integral over $R$, and $s\'$ is integral over $I$, then $ss\'$ is integral over $I$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Immediate from Lemma 10.38.3 [[\n  Lemma 10.38.3. Let $\\varphi : R \\to S$ be a ring map. Let $I \\subset R$ be an ideal. The set of elements of $S$ which are integral over $I$ form a $R$-submodule of $S$. Furthermore, if $s \\in S$ is integral over $R$, and $s\'$ is integral over $I$, then $ss\'$ is integral over $I$. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof claims the result is an immediate consequence of a lemma about integrality over an ideal forming an R-submodule and being closed under multiplication with integral elements. The formal proof instead explicitly constructs a monic polynomial p and an exponent e from a lemma `exists_monic_aeval_eq_zero_forall_mem_pow_of_mem_map hx`, then proves coefficient membership conditions by splitting on an index inequality and using `Ideal.pow_le_self` and a `natDegree`-based coefficient-vanishing fact. Structurally, the formal proof is a detailed witness-building argument about polynomial coefficients and powers of an ideal, not a direct application of a submodule/multiplicative-closure lemma as in the informal proof. While both are in the general theme of integrality over ideals, the formal proof does not reflect the stated lemma‚Äôs structure and appears to be proving a different (or at least more specific/technical) statement than the informal ‚Äúimmediate from Lemma 10.38.3‚Äù argument.""}"
302,00GX,"def completeIntegralClosure : Subalgebra R S where
  carrier := { s | IsAlmostIntegral R s }
  mul_mem' := by
    rintro a b ‚ü®r, hr, hr'‚ü© ‚ü®s, hs, hs'‚ü©
    refine ‚ü®r * s, mul_mem hr hs, fun n ‚Ü¶ ?_‚ü©
    rw [mul_pow, mul_smul_mul_comm]
    exact mul_mem (hr' _) (hs' _)
  add_mem' := by
    rintro a b ‚ü®r, hr, hr'‚ü© ‚ü®s, hs, hs'‚ü©
    refine ‚ü®r * s, mul_mem hr hs, fun n ‚Ü¶ ?_‚ü©
    simp only [add_pow, Finset.smul_sum, ‚Üê smul_mul_assoc _ (_ * _),
      ‚Üê smul_mul_smul_comm _ (a ^ _)]
    exact sum_mem fun i _ ‚Ü¶ mul_mem (mul_mem (hr' _) (hs' _)) (by simp)
  algebraMap_mem' r := ‚ü®1, one_mem _, by simp [‚Üê map_pow]‚ü©
",Formal Proof of Stacks Project Tag 00GX,Part 1,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/IntegralClosure/IsIntegral/AlmostIntegral.lean#L31-L44,Q27041,,10.37.4,lemma,3.0,"['037B', '00AO', '0ELQ']","\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n      Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3. \n      $\\square$\n    \n","\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3. \n      $\\square$\n    \n"," { s | IsAlmostIntegral R s }
  mul_mem' := by
    rintro a b ‚ü®r, hr, hr'‚ü© ‚ü®s, hs, hs'‚ü©
    refine ‚ü®r * s, mul_mem hr hs, fun n ‚Ü¶ ?_‚ü©
    rw [mul_pow, mul_smul_mul_comm]
    exact mul_mem (hr' _) (hs' _)
  add_mem' := by
    rintro a b ‚ü®r, hr, hr'‚ü© ‚ü®s, hs, hs'‚ü©
    refine ‚ü®r * s, mul_mem hr hs, fun n ‚Ü¶ ?_‚ü©
    simp only [add_pow, Finset.smul_sum, ‚Üê smul_mul_assoc _ (_ * _),
      ‚Üê smul_mul_smul_comm _ (a ^ _)]
    exact sum_mem fun i _ ‚Ü¶ mul_mem (mul_mem (hr' _) (hs' _)) (by simp)
  algebraMap_mem' r := ‚ü®1, one_mem _, by simp [‚Üê map_pow]‚ü©
","def completeIntegralClosure : Subalgebra R S where
  carrier ","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 1","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean code is proving closure properties (multiplication, addition, and containing the image of the algebra map) for the set {s | IsAlmostIntegral R s}, i.e. it is building (at least) a subsemiring/subalgebra-like structure of almost integral elements. This matches only the very first sentence of the informal proof (‚Äú(uv)^n rr' and (u+v)^n rr' are in R ‚Ä¶ Hence the first assertion‚Äù), which is about closure under + and *.\n\nStructurally, the Lean proof explicitly constructs the common denominator r*s and then shows membership for all n using identities like mul_pow and add_pow, corresponding to the informal argument for products and sums. However, the informal proof then goes on to discuss integrality ‚áí almost integrality, and (Noetherian + almost integral) ‚áí integral via finiteness, none of which appears in the Lean snippet. Thus the Lean proof covers only a small initial part of the informal proof and omits the main later arguments, so overall alignment is low-to-moderate rather than full.""}"
303,00GX,"lemma IsIntegral.isAlmostIntegral [IsFractionRing R S]
    {s : S} (H : IsIntegral R s) : IsAlmostIntegral R s :=
  H.isAlmostIntegral_of_isLocalization _ le_rfl
",Formal Proof of Stacks Project Tag 00GX,Part 2,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/IntegralClosure/IsIntegral/AlmostIntegral.lean#L78-L80,Q27041,,10.37.4,lemma,3.0,"['037B', '00AO', '0ELQ']","\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n      Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3. \n      $\\square$\n    \n","\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3. \n      $\\square$\n    \n","
  H.isAlmostIntegral_of_isLocalization _ le_rfl
","lemma IsIntegral.isAlmostIntegral [IsFractionRing R S]
    {s : S} (H : IsIntegral R s) : IsAlmostIntegral R s ","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 2","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof discusses several facts about almost integral elements: closure under multiplication/addition, integrality ‚áí almost integrality via a common denominator argument, and (in the Noetherian case) almost integrality ‚áí integrality via finiteness. The Lean term `H.isAlmostIntegral_of_isLocalization _ le_rfl` instead appears to be a single lemma application producing an `isAlmostIntegral` statement from an `isLocalization` hypothesis (with trivial order proof `le_rfl`), i.e. a localization-specific result. Structurally, the informal proof is multi-step and covers multiple assertions, while the formal proof is a one-line invocation with no visible decomposition matching those steps. Thus there is at best partial semantic overlap (it proves some almost-integrality fact in a localization setting), but it does not reflect or cover the main arguments and multiple claims in the informal proof.""}"
304,00GX,"lemma IsAlmostIntegral.isIntegral [IsNoetherianRing R] [IsDomain S] [FaithfulSMul R S]
    {s : S} (H : IsAlmostIntegral R s) : IsIntegral R s := by
  have : IsDomain R := (FaithfulSMul.algebraMap_injective R S).isDomain
  exact H.isIntegral_of_nonZeroDivisors_le_comap fun _ ‚Ü¶ by simp
",Formal Proof of Stacks Project Tag 00GX,Part 3,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/IntegralClosure/IsIntegral/AlmostIntegral.lean#L115-L118,Q27041,,10.37.4,lemma,3.0,"['037B', '00AO', '0ELQ']","\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n      Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3. \n      $\\square$\n    \n","\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3. \n      $\\square$\n    \n"," by
  have : IsDomain R := (FaithfulSMul.algebraMap_injective R S).isDomain
  exact H.isIntegral_of_nonZeroDivisors_le_comap fun _ ‚Ü¶ by simp
","lemma IsAlmostIntegral.isIntegral [IsNoetherianRing R] [IsDomain S] [FaithfulSMul R S]
    {s : S} (H : IsAlmostIntegral R s) : IsIntegral R s ","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      If $ru^ n \\in R$ for all $n \\geq 0$ and $v^ nr\' \\in R$ for all $n \\geq 0$, then $(uv)^ nrr\'$ and $(u + v)^ nrr\'$ are in $R$ for all $n \\geq 0$. Hence the first assertion. Suppose $g \\in K$ is integral over $R$. In this case there exists an $d > 0$ such that the ring $R[g]$ is generated by $1, g, \\ldots , g^ d$ as an $R$-module. Let $r \\in R$ be a common denominator of the elements $1, g, \\ldots , g^ d \\in K$. It follows that $rR[g] \\subset R$, and hence $g$ is almost integral over $R$. \n    \n      Suppose $R$ is Noetherian and $g \\in K$ is almost integral over $R$. Let $r \\in R$, $r\\not= 0$ be as in the definition. Then $R[g] \\subset \\frac{1}{r}R$ as an $R$-module. Since $R$ is Noetherian this implies that $R[g]$ is finite over $R$. Hence $g$ is integral over $R$, see Lemma 10.36.3 [[\n  Lemma 10.36.3. A finite ring map is integral. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Part 3","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about deriving integrality from an ‚Äúalmost integral‚Äù/non-zero-divisors condition using `H.isIntegral_of_nonZeroDivisors_le_comap` after establishing `IsDomain R` via injectivity of `algebraMap`. This corresponds at best to the *last* paragraph of the informal proof (almost integral + Noetherian/finite ‚áí integral), but the informal proof also contains earlier closure properties and the direction integral ‚áí almost integral, none of which appear in the Lean code. Structurally, the informal argument proceeds in multiple steps (closure, integral‚Üíalmost integral via common denominator, and Noetherian almost integral‚Üíintegral via finiteness), whereas the Lean proof is a short one-step application of a lemma with a trivial `simp` side condition. Thus there is partial semantic overlap with only one component of the informal proof, and significant missing structure/content.""}"
305,09GH,"theorem fg_adjoin_of_finite {s : Set A} (hfs : s.Finite) (his : ‚àÄ x ‚àà s, IsIntegral R x) :
    (Algebra.adjoin R s).toSubmodule.FG := by
  induction s, hfs using Set.Finite.induction_on with
  | empty =>
    refine ‚ü®{1}, Submodule.ext fun x => ?_‚ü©
    rw [Algebra.adjoin_empty, Finset.coe_singleton, ‚Üê one_eq_span, Algebra.toSubmodule_bot]
  | @insert a s _ _ ih =>
    rw [‚Üê Set.union_singleton, Algebra.adjoin_union_coe_submodule]
    exact FG.mul
      (ih fun i hi => his i <| Set.mem_insert_of_mem a hi)
      (his a <| Set.mem_insert a s).fg_adjoin_singleton
",Formal Proof of Stacks Project Tag 09GH,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/IntegralClosure/IsIntegral/Basic.lean#L214-L224,Q27041,,9.8.6,lemma,3.0,"['09GB', '09FA', '0ELQ']","\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n      Proof.\n      Indeed, each extension $k(\\alpha _{1}, \\ldots , \\alpha _{i+1})/k(\\alpha _1, \\ldots , \\alpha _{i})$ is generated by one element and algebraic, hence finite. By multiplicativity of degree (Lemma 9.7.7) we obtain the result. \n      $\\square$\n    \n","\n       \n      \n  Lemma 9.8.6. Let $k$ be a field, and let $\\alpha _1, \\alpha _2, \\ldots , \\alpha _ n$ be elements of some extension field such that each $\\alpha _ i$ is algebraic over $k$. Then the extension $k(\\alpha _1, \\ldots , \\alpha _ n)/k$ is finite. That is, a finitely generated algebraic extension is finite. \n\n    \n","Proof.\n      Indeed, each extension $k(\\alpha _{1}, \\ldots , \\alpha _{i+1})/k(\\alpha _1, \\ldots , \\alpha _{i})$ is generated by one element and algebraic, hence finite. By multiplicativity of degree (Lemma 9.7.7) we obtain the result. \n      $\\square$\n    \n"," by
  induction s, hfs using Set.Finite.induction_on with
  | empty =>
    refine ‚ü®{1}, Submodule.ext fun x => ?_‚ü©
    rw [Algebra.adjoin_empty, Finset.coe_singleton, ‚Üê one_eq_span, Algebra.toSubmodule_bot]
  | @insert a s _ _ ih =>
    rw [‚Üê Set.union_singleton, Algebra.adjoin_union_coe_submodule]
    exact FG.mul
      (ih fun i hi => his i <| Set.mem_insert_of_mem a hi)
      (his a <| Set.mem_insert a s).fg_adjoin_singleton
","theorem fg_adjoin_of_finite {s : Set A} (hfs : s.Finite) (his : ‚àÄ x ‚àà s, IsIntegral R x) :
    (Algebra.adjoin R s).toSubmodule.FG ","Proof.\n      Indeed, each extension $k(\\alpha _{1}, \\ldots , \\alpha _{i+1})/k(\\alpha _1, \\ldots , \\alpha _{i})$ is generated by one element and algebraic, hence finite. By multiplicativity of degree (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) we obtain the result. \n      $\\square$\n    \n","Proof.\n      Indeed, each extension $k(\\alpha _{1}, \\ldots , \\alpha _{i+1})/k(\\alpha _1, \\ldots , \\alpha _{i})$ is generated by one element and algebraic, hence finite. By multiplicativity of degree (Lemma 9.7.7 [[\n  Lemma 9.7.7 (Multiplicativity).  Suppose given a tower of fields $F/E/k$. Then \n  \n  \\[  [F:k] = [F:E][E:k]  \\]\n\n\n    \n]]) we obtain the result. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues finiteness of a field extension by building a tower of simple algebraic extensions and using multiplicativity of degrees. The formal proof instead performs induction on a finite set `s` and proves a finite-generation statement about `Algebra.adjoin` (base case `adjoin_empty`, step using `Algebra.adjoin_union_coe_submodule` and a lemma `FG.mul` combining finite-generation data, plus `fg_adjoin_singleton`). Structurally, both are inductive/iterative (adding one generator at a time), but the key informal ingredient‚Äîalgebraicity of each step and multiplicativity of field degrees‚Äîis not present; the formal proof uses module/submodule finite generation rather than degree multiplicativity. Thus there is only partial alignment via the shared ‚Äúadjoin generators one-by-one‚Äù strategy, with major semantic mismatch on what is being proved and how finiteness is concluded.""}"
306,0CY7,"lemma finite_of_finite_type_of_isJacobsonRing (R S : Type*) [CommRing R] [Field S]
    [Algebra R S] [IsJacobsonRing R] [Algebra.FiniteType R S] :
    Module.Finite R S := by
  obtain ‚ü®Œπ, hŒπ, f, hf‚ü© := Algebra.FiniteType.iff_quotient_mvPolynomial'.mp ‚Äπ_‚Ä∫
  have : (algebraMap R S).IsIntegral := by
    rw [‚Üê f.comp_algebraMap]
    -- We need to write `f.toRingHom` instead of just `f`, to avoid unification issues.
    exact MvPolynomial.comp_C_integral_of_surjective_of_isJacobsonRing f.toRingHom hf
  have : Algebra.IsIntegral R S := Algebra.isIntegral_def.mpr this
  exact Algebra.IsIntegral.finite
",Formal Proof of Stacks Project Tag 0CY7,See also https://en.wikipedia.org/wiki/Zariski%27s_lemma.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Jacobson/Ring.lean#L681-L690,Q27041,,10.35.18,lemma,3.0,"['00FZ', '00AO', '0ELQ']",\n  Lemma 10.35.18. Let $R$ be a Jacobson ring. Let $K$ be a field. Let $R \\subset K$ and $K$ is of finite type over $R$. Then $R$ is a field and $K/R$ is a finite field extension. \n\n    \n      Proof.\n      First note that $R$ is a domain. By Lemma 10.34.2 we see that $R_ f$ is a field and $K/R_ f$ is a finite field extension for some nonzero $f \\in R$. Hence $(0)$ is a maximal ideal of $R_ f$ and by Lemma 10.35.14 we conclude $(0)$ is a maximal ideal of $R$. \n      $\\square$\n    \n,\n  Lemma 10.35.18. Let $R$ be a Jacobson ring. Let $K$ be a field. Let $R \\subset K$ and $K$ is of finite type over $R$. Then $R$ is a field and $K/R$ is a finite field extension. \n\n    \n,Proof.\n      First note that $R$ is a domain. By Lemma 10.34.2 we see that $R_ f$ is a field and $K/R_ f$ is a finite field extension for some nonzero $f \\in R$. Hence $(0)$ is a maximal ideal of $R_ f$ and by Lemma 10.35.14 we conclude $(0)$ is a maximal ideal of $R$. \n      $\\square$\n    \n," by
  obtain ‚ü®Œπ, hŒπ, f, hf‚ü© := Algebra.FiniteType.iff_quotient_mvPolynomial'.mp ‚Äπ_‚Ä∫
  have : (algebraMap R S).IsIntegral := by
    rw [‚Üê f.comp_algebraMap]
    -- We need to write `f.toRingHom` instead of just `f`, to avoid unification issues.
    exact MvPolynomial.comp_C_integral_of_surjective_of_isJacobsonRing f.toRingHom hf
  have : Algebra.IsIntegral R S := Algebra.isIntegral_def.mpr this
  exact Algebra.IsIntegral.finite
","lemma finite_of_finite_type_of_isJacobsonRing (R S : Type*) [CommRing R] [Field S]
    [Algebra R S] [IsJacobsonRing R] [Algebra.FiniteType R S] :
    Module.Finite R S ","Proof.\n      First note that $R$ is a domain. By Lemma 10.34.2 [[\n  Lemma 10.34.2. Let $R$ be a ring. Let $K$ be a field. If $R \\subset K$ and $K$ is of finite type over $R$, then there exists an $f \\in R$ such that $R_ f$ is a field, and $K/R_ f$ is a finite field extension. \n\n    \n]] we see that $R_ f$ is a field and $K/R_ f$ is a finite field extension for some nonzero $f \\in R$. Hence $(0)$ is a maximal ideal of $R_ f$ and by Lemma 10.35.14 [[\n  Lemma 10.35.14. Let $R$ be a Jacobson ring. Let $f \\in R$. The ring $R_ f$ is Jacobson and maximal ideals of $R_ f$ correspond to maximal ideals of $R$ not containing $f$. \n\n    \n]] we conclude $(0)$ is a maximal ideal of $R$. \n      $\\square$\n    \n","Proof.\n      First note that $R$ is a domain. By Lemma 10.34.2 [[\n  Lemma 10.34.2. Let $R$ be a ring. Let $K$ be a field. If $R \\subset K$ and $K$ is of finite type over $R$, then there exists an $f \\in R$ such that $R_ f$ is a field, and $K/R_ f$ is a finite field extension. \n\n    \n]] we see that $R_ f$ is a field and $K/R_ f$ is a finite field extension for some nonzero $f \\in R$. Hence $(0)$ is a maximal ideal of $R_ f$ and by Lemma 10.35.14 [[\n  Lemma 10.35.14. Let $R$ be a Jacobson ring. Let $f \\in R$. The ring $R_ f$ is Jacobson and maximal ideals of $R_ f$ correspond to maximal ideals of $R$ not containing $f$. \n\n    \n]] we conclude $(0)$ is a maximal ideal of $R$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: See also https://en.wikipedia.org/wiki/Zariski%27s_lemma.","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about Zariski‚Äôs lemma‚Äìtype reasoning: from a finite type field extension K over a subring R (with R a domain/Jacobson hypotheses), localize R at some nonzero f to get a field R_f and a finite field extension K/R_f, then use Jacobson properties to deduce that (0) is maximal in R. The Lean proof instead starts from `Algebra.FiniteType.iff_quotient_mvPolynomial'` to obtain a surjective map from a multivariable polynomial ring, proves the algebra map `R ‚Üí S` is integral via `MvPolynomial.comp_C_integral_of_surjective_of_isJacobsonRing`, converts this to `Algebra.IsIntegral R S`, and concludes `finite` from integrality. Structurally, the Lean proof is an integrality‚Üífiniteness argument using polynomial quotients and Jacobson-ring integrality lemmas, with no localization, no field extension, and no statement about maximality of (0). Thus both the goal and the proof strategy do not correspond to the informal argument, beyond a very loose thematic connection to Jacobson/Zariski ideas.""}"
307,0B52,"theorem supportDim_le_supportDim_quotSMulTop_succ {x : R} (hx : x ‚àà maximalIdeal R) :
    supportDim R M ‚â§ supportDim R (QuotSMulTop x M) + 1 :=
  supportDim_le_supportDim_quotSMulTop_succ_of_mem_jacobson ((maximalIdeal_le_jacobson _) hx)
",Formal Proof of Stacks Project Tag 0B52,the second inequality,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/KrullDimension/Regular.lean#L132-L134,Q27041,,10.63.10,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.10. Let $R$ is a Noetherian local ring, $M$ a finite $R$-module, and $f \\in \\mathfrak m$ an element of the maximal ideal of $R$. Then \n  \n  \\[  \\dim (\\text{Supp}(M/fM)) \\leq \\dim (\\text{Supp}(M)) \\leq \\dim (\\text{Supp}(M/fM)) + 1  \\]\n\n   If $f$ is not in any of the minimal primes of the support of $M$ (for example if $f$ is a nonzerodivisor on $M$), then equality holds for the right inequality. \n\n    \n      Proof.\n      (The parenthetical statement follows from Lemma 10.63.9.) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9. It follows, for example by Lemma 10.62.2 and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n","\n  Lemma 10.63.10. Let $R$ is a Noetherian local ring, $M$ a finite $R$-module, and $f \\in \\mathfrak m$ an element of the maximal ideal of $R$. Then \n  \n  \\[  \\dim (\\text{Supp}(M/fM)) \\leq \\dim (\\text{Supp}(M)) \\leq \\dim (\\text{Supp}(M/fM)) + 1  \\]\n\n   If $f$ is not in any of the minimal primes of the support of $M$ (for example if $f$ is a nonzerodivisor on $M$), then equality holds for the right inequality. \n\n    \n","Proof.\n      (The parenthetical statement follows from Lemma 10.63.9.) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9. It follows, for example by Lemma 10.62.2 and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n","
  supportDim_le_supportDim_quotSMulTop_succ_of_mem_jacobson ((maximalIdeal_le_jacobson _) hx)
","theorem supportDim_le_supportDim_quotSMulTop_succ {x : R} (hx : x ‚àà maximalIdeal R) :
    supportDim R M ‚â§ supportDim R (QuotSMulTop x M) + 1 ","Proof.\n      (The parenthetical statement follows from Lemma 10.63.9 [[\n  Lemma 10.63.9. Let $R$ be a Noetherian ring. Let $M$ be an $R$-module. The union $\\bigcup _{\\mathfrak q \\in \\text{Ass}(M)} \\mathfrak q$ is the set of elements of $R$ which are zerodivisors on $M$. \n\n    \n]].) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. It follows, for example by Lemma 10.62.2 [[\n  Lemma 10.62.2. Let $R$, $M$, $M_ i$, $\\mathfrak p_ i$ as in Lemma 10.62.1. Then $\\text{Supp}(M) = \\bigcup V(\\mathfrak p_ i)$ and in particular $\\mathfrak p_ i \\in \\text{Supp}(M)$. \n\n    \n]] and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13 [[\n  Lemma 10.60.13. Suppose that $R$ is a Noetherian local ring and $x\\in \\mathfrak m$ an element of its maximal ideal. Then $\\dim R \\leq \\dim R/xR + 1$. If $x$ is not contained in any of the minimal primes of $R$ then equality holds. (For example if $x$ is a nonzerodivisor.) \n\n    \n]]. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n","Proof.\n      (The parenthetical statement follows from Lemma 10.63.9 [[\n  Lemma 10.63.9. Let $R$ be a Noetherian ring. Let $M$ be an $R$-module. The union $\\bigcup _{\\mathfrak q \\in \\text{Ass}(M)} \\mathfrak q$ is the set of elements of $R$ which are zerodivisors on $M$. \n\n    \n]].) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. It follows, for example by Lemma 10.62.2 [[\n  Lemma 10.62.2. Let $R$, $M$, $M_ i$, $\\mathfrak p_ i$ as in Lemma 10.62.1. Then $\\text{Supp}(M) = \\bigcup V(\\mathfrak p_ i)$ and in particular $\\mathfrak p_ i \\in \\text{Supp}(M)$. \n\n    \n]] and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13 [[\n  Lemma 10.60.13. Suppose that $R$ is a Noetherian local ring and $x\\in \\mathfrak m$ an element of its maximal ideal. Then $\\dim R \\leq \\dim R/xR + 1$. If $x$ is not contained in any of the minimal primes of $R$ then equality holds. (For example if $x$ is a nonzerodivisor.) \n\n    \n]]. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: the second inequality","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean term applies a lemma `supportDim_le_supportDim_quotSMulTop_succ_of_mem_jacobson` after converting the hypothesis `hx` into a Jacobson-radical membership statement via `maximalIdeal_le_jacobson _`. This matches the informal proof‚Äôs *second inequality* step, which is the dimension bound of the form `dim Supp(M) ‚â§ dim Supp(M/fM) + 1` under an assumption that the element lies in the Jacobson radical/maximal ideal (as in the local Noetherian lemma cited). Structurally, however, the informal proof discusses both inequalities (support inclusion and the +1 dimension inequality) and uses several intermediate lemmas about supports and decomposition into `V(p)`; the Lean proof is a one-line invocation that only corresponds to the second inequality and omits the first inequality and the intermediate reductions. Thus it is partially aligned (captures the intended second inequality) but not a full structural match to the whole informal argument.""}"
308,0B52,"theorem supportDim_quotSMulTop_succ_eq_of_notMem_minimalPrimes_of_mem_maximalIdeal {x : R}
    (hn : ‚àÄ p ‚àà (annihilator R M).minimalPrimes, x ‚àâ p) (hx : x ‚àà maximalIdeal R) :
    supportDim R (QuotSMulTop x M) + 1 = supportDim R M :=
  supportDim_quotSMulTop_succ_eq_of_notMem_minimalPrimes_of_mem_jacobson hn <|
    (maximalIdeal_le_jacobson _) hx
",Formal Proof of Stacks Project Tag 0B52,the equality case,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/KrullDimension/Regular.lean#L189-L193,Q27041,,10.63.10,lemma,3.0,"['00L9', '00AO', '0ELQ']","\n  Lemma 10.63.10. Let $R$ is a Noetherian local ring, $M$ a finite $R$-module, and $f \\in \\mathfrak m$ an element of the maximal ideal of $R$. Then \n  \n  \\[  \\dim (\\text{Supp}(M/fM)) \\leq \\dim (\\text{Supp}(M)) \\leq \\dim (\\text{Supp}(M/fM)) + 1  \\]\n\n   If $f$ is not in any of the minimal primes of the support of $M$ (for example if $f$ is a nonzerodivisor on $M$), then equality holds for the right inequality. \n\n    \n      Proof.\n      (The parenthetical statement follows from Lemma 10.63.9.) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9. It follows, for example by Lemma 10.62.2 and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n","\n  Lemma 10.63.10. Let $R$ is a Noetherian local ring, $M$ a finite $R$-module, and $f \\in \\mathfrak m$ an element of the maximal ideal of $R$. Then \n  \n  \\[  \\dim (\\text{Supp}(M/fM)) \\leq \\dim (\\text{Supp}(M)) \\leq \\dim (\\text{Supp}(M/fM)) + 1  \\]\n\n   If $f$ is not in any of the minimal primes of the support of $M$ (for example if $f$ is a nonzerodivisor on $M$), then equality holds for the right inequality. \n\n    \n","Proof.\n      (The parenthetical statement follows from Lemma 10.63.9.) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9. It follows, for example by Lemma 10.62.2 and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n","
  supportDim_quotSMulTop_succ_eq_of_notMem_minimalPrimes_of_mem_jacobson hn <|
    (maximalIdeal_le_jacobson _) hx
","theorem supportDim_quotSMulTop_succ_eq_of_notMem_minimalPrimes_of_mem_maximalIdeal {x : R}
    (hn : ‚àÄ p ‚àà (annihilator R M).minimalPrimes, x ‚àâ p) (hx : x ‚àà maximalIdeal R) :
    supportDim R (QuotSMulTop x M) + 1 = supportDim R M ","Proof.\n      (The parenthetical statement follows from Lemma 10.63.9 [[\n  Lemma 10.63.9. Let $R$ be a Noetherian ring. Let $M$ be an $R$-module. The union $\\bigcup _{\\mathfrak q \\in \\text{Ass}(M)} \\mathfrak q$ is the set of elements of $R$ which are zerodivisors on $M$. \n\n    \n]].) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. It follows, for example by Lemma 10.62.2 [[\n  Lemma 10.62.2. Let $R$, $M$, $M_ i$, $\\mathfrak p_ i$ as in Lemma 10.62.1. Then $\\text{Supp}(M) = \\bigcup V(\\mathfrak p_ i)$ and in particular $\\mathfrak p_ i \\in \\text{Supp}(M)$. \n\n    \n]] and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13 [[\n  Lemma 10.60.13. Suppose that $R$ is a Noetherian local ring and $x\\in \\mathfrak m$ an element of its maximal ideal. Then $\\dim R \\leq \\dim R/xR + 1$. If $x$ is not contained in any of the minimal primes of $R$ then equality holds. (For example if $x$ is a nonzerodivisor.) \n\n    \n]]. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n","Proof.\n      (The parenthetical statement follows from Lemma 10.63.9 [[\n  Lemma 10.63.9. Let $R$ be a Noetherian ring. Let $M$ be an $R$-module. The union $\\bigcup _{\\mathfrak q \\in \\text{Ass}(M)} \\mathfrak q$ is the set of elements of $R$ which are zerodivisors on $M$. \n\n    \n]].) The first inequality follows from $\\text{Supp}(M/fM) \\subset \\text{Supp}(M)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. For the second inequality, note that $\\text{Supp}(M/fM) = \\text{Supp}(M) \\cap V(f)$, see Lemma 10.40.9 [[\n  Lemma 10.40.9. Let $R$ be a ring and let $M$ be an $R$-module. \n  \n  \nIf $M$ is finite then the support of $M/IM$ is $\\text{Supp}(M) \\cap V(I)$. \n\n\nIf $N \\subset M$, then $\\text{Supp}(N) \\subset \\text{Supp}(M)$. \n\n\nIf $Q$ is a quotient module of $M$ then $\\text{Supp}(Q) \\subset \\text{Supp}(M)$. \n\n\nIf $0 \\to N \\to M \\to Q \\to 0$ is a short exact sequence then $\\text{Supp}(M) = \\text{Supp}(Q) \\cup \\text{Supp}(N)$. \n\n\n\n\n    \n]]. It follows, for example by Lemma 10.62.2 [[\n  Lemma 10.62.2. Let $R$, $M$, $M_ i$, $\\mathfrak p_ i$ as in Lemma 10.62.1. Then $\\text{Supp}(M) = \\bigcup V(\\mathfrak p_ i)$ and in particular $\\mathfrak p_ i \\in \\text{Supp}(M)$. \n\n    \n]] and elementary properties of dimension, that it suffices to show $\\dim V(\\mathfrak p) \\leq \\dim (V(\\mathfrak p) \\cap V(f)) + 1$ for primes $\\mathfrak p$ of $R$. This is a consequence of Lemma 10.60.13 [[\n  Lemma 10.60.13. Suppose that $R$ is a Noetherian local ring and $x\\in \\mathfrak m$ an element of its maximal ideal. Then $\\dim R \\leq \\dim R/xR + 1$. If $x$ is not contained in any of the minimal primes of $R$ then equality holds. (For example if $x$ is a nonzerodivisor.) \n\n    \n]]. Finally, if $f$ is not contained in any minimal prime of the support of $M$, then the chains of primes in $\\text{Supp}(M/fM)$ all give rise to chains in $\\text{Supp}(M)$ which are at least one step away from being maximal. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: the equality case","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean snippet proves an equality case via a specialized lemma `supportDim_quotSMulTop_succ_eq_of_notMem_minimalPrimes_of_mem_jacobson` applied under hypotheses `hn` (not in minimal primes) and `hx` upgraded to membership in the Jacobson radical using `maximalIdeal_le_jacobson`. This matches only the *final* ingredient of the informal proof: invoking a dimension lemma in the equality case when the element avoids minimal primes and lies in the maximal ideal/Jacobson radical.\nStructurally, however, the informal proof discusses two inequalities, support inclusions/intersections, reduction to primes, and then applies a local dimension lemma (10.60.13) plus a chain-of-primes argument. None of that intermediate structure appears in the Lean code; it is a one-line application of a prepackaged lemma. Thus the formal proof aligns with the stated ‚Äúequality case‚Äù outcome but not with the broader multi-step argument presented informally.""}"
309,00KW,"lemma _root_.ringKrullDim_quotient_span_singleton_succ_eq_ringKrullDim_of_mem_nonZeroDivisors
    {x : R} (reg : x ‚àà R‚Å∞) (hx : x ‚àà maximalIdeal R) :
    ringKrullDim (R ‚ß∏ span {x}) + 1 = ringKrullDim R :=
  ringKrullDim_quotient_span_singleton_succ_eq_ringKrullDim
    (Module.Flat.isSMulRegular_of_nonZeroDivisors reg) hx
",Formal Proof of Stacks Project Tag 00KW,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/KrullDimension/Regular.lean#L212-L216,Q27041,,10.60.13,lemma,3.0,"['00KD', '00AO', '0ELQ']","\n  Lemma 10.60.13. Suppose that $R$ is a Noetherian local ring and $x\\in \\mathfrak m$ an element of its maximal ideal. Then $\\dim R \\leq \\dim R/xR + 1$. If $x$ is not contained in any of the minimal primes of $R$ then equality holds. (For example if $x$ is a nonzerodivisor.) \n\n    \n      Proof.\n      If $x_1, \\ldots , x_{\\dim R/xR} \\in R$ map to elements of $R/xR$ which generate an ideal of definition for $R/xR$, then $x, x_1, \\ldots , x_{\\dim R/xR}$ generate an ideal of definition for $R$. Hence the inequality by Proposition 10.60.9. On the other hand, if $x$ is not contained in any minimal prime of $R$, then the chains of primes in $R/xR$ all give rise to chains in $R$ which are at least one step away from being maximal. \n      $\\square$\n    \n",\n  Lemma 10.60.13. Suppose that $R$ is a Noetherian local ring and $x\\in \\mathfrak m$ an element of its maximal ideal. Then $\\dim R \\leq \\dim R/xR + 1$. If $x$ is not contained in any of the minimal primes of $R$ then equality holds. (For example if $x$ is a nonzerodivisor.) \n\n    \n,"Proof.\n      If $x_1, \\ldots , x_{\\dim R/xR} \\in R$ map to elements of $R/xR$ which generate an ideal of definition for $R/xR$, then $x, x_1, \\ldots , x_{\\dim R/xR}$ generate an ideal of definition for $R$. Hence the inequality by Proposition 10.60.9. On the other hand, if $x$ is not contained in any minimal prime of $R$, then the chains of primes in $R/xR$ all give rise to chains in $R$ which are at least one step away from being maximal. \n      $\\square$\n    \n","
  ringKrullDim_quotient_span_singleton_succ_eq_ringKrullDim
    (Module.Flat.isSMulRegular_of_nonZeroDivisors reg) hx
","lemma _root_.ringKrullDim_quotient_span_singleton_succ_eq_ringKrullDim_of_mem_nonZeroDivisors
    {x : R} (reg : x ‚àà R‚Å∞) (hx : x ‚àà maximalIdeal R) :
    ringKrullDim (R ‚ß∏ span {x}) + 1 = ringKrullDim R ","Proof.\n      If $x_1, \\ldots , x_{\\dim R/xR} \\in R$ map to elements of $R/xR$ which generate an ideal of definition for $R/xR$, then $x, x_1, \\ldots , x_{\\dim R/xR}$ generate an ideal of definition for $R$. Hence the inequality by Proposition 10.60.9 [[\n  Proposition 10.60.9. Let $R$ be a local Noetherian ring. Let $d \\geq 0$ be an integer. The following are equivalent: \n  \n  \n $\\dim (R) = d$, \n\n\n $d(R) = d$, \n\n\n there exists an ideal of definition generated by $d$ elements, and no ideal of definition is generated by fewer than $d$ elements. \n\n\n\n\n    \n]]. On the other hand, if $x$ is not contained in any minimal prime of $R$, then the chains of primes in $R/xR$ all give rise to chains in $R$ which are at least one step away from being maximal. \n      $\\square$\n    \n","Proof.\n      If $x_1, \\ldots , x_{\\dim R/xR} \\in R$ map to elements of $R/xR$ which generate an ideal of definition for $R/xR$, then $x, x_1, \\ldots , x_{\\dim R/xR}$ generate an ideal of definition for $R$. Hence the inequality by Proposition 10.60.9 [[\n  Proposition 10.60.9. Let $R$ be a local Noetherian ring. Let $d \\geq 0$ be an integer. The following are equivalent: \n  \n  \n $\\dim (R) = d$, \n\n\n $d(R) = d$, \n\n\n there exists an ideal of definition generated by $d$ elements, and no ideal of definition is generated by fewer than $d$ elements. \n\n\n\n\n    \n]]. On the other hand, if $x$ is not contained in any minimal prime of $R$, then the chains of primes in $R/xR$ all give rise to chains in $R$ which are at least one step away from being maximal. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs are about relating the Krull dimension of a ring to the Krull dimension of a quotient by a principal ideal (span/singleton), under a regular/non-zero-divisor hypothesis on x (the formal proof uses `isSMulRegular_of_nonZeroDivisors reg` and `hx`). This matches the informal discussion that assumes x avoids minimal primes (i.e., is a non-zero-divisor in the relevant sense) and compares prime chains in R and R/xR.\n\nStructurally, however, the informal proof argues via two separate ideas: (1) an inequality using ideals of definition and a cited proposition about minimal number of generators, and (2) a prime-chain lifting argument to get the opposite inequality. The Lean proof is a single invocation of a specialized lemma `ringKrullDim_quotient_span_singleton_succ_eq_ringKrullDim`, which likely packages the whole result without reflecting the two-step argument or the use of Proposition 10.60.9/ideals of definition. So the formal proof captures the end statement but not the specific intermediate reasoning and references from the informal proof.""}"
312,00NZ,"theorem free_of_flat_of_isLocalRing [Module.Finite R P] [Flat R P] : Free R P :=
  let w := Free.chooseBasis k (k ‚äó[R] P)
  have ‚ü®v, eq‚ü© := (TensorProduct.mk_surjective R P k Quotient.mk_surjective).comp_left w
  .of_basis <| .mk (IsLocalRing.linearIndependent_of_flat _ (eq ‚ñ∏ w.linearIndependent)) <| by
    exact (span_eq_top_of_tmul_eq_basis _ w <| congr_fun eq).ge
",Formal Proof of Stacks Project Tag 00NZ,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/LocalRing/Module.lean#L300-L304,Q27041,,10.78.5,lemma,3.0,"['00NV', '00AO', '0ELQ']","\n  Lemma 10.78.5. (Warning: see Remark 10.78.4.) Suppose $R$ is a local ring, and $M$ is a finite flat $R$-module. Then $M$ is finite free. \n\n    \n      Proof.\n      Follows from the equational criterion of flatness, see Lemma 10.39.11. Namely, suppose that $x_1, \\ldots , x_ r \\in M$ map to a basis of $M/\\mathfrak mM$. By Nakayama\'s Lemma 10.20.1 these elements generate $M$. We want to show there is no relation among the $x_ i$. Instead, we will show by induction on $n$ that if $x_1, \\ldots , x_ n \\in M$ are linearly independent in the vector space $M/\\mathfrak mM$ then they are independent over $R$. \n    \n      The base case of the induction is where we have $x \\in M$, $x \\not\\in \\mathfrak mM$ and a relation $fx = 0$. By the equational criterion there exist $y_ j \\in M$ and $a_ j \\in R$ such that $x = \\sum a_ j y_ j$ and $fa_ j = 0$ for all $j$. Since $x \\not\\in \\mathfrak mM$ we see that at least one $a_ j$ is a unit and hence $f = 0 $. \n    \n      Suppose that $\\sum f_ i x_ i$ is a relation among $x_1, \\ldots , x_ n$. By our choice of $x_ i$ we have $f_ i \\in \\mathfrak m$. According to the equational criterion of flatness there exist $a_{ij} \\in R$ and $y_ j \\in M$ such that $x_ i = \\sum a_{ij} y_ j$ and $\\sum f_ i a_{ij} = 0$. Since $x_ n \\not\\in \\mathfrak mM$ we see that $a_{nj}\\not\\in \\mathfrak m$ for at least one $j$. Since $\\sum f_ i a_{ij} = 0$ we get $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. The relation $\\sum f_ i x_ i = 0$ now can be rewritten as $\\sum _{i = 1}^{n-1} f_ i( x_ i + (-a_{ij}/a_{nj}) x_ n) = 0$. Note that the elements $x_ i + (-a_{ij}/a_{nj}) x_ n$ map to $n-1$ linearly independent elements of $M/\\mathfrak mM$. By induction assumption we get that all the $f_ i$, $i \\leq n-1$ have to be zero, and also $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. This proves the induction step. \n      $\\square$\n    \n","\n  Lemma 10.78.5. (Warning: see Remark 10.78.4.) Suppose $R$ is a local ring, and $M$ is a finite flat $R$-module. Then $M$ is finite free. \n\n    \n","Proof.\n      Follows from the equational criterion of flatness, see Lemma 10.39.11. Namely, suppose that $x_1, \\ldots , x_ r \\in M$ map to a basis of $M/\\mathfrak mM$. By Nakayama\'s Lemma 10.20.1 these elements generate $M$. We want to show there is no relation among the $x_ i$. Instead, we will show by induction on $n$ that if $x_1, \\ldots , x_ n \\in M$ are linearly independent in the vector space $M/\\mathfrak mM$ then they are independent over $R$. \n    \n      The base case of the induction is where we have $x \\in M$, $x \\not\\in \\mathfrak mM$ and a relation $fx = 0$. By the equational criterion there exist $y_ j \\in M$ and $a_ j \\in R$ such that $x = \\sum a_ j y_ j$ and $fa_ j = 0$ for all $j$. Since $x \\not\\in \\mathfrak mM$ we see that at least one $a_ j$ is a unit and hence $f = 0 $. \n    \n      Suppose that $\\sum f_ i x_ i$ is a relation among $x_1, \\ldots , x_ n$. By our choice of $x_ i$ we have $f_ i \\in \\mathfrak m$. According to the equational criterion of flatness there exist $a_{ij} \\in R$ and $y_ j \\in M$ such that $x_ i = \\sum a_{ij} y_ j$ and $\\sum f_ i a_{ij} = 0$. Since $x_ n \\not\\in \\mathfrak mM$ we see that $a_{nj}\\not\\in \\mathfrak m$ for at least one $j$. Since $\\sum f_ i a_{ij} = 0$ we get $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. The relation $\\sum f_ i x_ i = 0$ now can be rewritten as $\\sum _{i = 1}^{n-1} f_ i( x_ i + (-a_{ij}/a_{nj}) x_ n) = 0$. Note that the elements $x_ i + (-a_{ij}/a_{nj}) x_ n$ map to $n-1$ linearly independent elements of $M/\\mathfrak mM$. By induction assumption we get that all the $f_ i$, $i \\leq n-1$ have to be zero, and also $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. This proves the induction step. \n      $\\square$\n    \n","
  let w := Free.chooseBasis k (k ‚äó[R] P)
  have ‚ü®v, eq‚ü© := (TensorProduct.mk_surjective R P k Quotient.mk_surjective).comp_left w
  .of_basis <| .mk (IsLocalRing.linearIndependent_of_flat _ (eq ‚ñ∏ w.linearIndependent)) <| by
    exact (span_eq_top_of_tmul_eq_basis _ w <| congr_fun eq).ge
",theorem free_of_flat_of_isLocalRing [Module.Finite R P] [Flat R P] : Free R P ,"Proof.\n      Follows from the equational criterion of flatness, see Lemma 10.39.11 [[\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n]]. Namely, suppose that $x_1, \\ldots , x_ r \\in M$ map to a basis of $M/\\mathfrak mM$. By Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]] these elements generate $M$. We want to show there is no relation among the $x_ i$. Instead, we will show by induction on $n$ that if $x_1, \\ldots , x_ n \\in M$ are linearly independent in the vector space $M/\\mathfrak mM$ then they are independent over $R$. \n    \n      The base case of the induction is where we have $x \\in M$, $x \\not\\in \\mathfrak mM$ and a relation $fx = 0$. By the equational criterion there exist $y_ j \\in M$ and $a_ j \\in R$ such that $x = \\sum a_ j y_ j$ and $fa_ j = 0$ for all $j$. Since $x \\not\\in \\mathfrak mM$ we see that at least one $a_ j$ is a unit and hence $f = 0 $. \n    \n      Suppose that $\\sum f_ i x_ i$ is a relation among $x_1, \\ldots , x_ n$. By our choice of $x_ i$ we have $f_ i \\in \\mathfrak m$. According to the equational criterion of flatness there exist $a_{ij} \\in R$ and $y_ j \\in M$ such that $x_ i = \\sum a_{ij} y_ j$ and $\\sum f_ i a_{ij} = 0$. Since $x_ n \\not\\in \\mathfrak mM$ we see that $a_{nj}\\not\\in \\mathfrak m$ for at least one $j$. Since $\\sum f_ i a_{ij} = 0$ we get $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. The relation $\\sum f_ i x_ i = 0$ now can be rewritten as $\\sum _{i = 1}^{n-1} f_ i( x_ i + (-a_{ij}/a_{nj}) x_ n) = 0$. Note that the elements $x_ i + (-a_{ij}/a_{nj}) x_ n$ map to $n-1$ linearly independent elements of $M/\\mathfrak mM$. By induction assumption we get that all the $f_ i$, $i \\leq n-1$ have to be zero, and also $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. This proves the induction step. \n      $\\square$\n    \n","Proof.\n      Follows from the equational criterion of flatness, see Lemma 10.39.11 [[\n  Lemma 10.39.11 (Equational criterion of flatness).  A module $M$ over $R$ is flat if and only if every relation in $M$ is trivial. \n\n    \n]]. Namely, suppose that $x_1, \\ldots , x_ r \\in M$ map to a basis of $M/\\mathfrak mM$. By Nakayama\'s Lemma 10.20.1 [[\n        \n      \n      \n  Lemma 10.20.1 (Nakayama\'s lemma). Let $R$ be a ring with Jacobson radical $\\text{rad}(R)$. Let $M$ be an $R$-module. Let $I \\subset R$ be an ideal. \n  \n  \n If $IM = M$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $fM = 0$. \n\n\nIf $IM = M$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $N\'$ is finite, then there exists an $f \\in 1 + I$ such that $fM \\subset N$ and $M_ f = N_ f$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, $N\'$ is finite, and $I \\subset \\text{rad}(R)$, then $M = N$. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, and $M$ is finite, then there exists an $f \\in 1 + I$ such that $N_ f \\to M_ f$ is surjective. \n\n\nIf $N \\to M$ is a module map, $N/IN \\to M/IM$ is surjective, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $N \\to M$ is surjective. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$ and $M$ is finite, then there exists an $f \\in 1 + I$ such that $x_1, \\ldots , x_ n$ generate $M_ f$ over $R_ f$. \n\n\nIf $x_1, \\ldots , x_ n \\in M$ generate $M/IM$, $M$ is finite, and $I \\subset \\text{rad}(R)$, then $M$ is generated by $x_1, \\ldots , x_ n$. \n\n\nIf $IM = M$, $I$ is nilpotent, then $M = 0$. \n\n\nIf $N, N\' \\subset M$, $M = N + IN\'$, and $I$ is nilpotent then $M = N$. \n\n\nIf $N \\to M$ is a module map, $I$ is nilpotent, and $N/IN \\to M/IM$ is surjective, then $N \\to M$ is surjective. \n\n\nIf $\\{ x_\\alpha \\} _{\\alpha \\in A}$ is a set of elements of $M$ which generate $M/IM$ and $I$ is nilpotent, then $M$ is generated by the $x_\\alpha $. \n\n\n\n\n    \n]] these elements generate $M$. We want to show there is no relation among the $x_ i$. Instead, we will show by induction on $n$ that if $x_1, \\ldots , x_ n \\in M$ are linearly independent in the vector space $M/\\mathfrak mM$ then they are independent over $R$. \n    \n      The base case of the induction is where we have $x \\in M$, $x \\not\\in \\mathfrak mM$ and a relation $fx = 0$. By the equational criterion there exist $y_ j \\in M$ and $a_ j \\in R$ such that $x = \\sum a_ j y_ j$ and $fa_ j = 0$ for all $j$. Since $x \\not\\in \\mathfrak mM$ we see that at least one $a_ j$ is a unit and hence $f = 0 $. \n    \n      Suppose that $\\sum f_ i x_ i$ is a relation among $x_1, \\ldots , x_ n$. By our choice of $x_ i$ we have $f_ i \\in \\mathfrak m$. According to the equational criterion of flatness there exist $a_{ij} \\in R$ and $y_ j \\in M$ such that $x_ i = \\sum a_{ij} y_ j$ and $\\sum f_ i a_{ij} = 0$. Since $x_ n \\not\\in \\mathfrak mM$ we see that $a_{nj}\\not\\in \\mathfrak m$ for at least one $j$. Since $\\sum f_ i a_{ij} = 0$ we get $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. The relation $\\sum f_ i x_ i = 0$ now can be rewritten as $\\sum _{i = 1}^{n-1} f_ i( x_ i + (-a_{ij}/a_{nj}) x_ n) = 0$. Note that the elements $x_ i + (-a_{ij}/a_{nj}) x_ n$ map to $n-1$ linearly independent elements of $M/\\mathfrak mM$. By induction assumption we get that all the $f_ i$, $i \\leq n-1$ have to be zero, and also $f_ n = \\sum _{i = 1}^{n-1} (-a_{ij}/a_{nj}) f_ i$. This proves the induction step. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues linear independence over R from linear independence mod m using the equational criterion of flatness plus Nakayama, with an explicit induction on n and manipulation of relations. The Lean snippet instead constructs a basis of k ‚äó[R] P via `Free.chooseBasis`, pulls it back along a surjective tensor map (`TensorProduct.mk_surjective ... .comp_left w`), and then applies `IsLocalRing.linearIndependent_of_flat` to obtain linear independence, finishing with a span/top argument (`span_eq_top_of_tmul_eq_basis`). Structurally, the formal proof is a short basis-lifting/linear-independence-from-flatness argument and does not mirror the induction-on-relations/equational-criterion steps of the informal proof. It captures a related high-level goal (independence over R from independence after tensoring with the residue field in a local ring under flatness), but omits the key mechanisms emphasized informally (equational criterion, Nakayama, induction), so the correspondence is only partial.""}"
313,02M9,"    (n : ‚Ñï) (rk : ‚àÄ P : MaximalSpectrum R, finrank (R ‚ß∏ P.1) ((R ‚ß∏ P.1) ‚äó[R] M) = n) :
    Nonempty (Basis (Fin n) R M) := by
  let := @Quotient.field
  /- For every maximal ideal `P`, `R‚ß∏P ‚äó[R] M` is an `n`-dimensional vector space over the field
    `R‚ß∏P` by assumption, so we can choose a basis `b' P` indexed by `Fin n`. -/
  have b' (P) := Module.finBasisOfFinrankEq _ _ (rk P)
  /- By Chinese remainder theorem for modules, there exist `n` elements `b i : M` that reduces
    to `b' P i` modulo each maximal ideal `P`. -/
  choose b hb using fun i ‚Ü¶ pi_tensorProductMk_quotient_surjective M _
    (fun _ _ ne ‚Ü¶ isCoprime_of_isMaximal (MaximalSpectrum.ext_iff.ne.mp ne)) (b' ¬∑ i)
  /- It suffices to show the linear map `R‚Åø ‚Üí M` induced by `b` is bijective, for which
    it suffices to show `R‚Çö‚Åø ‚Üí R‚Çö ‚äó[R] M` is bijective for each maximal ideal `P`. -/
  refine ‚ü®‚ü®.symm <| .ofBijective (Finsupp.linearCombination R b) <| bijective_of_isLocalized_maximal
    _ (fun P _ ‚Ü¶ Finsupp.mapRange.linearMap (Algebra.linearMap R (Localization P.primeCompl)))
    _ (fun P _ ‚Ü¶ TensorProduct.mk R (Localization P.primeCompl) M 1) _ fun P _ ‚Ü¶ ?_‚ü©‚ü©
  rw [IsLocalizedModule.map_linearCombination, LinearMap.coe_restrictScalars]
  /- Since `M` is finite flat, it suffices to show
    `(R‚Çö‚ß∏PR‚Çö)‚Åø ‚Üí R‚Çö‚ß∏PR‚Çö ‚äó[R‚Çö] R‚Çö ‚äó[R] M ‚âÉ R‚Çö‚ß∏PR‚Çö ‚äó[R‚ß∏P] R‚ß∏P ‚äó[R] M` is bijective,
    which follows from that `(R‚ß∏P)‚Åø ‚Üí R‚ß∏P ‚äó[R] M` is bijective. -/
  apply IsLocalRing.linearCombination_bijective_of_flat
  rw [‚Üê (AlgebraTensorModule.cancelBaseChange _ _ P.ResidueField ..).comp_bijective,
    ‚Üê (AlgebraTensorModule.cancelBaseChange R (R ‚ß∏ P) P.ResidueField ..).symm.comp_bijective]
  convert ((b' ‚ü®P, ‚Äπ_‚Ä∫‚ü©).repr.lTensor _ ‚â™‚â´‚Çó finsuppScalarRight _ _ P.ResidueField _).symm.bijective
  refine funext fun r ‚Ü¶ Finsupp.induction_linear r (by simp) (by simp +contextual) fun _ _ ‚Ü¶ ?_
  simp [smul_tmul', ‚Üê funext_iff.mp (hb _)]
",Formal Proof of Stacks Project Tag 02M9, theorem nonempty_basis_of_flat_of_finrank_eq [Module.Finite R M] [Flat R M,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/LocalRing/Module.lean#L392-L416,Q27041,,10.78.7,lemma,3.0,"['00NV', '00AO', '0ELQ']","\n  Lemma 10.78.7. Let $R$ be a semi-local ring. Let $M$ be a finite locally free module. If $M$ has constant rank, then $M$ is free. In particular, if $R$ has connected spectrum, then $M$ is free. \n\n    \n      Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n","\n  Lemma 10.78.7. Let $R$ be a semi-local ring. Let $M$ be a finite locally free module. If $M$ has constant rank, then $M$ is free. In particular, if $R$ has connected spectrum, then $M$ is free. \n\n    \n","Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n"," by
  let := @Quotient.field
  /- For every maximal ideal `P`, `R‚ß∏P ‚äó[R] M` is an `n`-dimensional vector space over the field
    `R‚ß∏P` by assumption, so we can choose a basis `b' P` indexed by `Fin n`. -/
  have b' (P) := Module.finBasisOfFinrankEq _ _ (rk P)
  /- By Chinese remainder theorem for modules, there exist `n` elements `b i : M` that reduces
    to `b' P i` modulo each maximal ideal `P`. -/
  choose b hb using fun i ‚Ü¶ pi_tensorProductMk_quotient_surjective M _
    (fun _ _ ne ‚Ü¶ isCoprime_of_isMaximal (MaximalSpectrum.ext_iff.ne.mp ne)) (b' ¬∑ i)
  /- It suffices to show the linear map `R‚Åø ‚Üí M` induced by `b` is bijective, for which
    it suffices to show `R‚Çö‚Åø ‚Üí R‚Çö ‚äó[R] M` is bijective for each maximal ideal `P`. -/
  refine ‚ü®‚ü®.symm <| .ofBijective (Finsupp.linearCombination R b) <| bijective_of_isLocalized_maximal
    _ (fun P _ ‚Ü¶ Finsupp.mapRange.linearMap (Algebra.linearMap R (Localization P.primeCompl)))
    _ (fun P _ ‚Ü¶ TensorProduct.mk R (Localization P.primeCompl) M 1) _ fun P _ ‚Ü¶ ?_‚ü©‚ü©
  rw [IsLocalizedModule.map_linearCombination, LinearMap.coe_restrictScalars]
  /- Since `M` is finite flat, it suffices to show
    `(R‚Çö‚ß∏PR‚Çö)‚Åø ‚Üí R‚Çö‚ß∏PR‚Çö ‚äó[R‚Çö] R‚Çö ‚äó[R] M ‚âÉ R‚Çö‚ß∏PR‚Çö ‚äó[R‚ß∏P] R‚ß∏P ‚äó[R] M` is bijective,
    which follows from that `(R‚ß∏P)‚Åø ‚Üí R‚ß∏P ‚äó[R] M` is bijective. -/
  apply IsLocalRing.linearCombination_bijective_of_flat
  rw [‚Üê (AlgebraTensorModule.cancelBaseChange _ _ P.ResidueField ..).comp_bijective,
    ‚Üê (AlgebraTensorModule.cancelBaseChange R (R ‚ß∏ P) P.ResidueField ..).symm.comp_bijective]
  convert ((b' ‚ü®P, ‚Äπ_‚Ä∫‚ü©).repr.lTensor _ ‚â™‚â´‚Çó finsuppScalarRight _ _ P.ResidueField _).symm.bijective
  refine funext fun r ‚Ü¶ Finsupp.induction_linear r (by simp) (by simp +contextual) fun _ _ ‚Ü¶ ?_
  simp [smul_tmul', ‚Üê funext_iff.mp (hb _)]
","    (n : ‚Ñï) (rk : ‚àÄ P : MaximalSpectrum R, finrank (R ‚ß∏ P.1) ((R ‚ß∏ P.1) ‚äó[R] M) = n) :
    Nonempty (Basis (Fin n) R M) ","Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n","Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem nonempty_basis_of_flat_of_finrank_eq [Module.Finite R M] [Flat R M","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the informal outline: it uses the hypothesis that for each maximal ideal P the fiber (R‚ß∏P ‚äó[R] M) has fixed finrank (via `Module.finBasisOfFinrankEq _ _ (rk P)`), then uses a Chinese-remainder-type surjectivity (`pi_tensorProductMk_quotient_surjective` plus coprimeness of distinct maximals) to choose global elements `b i : M` lifting the chosen residue bases, and finally proves these elements form a basis of M by showing the induced linear combination map is bijective, reduced to checking bijectivity after localization at each maximal ideal (`bijective_of_isLocalized_maximal`) and then using flatness to descend bijectivity from residue fields (`IsLocalRing.linearCombination_bijective_of_flat`). Structurally, this corresponds closely to the hinted steps (constant rank ‚Üí choose bases mod maximals ‚Üí CRT to lift ‚Üí conclude basis), though the Lean proof is more sophisticated: it works with tensor products/localizations and linear map bijectivity rather than explicitly with quotients M/ùî™M, and it does not separately prove ‚Äúsame dimension for all maximals‚Äù because that is packaged into the provided `rk P`/assumption. No major extraneous content appears beyond the necessary formal machinery (localization, tensor-cancellation isomorphisms).""}"
314,02M9,"    (n : ‚Ñï) (rk : ‚àÄ P : MaximalSpectrum R, finrank (R ‚ß∏ P.1) ((R ‚ß∏ P.1) ‚äó[R] M) = n) :
    Free R M :=
  have ‚ü®b‚ü© := nonempty_basis_of_flat_of_finrank_eq R M n rk
  .of_basis b
",Formal Proof of Stacks Project Tag 02M9, theorem free_of_flat_of_finrank_eq [Module.Finite R M] [Flat R M,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/LocalRing/Module.lean#L419-L422,Q27041,,10.78.7,lemma,3.0,"['00NV', '00AO', '0ELQ']","\n  Lemma 10.78.7. Let $R$ be a semi-local ring. Let $M$ be a finite locally free module. If $M$ has constant rank, then $M$ is free. In particular, if $R$ has connected spectrum, then $M$ is free. \n\n    \n      Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n","\n  Lemma 10.78.7. Let $R$ be a semi-local ring. Let $M$ be a finite locally free module. If $M$ has constant rank, then $M$ is free. In particular, if $R$ has connected spectrum, then $M$ is free. \n\n    \n","Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n","
  have ‚ü®b‚ü© := nonempty_basis_of_flat_of_finrank_eq R M n rk
  .of_basis b
","    (n : ‚Ñï) (rk : ‚àÄ P : MaximalSpectrum R, finrank (R ‚ß∏ P.1) ((R ‚ß∏ P.1) ‚äó[R] M) = n) :
    Free R M ","Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n","Proof.\n      Omitted. Hints: First show that $M/\\mathfrak m_ iM$ has the same dimension $d$ for all maximal ideal $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$ of $R$ using the rank is constant. Next, show that there exist elements $x_1, \\ldots , x_ d \\in M$ which form a basis for each $M/\\mathfrak m_ iM$ by the Chinese remainder theorem. Finally show that $x_1, \\ldots , x_ d$ is a basis for $M$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: theorem free_of_flat_of_finrank_eq [Module.Finite R M] [Flat R M","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof sketch argues that a finite flat module of constant rank is free by analyzing fibers M/ùî™_i M, using Chinese remainder to pick elements that simultaneously form bases mod each maximal ideal, and then lifting to a basis of M. The Lean snippet instead invokes an existing lemma `nonempty_basis_of_flat_of_finrank_eq R M n rk` to obtain a basis nonconstructively (via `have ‚ü®b‚ü© := ...`) and then immediately concludes `M` is free with `.of_basis b`. This matches the overall theorem statement (flat + finite rank ‚áí free) but does not reflect the specific structure or intermediate steps (dimensions of fibers, CRT, lifting argument) described in the informal proof. Structurally it is a one-line lemma application rather than the multi-step argument hinted informally, so correspondence is weak even though the end result is consistent.""}"
315,07BJ,"theorem local_hom_TFAE (f : R ‚Üí+* S) :
    List.TFAE
      [IsLocalHom f, f '' maximalIdeal R ‚äÜ maximalIdeal S,
        (maximalIdeal R).map f ‚â§ maximalIdeal S, maximalIdeal R ‚â§ (maximalIdeal S).comap f,
        (maximalIdeal S).comap f = maximalIdeal R] := by
  tfae_have 1 ‚Üí 2
  | _, _, ‚ü®a, ha, rfl‚ü© => map_nonunit f a ha
  tfae_have 2 ‚Üí 4 := Set.image_subset_iff.1
  tfae_have 3 ‚Üî 4 := Ideal.map_le_iff_le_comap
  tfae_have 4 ‚Üí 1 := fun h ‚Ü¶ ‚ü®fun x => not_imp_not.1 (@h x)‚ü©
  tfae_have 1 ‚Üí 5
  | _ => by ext; exact not_iff_not.2 (isUnit_map_iff f _)
  tfae_have 5 ‚Üí 4 := fun h ‚Ü¶ le_of_eq h.symm
  tfae_finish
",Formal Proof of Stacks Project Tag 07BJ,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/LocalRing/RingHom/Basic.lean#L81-L94,Q27041,,10.18.4,lemma,3.0,"['07BH', '00AO', '0ELQ']","\n  Lemma 10.18.4. Let $\\varphi : R \\to S$ be a ring map. Assume $R$ and $S$ are local rings. The following are equivalent: \n  \n  \n$\\varphi $ is a local ring map, \n\n\n$\\varphi (\\mathfrak m_ R) \\subset \\mathfrak m_ S$, \n\n\n$\\varphi ^{-1}(\\mathfrak m_ S) = \\mathfrak m_ R$, and \n\n\nfor any $x \\in R$, if $\\varphi (x)$ is invertible in $S$, then $x$ is invertible in $R$. \n\n\n\n\n    \n      Proof.\n      Conditions (1) and (2) are equivalent by definition. If (3) holds then (2) holds. Conversely, if (2) holds, then $\\varphi ^{-1}(\\mathfrak m_ S)$ is a prime ideal containing the maximal ideal $\\mathfrak m_ R$, hence $\\varphi ^{-1}(\\mathfrak m_ S) = \\mathfrak m_ R$. Finally, (4) is the contrapositive of (2) by Lemma 10.18.3. \n      $\\square$\n    \n","\n  Lemma 10.18.4. Let $\\varphi : R \\to S$ be a ring map. Assume $R$ and $S$ are local rings. The following are equivalent: \n  \n  \n$\\varphi $ is a local ring map, \n\n\n$\\varphi (\\mathfrak m_ R) \\subset \\mathfrak m_ S$, \n\n\n$\\varphi ^{-1}(\\mathfrak m_ S) = \\mathfrak m_ R$, and \n\n\nfor any $x \\in R$, if $\\varphi (x)$ is invertible in $S$, then $x$ is invertible in $R$. \n\n\n\n\n    \n","Proof.\n      Conditions (1) and (2) are equivalent by definition. If (3) holds then (2) holds. Conversely, if (2) holds, then $\\varphi ^{-1}(\\mathfrak m_ S)$ is a prime ideal containing the maximal ideal $\\mathfrak m_ R$, hence $\\varphi ^{-1}(\\mathfrak m_ S) = \\mathfrak m_ R$. Finally, (4) is the contrapositive of (2) by Lemma 10.18.3. \n      $\\square$\n    \n"," by
  tfae_have 1 ‚Üí 2
  | _, _, ‚ü®a, ha, rfl‚ü© => map_nonunit f a ha
  tfae_have 2 ‚Üí 4 := Set.image_subset_iff.1
  tfae_have 3 ‚Üî 4 := Ideal.map_le_iff_le_comap
  tfae_have 4 ‚Üí 1 := fun h ‚Ü¶ ‚ü®fun x => not_imp_not.1 (@h x)‚ü©
  tfae_have 1 ‚Üí 5
  | _ => by ext; exact not_iff_not.2 (isUnit_map_iff f _)
  tfae_have 5 ‚Üí 4 := fun h ‚Ü¶ le_of_eq h.symm
  tfae_finish
","theorem local_hom_TFAE (f : R ‚Üí+* S) :
    List.TFAE
      [IsLocalHom f, f '' maximalIdeal R ‚äÜ maximalIdeal S,
        (maximalIdeal R).map f ‚â§ maximalIdeal S, maximalIdeal R ‚â§ (maximalIdeal S).comap f,
        (maximalIdeal S).comap f = maximalIdeal R] ","Proof.\n      Conditions (1) and (2) are equivalent by definition. If (3) holds then (2) holds. Conversely, if (2) holds, then $\\varphi ^{-1}(\\mathfrak m_ S)$ is a prime ideal containing the maximal ideal $\\mathfrak m_ R$, hence $\\varphi ^{-1}(\\mathfrak m_ S) = \\mathfrak m_ R$. Finally, (4) is the contrapositive of (2) by Lemma 10.18.3 [[\n  Lemma 10.18.3. Let $R$ be a ring. The following are equivalent: \n  \n  \n$R$ is a local ring, \n\n\n$\\mathop{\\mathrm{Spec}}(R)$ has exactly one closed point, \n\n\n$R$ has a maximal ideal $\\mathfrak m$ and every element of $R \\setminus \\mathfrak m$ is a unit, and \n\n\n$R$ is not the zero ring and for every $x \\in R$ either $x$ or $1 - x$ is invertible or both. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Conditions (1) and (2) are equivalent by definition. If (3) holds then (2) holds. Conversely, if (2) holds, then $\\varphi ^{-1}(\\mathfrak m_ S)$ is a prime ideal containing the maximal ideal $\\mathfrak m_ R$, hence $\\varphi ^{-1}(\\mathfrak m_ S) = \\mathfrak m_ R$. Finally, (4) is the contrapositive of (2) by Lemma 10.18.3 [[\n  Lemma 10.18.3. Let $R$ be a ring. The following are equivalent: \n  \n  \n$R$ is a local ring, \n\n\n$\\mathop{\\mathrm{Spec}}(R)$ has exactly one closed point, \n\n\n$R$ has a maximal ideal $\\mathfrak m$ and every element of $R \\setminus \\mathfrak m$ is a unit, and \n\n\n$R$ is not the zero ring and for every $x \\in R$ either $x$ or $1 - x$ is invertible or both. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is a `tfae` chain about a ring homomorphism `f` preserving nonunits/units and relating images/comaps of ideals (using `map_nonunit`, `Set.image_subset_iff`, `Ideal.map_le_iff_le_comap`, and `isUnit_map_iff`). The informal proof, however, discusses equivalences between conditions about local rings/maximal ideals and a prime ideal pullback argument (\""œÜ^{-1}(m_S) is prime containing m_R, hence equals m_R\""), and then uses a contrapositive via a specific lemma about characterizations of local rings. Structurally, both are proving a multi-way equivalence, but the steps do not correspond: the Lean proof does not include the prime-ideal containment/maximality argument nor the local-ring characterization lemma; instead it uses general set/ideal lemmas and unit-mapping facts. Thus there is only weak alignment at the level of \""prove several equivalent conditions\"" but not in the actual mathematical content or proof structure.""}"
316,030T,"theorem IsGeometricallyReduced.of_forall_fg
    (h : ‚àÄ B : Subalgebra k A, B.FG ‚Üí IsGeometricallyReduced k B) :
    IsGeometricallyReduced k A := by
  simp_rw [isGeometricallyReduced_iff] at h
  exact ‚ü®IsReduced.tensorProduct_of_flat_of_forall_fg h‚ü©
",Formal Proof of Stacks Project Tag 030T,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Nilpotent/GeometricallyReduced.lean#L72-L76,Q27041,,10.43.2,lemma,3.0,"['05DS', '00AO', '0ELQ']","\n  Lemma 10.43.2. Elementary properties of geometrically reduced algebras. Let $k$ be a field. Let $S$ be a $k$-algebra. \n  \n  \nIf $S$ is geometrically reduced over $k$ so is every $k$-subalgebra. \n\n\nIf all finitely generated $k$-subalgebras of $S$ are geometrically reduced, then $S$ is geometrically reduced. \n\n\nA directed colimit of geometrically reduced $k$-algebras is geometrically reduced. \n\n\nIf $S$ is geometrically reduced over $k$, then any localization of $S$ is geometrically reduced over $k$. \n\n\n\n\n    \n      Proof.\n      Omitted. The second and third property follow from the fact that tensor product commutes with colimits. \n      $\\square$\n    \n","\n  Lemma 10.43.2. Elementary properties of geometrically reduced algebras. Let $k$ be a field. Let $S$ be a $k$-algebra. \n  \n  \nIf $S$ is geometrically reduced over $k$ so is every $k$-subalgebra. \n\n\nIf all finitely generated $k$-subalgebras of $S$ are geometrically reduced, then $S$ is geometrically reduced. \n\n\nA directed colimit of geometrically reduced $k$-algebras is geometrically reduced. \n\n\nIf $S$ is geometrically reduced over $k$, then any localization of $S$ is geometrically reduced over $k$. \n\n\n\n\n    \n",Proof.\n      Omitted. The second and third property follow from the fact that tensor product commutes with colimits. \n      $\\square$\n    \n," by
  simp_rw [isGeometricallyReduced_iff] at h
  exact ‚ü®IsReduced.tensorProduct_of_flat_of_forall_fg h‚ü©
","theorem IsGeometricallyReduced.of_forall_fg
    (h : ‚àÄ B : Subalgebra k A, B.FG ‚Üí IsGeometricallyReduced k B) :
    IsGeometricallyReduced k A ",Proof.\n      Omitted. The second and third property follow from the fact that tensor product commutes with colimits. \n      $\\square$\n    \n,Proof.\n      Omitted. The second and third property follow from the fact that tensor product commutes with colimits. \n      $\\square$\n    \n,"{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the formal proof rewrites the hypothesis using `isGeometricallyReduced_iff` and then applies a specific lemma `IsReduced.tensorProduct_of_flat_of_forall_fg` to produce the goal, yielding an existence/structure via `‚ü®‚Ä¶‚ü©`. The informal proof instead says the relevant properties follow because tensor product commutes with colimits, with no mention of geometric reducedness, flatness, or the `forall_fg` condition. Structurally, the formal proof is a short lemma-application after a rewrite, while the informal proof appeals to a different high-level categorical argument (colimits) and omits details. Thus they are only weakly aligned: both are brief and rely on a general fact, but the stated reasoning and invoked mechanisms do not correspond.""}"
318,00H6,"lemma isIntegral_coeff_of_dvd (p : R[X]) (q : S[X]) (hp : p.Monic) (hq : q.Monic)
    (H : q ‚à£ p.map (algebraMap R S)) (i : ‚Ñï) : IsIntegral R (q.coeff i) := by
  nontriviality S
  obtain ‚ü®T, _, _, _, _, _, hqT‚ü© := hq.exists_splits_map
  algebraize [(algebraMap S T).comp (algebraMap R S)]
  refine (isIntegral_algHom_iff (IsScalarTower.toAlgHom R S T)
    (FaithfulSMul.algebraMap_injective S _)).mp ?_
  rw [IsScalarTower.coe_toAlgHom', ‚Üê coeff_map]
  refine Polynomial.isIntegral_coeff_of_factors _ (by simp [hq.map, isIntegral_one]) hqT ?_ i
  intro x hx
  exact ‚ü®p, hp, by simpa using aeval_eq_zero_of_dvd_aeval_eq_zero (a := x) H (by simp_all)‚ü©
",Formal Proof of Stacks Project Tag 00H6,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Polynomial/IsIntegral.lean#L62-L72,Q27041,,10.38.5,lemma,3.0,"['037E', '00AO', '0ELQ']","\n  Lemma 10.38.5. Let $K$ be a field. Let $n, m \\in \\mathbf{N}$ and $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1} \\in K$. If the polynomial $x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0$ divides the polynomial $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0$ in $K[x]$ then \n  \n  \n$a_0, \\ldots , a_{n - 1}$ are integral over any subring $R_0$ of $K$ containing the elements $b_0, \\ldots , b_{m - 1}$, and \n\n\neach $a_ i$ lies in $\\sqrt{(b_0, \\ldots , b_{m-1})R}$ for any subring $R \\subset K$ containing the elements $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1}$. \n\n\n\n\n    \n      Proof.\n      Let $L/K$ be a field extension such that we can write $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \\prod _{i = 1}^ m (x - \\beta _ i)$ with $\\beta _ i \\in L$. See Fields, Section 9.16. Each $\\beta _ i$ is integral over $R_0$. Since each $a_ i$ is a homogeneous polynomial in $\\beta _1, \\ldots , \\beta _ m$ we deduce the same for the $a_ i$ (use Lemma 10.36.7). \n    \n      Choose $c_0, \\ldots , c_{m - n - 1} \\in K$ such that \n    \n      \n  \\[  \\begin{matrix}  x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \n\n\\\\  (x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0) (x^{m - n} + c_{m - n - 1}x^{m - n - 1}+ \\ldots + c_0). \n\n\\end{matrix}  \\]\n\n    \n       By part (1) the elements $c_ i$ are integral over $R$. Consider the integral extension \n    \n      \n  \\[  R \\subset R\' = R[c_0, \\ldots , c_{m - n - 1}] \\subset K  \\]\n\n    \n       By Lemmas 10.36.17 and 10.30.3 we see that $R \\cap \\sqrt{(b_0, \\ldots , b_{m - 1})R\'} = \\sqrt{(b_0, \\ldots , b_{m - 1})R}$. Thus we may replace $R$ by $R\'$ and assume $c_ i \\in R$. Dividing out the radical $\\sqrt{(b_0, \\ldots , b_{m - 1})}$ we get a reduced ring $\\overline{R}$. We have to show that the images $\\overline{a}_ i \\in \\overline{R}$ are zero. And in $\\overline{R}[x]$ we have the relation \n    \n      \n  \\[  \\begin{matrix}  x^ m = x^ m + \\overline{b}_{m - 1} x^{m - 1} + \\ldots + \\overline{b}_0 = \n\n\\\\  (x^ n + \\overline{a}_{n - 1}x^{n - 1} + \\ldots + \\overline{a}_0) (x^{m - n} + \\overline{c}_{m - n - 1}x^{m - n - 1}+ \\ldots + \\overline{c}_0). \n\n\\end{matrix}  \\]\n\n    \n       It is easy to see that this implies $\\overline{a}_ i = 0$ for all $i$. Indeed by Lemma 10.25.1 the localization of $\\overline{R}$ at a minimal prime $\\mathfrak {p}$ is a field and $\\overline{R}_{\\mathfrak p}[x]$ a UFD. Thus $f = x^ n + \\sum \\overline{a}_ i x^ i$ is associated to $x^ n$ and since $f$ is monic $f = x^ n$ in $\\overline{R}_{\\mathfrak p}[x]$. Then there exists an $s \\in \\overline{R}$, $s \\not\\in \\mathfrak p$ such that $s(f - x^ n) = 0$. Therefore all $\\overline{a}_ i$ lie in $\\mathfrak p$ and we conclude by Lemma 10.25.2. \n      $\\square$\n    \n","\n  Lemma 10.38.5. Let $K$ be a field. Let $n, m \\in \\mathbf{N}$ and $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1} \\in K$. If the polynomial $x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0$ divides the polynomial $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0$ in $K[x]$ then \n  \n  \n$a_0, \\ldots , a_{n - 1}$ are integral over any subring $R_0$ of $K$ containing the elements $b_0, \\ldots , b_{m - 1}$, and \n\n\neach $a_ i$ lies in $\\sqrt{(b_0, \\ldots , b_{m-1})R}$ for any subring $R \\subset K$ containing the elements $a_0, \\ldots , a_{n - 1}, b_0, \\ldots , b_{m - 1}$. \n\n\n\n\n    \n","Proof.\n      Let $L/K$ be a field extension such that we can write $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \\prod _{i = 1}^ m (x - \\beta _ i)$ with $\\beta _ i \\in L$. See Fields, Section 9.16. Each $\\beta _ i$ is integral over $R_0$. Since each $a_ i$ is a homogeneous polynomial in $\\beta _1, \\ldots , \\beta _ m$ we deduce the same for the $a_ i$ (use Lemma 10.36.7). \n    \n      Choose $c_0, \\ldots , c_{m - n - 1} \\in K$ such that \n    \n      \n  \\[  \\begin{matrix}  x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \n\n\\\\  (x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0) (x^{m - n} + c_{m - n - 1}x^{m - n - 1}+ \\ldots + c_0). \n\n\\end{matrix}  \\]\n\n    \n       By part (1) the elements $c_ i$ are integral over $R$. Consider the integral extension \n    \n      \n  \\[  R \\subset R\' = R[c_0, \\ldots , c_{m - n - 1}] \\subset K  \\]\n\n    \n       By Lemmas 10.36.17 and 10.30.3 we see that $R \\cap \\sqrt{(b_0, \\ldots , b_{m - 1})R\'} = \\sqrt{(b_0, \\ldots , b_{m - 1})R}$. Thus we may replace $R$ by $R\'$ and assume $c_ i \\in R$. Dividing out the radical $\\sqrt{(b_0, \\ldots , b_{m - 1})}$ we get a reduced ring $\\overline{R}$. We have to show that the images $\\overline{a}_ i \\in \\overline{R}$ are zero. And in $\\overline{R}[x]$ we have the relation \n    \n      \n  \\[  \\begin{matrix}  x^ m = x^ m + \\overline{b}_{m - 1} x^{m - 1} + \\ldots + \\overline{b}_0 = \n\n\\\\  (x^ n + \\overline{a}_{n - 1}x^{n - 1} + \\ldots + \\overline{a}_0) (x^{m - n} + \\overline{c}_{m - n - 1}x^{m - n - 1}+ \\ldots + \\overline{c}_0). \n\n\\end{matrix}  \\]\n\n    \n       It is easy to see that this implies $\\overline{a}_ i = 0$ for all $i$. Indeed by Lemma 10.25.1 the localization of $\\overline{R}$ at a minimal prime $\\mathfrak {p}$ is a field and $\\overline{R}_{\\mathfrak p}[x]$ a UFD. Thus $f = x^ n + \\sum \\overline{a}_ i x^ i$ is associated to $x^ n$ and since $f$ is monic $f = x^ n$ in $\\overline{R}_{\\mathfrak p}[x]$. Then there exists an $s \\in \\overline{R}$, $s \\not\\in \\mathfrak p$ such that $s(f - x^ n) = 0$. Therefore all $\\overline{a}_ i$ lie in $\\mathfrak p$ and we conclude by Lemma 10.25.2. \n      $\\square$\n    \n"," by
  nontriviality S
  obtain ‚ü®T, _, _, _, _, _, hqT‚ü© := hq.exists_splits_map
  algebraize [(algebraMap S T).comp (algebraMap R S)]
  refine (isIntegral_algHom_iff (IsScalarTower.toAlgHom R S T)
    (FaithfulSMul.algebraMap_injective S _)).mp ?_
  rw [IsScalarTower.coe_toAlgHom', ‚Üê coeff_map]
  refine Polynomial.isIntegral_coeff_of_factors _ (by simp [hq.map, isIntegral_one]) hqT ?_ i
  intro x hx
  exact ‚ü®p, hp, by simpa using aeval_eq_zero_of_dvd_aeval_eq_zero (a := x) H (by simp_all)‚ü©
","lemma isIntegral_coeff_of_dvd (p : R[X]) (q : S[X]) (hp : p.Monic) (hq : q.Monic)
    (H : q ‚à£ p.map (algebraMap R S)) (i : ‚Ñï) : IsIntegral R (q.coeff i) ","Proof.\n      Let $L/K$ be a field extension such that we can write $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \\prod _{i = 1}^ m (x - \\beta _ i)$ with $\\beta _ i \\in L$. See Fields, Section 9.16 [[9.16 Splitting fields\n\n\nThe following lemma is a useful tool for constructing normal field extensions. \n\n\n\n  Lemma 9.16.1. Let $F$ be a field. Let $P \\in F[x]$ be a nonconstant polynomial. There exists a smallest field extension $E/F$ such that $P$ splits completely over $E$. Moreover, the field extension $E/F$ is normal and unique up to (nonunique) isomorphism. \n \n\n\n    \n]]. Each $\\beta _ i$ is integral over $R_0$. Since each $a_ i$ is a homogeneous polynomial in $\\beta _1, \\ldots , \\beta _ m$ we deduce the same for the $a_ i$ (use Lemma 10.36.7 [[\n  Lemma 10.36.7. Let $R \\to S$ be a ring homomorphism. The set \n  \n  \\[  S\' = \\{ s \\in S \\mid s\\text{ is integral over }R\\}   \\]\n\n   is an $R$-subalgebra of $S$. \n\n    \n]]). \n    \n      Choose $c_0, \\ldots , c_{m - n - 1} \\in K$ such that \n    \n      \n  \\[  \\begin{matrix}  x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \n\n\\\\  (x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0) (x^{m - n} + c_{m - n - 1}x^{m - n - 1}+ \\ldots + c_0). \n\n\\end{matrix}  \\]\n\n    \n       By part (1) the elements $c_ i$ are integral over $R$. Consider the integral extension \n    \n      \n  \\[  R \\subset R\' = R[c_0, \\ldots , c_{m - n - 1}] \\subset K  \\]\n\n    \n       By Lemmas 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] and 10.30.3 [[\n  Lemma 10.30.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n\nFor any ideal $I \\subset R$ the inverse image of $\\sqrt{IS}$ in $R$ is equal to $\\sqrt{I}$. \n\n\nFor any radical ideal $I \\subset R$ the inverse image of $IS$ in $R$ is equal to $I$. \n\n\nFor every prime $\\mathfrak p$ of $R$ the inverse image of $\\mathfrak p S$ in $R$ is $\\mathfrak p$. \n\n\n\n   In this case the same is true after any base change: Given a ring map $R \\to R\'$ the ring map $R\' \\to R\' \\otimes _ R S$ has the equivalent properties (1), (2), (3) as well. \n\n    \n]] we see that $R \\cap \\sqrt{(b_0, \\ldots , b_{m - 1})R\'} = \\sqrt{(b_0, \\ldots , b_{m - 1})R}$. Thus we may replace $R$ by $R\'$ and assume $c_ i \\in R$. Dividing out the radical $\\sqrt{(b_0, \\ldots , b_{m - 1})}$ we get a reduced ring $\\overline{R}$. We have to show that the images $\\overline{a}_ i \\in \\overline{R}$ are zero. And in $\\overline{R}[x]$ we have the relation \n    \n      \n  \\[  \\begin{matrix}  x^ m = x^ m + \\overline{b}_{m - 1} x^{m - 1} + \\ldots + \\overline{b}_0 = \n\n\\\\  (x^ n + \\overline{a}_{n - 1}x^{n - 1} + \\ldots + \\overline{a}_0) (x^{m - n} + \\overline{c}_{m - n - 1}x^{m - n - 1}+ \\ldots + \\overline{c}_0). \n\n\\end{matrix}  \\]\n\n    \n       It is easy to see that this implies $\\overline{a}_ i = 0$ for all $i$. Indeed by Lemma 10.25.1 [[\n  Lemma 10.25.1. Let $\\mathfrak p$ be a minimal prime of a ring $R$. Every element of the maximal ideal of $R_{\\mathfrak p}$ is nilpotent. If $R$ is reduced then $R_{\\mathfrak p}$ is a field. \n\n    \n]] the localization of $\\overline{R}$ at a minimal prime $\\mathfrak {p}$ is a field and $\\overline{R}_{\\mathfrak p}[x]$ a UFD. Thus $f = x^ n + \\sum \\overline{a}_ i x^ i$ is associated to $x^ n$ and since $f$ is monic $f = x^ n$ in $\\overline{R}_{\\mathfrak p}[x]$. Then there exists an $s \\in \\overline{R}$, $s \\not\\in \\mathfrak p$ such that $s(f - x^ n) = 0$. Therefore all $\\overline{a}_ i$ lie in $\\mathfrak p$ and we conclude by Lemma 10.25.2 [[\n  Lemma 10.25.2. Let $R$ be a reduced ring. Then \n  \n  \n$R$ is a subring of a product of fields, \n\n\n$R \\to \\prod _{\\mathfrak p\\text{ minimal}} R_{\\mathfrak p}$ is an embedding into a product of fields, \n\n\n$\\bigcup _{\\mathfrak p\\text{ minimal}} \\mathfrak p$ is the set of zerodivisors of $R$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Let $L/K$ be a field extension such that we can write $x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \\prod _{i = 1}^ m (x - \\beta _ i)$ with $\\beta _ i \\in L$. See Fields, Section 9.16 [[9.16 Splitting fields\n\n\nThe following lemma is a useful tool for constructing normal field extensions. \n\n\n\n  Lemma 9.16.1. Let $F$ be a field. Let $P \\in F[x]$ be a nonconstant polynomial. There exists a smallest field extension $E/F$ such that $P$ splits completely over $E$. Moreover, the field extension $E/F$ is normal and unique up to (nonunique) isomorphism. \n \n\n\n    \n]]. Each $\\beta _ i$ is integral over $R_0$. Since each $a_ i$ is a homogeneous polynomial in $\\beta _1, \\ldots , \\beta _ m$ we deduce the same for the $a_ i$ (use Lemma 10.36.7 [[\n  Lemma 10.36.7. Let $R \\to S$ be a ring homomorphism. The set \n  \n  \\[  S\' = \\{ s \\in S \\mid s\\text{ is integral over }R\\}   \\]\n\n   is an $R$-subalgebra of $S$. \n\n    \n]]). \n    \n      Choose $c_0, \\ldots , c_{m - n - 1} \\in K$ such that \n    \n      \n  \\[  \\begin{matrix}  x^ m + b_{m - 1} x^{m - 1} + \\ldots + b_0 = \n\n\\\\  (x^ n + a_{n - 1}x^{n - 1} + \\ldots + a_0) (x^{m - n} + c_{m - n - 1}x^{m - n - 1}+ \\ldots + c_0). \n\n\\end{matrix}  \\]\n\n    \n       By part (1) the elements $c_ i$ are integral over $R$. Consider the integral extension \n    \n      \n  \\[  R \\subset R\' = R[c_0, \\ldots , c_{m - n - 1}] \\subset K  \\]\n\n    \n       By Lemmas 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] and 10.30.3 [[\n  Lemma 10.30.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n\nFor any ideal $I \\subset R$ the inverse image of $\\sqrt{IS}$ in $R$ is equal to $\\sqrt{I}$. \n\n\nFor any radical ideal $I \\subset R$ the inverse image of $IS$ in $R$ is equal to $I$. \n\n\nFor every prime $\\mathfrak p$ of $R$ the inverse image of $\\mathfrak p S$ in $R$ is $\\mathfrak p$. \n\n\n\n   In this case the same is true after any base change: Given a ring map $R \\to R\'$ the ring map $R\' \\to R\' \\otimes _ R S$ has the equivalent properties (1), (2), (3) as well. \n\n    \n]] we see that $R \\cap \\sqrt{(b_0, \\ldots , b_{m - 1})R\'} = \\sqrt{(b_0, \\ldots , b_{m - 1})R}$. Thus we may replace $R$ by $R\'$ and assume $c_ i \\in R$. Dividing out the radical $\\sqrt{(b_0, \\ldots , b_{m - 1})}$ we get a reduced ring $\\overline{R}$. We have to show that the images $\\overline{a}_ i \\in \\overline{R}$ are zero. And in $\\overline{R}[x]$ we have the relation \n    \n      \n  \\[  \\begin{matrix}  x^ m = x^ m + \\overline{b}_{m - 1} x^{m - 1} + \\ldots + \\overline{b}_0 = \n\n\\\\  (x^ n + \\overline{a}_{n - 1}x^{n - 1} + \\ldots + \\overline{a}_0) (x^{m - n} + \\overline{c}_{m - n - 1}x^{m - n - 1}+ \\ldots + \\overline{c}_0). \n\n\\end{matrix}  \\]\n\n    \n       It is easy to see that this implies $\\overline{a}_ i = 0$ for all $i$. Indeed by Lemma 10.25.1 [[\n  Lemma 10.25.1. Let $\\mathfrak p$ be a minimal prime of a ring $R$. Every element of the maximal ideal of $R_{\\mathfrak p}$ is nilpotent. If $R$ is reduced then $R_{\\mathfrak p}$ is a field. \n\n    \n]] the localization of $\\overline{R}$ at a minimal prime $\\mathfrak {p}$ is a field and $\\overline{R}_{\\mathfrak p}[x]$ a UFD. Thus $f = x^ n + \\sum \\overline{a}_ i x^ i$ is associated to $x^ n$ and since $f$ is monic $f = x^ n$ in $\\overline{R}_{\\mathfrak p}[x]$. Then there exists an $s \\in \\overline{R}$, $s \\not\\in \\mathfrak p$ such that $s(f - x^ n) = 0$. Therefore all $\\overline{a}_ i$ lie in $\\mathfrak p$ and we conclude by Lemma 10.25.2 [[\n  Lemma 10.25.2. Let $R$ be a reduced ring. Then \n  \n  \n$R$ is a subring of a product of fields, \n\n\n$R \\to \\prod _{\\mathfrak p\\text{ minimal}} R_{\\mathfrak p}$ is an embedding into a product of fields, \n\n\n$\\bigcup _{\\mathfrak p\\text{ minimal}} \\mathfrak p$ is the set of zerodivisors of $R$. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about integrality transported along a scalar tower using a splitting field: it invokes `hq.exists_splits_map` to get an extension `T` where a polynomial splits, then uses `isIntegral_algHom_iff` and `Polynomial.isIntegral_coeff_of_factors` plus an `aeval`-divisibility argument to conclude integrality of certain coefficients. The informal proof, however, is primarily a commutative algebra argument: it adjoins coefficients `c_i`, uses integrality to get an integral extension, applies surjectivity of `Spec` and radical contraction to replace the base ring, then reduces modulo a radical and uses localization at minimal primes/UFD arguments to deduce the reduced images of the `a_i` are zero. Structurally, the informal proof has major steps (integral extension ‚Üí Spec surjectivity/base change ‚Üí reduction ‚Üí localization at minimal primes ‚Üí conclude coefficients vanish) that are absent from the Lean script; conversely, the Lean script‚Äôs core steps (splitting map, algebraization, `isIntegral_coeff_of_factors`) do not correspond to the Spec/radical/localization reasoning. Thus there is only partial thematic overlap (integrality of coefficients arising from factorization), but the main logical route and conclusion in the informal proof are not reflected in the Lean proof.""}"
319,00H0,"lemma IsAlmostIntegral.coeff [IsDomain R] [FaithfulSMul R S]
    {p : S[X]} (hp : IsAlmostIntegral R[X] p) (i : ‚Ñï) :
    IsAlmostIntegral R (p.coeff i) := by
  have H {q : S[X]} (hq : IsAlmostIntegral R[X] q) : IsAlmostIntegral R q.leadingCoeff := by
    obtain ‚ü®p, hp, hp'‚ü© := hq
    refine ‚ü®p.leadingCoeff, by simpa using hp, fun n ‚Ü¶ ?_‚ü©
    obtain ‚ü®r, hr‚ü© := hp' n
    simp only [Algebra.smul_def, algebraMap_def, coe_mapRingHom] at hr ‚ä¢
    by_cases h : algebraMap R S p.leadingCoeff * q.leadingCoeff ^ n = 0
    ¬∑ simp [h]
    have h' : q.leadingCoeff ^ n ‚â† 0 := by aesop
    use r.leadingCoeff
    simp only [‚Üê leadingCoeff_map_of_injective (FaithfulSMul.algebraMap_injective R S), hr] at h ‚ä¢
    rw [‚Üê leadingCoeff_pow' h'] at h ‚ä¢
    rw [leadingCoeff_mul' h]
  induction hn : p.natDegree using Nat.strong_induction_on generalizing p with | h n IH =>
  by_cases hp' : p.natDegree = 0
  ¬∑ obtain ‚ü®p, rfl‚ü© := natDegree_eq_zero.mp hp'
    simp only [coeff_C]
    split_ifs with h
    ¬∑ simpa using H hp
    ¬∑ exact (completeIntegralClosure R S).zero_mem
  by_cases hi : i = p.natDegree
  ¬∑ simp [hi, H hp]
  have : IsAlmostIntegral R[X] p.eraseLead := by
    rw [‚Üê self_sub_monomial_natDegree_leadingCoeff, ‚Üê mem_completeIntegralClosure,
      ‚Üê C_mul_X_pow_eq_monomial, ‚Üê map_X (algebraMap R S), ‚Üê Polynomial.map_pow]
    refine sub_mem hp (mul_mem ?_ (algebraMap_mem (R := R[X]) _ _))
    obtain ‚ü®r, hr, hr'‚ü© := H hp
    refine ‚ü®C r, by simpa using hr, fun n ‚Ü¶ ?_‚ü©
    obtain ‚ü®s, hs‚ü© := hr' n
    exact ‚ü®C s, by simp [Algebra.smul_def, hs]‚ü©
  simpa [hi, eraseLead_coeff_of_ne] using
    IH (p := p.eraseLead) _ (p.eraseLead_natDegree_le.trans_lt (by lia)) this rfl
",Formal Proof of Stacks Project Tag 00H0,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Polynomial/IsIntegral.lean#L85-L118,Q27041,,10.37.7,lemma,3.0,"['037B', '00AO', '0ELQ']","\n  Lemma 10.37.7. Let $R$ be a domain with fraction field $K$. Suppose $f = \\sum \\alpha _ i x^ i$ is an element of $K[x]$. \n  \n  \nIf $f$ is integral over $R[x]$ then all $\\alpha _ i$ are integral over $R$, and \n\n\nIf $f$ is almost integral over $R[x]$ then all $\\alpha _ i$ are almost integral over $R$. \n\n\n\n\n    \n      Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4. Of course, then they are integral over $R$. \n      $\\square$\n    \n","\n  Lemma 10.37.7. Let $R$ be a domain with fraction field $K$. Suppose $f = \\sum \\alpha _ i x^ i$ is an element of $K[x]$. \n  \n  \nIf $f$ is integral over $R[x]$ then all $\\alpha _ i$ are integral over $R$, and \n\n\nIf $f$ is almost integral over $R[x]$ then all $\\alpha _ i$ are almost integral over $R$. \n\n\n\n\n    \n","Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4. Of course, then they are integral over $R$. \n      $\\square$\n    \n"," by
  have H {q : S[X]} (hq : IsAlmostIntegral R[X] q) : IsAlmostIntegral R q.leadingCoeff := by
    obtain ‚ü®p, hp, hp'‚ü© := hq
    refine ‚ü®p.leadingCoeff, by simpa using hp, fun n ‚Ü¶ ?_‚ü©
    obtain ‚ü®r, hr‚ü© := hp' n
    simp only [Algebra.smul_def, algebraMap_def, coe_mapRingHom] at hr ‚ä¢
    by_cases h : algebraMap R S p.leadingCoeff * q.leadingCoeff ^ n = 0
    ¬∑ simp [h]
    have h' : q.leadingCoeff ^ n ‚â† 0 := by aesop
    use r.leadingCoeff
    simp only [‚Üê leadingCoeff_map_of_injective (FaithfulSMul.algebraMap_injective R S), hr] at h ‚ä¢
    rw [‚Üê leadingCoeff_pow' h'] at h ‚ä¢
    rw [leadingCoeff_mul' h]
  induction hn : p.natDegree using Nat.strong_induction_on generalizing p with | h n IH =>
  by_cases hp' : p.natDegree = 0
  ¬∑ obtain ‚ü®p, rfl‚ü© := natDegree_eq_zero.mp hp'
    simp only [coeff_C]
    split_ifs with h
    ¬∑ simpa using H hp
    ¬∑ exact (completeIntegralClosure R S).zero_mem
  by_cases hi : i = p.natDegree
  ¬∑ simp [hi, H hp]
  have : IsAlmostIntegral R[X] p.eraseLead := by
    rw [‚Üê self_sub_monomial_natDegree_leadingCoeff, ‚Üê mem_completeIntegralClosure,
      ‚Üê C_mul_X_pow_eq_monomial, ‚Üê map_X (algebraMap R S), ‚Üê Polynomial.map_pow]
    refine sub_mem hp (mul_mem ?_ (algebraMap_mem (R := R[X]) _ _))
    obtain ‚ü®r, hr, hr'‚ü© := H hp
    refine ‚ü®C r, by simpa using hr, fun n ‚Ü¶ ?_‚ü©
    obtain ‚ü®s, hs‚ü© := hr' n
    exact ‚ü®C s, by simp [Algebra.smul_def, hs]‚ü©
  simpa [hi, eraseLead_coeff_of_ne] using
    IH (p := p.eraseLead) _ (p.eraseLead_natDegree_le.trans_lt (by lia)) this rfl
","lemma IsAlmostIntegral.coeff [IsDomain R] [FaithfulSMul R S]
    {p : S[X]} (hp : IsAlmostIntegral R[X] p) (i : ‚Ñï) :
    IsAlmostIntegral R (p.coeff i) ","Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3 [[\n  Lemma 10.31.3. Any finite type algebra over a field is Noetherian. Any finite type algebra over $\\mathbf{Z}$ is Noetherian. \n\n    \n]]. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]] the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]. Of course, then they are integral over $R$. \n      $\\square$\n    \n","Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3 [[\n  Lemma 10.31.3. Any finite type algebra over a field is Noetherian. Any finite type algebra over $\\mathbf{Z}$ is Noetherian. \n\n    \n]]. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]] the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]. Of course, then they are integral over $R$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the informal proof of the *second statement*: it shows that if a polynomial p is almost integral over R[X], then its leading coefficient is almost integral over R (lemma H), and then proves by strong induction on natDegree that each coefficient (indexed by i) is almost integral, by reducing from p to p.eraseLead = p ‚àí (leadingCoeff * X^natDegree). This mirrors the informal argument: deduce almost integrality of the top coefficient from the condition f^n h ‚àà R[x], then use that almost integral elements form a subring to conclude f ‚àí Œ±_r x^r is almost integral and induct on degree.\n\nStructurally, the correspondence is strong: H corresponds to extracting b_s Œ±_r^n ‚àà R for all n; the step using sub_mem/mul_mem and self_sub_monomial_natDegree_leadingCoeff corresponds to subtracting the top monomial and using closure under subtraction/multiplication; the induction on natDegree corresponds to induction on r. The Lean proof is more technical (leadingCoeff_map_of_injective, handling zero cases, eraseLead_coeff_of_ne) but these are implementation details rather than extra mathematical content.\n\nHowever, the informal proof also contains a *first statement* proved via Noetherian reduction (constructing R0, using Noetherian ‚áî almost integral = integral, etc.), which is not present in the Lean code shown. Thus the alignment is not perfect overall, but is very good for the second-statement portion.""}"
320,00H0,"protected lemma IsIntegral.coeff
    {p : S[X]} (hp : IsIntegral R[X] p) (i : ‚Ñï) : IsIntegral R (p.coeff i) := by
  nontriviality R
  nontriviality S
  obtain rfl | hp0 := eq_or_ne p 0; ¬∑ simp [isIntegral_zero]
  let q := minpoly R[X] p
  let m := (q.support.sup fun i ‚Ü¶ (q.coeff i).natDegree) + p.natDegree + 1
  have hm‚ÇÅ (i) : (q.coeff i).natDegree < m := by
    by_cases hi : i ‚àà q.support
    ¬∑ exact (Finset.le_sup (f := fun i ‚Ü¶ (q.coeff i).natDegree) hi).trans_lt (by lia)
    ¬∑ simp_all [m]
  have hm‚ÇÅ' : (q.eval (X ^ m)).Monic := by
    rw [eval_eq_sum_range, Finset.sum_range_succ]
    refine .add_of_right (by simp [q, minpoly.monic hp, ‚Üê pow_mul]) (degree_lt_degree ?_)
    refine lt_of_lt_of_eq (b := m * q.natDegree) ?_ (by simp [q, minpoly.monic hp, ‚Üê pow_mul])
    refine (natDegree_sum_le ..).trans_lt ((Finset.fold_max_lt _).mpr
      ‚ü®by simpa using ‚ü®by lia, minpoly.natDegree_pos hp‚ü©, fun i hi ‚Ü¶ ?_‚ü©)
    dsimp
    simp only [Finset.mem_range] at hi
    grw [‚Üê pow_mul, natDegree_mul_le, natDegree_X_pow, ‚Üê Nat.add_one_le_iff.mpr hi]
    have := hm‚ÇÅ i
    lia
  have hm‚ÇÇ : p.natDegree < m := by grind
  have h‚ÇÄ : algebraMap R[X] S[X] X = X := by simp
  have : (((taylor (X ^ m)) q).map (algebraMap R[X] S[X])).IsRoot (p - X ^ m) := by
    simpa [-algebraMap_def, q, h‚ÇÄ] using
      ((q.map (algebraMap _ _)).taylor_eval (X ^ m) (p - X ^ m) :)
  have : X ^ m - p ‚à£ (eval (X ^ m) q).map (algebraMap _ _) := by
    change X ^ m - p ‚à£ Algebra.ofId R[X] S[X] _
    rw [‚Üê coe_aeval_eq_eval, ‚Üê aeval_algHom_apply, ‚Üê neg_dvd, neg_sub]
    simpa [Polynomial.taylor_coeff_zero, -algebraMap_def, h‚ÇÄ] using this.dvd_coeff_zero
  have := (isIntegral_coeff_of_dvd _ _ hm‚ÇÅ'
    ((monic_X_pow _).sub_of_left (by simpa [‚Üê natDegree_lt_iff_degree_lt, hp0])) this i).neg
  obtain hi | hi := le_or_gt i p.natDegree
  ¬∑ simpa [show i ‚â† m by lia] using this
  ¬∑ simp [coeff_eq_zero_of_natDegree_lt hi, isIntegral_zero]
",Formal Proof of Stacks Project Tag 00H0,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Polynomial/IsIntegral.lean#L121-L156,Q27041,,10.37.7,lemma,3.0,"['037B', '00AO', '0ELQ']","\n  Lemma 10.37.7. Let $R$ be a domain with fraction field $K$. Suppose $f = \\sum \\alpha _ i x^ i$ is an element of $K[x]$. \n  \n  \nIf $f$ is integral over $R[x]$ then all $\\alpha _ i$ are integral over $R$, and \n\n\nIf $f$ is almost integral over $R[x]$ then all $\\alpha _ i$ are almost integral over $R$. \n\n\n\n\n    \n      Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4. Of course, then they are integral over $R$. \n      $\\square$\n    \n","\n  Lemma 10.37.7. Let $R$ be a domain with fraction field $K$. Suppose $f = \\sum \\alpha _ i x^ i$ is an element of $K[x]$. \n  \n  \nIf $f$ is integral over $R[x]$ then all $\\alpha _ i$ are integral over $R$, and \n\n\nIf $f$ is almost integral over $R[x]$ then all $\\alpha _ i$ are almost integral over $R$. \n\n\n\n\n    \n","Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4. Of course, then they are integral over $R$. \n      $\\square$\n    \n"," by
  nontriviality R
  nontriviality S
  obtain rfl | hp0 := eq_or_ne p 0; ¬∑ simp [isIntegral_zero]
  let q := minpoly R[X] p
  let m := (q.support.sup fun i ‚Ü¶ (q.coeff i).natDegree) + p.natDegree + 1
  have hm‚ÇÅ (i) : (q.coeff i).natDegree < m := by
    by_cases hi : i ‚àà q.support
    ¬∑ exact (Finset.le_sup (f := fun i ‚Ü¶ (q.coeff i).natDegree) hi).trans_lt (by lia)
    ¬∑ simp_all [m]
  have hm‚ÇÅ' : (q.eval (X ^ m)).Monic := by
    rw [eval_eq_sum_range, Finset.sum_range_succ]
    refine .add_of_right (by simp [q, minpoly.monic hp, ‚Üê pow_mul]) (degree_lt_degree ?_)
    refine lt_of_lt_of_eq (b := m * q.natDegree) ?_ (by simp [q, minpoly.monic hp, ‚Üê pow_mul])
    refine (natDegree_sum_le ..).trans_lt ((Finset.fold_max_lt _).mpr
      ‚ü®by simpa using ‚ü®by lia, minpoly.natDegree_pos hp‚ü©, fun i hi ‚Ü¶ ?_‚ü©)
    dsimp
    simp only [Finset.mem_range] at hi
    grw [‚Üê pow_mul, natDegree_mul_le, natDegree_X_pow, ‚Üê Nat.add_one_le_iff.mpr hi]
    have := hm‚ÇÅ i
    lia
  have hm‚ÇÇ : p.natDegree < m := by grind
  have h‚ÇÄ : algebraMap R[X] S[X] X = X := by simp
  have : (((taylor (X ^ m)) q).map (algebraMap R[X] S[X])).IsRoot (p - X ^ m) := by
    simpa [-algebraMap_def, q, h‚ÇÄ] using
      ((q.map (algebraMap _ _)).taylor_eval (X ^ m) (p - X ^ m) :)
  have : X ^ m - p ‚à£ (eval (X ^ m) q).map (algebraMap _ _) := by
    change X ^ m - p ‚à£ Algebra.ofId R[X] S[X] _
    rw [‚Üê coe_aeval_eq_eval, ‚Üê aeval_algHom_apply, ‚Üê neg_dvd, neg_sub]
    simpa [Polynomial.taylor_coeff_zero, -algebraMap_def, h‚ÇÄ] using this.dvd_coeff_zero
  have := (isIntegral_coeff_of_dvd _ _ hm‚ÇÅ'
    ((monic_X_pow _).sub_of_left (by simpa [‚Üê natDegree_lt_iff_degree_lt, hp0])) this i).neg
  obtain hi | hi := le_or_gt i p.natDegree
  ¬∑ simpa [show i ‚â† m by lia] using this
  ¬∑ simp [coeff_eq_zero_of_natDegree_lt hi, isIntegral_zero]
","protected lemma IsIntegral.coeff
    {p : S[X]} (hp : IsIntegral R[X] p) (i : ‚Ñï) : IsIntegral R (p.coeff i) ","Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3 [[\n  Lemma 10.31.3. Any finite type algebra over a field is Noetherian. Any finite type algebra over $\\mathbf{Z}$ is Noetherian. \n\n    \n]]. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]] the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]. Of course, then they are integral over $R$. \n      $\\square$\n    \n","Proof.\n      We first prove the second statement. Write $f = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _ r x^ r$ with $\\alpha _ r \\not= 0$. By assumption there exists $h = b_0 + b_1 x + \\ldots + b_ s x^ s \\in R[x]$, $b_ s \\not= 0$ such that $f^ n h \\in R[x]$ for all $n \\geq 0$. This implies that $b_ s \\alpha _ r^ n \\in R$ for all $n \\geq 0$. Hence $\\alpha _ r$ is almost integral over $R$. Since the set of almost integral elements form a subring (Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]) we deduce that $f - \\alpha _ r x^ r = \\alpha _0 + \\alpha _1 x + \\ldots + \\alpha _{r - 1} x^{r - 1}$ is almost integral over $R[x]$. By induction on $r$ we win. \n    \n      In order to prove the first statement we will use absolute Noetherian reduction. Namely, write $\\alpha _ i = a_ i / b_ i$ and let $P(t) = t^ d + \\sum _{j < d} f_ j t^ j$ be a polynomial with coefficients $f_ j \\in R[x]$ such that $P(f) = 0$. Let $f_ j = \\sum f_{ji}x^ i$. Consider the subring $R_0 \\subset R$ generated by the finite list of elements $a_ i, b_ i, f_{ji}$ of $R$. It is a domain; let $K_0$ be its field of fractions. Since $R_0$ is a finite type $\\mathbf{Z}$-algebra it is Noetherian, see Lemma 10.31.3 [[\n  Lemma 10.31.3. Any finite type algebra over a field is Noetherian. Any finite type algebra over $\\mathbf{Z}$ is Noetherian. \n\n    \n]]. It is still the case that $f \\in K_0[x]$ is integral over $R_0[x]$, because all the identities in $R$ among the elements $a_ i, b_ i, f_{ji}$ also hold in $R_0$. By Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]] the element $f$ is almost integral over $R_0[x]$. By the second statement of the lemma, the elements $\\alpha _ i$ are almost integral over $R_0$. And since $R_0$ is Noetherian, they are integral over $R_0$, see Lemma 10.37.4 [[\n  Lemma 10.37.4. Let $R$ be a domain with fraction field $K$. If $u, v \\in K$ are almost integral over $R$, then so are $u + v$ and $uv$. Any element $g \\in K$ which is integral over $R$ is almost integral over $R$. If $R$ is Noetherian then the converse holds as well. \n\n    \n]]. Of course, then they are integral over $R$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about almost integrality/integrality of coefficients of a polynomial over a domain and uses Noetherian reduction plus an induction on degree, relying on closure of almost integral elements under addition/multiplication. The Lean proof instead constructs the minpoly q of an element p, chooses a large exponent m, proves monicity of q.eval (X^m), derives a divisibility statement X^m ‚àí p ‚à£ (eval (X^m) q).map ..., and then applies an `isIntegral_coeff_of_dvd` lemma to conclude integrality of certain coefficients (with case splits on i ‚â§ p.natDegree). Structurally, the Lean argument is a technical polynomial/minpoly/taylor/divisibility computation with degree bounds, not an induction on degree nor a Noetherian reduction argument. It also does not mention almost integrality or Noetherian hypotheses. Thus both the main ideas and proof structure do not correspond, indicating essentially no alignment.""}"
321,030A,"instance {R : Type*} [CommRing R] [IsDomain R] [IsIntegrallyClosed R] :
    IsIntegrallyClosed R[X] := by
  let K := FractionRing R
  have : IsIntegrallyClosed K[X] := UniqueFactorizationMonoid.instIsIntegrallyClosed
  suffices IsIntegrallyClosedIn R[X] K[X] from .of_isIntegrallyClosed_of_isIntegrallyClosedIn _ K[X]
  refine isIntegrallyClosedIn_iff.mpr ‚ü®map_injective _ (IsFractionRing.injective _ _), ?_‚ü©
  refine fun {p} hp ‚Ü¶ (lifts_iff_coeff_lifts _).mpr fun n ‚Ü¶ ?_
  exact IsIntegrallyClosed.isIntegral_iff.mp (hp.coeff _)
",Formal Proof of Stacks Project Tag 030A,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Polynomial/IsIntegral.lean#L180-L187,Q27041,,10.37.8,lemma,3.0,"['037B', '00AO', '0ELQ']",\n  Lemma 10.37.8. Let $R$ be a normal domain. Then $R[x]$ is a normal domain. \n\n    \n      Proof.\n      The result is true if $R$ is a field $K$ because $K[x]$ is a euclidean domain and hence a principal ideal domain and hence normal by Lemma 10.37.6. Let $g$ be an element of the fraction field of $R[x]$ which is integral over $R[x]$. Because $g$ is integral over $K[x]$ where $K$ is the fraction field of $R$ we may write $g = \\alpha _ d x^ d + \\alpha _{d-1}x^{d-1} + \\ldots + \\alpha _0$ with $\\alpha _ i \\in K$. By Lemma 10.37.7 the elements $\\alpha _ i$ are integral over $R$ and hence are in $R$. \n      $\\square$\n    \n,\n  Lemma 10.37.8. Let $R$ be a normal domain. Then $R[x]$ is a normal domain. \n\n    \n,Proof.\n      The result is true if $R$ is a field $K$ because $K[x]$ is a euclidean domain and hence a principal ideal domain and hence normal by Lemma 10.37.6. Let $g$ be an element of the fraction field of $R[x]$ which is integral over $R[x]$. Because $g$ is integral over $K[x]$ where $K$ is the fraction field of $R$ we may write $g = \\alpha _ d x^ d + \\alpha _{d-1}x^{d-1} + \\ldots + \\alpha _0$ with $\\alpha _ i \\in K$. By Lemma 10.37.7 the elements $\\alpha _ i$ are integral over $R$ and hence are in $R$. \n      $\\square$\n    \n," by
  let K := FractionRing R
  have : IsIntegrallyClosed K[X] := UniqueFactorizationMonoid.instIsIntegrallyClosed
  suffices IsIntegrallyClosedIn R[X] K[X] from .of_isIntegrallyClosed_of_isIntegrallyClosedIn _ K[X]
  refine isIntegrallyClosedIn_iff.mpr ‚ü®map_injective _ (IsFractionRing.injective _ _), ?_‚ü©
  refine fun {p} hp ‚Ü¶ (lifts_iff_coeff_lifts _).mpr fun n ‚Ü¶ ?_
  exact IsIntegrallyClosed.isIntegral_iff.mp (hp.coeff _)
","instance {R : Type*} [CommRing R] [IsDomain R] [IsIntegrallyClosed R] :
    IsIntegrallyClosed R[X] ","Proof.\n      The result is true if $R$ is a field $K$ because $K[x]$ is a euclidean domain and hence a principal ideal domain and hence normal by Lemma 10.37.6 [[\n  Lemma 10.37.6. A principal ideal domain is normal. \n\n    \n]]. Let $g$ be an element of the fraction field of $R[x]$ which is integral over $R[x]$. Because $g$ is integral over $K[x]$ where $K$ is the fraction field of $R$ we may write $g = \\alpha _ d x^ d + \\alpha _{d-1}x^{d-1} + \\ldots + \\alpha _0$ with $\\alpha _ i \\in K$. By Lemma 10.37.7 [[\n  Lemma 10.37.7. Let $R$ be a domain with fraction field $K$. Suppose $f = \\sum \\alpha _ i x^ i$ is an element of $K[x]$. \n  \n  \nIf $f$ is integral over $R[x]$ then all $\\alpha _ i$ are integral over $R$, and \n\n\nIf $f$ is almost integral over $R[x]$ then all $\\alpha _ i$ are almost integral over $R$. \n\n\n\n\n    \n]] the elements $\\alpha _ i$ are integral over $R$ and hence are in $R$. \n      $\\square$\n    \n","Proof.\n      The result is true if $R$ is a field $K$ because $K[x]$ is a euclidean domain and hence a principal ideal domain and hence normal by Lemma 10.37.6 [[\n  Lemma 10.37.6. A principal ideal domain is normal. \n\n    \n]]. Let $g$ be an element of the fraction field of $R[x]$ which is integral over $R[x]$. Because $g$ is integral over $K[x]$ where $K$ is the fraction field of $R$ we may write $g = \\alpha _ d x^ d + \\alpha _{d-1}x^{d-1} + \\ldots + \\alpha _0$ with $\\alpha _ i \\in K$. By Lemma 10.37.7 [[\n  Lemma 10.37.7. Let $R$ be a domain with fraction field $K$. Suppose $f = \\sum \\alpha _ i x^ i$ is an element of $K[x]$. \n  \n  \nIf $f$ is integral over $R[x]$ then all $\\alpha _ i$ are integral over $R$, and \n\n\nIf $f$ is almost integral over $R[x]$ then all $\\alpha _ i$ are almost integral over $R$. \n\n\n\n\n    \n]] the elements $\\alpha _ i$ are integral over $R$ and hence are in $R$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish integrally closedness of R[X] by passing to the fraction field K = Frac(R) and using that K[X] is integrally closed, then reducing integrality over R[X] to integrality of coefficients over R. The Lean proof sets K := FractionRing R, uses that K[X] is integrally closed via the UFD instance, and then proves IsIntegrallyClosedIn R[X] K[X] by showing coefficientwise lifting: from hp : p integral over R[X], it concludes each coeff is integral (hp.coeff _) and applies IsIntegrallyClosed.isIntegral_iff to place coefficients back in R. Structurally, this matches the informal argument‚Äôs key step (Lemma 10.37.7: integrality over R[x] implies coefficients integral over R). The main mismatch is that the informal proof explicitly argues K[x] is a PID/Euclidean hence normal, while the Lean proof instead uses the stronger library fact that K[X] is integrally closed because it is a UFD; also the informal proof discusses an element of Frac(R[x]) and writes it as a polynomial in K[x], whereas the Lean proof works directly with the integrally-closed-in formulation and a lifting lemma. These are different routes but lead to the same mathematical content.""}"
322,09H0,"theorem _root_.Irreducible.hasSeparableContraction (q : ‚Ñï) [hF : ExpChar F q] {f : F[X]}
    (irred : Irreducible f) : HasSeparableContraction q f := by
  cases hF
  ¬∑ exact ‚ü®f, irred.separable, ‚ü®0, by rw [pow_zero, expand_one]‚ü©‚ü©
  ¬∑ rcases exists_separable_of_irreducible q irred ‚Äπq.Prime‚Ä∫.ne_zero with ‚ü®n, g, hgs, hge‚ü©
    exact ‚ü®g, hgs, n, hge‚ü©
",Formal Proof of Stacks Project Tag 09H0,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Polynomial/SeparableDegree.lean#L103-L108,Q27041,,9.12.1,lemma,3.0,"['09GZ', '09FA', '0ELQ']","\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n      Proof.\n      Note that $P\'$ has degree $< \\deg (P)$. Hence if $P$ and $P\'$ are not relatively prime, then $(P, P\') = (R)$ where $R$ is a polynomial of degree $< \\deg (P)$ contradicting the irreducibility of $P$. This proves we have the dichotomy between (1) and (2). \n    \n      Assume we are in case (2) and $P = a_ d x^ d + \\ldots + a_0$. Then $P\' = da_ d x^{d - 1} + \\ldots + a_1$. In characteristic $0$ we see that this forces $a_ d, \\ldots , a_1 = 0$ which would mean $P$ is constant a contradiction. Thus we conclude that the characteristic $p$ is positive. In this case the condition $P\' = 0$ forces $a_ i = 0$ whenever $p$ does not divide $i$. In other words, $P(x) = P_1(x^ p)$ for some nonconstant polynomial $P_1$. Clearly, $P_1$ is irreducible as well. By induction on the degree we see that $P_1(x) = Q(x^ q)$ as in the statement of the lemma, hence $P(x) = Q(x^{pq})$ and the lemma is proved. \n      $\\square$\n    \n","\n  Lemma 9.12.1. Let $F$ be a field. Let $P \\in F[x]$ be an irreducible polynomial over $F$. Let $P\' = \\text{d}P/\\text{d}x$ be the derivative of $P$ with respect to $x$. Then one of the following two cases happens \n  \n  \n$P$ and $P\'$ are relatively prime, or \n\n\n$P\'$ is the zero polynomial. \n\n\n\n   The second case can only happen if $F$ has characteristic $p > 0$. In this case $P(x) = Q(x^ q)$ where $q = p^ f$ is a power of $p$ and $Q \\in F[x]$ is an irreducible polynomial such that $Q$ and $Q\'$ are relatively prime. \n\n    \n","Proof.\n      Note that $P\'$ has degree $< \\deg (P)$. Hence if $P$ and $P\'$ are not relatively prime, then $(P, P\') = (R)$ where $R$ is a polynomial of degree $< \\deg (P)$ contradicting the irreducibility of $P$. This proves we have the dichotomy between (1) and (2). \n    \n      Assume we are in case (2) and $P = a_ d x^ d + \\ldots + a_0$. Then $P\' = da_ d x^{d - 1} + \\ldots + a_1$. In characteristic $0$ we see that this forces $a_ d, \\ldots , a_1 = 0$ which would mean $P$ is constant a contradiction. Thus we conclude that the characteristic $p$ is positive. In this case the condition $P\' = 0$ forces $a_ i = 0$ whenever $p$ does not divide $i$. In other words, $P(x) = P_1(x^ p)$ for some nonconstant polynomial $P_1$. Clearly, $P_1$ is irreducible as well. By induction on the degree we see that $P_1(x) = Q(x^ q)$ as in the statement of the lemma, hence $P(x) = Q(x^{pq})$ and the lemma is proved. \n      $\\square$\n    \n"," by
  cases hF
  ¬∑ exact ‚ü®f, irred.separable, ‚ü®0, by rw [pow_zero, expand_one]‚ü©‚ü©
  ¬∑ rcases exists_separable_of_irreducible q irred ‚Äπq.Prime‚Ä∫.ne_zero with ‚ü®n, g, hgs, hge‚ü©
    exact ‚ü®g, hgs, n, hge‚ü©
","theorem _root_.Irreducible.hasSeparableContraction (q : ‚Ñï) [hF : ExpChar F q] {f : F[X]}
    (irred : Irreducible f) : HasSeparableContraction q f ","Proof.\n      Note that $P\'$ has degree $< \\deg (P)$. Hence if $P$ and $P\'$ are not relatively prime, then $(P, P\') = (R)$ where $R$ is a polynomial of degree $< \\deg (P)$ contradicting the irreducibility of $P$. This proves we have the dichotomy between (1) and (2). \n    \n      Assume we are in case (2) and $P = a_ d x^ d + \\ldots + a_0$. Then $P\' = da_ d x^{d - 1} + \\ldots + a_1$. In characteristic $0$ we see that this forces $a_ d, \\ldots , a_1 = 0$ which would mean $P$ is constant a contradiction. Thus we conclude that the characteristic $p$ is positive. In this case the condition $P\' = 0$ forces $a_ i = 0$ whenever $p$ does not divide $i$. In other words, $P(x) = P_1(x^ p)$ for some nonconstant polynomial $P_1$. Clearly, $P_1$ is irreducible as well. By induction on the degree we see that $P_1(x) = Q(x^ q)$ as in the statement of the lemma, hence $P(x) = Q(x^{pq})$ and the lemma is proved. \n      $\\square$\n    \n","Proof.\n      Note that $P\'$ has degree $< \\deg (P)$. Hence if $P$ and $P\'$ are not relatively prime, then $(P, P\') = (R)$ where $R$ is a polynomial of degree $< \\deg (P)$ contradicting the irreducibility of $P$. This proves we have the dichotomy between (1) and (2). \n    \n      Assume we are in case (2) and $P = a_ d x^ d + \\ldots + a_0$. Then $P\' = da_ d x^{d - 1} + \\ldots + a_1$. In characteristic $0$ we see that this forces $a_ d, \\ldots , a_1 = 0$ which would mean $P$ is constant a contradiction. Thus we conclude that the characteristic $p$ is positive. In this case the condition $P\' = 0$ forces $a_ i = 0$ whenever $p$ does not divide $i$. In other words, $P(x) = P_1(x^ p)$ for some nonconstant polynomial $P_1$. Clearly, $P_1$ is irreducible as well. By induction on the degree we see that $P_1(x) = Q(x^ q)$ as in the statement of the lemma, hence $P(x) = Q(x^{pq})$ and the lemma is proved. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs establish a dichotomy for an irreducible polynomial: in one case it is separable, and in the other case one produces a separable polynomial after extracting a Frobenius/power structure (the formal proof returns ‚ü®n, g, hgs, hge‚ü© from an existence lemma, matching the informal conclusion that P(x)=Q(x^{p^k})-type and reduces to a separable factor). However, the informal proof‚Äôs core argument is via gcd(P,P‚Ä≤), degree considerations, and a characteristic-0 vs characteristic-p analysis leading to an explicit inductive construction P(x)=P1(x^p) and iteration. The formal proof instead does a case split on hF and, in the nontrivial case, directly invokes an existing lemma `exists_separable_of_irreducible` to obtain the needed g and exponent n, without reproducing the derivative/gcd/characteristic/induction structure. Thus the end result aligns, but the internal structure and completeness relative to the informal reasoning are only partial.""}"
323,00UH,"lemma _root_.Algebra.exists_etale_bijective_residueFieldMap_and_map_eq_mul_and_isCoprime.{u}
    {R : Type u} [CommRing R]
    (P : Ideal R) [P.IsPrime] (p : R[X])
    (f g : P.ResidueField[X]) (hp : p.Monic) (hf : f.Monic) (hg : g.Monic)
    (H : p.map (algebraMap R _) = f * g) (Hpq : IsCoprime f g) :
    ‚àÉ (R' : Type u) (_ : CommRing R') (_ : Algebra R R') (_ : Algebra.Etale R R')
      (Q : Ideal R') (_ : Q.IsPrime) (_ : Q.LiesOver P) (f' g' : R'[X]),
    Function.Bijective (Ideal.ResidueField.map‚Çê P Q (Algebra.ofId _ _) (Ideal.over_def Q P)) ‚àß
    f'.Monic ‚àß g'.Monic ‚àß p.map (algebraMap R R') = f' * g' ‚àß IsCoprime f' g' ‚àß
    f.map (Ideal.ResidueField.map‚Çê P Q (Algebra.ofId _ _) (Ideal.over_def Q P)).toRingHom =
      f'.map (algebraMap _ _) ‚àß
    g.map (Ideal.ResidueField.map‚Çê P Q (Algebra.ofId _ _) (Ideal.over_def Q P)).toRingHom =
      g'.map (algebraMap _ _) := by
  obtain ‚ü®Q, _, _, h‚ÇÅ, h‚ÇÇ, h‚ÇÉ‚ü© :=
    exists_liesOver_residueFieldMap_bijective f.natDegree g.natDegree
    (by simpa [hf.natDegree_mul hg, hp.natDegree_map] using congr(($H).natDegree)) (.mk p hp rfl)
    P (.mk f hf rfl) (.mk g hg rfl) H Hpq
  exact ‚ü®_, _, _, inferInstance, Q, ‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫, (factor‚ÇÅ ..).1, (factor‚ÇÇ ..).1, h‚ÇÅ,
    (factor‚ÇÅ ..).monic, (factor‚ÇÇ ..).monic, (factor‚ÇÅ_mul_factor‚ÇÇ ..).symm,
    isCoprime_factor‚ÇÅ_factor‚ÇÇ .., congr(($h‚ÇÇ).1), congr(($h‚ÇÉ).1)‚ü©
",Formal Proof of Stacks Project Tag 00UH,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Polynomial/UniversalFactorizationRing.lean#L682-L701,Q27041,,10.143.13,lemma,3.0,"['00U0', '00AO', '0ELQ']","\n  Lemma 10.143.13. Let $R$ be a ring. Let $f \\in R[x]$ be a monic polynomial. Let $\\mathfrak p$ be a prime of $R$. Let $f \\bmod \\mathfrak p = \\overline{g} \\overline{h}$ be a factorization of the image of $f$ in $\\kappa (\\mathfrak p)[x]$. If $\\gcd (\\overline{g}, \\overline{h}) = 1$, then there exist \n  \n  \nan \xc3\xa9tale ring map $R \\to R\'$, \n\n\na prime $\\mathfrak p\' \\subset R\'$ lying over $\\mathfrak p$, and \n\n\na factorization $f = g h$ in $R\'[x]$ \n\n\n\n   such that \n  \n  \n$\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, \n\n\n$\\overline{g} = g \\bmod \\mathfrak p\'$, $\\overline{h} = h \\bmod \\mathfrak p\'$, and \n\n\nthe polynomials $g, h$ generate the unit ideal in $R\'[x]$. \n\n\n\n\n    \n      Proof.\n      Suppose $\\overline{g} = \\overline{b}_0 x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = \\overline{c}_0 x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$ with $\\overline{b}_0, \\overline{c}_0 \\in \\kappa (\\mathfrak p)$ nonzero. After localizing $R$ at some element of $R$ not contained in $\\mathfrak p$ we may assume $\\overline{b}_0$ is the image of an invertible element $b_0 \\in R$. Replacing $\\overline{g}$ by $\\overline{g}/b_0$ and $\\overline{h}$ by $b_0\\overline{h}$ we reduce to the case where $\\overline{g}$, $\\overline{h}$ are monic (verification omitted). Say $\\overline{g} = x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$. Write $f = x^{n + m} + a_1 x^{n + m - 1} + \\ldots + a_{n + m}$. Consider the fibre product \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m]  \\]\n\n    \n       where the map $\\mathbf{Z}[a_ k] \\to \\mathbf{Z}[b_ i, c_ j]$ is as in Examples 10.136.7 and 10.143.12. By construction there is an $R$-algebra map \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\longrightarrow \\kappa (\\mathfrak p)  \\]\n\n    \n       which maps $b_ i$ to $\\overline{b}_ i$ and $c_ j$ to $\\overline{c}_ j$. Denote $\\mathfrak p\' \\subset R\'$ the kernel of this map. Since by assumption the polynomials $\\overline{g}, \\overline{h}$ are relatively prime we see that the element $\\Delta = \\text{Res}_ x(g, h) \\in \\mathbf{Z}[b_ i, c_ j]$ (see Example 10.143.12) does not map to zero in $\\kappa (\\mathfrak p)$ under the displayed map. We conclude that $R \\to R\'$ is \xc3\xa9tale at $\\mathfrak p\'$. In fact a solution to the problem posed in the lemma is the ring map $R \\to R\'[1/\\Delta ]$ and the prime $\\mathfrak p\' R\'[1/\\Delta ]$. Because $\\text{Res}_ x(f, g)$ is invertible in this ring the Sylvester matrix is invertible over $R\'[1/\\Delta ]$ and hence $1 = a g + b h$ for some $a, b \\in R\'[1/\\Delta ][x]$ see Example 10.143.12. \n      $\\square$\n    \n","\n  Lemma 10.143.13. Let $R$ be a ring. Let $f \\in R[x]$ be a monic polynomial. Let $\\mathfrak p$ be a prime of $R$. Let $f \\bmod \\mathfrak p = \\overline{g} \\overline{h}$ be a factorization of the image of $f$ in $\\kappa (\\mathfrak p)[x]$. If $\\gcd (\\overline{g}, \\overline{h}) = 1$, then there exist \n  \n  \nan \xc3\xa9tale ring map $R \\to R\'$, \n\n\na prime $\\mathfrak p\' \\subset R\'$ lying over $\\mathfrak p$, and \n\n\na factorization $f = g h$ in $R\'[x]$ \n\n\n\n   such that \n  \n  \n$\\kappa (\\mathfrak p) = \\kappa (\\mathfrak p\')$, \n\n\n$\\overline{g} = g \\bmod \\mathfrak p\'$, $\\overline{h} = h \\bmod \\mathfrak p\'$, and \n\n\nthe polynomials $g, h$ generate the unit ideal in $R\'[x]$. \n\n\n\n\n    \n","Proof.\n      Suppose $\\overline{g} = \\overline{b}_0 x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = \\overline{c}_0 x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$ with $\\overline{b}_0, \\overline{c}_0 \\in \\kappa (\\mathfrak p)$ nonzero. After localizing $R$ at some element of $R$ not contained in $\\mathfrak p$ we may assume $\\overline{b}_0$ is the image of an invertible element $b_0 \\in R$. Replacing $\\overline{g}$ by $\\overline{g}/b_0$ and $\\overline{h}$ by $b_0\\overline{h}$ we reduce to the case where $\\overline{g}$, $\\overline{h}$ are monic (verification omitted). Say $\\overline{g} = x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$. Write $f = x^{n + m} + a_1 x^{n + m - 1} + \\ldots + a_{n + m}$. Consider the fibre product \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m]  \\]\n\n    \n       where the map $\\mathbf{Z}[a_ k] \\to \\mathbf{Z}[b_ i, c_ j]$ is as in Examples 10.136.7 and 10.143.12. By construction there is an $R$-algebra map \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\longrightarrow \\kappa (\\mathfrak p)  \\]\n\n    \n       which maps $b_ i$ to $\\overline{b}_ i$ and $c_ j$ to $\\overline{c}_ j$. Denote $\\mathfrak p\' \\subset R\'$ the kernel of this map. Since by assumption the polynomials $\\overline{g}, \\overline{h}$ are relatively prime we see that the element $\\Delta = \\text{Res}_ x(g, h) \\in \\mathbf{Z}[b_ i, c_ j]$ (see Example 10.143.12) does not map to zero in $\\kappa (\\mathfrak p)$ under the displayed map. We conclude that $R \\to R\'$ is \xc3\xa9tale at $\\mathfrak p\'$. In fact a solution to the problem posed in the lemma is the ring map $R \\to R\'[1/\\Delta ]$ and the prime $\\mathfrak p\' R\'[1/\\Delta ]$. Because $\\text{Res}_ x(f, g)$ is invertible in this ring the Sylvester matrix is invertible over $R\'[1/\\Delta ]$ and hence $1 = a g + b h$ for some $a, b \\in R\'[1/\\Delta ][x]$ see Example 10.143.12. \n      $\\square$\n    \n"," by
  obtain ‚ü®Q, _, _, h‚ÇÅ, h‚ÇÇ, h‚ÇÉ‚ü© :=
    exists_liesOver_residueFieldMap_bijective f.natDegree g.natDegree
    (by simpa [hf.natDegree_mul hg, hp.natDegree_map] using congr(($H).natDegree)) (.mk p hp rfl)
    P (.mk f hf rfl) (.mk g hg rfl) H Hpq
  exact ‚ü®_, _, _, inferInstance, Q, ‚Äπ_‚Ä∫, ‚Äπ_‚Ä∫, (factor‚ÇÅ ..).1, (factor‚ÇÇ ..).1, h‚ÇÅ,
    (factor‚ÇÅ ..).monic, (factor‚ÇÇ ..).monic, (factor‚ÇÅ_mul_factor‚ÇÇ ..).symm,
    isCoprime_factor‚ÇÅ_factor‚ÇÇ .., congr(($h‚ÇÇ).1), congr(($h‚ÇÉ).1)‚ü©
","lemma _root_.Algebra.exists_etale_bijective_residueFieldMap_and_map_eq_mul_and_isCoprime.{u}
    {R : Type u} [CommRing R]
    (P : Ideal R) [P.IsPrime] (p : R[X])
    (f g : P.ResidueField[X]) (hp : p.Monic) (hf : f.Monic) (hg : g.Monic)
    (H : p.map (algebraMap R _) = f * g) (Hpq : IsCoprime f g) :
    ‚àÉ (R' : Type u) (_ : CommRing R') (_ : Algebra R R') (_ : Algebra.Etale R R')
      (Q : Ideal R') (_ : Q.IsPrime) (_ : Q.LiesOver P) (f' g' : R'[X]),
    Function.Bijective (Ideal.ResidueField.map‚Çê P Q (Algebra.ofId _ _) (Ideal.over_def Q P)) ‚àß
    f'.Monic ‚àß g'.Monic ‚àß p.map (algebraMap R R') = f' * g' ‚àß IsCoprime f' g' ‚àß
    f.map (Ideal.ResidueField.map‚Çê P Q (Algebra.ofId _ _) (Ideal.over_def Q P)).toRingHom =
      f'.map (algebraMap _ _) ‚àß
    g.map (Ideal.ResidueField.map‚Çê P Q (Algebra.ofId _ _) (Ideal.over_def Q P)).toRingHom =
      g'.map (algebraMap _ _) ","Proof.\n      Suppose $\\overline{g} = \\overline{b}_0 x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = \\overline{c}_0 x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$ with $\\overline{b}_0, \\overline{c}_0 \\in \\kappa (\\mathfrak p)$ nonzero. After localizing $R$ at some element of $R$ not contained in $\\mathfrak p$ we may assume $\\overline{b}_0$ is the image of an invertible element $b_0 \\in R$. Replacing $\\overline{g}$ by $\\overline{g}/b_0$ and $\\overline{h}$ by $b_0\\overline{h}$ we reduce to the case where $\\overline{g}$, $\\overline{h}$ are monic (verification omitted). Say $\\overline{g} = x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$. Write $f = x^{n + m} + a_1 x^{n + m - 1} + \\ldots + a_{n + m}$. Consider the fibre product \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m]  \\]\n\n    \n       where the map $\\mathbf{Z}[a_ k] \\to \\mathbf{Z}[b_ i, c_ j]$ is as in Examples 10.136.7 [[\n  Example 10.136.7. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   In other words, this is the unique ring map of polynomial rings as indicated such that the polynomial factorization \n  \n  \\[  x^{n + m} + a_1 x^{n + m - 1} + \\ldots + a_{n + m} = (x^ n + b_1 x^{n - 1} + \\ldots + b_ n) (x^ m + c_1 x^{m - 1} + \\ldots + c_ m)  \\]\n\n   holds. Note that $S$ is generated by $n + m$ elements over $R$ (namely, $b_ i, c_ j$) and that there are $n + m$ equations (namely $a_ k = a_ k(b_ i, c_ j)$). In order to show that $S$ is a relative global complete intersection over $R$ it suffices to prove that all fibres have dimension $0$. \n  To prove this, let $R \\to k$ be a ring map into a field $k$. Say $a_ i$ maps to $\\alpha _ i \\in k$. Consider the fibre ring $S_ k = k \\otimes _ R S$. Let $k \\to K$ be a field extension. A $k$-algebra map of $S_ k \\to K$ is the same thing as finding $\\beta _1, \\ldots , \\beta _ n, \\gamma _1, \\ldots , \\gamma _ m \\in K$ such that \n  \n  \\[  x^{n + m} + \\alpha _1 x^{n + m - 1} + \\ldots + \\alpha _{n + m} = (x^ n + \\beta _1 x^{n - 1} + \\ldots + \\beta _ n) (x^ m + \\gamma _1 x^{m - 1} + \\ldots + \\gamma _ m).  \\]\n\n   Hence we see there are at most finitely many choices of such $n + m$-tuples in $K$. This proves that all fibres have finitely many closed points (use Hilbert\'s Nullstellensatz to see they all correspond to solutions in $\\overline{k}$ for example) and hence that $R \\to S$ is a relative global complete intersection. \n  Another way to argue this is to show $\\mathbf{Z}[a_1, \\ldots , a_{n + m}] \\to \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m]$ is actually also a finite ring map. Namely, by Lemma 10.38.5 each of $b_ i, c_ j$ is integral over $R$, and hence $R \\to S$ is finite by Lemma 10.36.4. \n]] and 10.143.12 [[\n  Example 10.143.12. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   of Example 10.136.7. Write symbolically \n  \n  \\[  S = R[b_1, \\ldots , c_ m]/(\\{ a_ k(b_ i, c_ j) - a_ k\\} _{k = 1, \\ldots , n + m})  \\]\n\n   where for example $a_1(b_ i, c_ j) = b_1 + c_1$. The matrix of partial derivatives is \n  \n  \\[  \\left( \\begin{matrix}  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  c_1 \n\n&  c_2 \n\n&  \\ldots \n\n&  c_ m \n\n\\\\  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_ n \n\n\\end{matrix} \\right)  \\]\n\n   The determinant $\\Delta $ of this matrix is better known as the resultant of the polynomials $g = x^ n + b_1 x^{n - 1} + \\ldots + b_ n$ and $h = x^ m + c_1 x^{m - 1} + \\ldots + c_ m$, and the matrix above is known as the Sylvester matrix associated to $g, h$. In a formula $\\Delta = \\text{Res}_ x(g, h)$. The Sylvester matrix is the transpose of the matrix of the linear map \n  \n  \\begin{eqnarray*}  S[x]_{< m} \\oplus S[x]_{< n} &  \\longrightarrow &  S[x]_{< n + m} \\\\  a \\oplus b &  \\longmapsto &  ag + bh \\end{eqnarray*}\n\n   Let $\\mathfrak q \\subset S$ be any prime. By the above the following are equivalent: \n  \n  \n$R \\to S$ is \xc3\xa9tale at $\\mathfrak q$, \n\n\n$\\Delta = \\text{Res}_ x(g, h) \\not\\in \\mathfrak q$, \n\n\nthe images $\\overline{g}, \\overline{h} \\in \\kappa (\\mathfrak q)[x]$ of the polynomials $g, h$ are relatively prime in $\\kappa (\\mathfrak q)[x]$. \n\n\n\n   The equivalence of (2) and (3) holds because the image of the Sylvester matrix in $\\text{Mat}(n + m, \\kappa (\\mathfrak q))$ has a kernel if and only if the polynomials $\\overline{g}, \\overline{h}$ have a factor in common. We conclude that the ring map \n  \n  \\[  R \\longrightarrow S[\\frac{1}{\\Delta }] = S[\\frac{1}{\\text{Res}_ x(g, h)}]  \\]\n\n   is \xc3\xa9tale. \n]]. By construction there is an $R$-algebra map \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\longrightarrow \\kappa (\\mathfrak p)  \\]\n\n    \n       which maps $b_ i$ to $\\overline{b}_ i$ and $c_ j$ to $\\overline{c}_ j$. Denote $\\mathfrak p\' \\subset R\'$ the kernel of this map. Since by assumption the polynomials $\\overline{g}, \\overline{h}$ are relatively prime we see that the element $\\Delta = \\text{Res}_ x(g, h) \\in \\mathbf{Z}[b_ i, c_ j]$ (see Example 10.143.12 [[\n  Example 10.143.12. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   of Example 10.136.7. Write symbolically \n  \n  \\[  S = R[b_1, \\ldots , c_ m]/(\\{ a_ k(b_ i, c_ j) - a_ k\\} _{k = 1, \\ldots , n + m})  \\]\n\n   where for example $a_1(b_ i, c_ j) = b_1 + c_1$. The matrix of partial derivatives is \n  \n  \\[  \\left( \\begin{matrix}  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  c_1 \n\n&  c_2 \n\n&  \\ldots \n\n&  c_ m \n\n\\\\  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_ n \n\n\\end{matrix} \\right)  \\]\n\n   The determinant $\\Delta $ of this matrix is better known as the resultant of the polynomials $g = x^ n + b_1 x^{n - 1} + \\ldots + b_ n$ and $h = x^ m + c_1 x^{m - 1} + \\ldots + c_ m$, and the matrix above is known as the Sylvester matrix associated to $g, h$. In a formula $\\Delta = \\text{Res}_ x(g, h)$. The Sylvester matrix is the transpose of the matrix of the linear map \n  \n  \\begin{eqnarray*}  S[x]_{< m} \\oplus S[x]_{< n} &  \\longrightarrow &  S[x]_{< n + m} \\\\  a \\oplus b &  \\longmapsto &  ag + bh \\end{eqnarray*}\n\n   Let $\\mathfrak q \\subset S$ be any prime. By the above the following are equivalent: \n  \n  \n$R \\to S$ is \xc3\xa9tale at $\\mathfrak q$, \n\n\n$\\Delta = \\text{Res}_ x(g, h) \\not\\in \\mathfrak q$, \n\n\nthe images $\\overline{g}, \\overline{h} \\in \\kappa (\\mathfrak q)[x]$ of the polynomials $g, h$ are relatively prime in $\\kappa (\\mathfrak q)[x]$. \n\n\n\n   The equivalence of (2) and (3) holds because the image of the Sylvester matrix in $\\text{Mat}(n + m, \\kappa (\\mathfrak q))$ has a kernel if and only if the polynomials $\\overline{g}, \\overline{h}$ have a factor in common. We conclude that the ring map \n  \n  \\[  R \\longrightarrow S[\\frac{1}{\\Delta }] = S[\\frac{1}{\\text{Res}_ x(g, h)}]  \\]\n\n   is \xc3\xa9tale. \n]]) does not map to zero in $\\kappa (\\mathfrak p)$ under the displayed map. We conclude that $R \\to R\'$ is \xc3\xa9tale at $\\mathfrak p\'$. In fact a solution to the problem posed in the lemma is the ring map $R \\to R\'[1/\\Delta ]$ and the prime $\\mathfrak p\' R\'[1/\\Delta ]$. Because $\\text{Res}_ x(f, g)$ is invertible in this ring the Sylvester matrix is invertible over $R\'[1/\\Delta ]$ and hence $1 = a g + b h$ for some $a, b \\in R\'[1/\\Delta ][x]$ see Example 10.143.12 [[\n  Example 10.143.12. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   of Example 10.136.7. Write symbolically \n  \n  \\[  S = R[b_1, \\ldots , c_ m]/(\\{ a_ k(b_ i, c_ j) - a_ k\\} _{k = 1, \\ldots , n + m})  \\]\n\n   where for example $a_1(b_ i, c_ j) = b_1 + c_1$. The matrix of partial derivatives is \n  \n  \\[  \\left( \\begin{matrix}  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  c_1 \n\n&  c_2 \n\n&  \\ldots \n\n&  c_ m \n\n\\\\  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_ n \n\n\\end{matrix} \\right)  \\]\n\n   The determinant $\\Delta $ of this matrix is better known as the resultant of the polynomials $g = x^ n + b_1 x^{n - 1} + \\ldots + b_ n$ and $h = x^ m + c_1 x^{m - 1} + \\ldots + c_ m$, and the matrix above is known as the Sylvester matrix associated to $g, h$. In a formula $\\Delta = \\text{Res}_ x(g, h)$. The Sylvester matrix is the transpose of the matrix of the linear map \n  \n  \\begin{eqnarray*}  S[x]_{< m} \\oplus S[x]_{< n} &  \\longrightarrow &  S[x]_{< n + m} \\\\  a \\oplus b &  \\longmapsto &  ag + bh \\end{eqnarray*}\n\n   Let $\\mathfrak q \\subset S$ be any prime. By the above the following are equivalent: \n  \n  \n$R \\to S$ is \xc3\xa9tale at $\\mathfrak q$, \n\n\n$\\Delta = \\text{Res}_ x(g, h) \\not\\in \\mathfrak q$, \n\n\nthe images $\\overline{g}, \\overline{h} \\in \\kappa (\\mathfrak q)[x]$ of the polynomials $g, h$ are relatively prime in $\\kappa (\\mathfrak q)[x]$. \n\n\n\n   The equivalence of (2) and (3) holds because the image of the Sylvester matrix in $\\text{Mat}(n + m, \\kappa (\\mathfrak q))$ has a kernel if and only if the polynomials $\\overline{g}, \\overline{h}$ have a factor in common. We conclude that the ring map \n  \n  \\[  R \\longrightarrow S[\\frac{1}{\\Delta }] = S[\\frac{1}{\\text{Res}_ x(g, h)}]  \\]\n\n   is \xc3\xa9tale. \n]]. \n      $\\square$\n    \n","Proof.\n      Suppose $\\overline{g} = \\overline{b}_0 x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = \\overline{c}_0 x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$ with $\\overline{b}_0, \\overline{c}_0 \\in \\kappa (\\mathfrak p)$ nonzero. After localizing $R$ at some element of $R$ not contained in $\\mathfrak p$ we may assume $\\overline{b}_0$ is the image of an invertible element $b_0 \\in R$. Replacing $\\overline{g}$ by $\\overline{g}/b_0$ and $\\overline{h}$ by $b_0\\overline{h}$ we reduce to the case where $\\overline{g}$, $\\overline{h}$ are monic (verification omitted). Say $\\overline{g} = x^ n + \\overline{b}_1 x^{n - 1} + \\ldots + \\overline{b}_ n$, and $\\overline{h} = x^ m + \\overline{c}_1 x^{m - 1} + \\ldots + \\overline{c}_ m$. Write $f = x^{n + m} + a_1 x^{n + m - 1} + \\ldots + a_{n + m}$. Consider the fibre product \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m]  \\]\n\n    \n       where the map $\\mathbf{Z}[a_ k] \\to \\mathbf{Z}[b_ i, c_ j]$ is as in Examples 10.136.7 [[\n  Example 10.136.7. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   In other words, this is the unique ring map of polynomial rings as indicated such that the polynomial factorization \n  \n  \\[  x^{n + m} + a_1 x^{n + m - 1} + \\ldots + a_{n + m} = (x^ n + b_1 x^{n - 1} + \\ldots + b_ n) (x^ m + c_1 x^{m - 1} + \\ldots + c_ m)  \\]\n\n   holds. Note that $S$ is generated by $n + m$ elements over $R$ (namely, $b_ i, c_ j$) and that there are $n + m$ equations (namely $a_ k = a_ k(b_ i, c_ j)$). In order to show that $S$ is a relative global complete intersection over $R$ it suffices to prove that all fibres have dimension $0$. \n  To prove this, let $R \\to k$ be a ring map into a field $k$. Say $a_ i$ maps to $\\alpha _ i \\in k$. Consider the fibre ring $S_ k = k \\otimes _ R S$. Let $k \\to K$ be a field extension. A $k$-algebra map of $S_ k \\to K$ is the same thing as finding $\\beta _1, \\ldots , \\beta _ n, \\gamma _1, \\ldots , \\gamma _ m \\in K$ such that \n  \n  \\[  x^{n + m} + \\alpha _1 x^{n + m - 1} + \\ldots + \\alpha _{n + m} = (x^ n + \\beta _1 x^{n - 1} + \\ldots + \\beta _ n) (x^ m + \\gamma _1 x^{m - 1} + \\ldots + \\gamma _ m).  \\]\n\n   Hence we see there are at most finitely many choices of such $n + m$-tuples in $K$. This proves that all fibres have finitely many closed points (use Hilbert\'s Nullstellensatz to see they all correspond to solutions in $\\overline{k}$ for example) and hence that $R \\to S$ is a relative global complete intersection. \n  Another way to argue this is to show $\\mathbf{Z}[a_1, \\ldots , a_{n + m}] \\to \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m]$ is actually also a finite ring map. Namely, by Lemma 10.38.5 each of $b_ i, c_ j$ is integral over $R$, and hence $R \\to S$ is finite by Lemma 10.36.4. \n]] and 10.143.12 [[\n  Example 10.143.12. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   of Example 10.136.7. Write symbolically \n  \n  \\[  S = R[b_1, \\ldots , c_ m]/(\\{ a_ k(b_ i, c_ j) - a_ k\\} _{k = 1, \\ldots , n + m})  \\]\n\n   where for example $a_1(b_ i, c_ j) = b_1 + c_1$. The matrix of partial derivatives is \n  \n  \\[  \\left( \\begin{matrix}  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  c_1 \n\n&  c_2 \n\n&  \\ldots \n\n&  c_ m \n\n\\\\  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_ n \n\n\\end{matrix} \\right)  \\]\n\n   The determinant $\\Delta $ of this matrix is better known as the resultant of the polynomials $g = x^ n + b_1 x^{n - 1} + \\ldots + b_ n$ and $h = x^ m + c_1 x^{m - 1} + \\ldots + c_ m$, and the matrix above is known as the Sylvester matrix associated to $g, h$. In a formula $\\Delta = \\text{Res}_ x(g, h)$. The Sylvester matrix is the transpose of the matrix of the linear map \n  \n  \\begin{eqnarray*}  S[x]_{< m} \\oplus S[x]_{< n} &  \\longrightarrow &  S[x]_{< n + m} \\\\  a \\oplus b &  \\longmapsto &  ag + bh \\end{eqnarray*}\n\n   Let $\\mathfrak q \\subset S$ be any prime. By the above the following are equivalent: \n  \n  \n$R \\to S$ is \xc3\xa9tale at $\\mathfrak q$, \n\n\n$\\Delta = \\text{Res}_ x(g, h) \\not\\in \\mathfrak q$, \n\n\nthe images $\\overline{g}, \\overline{h} \\in \\kappa (\\mathfrak q)[x]$ of the polynomials $g, h$ are relatively prime in $\\kappa (\\mathfrak q)[x]$. \n\n\n\n   The equivalence of (2) and (3) holds because the image of the Sylvester matrix in $\\text{Mat}(n + m, \\kappa (\\mathfrak q))$ has a kernel if and only if the polynomials $\\overline{g}, \\overline{h}$ have a factor in common. We conclude that the ring map \n  \n  \\[  R \\longrightarrow S[\\frac{1}{\\Delta }] = S[\\frac{1}{\\text{Res}_ x(g, h)}]  \\]\n\n   is \xc3\xa9tale. \n]]. By construction there is an $R$-algebra map \n    \n      \n  \\[  R\' = R \\otimes _{\\mathbf{Z}[a_1, \\ldots , a_{n + m}]} \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\longrightarrow \\kappa (\\mathfrak p)  \\]\n\n    \n       which maps $b_ i$ to $\\overline{b}_ i$ and $c_ j$ to $\\overline{c}_ j$. Denote $\\mathfrak p\' \\subset R\'$ the kernel of this map. Since by assumption the polynomials $\\overline{g}, \\overline{h}$ are relatively prime we see that the element $\\Delta = \\text{Res}_ x(g, h) \\in \\mathbf{Z}[b_ i, c_ j]$ (see Example 10.143.12 [[\n  Example 10.143.12. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   of Example 10.136.7. Write symbolically \n  \n  \\[  S = R[b_1, \\ldots , c_ m]/(\\{ a_ k(b_ i, c_ j) - a_ k\\} _{k = 1, \\ldots , n + m})  \\]\n\n   where for example $a_1(b_ i, c_ j) = b_1 + c_1$. The matrix of partial derivatives is \n  \n  \\[  \\left( \\begin{matrix}  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  c_1 \n\n&  c_2 \n\n&  \\ldots \n\n&  c_ m \n\n\\\\  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_ n \n\n\\end{matrix} \\right)  \\]\n\n   The determinant $\\Delta $ of this matrix is better known as the resultant of the polynomials $g = x^ n + b_1 x^{n - 1} + \\ldots + b_ n$ and $h = x^ m + c_1 x^{m - 1} + \\ldots + c_ m$, and the matrix above is known as the Sylvester matrix associated to $g, h$. In a formula $\\Delta = \\text{Res}_ x(g, h)$. The Sylvester matrix is the transpose of the matrix of the linear map \n  \n  \\begin{eqnarray*}  S[x]_{< m} \\oplus S[x]_{< n} &  \\longrightarrow &  S[x]_{< n + m} \\\\  a \\oplus b &  \\longmapsto &  ag + bh \\end{eqnarray*}\n\n   Let $\\mathfrak q \\subset S$ be any prime. By the above the following are equivalent: \n  \n  \n$R \\to S$ is \xc3\xa9tale at $\\mathfrak q$, \n\n\n$\\Delta = \\text{Res}_ x(g, h) \\not\\in \\mathfrak q$, \n\n\nthe images $\\overline{g}, \\overline{h} \\in \\kappa (\\mathfrak q)[x]$ of the polynomials $g, h$ are relatively prime in $\\kappa (\\mathfrak q)[x]$. \n\n\n\n   The equivalence of (2) and (3) holds because the image of the Sylvester matrix in $\\text{Mat}(n + m, \\kappa (\\mathfrak q))$ has a kernel if and only if the polynomials $\\overline{g}, \\overline{h}$ have a factor in common. We conclude that the ring map \n  \n  \\[  R \\longrightarrow S[\\frac{1}{\\Delta }] = S[\\frac{1}{\\text{Res}_ x(g, h)}]  \\]\n\n   is \xc3\xa9tale. \n]]) does not map to zero in $\\kappa (\\mathfrak p)$ under the displayed map. We conclude that $R \\to R\'$ is \xc3\xa9tale at $\\mathfrak p\'$. In fact a solution to the problem posed in the lemma is the ring map $R \\to R\'[1/\\Delta ]$ and the prime $\\mathfrak p\' R\'[1/\\Delta ]$. Because $\\text{Res}_ x(f, g)$ is invertible in this ring the Sylvester matrix is invertible over $R\'[1/\\Delta ]$ and hence $1 = a g + b h$ for some $a, b \\in R\'[1/\\Delta ][x]$ see Example 10.143.12 [[\n  Example 10.143.12. Let $n , m \\geq 1$ be integers. Consider the ring map \n  \n  \\begin{eqnarray*}  R = \\mathbf{Z}[a_1, \\ldots , a_{n + m}] &  \\longrightarrow &  S = \\mathbf{Z}[b_1, \\ldots , b_ n, c_1, \\ldots , c_ m] \\\\  a_1 &  \\longmapsto &  b_1 + c_1 \\\\  a_2 &  \\longmapsto &  b_2 + b_1 c_1 + c_2 \\\\  \\ldots &  \\ldots &  \\ldots \\\\  a_{n + m} &  \\longmapsto &  b_ n c_ m \\end{eqnarray*}\n\n   of Example 10.136.7. Write symbolically \n  \n  \\[  S = R[b_1, \\ldots , c_ m]/(\\{ a_ k(b_ i, c_ j) - a_ k\\} _{k = 1, \\ldots , n + m})  \\]\n\n   where for example $a_1(b_ i, c_ j) = b_1 + c_1$. The matrix of partial derivatives is \n  \n  \\[  \\left( \\begin{matrix}  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  c_1 \n\n&  \\ldots \n\n&  c_ m \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  c_1 \n\n&  c_2 \n\n&  \\ldots \n\n&  c_ m \n\n\\\\  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  0 \n\n&  \\ldots \n\n&  0 \n\n\\\\  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_{n - 1} \n\n&  b_ n \n\n&  \\ldots \n\n&  0 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  0 \n\n&  \\ldots \n\n&  \\ldots \n\n&  0 \n\n&  1 \n\n&  b_1 \n\n&  \\ldots \n\n&  b_ n \n\n\\end{matrix} \\right)  \\]\n\n   The determinant $\\Delta $ of this matrix is better known as the resultant of the polynomials $g = x^ n + b_1 x^{n - 1} + \\ldots + b_ n$ and $h = x^ m + c_1 x^{m - 1} + \\ldots + c_ m$, and the matrix above is known as the Sylvester matrix associated to $g, h$. In a formula $\\Delta = \\text{Res}_ x(g, h)$. The Sylvester matrix is the transpose of the matrix of the linear map \n  \n  \\begin{eqnarray*}  S[x]_{< m} \\oplus S[x]_{< n} &  \\longrightarrow &  S[x]_{< n + m} \\\\  a \\oplus b &  \\longmapsto &  ag + bh \\end{eqnarray*}\n\n   Let $\\mathfrak q \\subset S$ be any prime. By the above the following are equivalent: \n  \n  \n$R \\to S$ is \xc3\xa9tale at $\\mathfrak q$, \n\n\n$\\Delta = \\text{Res}_ x(g, h) \\not\\in \\mathfrak q$, \n\n\nthe images $\\overline{g}, \\overline{h} \\in \\kappa (\\mathfrak q)[x]$ of the polynomials $g, h$ are relatively prime in $\\kappa (\\mathfrak q)[x]$. \n\n\n\n   The equivalence of (2) and (3) holds because the image of the Sylvester matrix in $\\text{Mat}(n + m, \\kappa (\\mathfrak q))$ has a kernel if and only if the polynomials $\\overline{g}, \\overline{h}$ have a factor in common. We conclude that the ring map \n  \n  \\[  R \\longrightarrow S[\\frac{1}{\\Delta }] = S[\\frac{1}{\\text{Res}_ x(g, h)}]  \\]\n\n   is \xc3\xa9tale. \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof appears to be about producing a prime/point Q lying over a given prime p together with factorization data for polynomials f and g (via `factor‚ÇÅ`, `factor‚ÇÇ`, monicity, coprimality, and a multiplication equality), using a lemma `exists_liesOver_residueFieldMap_bijective` that suggests a bijection on residue fields and a lying-over existence statement. The informal proof, however, is primarily a geometric/algebraic construction: it localizes to make leading coefficients invertible, reduces to monic polynomials, constructs a fibre product ring R‚Ä≤ from universal factorization data, inverts the resultant Œî to get an √©tale map, and uses invertibility of the Sylvester matrix/resultant to deduce coprimality (Bezout identity) and √©taleness at a prime.\n\nStructurally, the informal proof proceeds by explicit ring construction (R‚Ä≤), localization/inversion (1/Œî), and an √©taleness criterion via the resultant, whereas the Lean proof is a short extraction of an existential package from a pre-proved lemma and then repackaging it into the goal with factorization/coprime/monic fields. There is no visible correspondence to the key informal steps (localization to make monic, fibre product construction, resultant/Sylvester matrix, √©tale criterion). The only overlap is that both involve monic factors and coprimality over residue fields, but the main mechanism in the informal argument (resultant/√©tale localization) is not reflected in the Lean snippet.""}"
324,00PP,"instance baseChange [QuasiFinite R S] {A : Type*} [CommRing A] [Algebra R A] :
    QuasiFinite A (A ‚äó[R] S) := by
  refine ‚ü®fun P hP ‚Ü¶ ?_‚ü©
  let p := P.under R
  let e : P.Fiber (A ‚äó[R] S) ‚âÉ‚Çê[P.ResidueField] P.ResidueField ‚äó[p.ResidueField] (p.Fiber S) :=
    (Algebra.TensorProduct.cancelBaseChange _ _ _ _ _).trans
      (Algebra.TensorProduct.cancelBaseChange _ _ _ _ _).symm
  exact .of_surjective e.symm.toLinearMap e.symm.surjective
",Formal Proof of Stacks Project Tag 00PP,(3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/QuasiFinite/Basic.lean#L104-L111,Q27041,,10.122.9,lemma,3.0,"['02MK', '00AO', '0ELQ']","\n  Lemma 10.122.9. Let $R \\to S$ be a ring map of finite type. Let $R \\to R\'$ be any ring map. Set $S\' = R\' \\otimes _ R S$. \n  \n  \nThe set $\\{ \\mathfrak q\' \\mid R\' \\to S\' \\text{ quasi-finite at }\\mathfrak q\'\\} $ is the inverse image of the corresponding set of $\\mathop{\\mathrm{Spec}}(S)$ under the canonical map $\\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$. \n\n\nIf $\\mathop{\\mathrm{Spec}}(R\') \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective, then $R \\to S$ is quasi-finite if and only if $R\' \\to S\'$ is quasi-finite. \n\n\nAny base change of a quasi-finite ring map is quasi-finite. \n\n\n\n\n    \n      Proof.\n      Let $\\mathfrak p\' \\subset R\'$ be a prime lying over $\\mathfrak p \\subset R$. Then the fibre ring $S\' \\otimes _{R\'} \\kappa (\\mathfrak p\')$ is the base change of the fibre ring $S \\otimes _ R \\kappa (\\mathfrak p)$ by the field extension $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak p\')$. Hence the first assertion follows from the invariance of dimension under field extension (Lemma 10.116.6) and Lemma 10.122.1. The stability of quasi-finite maps under base change follows from this and the stability of finite type property under base change. The second assertion follows since the assumption implies that given a prime $\\mathfrak q \\subset S$ we can find a prime $\\mathfrak q\' \\subset S\'$ lying over it. \n      $\\square$\n    \n","\n  Lemma 10.122.9. Let $R \\to S$ be a ring map of finite type. Let $R \\to R\'$ be any ring map. Set $S\' = R\' \\otimes _ R S$. \n  \n  \nThe set $\\{ \\mathfrak q\' \\mid R\' \\to S\' \\text{ quasi-finite at }\\mathfrak q\'\\} $ is the inverse image of the corresponding set of $\\mathop{\\mathrm{Spec}}(S)$ under the canonical map $\\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$. \n\n\nIf $\\mathop{\\mathrm{Spec}}(R\') \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective, then $R \\to S$ is quasi-finite if and only if $R\' \\to S\'$ is quasi-finite. \n\n\nAny base change of a quasi-finite ring map is quasi-finite. \n\n\n\n\n    \n",Proof.\n      Let $\\mathfrak p\' \\subset R\'$ be a prime lying over $\\mathfrak p \\subset R$. Then the fibre ring $S\' \\otimes _{R\'} \\kappa (\\mathfrak p\')$ is the base change of the fibre ring $S \\otimes _ R \\kappa (\\mathfrak p)$ by the field extension $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak p\')$. Hence the first assertion follows from the invariance of dimension under field extension (Lemma 10.116.6) and Lemma 10.122.1. The stability of quasi-finite maps under base change follows from this and the stability of finite type property under base change. The second assertion follows since the assumption implies that given a prime $\\mathfrak q \\subset S$ we can find a prime $\\mathfrak q\' \\subset S\'$ lying over it. \n      $\\square$\n    \n," by
  refine ‚ü®fun P hP ‚Ü¶ ?_‚ü©
  let p := P.under R
  let e : P.Fiber (A ‚äó[R] S) ‚âÉ‚Çê[P.ResidueField] P.ResidueField ‚äó[p.ResidueField] (p.Fiber S) :=
    (Algebra.TensorProduct.cancelBaseChange _ _ _ _ _).trans
      (Algebra.TensorProduct.cancelBaseChange _ _ _ _ _).symm
  exact .of_surjective e.symm.toLinearMap e.symm.surjective
","instance baseChange [QuasiFinite R S] {A : Type*} [CommRing A] [Algebra R A] :
    QuasiFinite A (A ‚äó[R] S) ","Proof.\n      Let $\\mathfrak p\' \\subset R\'$ be a prime lying over $\\mathfrak p \\subset R$. Then the fibre ring $S\' \\otimes _{R\'} \\kappa (\\mathfrak p\')$ is the base change of the fibre ring $S \\otimes _ R \\kappa (\\mathfrak p)$ by the field extension $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak p\')$. Hence the first assertion follows from the invariance of dimension under field extension (Lemma 10.116.6 [[\n  Lemma 10.116.6. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Set $X = \\mathop{\\mathrm{Spec}}(S)$. Let $K/k$ be a field extension. Set $S_ K = K \\otimes _ k S$, and $X_ K = \\mathop{\\mathrm{Spec}}(S_ K)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$ and let $\\mathfrak q_ K \\subset S_ K$ be a prime corresponding to $x_ K \\in X_ K$ lying over $\\mathfrak q$. Then $\\dim _ x X = \\dim _{x_ K} X_ K$. \n\n    \n]]) and Lemma 10.122.1 [[\n  Lemma 10.122.1. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Let $\\mathfrak q$ be a prime of $S$. The following are equivalent: \n  \n  \n$\\mathfrak q$ is an isolated point of $\\mathop{\\mathrm{Spec}}(S)$, \n\n\n$S_{\\mathfrak q}$ is finite over $k$, \n\n\nthere exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $D(g) = \\{  \\mathfrak q \\} $, \n\n\n$\\dim _{\\mathfrak q} \\mathop{\\mathrm{Spec}}(S) = 0$, \n\n\n$\\mathfrak q$ is a closed point of $\\mathop{\\mathrm{Spec}}(S)$ and $\\dim (S_{\\mathfrak q}) = 0$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/k$ is finite and $\\dim (S_{\\mathfrak q}) = 0$. \n\n\n\n   In this case $S = S_{\\mathfrak q} \\times S\'$ for some finite type $k$-algebra $S\'$. Also, the element $g$ as in (3) has the property $S_{\\mathfrak q} = S_ g$. \n\n    \n]]. The stability of quasi-finite maps under base change follows from this and the stability of finite type property under base change. The second assertion follows since the assumption implies that given a prime $\\mathfrak q \\subset S$ we can find a prime $\\mathfrak q\' \\subset S\'$ lying over it. \n      $\\square$\n    \n","Proof.\n      Let $\\mathfrak p\' \\subset R\'$ be a prime lying over $\\mathfrak p \\subset R$. Then the fibre ring $S\' \\otimes _{R\'} \\kappa (\\mathfrak p\')$ is the base change of the fibre ring $S \\otimes _ R \\kappa (\\mathfrak p)$ by the field extension $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak p\')$. Hence the first assertion follows from the invariance of dimension under field extension (Lemma 10.116.6 [[\n  Lemma 10.116.6. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Set $X = \\mathop{\\mathrm{Spec}}(S)$. Let $K/k$ be a field extension. Set $S_ K = K \\otimes _ k S$, and $X_ K = \\mathop{\\mathrm{Spec}}(S_ K)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$ and let $\\mathfrak q_ K \\subset S_ K$ be a prime corresponding to $x_ K \\in X_ K$ lying over $\\mathfrak q$. Then $\\dim _ x X = \\dim _{x_ K} X_ K$. \n\n    \n]]) and Lemma 10.122.1 [[\n  Lemma 10.122.1. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Let $\\mathfrak q$ be a prime of $S$. The following are equivalent: \n  \n  \n$\\mathfrak q$ is an isolated point of $\\mathop{\\mathrm{Spec}}(S)$, \n\n\n$S_{\\mathfrak q}$ is finite over $k$, \n\n\nthere exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $D(g) = \\{  \\mathfrak q \\} $, \n\n\n$\\dim _{\\mathfrak q} \\mathop{\\mathrm{Spec}}(S) = 0$, \n\n\n$\\mathfrak q$ is a closed point of $\\mathop{\\mathrm{Spec}}(S)$ and $\\dim (S_{\\mathfrak q}) = 0$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/k$ is finite and $\\dim (S_{\\mathfrak q}) = 0$. \n\n\n\n   In this case $S = S_{\\mathfrak q} \\times S\'$ for some finite type $k$-algebra $S\'$. Also, the element $g$ as in (3) has the property $S_{\\mathfrak q} = S_ g$. \n\n    \n]]. The stability of quasi-finite maps under base change follows from this and the stability of finite type property under base change. The second assertion follows since the assumption implies that given a prime $\\mathfrak q \\subset S$ we can find a prime $\\mathfrak q\' \\subset S\'$ lying over it. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof constructs (for each prime P with a hypothesis hP) an explicit algebra equivalence between a fiber over a base-changed ring and a tensor product of residue fields/fibers, using `Algebra.TensorProduct.cancelBaseChange`, and then concludes a property via `of_surjective` from the surjectivity of the induced linear map. This matches only the very first step of the informal proof: identifying the fiber after base change as a base change of the original fiber along a residue field extension.\n\nStructurally, the informal argument proceeds from that fiber identification to invariance of dimension under field extension and then to stability of quasi-finite maps under base change (plus finite type stability), and finally a second assertion about lifting primes. None of these dimension/quasi-finite/prime-lifting steps appear in the Lean snippet; it stops after producing a surjective map from the fiber isomorphism. Thus the Lean proof is a partial formalization of the base-change-of-fibers observation, but it does not reflect the main logical flow or conclusions of the informal proof.""}"
325,00PO,"lemma trans [QuasiFinite R S] [QuasiFinite S T] : QuasiFinite R T := by
  refine ‚ü®fun P hP ‚Ü¶ ?_‚ü©
  have : Module.Finite (P.Fiber S) ((P.Fiber S) ‚äó[S] T) :=
    iff_of_isArtinianRing.mp inferInstance
  have : Module.Finite P.ResidueField ((P.Fiber S) ‚äó[S] T) :=
    .trans (P.Fiber S) _
  let e : P.Fiber S ‚âÉ‚Çê[S] S ‚äó[R] P.ResidueField :=
    { __ := Algebra.TensorProduct.comm _ _ _, commutes' _ := rfl }
  let e' : (P.Fiber S) ‚äó[S] T ‚âÉ‚Çê[R] P.Fiber T :=
    ((Algebra.TensorProduct.congr e .refl).restrictScalars R).trans <|
    ((Algebra.TensorProduct.comm _ _ _).restrictScalars R).trans <|
    ((Algebra.TensorProduct.cancelBaseChange _ _ T _ _).restrictScalars R).trans
    (Algebra.TensorProduct.comm _ _ _)
  let e'' : (P.Fiber S) ‚äó[S] T ‚âÉ‚Çê[P.ResidueField] P.Fiber T :=
    { __ := e', commutes' _ := by simp [e', e] }
  exact .of_surjective e''.toLinearMap e''.surjective
",Formal Proof of Stacks Project Tag 00PO,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/QuasiFinite/Basic.lean#L161-L176,Q27041,,10.122.8,lemma,3.0,"['02MK', '00AO', '0ELQ']","\n  Lemma 10.122.8. A composition of quasi-finite ring maps is quasi-finite. \n\n    \n      Proof.\n      Suppose $A \\to B$ and $B \\to C$ are quasi-finite ring maps. By Lemma 10.6.2 we see that $A \\to C$ is of finite type. Let $\\mathfrak r \\subset C$ be a prime of $C$ lying over $\\mathfrak q \\subset B$ and $\\mathfrak p \\subset A$. Since $A \\to B$ and $B \\to C$ are quasi-finite at $\\mathfrak q$ and $\\mathfrak r$ respectively, then there exist $b \\in B$ and $c \\in C$ such that $\\mathfrak q$ is the only prime of $D(b)$ which maps to $\\mathfrak p$ and similarly $\\mathfrak r$ is the only prime of $D(c)$ which maps to $\\mathfrak q$. If $c\' \\in C$ is the image of $b \\in B$, then $\\mathfrak r$ is the only prime of $D(cc\')$ which maps to $\\mathfrak p$. Therefore $A \\to C$ is quasi-finite at $\\mathfrak r$. \n      $\\square$\n    \n",\n  Lemma 10.122.8. A composition of quasi-finite ring maps is quasi-finite. \n\n    \n,"Proof.\n      Suppose $A \\to B$ and $B \\to C$ are quasi-finite ring maps. By Lemma 10.6.2 we see that $A \\to C$ is of finite type. Let $\\mathfrak r \\subset C$ be a prime of $C$ lying over $\\mathfrak q \\subset B$ and $\\mathfrak p \\subset A$. Since $A \\to B$ and $B \\to C$ are quasi-finite at $\\mathfrak q$ and $\\mathfrak r$ respectively, then there exist $b \\in B$ and $c \\in C$ such that $\\mathfrak q$ is the only prime of $D(b)$ which maps to $\\mathfrak p$ and similarly $\\mathfrak r$ is the only prime of $D(c)$ which maps to $\\mathfrak q$. If $c\' \\in C$ is the image of $b \\in B$, then $\\mathfrak r$ is the only prime of $D(cc\')$ which maps to $\\mathfrak p$. Therefore $A \\to C$ is quasi-finite at $\\mathfrak r$. \n      $\\square$\n    \n"," by
  refine ‚ü®fun P hP ‚Ü¶ ?_‚ü©
  have : Module.Finite (P.Fiber S) ((P.Fiber S) ‚äó[S] T) :=
    iff_of_isArtinianRing.mp inferInstance
  have : Module.Finite P.ResidueField ((P.Fiber S) ‚äó[S] T) :=
    .trans (P.Fiber S) _
  let e : P.Fiber S ‚âÉ‚Çê[S] S ‚äó[R] P.ResidueField :=
    { __ := Algebra.TensorProduct.comm _ _ _, commutes' _ := rfl }
  let e' : (P.Fiber S) ‚äó[S] T ‚âÉ‚Çê[R] P.Fiber T :=
    ((Algebra.TensorProduct.congr e .refl).restrictScalars R).trans <|
    ((Algebra.TensorProduct.comm _ _ _).restrictScalars R).trans <|
    ((Algebra.TensorProduct.cancelBaseChange _ _ T _ _).restrictScalars R).trans
    (Algebra.TensorProduct.comm _ _ _)
  let e'' : (P.Fiber S) ‚äó[S] T ‚âÉ‚Çê[P.ResidueField] P.Fiber T :=
    { __ := e', commutes' _ := by simp [e', e] }
  exact .of_surjective e''.toLinearMap e''.surjective
",lemma trans [QuasiFinite R S] [QuasiFinite S T] : QuasiFinite R T ,"Proof.\n      Suppose $A \\to B$ and $B \\to C$ are quasi-finite ring maps. By Lemma 10.6.2 [[\n  Lemma 10.6.2. The notions finite type and finite presentation have the following permanence properties. \n  \n  \nA composition of ring maps of finite type is of finite type. \n\n\nA composition of ring maps of finite presentation is of finite presentation. \n\n\nGiven $R \\to S\' \\to S$ with $R \\to S$ of finite type, then $S\' \\to S$ is of finite type. \n\n\nGiven $R \\to S\' \\to S$, with $R \\to S$ of finite presentation, and $R \\to S\'$ of finite type, then $S\' \\to S$ is of finite presentation. \n\n\n\n\n    \n]] we see that $A \\to C$ is of finite type. Let $\\mathfrak r \\subset C$ be a prime of $C$ lying over $\\mathfrak q \\subset B$ and $\\mathfrak p \\subset A$. Since $A \\to B$ and $B \\to C$ are quasi-finite at $\\mathfrak q$ and $\\mathfrak r$ respectively, then there exist $b \\in B$ and $c \\in C$ such that $\\mathfrak q$ is the only prime of $D(b)$ which maps to $\\mathfrak p$ and similarly $\\mathfrak r$ is the only prime of $D(c)$ which maps to $\\mathfrak q$. If $c\' \\in C$ is the image of $b \\in B$, then $\\mathfrak r$ is the only prime of $D(cc\')$ which maps to $\\mathfrak p$. Therefore $A \\to C$ is quasi-finite at $\\mathfrak r$. \n      $\\square$\n    \n","Proof.\n      Suppose $A \\to B$ and $B \\to C$ are quasi-finite ring maps. By Lemma 10.6.2 [[\n  Lemma 10.6.2. The notions finite type and finite presentation have the following permanence properties. \n  \n  \nA composition of ring maps of finite type is of finite type. \n\n\nA composition of ring maps of finite presentation is of finite presentation. \n\n\nGiven $R \\to S\' \\to S$ with $R \\to S$ of finite type, then $S\' \\to S$ is of finite type. \n\n\nGiven $R \\to S\' \\to S$, with $R \\to S$ of finite presentation, and $R \\to S\'$ of finite type, then $S\' \\to S$ is of finite presentation. \n\n\n\n\n    \n]] we see that $A \\to C$ is of finite type. Let $\\mathfrak r \\subset C$ be a prime of $C$ lying over $\\mathfrak q \\subset B$ and $\\mathfrak p \\subset A$. Since $A \\to B$ and $B \\to C$ are quasi-finite at $\\mathfrak q$ and $\\mathfrak r$ respectively, then there exist $b \\in B$ and $c \\in C$ such that $\\mathfrak q$ is the only prime of $D(b)$ which maps to $\\mathfrak p$ and similarly $\\mathfrak r$ is the only prime of $D(c)$ which maps to $\\mathfrak q$. If $c\' \\in C$ is the image of $b \\in B$, then $\\mathfrak r$ is the only prime of $D(cc\')$ which maps to $\\mathfrak p$. Therefore $A \\to C$ is quasi-finite at $\\mathfrak r$. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about permanence of quasi-finiteness under composition of ring maps A‚ÜíB‚ÜíC, using finite type permanence and a prime-avoidance/localization argument with distinguished opens D(b), D(c). The formal Lean proof instead constructs module-finiteness of certain tensor products/fibers (Module.Finite for P.Fiber S and base change to T), then uses explicit algebra isomorphisms between fibers via tensor-product commutativity/cancelBaseChange, concluding finiteness via surjectivity of a linear map. Structurally there is no correspondence: the informal proof reasons about primes and opens, while the formal proof is about residue fields/fibers and tensor equivalences. The formal proof does not mention quasi-finite maps, composition, primes, or the D(b) argument, so it does not capture the content of the informal proof.""}"
328,031I,"theorem _root_.Algebra.Extension.formallySmooth_iff_split_injection
    (P : Algebra.Extension.{w} R A) [FormallySmooth R P.Ring] :
    Algebra.FormallySmooth R A ‚Üî ‚àÉ l, l ‚àò‚Çó P.cotangentComplex = LinearMap.id := by
  refine (Algebra.FormallySmooth.iff_split_injection P.algebraMap_surjective).trans ?_
  let e : P.ker.Cotangent ‚âÉ‚Çó[P.Ring] P.Cotangent :=
    { __ := AddEquiv.refl _, map_smul' r m := by ext1; simp; rfl }
  constructor
  ¬∑ intro ‚ü®l, hl‚ü©
    exact ‚ü®(e.comp l).extendScalarsOfSurjective P.algebraMap_surjective,
      LinearMap.ext (DFunLike.congr_fun hl : _)‚ü©
  ¬∑ intro ‚ü®l, hl‚ü©
    exact ‚ü®e.symm.toLinearMap ‚àò‚Çó l.restrictScalars P.Ring,
      LinearMap.ext (DFunLike.congr_fun hl : _)‚ü©
",Formal Proof of Stacks Project Tag 031I,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Smooth/Basic.lean#L306-L318,Q27041,,10.138.7,lemma,3.0,"['00TH', '00AO', '0ELQ']","\n  Lemma 10.138.7. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if the sequence \n  \n  \\[  0 \\to J/J^2 \\to \\Omega _{P/R} \\otimes _ P S \\to \\Omega _{S/R} \\to 0  \\]\n\n   of Lemma 10.131.9 is a split exact sequence. \n\n    \n      Proof.\n      Assume $S$ is formally smooth over $R$. By Lemma 10.138.5 this means there exists an $R$-algebra map $S \\to P/J^2$ which is a right inverse to the canonical map $P/J^2 \\to S$. By Lemma 10.131.11 we have $\\Omega _{P/R} \\otimes _ P S = \\Omega _{(P/J^2)/R} \\otimes _{P/J^2} S$. By Lemma 10.131.10 the sequence is split. \n    \n      Assume the exact sequence of the lemma is split exact. Choose a splitting $\\sigma : \\Omega _{S/R} \\to \\Omega _{P/R} \\otimes _ P S$. For each $\\lambda \\in S$ choose $x_\\lambda \\in P$ which maps to $\\lambda $. Next, for each $\\lambda \\in S$ choose $f_\\lambda \\in J$ such that \n    \n      \n  \\[  \\text{d}f_\\lambda = \\text{d}x_\\lambda - \\sigma (\\text{d}\\lambda )  \\]\n\n    \n       in the middle term of the exact sequence. We claim that $s : \\lambda \\mapsto x_\\lambda - f_\\lambda \\mod J^2$ is an $R$-algebra homomorphism $s : S \\to P/J^2$. To prove this we will repeatedly use that if $h \\in J$ and $\\text{d}h = 0$ in $\\Omega _{P/R} \\otimes _ R S$, then $h \\in J^2$. Let $\\lambda , \\mu \\in S$. Then $\\sigma (\\text{d}\\lambda + \\text{d}\\mu - \\text{d}(\\lambda + \\mu )) = 0$. This implies \n    \n      \n  \\[  \\text{d}(x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu }) = 0  \\]\n\n    \n       which means that $x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu } \\in J^2$, which in turn means that $s(\\lambda ) + s(\\mu ) = s(\\lambda + \\mu )$. Similarly, we have $\\sigma (\\lambda \\text{d}\\mu + \\mu \\text{d}\\lambda - \\text{d}\\lambda \\mu ) = 0$ which implies that \n    \n      \n  \\[  \\mu (\\text{d}x_\\lambda - \\text{d}f_\\lambda ) + \\lambda (\\text{d}x_\\mu - \\text{d}f_\\mu ) - \\text{d}x_{\\lambda \\mu } + \\text{d}f_{\\lambda \\mu } = 0  \\]\n\n    \n       in the middle term of the exact sequence. Moreover we have \n    \n      \n  \\[  \\text{d}(x_\\lambda x_\\mu ) = x_\\lambda \\text{d}x_\\mu + x_\\mu \\text{d}x_\\lambda = \\lambda \\text{d}x_\\mu + \\mu \\text{d} x_\\lambda  \\]\n\n    \n       in the middle term again. Combined these equations mean that $x_\\lambda x_\\mu - x_{\\lambda \\mu } - \\mu f_\\lambda - \\lambda f_\\mu + f_{\\lambda \\mu } \\in J^2$, hence $(x_\\lambda - f_\\lambda )(x_\\mu - f_\\mu ) - (x_{\\lambda \\mu } - f_{\\lambda \\mu }) \\in J^2$ as $f_\\lambda f_\\mu \\in J^2$, which means that $s(\\lambda )s(\\mu ) = s(\\lambda \\mu )$. If $\\lambda \\in R$, then $\\text{d}\\lambda = 0$ and we see that $\\text{d}f_\\lambda = \\text{d}x_\\lambda $, hence $\\lambda - x_\\lambda + f_\\lambda \\in J^2$ and hence $s(\\lambda ) = \\lambda $ as desired. At this point we can apply Lemma 10.138.5 to conclude that $S/R$ is formally smooth. \n      $\\square$\n    \n",\n  Lemma 10.138.7. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if the sequence \n  \n  \\[  0 \\to J/J^2 \\to \\Omega _{P/R} \\otimes _ P S \\to \\Omega _{S/R} \\to 0  \\]\n\n   of Lemma 10.131.9 is a split exact sequence. \n\n    \n,"Proof.\n      Assume $S$ is formally smooth over $R$. By Lemma 10.138.5 this means there exists an $R$-algebra map $S \\to P/J^2$ which is a right inverse to the canonical map $P/J^2 \\to S$. By Lemma 10.131.11 we have $\\Omega _{P/R} \\otimes _ P S = \\Omega _{(P/J^2)/R} \\otimes _{P/J^2} S$. By Lemma 10.131.10 the sequence is split. \n    \n      Assume the exact sequence of the lemma is split exact. Choose a splitting $\\sigma : \\Omega _{S/R} \\to \\Omega _{P/R} \\otimes _ P S$. For each $\\lambda \\in S$ choose $x_\\lambda \\in P$ which maps to $\\lambda $. Next, for each $\\lambda \\in S$ choose $f_\\lambda \\in J$ such that \n    \n      \n  \\[  \\text{d}f_\\lambda = \\text{d}x_\\lambda - \\sigma (\\text{d}\\lambda )  \\]\n\n    \n       in the middle term of the exact sequence. We claim that $s : \\lambda \\mapsto x_\\lambda - f_\\lambda \\mod J^2$ is an $R$-algebra homomorphism $s : S \\to P/J^2$. To prove this we will repeatedly use that if $h \\in J$ and $\\text{d}h = 0$ in $\\Omega _{P/R} \\otimes _ R S$, then $h \\in J^2$. Let $\\lambda , \\mu \\in S$. Then $\\sigma (\\text{d}\\lambda + \\text{d}\\mu - \\text{d}(\\lambda + \\mu )) = 0$. This implies \n    \n      \n  \\[  \\text{d}(x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu }) = 0  \\]\n\n    \n       which means that $x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu } \\in J^2$, which in turn means that $s(\\lambda ) + s(\\mu ) = s(\\lambda + \\mu )$. Similarly, we have $\\sigma (\\lambda \\text{d}\\mu + \\mu \\text{d}\\lambda - \\text{d}\\lambda \\mu ) = 0$ which implies that \n    \n      \n  \\[  \\mu (\\text{d}x_\\lambda - \\text{d}f_\\lambda ) + \\lambda (\\text{d}x_\\mu - \\text{d}f_\\mu ) - \\text{d}x_{\\lambda \\mu } + \\text{d}f_{\\lambda \\mu } = 0  \\]\n\n    \n       in the middle term of the exact sequence. Moreover we have \n    \n      \n  \\[  \\text{d}(x_\\lambda x_\\mu ) = x_\\lambda \\text{d}x_\\mu + x_\\mu \\text{d}x_\\lambda = \\lambda \\text{d}x_\\mu + \\mu \\text{d} x_\\lambda  \\]\n\n    \n       in the middle term again. Combined these equations mean that $x_\\lambda x_\\mu - x_{\\lambda \\mu } - \\mu f_\\lambda - \\lambda f_\\mu + f_{\\lambda \\mu } \\in J^2$, hence $(x_\\lambda - f_\\lambda )(x_\\mu - f_\\mu ) - (x_{\\lambda \\mu } - f_{\\lambda \\mu }) \\in J^2$ as $f_\\lambda f_\\mu \\in J^2$, which means that $s(\\lambda )s(\\mu ) = s(\\lambda \\mu )$. If $\\lambda \\in R$, then $\\text{d}\\lambda = 0$ and we see that $\\text{d}f_\\lambda = \\text{d}x_\\lambda $, hence $\\lambda - x_\\lambda + f_\\lambda \\in J^2$ and hence $s(\\lambda ) = \\lambda $ as desired. At this point we can apply Lemma 10.138.5 to conclude that $S/R$ is formally smooth. \n      $\\square$\n    \n"," by
  refine (Algebra.FormallySmooth.iff_split_injection P.algebraMap_surjective).trans ?_
  let e : P.ker.Cotangent ‚âÉ‚Çó[P.Ring] P.Cotangent :=
    { __ := AddEquiv.refl _, map_smul' r m := by ext1; simp; rfl }
  constructor
  ¬∑ intro ‚ü®l, hl‚ü©
    exact ‚ü®(e.comp l).extendScalarsOfSurjective P.algebraMap_surjective,
      LinearMap.ext (DFunLike.congr_fun hl : _)‚ü©
  ¬∑ intro ‚ü®l, hl‚ü©
    exact ‚ü®e.symm.toLinearMap ‚àò‚Çó l.restrictScalars P.Ring,
      LinearMap.ext (DFunLike.congr_fun hl : _)‚ü©
","theorem _root_.Algebra.Extension.formallySmooth_iff_split_injection
    (P : Algebra.Extension.{w} R A) [FormallySmooth R P.Ring] :
    Algebra.FormallySmooth R A ‚Üî ‚àÉ l, l ‚àò‚Çó P.cotangentComplex = LinearMap.id ","Proof.\n      Assume $S$ is formally smooth over $R$. By Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]] this means there exists an $R$-algebra map $S \\to P/J^2$ which is a right inverse to the canonical map $P/J^2 \\to S$. By Lemma 10.131.11 [[\n  Lemma 10.131.11. Let $R \\to S$ be a ring map. Let $I \\subset S$ be an ideal. Let $n \\geq 1$ be an integer. Set $S\' = S/I^{n + 1}$. The map $\\Omega _{S/R} \\to \\Omega _{S\'/R}$ induces an isomorphism \n  \n  \\[  \\Omega _{S/R} \\otimes _ S S/I^ n \\longrightarrow \\Omega _{S\'/R} \\otimes _{S\'} S/I^ n.  \\]\n\n\n    \n]] we have $\\Omega _{P/R} \\otimes _ P S = \\Omega _{(P/J^2)/R} \\otimes _{P/J^2} S$. By Lemma 10.131.10 [[\n  Lemma 10.131.10. In diagram (10.131.4.1), suppose that $S \\to S\'$ is surjective with kernel $I \\subset S$, and assume that $R\' = R$. Moreover, assume that there exists an $R$-algebra map $S\' \\to S$ which is a right inverse to $S \\to S\'$. Then the exact sequence of $S\'$-modules of Lemma 10.131.9 turns into a short exact sequence \n  \n  \\[  0 \\longrightarrow I/I^2 \\longrightarrow \\Omega _{S/R} \\otimes _ S S\' \\longrightarrow \\Omega _{S\'/R} \\longrightarrow 0  \\]\n\n   which is even a split short exact sequence. \n\n    \n]] the sequence is split. \n    \n      Assume the exact sequence of the lemma is split exact. Choose a splitting $\\sigma : \\Omega _{S/R} \\to \\Omega _{P/R} \\otimes _ P S$. For each $\\lambda \\in S$ choose $x_\\lambda \\in P$ which maps to $\\lambda $. Next, for each $\\lambda \\in S$ choose $f_\\lambda \\in J$ such that \n    \n      \n  \\[  \\text{d}f_\\lambda = \\text{d}x_\\lambda - \\sigma (\\text{d}\\lambda )  \\]\n\n    \n       in the middle term of the exact sequence. We claim that $s : \\lambda \\mapsto x_\\lambda - f_\\lambda \\mod J^2$ is an $R$-algebra homomorphism $s : S \\to P/J^2$. To prove this we will repeatedly use that if $h \\in J$ and $\\text{d}h = 0$ in $\\Omega _{P/R} \\otimes _ R S$, then $h \\in J^2$. Let $\\lambda , \\mu \\in S$. Then $\\sigma (\\text{d}\\lambda + \\text{d}\\mu - \\text{d}(\\lambda + \\mu )) = 0$. This implies \n    \n      \n  \\[  \\text{d}(x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu }) = 0  \\]\n\n    \n       which means that $x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu } \\in J^2$, which in turn means that $s(\\lambda ) + s(\\mu ) = s(\\lambda + \\mu )$. Similarly, we have $\\sigma (\\lambda \\text{d}\\mu + \\mu \\text{d}\\lambda - \\text{d}\\lambda \\mu ) = 0$ which implies that \n    \n      \n  \\[  \\mu (\\text{d}x_\\lambda - \\text{d}f_\\lambda ) + \\lambda (\\text{d}x_\\mu - \\text{d}f_\\mu ) - \\text{d}x_{\\lambda \\mu } + \\text{d}f_{\\lambda \\mu } = 0  \\]\n\n    \n       in the middle term of the exact sequence. Moreover we have \n    \n      \n  \\[  \\text{d}(x_\\lambda x_\\mu ) = x_\\lambda \\text{d}x_\\mu + x_\\mu \\text{d}x_\\lambda = \\lambda \\text{d}x_\\mu + \\mu \\text{d} x_\\lambda  \\]\n\n    \n       in the middle term again. Combined these equations mean that $x_\\lambda x_\\mu - x_{\\lambda \\mu } - \\mu f_\\lambda - \\lambda f_\\mu + f_{\\lambda \\mu } \\in J^2$, hence $(x_\\lambda - f_\\lambda )(x_\\mu - f_\\mu ) - (x_{\\lambda \\mu } - f_{\\lambda \\mu }) \\in J^2$ as $f_\\lambda f_\\mu \\in J^2$, which means that $s(\\lambda )s(\\mu ) = s(\\lambda \\mu )$. If $\\lambda \\in R$, then $\\text{d}\\lambda = 0$ and we see that $\\text{d}f_\\lambda = \\text{d}x_\\lambda $, hence $\\lambda - x_\\lambda + f_\\lambda \\in J^2$ and hence $s(\\lambda ) = \\lambda $ as desired. At this point we can apply Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]] to conclude that $S/R$ is formally smooth. \n      $\\square$\n    \n","Proof.\n      Assume $S$ is formally smooth over $R$. By Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]] this means there exists an $R$-algebra map $S \\to P/J^2$ which is a right inverse to the canonical map $P/J^2 \\to S$. By Lemma 10.131.11 [[\n  Lemma 10.131.11. Let $R \\to S$ be a ring map. Let $I \\subset S$ be an ideal. Let $n \\geq 1$ be an integer. Set $S\' = S/I^{n + 1}$. The map $\\Omega _{S/R} \\to \\Omega _{S\'/R}$ induces an isomorphism \n  \n  \\[  \\Omega _{S/R} \\otimes _ S S/I^ n \\longrightarrow \\Omega _{S\'/R} \\otimes _{S\'} S/I^ n.  \\]\n\n\n    \n]] we have $\\Omega _{P/R} \\otimes _ P S = \\Omega _{(P/J^2)/R} \\otimes _{P/J^2} S$. By Lemma 10.131.10 [[\n  Lemma 10.131.10. In diagram (10.131.4.1), suppose that $S \\to S\'$ is surjective with kernel $I \\subset S$, and assume that $R\' = R$. Moreover, assume that there exists an $R$-algebra map $S\' \\to S$ which is a right inverse to $S \\to S\'$. Then the exact sequence of $S\'$-modules of Lemma 10.131.9 turns into a short exact sequence \n  \n  \\[  0 \\longrightarrow I/I^2 \\longrightarrow \\Omega _{S/R} \\otimes _ S S\' \\longrightarrow \\Omega _{S\'/R} \\longrightarrow 0  \\]\n\n   which is even a split short exact sequence. \n\n    \n]] the sequence is split. \n    \n      Assume the exact sequence of the lemma is split exact. Choose a splitting $\\sigma : \\Omega _{S/R} \\to \\Omega _{P/R} \\otimes _ P S$. For each $\\lambda \\in S$ choose $x_\\lambda \\in P$ which maps to $\\lambda $. Next, for each $\\lambda \\in S$ choose $f_\\lambda \\in J$ such that \n    \n      \n  \\[  \\text{d}f_\\lambda = \\text{d}x_\\lambda - \\sigma (\\text{d}\\lambda )  \\]\n\n    \n       in the middle term of the exact sequence. We claim that $s : \\lambda \\mapsto x_\\lambda - f_\\lambda \\mod J^2$ is an $R$-algebra homomorphism $s : S \\to P/J^2$. To prove this we will repeatedly use that if $h \\in J$ and $\\text{d}h = 0$ in $\\Omega _{P/R} \\otimes _ R S$, then $h \\in J^2$. Let $\\lambda , \\mu \\in S$. Then $\\sigma (\\text{d}\\lambda + \\text{d}\\mu - \\text{d}(\\lambda + \\mu )) = 0$. This implies \n    \n      \n  \\[  \\text{d}(x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu }) = 0  \\]\n\n    \n       which means that $x_\\lambda + x_\\mu - x_{\\lambda + \\mu } - f_\\lambda - f_\\mu + f_{\\lambda + \\mu } \\in J^2$, which in turn means that $s(\\lambda ) + s(\\mu ) = s(\\lambda + \\mu )$. Similarly, we have $\\sigma (\\lambda \\text{d}\\mu + \\mu \\text{d}\\lambda - \\text{d}\\lambda \\mu ) = 0$ which implies that \n    \n      \n  \\[  \\mu (\\text{d}x_\\lambda - \\text{d}f_\\lambda ) + \\lambda (\\text{d}x_\\mu - \\text{d}f_\\mu ) - \\text{d}x_{\\lambda \\mu } + \\text{d}f_{\\lambda \\mu } = 0  \\]\n\n    \n       in the middle term of the exact sequence. Moreover we have \n    \n      \n  \\[  \\text{d}(x_\\lambda x_\\mu ) = x_\\lambda \\text{d}x_\\mu + x_\\mu \\text{d}x_\\lambda = \\lambda \\text{d}x_\\mu + \\mu \\text{d} x_\\lambda  \\]\n\n    \n       in the middle term again. Combined these equations mean that $x_\\lambda x_\\mu - x_{\\lambda \\mu } - \\mu f_\\lambda - \\lambda f_\\mu + f_{\\lambda \\mu } \\in J^2$, hence $(x_\\lambda - f_\\lambda )(x_\\mu - f_\\mu ) - (x_{\\lambda \\mu } - f_{\\lambda \\mu }) \\in J^2$ as $f_\\lambda f_\\mu \\in J^2$, which means that $s(\\lambda )s(\\mu ) = s(\\lambda \\mu )$. If $\\lambda \\in R$, then $\\text{d}\\lambda = 0$ and we see that $\\text{d}f_\\lambda = \\text{d}x_\\lambda $, hence $\\lambda - x_\\lambda + f_\\lambda \\in J^2$ and hence $s(\\lambda ) = \\lambda $ as desired. At this point we can apply Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]] to conclude that $S/R$ is formally smooth. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about the equivalence between formal smoothness and the existence of a split injection condition, using `Algebra.FormallySmooth.iff_split_injection` and then transporting splittings across a linear equivalence `e : P.ker.Cotangent ‚âÉ‚Çó[P.Ring] P.Cotangent` and scalar extension/restriction. The informal proof, however, characterizes formal smoothness via existence of a section `S ‚Üí P/J^2` (Lemma 10.138.5) and then constructs such a section from a splitting of an exact sequence of K√§hler differentials, with detailed elementwise computations modulo `J^2`. Structurally, the informal argument proceeds through several lemmas about differentials, exact sequences, and an explicit construction of the section, while the Lean code is a short abstract equivalence proof about linear maps and splittings, with no construction modulo `J^2` or use of the differential identities. Thus there is some thematic overlap (formal smoothness ‚Üî splitting condition), but the specific statement and proof strategy in Lean do not correspond to the detailed construction and lemmas in the informal proof.""}"
331,00TP,"public theorem exists_finiteType [Smooth A B] :
    ‚àÉ (A‚ÇÄ : Type u) (B‚ÇÄ : Type u) (_ : CommRing A‚ÇÄ) (_ : CommRing B‚ÇÄ)
      (_ : Algebra R A‚ÇÄ) (_ : Algebra A‚ÇÄ A) (_ : Algebra A‚ÇÄ B‚ÇÄ),
      Function.Injective (algebraMap A‚ÇÄ A) ‚àß FiniteType R A‚ÇÄ ‚àß Smooth A‚ÇÄ B‚ÇÄ ‚àß
      Nonempty (B ‚âÉ‚Çê[A] A ‚äó[A‚ÇÄ] B‚ÇÄ) := by
  obtain ‚ü®A‚ÇÄ, B‚ÇÄ, _, _, hA‚ÇÄ, _, _‚ü© := exists_subalgebra_fg R A B
  use A‚ÇÄ, B‚ÇÄ, inferInstance, inferInstance, inferInstance, inferInstance, inferInstance,
    Subtype.val_injective, ‚ü®A‚ÇÄ.fg_top.mpr hA‚ÇÄ‚ü©, inferInstance
",Formal Proof of Stacks Project Tag 00TP,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Smooth/NoetherianDescent.lean#L218-L225,Q27041,,10.138.14,lemma,3.0,"['00TH', '00AO', '0ELQ']","\n  Lemma 10.138.14. Let $R \\to S$ be a smooth ring map. Then there exists a subring $R_0 \\subset R$ of finite type over $\\mathbf{Z}$ and a smooth ring map $R_0 \\to S_0$ such that $S \\cong R \\otimes _{R_0} S_0$. \n\n    \n      Proof.\n      We are going to use that smooth is equivalent to finite presentation and formally smooth, see Proposition 10.138.13. Write $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$ and denote $I = (f_1, \\ldots , f_ m)$. Choose a right inverse $\\sigma : S \\to R[x_1, \\ldots , x_ n]/I^2$ to the projection to $S$ as in Lemma 10.138.5. Choose $h_ i \\in R[x_1, \\ldots , x_ n]$ such that $\\sigma (x_ i \\bmod I) = h_ i \\bmod I^2$. Since $x_ i - h_ i \\in I$, there exist $b_{ij} \\in R[x_1, \\ldots , x_ n]$ such that \n    \n      \n  \\[  x_ i - h_ i = \\sum \\nolimits _ j b_{ij} f_ j  \\]\n\n    \n       The fact that $\\sigma $ is an $R$-algebra homomorphism $R[x_1, \\ldots , x_ n]/I \\to R[x_1, \\ldots , x_ n]/I^2$ is equivalent to the condition that \n    \n      \n  \\[  f_ j(h_1, \\ldots , h_ n) = \\sum \\nolimits _{j_1 j_2} a_{j_1 j_2} f_{j_1} f_{j_2}  \\]\n\n    \n       for certain $a_{kl} \\in R[x_1, \\ldots , x_ n]$. Let $R_0 \\subset R$ be the subring generated over $\\mathbf{Z}$ by all the coefficients of the polynomials $f_ j, h_ i, a_{kl}, b_{ij}$. Set $S_0 = R_0[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$, with $I_0 = (f_1, \\ldots , f_ m)$. Since the second displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we can let $\\sigma _0 : S_0 \\to R_0[x_1, \\ldots , x_ n]/I_0^2$ be the $R_0$-algebra map defined by the rule $x_ i \\mapsto h_ i \\bmod I_0^2$. Since the first displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we see that $\\sigma _0$ is a right inverse to the projection $R_0[x_1, \\ldots , x_ n] / I_0^2 \\to R_0[x_1, \\ldots , x_ n] / I_0 = S_0$. Thus by Lemma 10.138.5 the ring $S_0$ is formally smooth over $R_0$. \n      $\\square$\n    \n",\n  Lemma 10.138.14. Let $R \\to S$ be a smooth ring map. Then there exists a subring $R_0 \\subset R$ of finite type over $\\mathbf{Z}$ and a smooth ring map $R_0 \\to S_0$ such that $S \\cong R \\otimes _{R_0} S_0$. \n\n    \n,"Proof.\n      We are going to use that smooth is equivalent to finite presentation and formally smooth, see Proposition 10.138.13. Write $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$ and denote $I = (f_1, \\ldots , f_ m)$. Choose a right inverse $\\sigma : S \\to R[x_1, \\ldots , x_ n]/I^2$ to the projection to $S$ as in Lemma 10.138.5. Choose $h_ i \\in R[x_1, \\ldots , x_ n]$ such that $\\sigma (x_ i \\bmod I) = h_ i \\bmod I^2$. Since $x_ i - h_ i \\in I$, there exist $b_{ij} \\in R[x_1, \\ldots , x_ n]$ such that \n    \n      \n  \\[  x_ i - h_ i = \\sum \\nolimits _ j b_{ij} f_ j  \\]\n\n    \n       The fact that $\\sigma $ is an $R$-algebra homomorphism $R[x_1, \\ldots , x_ n]/I \\to R[x_1, \\ldots , x_ n]/I^2$ is equivalent to the condition that \n    \n      \n  \\[  f_ j(h_1, \\ldots , h_ n) = \\sum \\nolimits _{j_1 j_2} a_{j_1 j_2} f_{j_1} f_{j_2}  \\]\n\n    \n       for certain $a_{kl} \\in R[x_1, \\ldots , x_ n]$. Let $R_0 \\subset R$ be the subring generated over $\\mathbf{Z}$ by all the coefficients of the polynomials $f_ j, h_ i, a_{kl}, b_{ij}$. Set $S_0 = R_0[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$, with $I_0 = (f_1, \\ldots , f_ m)$. Since the second displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we can let $\\sigma _0 : S_0 \\to R_0[x_1, \\ldots , x_ n]/I_0^2$ be the $R_0$-algebra map defined by the rule $x_ i \\mapsto h_ i \\bmod I_0^2$. Since the first displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we see that $\\sigma _0$ is a right inverse to the projection $R_0[x_1, \\ldots , x_ n] / I_0^2 \\to R_0[x_1, \\ldots , x_ n] / I_0 = S_0$. Thus by Lemma 10.138.5 the ring $S_0$ is formally smooth over $R_0$. \n      $\\square$\n    \n"," by
  obtain ‚ü®A‚ÇÄ, B‚ÇÄ, _, _, hA‚ÇÄ, _, _‚ü© := exists_subalgebra_fg R A B
  use A‚ÇÄ, B‚ÇÄ, inferInstance, inferInstance, inferInstance, inferInstance, inferInstance,
    Subtype.val_injective, ‚ü®A‚ÇÄ.fg_top.mpr hA‚ÇÄ‚ü©, inferInstance
","public theorem exists_finiteType [Smooth A B] :
    ‚àÉ (A‚ÇÄ : Type u) (B‚ÇÄ : Type u) (_ : CommRing A‚ÇÄ) (_ : CommRing B‚ÇÄ)
      (_ : Algebra R A‚ÇÄ) (_ : Algebra A‚ÇÄ A) (_ : Algebra A‚ÇÄ B‚ÇÄ),
      Function.Injective (algebraMap A‚ÇÄ A) ‚àß FiniteType R A‚ÇÄ ‚àß Smooth A‚ÇÄ B‚ÇÄ ‚àß
      Nonempty (B ‚âÉ‚Çê[A] A ‚äó[A‚ÇÄ] B‚ÇÄ) ","Proof.\n      We are going to use that smooth is equivalent to finite presentation and formally smooth, see Proposition 10.138.13 [[\n  Proposition 10.138.13. Let $R \\to S$ be a ring map. The following are equivalent \n  \n  \n$R \\to S$ is of finite presentation and formally smooth, \n\n\n$R \\to S$ is smooth. \n\n\n\n\n    \n]]. Write $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$ and denote $I = (f_1, \\ldots , f_ m)$. Choose a right inverse $\\sigma : S \\to R[x_1, \\ldots , x_ n]/I^2$ to the projection to $S$ as in Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]]. Choose $h_ i \\in R[x_1, \\ldots , x_ n]$ such that $\\sigma (x_ i \\bmod I) = h_ i \\bmod I^2$. Since $x_ i - h_ i \\in I$, there exist $b_{ij} \\in R[x_1, \\ldots , x_ n]$ such that \n    \n      \n  \\[  x_ i - h_ i = \\sum \\nolimits _ j b_{ij} f_ j  \\]\n\n    \n       The fact that $\\sigma $ is an $R$-algebra homomorphism $R[x_1, \\ldots , x_ n]/I \\to R[x_1, \\ldots , x_ n]/I^2$ is equivalent to the condition that \n    \n      \n  \\[  f_ j(h_1, \\ldots , h_ n) = \\sum \\nolimits _{j_1 j_2} a_{j_1 j_2} f_{j_1} f_{j_2}  \\]\n\n    \n       for certain $a_{kl} \\in R[x_1, \\ldots , x_ n]$. Let $R_0 \\subset R$ be the subring generated over $\\mathbf{Z}$ by all the coefficients of the polynomials $f_ j, h_ i, a_{kl}, b_{ij}$. Set $S_0 = R_0[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$, with $I_0 = (f_1, \\ldots , f_ m)$. Since the second displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we can let $\\sigma _0 : S_0 \\to R_0[x_1, \\ldots , x_ n]/I_0^2$ be the $R_0$-algebra map defined by the rule $x_ i \\mapsto h_ i \\bmod I_0^2$. Since the first displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we see that $\\sigma _0$ is a right inverse to the projection $R_0[x_1, \\ldots , x_ n] / I_0^2 \\to R_0[x_1, \\ldots , x_ n] / I_0 = S_0$. Thus by Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]] the ring $S_0$ is formally smooth over $R_0$. \n      $\\square$\n    \n","Proof.\n      We are going to use that smooth is equivalent to finite presentation and formally smooth, see Proposition 10.138.13 [[\n  Proposition 10.138.13. Let $R \\to S$ be a ring map. The following are equivalent \n  \n  \n$R \\to S$ is of finite presentation and formally smooth, \n\n\n$R \\to S$ is smooth. \n\n\n\n\n    \n]]. Write $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$ and denote $I = (f_1, \\ldots , f_ m)$. Choose a right inverse $\\sigma : S \\to R[x_1, \\ldots , x_ n]/I^2$ to the projection to $S$ as in Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]]. Choose $h_ i \\in R[x_1, \\ldots , x_ n]$ such that $\\sigma (x_ i \\bmod I) = h_ i \\bmod I^2$. Since $x_ i - h_ i \\in I$, there exist $b_{ij} \\in R[x_1, \\ldots , x_ n]$ such that \n    \n      \n  \\[  x_ i - h_ i = \\sum \\nolimits _ j b_{ij} f_ j  \\]\n\n    \n       The fact that $\\sigma $ is an $R$-algebra homomorphism $R[x_1, \\ldots , x_ n]/I \\to R[x_1, \\ldots , x_ n]/I^2$ is equivalent to the condition that \n    \n      \n  \\[  f_ j(h_1, \\ldots , h_ n) = \\sum \\nolimits _{j_1 j_2} a_{j_1 j_2} f_{j_1} f_{j_2}  \\]\n\n    \n       for certain $a_{kl} \\in R[x_1, \\ldots , x_ n]$. Let $R_0 \\subset R$ be the subring generated over $\\mathbf{Z}$ by all the coefficients of the polynomials $f_ j, h_ i, a_{kl}, b_{ij}$. Set $S_0 = R_0[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ m)$, with $I_0 = (f_1, \\ldots , f_ m)$. Since the second displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we can let $\\sigma _0 : S_0 \\to R_0[x_1, \\ldots , x_ n]/I_0^2$ be the $R_0$-algebra map defined by the rule $x_ i \\mapsto h_ i \\bmod I_0^2$. Since the first displayed equation holds in $R_0[x_1, \\ldots , x_ n]$ we see that $\\sigma _0$ is a right inverse to the projection $R_0[x_1, \\ldots , x_ n] / I_0^2 \\to R_0[x_1, \\ldots , x_ n] / I_0 = S_0$. Thus by Lemma 10.138.5 [[\n  Lemma 10.138.5. Let $R \\to S$ be a ring map. Let $P \\to S$ be a surjective $R$-algebra map from a polynomial ring $P$ onto $S$. Denote $J \\subset P$ the kernel. Then $R \\to S$ is formally smooth if and only if there exists an $R$-algebra map $\\sigma : S \\to P/J^2$ which is a right inverse to the surjection $P/J^2 \\to S$. \n\n    \n]] the ring $S_0$ is formally smooth over $R_0$. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantic mismatch: the informal proof is about smoothness/formal smoothness of a finitely presented algebra, constructing a finitely generated subring R‚ÇÄ and an induced algebra S‚ÇÄ with a lifting œÉ‚ÇÄ to P/I‚ÇÄ¬≤, using specific polynomial data (f_j, h_i, a_kl, b_ij) and Lemma/Proposition equivalences. The Lean proof instead invokes `exists_subalgebra_fg R A B` to obtain finitely generated subalgebras A‚ÇÄ, B‚ÇÄ and then packages instances/injectivity and a finiteness condition (`A‚ÇÄ.fg_top.mpr hA‚ÇÄ`). Structurally, the informal argument is a detailed construction via polynomial presentations and right inverses, while the formal proof is a short existence/packaging argument about finitely generated subalgebras with no mention of smoothness, polynomial rings, or liftings. Thus the formal proof does not reflect the content or structure of the informal proof.""}"
332,00U2,"public theorem _root_.Algebra.Etale.exists_subalgebra_fg [Etale A B] :
    ‚àÉ (A‚ÇÄ : Subalgebra R A) (B‚ÇÄ : Type u) (_ : CommRing B‚ÇÄ) (_ : Algebra A‚ÇÄ B‚ÇÄ),
      A‚ÇÄ.FG ‚àß Etale A‚ÇÄ B‚ÇÄ ‚àß Nonempty (B ‚âÉ‚Çê[A] A ‚äó[A‚ÇÄ] B‚ÇÄ) := by
  simp only [Etale.iff_isStandardSmoothOfRelativeDimension_zero] at *
  exact IsStandardSmoothOfRelativeDimension.exists_subalgebra_fg ..
",Formal Proof of Stacks Project Tag 00U2,(8),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Smooth/NoetherianDescent.lean#L244-L248,Q27041,,10.143.3,lemma,3.0,"['00U0', '00AO', '0ELQ']","\n  Lemma 10.143.3. Results on \xc3\xa9tale ring maps. \n  \n  \nThe ring map $R \\to R_ f$ is \xc3\xa9tale for any ring $R$ and any $f \\in R$. \n\n\nCompositions of \xc3\xa9tale ring maps are \xc3\xa9tale. \n\n\nA base change of an \xc3\xa9tale ring map is \xc3\xa9tale. \n\n\nThe property of being \xc3\xa9tale is local: Given a ring map $R \\to S$ and elements $g_1, \\ldots , g_ m \\in S$ which generate the unit ideal such that $R \\to S_{g_ j}$ is \xc3\xa9tale for $j = 1, \\ldots , m$ then $R \\to S$ is \xc3\xa9tale. \n\n\nGiven $R \\to S$ of finite presentation, and a flat ring map $R \\to R\'$, set $S\' = R\' \\otimes _ R S$. The set of primes where $R\' \\to S\'$ is \xc3\xa9tale is the inverse image via $\\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$ of the set of primes where $R \\to S$ is \xc3\xa9tale. \n\n\nAn \xc3\xa9tale ring map is syntomic, in particular flat. \n\n\nIf $S$ is finite type over a field $k$, then $S$ is \xc3\xa9tale over $k$ if and only if $\\Omega _{S/k} = 0$. \n\n\nAny \xc3\xa9tale ring map $R \\to S$ is the base change of an \xc3\xa9tale ring map $R_0 \\to S_0$ with $R_0$ of finite type over $\\mathbf{Z}$. \n\n\nLet $A = \\mathop{\\mathrm{colim}}\\nolimits A_ i$ be a filtered colimit of rings. Let $A \\to B$ be an \xc3\xa9tale ring map. Then there exists an \xc3\xa9tale ring map $A_ i \\to B_ i$ for some $i$ such that $B \\cong A \\otimes _{A_ i} B_ i$. \n\n\nLet $A$ be a ring. Let $S$ be a multiplicative subset of $A$. Let $S^{-1}A \\to B\'$ be \xc3\xa9tale. Then there exists an \xc3\xa9tale ring map $A \\to B$ such that $B\' \\cong S^{-1}B$. \n\n\nLet $A$ be a ring. Let $B = B\' \\times B\'\'$ be a product of $A$-algebras. Then $B$ is \xc3\xa9tale over $A$ if and only if both $B\'$ and $B\'\'$ are \xc3\xa9tale over $A$. \n\n\n\n\n    \n      Proof.\n      In each case we use the corresponding result for smooth ring maps with a small argument added to show that $\\Omega _{S/R}$ is zero. \n    \n      Proof of (1). The ring map $R \\to R_ f$ is smooth and $\\Omega _{R_ f/R} = 0$. \n    \n      Proof of (2). The composition $A \\to C$ of smooth maps $A \\to B$ and $B \\to C$ is smooth, see Lemma 10.137.13. By Lemma 10.131.7 we see that $\\Omega _{C/A}$ is zero as both $\\Omega _{C/B}$ and $\\Omega _{B/A}$ are zero. \n    \n      Proof of (3). Let $R \\to S$ be \xc3\xa9tale and $R \\to R\'$ be arbitrary. Then $R\' \\to S\' = R\' \\otimes _ R S$ is smooth, see Lemma 10.137.3. Since $\\Omega _{S\'/R\'} = S\' \\otimes _ S \\Omega _{S/R}$ by Lemma 10.131.12 we conclude that $\\Omega _{S\'/R\'} = 0$. Hence $R\' \\to S\'$ is \xc3\xa9tale. \n    \n      Proof of (4). Assume the hypotheses of (4). By Lemma 10.137.12 we see that $R \\to S$ is smooth. We are also given that $\\Omega _{S_{g_ i}/R} = (\\Omega _{S/R})_{g_ i} = 0$ for all $i$. Then $\\Omega _{S/R} = 0$, see Lemma 10.23.2. \n    \n      Proof of (5). The result for smooth maps is Lemma 10.137.17. In the proof of that lemma we used that $\\mathop{N\\! L}\\nolimits _{S/R} \\otimes _ S S\'$ is homotopy equivalent to $\\mathop{N\\! L}\\nolimits _{S\'/R\'}$. This reduces us to showing that if $M$ is a finitely presented $S$-module the set of primes $\\mathfrak q\'$ of $S\'$ such that $(M \\otimes _ S S\')_{\\mathfrak q\'} = 0$ is the inverse image of the set of primes $\\mathfrak q$ of $S$ such that $M_{\\mathfrak q} = 0$. This follows from Lemma 10.40.6. \n    \n      Proof of (6). Follows directly from the corresponding result for smooth ring maps (Lemma 10.137.9). \n    \n      Proof of (7). Follows from Lemma 10.140.3 and the definitions. \n    \n      Proof of (8). Lemma 10.138.14 gives the result for smooth ring maps. The resulting smooth ring map $R_0 \\to S_0$ satisfies the hypotheses of Lemma 10.130.8, and hence we may replace $S_0$ by the factor of relative dimension $0$ over $R_0$. \n    \n      Proof of (9). Follows from (8) since $R_0 \\to A$ will factor through $A_ i$ for some $i$ by Lemma 10.127.3. \n    \n      Proof of (10). Follows from (9), (1), and (2) since $S^{-1}A$ is a filtered colimit of principal localizations of $A$. \n    \n      Proof of (11). Use Lemma 10.137.14 to see the result for smoothness and then use that $\\Omega _{B/A}$ is zero if and only if both $\\Omega _{B\'/A}$ and $\\Omega _{B\'\'/A}$ are zero. \n      $\\square$\n    \n","\n  Lemma 10.143.3. Results on \xc3\xa9tale ring maps. \n  \n  \nThe ring map $R \\to R_ f$ is \xc3\xa9tale for any ring $R$ and any $f \\in R$. \n\n\nCompositions of \xc3\xa9tale ring maps are \xc3\xa9tale. \n\n\nA base change of an \xc3\xa9tale ring map is \xc3\xa9tale. \n\n\nThe property of being \xc3\xa9tale is local: Given a ring map $R \\to S$ and elements $g_1, \\ldots , g_ m \\in S$ which generate the unit ideal such that $R \\to S_{g_ j}$ is \xc3\xa9tale for $j = 1, \\ldots , m$ then $R \\to S$ is \xc3\xa9tale. \n\n\nGiven $R \\to S$ of finite presentation, and a flat ring map $R \\to R\'$, set $S\' = R\' \\otimes _ R S$. The set of primes where $R\' \\to S\'$ is \xc3\xa9tale is the inverse image via $\\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$ of the set of primes where $R \\to S$ is \xc3\xa9tale. \n\n\nAn \xc3\xa9tale ring map is syntomic, in particular flat. \n\n\nIf $S$ is finite type over a field $k$, then $S$ is \xc3\xa9tale over $k$ if and only if $\\Omega _{S/k} = 0$. \n\n\nAny \xc3\xa9tale ring map $R \\to S$ is the base change of an \xc3\xa9tale ring map $R_0 \\to S_0$ with $R_0$ of finite type over $\\mathbf{Z}$. \n\n\nLet $A = \\mathop{\\mathrm{colim}}\\nolimits A_ i$ be a filtered colimit of rings. Let $A \\to B$ be an \xc3\xa9tale ring map. Then there exists an \xc3\xa9tale ring map $A_ i \\to B_ i$ for some $i$ such that $B \\cong A \\otimes _{A_ i} B_ i$. \n\n\nLet $A$ be a ring. Let $S$ be a multiplicative subset of $A$. Let $S^{-1}A \\to B\'$ be \xc3\xa9tale. Then there exists an \xc3\xa9tale ring map $A \\to B$ such that $B\' \\cong S^{-1}B$. \n\n\nLet $A$ be a ring. Let $B = B\' \\times B\'\'$ be a product of $A$-algebras. Then $B$ is \xc3\xa9tale over $A$ if and only if both $B\'$ and $B\'\'$ are \xc3\xa9tale over $A$. \n\n\n\n\n    \n","Proof.\n      In each case we use the corresponding result for smooth ring maps with a small argument added to show that $\\Omega _{S/R}$ is zero. \n    \n      Proof of (1). The ring map $R \\to R_ f$ is smooth and $\\Omega _{R_ f/R} = 0$. \n    \n      Proof of (2). The composition $A \\to C$ of smooth maps $A \\to B$ and $B \\to C$ is smooth, see Lemma 10.137.13. By Lemma 10.131.7 we see that $\\Omega _{C/A}$ is zero as both $\\Omega _{C/B}$ and $\\Omega _{B/A}$ are zero. \n    \n      Proof of (3). Let $R \\to S$ be \xc3\xa9tale and $R \\to R\'$ be arbitrary. Then $R\' \\to S\' = R\' \\otimes _ R S$ is smooth, see Lemma 10.137.3. Since $\\Omega _{S\'/R\'} = S\' \\otimes _ S \\Omega _{S/R}$ by Lemma 10.131.12 we conclude that $\\Omega _{S\'/R\'} = 0$. Hence $R\' \\to S\'$ is \xc3\xa9tale. \n    \n      Proof of (4). Assume the hypotheses of (4). By Lemma 10.137.12 we see that $R \\to S$ is smooth. We are also given that $\\Omega _{S_{g_ i}/R} = (\\Omega _{S/R})_{g_ i} = 0$ for all $i$. Then $\\Omega _{S/R} = 0$, see Lemma 10.23.2. \n    \n      Proof of (5). The result for smooth maps is Lemma 10.137.17. In the proof of that lemma we used that $\\mathop{N\\! L}\\nolimits _{S/R} \\otimes _ S S\'$ is homotopy equivalent to $\\mathop{N\\! L}\\nolimits _{S\'/R\'}$. This reduces us to showing that if $M$ is a finitely presented $S$-module the set of primes $\\mathfrak q\'$ of $S\'$ such that $(M \\otimes _ S S\')_{\\mathfrak q\'} = 0$ is the inverse image of the set of primes $\\mathfrak q$ of $S$ such that $M_{\\mathfrak q} = 0$. This follows from Lemma 10.40.6. \n    \n      Proof of (6). Follows directly from the corresponding result for smooth ring maps (Lemma 10.137.9). \n    \n      Proof of (7). Follows from Lemma 10.140.3 and the definitions. \n    \n      Proof of (8). Lemma 10.138.14 gives the result for smooth ring maps. The resulting smooth ring map $R_0 \\to S_0$ satisfies the hypotheses of Lemma 10.130.8, and hence we may replace $S_0$ by the factor of relative dimension $0$ over $R_0$. \n    \n      Proof of (9). Follows from (8) since $R_0 \\to A$ will factor through $A_ i$ for some $i$ by Lemma 10.127.3. \n    \n      Proof of (10). Follows from (9), (1), and (2) since $S^{-1}A$ is a filtered colimit of principal localizations of $A$. \n    \n      Proof of (11). Use Lemma 10.137.14 to see the result for smoothness and then use that $\\Omega _{B/A}$ is zero if and only if both $\\Omega _{B\'/A}$ and $\\Omega _{B\'\'/A}$ are zero. \n      $\\square$\n    \n"," by
  simp only [Etale.iff_isStandardSmoothOfRelativeDimension_zero] at *
  exact IsStandardSmoothOfRelativeDimension.exists_subalgebra_fg ..
","public theorem _root_.Algebra.Etale.exists_subalgebra_fg [Etale A B] :
    ‚àÉ (A‚ÇÄ : Subalgebra R A) (B‚ÇÄ : Type u) (_ : CommRing B‚ÇÄ) (_ : Algebra A‚ÇÄ B‚ÇÄ),
      A‚ÇÄ.FG ‚àß Etale A‚ÇÄ B‚ÇÄ ‚àß Nonempty (B ‚âÉ‚Çê[A] A ‚äó[A‚ÇÄ] B‚ÇÄ) ","Proof.\n      In each case we use the corresponding result for smooth ring maps with a small argument added to show that $\\Omega _{S/R}$ is zero. \n    \n      Proof of (1). The ring map $R \\to R_ f$ is smooth and $\\Omega _{R_ f/R} = 0$. \n    \n      Proof of (2). The composition $A \\to C$ of smooth maps $A \\to B$ and $B \\to C$ is smooth, see Lemma 10.137.13 [[\n  Lemma 10.137.13. A composition of smooth ring maps is smooth. \n\n    \n]]. By Lemma 10.131.7 [[\n  Lemma 10.131.7. Let $A \\to B \\to C$ be ring maps. Then there is a canonical exact sequence \n  \n  \\[  C \\otimes _ B \\Omega _{B/A} \\to \\Omega _{C/A} \\to \\Omega _{C/B} \\to 0  \\]\n\n   of $C$-modules. \n\n    \n]] we see that $\\Omega _{C/A}$ is zero as both $\\Omega _{C/B}$ and $\\Omega _{B/A}$ are zero. \n    \n      Proof of (3). Let $R \\to S$ be \xc3\xa9tale and $R \\to R\'$ be arbitrary. Then $R\' \\to S\' = R\' \\otimes _ R S$ is smooth, see Lemma 10.137.3 [[\n       \n      \n  Lemma 10.137.3. Let $R \\to S$ be a smooth ring map. Let $R \\to R\'$ be any ring map. Then the base change $R\' \\to S\' = R\' \\otimes _ R S$ is smooth. \n\n    \n]]. Since $\\Omega _{S\'/R\'} = S\' \\otimes _ S \\Omega _{S/R}$ by Lemma 10.131.12 [[\n  Lemma 10.131.12. Suppose that we have ring maps $R \\to R\'$ and $R \\to S$. Set $S\' = S \\otimes _ R R\'$, so that we obtain a diagram (10.131.4.1). Then the canonical map defined above induces an isomorphism $\\Omega _{S/R} \\otimes _ R R\' = \\Omega _{S\'/R\'}$. \n\n    \n]] we conclude that $\\Omega _{S\'/R\'} = 0$. Hence $R\' \\to S\'$ is \xc3\xa9tale. \n    \n      Proof of (4). Assume the hypotheses of (4). By Lemma 10.137.12 [[\n       \n      \n  Lemma 10.137.12. Let $R \\to S$ be a ring map. Then $R \\to S$ is smooth if and only if $R \\to S$ is smooth at every prime $\\mathfrak q$ of $S$. \n\n    \n]] we see that $R \\to S$ is smooth. We are also given that $\\Omega _{S_{g_ i}/R} = (\\Omega _{S/R})_{g_ i} = 0$ for all $i$. Then $\\Omega _{S/R} = 0$, see Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]]. \n    \n      Proof of (5). The result for smooth maps is Lemma 10.137.17 [[\n  Lemma 10.137.17. Let $R \\to S$ be a ring map of finite presentation. Let $R \\to R\'$ be a flat ring map. Denote $S\' = R\' \\otimes _ R S$ the base change. Let $U \\subset \\mathop{\\mathrm{Spec}}(S)$ be the set of primes at which $R \\to S$ is smooth. Let $V \\subset \\mathop{\\mathrm{Spec}}(S\')$ the set of primes at which $R\' \\to S\'$ is smooth. Then $V$ is the inverse image of $U$ under the map $f : \\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$. \n\n    \n]]. In the proof of that lemma we used that $\\mathop{N\\! L}\\nolimits _{S/R} \\otimes _ S S\'$ is homotopy equivalent to $\\mathop{N\\! L}\\nolimits _{S\'/R\'}$. This reduces us to showing that if $M$ is a finitely presented $S$-module the set of primes $\\mathfrak q\'$ of $S\'$ such that $(M \\otimes _ S S\')_{\\mathfrak q\'} = 0$ is the inverse image of the set of primes $\\mathfrak q$ of $S$ such that $M_{\\mathfrak q} = 0$. This follows from Lemma 10.40.6 [[\n  Lemma 10.40.6. Let $R \\to R\'$ be a ring map and let $M$ be a finite $R$-module. Then $\\text{Supp}(M \\otimes _ R R\')$ is the inverse image of $\\text{Supp}(M)$. \n\n    \n]]. \n    \n      Proof of (6). Follows directly from the corresponding result for smooth ring maps (Lemma 10.137.9 [[\n  Lemma 10.137.9. Let $R \\to S$ be a smooth ring map. There exists an open covering of $\\mathop{\\mathrm{Spec}}(S)$ by standard opens $D(g)$ such that each $S_ g$ is standard smooth over $R$. In particular $R \\to S$ is syntomic. \n\n    \n]]). \n    \n      Proof of (7). Follows from Lemma 10.140.3 [[\n  Lemma 10.140.3. Let $k$ be any field. Let $S$ be a finite type $k$-algebra. Let $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$. The following are equivalent: \n  \n  \nThe $k$-algebra $S$ is smooth at $\\mathfrak q$ over $k$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) \\leq \\dim _ x X$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) = \\dim _ x X$. \n\n\n\n   Moreover, in this case the local ring $S_{\\mathfrak q}$ is regular. \n\n    \n]] and the definitions. \n    \n      Proof of (8). Lemma 10.138.14 [[\n  Lemma 10.138.14. Let $R \\to S$ be a smooth ring map. Then there exists a subring $R_0 \\subset R$ of finite type over $\\mathbf{Z}$ and a smooth ring map $R_0 \\to S_0$ such that $S \\cong R \\otimes _{R_0} S_0$. \n\n    \n]] gives the result for smooth ring maps. The resulting smooth ring map $R_0 \\to S_0$ satisfies the hypotheses of Lemma 10.130.8 [[\n  Lemma 10.130.8. Let $R$ be a ring. Let $R \\to S$ be a ring map which is (a) flat, (b) of finite presentation, (c) has Cohen-Macaulay fibres. Then we can write $S = S_0 \\times \\ldots \\times S_ n$ as a product of $R$-algebras $S_ d$ such that each $S_ d$ satisfies (a), (b), (c) and has all fibres equidimensional of dimension $d$. \n\n    \n]], and hence we may replace $S_0$ by the factor of relative dimension $0$ over $R_0$. \n    \n      Proof of (9). Follows from (8) since $R_0 \\to A$ will factor through $A_ i$ for some $i$ by Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]]. \n    \n      Proof of (10). Follows from (9), (1), and (2) since $S^{-1}A$ is a filtered colimit of principal localizations of $A$. \n    \n      Proof of (11). Use Lemma 10.137.14 [[\n  Lemma 10.137.14. Let $R$ be a ring. Let $S = S\' \\times S\'\'$ be a product of $R$-algebras. Then $S$ is smooth over $R$ if and only if both $S\'$ and $S\'\'$ are smooth over $R$. \n\n    \n]] to see the result for smoothness and then use that $\\Omega _{B/A}$ is zero if and only if both $\\Omega _{B\'/A}$ and $\\Omega _{B\'\'/A}$ are zero. \n      $\\square$\n    \n","Proof.\n      In each case we use the corresponding result for smooth ring maps with a small argument added to show that $\\Omega _{S/R}$ is zero. \n    \n      Proof of (1). The ring map $R \\to R_ f$ is smooth and $\\Omega _{R_ f/R} = 0$. \n    \n      Proof of (2). The composition $A \\to C$ of smooth maps $A \\to B$ and $B \\to C$ is smooth, see Lemma 10.137.13 [[\n  Lemma 10.137.13. A composition of smooth ring maps is smooth. \n\n    \n]]. By Lemma 10.131.7 [[\n  Lemma 10.131.7. Let $A \\to B \\to C$ be ring maps. Then there is a canonical exact sequence \n  \n  \\[  C \\otimes _ B \\Omega _{B/A} \\to \\Omega _{C/A} \\to \\Omega _{C/B} \\to 0  \\]\n\n   of $C$-modules. \n\n    \n]] we see that $\\Omega _{C/A}$ is zero as both $\\Omega _{C/B}$ and $\\Omega _{B/A}$ are zero. \n    \n      Proof of (3). Let $R \\to S$ be \xc3\xa9tale and $R \\to R\'$ be arbitrary. Then $R\' \\to S\' = R\' \\otimes _ R S$ is smooth, see Lemma 10.137.3 [[\n       \n      \n  Lemma 10.137.3. Let $R \\to S$ be a smooth ring map. Let $R \\to R\'$ be any ring map. Then the base change $R\' \\to S\' = R\' \\otimes _ R S$ is smooth. \n\n    \n]]. Since $\\Omega _{S\'/R\'} = S\' \\otimes _ S \\Omega _{S/R}$ by Lemma 10.131.12 [[\n  Lemma 10.131.12. Suppose that we have ring maps $R \\to R\'$ and $R \\to S$. Set $S\' = S \\otimes _ R R\'$, so that we obtain a diagram (10.131.4.1). Then the canonical map defined above induces an isomorphism $\\Omega _{S/R} \\otimes _ R R\' = \\Omega _{S\'/R\'}$. \n\n    \n]] we conclude that $\\Omega _{S\'/R\'} = 0$. Hence $R\' \\to S\'$ is \xc3\xa9tale. \n    \n      Proof of (4). Assume the hypotheses of (4). By Lemma 10.137.12 [[\n       \n      \n  Lemma 10.137.12. Let $R \\to S$ be a ring map. Then $R \\to S$ is smooth if and only if $R \\to S$ is smooth at every prime $\\mathfrak q$ of $S$. \n\n    \n]] we see that $R \\to S$ is smooth. We are also given that $\\Omega _{S_{g_ i}/R} = (\\Omega _{S/R})_{g_ i} = 0$ for all $i$. Then $\\Omega _{S/R} = 0$, see Lemma 10.23.2 [[\n       \n      \n  Lemma 10.23.2. Let $R$ be a ring. Let $M$ be an $R$-module. Let $S$ be an $R$-algebra. Suppose that $f_1, \\ldots , f_ n$ is a finite list of elements of $R$ such that $\\bigcup D(f_ i) = \\mathop{\\mathrm{Spec}}(R)$, in other words $(f_1, \\ldots , f_ n) = R$. \n  \n  \nIf each $M_{f_ i} = 0$ then $M = 0$. \n\n\nIf each $M_{f_ i}$ is a finite $R_{f_ i}$-module, then $M$ is a finite $R$-module. \n\n\nIf each $M_{f_ i}$ is a finitely presented $R_{f_ i}$-module, then $M$ is a finitely presented $R$-module. \n\n\nLet $M \\to N$ be a map of $R$-modules. If $M_{f_ i} \\to N_{f_ i}$ is an isomorphism for each $i$ then $M \\to N$ is an isomorphism. \n\n\nLet $0 \\to M\'\' \\to M \\to M\' \\to 0$ be a complex of $R$-modules. If $0 \\to M\'\'_{f_ i} \\to M_{f_ i} \\to M\'_{f_ i} \\to 0$ is exact for each $i$, then $0 \\to M\'\' \\to M \\to M\' \\to 0$ is exact. \n\n\nIf each $R_{f_ i}$ is Noetherian, then $R$ is Noetherian. \n\n\nIf each $S_{f_ i}$ is a finite type $R_{f_ i}$-algebra, then $S$ is a finite type $R$-algebra. \n\n\nIf each $S_{f_ i}$ is of finite presentation over $R_{f_ i}$, then $S$ is a finitely presented $R$-algebra. \n\n\n\n\n    \n]]. \n    \n      Proof of (5). The result for smooth maps is Lemma 10.137.17 [[\n  Lemma 10.137.17. Let $R \\to S$ be a ring map of finite presentation. Let $R \\to R\'$ be a flat ring map. Denote $S\' = R\' \\otimes _ R S$ the base change. Let $U \\subset \\mathop{\\mathrm{Spec}}(S)$ be the set of primes at which $R \\to S$ is smooth. Let $V \\subset \\mathop{\\mathrm{Spec}}(S\')$ the set of primes at which $R\' \\to S\'$ is smooth. Then $V$ is the inverse image of $U$ under the map $f : \\mathop{\\mathrm{Spec}}(S\') \\to \\mathop{\\mathrm{Spec}}(S)$. \n\n    \n]]. In the proof of that lemma we used that $\\mathop{N\\! L}\\nolimits _{S/R} \\otimes _ S S\'$ is homotopy equivalent to $\\mathop{N\\! L}\\nolimits _{S\'/R\'}$. This reduces us to showing that if $M$ is a finitely presented $S$-module the set of primes $\\mathfrak q\'$ of $S\'$ such that $(M \\otimes _ S S\')_{\\mathfrak q\'} = 0$ is the inverse image of the set of primes $\\mathfrak q$ of $S$ such that $M_{\\mathfrak q} = 0$. This follows from Lemma 10.40.6 [[\n  Lemma 10.40.6. Let $R \\to R\'$ be a ring map and let $M$ be a finite $R$-module. Then $\\text{Supp}(M \\otimes _ R R\')$ is the inverse image of $\\text{Supp}(M)$. \n\n    \n]]. \n    \n      Proof of (6). Follows directly from the corresponding result for smooth ring maps (Lemma 10.137.9 [[\n  Lemma 10.137.9. Let $R \\to S$ be a smooth ring map. There exists an open covering of $\\mathop{\\mathrm{Spec}}(S)$ by standard opens $D(g)$ such that each $S_ g$ is standard smooth over $R$. In particular $R \\to S$ is syntomic. \n\n    \n]]). \n    \n      Proof of (7). Follows from Lemma 10.140.3 [[\n  Lemma 10.140.3. Let $k$ be any field. Let $S$ be a finite type $k$-algebra. Let $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$. The following are equivalent: \n  \n  \nThe $k$-algebra $S$ is smooth at $\\mathfrak q$ over $k$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) \\leq \\dim _ x X$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) = \\dim _ x X$. \n\n\n\n   Moreover, in this case the local ring $S_{\\mathfrak q}$ is regular. \n\n    \n]] and the definitions. \n    \n      Proof of (8). Lemma 10.138.14 [[\n  Lemma 10.138.14. Let $R \\to S$ be a smooth ring map. Then there exists a subring $R_0 \\subset R$ of finite type over $\\mathbf{Z}$ and a smooth ring map $R_0 \\to S_0$ such that $S \\cong R \\otimes _{R_0} S_0$. \n\n    \n]] gives the result for smooth ring maps. The resulting smooth ring map $R_0 \\to S_0$ satisfies the hypotheses of Lemma 10.130.8 [[\n  Lemma 10.130.8. Let $R$ be a ring. Let $R \\to S$ be a ring map which is (a) flat, (b) of finite presentation, (c) has Cohen-Macaulay fibres. Then we can write $S = S_0 \\times \\ldots \\times S_ n$ as a product of $R$-algebras $S_ d$ such that each $S_ d$ satisfies (a), (b), (c) and has all fibres equidimensional of dimension $d$. \n\n    \n]], and hence we may replace $S_0$ by the factor of relative dimension $0$ over $R_0$. \n    \n      Proof of (9). Follows from (8) since $R_0 \\to A$ will factor through $A_ i$ for some $i$ by Lemma 10.127.3 [[\n  Lemma 10.127.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent \n  \n  \n$\\varphi $ is of finite presentation, \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is bijective, and \n\n\nfor every directed system $A_\\lambda $ of $R$-algebras the map \n\n\n  \\[  \\mathop{\\mathrm{colim}}\\nolimits _\\lambda \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, A_\\lambda ) \\longrightarrow \\mathop{\\mathrm{Hom}}\\nolimits _ R(S, \\mathop{\\mathrm{colim}}\\nolimits _\\lambda A_\\lambda )  \\]\n\n\n is surjective. \n\n\n\n\n    \n]]. \n    \n      Proof of (10). Follows from (9), (1), and (2) since $S^{-1}A$ is a filtered colimit of principal localizations of $A$. \n    \n      Proof of (11). Use Lemma 10.137.14 [[\n  Lemma 10.137.14. Let $R$ be a ring. Let $S = S\' \\times S\'\'$ be a product of $R$-algebras. Then $S$ is smooth over $R$ if and only if both $S\'$ and $S\'\'$ are smooth over $R$. \n\n    \n]] to see the result for smoothness and then use that $\\Omega _{B/A}$ is zero if and only if both $\\Omega _{B\'/A}$ and $\\Omega _{B\'\'/A}$ are zero. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (8)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about rewriting the definition of `Etale` as ‚Äústandard smooth of relative dimension 0‚Äù (via `Etale.iff_isStandardSmoothOfRelativeDimension_zero`) and then applying an existence lemma `IsStandardSmoothOfRelativeDimension.exists_subalgebra_fg`. This matches only a very high-level theme of the informal proof (√©tale = smooth + vanishing differentials / relative dimension 0), but it does not reflect the specific content of informal item (8), which is about spreading out a smooth map to a finite type Z-subalgebra and then taking the relative dimension 0 factor. Structurally, the informal proof (8) uses two substantial lemmas (spreading out smooth maps and decomposition by relative dimension) and an argument about replacing by the dimension-0 factor, whereas the Lean proof is a two-line `simp` + `exact` with no visible analogue of those steps. The Lean proof is therefore likely proving a different lemma (a characterization/existence statement for √©tale maps) rather than the detailed ‚Äúspreading out and factor of relative dimension 0‚Äù argument in (8).""}"
333,00T7,"instance free_cotangent : Module.Free S P.toExtension.Cotangent :=
  Module.Free.of_basis P.basisCotangent
",Formal Proof of Stacks Project Tag 00T7,(3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Smooth/StandardSmoothCotangent.lean#L153-L154,Q27041,,10.137.6,lemma,3.0,"['00T1', '00AO', '0ELQ']","\n  Lemma 10.137.6. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c) = R[x_1, \\ldots , x_ n]/I$ be a standard smooth algebra. Then \n  \n  \nthe ring map $R \\to S$ is smooth, \n\n\nthe $S$-module $\\Omega _{S/R}$ is free on $\\text{d}x_{c + 1}, \\ldots , \\text{d}x_ n$, \n\n\nthe $S$-module $I/I^2$ is free on the classes of $f_1, \\ldots , f_ c$, \n\n\nfor any $g \\in S$ the ring map $R \\to S_ g$ is standard smooth, \n\n\nfor any ring map $R \\to R\'$ the base change $R\' \\to R\'\\otimes _ R S$ is standard smooth, \n\n\nif $f \\in R$ maps to an invertible element in $S$, then $R_ f \\to S$ is standard smooth, and \n\n\nthe ring $S$ is a relative global complete intersection over $R$. \n\n\n\n\n    \n      Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 for example. \n      $\\square$\n    \n","\n  Lemma 10.137.6. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c) = R[x_1, \\ldots , x_ n]/I$ be a standard smooth algebra. Then \n  \n  \nthe ring map $R \\to S$ is smooth, \n\n\nthe $S$-module $\\Omega _{S/R}$ is free on $\\text{d}x_{c + 1}, \\ldots , \\text{d}x_ n$, \n\n\nthe $S$-module $I/I^2$ is free on the classes of $f_1, \\ldots , f_ c$, \n\n\nfor any $g \\in S$ the ring map $R \\to S_ g$ is standard smooth, \n\n\nfor any ring map $R \\to R\'$ the base change $R\' \\to R\'\\otimes _ R S$ is standard smooth, \n\n\nif $f \\in R$ maps to an invertible element in $S$, then $R_ f \\to S$ is standard smooth, and \n\n\nthe ring $S$ is a relative global complete intersection over $R$. \n\n\n\n\n    \n","Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 for example. \n      $\\square$\n    \n","
  Module.Free.of_basis P.basisCotangent
",instance free_cotangent : Module.Free S P.toExtension.Cotangent ,"Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9 [[\n  Lemma 10.136.9. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ be a relative global complete intersection (Definition 10.136.5) \n  \n  \nFor any $R \\to R\'$ the base change $R\' \\otimes _ R S = R\'[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection. \n\n\nFor any $g \\in S$ which is the image of $h \\in R[x_1, \\ldots , x_ n]$ the ring $S_ g = R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, hx_{n + 1} - 1)$ is a relative global complete intersection. \n\n\nIf $R \\to S$ factors as $R \\to R_ f \\to S$ for some $f \\in R$. Then the ring $S = R_ f[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection over $R_ f$. \n\n\n\n\n    \n]]. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 [[\n  Definition 10.137.5. Let $R$ be a ring. Given integers $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ we say \n  \n  \\[  R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)  \\]\n\n   is a standard smooth algebra over $R$ if the polynomial \n  \n  \\[  g = \\det \\left( \\begin{matrix}  \\partial f_1/\\partial x_1 \n\n&  \\partial f_2/\\partial x_1 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_1 \n\n\\\\  \\partial f_1/\\partial x_2 \n\n&  \\partial f_2/\\partial x_2 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_2 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  \\partial f_1/\\partial x_ c \n\n&  \\partial f_2/\\partial x_ c \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_ c \n\n\\end{matrix} \\right)  \\]\n\n   maps to an invertible element in $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$. We say an $R$-algebra $S$ is standard smooth or that the ring map $R \\to S$ is standard smooth if there exist $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ such that $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a standard smooth algebra over $R$ and $S$ is isomorphic to $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ as an $R$-algebra. \n]] for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4 [[\n  Lemma 10.137.4. Let $k$ be a field. Let $S$ be a smooth $k$-algebra. Then $S$ is a local complete intersection. \n\n    \n]]. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 [[\n  Lemma 10.135.4. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Let $\\mathfrak q$ be a prime of $S$. Choose any presentation $S = k[x_1, \\ldots , x_ n]/I$. Let $\\mathfrak q\'$ be the prime of $k[x_1, \\ldots , x_ n]$ corresponding to $\\mathfrak q$. Set $c = \\text{height}(\\mathfrak q\') - \\text{height}(\\mathfrak q)$, in other words $\\dim _{\\mathfrak q}(S) = n - c$ (see Lemma 10.116.4). The following are equivalent \n  \n  \nThere exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $S_ g$ is a global complete intersection over $k$. \n\n\nThe ideal $I_{\\mathfrak q\'} \\subset k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$ can be generated by $c$ elements. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ can be generated by $c$ elements over $S_{\\mathfrak q}$. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ is a free $S_{\\mathfrak q}$-module of rank $c$. \n\n\nThe ideal $I_{\\mathfrak q\'}$ can be generated by a regular sequence in the regular local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n\n\n   In this case any $c$ elements of $I_{\\mathfrak q\'}$ which generate $I_{\\mathfrak q\'}/\\mathfrak q\'I_{\\mathfrak q\'}$ form a regular sequence in the local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n    \n]] for example. \n      $\\square$\n    \n","Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9 [[\n  Lemma 10.136.9. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ be a relative global complete intersection (Definition 10.136.5) \n  \n  \nFor any $R \\to R\'$ the base change $R\' \\otimes _ R S = R\'[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection. \n\n\nFor any $g \\in S$ which is the image of $h \\in R[x_1, \\ldots , x_ n]$ the ring $S_ g = R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, hx_{n + 1} - 1)$ is a relative global complete intersection. \n\n\nIf $R \\to S$ factors as $R \\to R_ f \\to S$ for some $f \\in R$. Then the ring $S = R_ f[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection over $R_ f$. \n\n\n\n\n    \n]]. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 [[\n  Definition 10.137.5. Let $R$ be a ring. Given integers $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ we say \n  \n  \\[  R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)  \\]\n\n   is a standard smooth algebra over $R$ if the polynomial \n  \n  \\[  g = \\det \\left( \\begin{matrix}  \\partial f_1/\\partial x_1 \n\n&  \\partial f_2/\\partial x_1 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_1 \n\n\\\\  \\partial f_1/\\partial x_2 \n\n&  \\partial f_2/\\partial x_2 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_2 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  \\partial f_1/\\partial x_ c \n\n&  \\partial f_2/\\partial x_ c \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_ c \n\n\\end{matrix} \\right)  \\]\n\n   maps to an invertible element in $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$. We say an $R$-algebra $S$ is standard smooth or that the ring map $R \\to S$ is standard smooth if there exist $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ such that $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a standard smooth algebra over $R$ and $S$ is isomorphic to $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ as an $R$-algebra. \n]] for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4 [[\n  Lemma 10.137.4. Let $k$ be a field. Let $S$ be a smooth $k$-algebra. Then $S$ is a local complete intersection. \n\n    \n]]. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 [[\n  Lemma 10.135.4. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Let $\\mathfrak q$ be a prime of $S$. Choose any presentation $S = k[x_1, \\ldots , x_ n]/I$. Let $\\mathfrak q\'$ be the prime of $k[x_1, \\ldots , x_ n]$ corresponding to $\\mathfrak q$. Set $c = \\text{height}(\\mathfrak q\') - \\text{height}(\\mathfrak q)$, in other words $\\dim _{\\mathfrak q}(S) = n - c$ (see Lemma 10.116.4). The following are equivalent \n  \n  \nThere exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $S_ g$ is a global complete intersection over $k$. \n\n\nThe ideal $I_{\\mathfrak q\'} \\subset k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$ can be generated by $c$ elements. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ can be generated by $c$ elements over $S_{\\mathfrak q}$. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ is a free $S_{\\mathfrak q}$-module of rank $c$. \n\n\nThe ideal $I_{\\mathfrak q\'}$ can be generated by a regular sequence in the regular local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n\n\n   In this case any $c$ elements of $I_{\\mathfrak q\'}$ which generate $I_{\\mathfrak q\'}/\\mathfrak q\'I_{\\mathfrak q\'}$ form a regular sequence in the local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n    \n]] for example. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof is about standard smooth algebras/cotangent complexes: it analyzes the naive cotangent complex for a presentation S = R[x]/(f), shows I/I^2 is free of rank c and Œ©_{S/R} is free of rank n‚àíc, and derives smoothness plus stability under base change/localization and a dimension statement. The formal proof, however, is just `Module.Free.of_basis P.basisCotangent`, which merely asserts freeness of some module from an already-provided basis (presumably the cotangent module) and does not encode the cotangent-complex argument, the projection to the first c summands, the identification of bases via the Jacobian condition, nor the additional claims (base change, localization, dimension). Structurally, the informal proof is multi-step and uses specific algebraic geometry lemmas, while the Lean proof is a one-line application of a generic module lemma. There is partial semantic overlap only insofar as both conclude a module is free given a basis, but most of the informal content is absent, so alignment is low.""}"
334,00T7,"theorem free_kaehlerDifferential (P : SubmersivePresentation R S Œπ œÉ) :
    Module.Free S Œ©[S‚ÅÑR] :=
  Module.Free.of_basis P.basisKaehler
",Formal Proof of Stacks Project Tag 00T7,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Smooth/StandardSmoothCotangent.lean#L236-L238,Q27041,,10.137.6,lemma,3.0,"['00T1', '00AO', '0ELQ']","\n  Lemma 10.137.6. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c) = R[x_1, \\ldots , x_ n]/I$ be a standard smooth algebra. Then \n  \n  \nthe ring map $R \\to S$ is smooth, \n\n\nthe $S$-module $\\Omega _{S/R}$ is free on $\\text{d}x_{c + 1}, \\ldots , \\text{d}x_ n$, \n\n\nthe $S$-module $I/I^2$ is free on the classes of $f_1, \\ldots , f_ c$, \n\n\nfor any $g \\in S$ the ring map $R \\to S_ g$ is standard smooth, \n\n\nfor any ring map $R \\to R\'$ the base change $R\' \\to R\'\\otimes _ R S$ is standard smooth, \n\n\nif $f \\in R$ maps to an invertible element in $S$, then $R_ f \\to S$ is standard smooth, and \n\n\nthe ring $S$ is a relative global complete intersection over $R$. \n\n\n\n\n    \n      Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 for example. \n      $\\square$\n    \n","\n  Lemma 10.137.6. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c) = R[x_1, \\ldots , x_ n]/I$ be a standard smooth algebra. Then \n  \n  \nthe ring map $R \\to S$ is smooth, \n\n\nthe $S$-module $\\Omega _{S/R}$ is free on $\\text{d}x_{c + 1}, \\ldots , \\text{d}x_ n$, \n\n\nthe $S$-module $I/I^2$ is free on the classes of $f_1, \\ldots , f_ c$, \n\n\nfor any $g \\in S$ the ring map $R \\to S_ g$ is standard smooth, \n\n\nfor any ring map $R \\to R\'$ the base change $R\' \\to R\'\\otimes _ R S$ is standard smooth, \n\n\nif $f \\in R$ maps to an invertible element in $S$, then $R_ f \\to S$ is standard smooth, and \n\n\nthe ring $S$ is a relative global complete intersection over $R$. \n\n\n\n\n    \n","Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 for example. \n      $\\square$\n    \n","
  Module.Free.of_basis P.basisKaehler
","theorem free_kaehlerDifferential (P : SubmersivePresentation R S Œπ œÉ) :
    Module.Free S Œ©[S‚ÅÑR] ","Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9 [[\n  Lemma 10.136.9. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ be a relative global complete intersection (Definition 10.136.5) \n  \n  \nFor any $R \\to R\'$ the base change $R\' \\otimes _ R S = R\'[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection. \n\n\nFor any $g \\in S$ which is the image of $h \\in R[x_1, \\ldots , x_ n]$ the ring $S_ g = R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, hx_{n + 1} - 1)$ is a relative global complete intersection. \n\n\nIf $R \\to S$ factors as $R \\to R_ f \\to S$ for some $f \\in R$. Then the ring $S = R_ f[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection over $R_ f$. \n\n\n\n\n    \n]]. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 [[\n  Definition 10.137.5. Let $R$ be a ring. Given integers $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ we say \n  \n  \\[  R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)  \\]\n\n   is a standard smooth algebra over $R$ if the polynomial \n  \n  \\[  g = \\det \\left( \\begin{matrix}  \\partial f_1/\\partial x_1 \n\n&  \\partial f_2/\\partial x_1 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_1 \n\n\\\\  \\partial f_1/\\partial x_2 \n\n&  \\partial f_2/\\partial x_2 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_2 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  \\partial f_1/\\partial x_ c \n\n&  \\partial f_2/\\partial x_ c \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_ c \n\n\\end{matrix} \\right)  \\]\n\n   maps to an invertible element in $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$. We say an $R$-algebra $S$ is standard smooth or that the ring map $R \\to S$ is standard smooth if there exist $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ such that $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a standard smooth algebra over $R$ and $S$ is isomorphic to $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ as an $R$-algebra. \n]] for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4 [[\n  Lemma 10.137.4. Let $k$ be a field. Let $S$ be a smooth $k$-algebra. Then $S$ is a local complete intersection. \n\n    \n]]. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 [[\n  Lemma 10.135.4. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Let $\\mathfrak q$ be a prime of $S$. Choose any presentation $S = k[x_1, \\ldots , x_ n]/I$. Let $\\mathfrak q\'$ be the prime of $k[x_1, \\ldots , x_ n]$ corresponding to $\\mathfrak q$. Set $c = \\text{height}(\\mathfrak q\') - \\text{height}(\\mathfrak q)$, in other words $\\dim _{\\mathfrak q}(S) = n - c$ (see Lemma 10.116.4). The following are equivalent \n  \n  \nThere exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $S_ g$ is a global complete intersection over $k$. \n\n\nThe ideal $I_{\\mathfrak q\'} \\subset k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$ can be generated by $c$ elements. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ can be generated by $c$ elements over $S_{\\mathfrak q}$. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ is a free $S_{\\mathfrak q}$-module of rank $c$. \n\n\nThe ideal $I_{\\mathfrak q\'}$ can be generated by a regular sequence in the regular local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n\n\n   In this case any $c$ elements of $I_{\\mathfrak q\'}$ which generate $I_{\\mathfrak q\'}/\\mathfrak q\'I_{\\mathfrak q\'}$ form a regular sequence in the local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n    \n]] for example. \n      $\\square$\n    \n","Proof.\n      Consider the naive cotangent complex of the given presentation \n    \n      \n  \\[  (f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2 \\longrightarrow \\bigoplus \\nolimits _{i = 1}^ n S \\text{d}x_ i  \\]\n\n    \n       Let us compose this map with the projection onto the first $c$ direct summands of the direct sum. According to the definition of a standard smooth algebra the classes $f_ i \\bmod (f_1, \\ldots , f_ c)^2$ map to a basis of $\\bigoplus _{i = 1}^ c S\\text{d}x_ i$. We conclude that $(f_1, \\ldots , f_ c)/(f_1, \\ldots , f_ c)^2$ is free of rank $c$ with a basis given by the elements $f_ i \\bmod (f_1, \\ldots , f_ c)^2$, and that the homology in degree $0$, i.e., $\\Omega _{S/R}$, of the naive cotangent complex is a free $S$-module with basis the images of $\\text{d}x_{c + j}$, $j = 1, \\ldots , n - c$. In particular, this proves $R \\to S$ is smooth. \n    \n      The proofs of (4) and (6) are omitted. But see the example below and the proof of Lemma 10.136.9 [[\n  Lemma 10.136.9. Let $S = R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ be a relative global complete intersection (Definition 10.136.5) \n  \n  \nFor any $R \\to R\'$ the base change $R\' \\otimes _ R S = R\'[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection. \n\n\nFor any $g \\in S$ which is the image of $h \\in R[x_1, \\ldots , x_ n]$ the ring $S_ g = R[x_1, \\ldots , x_ n, x_{n + 1}]/(f_1, \\ldots , f_ c, hx_{n + 1} - 1)$ is a relative global complete intersection. \n\n\nIf $R \\to S$ factors as $R \\to R_ f \\to S$ for some $f \\in R$. Then the ring $S = R_ f[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a relative global complete intersection over $R_ f$. \n\n\n\n\n    \n]]. \n    \n      Let $\\varphi : R \\to R\'$ be any ring map. Denote $S\' = R\'[x_1, \\ldots , x_ n]/(f_1^\\varphi , \\ldots , f_ c^\\varphi )$ where $f^\\varphi $ is the polynomial obtained from $f \\in R[x_1, \\ldots , x_ n]$ by applying $\\varphi $ to all the coefficients. Then $S\' \\cong R\' \\otimes _ R S$. Moreover, the determinant of Definition 10.137.5 [[\n  Definition 10.137.5. Let $R$ be a ring. Given integers $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ we say \n  \n  \\[  R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)  \\]\n\n   is a standard smooth algebra over $R$ if the polynomial \n  \n  \\[  g = \\det \\left( \\begin{matrix}  \\partial f_1/\\partial x_1 \n\n&  \\partial f_2/\\partial x_1 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_1 \n\n\\\\  \\partial f_1/\\partial x_2 \n\n&  \\partial f_2/\\partial x_2 \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_2 \n\n\\\\  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n&  \\ldots \n\n\\\\  \\partial f_1/\\partial x_ c \n\n&  \\partial f_2/\\partial x_ c \n\n&  \\ldots \n\n&  \\partial f_ c/\\partial x_ c \n\n\\end{matrix} \\right)  \\]\n\n   maps to an invertible element in $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$. We say an $R$-algebra $S$ is standard smooth or that the ring map $R \\to S$ is standard smooth if there exist $n \\geq c \\geq 0$ and $f_1, \\ldots , f_ c \\in R[x_1, \\ldots , x_ n]$ such that $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a standard smooth algebra over $R$ and $S$ is isomorphic to $R[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ as an $R$-algebra. \n]] for $S\'/R\'$ is equal to $g^\\varphi $. Its image in $S\'$ is therefore the image of $g$ via $R[x_1, \\ldots , x_ n] \\to S \\to S\'$ and hence invertible. This proves (5). \n    \n      To prove (7) it suffices to show that $S \\otimes _ R \\kappa (\\mathfrak p)$ has dimension $n - c$ for every prime $\\mathfrak p \\subset R$. By (5) it suffices to prove that any standard smooth algebra $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ over a field $k$ has dimension $n - c$. We already know that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ is a local complete intersection by Lemma 10.137.4 [[\n  Lemma 10.137.4. Let $k$ be a field. Let $S$ be a smooth $k$-algebra. Then $S$ is a local complete intersection. \n\n    \n]]. Hence, since $I/I^2$ is free of rank $c$ we see that $k[x_1, \\ldots , x_ n]/(f_1, \\ldots , f_ c)$ has dimension $n - c$, by Lemma 10.135.4 [[\n  Lemma 10.135.4. Let $k$ be a field. Let $S$ be a finite type $k$-algebra. Let $\\mathfrak q$ be a prime of $S$. Choose any presentation $S = k[x_1, \\ldots , x_ n]/I$. Let $\\mathfrak q\'$ be the prime of $k[x_1, \\ldots , x_ n]$ corresponding to $\\mathfrak q$. Set $c = \\text{height}(\\mathfrak q\') - \\text{height}(\\mathfrak q)$, in other words $\\dim _{\\mathfrak q}(S) = n - c$ (see Lemma 10.116.4). The following are equivalent \n  \n  \nThere exists a $g \\in S$, $g \\not\\in \\mathfrak q$ such that $S_ g$ is a global complete intersection over $k$. \n\n\nThe ideal $I_{\\mathfrak q\'} \\subset k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$ can be generated by $c$ elements. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ can be generated by $c$ elements over $S_{\\mathfrak q}$. \n\n\nThe conormal module $(I/I^2)_{\\mathfrak q}$ is a free $S_{\\mathfrak q}$-module of rank $c$. \n\n\nThe ideal $I_{\\mathfrak q\'}$ can be generated by a regular sequence in the regular local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n\n\n   In this case any $c$ elements of $I_{\\mathfrak q\'}$ which generate $I_{\\mathfrak q\'}/\\mathfrak q\'I_{\\mathfrak q\'}$ form a regular sequence in the local ring $k[x_1, \\ldots , x_ n]_{\\mathfrak q\'}$. \n\n    \n]] for example. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""1"", ""brief_justification"": ""The formal_proof is just a reference to a Lean lemma/definition invocation (`Module.Free.of_basis P.basisKaehler`), which asserts freeness of a module from the existence of a basis (here a specific basis `P.basisKaehler`). The informal proof, however, is a detailed argument about the naive cotangent complex for a standard smooth algebra presentation, identifying bases for the conormal module and for Œ©_{S/R}, and deducing smoothness, plus additional base change/dimension statements. Semantically, the Lean line only establishes a generic module-theoretic freeness result and does not encode the cotangent complex, Jacobian determinant condition, projection argument, or smoothness/dimension/base change conclusions. Structurally, the informal proof proceeds via explicit maps, projections, and homology computations, whereas the formal proof has no corresponding steps‚Äîjust a one-line application. Hence there is essentially no alignment beyond the very broad theme of 'freeness from a basis.'""}"
335,00I1,"lemma isOpenMap_comap_of_hasGoingDown_of_finitePresentation
    [Algebra R S] [Algebra.HasGoingDown R S] [Algebra.FinitePresentation R S] :
    IsOpenMap (comap (algebraMap R S)) := by
  rw [isBasis_basic_opens.isOpenMap_iff]
  rintro _ ‚ü®_, ‚ü®f, rfl‚ü©, rfl‚ü©
  exact isOpen_of_stableUnderGeneralization_of_isConstructible
    ((basicOpen f).2.stableUnderGeneralization.image
      (Algebra.HasGoingDown.iff_generalizingMap_primeSpectrumComap.mp ‚Äπ_‚Ä∫))
    (isConstructible_comap_image (RingHom.finitePresentation_algebraMap.mpr ‚Äπ_‚Ä∫)
      isConstructible_basicOpen)
",Formal Proof of Stacks Project Tag 00I1,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Chevalley.lean#L58-L67,Q27041,,10.41.8,proposition,3.0,"['00HU', '00AO', '0ELQ']","\n  Proposition 10.41.8. Let $R \\to S$ be flat and of finite presentation. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is open. More generally this holds for any ring map $R \\to S$ of finite presentation which satisfies going down. \n\n    \n      Proof.\n      If $R \\to S$ is flat, then $R \\to S$ satisfies going down by Lemma 10.39.19. Thus to prove the lemma we may assume that $R \\to S$ has finite presentation and satisfies going down. \n    \n      Since the standard opens $D(g) \\subset \\mathop{\\mathrm{Spec}}(S)$, $g \\in S$ form a basis for the topology, it suffices to prove that the image of $D(g)$ is open. Recall that $\\mathop{\\mathrm{Spec}}(S_ g) \\to \\mathop{\\mathrm{Spec}}(S)$ is a homeomorphism of $\\mathop{\\mathrm{Spec}}(S_ g)$ onto $D(g)$ (Lemma 10.17.6). Since $S \\to S_ g$ satisfies going down (see above), we see that $R \\to S_ g$ satisfies going down by Lemma 10.41.4. Thus after replacing $S$ by $S_ g$ we see it suffices to prove the image is open. By Chevalley\'s theorem (Theorem 10.29.10) the image is a constructible set $E$. And $E$ is stable under generalization because $R \\to S$ satisfies going down, see Topology, Lemmas 5.19.2 and 5.19.6. Hence $E$ is open by Lemma 10.41.7. \n      $\\square$\n    \n",\n  Proposition 10.41.8. Let $R \\to S$ be flat and of finite presentation. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is open. More generally this holds for any ring map $R \\to S$ of finite presentation which satisfies going down. \n\n    \n,"Proof.\n      If $R \\to S$ is flat, then $R \\to S$ satisfies going down by Lemma 10.39.19. Thus to prove the lemma we may assume that $R \\to S$ has finite presentation and satisfies going down. \n    \n      Since the standard opens $D(g) \\subset \\mathop{\\mathrm{Spec}}(S)$, $g \\in S$ form a basis for the topology, it suffices to prove that the image of $D(g)$ is open. Recall that $\\mathop{\\mathrm{Spec}}(S_ g) \\to \\mathop{\\mathrm{Spec}}(S)$ is a homeomorphism of $\\mathop{\\mathrm{Spec}}(S_ g)$ onto $D(g)$ (Lemma 10.17.6). Since $S \\to S_ g$ satisfies going down (see above), we see that $R \\to S_ g$ satisfies going down by Lemma 10.41.4. Thus after replacing $S$ by $S_ g$ we see it suffices to prove the image is open. By Chevalley\'s theorem (Theorem 10.29.10) the image is a constructible set $E$. And $E$ is stable under generalization because $R \\to S$ satisfies going down, see Topology, Lemmas 5.19.2 and 5.19.6. Hence $E$ is open by Lemma 10.41.7. \n      $\\square$\n    \n"," by
  rw [isBasis_basic_opens.isOpenMap_iff]
  rintro _ ‚ü®_, ‚ü®f, rfl‚ü©, rfl‚ü©
  exact isOpen_of_stableUnderGeneralization_of_isConstructible
    ((basicOpen f).2.stableUnderGeneralization.image
      (Algebra.HasGoingDown.iff_generalizingMap_primeSpectrumComap.mp ‚Äπ_‚Ä∫))
    (isConstructible_comap_image (RingHom.finitePresentation_algebraMap.mpr ‚Äπ_‚Ä∫)
      isConstructible_basicOpen)
","lemma isOpenMap_comap_of_hasGoingDown_of_finitePresentation
    [Algebra R S] [Algebra.HasGoingDown R S] [Algebra.FinitePresentation R S] :
    IsOpenMap (comap (algebraMap R S)) ","Proof.\n      If $R \\to S$ is flat, then $R \\to S$ satisfies going down by Lemma 10.39.19 [[\n  Lemma 10.39.19. Let $R \\to S$ be flat. Let $\\mathfrak p \\subset \\mathfrak p\'$ be primes of $R$. Let $\\mathfrak q\' \\subset S$ be a prime of $S$ mapping to $\\mathfrak p\'$. Then there exists a prime $\\mathfrak q \\subset \\mathfrak q\'$ mapping to $\\mathfrak p$. \n\n    \n]]. Thus to prove the lemma we may assume that $R \\to S$ has finite presentation and satisfies going down. \n    \n      Since the standard opens $D(g) \\subset \\mathop{\\mathrm{Spec}}(S)$, $g \\in S$ form a basis for the topology, it suffices to prove that the image of $D(g)$ is open. Recall that $\\mathop{\\mathrm{Spec}}(S_ g) \\to \\mathop{\\mathrm{Spec}}(S)$ is a homeomorphism of $\\mathop{\\mathrm{Spec}}(S_ g)$ onto $D(g)$ (Lemma 10.17.6 [[\n  Lemma 10.17.6. Let $R$ be a ring. Let $f \\in R$. The map $R \\to R_ f$ induces via the functoriality of $\\mathop{\\mathrm{Spec}}$ a homeomorphism \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R_ f) \\longrightarrow D(f) \\subset \\mathop{\\mathrm{Spec}}(R).  \\]\n\n   The inverse is given by $\\mathfrak p \\mapsto \\mathfrak p \\cdot R_ f$. \n\n    \n]]). Since $S \\to S_ g$ satisfies going down (see above), we see that $R \\to S_ g$ satisfies going down by Lemma 10.41.4 [[\n  Lemma 10.41.4. Suppose $R \\to S$ and $S \\to T$ are ring maps satisfying going down. Then so does $R \\to T$. Similarly for going up. \n\n    \n]]. Thus after replacing $S$ by $S_ g$ we see it suffices to prove the image is open. By Chevalley\'s theorem (Theorem 10.29.10 [[\n  Theorem 10.29.10 (Chevalley\'s Theorem).  Suppose that $R \\to S$ is of finite presentation. The image of a constructible subset of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$ is constructible. \n\n    \n]]) the image is a constructible set $E$. And $E$ is stable under generalization because $R \\to S$ satisfies going down, see Topology, Lemmas 5.19.2 [[\n  Lemma 5.19.2. Let $X$ be a topological space. \n  \n  \nAny closed subset of $X$ is stable under specialization. \n\n\nAny open subset of $X$ is stable under generalization. \n\n\nA subset $T \\subset X$ is stable under specialization if and only if the complement $T^ c$ is stable under generalization. \n\n\n\n\n    \n]] and 5.19.6 [[\n  Lemma 5.19.6. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf specializations lift along $f$, and if $T \\subset X$ is stable under specialization, then $f(T) \\subset Y$ is stable under specialization. \n\n\nIf generalizations lift along $f$, and if $T \\subset X$ is stable under generalization, then $f(T) \\subset Y$ is stable under generalization. \n\n\n\n\n    \n]]. Hence $E$ is open by Lemma 10.41.7 [[\n  Lemma 10.41.7. Let $R$ be a ring. Let $E \\subset \\mathop{\\mathrm{Spec}}(R)$ be a constructible subset. \n  \n  \nIf $E$ is stable under specialization, then $E$ is closed. \n\n\nIf $E$ is stable under generalization, then $E$ is open. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      If $R \\to S$ is flat, then $R \\to S$ satisfies going down by Lemma 10.39.19 [[\n  Lemma 10.39.19. Let $R \\to S$ be flat. Let $\\mathfrak p \\subset \\mathfrak p\'$ be primes of $R$. Let $\\mathfrak q\' \\subset S$ be a prime of $S$ mapping to $\\mathfrak p\'$. Then there exists a prime $\\mathfrak q \\subset \\mathfrak q\'$ mapping to $\\mathfrak p$. \n\n    \n]]. Thus to prove the lemma we may assume that $R \\to S$ has finite presentation and satisfies going down. \n    \n      Since the standard opens $D(g) \\subset \\mathop{\\mathrm{Spec}}(S)$, $g \\in S$ form a basis for the topology, it suffices to prove that the image of $D(g)$ is open. Recall that $\\mathop{\\mathrm{Spec}}(S_ g) \\to \\mathop{\\mathrm{Spec}}(S)$ is a homeomorphism of $\\mathop{\\mathrm{Spec}}(S_ g)$ onto $D(g)$ (Lemma 10.17.6 [[\n  Lemma 10.17.6. Let $R$ be a ring. Let $f \\in R$. The map $R \\to R_ f$ induces via the functoriality of $\\mathop{\\mathrm{Spec}}$ a homeomorphism \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R_ f) \\longrightarrow D(f) \\subset \\mathop{\\mathrm{Spec}}(R).  \\]\n\n   The inverse is given by $\\mathfrak p \\mapsto \\mathfrak p \\cdot R_ f$. \n\n    \n]]). Since $S \\to S_ g$ satisfies going down (see above), we see that $R \\to S_ g$ satisfies going down by Lemma 10.41.4 [[\n  Lemma 10.41.4. Suppose $R \\to S$ and $S \\to T$ are ring maps satisfying going down. Then so does $R \\to T$. Similarly for going up. \n\n    \n]]. Thus after replacing $S$ by $S_ g$ we see it suffices to prove the image is open. By Chevalley\'s theorem (Theorem 10.29.10 [[\n  Theorem 10.29.10 (Chevalley\'s Theorem).  Suppose that $R \\to S$ is of finite presentation. The image of a constructible subset of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$ is constructible. \n\n    \n]]) the image is a constructible set $E$. And $E$ is stable under generalization because $R \\to S$ satisfies going down, see Topology, Lemmas 5.19.2 [[\n  Lemma 5.19.2. Let $X$ be a topological space. \n  \n  \nAny closed subset of $X$ is stable under specialization. \n\n\nAny open subset of $X$ is stable under generalization. \n\n\nA subset $T \\subset X$ is stable under specialization if and only if the complement $T^ c$ is stable under generalization. \n\n\n\n\n    \n]] and 5.19.6 [[\n  Lemma 5.19.6. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf specializations lift along $f$, and if $T \\subset X$ is stable under specialization, then $f(T) \\subset Y$ is stable under specialization. \n\n\nIf generalizations lift along $f$, and if $T \\subset X$ is stable under generalization, then $f(T) \\subset Y$ is stable under generalization. \n\n\n\n\n    \n]]. Hence $E$ is open by Lemma 10.41.7 [[\n  Lemma 10.41.7. Let $R$ be a ring. Let $E \\subset \\mathop{\\mathrm{Spec}}(R)$ be a constructible subset. \n  \n  \nIf $E$ is stable under specialization, then $E$ is closed. \n\n\nIf $E$ is stable under generalization, then $E$ is open. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the core argument of the informal proof: to show a map on spectra is open it suffices to check images of basic opens; the image is constructible by a finite-presentation/Chevalley-type lemma (`isConstructible_comap_image ... isConstructible_basicOpen`); going-down/generalization-lifting gives stability under generalization (`stableUnderGeneralization.image (Algebra.HasGoingDown.iff_generalizingMap_primeSpectrumComap.mp ...)`); and a constructible set stable under generalization is open (`isOpen_of_stableUnderGeneralization_of_isConstructible`). Structurally, the Lean proof is a compressed version of the same steps: it rewrites the open-map goal using a basis of basic opens (`isBasis_basic_opens.isOpenMap_iff`), reduces to a basic open, then applies the ‚Äúconstructible + stable under generalization ‚áí open‚Äù lemma with the two required inputs. The main mismatch is that the informal proof explicitly discusses reducing from flatness to going-down and localizing to standard opens via a homeomorphism, whereas the Lean snippet assumes the needed going-down/generalizing-map and finite-presentation hypotheses are already available (as implicit arguments) and does not reflect the localization/homeomorphism discussion. Thus the essential mathematical content aligns well, but some preparatory reductions present in the informal proof are not represented in this code fragment.""}"
336,00F8,"-- TODO: show that the constructed `f` is of finite presentation
lemma exists_range_eq_of_isConstructible {R : Type u} [CommRing R]
    {s : Set (PrimeSpectrum R)} (hs : IsConstructible s) :
    ‚àÉ (S : Type u) (_ : CommRing S) (f : R ‚Üí+* S), Set.range (comap f) = s := by
  obtain ‚ü®s, rfl‚ü© := exists_constructibleSetData_iff.mpr hs
  refine ‚ü®Œ† i : s, Localization.Away (Ideal.Quotient.mk (Ideal.span (Set.range i.1.g)) i.1.f),
    inferInstance, algebraMap _ _, ?_‚ü©
  rw [‚Üê iUnion_range_comap_comp_evalRingHom, ConstructibleSetData.toSet]
  simp_rw [‚Üê Finset.mem_coe, Set.biUnion_eq_iUnion]
  congr! with _ _ C
  let I := Ideal.span (Set.range C.1.g)
  let f := Ideal.Quotient.mk I C.1.f
  trans comap (Ideal.Quotient.mk I) '' (Set.range (comap (algebraMap _ (Localization.Away f))))
  ¬∑ rw [‚Üê Set.range_comp]; rfl
  ¬∑ rw [localization_away_comap_range _ f, ‚Üê comap_basicOpen, TopologicalSpace.Opens.coe_comap,
      ContinuousMap.coe_mk, Set.image_preimage_eq_inter_range,
      range_comap_of_surjective _ _ Ideal.Quotient.mk_surjective, BasicConstructibleSetData.toSet,
      Set.diff_eq_compl_inter, basicOpen_eq_zeroLocus_compl, Ideal.mk_ker, zeroLocus_span]
",Formal Proof of Stacks Project Tag 00F8,without the finite presentation part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/ConstructibleSet.lean#L141-L158,Q27041,,10.29.4,lemma,3.0,"['00F5', '00AO', '0ELQ']","\n  Lemma 10.29.4. Let $R$ be a ring and let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be constructible. Then there exists a ring map $R \\to S$ of finite presentation such that $T$ is the image of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n    \n      Proof.\n      The spectrum of a finite product of rings is the disjoint union of the spectra, see Lemma 10.21.2. Hence if $T = T_1 \\cup T_2$ and the result holds for $T_1$ and $T_2$, then the result holds for $T$. By Lemma 10.29.3 we may assume that $T = D(f) \\cap V(g_1, \\ldots , g_ m)$. In this case $T$ is the image of the map $\\mathop{\\mathrm{Spec}}((R/(g_1, \\ldots , g_ m))_ f) \\to \\mathop{\\mathrm{Spec}}(R)$, see Lemmas 10.17.6 and 10.17.7. \n      $\\square$\n    \n",\n  Lemma 10.29.4. Let $R$ be a ring and let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be constructible. Then there exists a ring map $R \\to S$ of finite presentation such that $T$ is the image of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n    \n,"Proof.\n      The spectrum of a finite product of rings is the disjoint union of the spectra, see Lemma 10.21.2. Hence if $T = T_1 \\cup T_2$ and the result holds for $T_1$ and $T_2$, then the result holds for $T$. By Lemma 10.29.3 we may assume that $T = D(f) \\cap V(g_1, \\ldots , g_ m)$. In this case $T$ is the image of the map $\\mathop{\\mathrm{Spec}}((R/(g_1, \\ldots , g_ m))_ f) \\to \\mathop{\\mathrm{Spec}}(R)$, see Lemmas 10.17.6 and 10.17.7. \n      $\\square$\n    \n"," by
  obtain ‚ü®s, rfl‚ü© := exists_constructibleSetData_iff.mpr hs
  refine ‚ü®Œ† i : s, Localization.Away (Ideal.Quotient.mk (Ideal.span (Set.range i.1.g)) i.1.f),
    inferInstance, algebraMap _ _, ?_‚ü©
  rw [‚Üê iUnion_range_comap_comp_evalRingHom, ConstructibleSetData.toSet]
  simp_rw [‚Üê Finset.mem_coe, Set.biUnion_eq_iUnion]
  congr! with _ _ C
  let I := Ideal.span (Set.range C.1.g)
  let f := Ideal.Quotient.mk I C.1.f
  trans comap (Ideal.Quotient.mk I) '' (Set.range (comap (algebraMap _ (Localization.Away f))))
  ¬∑ rw [‚Üê Set.range_comp]; rfl
  ¬∑ rw [localization_away_comap_range _ f, ‚Üê comap_basicOpen, TopologicalSpace.Opens.coe_comap,
      ContinuousMap.coe_mk, Set.image_preimage_eq_inter_range,
      range_comap_of_surjective _ _ Ideal.Quotient.mk_surjective, BasicConstructibleSetData.toSet,
      Set.diff_eq_compl_inter, basicOpen_eq_zeroLocus_compl, Ideal.mk_ker, zeroLocus_span]
","-- TODO: show that the constructed `f` is of finite presentation
lemma exists_range_eq_of_isConstructible {R : Type u} [CommRing R]
    {s : Set (PrimeSpectrum R)} (hs : IsConstructible s) :
    ‚àÉ (S : Type u) (_ : CommRing S) (f : R ‚Üí+* S), Set.range (comap f) = s ","Proof.\n      The spectrum of a finite product of rings is the disjoint union of the spectra, see Lemma 10.21.2 [[\n  Lemma 10.21.2. Let $R_1$ and $R_2$ be rings. Let $R = R_1 \\times R_2$. The maps $R \\to R_1$, $(x, y) \\mapsto x$ and $R \\to R_2$, $(x, y) \\mapsto y$ induce continuous maps $\\mathop{\\mathrm{Spec}}(R_1) \\to \\mathop{\\mathrm{Spec}}(R)$ and $\\mathop{\\mathrm{Spec}}(R_2) \\to \\mathop{\\mathrm{Spec}}(R)$. The induced map \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R_1) \\amalg \\mathop{\\mathrm{Spec}}(R_2) \\longrightarrow \\mathop{\\mathrm{Spec}}(R)  \\]\n\n   is a homeomorphism. In other words, the spectrum of $R = R_1\\times R_2$ is the disjoint union of the spectrum of $R_1$ and the spectrum of $R_2$. \n\n    \n]]. Hence if $T = T_1 \\cup T_2$ and the result holds for $T_1$ and $T_2$, then the result holds for $T$. By Lemma 10.29.3 [[\n  Lemma 10.29.3. Let $R$ be a ring. A subset of $\\mathop{\\mathrm{Spec}}(R)$ is constructible if and only if it can be written as a finite union of subsets of the form $D(f) \\cap V(g_1, \\ldots , g_ m)$ for $f, g_1, \\ldots , g_ m \\in R$. \n\n    \n]] we may assume that $T = D(f) \\cap V(g_1, \\ldots , g_ m)$. In this case $T$ is the image of the map $\\mathop{\\mathrm{Spec}}((R/(g_1, \\ldots , g_ m))_ f) \\to \\mathop{\\mathrm{Spec}}(R)$, see Lemmas 10.17.6 [[\n  Lemma 10.17.6. Let $R$ be a ring. Let $f \\in R$. The map $R \\to R_ f$ induces via the functoriality of $\\mathop{\\mathrm{Spec}}$ a homeomorphism \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R_ f) \\longrightarrow D(f) \\subset \\mathop{\\mathrm{Spec}}(R).  \\]\n\n   The inverse is given by $\\mathfrak p \\mapsto \\mathfrak p \\cdot R_ f$. \n\n    \n]] and 10.17.7 [[\n  Lemma 10.17.7. Let $R$ be a ring. Let $I \\subset R$ be an ideal. The map $R \\to R/I$ induces via the functoriality of $\\mathop{\\mathrm{Spec}}$ a homeomorphism \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R/I) \\longrightarrow V(I) \\subset \\mathop{\\mathrm{Spec}}(R).  \\]\n\n   The inverse is given by $\\mathfrak p \\mapsto \\mathfrak p / I$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      The spectrum of a finite product of rings is the disjoint union of the spectra, see Lemma 10.21.2 [[\n  Lemma 10.21.2. Let $R_1$ and $R_2$ be rings. Let $R = R_1 \\times R_2$. The maps $R \\to R_1$, $(x, y) \\mapsto x$ and $R \\to R_2$, $(x, y) \\mapsto y$ induce continuous maps $\\mathop{\\mathrm{Spec}}(R_1) \\to \\mathop{\\mathrm{Spec}}(R)$ and $\\mathop{\\mathrm{Spec}}(R_2) \\to \\mathop{\\mathrm{Spec}}(R)$. The induced map \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R_1) \\amalg \\mathop{\\mathrm{Spec}}(R_2) \\longrightarrow \\mathop{\\mathrm{Spec}}(R)  \\]\n\n   is a homeomorphism. In other words, the spectrum of $R = R_1\\times R_2$ is the disjoint union of the spectrum of $R_1$ and the spectrum of $R_2$. \n\n    \n]]. Hence if $T = T_1 \\cup T_2$ and the result holds for $T_1$ and $T_2$, then the result holds for $T$. By Lemma 10.29.3 [[\n  Lemma 10.29.3. Let $R$ be a ring. A subset of $\\mathop{\\mathrm{Spec}}(R)$ is constructible if and only if it can be written as a finite union of subsets of the form $D(f) \\cap V(g_1, \\ldots , g_ m)$ for $f, g_1, \\ldots , g_ m \\in R$. \n\n    \n]] we may assume that $T = D(f) \\cap V(g_1, \\ldots , g_ m)$. In this case $T$ is the image of the map $\\mathop{\\mathrm{Spec}}((R/(g_1, \\ldots , g_ m))_ f) \\to \\mathop{\\mathrm{Spec}}(R)$, see Lemmas 10.17.6 [[\n  Lemma 10.17.6. Let $R$ be a ring. Let $f \\in R$. The map $R \\to R_ f$ induces via the functoriality of $\\mathop{\\mathrm{Spec}}$ a homeomorphism \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R_ f) \\longrightarrow D(f) \\subset \\mathop{\\mathrm{Spec}}(R).  \\]\n\n   The inverse is given by $\\mathfrak p \\mapsto \\mathfrak p \\cdot R_ f$. \n\n    \n]] and 10.17.7 [[\n  Lemma 10.17.7. Let $R$ be a ring. Let $I \\subset R$ be an ideal. The map $R \\to R/I$ induces via the functoriality of $\\mathop{\\mathrm{Spec}}$ a homeomorphism \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R/I) \\longrightarrow V(I) \\subset \\mathop{\\mathrm{Spec}}(R).  \\]\n\n   The inverse is given by $\\mathfrak p \\mapsto \\mathfrak p / I$. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: without the finite presentation part","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is constructing a ring (a finite product indexed by data s) and a map to the original ring such that the image on Spec matches the given constructible set, by reducing to basic constructible pieces of the form D(f) ‚à© V(g‚Äôs) and expressing them via quotient + localization (Ideal.span of the g‚Äôs, then Localization.Away of the image of f). This matches the informal proof‚Äôs key step: using the characterization of constructible sets as finite unions of D(f) ‚à© V(g1,‚Ä¶,gm), and for such a piece identifying it as the image of Spec((R/(g‚Äôs))_f) ‚Üí Spec(R) via the quotient and localization lemmas.\n\nStructurally, the Lean proof starts by extracting constructible set data (exists_constructibleSetData_iff), then builds a Œ†/product of localized quotients and rewrites the target set as an iUnion/biUnion over the pieces, mirroring the informal ‚Äúfinite union‚Äù reduction. It then focuses on a single component C and proves the corresponding image/range equality using lemmas about comap/range under quotient and localization (localization_away_comap_range, comap_basicOpen, zeroLocus_span, etc.), which corresponds to the informal use of Lemmas 10.17.6 and 10.17.7.\n\nThe main mismatch is that the informal proof explicitly uses the disjoint-union/homeomorphism for Spec of a product ring to handle unions (Lemma 10.21.2), whereas the Lean proof handles unions via iUnion over an index type and constructs a product ring directly, without an explicit ‚ÄúSpec(product) is coproduct‚Äù homeomorphism argument. Still, the overall mathematical content (finite union of images of Spec of localized quotients) is captured, and the note about omitting the finite presentation part is consistent with what appears in the Lean code.""}"
337,00I0,"lemma isOpen_of_stableUnderGeneralization_of_isConstructible {R : Type*} [CommRing R]
    {s : Set (PrimeSpectrum R)} (hs : StableUnderGeneralization s) (hs' : IsConstructible s) :
    IsOpen s := by
  rw [‚Üê isClosed_compl_iff]
  exact isClosed_of_stableUnderSpecialization_of_isConstructible hs.compl hs'.compl
",Formal Proof of Stacks Project Tag 00I0,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/ConstructibleSet.lean#L168-L172,Q27041,,10.41.7,lemma,3.0,"['00HU', '00AO', '0ELQ']","\n  Lemma 10.41.7. Let $R$ be a ring. Let $E \\subset \\mathop{\\mathrm{Spec}}(R)$ be a constructible subset. \n  \n  \nIf $E$ is stable under specialization, then $E$ is closed. \n\n\nIf $E$ is stable under generalization, then $E$ is open. \n\n\n\n\n    \n      Proof.\n      First proof. The first assertion follows from Lemma 10.41.5 combined with Lemma 10.29.4. The second follows because the complement of a constructible set is constructible (see Topology, Lemma 5.15.2), the first part of the lemma and Topology, Lemma 5.19.2. \n    \n      Second proof. Since $\\mathop{\\mathrm{Spec}}(R)$ is a spectral space by Lemma 10.26.2 this is a special case of Topology, Lemma 5.23.6. \n      $\\square$\n    \n","\n  Lemma 10.41.7. Let $R$ be a ring. Let $E \\subset \\mathop{\\mathrm{Spec}}(R)$ be a constructible subset. \n  \n  \nIf $E$ is stable under specialization, then $E$ is closed. \n\n\nIf $E$ is stable under generalization, then $E$ is open. \n\n\n\n\n    \n","Proof.\n      First proof. The first assertion follows from Lemma 10.41.5 combined with Lemma 10.29.4. The second follows because the complement of a constructible set is constructible (see Topology, Lemma 5.15.2), the first part of the lemma and Topology, Lemma 5.19.2. \n    \n      Second proof. Since $\\mathop{\\mathrm{Spec}}(R)$ is a spectral space by Lemma 10.26.2 this is a special case of Topology, Lemma 5.23.6. \n      $\\square$\n    \n"," by
  rw [‚Üê isClosed_compl_iff]
  exact isClosed_of_stableUnderSpecialization_of_isConstructible hs.compl hs'.compl
","lemma isOpen_of_stableUnderGeneralization_of_isConstructible {R : Type*} [CommRing R]
    {s : Set (PrimeSpectrum R)} (hs : StableUnderGeneralization s) (hs' : IsConstructible s) :
    IsOpen s ","Proof.\n      First proof. The first assertion follows from Lemma 10.41.5 [[\n  Lemma 10.41.5. Let $R \\to S$ be a ring map. Let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be the image of $\\mathop{\\mathrm{Spec}}(S)$. If $T$ is stable under specialization, then $T$ is closed. \n\n    \n]] combined with Lemma 10.29.4 [[\n  Lemma 10.29.4. Let $R$ be a ring and let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be constructible. Then there exists a ring map $R \\to S$ of finite presentation such that $T$ is the image of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n    \n]]. The second follows because the complement of a constructible set is constructible (see Topology, Lemma 5.15.2 [[\n  Lemma 5.15.2. The collection of constructible sets is closed under finite intersections, finite unions and complements. \n\n    \n]]), the first part of the lemma and Topology, Lemma 5.19.2 [[\n  Lemma 5.19.2. Let $X$ be a topological space. \n  \n  \nAny closed subset of $X$ is stable under specialization. \n\n\nAny open subset of $X$ is stable under generalization. \n\n\nA subset $T \\subset X$ is stable under specialization if and only if the complement $T^ c$ is stable under generalization. \n\n\n\n\n    \n]]. \n    \n      Second proof. Since $\\mathop{\\mathrm{Spec}}(R)$ is a spectral space by Lemma 10.26.2 [[\n  Lemma 10.26.2. The spectrum of a ring is a spectral space, see Topology, Definition 5.23.1. \n\n    \n]] this is a special case of Topology, Lemma 5.23.6 [[\n  Lemma 5.23.6. Let $X$ be a spectral space. Let $E \\subset X$ be a subset closed in the constructible topology (for example constructible). \n  \n  \nIf $x \\in \\overline{E}$, then $x$ is the specialization of a point of $E$. \n\n\nIf $E$ is stable under specialization, then $E$ is closed. \n\n\nIf $E\' \\subset X$ is open in the constructible topology (for example constructible) and stable under generalization, then $E\'$ is open. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      First proof. The first assertion follows from Lemma 10.41.5 [[\n  Lemma 10.41.5. Let $R \\to S$ be a ring map. Let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be the image of $\\mathop{\\mathrm{Spec}}(S)$. If $T$ is stable under specialization, then $T$ is closed. \n\n    \n]] combined with Lemma 10.29.4 [[\n  Lemma 10.29.4. Let $R$ be a ring and let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be constructible. Then there exists a ring map $R \\to S$ of finite presentation such that $T$ is the image of $\\mathop{\\mathrm{Spec}}(S)$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n    \n]]. The second follows because the complement of a constructible set is constructible (see Topology, Lemma 5.15.2 [[\n  Lemma 5.15.2. The collection of constructible sets is closed under finite intersections, finite unions and complements. \n\n    \n]]), the first part of the lemma and Topology, Lemma 5.19.2 [[\n  Lemma 5.19.2. Let $X$ be a topological space. \n  \n  \nAny closed subset of $X$ is stable under specialization. \n\n\nAny open subset of $X$ is stable under generalization. \n\n\nA subset $T \\subset X$ is stable under specialization if and only if the complement $T^ c$ is stable under generalization. \n\n\n\n\n    \n]]. \n    \n      Second proof. Since $\\mathop{\\mathrm{Spec}}(R)$ is a spectral space by Lemma 10.26.2 [[\n  Lemma 10.26.2. The spectrum of a ring is a spectral space, see Topology, Definition 5.23.1. \n\n    \n]] this is a special case of Topology, Lemma 5.23.6 [[\n  Lemma 5.23.6. Let $X$ be a spectral space. Let $E \\subset X$ be a subset closed in the constructible topology (for example constructible). \n  \n  \nIf $x \\in \\overline{E}$, then $x$ is the specialization of a point of $E$. \n\n\nIf $E$ is stable under specialization, then $E$ is closed. \n\n\nIf $E\' \\subset X$ is open in the constructible topology (for example constructible) and stable under generalization, then $E\'$ is open. \n\n\n\n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof establishes a statement of the form ‚Äú(something) is closed‚Äù by rewriting it into a statement about the complement via `isClosed_compl_iff`, and then applying a lemma `isClosed_of_stableUnderSpecialization_of_isConstructible` to the complements `hs.compl` and `hs'.compl`. This matches the informal proof‚Äôs *second assertion* strategy: use that complements of constructible sets are constructible and relate specialization/generalization via complements to deduce closedness/openness.\n\nStructurally, however, the informal text contains two different proofs and explicitly invokes several intermediate lemmas (constructible image of Spec(S), stability under specialization implies closed, spectral space lemma, etc.). The Lean proof is a very short one-liner that packages most of this into a single lemma application, and it does not reflect the two-proof structure or the explicit ring-theoretic ‚Äúimage of Spec(S)‚Äù route. So it aligns with one slice of the informal argument (the complement-based constructible+specialization criterion), but not with the full narrative and lemma chain presented.""}"
338,0BR8,"lemma PrimeSpectrum.isHomeomorph_comap (f : R ‚Üí+* S) (H : ‚àÄ (x : S), ‚àÉ n > 0, x ^ n ‚àà f.range)
    (hker : RingHom.ker f ‚â§ nilradical R) : IsHomeomorph (comap f) := by
  have h1 : Function.Injective (comap f) := by
    intro q q' hqq'
    ext x
    obtain ‚ü®n, hn, y, hy‚ü© := H x
    rw [‚Üê q.2.pow_mem_iff_mem _ hn, ‚Üê q'.2.pow_mem_iff_mem _ hn, ‚Üê hy]
    rw [PrimeSpectrum.ext_iff, SetLike.ext_iff] at hqq'
    apply hqq'
  have hint : f.kerLift.IsIntegral := fun x ‚Ü¶
    have ‚ü®n, hn, y, hy‚ü© := H x
    let _ := f.kerLift.toAlgebra
    IsIntegral.of_pow hn (hy ‚ñ∏ f.kerLift.isIntegralElem_map (x := ‚ü¶y‚üß))
  have hbij : Function.Bijective (comap f) :=
    ‚ü®h1, (comap_quotientMk_bijective_of_le_nilradical hker).2.comp <|
      hint.comap_surjective f.kerLift_injective‚ü©
  refine ‚ü®continuous_comap f, ?_, h1, hbij.2‚ü©
  rw [isTopologicalBasis_basic_opens.isOpenMap_iff]
  rintro - ‚ü®s, rfl‚ü©
  obtain ‚ü®n, hn, r, hr‚ü© := H s
  have : (comap f) '' (basicOpen s) = basicOpen r :=
    (Set.eq_preimage_iff_image_eq hbij).mp <| by rw [‚Üê basicOpen_pow _ n hn, ‚Üê hr]; rfl
  exact this ‚ñ∏ isOpen_basicOpen
",Formal Proof of Stacks Project Tag 0BR8,Homeomorphism part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Homeomorph.lean#L39-L61,Q27041,,10.46.3,lemma,3.0,"['0BR5', '00AO', '0ELQ']","\n  Lemma 10.46.3. Let $\\varphi : R \\to S$ be a ring map. If \n  \n  \nfor any $x \\in S$ there exists $n > 0$ such that $x^ n$ is in the image of $\\varphi $, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   then $\\varphi $ induces a homeomorphism on spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.2. \n\n    \n      Proof.\n      Assume (1) and (2). Let $\\mathfrak q, \\mathfrak q\'$ be primes of $S$ lying over the same prime ideal $\\mathfrak p$ of $R$. Suppose $x \\in S$ with $x \\in \\mathfrak q$, $x \\not\\in \\mathfrak q\'$. Then $x^ n \\in \\mathfrak q$ and $x^ n \\not\\in \\mathfrak q\'$ for all $n > 0$. If $x^ n = \\varphi (y)$ with $y \\in R$ for some $n > 0$ then \n    \n      \n  \\[  x^ n \\in \\mathfrak q \\Rightarrow y \\in \\mathfrak p \\Rightarrow x^ n \\in \\mathfrak q\'  \\]\n\n    \n       which is a contradiction. Hence there does not exist an $x$ as above and we conclude that $\\mathfrak q = \\mathfrak q\'$, i.e., the map on spectra is injective. By assumption (2) the kernel $I = \\mathop{\\mathrm{Ker}}(\\varphi )$ is contained in every prime, hence $\\mathop{\\mathrm{Spec}}(R) = \\mathop{\\mathrm{Spec}}(R/I)$ as topological spaces. As the induced map $R/I \\to S$ is integral by assumption (1) Lemma 10.36.17 shows that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R/I)$ is surjective. Combining the above we see that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is bijective. If $x \\in S$ is arbitrary, and we pick $y \\in R$ such that $\\varphi (y) = x^ n$ for some $n > 0$, then we see that the open $D(x) \\subset \\mathop{\\mathrm{Spec}}(S)$ corresponds to the open $D(y) \\subset \\mathop{\\mathrm{Spec}}(R)$ via the bijection above. Hence we see that the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is a homeomorphism. \n    \n      To see the statement on residue fields, let $\\mathfrak q \\subset S$ be a prime lying over a prime ideal $\\mathfrak p \\subset R$. Let $x \\in \\kappa (\\mathfrak q)$. If we think of $\\kappa (\\mathfrak q)$ as the residue field of the local ring $S_\\mathfrak q$, then we see that $x$ is the image of some $y/z \\in S_\\mathfrak q$ with $y \\in S$, $z \\in S$, $z \\not\\in \\mathfrak q$. Choose $n, m > 0$ such that $y^ n, z^ m$ are in the image of $\\varphi $. Then $x^{nm}$ is the residue of $(y/z)^{nm} = (y^ n)^ m/(z^ m)^ n$ which is in the image of $R_\\mathfrak p \\to S_\\mathfrak q$. Hence $x^{nm}$ is in the image of $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak q)$. \n      $\\square$\n    \n","\n  Lemma 10.46.3. Let $\\varphi : R \\to S$ be a ring map. If \n  \n  \nfor any $x \\in S$ there exists $n > 0$ such that $x^ n$ is in the image of $\\varphi $, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   then $\\varphi $ induces a homeomorphism on spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.2. \n\n    \n","Proof.\n      Assume (1) and (2). Let $\\mathfrak q, \\mathfrak q\'$ be primes of $S$ lying over the same prime ideal $\\mathfrak p$ of $R$. Suppose $x \\in S$ with $x \\in \\mathfrak q$, $x \\not\\in \\mathfrak q\'$. Then $x^ n \\in \\mathfrak q$ and $x^ n \\not\\in \\mathfrak q\'$ for all $n > 0$. If $x^ n = \\varphi (y)$ with $y \\in R$ for some $n > 0$ then \n    \n      \n  \\[  x^ n \\in \\mathfrak q \\Rightarrow y \\in \\mathfrak p \\Rightarrow x^ n \\in \\mathfrak q\'  \\]\n\n    \n       which is a contradiction. Hence there does not exist an $x$ as above and we conclude that $\\mathfrak q = \\mathfrak q\'$, i.e., the map on spectra is injective. By assumption (2) the kernel $I = \\mathop{\\mathrm{Ker}}(\\varphi )$ is contained in every prime, hence $\\mathop{\\mathrm{Spec}}(R) = \\mathop{\\mathrm{Spec}}(R/I)$ as topological spaces. As the induced map $R/I \\to S$ is integral by assumption (1) Lemma 10.36.17 shows that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R/I)$ is surjective. Combining the above we see that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is bijective. If $x \\in S$ is arbitrary, and we pick $y \\in R$ such that $\\varphi (y) = x^ n$ for some $n > 0$, then we see that the open $D(x) \\subset \\mathop{\\mathrm{Spec}}(S)$ corresponds to the open $D(y) \\subset \\mathop{\\mathrm{Spec}}(R)$ via the bijection above. Hence we see that the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is a homeomorphism. \n    \n      To see the statement on residue fields, let $\\mathfrak q \\subset S$ be a prime lying over a prime ideal $\\mathfrak p \\subset R$. Let $x \\in \\kappa (\\mathfrak q)$. If we think of $\\kappa (\\mathfrak q)$ as the residue field of the local ring $S_\\mathfrak q$, then we see that $x$ is the image of some $y/z \\in S_\\mathfrak q$ with $y \\in S$, $z \\in S$, $z \\not\\in \\mathfrak q$. Choose $n, m > 0$ such that $y^ n, z^ m$ are in the image of $\\varphi $. Then $x^{nm}$ is the residue of $(y/z)^{nm} = (y^ n)^ m/(z^ m)^ n$ which is in the image of $R_\\mathfrak p \\to S_\\mathfrak q$. Hence $x^{nm}$ is in the image of $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak q)$. \n      $\\square$\n    \n"," by
  have h1 : Function.Injective (comap f) := by
    intro q q' hqq'
    ext x
    obtain ‚ü®n, hn, y, hy‚ü© := H x
    rw [‚Üê q.2.pow_mem_iff_mem _ hn, ‚Üê q'.2.pow_mem_iff_mem _ hn, ‚Üê hy]
    rw [PrimeSpectrum.ext_iff, SetLike.ext_iff] at hqq'
    apply hqq'
  have hint : f.kerLift.IsIntegral := fun x ‚Ü¶
    have ‚ü®n, hn, y, hy‚ü© := H x
    let _ := f.kerLift.toAlgebra
    IsIntegral.of_pow hn (hy ‚ñ∏ f.kerLift.isIntegralElem_map (x := ‚ü¶y‚üß))
  have hbij : Function.Bijective (comap f) :=
    ‚ü®h1, (comap_quotientMk_bijective_of_le_nilradical hker).2.comp <|
      hint.comap_surjective f.kerLift_injective‚ü©
  refine ‚ü®continuous_comap f, ?_, h1, hbij.2‚ü©
  rw [isTopologicalBasis_basic_opens.isOpenMap_iff]
  rintro - ‚ü®s, rfl‚ü©
  obtain ‚ü®n, hn, r, hr‚ü© := H s
  have : (comap f) '' (basicOpen s) = basicOpen r :=
    (Set.eq_preimage_iff_image_eq hbij).mp <| by rw [‚Üê basicOpen_pow _ n hn, ‚Üê hr]; rfl
  exact this ‚ñ∏ isOpen_basicOpen
","lemma PrimeSpectrum.isHomeomorph_comap (f : R ‚Üí+* S) (H : ‚àÄ (x : S), ‚àÉ n > 0, x ^ n ‚àà f.range)
    (hker : RingHom.ker f ‚â§ nilradical R) : IsHomeomorph (comap f) ","Proof.\n      Assume (1) and (2). Let $\\mathfrak q, \\mathfrak q\'$ be primes of $S$ lying over the same prime ideal $\\mathfrak p$ of $R$. Suppose $x \\in S$ with $x \\in \\mathfrak q$, $x \\not\\in \\mathfrak q\'$. Then $x^ n \\in \\mathfrak q$ and $x^ n \\not\\in \\mathfrak q\'$ for all $n > 0$. If $x^ n = \\varphi (y)$ with $y \\in R$ for some $n > 0$ then \n    \n      \n  \\[  x^ n \\in \\mathfrak q \\Rightarrow y \\in \\mathfrak p \\Rightarrow x^ n \\in \\mathfrak q\'  \\]\n\n    \n       which is a contradiction. Hence there does not exist an $x$ as above and we conclude that $\\mathfrak q = \\mathfrak q\'$, i.e., the map on spectra is injective. By assumption (2) the kernel $I = \\mathop{\\mathrm{Ker}}(\\varphi )$ is contained in every prime, hence $\\mathop{\\mathrm{Spec}}(R) = \\mathop{\\mathrm{Spec}}(R/I)$ as topological spaces. As the induced map $R/I \\to S$ is integral by assumption (1) Lemma 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] shows that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R/I)$ is surjective. Combining the above we see that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is bijective. If $x \\in S$ is arbitrary, and we pick $y \\in R$ such that $\\varphi (y) = x^ n$ for some $n > 0$, then we see that the open $D(x) \\subset \\mathop{\\mathrm{Spec}}(S)$ corresponds to the open $D(y) \\subset \\mathop{\\mathrm{Spec}}(R)$ via the bijection above. Hence we see that the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is a homeomorphism. \n    \n      To see the statement on residue fields, let $\\mathfrak q \\subset S$ be a prime lying over a prime ideal $\\mathfrak p \\subset R$. Let $x \\in \\kappa (\\mathfrak q)$. If we think of $\\kappa (\\mathfrak q)$ as the residue field of the local ring $S_\\mathfrak q$, then we see that $x$ is the image of some $y/z \\in S_\\mathfrak q$ with $y \\in S$, $z \\in S$, $z \\not\\in \\mathfrak q$. Choose $n, m > 0$ such that $y^ n, z^ m$ are in the image of $\\varphi $. Then $x^{nm}$ is the residue of $(y/z)^{nm} = (y^ n)^ m/(z^ m)^ n$ which is in the image of $R_\\mathfrak p \\to S_\\mathfrak q$. Hence $x^{nm}$ is in the image of $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak q)$. \n      $\\square$\n    \n","Proof.\n      Assume (1) and (2). Let $\\mathfrak q, \\mathfrak q\'$ be primes of $S$ lying over the same prime ideal $\\mathfrak p$ of $R$. Suppose $x \\in S$ with $x \\in \\mathfrak q$, $x \\not\\in \\mathfrak q\'$. Then $x^ n \\in \\mathfrak q$ and $x^ n \\not\\in \\mathfrak q\'$ for all $n > 0$. If $x^ n = \\varphi (y)$ with $y \\in R$ for some $n > 0$ then \n    \n      \n  \\[  x^ n \\in \\mathfrak q \\Rightarrow y \\in \\mathfrak p \\Rightarrow x^ n \\in \\mathfrak q\'  \\]\n\n    \n       which is a contradiction. Hence there does not exist an $x$ as above and we conclude that $\\mathfrak q = \\mathfrak q\'$, i.e., the map on spectra is injective. By assumption (2) the kernel $I = \\mathop{\\mathrm{Ker}}(\\varphi )$ is contained in every prime, hence $\\mathop{\\mathrm{Spec}}(R) = \\mathop{\\mathrm{Spec}}(R/I)$ as topological spaces. As the induced map $R/I \\to S$ is integral by assumption (1) Lemma 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] shows that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R/I)$ is surjective. Combining the above we see that $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is bijective. If $x \\in S$ is arbitrary, and we pick $y \\in R$ such that $\\varphi (y) = x^ n$ for some $n > 0$, then we see that the open $D(x) \\subset \\mathop{\\mathrm{Spec}}(S)$ corresponds to the open $D(y) \\subset \\mathop{\\mathrm{Spec}}(R)$ via the bijection above. Hence we see that the map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is a homeomorphism. \n    \n      To see the statement on residue fields, let $\\mathfrak q \\subset S$ be a prime lying over a prime ideal $\\mathfrak p \\subset R$. Let $x \\in \\kappa (\\mathfrak q)$. If we think of $\\kappa (\\mathfrak q)$ as the residue field of the local ring $S_\\mathfrak q$, then we see that $x$ is the image of some $y/z \\in S_\\mathfrak q$ with $y \\in S$, $z \\in S$, $z \\not\\in \\mathfrak q$. Choose $n, m > 0$ such that $y^ n, z^ m$ are in the image of $\\varphi $. Then $x^{nm}$ is the residue of $(y/z)^{nm} = (y^ n)^ m/(z^ m)^ n$ which is in the image of $R_\\mathfrak p \\to S_\\mathfrak q$. Hence $x^{nm}$ is in the image of $\\kappa (\\mathfrak p) \\to \\kappa (\\mathfrak q)$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Homeomorphism part","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the ‚Äúhomeomorphism part‚Äù of the informal argument: it proves injectivity of the comap on prime spectra (h1) using the existence of n,y with x^n = f(y) (the hypothesis H), then proves integrality of the induced map from the quotient by ker (hint), uses surjectivity of comap for integral extensions together with the identification Spec R ‚âÉ Spec (R/ker) under a nilradical condition (comap_quotientMk_bijective_of_le_nilradical hker) to get bijectivity (hbij), and finally shows the map is open on a basis of basic opens by transporting D(s) to D(r) via the bijection and the relation s^n = f(r) (the last block). Structurally, this mirrors the informal steps: injective ‚Üí reduce to quotient by kernel/nilradical ‚Üí integral implies surjective ‚Üí bijective ‚Üí basic opens correspond, hence homeomorphism. The main mismatch is that the informal proof explicitly argues Spec(R)=Spec(R/I) because I is in every prime (i.e. I ‚äÜ nilradical), while the Lean proof encodes this via the specific lemma requiring hker and composes bijections; also the informal text includes an additional residue field statement not present in the Lean snippet. Given the user note to focus on the homeomorphism part, the alignment is strong but not perfect due to these differences/omissions.""}"
339,0BRA,"lemma PrimeSpectrum.isHomeomorph_comap_of_isPurelyInseparable [IsPurelyInseparable k K] :
    IsHomeomorph (comap <| algebraMap R (R ‚äó[k] K)) := by
  let q := ringExpChar k
  refine isHomeomorph_comap _ (IsPurelyInseparable.exists_pow_mem_range_tensorProduct) ?_
  convert bot_le
  rw [‚Üê RingHom.injective_iff_ker_eq_bot]
  exact Algebra.TensorProduct.includeLeft_injective (S := R) (algebraMap k K).injective
",Formal Proof of Stacks Project Tag 0BRA,Special case for purely inseparable field extensions,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Homeomorph.lean#L65-L71,Q27041,,10.46.7,lemma,3.0,"['0BR5', '00AO', '0ELQ']","\n  Lemma 10.46.7. Let $\\varphi : R \\to S$ be a ring map. Let $p$ be a prime number. Assume \n  \n  \n$S$ is generated as an $R$-algebra by elements $x$ such that there exists an $n > 0$ with $x^{p^ n} \\in \\varphi (R)$ and $p^ nx \\in \\varphi (R)$, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   Then $\\varphi $ induces a homeomorphism of spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.6. For any ring map $R \\to R\'$ the ring map $R\' \\to R\' \\otimes _ R S$ also satisfies (a) and (b). \n\n    \n      Proof.\n      Assume (a) and (b). Note that (b) is equivalent to condition (2) of Lemma 10.46.3. Let $T \\subset S$ be the set of elements $x \\in S$ such that there exists an integer $n > 0$ such that $x^{p^ n} , p^ n x \\in \\varphi (R)$. We claim that $T = S$. This will prove that condition (1) of Lemma 10.46.3 holds and hence $\\varphi $ induces a homeomorphism on spectra. By assumption (a) it suffices to show that $T \\subset S$ is an $R$-sub algebra. If $x \\in T$ and $y \\in R$, then it is clear that $yx \\in T$. Suppose $x, y \\in T$ and $n, m > 0$ such that $x^{p^ n}, y^{p^ m}, p^ n x, p^ m y \\in \\varphi (R)$. Then $(xy)^{p^{n + m}}, p^{n + m}xy \\in \\varphi (R)$ hence $xy \\in T$. We have $x + y \\in T$ by Lemma 10.46.5 and the claim is proved. \n    \n      Since $\\varphi $ induces a homeomorphism on spectra, it is in particular surjective on spectra which is a property preserved under any base change, see Lemma 10.30.3. Therefore for any $R \\to R\'$ the kernel of the ring map $R\' \\to R\' \\otimes _ R S$ consists of nilpotent elements, see Lemma 10.30.6, in other words (b) holds for $R\' \\to R\' \\otimes _ R S$. It is clear that (a) is preserved under base change. Finally, the condition on residue fields follows from (a) as generators for $S$ as an $R$-algebra map to generators for the residue field extensions. \n      $\\square$\n    \n","\n  Lemma 10.46.7. Let $\\varphi : R \\to S$ be a ring map. Let $p$ be a prime number. Assume \n  \n  \n$S$ is generated as an $R$-algebra by elements $x$ such that there exists an $n > 0$ with $x^{p^ n} \\in \\varphi (R)$ and $p^ nx \\in \\varphi (R)$, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   Then $\\varphi $ induces a homeomorphism of spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.6. For any ring map $R \\to R\'$ the ring map $R\' \\to R\' \\otimes _ R S$ also satisfies (a) and (b). \n\n    \n","Proof.\n      Assume (a) and (b). Note that (b) is equivalent to condition (2) of Lemma 10.46.3. Let $T \\subset S$ be the set of elements $x \\in S$ such that there exists an integer $n > 0$ such that $x^{p^ n} , p^ n x \\in \\varphi (R)$. We claim that $T = S$. This will prove that condition (1) of Lemma 10.46.3 holds and hence $\\varphi $ induces a homeomorphism on spectra. By assumption (a) it suffices to show that $T \\subset S$ is an $R$-sub algebra. If $x \\in T$ and $y \\in R$, then it is clear that $yx \\in T$. Suppose $x, y \\in T$ and $n, m > 0$ such that $x^{p^ n}, y^{p^ m}, p^ n x, p^ m y \\in \\varphi (R)$. Then $(xy)^{p^{n + m}}, p^{n + m}xy \\in \\varphi (R)$ hence $xy \\in T$. We have $x + y \\in T$ by Lemma 10.46.5 and the claim is proved. \n    \n      Since $\\varphi $ induces a homeomorphism on spectra, it is in particular surjective on spectra which is a property preserved under any base change, see Lemma 10.30.3. Therefore for any $R \\to R\'$ the kernel of the ring map $R\' \\to R\' \\otimes _ R S$ consists of nilpotent elements, see Lemma 10.30.6, in other words (b) holds for $R\' \\to R\' \\otimes _ R S$. It is clear that (a) is preserved under base change. Finally, the condition on residue fields follows from (a) as generators for $S$ as an $R$-algebra map to generators for the residue field extensions. \n      $\\square$\n    \n"," by
  let q := ringExpChar k
  refine isHomeomorph_comap _ (IsPurelyInseparable.exists_pow_mem_range_tensorProduct) ?_
  convert bot_le
  rw [‚Üê RingHom.injective_iff_ker_eq_bot]
  exact Algebra.TensorProduct.includeLeft_injective (S := R) (algebraMap k K).injective
","lemma PrimeSpectrum.isHomeomorph_comap_of_isPurelyInseparable [IsPurelyInseparable k K] :
    IsHomeomorph (comap <| algebraMap R (R ‚äó[k] K)) ","Proof.\n      Assume (a) and (b). Note that (b) is equivalent to condition (2) of Lemma 10.46.3 [[\n  Lemma 10.46.3. Let $\\varphi : R \\to S$ be a ring map. If \n  \n  \nfor any $x \\in S$ there exists $n > 0$ such that $x^ n$ is in the image of $\\varphi $, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   then $\\varphi $ induces a homeomorphism on spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.2. \n\n    \n]]. Let $T \\subset S$ be the set of elements $x \\in S$ such that there exists an integer $n > 0$ such that $x^{p^ n} , p^ n x \\in \\varphi (R)$. We claim that $T = S$. This will prove that condition (1) of Lemma 10.46.3 [[\n  Lemma 10.46.3. Let $\\varphi : R \\to S$ be a ring map. If \n  \n  \nfor any $x \\in S$ there exists $n > 0$ such that $x^ n$ is in the image of $\\varphi $, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   then $\\varphi $ induces a homeomorphism on spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.2. \n\n    \n]] holds and hence $\\varphi $ induces a homeomorphism on spectra. By assumption (a) it suffices to show that $T \\subset S$ is an $R$-sub algebra. If $x \\in T$ and $y \\in R$, then it is clear that $yx \\in T$. Suppose $x, y \\in T$ and $n, m > 0$ such that $x^{p^ n}, y^{p^ m}, p^ n x, p^ m y \\in \\varphi (R)$. Then $(xy)^{p^{n + m}}, p^{n + m}xy \\in \\varphi (R)$ hence $xy \\in T$. We have $x + y \\in T$ by Lemma 10.46.5 [[\n  Lemma 10.46.5. Let $p$ be a prime number. Let $n, m > 0$ be two integers. There exists an integer $a$ such that $(x + y)^{p^ a}, p^ a(x + y) \\in \\mathbf{Z}[x^{p^ n}, p^ nx, y^{p^ m}, p^ my]$. \n\n    \n]] and the claim is proved. \n    \n      Since $\\varphi $ induces a homeomorphism on spectra, it is in particular surjective on spectra which is a property preserved under any base change, see Lemma 10.30.3 [[\n  Lemma 10.30.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n\nFor any ideal $I \\subset R$ the inverse image of $\\sqrt{IS}$ in $R$ is equal to $\\sqrt{I}$. \n\n\nFor any radical ideal $I \\subset R$ the inverse image of $IS$ in $R$ is equal to $I$. \n\n\nFor every prime $\\mathfrak p$ of $R$ the inverse image of $\\mathfrak p S$ in $R$ is $\\mathfrak p$. \n\n\n\n   In this case the same is true after any base change: Given a ring map $R \\to R\'$ the ring map $R\' \\to R\' \\otimes _ R S$ has the equivalent properties (1), (2), (3) as well. \n\n    \n]]. Therefore for any $R \\to R\'$ the kernel of the ring map $R\' \\to R\' \\otimes _ R S$ consists of nilpotent elements, see Lemma 10.30.6 [[\n  Lemma 10.30.6. Let $R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe kernel of $R \\to S$ consists of nilpotent elements. \n\n\nThe minimal primes of $R$ are in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. \n\n\nThe image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is dense in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\n\n\n    \n]], in other words (b) holds for $R\' \\to R\' \\otimes _ R S$. It is clear that (a) is preserved under base change. Finally, the condition on residue fields follows from (a) as generators for $S$ as an $R$-algebra map to generators for the residue field extensions. \n      $\\square$\n    \n","Proof.\n      Assume (a) and (b). Note that (b) is equivalent to condition (2) of Lemma 10.46.3 [[\n  Lemma 10.46.3. Let $\\varphi : R \\to S$ be a ring map. If \n  \n  \nfor any $x \\in S$ there exists $n > 0$ such that $x^ n$ is in the image of $\\varphi $, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   then $\\varphi $ induces a homeomorphism on spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.2. \n\n    \n]]. Let $T \\subset S$ be the set of elements $x \\in S$ such that there exists an integer $n > 0$ such that $x^{p^ n} , p^ n x \\in \\varphi (R)$. We claim that $T = S$. This will prove that condition (1) of Lemma 10.46.3 [[\n  Lemma 10.46.3. Let $\\varphi : R \\to S$ be a ring map. If \n  \n  \nfor any $x \\in S$ there exists $n > 0$ such that $x^ n$ is in the image of $\\varphi $, and \n\n\n$\\mathop{\\mathrm{Ker}}(\\varphi )$ is locally nilpotent, \n\n\n\n   then $\\varphi $ induces a homeomorphism on spectra and induces residue field extensions satisfying the equivalent conditions of Lemma 10.46.2. \n\n    \n]] holds and hence $\\varphi $ induces a homeomorphism on spectra. By assumption (a) it suffices to show that $T \\subset S$ is an $R$-sub algebra. If $x \\in T$ and $y \\in R$, then it is clear that $yx \\in T$. Suppose $x, y \\in T$ and $n, m > 0$ such that $x^{p^ n}, y^{p^ m}, p^ n x, p^ m y \\in \\varphi (R)$. Then $(xy)^{p^{n + m}}, p^{n + m}xy \\in \\varphi (R)$ hence $xy \\in T$. We have $x + y \\in T$ by Lemma 10.46.5 [[\n  Lemma 10.46.5. Let $p$ be a prime number. Let $n, m > 0$ be two integers. There exists an integer $a$ such that $(x + y)^{p^ a}, p^ a(x + y) \\in \\mathbf{Z}[x^{p^ n}, p^ nx, y^{p^ m}, p^ my]$. \n\n    \n]] and the claim is proved. \n    \n      Since $\\varphi $ induces a homeomorphism on spectra, it is in particular surjective on spectra which is a property preserved under any base change, see Lemma 10.30.3 [[\n  Lemma 10.30.3. Let $\\varphi : R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe map $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n\nFor any ideal $I \\subset R$ the inverse image of $\\sqrt{IS}$ in $R$ is equal to $\\sqrt{I}$. \n\n\nFor any radical ideal $I \\subset R$ the inverse image of $IS$ in $R$ is equal to $I$. \n\n\nFor every prime $\\mathfrak p$ of $R$ the inverse image of $\\mathfrak p S$ in $R$ is $\\mathfrak p$. \n\n\n\n   In this case the same is true after any base change: Given a ring map $R \\to R\'$ the ring map $R\' \\to R\' \\otimes _ R S$ has the equivalent properties (1), (2), (3) as well. \n\n    \n]]. Therefore for any $R \\to R\'$ the kernel of the ring map $R\' \\to R\' \\otimes _ R S$ consists of nilpotent elements, see Lemma 10.30.6 [[\n  Lemma 10.30.6. Let $R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe kernel of $R \\to S$ consists of nilpotent elements. \n\n\nThe minimal primes of $R$ are in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. \n\n\nThe image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is dense in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\n\n\n    \n]], in other words (b) holds for $R\' \\to R\' \\otimes _ R S$. It is clear that (a) is preserved under base change. Finally, the condition on residue fields follows from (a) as generators for $S$ as an $R$-algebra map to generators for the residue field extensions. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Special case for purely inseparable field extensions","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is a very short argument establishing a homeomorphism on spectra via `isHomeomorph_comap` using a purely inseparable ‚Äúpower in range‚Äù lemma (`IsPurelyInseparable.exists_pow_mem_range_tensorProduct`) and then discharging the kernel condition by showing the relevant map is injective (kernel = ‚ä•) using `Algebra.TensorProduct.includeLeft_injective`. This matches only a small slice of the informal proof: the informal argument is about verifying the hypotheses of a general lemma (Stacks Lemma 10.46.3) by constructing a subalgebra T closed under + and * using a binomial/p-power lemma, then deducing homeomorphism and discussing stability under base change and residue field conditions. Structurally, the informal proof is multi-step (define T, prove T=S, apply lemma, then base change and residue fields), whereas the Lean proof skips all of that and directly applies a specialized lemma for purely inseparable extensions and an injectivity/kernel computation. Thus there is partial semantic overlap (homeomorphism via p-power condition in a purely inseparable special case), but major structural and completeness mismatch: the Lean proof does not reflect the T-subalgebra construction, the use of Lemma 10.46.5, the base change discussion, or residue field statements.""}"
340,00FB,"theorem isOpenMap_comap_C : IsOpenMap (PrimeSpectrum.comap (C : R ‚Üí+* R[X])) := by
  rintro U ‚ü®s, z‚ü©
  rw [‚Üê compl_compl U, ‚Üê z, ‚Üê iUnion_of_singleton_coe s, zeroLocus_iUnion, compl_iInter,
    image_iUnion]
  simp_rw [‚Üê imageOfDf_eq_comap_C_compl_zeroLocus]
  exact isOpen_iUnion fun f => isOpen_imageOfDf
",Formal Proof of Stacks Project Tag 00FB,First part,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/IsOpenComapC.lean#L68-L73,Q27041,,10.29.7,lemma,3.0,"['00F5', '00AO', '0ELQ']","\n  Lemma 10.29.7. Let $R$ be a ring. The map $\\mathop{\\mathrm{Spec}}(R[x]) \\to \\mathop{\\mathrm{Spec}}(R)$ is open, and the image of any standard open is a quasi-compact open. \n\n    \n      Proof.\n      It suffices to show that the image of a standard open $D(f)$, $f\\in R[x]$ is quasi-compact open. The image of $D(f)$ is the image of $\\mathop{\\mathrm{Spec}}(R[x]_ f) \\to \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset R$ be a prime ideal. Let $\\overline{f}$ be the image of $f$ in $\\kappa (\\mathfrak p)[x]$. Recall, see Lemma 10.18.6, that $\\mathfrak p$ is in the image if and only if $R[x]_ f \\otimes _ R \\kappa (\\mathfrak p) = \\kappa (\\mathfrak p)[x]_{\\overline{f}}$ is not the zero ring. This is exactly the condition that $f$ does not map to zero in $\\kappa (\\mathfrak p)[x]$, in other words, that some coefficient of $f$ is not in $\\mathfrak p$. Hence we see: if $f = a_ d x^ d + \\ldots + a_0$, then the image of $D(f)$ is $D(a_ d) \\cup \\ldots \\cup D(a_0)$. \n      $\\square$\n    \n","\n  Lemma 10.29.7. Let $R$ be a ring. The map $\\mathop{\\mathrm{Spec}}(R[x]) \\to \\mathop{\\mathrm{Spec}}(R)$ is open, and the image of any standard open is a quasi-compact open. \n\n    \n","Proof.\n      It suffices to show that the image of a standard open $D(f)$, $f\\in R[x]$ is quasi-compact open. The image of $D(f)$ is the image of $\\mathop{\\mathrm{Spec}}(R[x]_ f) \\to \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset R$ be a prime ideal. Let $\\overline{f}$ be the image of $f$ in $\\kappa (\\mathfrak p)[x]$. Recall, see Lemma 10.18.6, that $\\mathfrak p$ is in the image if and only if $R[x]_ f \\otimes _ R \\kappa (\\mathfrak p) = \\kappa (\\mathfrak p)[x]_{\\overline{f}}$ is not the zero ring. This is exactly the condition that $f$ does not map to zero in $\\kappa (\\mathfrak p)[x]$, in other words, that some coefficient of $f$ is not in $\\mathfrak p$. Hence we see: if $f = a_ d x^ d + \\ldots + a_0$, then the image of $D(f)$ is $D(a_ d) \\cup \\ldots \\cup D(a_0)$. \n      $\\square$\n    \n"," by
  rintro U ‚ü®s, z‚ü©
  rw [‚Üê compl_compl U, ‚Üê z, ‚Üê iUnion_of_singleton_coe s, zeroLocus_iUnion, compl_iInter,
    image_iUnion]
  simp_rw [‚Üê imageOfDf_eq_comap_C_compl_zeroLocus]
  exact isOpen_iUnion fun f => isOpen_imageOfDf
",theorem isOpenMap_comap_C : IsOpenMap (PrimeSpectrum.comap (C : R ‚Üí+* R[X])) ,"Proof.\n      It suffices to show that the image of a standard open $D(f)$, $f\\in R[x]$ is quasi-compact open. The image of $D(f)$ is the image of $\\mathop{\\mathrm{Spec}}(R[x]_ f) \\to \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset R$ be a prime ideal. Let $\\overline{f}$ be the image of $f$ in $\\kappa (\\mathfrak p)[x]$. Recall, see Lemma 10.18.6 [[\n  Lemma 10.18.6. Let $\\varphi : R \\to S$ be a ring map. Let $\\mathfrak p$ be a prime of $R$. The following are equivalent \n  \n  \n$\\mathfrak p$ is in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$S \\otimes _ R \\kappa (\\mathfrak p) \\not= 0$, \n\n\n$S_{\\mathfrak p}/\\mathfrak p S_{\\mathfrak p} \\not= 0$, \n\n\n$(S/\\mathfrak pS)_{\\mathfrak p} \\not= 0$, and \n\n\n$\\mathfrak p = \\varphi ^{-1}(\\mathfrak pS)$. \n\n\n\n\n    \n]], that $\\mathfrak p$ is in the image if and only if $R[x]_ f \\otimes _ R \\kappa (\\mathfrak p) = \\kappa (\\mathfrak p)[x]_{\\overline{f}}$ is not the zero ring. This is exactly the condition that $f$ does not map to zero in $\\kappa (\\mathfrak p)[x]$, in other words, that some coefficient of $f$ is not in $\\mathfrak p$. Hence we see: if $f = a_ d x^ d + \\ldots + a_0$, then the image of $D(f)$ is $D(a_ d) \\cup \\ldots \\cup D(a_0)$. \n      $\\square$\n    \n","Proof.\n      It suffices to show that the image of a standard open $D(f)$, $f\\in R[x]$ is quasi-compact open. The image of $D(f)$ is the image of $\\mathop{\\mathrm{Spec}}(R[x]_ f) \\to \\mathop{\\mathrm{Spec}}(R)$. Let $\\mathfrak p \\subset R$ be a prime ideal. Let $\\overline{f}$ be the image of $f$ in $\\kappa (\\mathfrak p)[x]$. Recall, see Lemma 10.18.6 [[\n  Lemma 10.18.6. Let $\\varphi : R \\to S$ be a ring map. Let $\\mathfrak p$ be a prime of $R$. The following are equivalent \n  \n  \n$\\mathfrak p$ is in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$, \n\n\n$S \\otimes _ R \\kappa (\\mathfrak p) \\not= 0$, \n\n\n$S_{\\mathfrak p}/\\mathfrak p S_{\\mathfrak p} \\not= 0$, \n\n\n$(S/\\mathfrak pS)_{\\mathfrak p} \\not= 0$, and \n\n\n$\\mathfrak p = \\varphi ^{-1}(\\mathfrak pS)$. \n\n\n\n\n    \n]], that $\\mathfrak p$ is in the image if and only if $R[x]_ f \\otimes _ R \\kappa (\\mathfrak p) = \\kappa (\\mathfrak p)[x]_{\\overline{f}}$ is not the zero ring. This is exactly the condition that $f$ does not map to zero in $\\kappa (\\mathfrak p)[x]$, in other words, that some coefficient of $f$ is not in $\\mathfrak p$. Hence we see: if $f = a_ d x^ d + \\ldots + a_0$, then the image of $D(f)$ is $D(a_ d) \\cup \\ldots \\cup D(a_0)$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: First part","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof identifies the image of a basic open D(f) in Spec(R[x]) under the structure map as a finite union of basic opens D(a_i) in Spec(R), using a fiber criterion (tensor with Œ∫(p) nonzero) to characterize which primes lie in the image. The Lean proof instead rewrites an arbitrary open set U (presented as ‚ü®s, z‚ü©) via complements, unions/intersections, and zero loci, then concludes openness by expressing it as a union of opens and using lemmas like `imageOfDf_eq_comap_C_compl_zeroLocus` and `isOpen_imageOfDf`. Structurally, the Lean argument is purely topological/set-theoretic (manipulating `iUnion`, `iInter`, `compl`, `zeroLocus`) and proves openness via `isOpen_iUnion`, whereas the informal argument is algebraic and computes the image explicitly as a finite union of standard opens using coefficients and a prime-by-prime criterion. There is partial thematic overlap (both concern images of standard opens D(f) and their openness), but the Lean proof does not reflect the key algebraic step (image = ‚ãÉ D(a_i)) nor the quasi-compactness/finite union aspect emphasized informally, and it uses different intermediate characterizations. Hence the alignment is low-to-moderate rather than strong.""}"
341,00JA,"""See also `PrimeSpectrum.discreteTopology_iff_finite_isMaximal_and_sInf_le_nilradical`.""]
def _root_.MaximalSpectrum.toPiLocalizationEquiv :
    R ‚âÉ+* MaximalSpectrum.PiLocalization R :=
  .ofBijective _ ‚ü®MaximalSpectrum.toPiLocalization_injective R,
    maximalSpectrumToPiLocalization_surjective_of_discreteTopology R‚ü©
",Formal Proof of Stacks Project Tag 00JA,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Topology.lean#L713-L717,Q27041,,10.53.5,lemma,3.0,"['00J4', '00AO', '0ELQ']","\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n      Proof.\n      Let $R$ be a ring with finitely many maximal ideals $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$. Let $I = \\bigcap _{i = 1}^ n \\mathfrak m_ i$ be the Jacobson radical of $R$. Assume $I$ is locally nilpotent. Let $\\mathfrak p$ be a prime ideal of $R$. Since every prime contains every nilpotent element of $R$ we see $ \\mathfrak p \\supset \\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n$. Since $\\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$ we conclude $\\mathfrak p \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$. Hence $\\mathfrak p \\supset \\mathfrak m_ i$ for some $i$, and so $\\mathfrak p = \\mathfrak m_ i$. Thus the spectrum of $R$ is the discrete topological space $\\{ \\mathfrak m_1, \\ldots , \\mathfrak m_ n\\} $. By Lemma 10.24.3 applied $n - 1$ times we find that $R = R_1 \\times \\ldots \\times R_ n$ where the spectrum of $R_ i$ is a singleton for each $i$. Thus $R_ i$ is a local ring and since it is a localization of $R$ (by the lemma), it is one of the local rings of $R$ as desired. \n      $\\square$\n    \n","\n  Lemma 10.53.5. Any ring with finitely many maximal ideals and locally nilpotent Jacobson radical is the product of its localizations at its maximal ideals. Also, all primes are maximal. \n\n    \n","Proof.\n      Let $R$ be a ring with finitely many maximal ideals $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$. Let $I = \\bigcap _{i = 1}^ n \\mathfrak m_ i$ be the Jacobson radical of $R$. Assume $I$ is locally nilpotent. Let $\\mathfrak p$ be a prime ideal of $R$. Since every prime contains every nilpotent element of $R$ we see $ \\mathfrak p \\supset \\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n$. Since $\\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$ we conclude $\\mathfrak p \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$. Hence $\\mathfrak p \\supset \\mathfrak m_ i$ for some $i$, and so $\\mathfrak p = \\mathfrak m_ i$. Thus the spectrum of $R$ is the discrete topological space $\\{ \\mathfrak m_1, \\ldots , \\mathfrak m_ n\\} $. By Lemma 10.24.3 applied $n - 1$ times we find that $R = R_1 \\times \\ldots \\times R_ n$ where the spectrum of $R_ i$ is a singleton for each $i$. Thus $R_ i$ is a local ring and since it is a localization of $R$ (by the lemma), it is one of the local rings of $R$ as desired. \n      $\\square$\n    \n","
  .ofBijective _ ‚ü®MaximalSpectrum.toPiLocalization_injective R,
    maximalSpectrumToPiLocalization_surjective_of_discreteTopology R‚ü©
","""See also `PrimeSpectrum.discreteTopology_iff_finite_isMaximal_and_sInf_le_nilradical`.""]
def _root_.MaximalSpectrum.toPiLocalizationEquiv :
    R ‚âÉ+* MaximalSpectrum.PiLocalization R ","Proof.\n      Let $R$ be a ring with finitely many maximal ideals $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$. Let $I = \\bigcap _{i = 1}^ n \\mathfrak m_ i$ be the Jacobson radical of $R$. Assume $I$ is locally nilpotent. Let $\\mathfrak p$ be a prime ideal of $R$. Since every prime contains every nilpotent element of $R$ we see $ \\mathfrak p \\supset \\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n$. Since $\\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$ we conclude $\\mathfrak p \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$. Hence $\\mathfrak p \\supset \\mathfrak m_ i$ for some $i$, and so $\\mathfrak p = \\mathfrak m_ i$. Thus the spectrum of $R$ is the discrete topological space $\\{ \\mathfrak m_1, \\ldots , \\mathfrak m_ n\\} $. By Lemma 10.24.3 [[\n  Lemma 10.24.3. Let $R$ be a ring. If $\\mathop{\\mathrm{Spec}}(R) = U \\amalg V$ with both $U$ and $V$ open then $R \\cong R_1 \\times R_2$ with $U \\cong \\mathop{\\mathrm{Spec}}(R_1)$ and $V \\cong \\mathop{\\mathrm{Spec}}(R_2)$ via the maps in Lemma 10.21.2. Moreover, both $R_1$ and $R_2$ are localizations as well as quotients of the ring $R$. \n\n    \n]] applied $n - 1$ times we find that $R = R_1 \\times \\ldots \\times R_ n$ where the spectrum of $R_ i$ is a singleton for each $i$. Thus $R_ i$ is a local ring and since it is a localization of $R$ (by the lemma), it is one of the local rings of $R$ as desired. \n      $\\square$\n    \n","Proof.\n      Let $R$ be a ring with finitely many maximal ideals $\\mathfrak m_1, \\ldots , \\mathfrak m_ n$. Let $I = \\bigcap _{i = 1}^ n \\mathfrak m_ i$ be the Jacobson radical of $R$. Assume $I$ is locally nilpotent. Let $\\mathfrak p$ be a prime ideal of $R$. Since every prime contains every nilpotent element of $R$ we see $ \\mathfrak p \\supset \\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n$. Since $\\mathfrak m_1 \\cap \\ldots \\cap \\mathfrak m_ n \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$ we conclude $\\mathfrak p \\supset \\mathfrak m_1 \\ldots \\mathfrak m_ n$. Hence $\\mathfrak p \\supset \\mathfrak m_ i$ for some $i$, and so $\\mathfrak p = \\mathfrak m_ i$. Thus the spectrum of $R$ is the discrete topological space $\\{ \\mathfrak m_1, \\ldots , \\mathfrak m_ n\\} $. By Lemma 10.24.3 [[\n  Lemma 10.24.3. Let $R$ be a ring. If $\\mathop{\\mathrm{Spec}}(R) = U \\amalg V$ with both $U$ and $V$ open then $R \\cong R_1 \\times R_2$ with $U \\cong \\mathop{\\mathrm{Spec}}(R_1)$ and $V \\cong \\mathop{\\mathrm{Spec}}(R_2)$ via the maps in Lemma 10.21.2. Moreover, both $R_1$ and $R_2$ are localizations as well as quotients of the ring $R$. \n\n    \n]] applied $n - 1$ times we find that $R = R_1 \\times \\ldots \\times R_ n$ where the spectrum of $R_ i$ is a singleton for each $i$. Thus $R_ i$ is a local ring and since it is a localization of $R$ (by the lemma), it is one of the local rings of $R$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the formal proof is establishing an isomorphism (via `ofBijective`) by providing injectivity of `MaximalSpectrum.toPiLocalization` and a surjectivity lemma `maximalSpectrumToPiLocalization_surjective_of_discreteTopology`. This corresponds only to the *last step* of the informal argument: once the maximal spectrum is discrete, a certain map to a product of localizations is bijective.\n\nStructurally, the informal proof is much longer and proceeds by: (1) using local nilpotence of the Jacobson radical to show every prime is maximal, hence Spec(R) is a finite discrete space; (2) repeatedly applying a decomposition lemma to get a product decomposition of rings into local factors. None of these key steps (nilpotence ‚áí primes are maximal, discreteness of Spec, iterative decomposition into a product) appear in the formal snippet; it assumes discreteness via the surjectivity lemma‚Äôs hypothesis and only packages injective+surjective into a bijection.\n\nThus the formal proof captures a related endpoint but omits most of the informal proof‚Äôs content and logical structure.""}"
342,00HY,"lemma stableUnderSpecialization_range_iff :
    StableUnderSpecialization (Set.range (comap f)) ‚Üî IsClosed (Set.range (comap f)) :=
  ‚ü®isClosed_range_of_stableUnderSpecialization f, fun h ‚Ü¶ h.stableUnderSpecialization‚ü©
",Formal Proof of Stacks Project Tag 00HY,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Topology.lean#L803-L805,Q27041,,10.41.5,lemma,3.0,"['00HU', '00AO', '0ELQ']","\n  Lemma 10.41.5. Let $R \\to S$ be a ring map. Let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be the image of $\\mathop{\\mathrm{Spec}}(S)$. If $T$ is stable under specialization, then $T$ is closed. \n\n    \n      Proof.\n      We give two proofs. \n    \n      First proof. Let $\\mathfrak p \\subset R$ be a prime ideal such that the corresponding point of $\\mathop{\\mathrm{Spec}}(R)$ is in the closure of $T$. This means that for every $f \\in R$, $f \\not\\in \\mathfrak p$ we have $D(f) \\cap T \\not= \\emptyset $. Note that $D(f) \\cap T$ is the image of $\\mathop{\\mathrm{Spec}}(S_ f)$ in $\\mathop{\\mathrm{Spec}}(R)$. Hence we conclude that $S_ f \\not= 0$. In other words, $1 \\not= 0$ in the ring $S_ f$. Since $S_{\\mathfrak p}$ is the directed colimit of the rings $S_ f$ we conclude that $1 \\not= 0$ in $S_{\\mathfrak p}$. In other words, $S_{\\mathfrak p} \\not= 0$ and considering the image of $\\mathop{\\mathrm{Spec}}(S_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ we see there exists a $\\mathfrak p\' \\in T$ with $\\mathfrak p\' \\subset \\mathfrak p$. As we assumed $T$ closed under specialization we conclude $\\mathfrak p$ is a point of $T$ as desired. \n    \n      Second proof. Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. We may replace $R$ by $R/I$. In this case the ring map $R \\to S$ is injective. By Lemma 10.30.5 all the minimal primes of $R$ are contained in the image $T$. Hence if $T$ is stable under specialization then it contains all primes. \n      $\\square$\n    \n","\n  Lemma 10.41.5. Let $R \\to S$ be a ring map. Let $T \\subset \\mathop{\\mathrm{Spec}}(R)$ be the image of $\\mathop{\\mathrm{Spec}}(S)$. If $T$ is stable under specialization, then $T$ is closed. \n\n    \n","Proof.\n      We give two proofs. \n    \n      First proof. Let $\\mathfrak p \\subset R$ be a prime ideal such that the corresponding point of $\\mathop{\\mathrm{Spec}}(R)$ is in the closure of $T$. This means that for every $f \\in R$, $f \\not\\in \\mathfrak p$ we have $D(f) \\cap T \\not= \\emptyset $. Note that $D(f) \\cap T$ is the image of $\\mathop{\\mathrm{Spec}}(S_ f)$ in $\\mathop{\\mathrm{Spec}}(R)$. Hence we conclude that $S_ f \\not= 0$. In other words, $1 \\not= 0$ in the ring $S_ f$. Since $S_{\\mathfrak p}$ is the directed colimit of the rings $S_ f$ we conclude that $1 \\not= 0$ in $S_{\\mathfrak p}$. In other words, $S_{\\mathfrak p} \\not= 0$ and considering the image of $\\mathop{\\mathrm{Spec}}(S_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ we see there exists a $\\mathfrak p\' \\in T$ with $\\mathfrak p\' \\subset \\mathfrak p$. As we assumed $T$ closed under specialization we conclude $\\mathfrak p$ is a point of $T$ as desired. \n    \n      Second proof. Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. We may replace $R$ by $R/I$. In this case the ring map $R \\to S$ is injective. By Lemma 10.30.5 all the minimal primes of $R$ are contained in the image $T$. Hence if $T$ is stable under specialization then it contains all primes. \n      $\\square$\n    \n","
  ‚ü®isClosed_range_of_stableUnderSpecialization f, fun h ‚Ü¶ h.stableUnderSpecialization‚ü©
","lemma stableUnderSpecialization_range_iff :
    StableUnderSpecialization (Set.range (comap f)) ‚Üî IsClosed (Set.range (comap f)) ","Proof.\n      We give two proofs. \n    \n      First proof. Let $\\mathfrak p \\subset R$ be a prime ideal such that the corresponding point of $\\mathop{\\mathrm{Spec}}(R)$ is in the closure of $T$. This means that for every $f \\in R$, $f \\not\\in \\mathfrak p$ we have $D(f) \\cap T \\not= \\emptyset $. Note that $D(f) \\cap T$ is the image of $\\mathop{\\mathrm{Spec}}(S_ f)$ in $\\mathop{\\mathrm{Spec}}(R)$. Hence we conclude that $S_ f \\not= 0$. In other words, $1 \\not= 0$ in the ring $S_ f$. Since $S_{\\mathfrak p}$ is the directed colimit of the rings $S_ f$ we conclude that $1 \\not= 0$ in $S_{\\mathfrak p}$. In other words, $S_{\\mathfrak p} \\not= 0$ and considering the image of $\\mathop{\\mathrm{Spec}}(S_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ we see there exists a $\\mathfrak p\' \\in T$ with $\\mathfrak p\' \\subset \\mathfrak p$. As we assumed $T$ closed under specialization we conclude $\\mathfrak p$ is a point of $T$ as desired. \n    \n      Second proof. Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. We may replace $R$ by $R/I$. In this case the ring map $R \\to S$ is injective. By Lemma 10.30.5 [[\n  Lemma 10.30.5. Let $R \\subset S$ be an injective ring map. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ hits all the minimal primes. \n\n    \n]] all the minimal primes of $R$ are contained in the image $T$. Hence if $T$ is stable under specialization then it contains all primes. \n      $\\square$\n    \n","Proof.\n      We give two proofs. \n    \n      First proof. Let $\\mathfrak p \\subset R$ be a prime ideal such that the corresponding point of $\\mathop{\\mathrm{Spec}}(R)$ is in the closure of $T$. This means that for every $f \\in R$, $f \\not\\in \\mathfrak p$ we have $D(f) \\cap T \\not= \\emptyset $. Note that $D(f) \\cap T$ is the image of $\\mathop{\\mathrm{Spec}}(S_ f)$ in $\\mathop{\\mathrm{Spec}}(R)$. Hence we conclude that $S_ f \\not= 0$. In other words, $1 \\not= 0$ in the ring $S_ f$. Since $S_{\\mathfrak p}$ is the directed colimit of the rings $S_ f$ we conclude that $1 \\not= 0$ in $S_{\\mathfrak p}$. In other words, $S_{\\mathfrak p} \\not= 0$ and considering the image of $\\mathop{\\mathrm{Spec}}(S_{\\mathfrak p}) \\to \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ we see there exists a $\\mathfrak p\' \\in T$ with $\\mathfrak p\' \\subset \\mathfrak p$. As we assumed $T$ closed under specialization we conclude $\\mathfrak p$ is a point of $T$ as desired. \n    \n      Second proof. Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. We may replace $R$ by $R/I$. In this case the ring map $R \\to S$ is injective. By Lemma 10.30.5 [[\n  Lemma 10.30.5. Let $R \\subset S$ be an injective ring map. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ hits all the minimal primes. \n\n    \n]] all the minimal primes of $R$ are contained in the image $T$. Hence if $T$ is stable under specialization then it contains all primes. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that the image/range of a map on spectra is closed iff it is stable under specialization, giving two commutative-algebraic arguments (closure criterion via basic opens/localizations, or reduction to injective map and minimal primes). The Lean term instead packages an equivalence as a pair: it uses a lemma `isClosed_range_of_stableUnderSpecialization f` to produce closedness of the range, and the reverse direction is just `h.stableUnderSpecialization` (closed sets are stable under specialization). This matches the *statement* at a high level, but the formal proof does not reflect either of the two informal arguments and hides the substantive direction entirely in a lemma. Structurally it is just a one-line constructor with no correspondence to the two-step reasoning in the informal proof, and it omits the explicit localization/minimal-prime reasoning. No obvious extraneous content, but the alignment is mostly only at the level of the final equivalence, not the proof content.""}"
343,00FL,"lemma denseRange_comap_iff_minimalPrimes :
    DenseRange (comap f) ‚Üî ‚àÄ I (h : I ‚àà minimalPrimes R), ‚ü®I, h.1.1‚ü© ‚àà Set.range (comap f) := by
  constructor
  ¬∑ intro H I hI
    have : I ‚àà (RingHom.ker f).minimalPrimes := by
      rw [denseRange_comap_iff_ker_le_nilRadical] at H
      simp only [minimalPrimes, Ideal.minimalPrimes, Set.mem_setOf] at hI ‚ä¢
      convert hI using 2 with p
      exact ‚ü®fun h ‚Ü¶ ‚ü®h.1, bot_le‚ü©, fun h ‚Ü¶ ‚ü®h.1, H.trans (h.1.radical_le_iff.mpr bot_le)‚ü©‚ü©
    obtain ‚ü®p, hp, _, rfl‚ü© := Ideal.exists_comap_eq_of_mem_minimalPrimes f (I := ‚ä•) I this
    exact ‚ü®‚ü®p, hp‚ü©, rfl‚ü©
  ¬∑ intro H p
    obtain ‚ü®q, hq, hq'‚ü© := Ideal.exists_minimalPrimes_le (J := p.asIdeal) bot_le
    exact ((le_iff_specializes ‚ü®q, hq.1.1‚ü© p).mp hq').mem_closed isClosed_closure
      (subset_closure (H q hq))
",Formal Proof of Stacks Project Tag 00FL,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Topology.lean#L866-L880,Q27041,,10.30.6,lemma,3.0,"['00FF', '00AO', '0ELQ']","\n  Lemma 10.30.6. Let $R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe kernel of $R \\to S$ consists of nilpotent elements. \n\n\nThe minimal primes of $R$ are in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. \n\n\nThe image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is dense in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\n\n\n    \n      Proof.\n      Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. Note that $\\sqrt{(0)} = \\bigcap _{\\mathfrak q \\subset S} \\mathfrak q$, see Lemma 10.17.2. Hence $\\sqrt{I} = \\bigcap _{\\mathfrak q \\subset S} R \\cap \\mathfrak q$. Thus $V(I) = V(\\sqrt{I})$ is the closure of the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. This shows that (1) is equivalent to (3). It is clear that (2) implies (3). Finally, assume (1). We may replace $R$ by $R/I$ and $S$ by $S/IS$ without affecting the topology of the spectra and the map. Hence the implication (1) $\\Rightarrow $ (2) follows from Lemma 10.30.5. \n      $\\square$\n    \n",\n  Lemma 10.30.6. Let $R \\to S$ be a ring map. The following are equivalent: \n  \n  \nThe kernel of $R \\to S$ consists of nilpotent elements. \n\n\nThe minimal primes of $R$ are in the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. \n\n\nThe image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is dense in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\n\n\n    \n,"Proof.\n      Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. Note that $\\sqrt{(0)} = \\bigcap _{\\mathfrak q \\subset S} \\mathfrak q$, see Lemma 10.17.2. Hence $\\sqrt{I} = \\bigcap _{\\mathfrak q \\subset S} R \\cap \\mathfrak q$. Thus $V(I) = V(\\sqrt{I})$ is the closure of the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. This shows that (1) is equivalent to (3). It is clear that (2) implies (3). Finally, assume (1). We may replace $R$ by $R/I$ and $S$ by $S/IS$ without affecting the topology of the spectra and the map. Hence the implication (1) $\\Rightarrow $ (2) follows from Lemma 10.30.5. \n      $\\square$\n    \n"," by
  constructor
  ¬∑ intro H I hI
    have : I ‚àà (RingHom.ker f).minimalPrimes := by
      rw [denseRange_comap_iff_ker_le_nilRadical] at H
      simp only [minimalPrimes, Ideal.minimalPrimes, Set.mem_setOf] at hI ‚ä¢
      convert hI using 2 with p
      exact ‚ü®fun h ‚Ü¶ ‚ü®h.1, bot_le‚ü©, fun h ‚Ü¶ ‚ü®h.1, H.trans (h.1.radical_le_iff.mpr bot_le)‚ü©‚ü©
    obtain ‚ü®p, hp, _, rfl‚ü© := Ideal.exists_comap_eq_of_mem_minimalPrimes f (I := ‚ä•) I this
    exact ‚ü®‚ü®p, hp‚ü©, rfl‚ü©
  ¬∑ intro H p
    obtain ‚ü®q, hq, hq'‚ü© := Ideal.exists_minimalPrimes_le (J := p.asIdeal) bot_le
    exact ((le_iff_specializes ‚ü®q, hq.1.1‚ü© p).mp hq').mem_closed isClosed_closure
      (subset_closure (H q hq))
","lemma denseRange_comap_iff_minimalPrimes :
    DenseRange (comap f) ‚Üî ‚àÄ I (h : I ‚àà minimalPrimes R), ‚ü®I, h.1.1‚ü© ‚àà Set.range (comap f) ","Proof.\n      Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. Note that $\\sqrt{(0)} = \\bigcap _{\\mathfrak q \\subset S} \\mathfrak q$, see Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Hence $\\sqrt{I} = \\bigcap _{\\mathfrak q \\subset S} R \\cap \\mathfrak q$. Thus $V(I) = V(\\sqrt{I})$ is the closure of the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. This shows that (1) is equivalent to (3). It is clear that (2) implies (3). Finally, assume (1). We may replace $R$ by $R/I$ and $S$ by $S/IS$ without affecting the topology of the spectra and the map. Hence the implication (1) $\\Rightarrow $ (2) follows from Lemma 10.30.5 [[\n  Lemma 10.30.5. Let $R \\subset S$ be an injective ring map. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ hits all the minimal primes. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Let $I = \\mathop{\\mathrm{Ker}}(R \\to S)$. Note that $\\sqrt{(0)} = \\bigcap _{\\mathfrak q \\subset S} \\mathfrak q$, see Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Hence $\\sqrt{I} = \\bigcap _{\\mathfrak q \\subset S} R \\cap \\mathfrak q$. Thus $V(I) = V(\\sqrt{I})$ is the closure of the image of $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$. This shows that (1) is equivalent to (3). It is clear that (2) implies (3). Finally, assume (1). We may replace $R$ by $R/I$ and $S$ by $S/IS$ without affecting the topology of the spectra and the map. Hence the implication (1) $\\Rightarrow $ (2) follows from Lemma 10.30.5 [[\n  Lemma 10.30.5. Let $R \\subset S$ be an injective ring map. Then $\\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ hits all the minimal primes. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is about a two-way implication: one direction uses a hypothesis rewritten via `denseRange_comap_iff_ker_le_nilRadical` (i.e. a condition relating density of the induced map on spectra to `ker f ‚â§ nilradical`) to show every minimal prime over `ker f` is in the image via `Ideal.exists_comap_eq_of_mem_minimalPrimes`; the other direction shows density/closure by taking an arbitrary prime `p`, choosing a minimal prime `q ‚â§ p` (`Ideal.exists_minimalPrimes_le`), and then using specialization/closure arguments to conclude `p` lies in the closure of the image. This matches the informal proof‚Äôs overall theme: density/closure of the image is controlled by the nilradical/ker condition and by hitting minimal primes.\n\nStructurally, however, the informal proof proceeds by (i) identifying the closure of the image with `V(ker)` via a radical/intersection-of-primes argument, (ii) noting an easy implication, and (iii) reducing to the injective case and invoking a lemma about hitting minimal primes. The Lean proof does not mirror the radical/intersection argument or the reduction to the injective case; instead it directly uses library lemmas about minimal primes of the kernel and a closure-by-specialization argument. So the core mathematical content is related, but the step-by-step structure and some intermediate equivalences in the informal proof are not present in the formal proof.""}"
344,00EE,"def isIdempotentElemEquivClopens :
    {e : R // IsIdempotentElem e} ‚âÉo Clopens (PrimeSpectrum R) :=
  .trans .isIdempotentElemMulZeroAddOne mulZeroAddOneEquivClopens
",Formal Proof of Stacks Project Tag 00EE,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Topology.lean#L1312-L1314,Q27041,,10.21.3,lemma,3.0,"['04PN', '00AO', '0ELQ']","\n  Lemma 10.21.3. Let $R$ be a ring. For each $U \\subset \\mathop{\\mathrm{Spec}}(R)$ which is open and closed there exists a unique idempotent $e \\in R$ such that $U = D(e)$. This induces a 1-1 correspondence between open and closed subsets $U \\subset \\mathop{\\mathrm{Spec}}(R)$ and idempotents $e \\in R$. \n\n    \n      Proof.\n      Let $U \\subset \\mathop{\\mathrm{Spec}}(R)$ be open and closed. Since $U$ is closed it is quasi-compact by Lemma 10.17.8, and similarly for its complement. Write $U = \\bigcup _{i = 1}^ n D(f_ i)$ as a finite union of standard opens. Similarly, write $\\mathop{\\mathrm{Spec}}(R) \\setminus U = \\bigcup _{j = 1}^ m D(g_ j)$ as a finite union of standard opens. Since $\\emptyset = D(f_ i) \\cap D(g_ j) = D(f_ i g_ j)$ we see that $f_ i g_ j$ is nilpotent by Lemma 10.17.2. Let $I = (f_1, \\ldots , f_ n) \\subset R$ and let $J = (g_1, \\ldots , g_ m) \\subset R$. Note that $V(J)$ equals $U$, that $V(I)$ equals the complement of $U$, so $\\mathop{\\mathrm{Spec}}(R) = V(I) \\amalg V(J)$. By the remark on nilpotency above, we see that $(IJ)^ N = (0)$ for some sufficiently large integer $N$. Since $\\bigcup D(f_ i) \\cup \\bigcup D(g_ j) = \\mathop{\\mathrm{Spec}}(R)$ we see that $I + J = R$, see Lemma 10.17.2. By raising this equation to the $2N$th power we conclude that $I^ N + J^ N = R$. Write $1 = x + y$ with $x \\in I^ N$ and $y \\in J^ N$. Then $0 = xy = x(1 - x)$ as $I^ N J^ N = (0)$. Thus $x = x^2$ is idempotent and contained in $I^ N \\subset I$. The idempotent $y = 1 - x$ is contained in $J^ N \\subset J$. This shows that the idempotent $x$ maps to $1$ in every residue field $\\kappa (\\mathfrak p)$ for $\\mathfrak p \\in V(J)$ and that $x$ maps to $0$ in $\\kappa (\\mathfrak p)$ for every $\\mathfrak p \\in V(I)$. \n    \n      To see uniqueness suppose that $e_1, e_2$ are distinct idempotents in $R$. We have to show there exists a prime $\\mathfrak p$ such that $e_1 \\in \\mathfrak p$ and $e_2 \\not\\in \\mathfrak p$, or conversely. Write $e_ i\' = 1 - e_ i$. If $e_1 \\not= e_2$, then $0 \\not= e_1 - e_2 = e_1(e_2 + e_2\') - (e_1 + e_1\')e_2 = e_1 e_2\' - e_1\' e_2$. Hence either the idempotent $e_1 e_2\' \\not= 0$ or $e_1\' e_2 \\not= 0$. An idempotent is not nilpotent, and hence we find a prime $\\mathfrak p$ such that either $e_1e_2\' \\not\\in \\mathfrak p$ or $e_1\'e_2 \\not\\in \\mathfrak p$, by Lemma 10.17.2. It is easy to see this gives the desired prime. \n      $\\square$\n    \n",\n  Lemma 10.21.3. Let $R$ be a ring. For each $U \\subset \\mathop{\\mathrm{Spec}}(R)$ which is open and closed there exists a unique idempotent $e \\in R$ such that $U = D(e)$. This induces a 1-1 correspondence between open and closed subsets $U \\subset \\mathop{\\mathrm{Spec}}(R)$ and idempotents $e \\in R$. \n\n    \n,"Proof.\n      Let $U \\subset \\mathop{\\mathrm{Spec}}(R)$ be open and closed. Since $U$ is closed it is quasi-compact by Lemma 10.17.8, and similarly for its complement. Write $U = \\bigcup _{i = 1}^ n D(f_ i)$ as a finite union of standard opens. Similarly, write $\\mathop{\\mathrm{Spec}}(R) \\setminus U = \\bigcup _{j = 1}^ m D(g_ j)$ as a finite union of standard opens. Since $\\emptyset = D(f_ i) \\cap D(g_ j) = D(f_ i g_ j)$ we see that $f_ i g_ j$ is nilpotent by Lemma 10.17.2. Let $I = (f_1, \\ldots , f_ n) \\subset R$ and let $J = (g_1, \\ldots , g_ m) \\subset R$. Note that $V(J)$ equals $U$, that $V(I)$ equals the complement of $U$, so $\\mathop{\\mathrm{Spec}}(R) = V(I) \\amalg V(J)$. By the remark on nilpotency above, we see that $(IJ)^ N = (0)$ for some sufficiently large integer $N$. Since $\\bigcup D(f_ i) \\cup \\bigcup D(g_ j) = \\mathop{\\mathrm{Spec}}(R)$ we see that $I + J = R$, see Lemma 10.17.2. By raising this equation to the $2N$th power we conclude that $I^ N + J^ N = R$. Write $1 = x + y$ with $x \\in I^ N$ and $y \\in J^ N$. Then $0 = xy = x(1 - x)$ as $I^ N J^ N = (0)$. Thus $x = x^2$ is idempotent and contained in $I^ N \\subset I$. The idempotent $y = 1 - x$ is contained in $J^ N \\subset J$. This shows that the idempotent $x$ maps to $1$ in every residue field $\\kappa (\\mathfrak p)$ for $\\mathfrak p \\in V(J)$ and that $x$ maps to $0$ in $\\kappa (\\mathfrak p)$ for every $\\mathfrak p \\in V(I)$. \n    \n      To see uniqueness suppose that $e_1, e_2$ are distinct idempotents in $R$. We have to show there exists a prime $\\mathfrak p$ such that $e_1 \\in \\mathfrak p$ and $e_2 \\not\\in \\mathfrak p$, or conversely. Write $e_ i\' = 1 - e_ i$. If $e_1 \\not= e_2$, then $0 \\not= e_1 - e_2 = e_1(e_2 + e_2\') - (e_1 + e_1\')e_2 = e_1 e_2\' - e_1\' e_2$. Hence either the idempotent $e_1 e_2\' \\not= 0$ or $e_1\' e_2 \\not= 0$. An idempotent is not nilpotent, and hence we find a prime $\\mathfrak p$ such that either $e_1e_2\' \\not\\in \\mathfrak p$ or $e_1\'e_2 \\not\\in \\mathfrak p$, by Lemma 10.17.2. It is easy to see this gives the desired prime. \n      $\\square$\n    \n","
  .trans .isIdempotentElemMulZeroAddOne mulZeroAddOneEquivClopens
","def isIdempotentElemEquivClopens :
    {e : R // IsIdempotentElem e} ‚âÉo Clopens (PrimeSpectrum R) ","Proof.\n      Let $U \\subset \\mathop{\\mathrm{Spec}}(R)$ be open and closed. Since $U$ is closed it is quasi-compact by Lemma 10.17.8 [[\n       \n      \n  Lemma 10.17.8. Let $R$ be a ring. The space $\\mathop{\\mathrm{Spec}}(R)$ is quasi-compact. \n\n    \n]], and similarly for its complement. Write $U = \\bigcup _{i = 1}^ n D(f_ i)$ as a finite union of standard opens. Similarly, write $\\mathop{\\mathrm{Spec}}(R) \\setminus U = \\bigcup _{j = 1}^ m D(g_ j)$ as a finite union of standard opens. Since $\\emptyset = D(f_ i) \\cap D(g_ j) = D(f_ i g_ j)$ we see that $f_ i g_ j$ is nilpotent by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Let $I = (f_1, \\ldots , f_ n) \\subset R$ and let $J = (g_1, \\ldots , g_ m) \\subset R$. Note that $V(J)$ equals $U$, that $V(I)$ equals the complement of $U$, so $\\mathop{\\mathrm{Spec}}(R) = V(I) \\amalg V(J)$. By the remark on nilpotency above, we see that $(IJ)^ N = (0)$ for some sufficiently large integer $N$. Since $\\bigcup D(f_ i) \\cup \\bigcup D(g_ j) = \\mathop{\\mathrm{Spec}}(R)$ we see that $I + J = R$, see Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. By raising this equation to the $2N$th power we conclude that $I^ N + J^ N = R$. Write $1 = x + y$ with $x \\in I^ N$ and $y \\in J^ N$. Then $0 = xy = x(1 - x)$ as $I^ N J^ N = (0)$. Thus $x = x^2$ is idempotent and contained in $I^ N \\subset I$. The idempotent $y = 1 - x$ is contained in $J^ N \\subset J$. This shows that the idempotent $x$ maps to $1$ in every residue field $\\kappa (\\mathfrak p)$ for $\\mathfrak p \\in V(J)$ and that $x$ maps to $0$ in $\\kappa (\\mathfrak p)$ for every $\\mathfrak p \\in V(I)$. \n    \n      To see uniqueness suppose that $e_1, e_2$ are distinct idempotents in $R$. We have to show there exists a prime $\\mathfrak p$ such that $e_1 \\in \\mathfrak p$ and $e_2 \\not\\in \\mathfrak p$, or conversely. Write $e_ i\' = 1 - e_ i$. If $e_1 \\not= e_2$, then $0 \\not= e_1 - e_2 = e_1(e_2 + e_2\') - (e_1 + e_1\')e_2 = e_1 e_2\' - e_1\' e_2$. Hence either the idempotent $e_1 e_2\' \\not= 0$ or $e_1\' e_2 \\not= 0$. An idempotent is not nilpotent, and hence we find a prime $\\mathfrak p$ such that either $e_1e_2\' \\not\\in \\mathfrak p$ or $e_1\'e_2 \\not\\in \\mathfrak p$, by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. It is easy to see this gives the desired prime. \n      $\\square$\n    \n","Proof.\n      Let $U \\subset \\mathop{\\mathrm{Spec}}(R)$ be open and closed. Since $U$ is closed it is quasi-compact by Lemma 10.17.8 [[\n       \n      \n  Lemma 10.17.8. Let $R$ be a ring. The space $\\mathop{\\mathrm{Spec}}(R)$ is quasi-compact. \n\n    \n]], and similarly for its complement. Write $U = \\bigcup _{i = 1}^ n D(f_ i)$ as a finite union of standard opens. Similarly, write $\\mathop{\\mathrm{Spec}}(R) \\setminus U = \\bigcup _{j = 1}^ m D(g_ j)$ as a finite union of standard opens. Since $\\emptyset = D(f_ i) \\cap D(g_ j) = D(f_ i g_ j)$ we see that $f_ i g_ j$ is nilpotent by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Let $I = (f_1, \\ldots , f_ n) \\subset R$ and let $J = (g_1, \\ldots , g_ m) \\subset R$. Note that $V(J)$ equals $U$, that $V(I)$ equals the complement of $U$, so $\\mathop{\\mathrm{Spec}}(R) = V(I) \\amalg V(J)$. By the remark on nilpotency above, we see that $(IJ)^ N = (0)$ for some sufficiently large integer $N$. Since $\\bigcup D(f_ i) \\cup \\bigcup D(g_ j) = \\mathop{\\mathrm{Spec}}(R)$ we see that $I + J = R$, see Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. By raising this equation to the $2N$th power we conclude that $I^ N + J^ N = R$. Write $1 = x + y$ with $x \\in I^ N$ and $y \\in J^ N$. Then $0 = xy = x(1 - x)$ as $I^ N J^ N = (0)$. Thus $x = x^2$ is idempotent and contained in $I^ N \\subset I$. The idempotent $y = 1 - x$ is contained in $J^ N \\subset J$. This shows that the idempotent $x$ maps to $1$ in every residue field $\\kappa (\\mathfrak p)$ for $\\mathfrak p \\in V(J)$ and that $x$ maps to $0$ in $\\kappa (\\mathfrak p)$ for every $\\mathfrak p \\in V(I)$. \n    \n      To see uniqueness suppose that $e_1, e_2$ are distinct idempotents in $R$. We have to show there exists a prime $\\mathfrak p$ such that $e_1 \\in \\mathfrak p$ and $e_2 \\not\\in \\mathfrak p$, or conversely. Write $e_ i\' = 1 - e_ i$. If $e_1 \\not= e_2$, then $0 \\not= e_1 - e_2 = e_1(e_2 + e_2\') - (e_1 + e_1\')e_2 = e_1 e_2\' - e_1\' e_2$. Hence either the idempotent $e_1 e_2\' \\not= 0$ or $e_1\' e_2 \\not= 0$. An idempotent is not nilpotent, and hence we find a prime $\\mathfrak p$ such that either $e_1e_2\' \\not\\in \\mathfrak p$ or $e_1\'e_2 \\not\\in \\mathfrak p$, by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. It is easy to see this gives the desired prime. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof establishes the classical bijection between clopen subsets of Spec(R) and idempotents of R (existence via quasi-compactness/finite D(f) covers, nilpotence, I+J=R, producing an idempotent; and uniqueness via separating distinct idempotents by a prime). The formal proof, however, is just a composition `.trans .isIdempotentElemMulZeroAddOne mulZeroAddOneEquivClopens`, which appears to build an equivalence by chaining an existing lemma about ‚Äúidempotent elements‚Äù with a pre-proved equivalence `mulZeroAddOneEquivClopens`. It does not mirror the constructive argument with ideals, nilpotence, and prime separation, and it omits the uniqueness/separation reasoning entirely at the proof-term level. Structurally, the informal proof is a multi-step geometric/algebraic argument, while the Lean code is a one-line reuse of library equivalences; thus correspondence is weak even if the end statement likely matches.""}"
345,00ES,"protected def _root_.minimalPrimes.equivIrreducibleComponents :
    minimalPrimes R ‚âÉo (irreducibleComponents <| PrimeSpectrum R)·µí·µà := by
  let e : {p : Ideal R | p.IsPrime ‚àß ‚ä• ‚â§ p} ‚âÉo PrimeSpectrum R :=
    ‚ü®‚ü®fun x ‚Ü¶ ‚ü®x.1, x.2.1‚ü©, fun x ‚Ü¶ ‚ü®x.1, x.2, bot_le‚ü©, fun _ ‚Ü¶ rfl, fun _ ‚Ü¶ rfl‚ü©, Iff.rfl‚ü©
  rw [irreducibleComponents_eq_maximals_closed]
  exact OrderIso.setOfMinimalIsoSetOfMaximal
    (e.trans ((PrimeSpectrum.pointsEquivIrreducibleCloseds R).trans
    (TopologicalSpace.IrreducibleCloseds.orderIsoSubtype' (PrimeSpectrum R)).dual))
",Formal Proof of Stacks Project Tag 00ES,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Topology.lean#L1164-L1171,Q27041,,10.26.1,lemma,3.0,"['00ER', '00AO', '0ELQ']","\n  Lemma 10.26.1. Let $R$ be a ring. \n  \n  \nFor a prime $\\mathfrak p \\subset R$ the closure of $\\{ \\mathfrak p\\} $ in the Zariski topology is $V(\\mathfrak p)$. In a formula $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. \n\n\nThe irreducible closed subsets of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a prime. \n\n\nThe irreducible components (see Topology, Definition 5.8.1) of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a minimal prime. \n\n\n\n\n    \n      Proof.\n      Note that if $ \\mathfrak p \\in V(I)$, then $I \\subset \\mathfrak p$. Hence, clearly $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. In particular $V(\\mathfrak p)$ is the closure of a singleton and hence irreducible. The second assertion implies the third. To show the second, let $V(I) \\subset \\mathop{\\mathrm{Spec}}(R)$ with $I$ a radical ideal. If $I$ is not prime, then choose $a, b\\in R$, $a, b\\not\\in I$ with $ab\\in I$. In this case $V(I, a) \\cup V(I, b) = V(I)$, but neither $V(I, b) = V(I)$ nor $V(I, a) = V(I)$, by Lemma 10.17.2. Hence $V(I)$ is not irreducible. \n      $\\square$\n    \n","\n  Lemma 10.26.1. Let $R$ be a ring. \n  \n  \nFor a prime $\\mathfrak p \\subset R$ the closure of $\\{ \\mathfrak p\\} $ in the Zariski topology is $V(\\mathfrak p)$. In a formula $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. \n\n\nThe irreducible closed subsets of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a prime. \n\n\nThe irreducible components (see Topology, Definition 5.8.1) of $\\mathop{\\mathrm{Spec}}(R)$ are exactly the subsets $V(\\mathfrak p)$, with $\\mathfrak p \\subset R$ a minimal prime. \n\n\n\n\n    \n","Proof.\n      Note that if $ \\mathfrak p \\in V(I)$, then $I \\subset \\mathfrak p$. Hence, clearly $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. In particular $V(\\mathfrak p)$ is the closure of a singleton and hence irreducible. The second assertion implies the third. To show the second, let $V(I) \\subset \\mathop{\\mathrm{Spec}}(R)$ with $I$ a radical ideal. If $I$ is not prime, then choose $a, b\\in R$, $a, b\\not\\in I$ with $ab\\in I$. In this case $V(I, a) \\cup V(I, b) = V(I)$, but neither $V(I, b) = V(I)$ nor $V(I, a) = V(I)$, by Lemma 10.17.2. Hence $V(I)$ is not irreducible. \n      $\\square$\n    \n"," by
  let e : {p : Ideal R | p.IsPrime ‚àß ‚ä• ‚â§ p} ‚âÉo PrimeSpectrum R :=
    ‚ü®‚ü®fun x ‚Ü¶ ‚ü®x.1, x.2.1‚ü©, fun x ‚Ü¶ ‚ü®x.1, x.2, bot_le‚ü©, fun _ ‚Ü¶ rfl, fun _ ‚Ü¶ rfl‚ü©, Iff.rfl‚ü©
  rw [irreducibleComponents_eq_maximals_closed]
  exact OrderIso.setOfMinimalIsoSetOfMaximal
    (e.trans ((PrimeSpectrum.pointsEquivIrreducibleCloseds R).trans
    (TopologicalSpace.IrreducibleCloseds.orderIsoSubtype' (PrimeSpectrum R)).dual))
","protected def _root_.minimalPrimes.equivIrreducibleComponents :
    minimalPrimes R ‚âÉo (irreducibleComponents <| PrimeSpectrum R)·µí·µà ","Proof.\n      Note that if $ \\mathfrak p \\in V(I)$, then $I \\subset \\mathfrak p$. Hence, clearly $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. In particular $V(\\mathfrak p)$ is the closure of a singleton and hence irreducible. The second assertion implies the third. To show the second, let $V(I) \\subset \\mathop{\\mathrm{Spec}}(R)$ with $I$ a radical ideal. If $I$ is not prime, then choose $a, b\\in R$, $a, b\\not\\in I$ with $ab\\in I$. In this case $V(I, a) \\cup V(I, b) = V(I)$, but neither $V(I, b) = V(I)$ nor $V(I, a) = V(I)$, by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Hence $V(I)$ is not irreducible. \n      $\\square$\n    \n","Proof.\n      Note that if $ \\mathfrak p \\in V(I)$, then $I \\subset \\mathfrak p$. Hence, clearly $\\overline{\\{ \\mathfrak p\\} } = V(\\mathfrak p)$. In particular $V(\\mathfrak p)$ is the closure of a singleton and hence irreducible. The second assertion implies the third. To show the second, let $V(I) \\subset \\mathop{\\mathrm{Spec}}(R)$ with $I$ a radical ideal. If $I$ is not prime, then choose $a, b\\in R$, $a, b\\not\\in I$ with $ab\\in I$. In this case $V(I, a) \\cup V(I, b) = V(I)$, but neither $V(I, b) = V(I)$ nor $V(I, a) = V(I)$, by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Hence $V(I)$ is not irreducible. \n      $\\square$\n    \n","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about Zariski-closed sets V(I) in Spec(R): closures of singletons being V(p), irreducibility of V(p), and the criterion that V(I) is irreducible iff I is prime (using a,b with ab‚ààI to decompose V(I)=V(I,a)‚à™V(I,b)). The Lean proof instead rewrites `irreducibleComponents` as maximals of closed sets and then applies an order isomorphism between minimal elements of a poset and maximal elements of a dual poset, via order equivalences involving `PrimeSpectrum.pointsEquivIrreducibleCloseds` and `IrreducibleCloseds.orderIsoSubtype'`. Structurally, the Lean code is a lattice/order-theoretic argument about irreducible components and maximal/minimal elements, with no explicit use of the V(I)=V(I,a)‚à™V(I,b) decomposition, radical/prime ideal criterion, or closure-of-singleton reasoning present in the informal proof. Thus the two proofs address different statements/methods and do not correspond in content or structure.""}"
346,00EC,"lemma zeroLocus_eq_basicOpen_of_isIdempotentElem
    (e : R) (he : IsIdempotentElem e) :
    zeroLocus {e} = basicOpen (1 - e) := by
  rw [basicOpen_eq_zeroLocus_of_isIdempotentElem _ he.one_sub, sub_sub_cancel]
",Formal Proof of Stacks Project Tag 00EC,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Spectrum/Prime/Topology.lean#L1288-L1291,Q27041,,10.21.1,lemma,3.0,"['04PN', '00AO', '0ELQ']",\n  Lemma 10.21.1. Let $R$ be a ring. Let $e \\in R$ be an idempotent. In this case \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R) = D(e) \\amalg D(1-e).  \\]\n\n\n    \n      Proof.\n      Note that an idempotent $e$ of a domain is either $1$ or $0$. Hence we see that \n    \n      \n  \\begin{eqnarray*}  D(e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Similarly we have \n    \n      \n  \\begin{eqnarray*}  D(1-e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid 1 - e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Since the image of $e$ in any residue field is either $1$ or $0$ we deduce that $D(e)$ and $D(1-e)$ cover all of $\\mathop{\\mathrm{Spec}}(R)$. \n      $\\square$\n    \n,\n  Lemma 10.21.1. Let $R$ be a ring. Let $e \\in R$ be an idempotent. In this case \n  \n  \\[  \\mathop{\\mathrm{Spec}}(R) = D(e) \\amalg D(1-e).  \\]\n\n\n    \n,Proof.\n      Note that an idempotent $e$ of a domain is either $1$ or $0$. Hence we see that \n    \n      \n  \\begin{eqnarray*}  D(e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Similarly we have \n    \n      \n  \\begin{eqnarray*}  D(1-e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid 1 - e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Since the image of $e$ in any residue field is either $1$ or $0$ we deduce that $D(e)$ and $D(1-e)$ cover all of $\\mathop{\\mathrm{Spec}}(R)$. \n      $\\square$\n    \n," by
  rw [basicOpen_eq_zeroLocus_of_isIdempotentElem _ he.one_sub, sub_sub_cancel]
","lemma zeroLocus_eq_basicOpen_of_isIdempotentElem
    (e : R) (he : IsIdempotentElem e) :
    zeroLocus {e} = basicOpen (1 - e) ",Proof.\n      Note that an idempotent $e$ of a domain is either $1$ or $0$. Hence we see that \n    \n      \n  \\begin{eqnarray*}  D(e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Similarly we have \n    \n      \n  \\begin{eqnarray*}  D(1-e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid 1 - e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Since the image of $e$ in any residue field is either $1$ or $0$ we deduce that $D(e)$ and $D(1-e)$ cover all of $\\mathop{\\mathrm{Spec}}(R)$. \n      $\\square$\n    \n,Proof.\n      Note that an idempotent $e$ of a domain is either $1$ or $0$. Hence we see that \n    \n      \n  \\begin{eqnarray*}  D(e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Similarly we have \n    \n      \n  \\begin{eqnarray*}  D(1-e) &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid 1 - e \\not\\in \\mathfrak p \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e \\not= 1\\text{ in }\\kappa (\\mathfrak p) \\}  \\\\ &  = &  \\{  \\mathfrak p \\in \\mathop{\\mathrm{Spec}}(R) \\mid e = 0\\text{ in }\\kappa (\\mathfrak p) \\}  \\end{eqnarray*}\n\n    \n       Since the image of $e$ in any residue field is either $1$ or $0$ we deduce that $D(e)$ and $D(1-e)$ cover all of $\\mathop{\\mathrm{Spec}}(R)$. \n      $\\square$\n    \n,"{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues a covering statement for basic opens: for an idempotent e in a domain, at each prime the image of e in the residue field is 0 or 1, so every prime lies in D(e) or D(1‚àíe), hence D(e) ‚à™ D(1‚àíe) = Spec(R). The formal proof, however, is just a rewrite using `basicOpen_eq_zeroLocus_of_isIdempotentElem _ he.one_sub` and `sub_sub_cancel`, which identifies a basic open with a zero locus for an idempotent element and simplifies an expression like (1 ‚àí (1 ‚àí e)) = e. It does not explicitly establish the covering/union-equals-top statement nor use the domain/idempotent-in-field dichotomy. Structurally, the informal proof proceeds by pointwise residue-field reasoning and set-theoretic union, while the Lean code is a short algebraic/topological rewriting step. Thus there is only partial alignment: the rewrite may be a small substep in a larger formalization of the cover, but it does not match the main argument presented.""}"
347,0BIL,"theorem traceForm_nondegenerate [FiniteDimensional K L] [Algebra.IsSeparable K L] :
    (traceForm K L).Nondegenerate :=
  BilinForm.nondegenerate_of_det_ne_zero (traceForm K L) _
    (det_traceForm_ne_zero (Module.finBasis K L))
",Formal Proof of Stacks Project Tag 0BIL,(1) => (3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Trace/Basic.lean#L503-L506,Q27041,,9.20.7,lemma,3.0,"['0BIE', '09FA', '0ELQ']","\n  Lemma 9.20.7. Let $L/K$ be a finite extension of fields. The following are equivalent: \n  \n  \n$L/K$ is separable, \n\n\n$\\text{Trace}_{L/K}$ is not identically zero, and \n\n\nthe trace pairing $Q_{L/K}$ is nondegenerate. \n\n\n\n\n    \n      Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 and 9.14.5. Hence by Lemma 9.20.5 we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2. Since $L/k$ is separable we see from Lemma 9.12.4 that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2. \n      $\\square$\n    \n","\n  Lemma 9.20.7. Let $L/K$ be a finite extension of fields. The following are equivalent: \n  \n  \n$L/K$ is separable, \n\n\n$\\text{Trace}_{L/K}$ is not identically zero, and \n\n\nthe trace pairing $Q_{L/K}$ is nondegenerate. \n\n\n\n\n    \n","Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 and 9.14.5. Hence by Lemma 9.20.5 we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2. Since $L/k$ is separable we see from Lemma 9.12.4 that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2. \n      $\\square$\n    \n","
  BilinForm.nondegenerate_of_det_ne_zero (traceForm K L) _
    (det_traceForm_ne_zero (Module.finBasis K L))
","theorem traceForm_nondegenerate [FiniteDimensional K L] [Algebra.IsSeparable K L] :
    (traceForm K L).Nondegenerate ","Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3 [[\n  Lemma 9.20.3. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then \n  \n  \\[  \\text{Norm}_{L/K}(\\alpha ) = (-1)^{[L : K]} a_ d^ e \\quad \\text{and}\\quad \\text{Trace}_{L/K}(\\alpha ) = - e a_1  \\]\n\n   where $e d = [L : K]$. \n\n    \n]]. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]] and 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. Hence by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2 [[\n  Lemma 9.20.2. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P$ be the minimal polynomial of $\\alpha $ over $K$. Then the characteristic polynomial of the $K$-linear map $\\alpha : L \\to L$ is equal to $P^ e$ with $e \\deg (P) = [L : K]$. \n\n    \n]]. Since $L/k$ is separable we see from Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2 [[\n  Lemma 9.13.2. Let $L$ be a field. Let $n \\geq 1$ and $\\alpha _1, \\ldots , \\alpha _ n \\in L$ pairwise distinct elements of $L$. Then there exists an $e \\geq 0$ such that $\\sum _{i = 1, \\ldots , n} \\alpha _ i^ e \\not= 0$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3 [[\n  Lemma 9.20.3. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then \n  \n  \\[  \\text{Norm}_{L/K}(\\alpha ) = (-1)^{[L : K]} a_ d^ e \\quad \\text{and}\\quad \\text{Trace}_{L/K}(\\alpha ) = - e a_1  \\]\n\n   where $e d = [L : K]$. \n\n    \n]]. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]] and 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. Hence by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2 [[\n  Lemma 9.20.2. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P$ be the minimal polynomial of $\\alpha $ over $K$. Then the characteristic polynomial of the $K$-linear map $\\alpha : L \\to L$ is equal to $P^ e$ with $e \\deg (P) = [L : K]$. \n\n    \n]]. Since $L/k$ is separable we see from Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2 [[\n  Lemma 9.13.2. Let $L$ be a field. Let $n \\geq 1$ and $\\alpha _1, \\ldots , \\alpha _ n \\in L$ pairwise distinct elements of $L$. Then there exists an $e \\geq 0$ such that $\\sum _{i = 1, \\ldots , n} \\alpha _ i^ e \\not= 0$. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1) => (3)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof establishes nondegeneracy of the trace bilinear form by invoking a determinant criterion: `BilinForm.nondegenerate_of_det_ne_zero (traceForm K L) _ (det_traceForm_ne_zero (Module.finBasis K L))`. This corresponds to a statement of the form ‚Äúdet(traceForm) ‚â† 0 ‚áí traceForm is nondegenerate,‚Äù i.e. a linear-algebraic route via a chosen basis.\n\nThe informal proof (notably the part relevant to (1) => (3) per the comment) argues nondegeneracy from separability/nonvanishing trace using field-theoretic properties of the trace map (existence of Œ≥ with Trace(Œ≥) ‚â† 0, and then Q(Œ±, Œ≥/Œ±) ‚â† 0), plus a long discussion distinguishing separable vs inseparable extensions and showing when the trace is identically zero.\n\nStructurally, the Lean proof is a one-line application of a determinant lemma and does not mirror the informal argument‚Äôs construction of witnesses (Œ≥, Œ≥/Œ±) or its separability/inseparability case analysis. It also omits the intermediate equivalences (2)‚Üî(3) and the trace-not-identically-zero discussion. Thus, while both aim at nondegeneracy of the trace form, the formal proof aligns only loosely with the informal proof‚Äôs method and content.""}"
348,0BIL,"theorem traceForm_nondegenerate_tfae [FiniteDimensional K L] :
    [Algebra.IsSeparable K L, Algebra.trace K L ‚â† 0, (traceForm K L).Nondegenerate].TFAE := by
  tfae_have 1 ‚Üí 3 := fun _ ‚Ü¶ traceForm_nondegenerate K L
  tfae_have 3 ‚Üí 2 := fun H‚ÇÅ H‚ÇÇ ‚Ü¶ H‚ÇÅ.ne_zero (by ext; simp [H‚ÇÇ])
  tfae_have 2 ‚Üí 1 := not_imp_comm.mp Algebra.trace_eq_zero_of_not_isSeparable
  tfae_finish
",Formal Proof of Stacks Project Tag 0BIL,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Trace/Basic.lean#L509-L514,Q27041,,9.20.7,lemma,3.0,"['0BIE', '09FA', '0ELQ']","\n  Lemma 9.20.7. Let $L/K$ be a finite extension of fields. The following are equivalent: \n  \n  \n$L/K$ is separable, \n\n\n$\\text{Trace}_{L/K}$ is not identically zero, and \n\n\nthe trace pairing $Q_{L/K}$ is nondegenerate. \n\n\n\n\n    \n      Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 and 9.14.5. Hence by Lemma 9.20.5 we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2. Since $L/k$ is separable we see from Lemma 9.12.4 that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2. \n      $\\square$\n    \n","\n  Lemma 9.20.7. Let $L/K$ be a finite extension of fields. The following are equivalent: \n  \n  \n$L/K$ is separable, \n\n\n$\\text{Trace}_{L/K}$ is not identically zero, and \n\n\nthe trace pairing $Q_{L/K}$ is nondegenerate. \n\n\n\n\n    \n","Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 and 9.14.5. Hence by Lemma 9.20.5 we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2. Since $L/k$ is separable we see from Lemma 9.12.4 that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2. \n      $\\square$\n    \n"," by
  tfae_have 1 ‚Üí 3 := fun _ ‚Ü¶ traceForm_nondegenerate K L
  tfae_have 3 ‚Üí 2 := fun H‚ÇÅ H‚ÇÇ ‚Ü¶ H‚ÇÅ.ne_zero (by ext; simp [H‚ÇÇ])
  tfae_have 2 ‚Üí 1 := not_imp_comm.mp Algebra.trace_eq_zero_of_not_isSeparable
  tfae_finish
","theorem traceForm_nondegenerate_tfae [FiniteDimensional K L] :
    [Algebra.IsSeparable K L, Algebra.trace K L ‚â† 0, (traceForm K L).Nondegenerate].TFAE ","Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3 [[\n  Lemma 9.20.3. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then \n  \n  \\[  \\text{Norm}_{L/K}(\\alpha ) = (-1)^{[L : K]} a_ d^ e \\quad \\text{and}\\quad \\text{Trace}_{L/K}(\\alpha ) = - e a_1  \\]\n\n   where $e d = [L : K]$. \n\n    \n]]. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]] and 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. Hence by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2 [[\n  Lemma 9.20.2. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P$ be the minimal polynomial of $\\alpha $ over $K$. Then the characteristic polynomial of the $K$-linear map $\\alpha : L \\to L$ is equal to $P^ e$ with $e \\deg (P) = [L : K]$. \n\n    \n]]. Since $L/k$ is separable we see from Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2 [[\n  Lemma 9.13.2. Let $L$ be a field. Let $n \\geq 1$ and $\\alpha _1, \\ldots , \\alpha _ n \\in L$ pairwise distinct elements of $L$. Then there exists an $e \\geq 0$ such that $\\sum _{i = 1, \\ldots , n} \\alpha _ i^ e \\not= 0$. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      It is clear that (3) implies (2). If (2) holds, then pick $\\gamma \\in L$ with $\\text{Trace}_{L/K}(\\gamma ) \\not= 0$. Then if $\\alpha \\in L$ is nonzero, we see that $Q_{L/K}(\\alpha , \\gamma /\\alpha ) \\not= 0$. Hence $Q_{L/K}$ is nondegenerate. This proves the equivalence of (2) and (3). \n    \n      Suppose that $K$ has characteristic $p$ and $L = K(\\alpha )$ with $\\alpha \\not\\in K$ and $\\alpha ^ p \\in K$. Then $\\text{Trace}_{L/K}(1) = p = 0$. For $i = 1, \\ldots , p - 1$ we see that $x^ p - \\alpha ^{pi}$ is the minimal polynomial for $\\alpha ^ i$ over $K$ and we find $\\text{Trace}_{L/K}(\\alpha ^ i) = 0$ by Lemma 9.20.3 [[\n  Lemma 9.20.3. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then \n  \n  \\[  \\text{Norm}_{L/K}(\\alpha ) = (-1)^{[L : K]} a_ d^ e \\quad \\text{and}\\quad \\text{Trace}_{L/K}(\\alpha ) = - e a_1  \\]\n\n   where $e d = [L : K]$. \n\n    \n]]. Hence for this kind of purely inseparable degree $p$ extension we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume that $L/K$ is not separable. Then there exists a subfield $L/K\'/K$ such that $L/K\'$ is a purely inseparable degree $p$ extension as in the previous paragraph, see Lemmas 9.14.6 [[\n       \n      \n  Lemma 9.14.6. Let $E/F$ be an algebraic field extension. There exists a unique subextension $E/E_{sep}/F$ such that $E_{sep}/F$ is separable and $E/E_{sep}$ is purely inseparable. \n\n    \n]] and 9.14.5 [[\n  Lemma 9.14.5. Let $E/F$ be a finite purely inseparable field extension of characteristic $p > 0$. Then there exists a sequence of elements $\\alpha _1, \\ldots , \\alpha _ n \\in E$ such that we obtain a tower of fields \n  \n  \\[  E = F(\\alpha _1, \\ldots , \\alpha _ n) \\supset F(\\alpha _1, \\ldots , \\alpha _{n - 1}) \\supset \\ldots \\supset F(\\alpha _1) \\supset F  \\]\n\n   such that each intermediate extension is of degree $p$ and comes from adjoining a $p$th root. Namely, $\\alpha _ i^ p \\in F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ is an element which does not have a $p$th root in $F(\\alpha _1, \\ldots , \\alpha _{i - 1})$ for $i = 1, \\ldots , n$. \n\n    \n]]. Hence by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we see that $\\text{Trace}_{L/K}$ is identically zero. \n    \n      Assume on the other hand that $L/K$ is separable. By induction on the degree we will show that $\\text{Trace}_{L/K}$ is not identically zero. Thus by Lemma 9.20.5 [[\n  Lemma 9.20.5. Let $M/L/K$ be a tower of finite extensions of fields. Then \n  \n  \\[  \\text{Trace}_{M/K} = \\text{Trace}_{L/K} \\circ \\text{Trace}_{M/L} \\quad \\text{and}\\quad \\text{Norm}_{M/K} = \\text{Norm}_{L/K} \\circ \\text{Norm}_{M/L}  \\]\n\n\n    \n]] we may assume that $L/K$ is generated by a single element $\\alpha $ (use that if the trace is nonzero then it is surjective). We have to show that $\\text{Trace}_{L/K}(\\alpha ^ e)$ is nonzero for some $e \\geq 0$. Let $P = x^ d + a_1 x^{d - 1} + \\ldots + a_ d$ be the minimal polynomial of $\\alpha $ over $K$. Then $P$ is also the characteristic polynomial of the linear maps $\\alpha : L \\to L$, see Lemma 9.20.2 [[\n  Lemma 9.20.2. Let $L/K$ be a finite extension of fields. Let $\\alpha \\in L$ and let $P$ be the minimal polynomial of $\\alpha $ over $K$. Then the characteristic polynomial of the $K$-linear map $\\alpha : L \\to L$ is equal to $P^ e$ with $e \\deg (P) = [L : K]$. \n\n    \n]]. Since $L/k$ is separable we see from Lemma 9.12.4 [[\n  Lemma 9.12.4. Let $F$ be a field. An irreducible polynomial $P$ over $F$ is separable if and only if $P$ has pairwise distinct roots in an algebraic closure of $F$. \n\n    \n]] that $P$ has $d$ pairwise distinct roots $\\alpha _1, \\ldots , \\alpha _ d$ in an algebraic closure $\\overline{K}$ of $K$. Thus these are the eigenvalues of $\\alpha : L \\to L$. By linear algebra, the trace of $\\alpha ^ e$ is equal to $\\alpha _1^ e + \\ldots + \\alpha _ d^ e$. Thus we conclude by Lemma 9.13.2 [[\n  Lemma 9.13.2. Let $L$ be a field. Let $n \\geq 1$ and $\\alpha _1, \\ldots , \\alpha _ n \\in L$ pairwise distinct elements of $L$. Then there exists an $e \\geq 0$ such that $\\sum _{i = 1, \\ldots , n} \\alpha _ i^ e \\not= 0$. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the Lean proof is proving a three-way equivalence (via `tfae`) between (1) separability (or its negation), (2) existence of an element with nonzero trace, and (3) nondegeneracy of the trace form, which matches the main claims discussed in the informal proof: (3)‚áí(2) is called ‚Äúclear‚Äù, (2)‚áí(3) is shown by an explicit bilinear-form argument, and the remaining direction relates separability to trace being nonzero/zero. Structurally, however, the correspondence is only partial: Lean uses library lemmas (`traceForm_nondegenerate`, `Algebra.trace_eq_zero_of_not_isSeparable`, and a short ext/simp argument) rather than the explicit constructions and case splits in the informal proof (purely inseparable degree p, tower decomposition, induction on degree, eigenvalue/power-sum argument). In particular, the informal proof gives detailed reasoning for both ‚Äònot separable ‚áí trace identically zero‚Äô and ‚Äòseparable ‚áí trace not identically zero‚Äô, while the Lean proof compresses this into a single lemma and a contrapositive step (`not_imp_comm.mp`). So the high-level logical content aligns, but the formal proof omits most of the informal proof‚Äôs internal structure and intermediate arguments.""}"
352,00UW,"instance [FormallyUnramified R S] :
    Algebra.IsSeparable (ResidueField R) (ResidueField S) :=
  FormallyUnramified.isSeparable _ _
",Formal Proof of Stacks Project Tag 00UW,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Unramified/LocalRing.lean#L53-L55,Q27041,,10.151.5,lemma,3.0,"['00US', '00AO', '0ELQ']","\n  Lemma 10.151.5. Let $R \\to S$ be a ring map. Let $\\mathfrak q \\subset S$ be a prime lying over $\\mathfrak p$ in $R$. If $S/R$ is unramified at $\\mathfrak q$ then \n  \n  \nwe have $\\mathfrak p S_{\\mathfrak q} = \\mathfrak qS_{\\mathfrak q}$ is the maximal ideal of the local ring $S_{\\mathfrak q}$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/\\kappa (\\mathfrak p)$ is finite separable. \n\n\n\n\n    \n      Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3. By Lemma 10.140.3 it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4. This implies the lemma. \n      $\\square$\n    \n","\n  Lemma 10.151.5. Let $R \\to S$ be a ring map. Let $\\mathfrak q \\subset S$ be a prime lying over $\\mathfrak p$ in $R$. If $S/R$ is unramified at $\\mathfrak q$ then \n  \n  \nwe have $\\mathfrak p S_{\\mathfrak q} = \\mathfrak qS_{\\mathfrak q}$ is the maximal ideal of the local ring $S_{\\mathfrak q}$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/\\kappa (\\mathfrak p)$ is finite separable. \n\n\n\n\n    \n","Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3. By Lemma 10.140.3 it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4. This implies the lemma. \n      $\\square$\n    \n","
  FormallyUnramified.isSeparable _ _
","instance [FormallyUnramified R S] :
    Algebra.IsSeparable (ResidueField R) (ResidueField S) ","Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3 [[\n  Lemma 10.151.3. Properties of unramified and G-unramified ring maps. \n  \n  \nThe base change of an unramified ring map is unramified. The base change of a G-unramified ring map is G-unramified. \n\n\nThe composition of unramified ring maps is unramified. The composition of G-unramified ring maps is G-unramified. \n\n\nAny principal localization $R \\to R_ f$ is G-unramified and unramified. \n\n\nIf $I \\subset R$ is an ideal, then $R \\to R/I$ is unramified. If $I \\subset R$ is a finitely generated ideal, then $R \\to R/I$ is G-unramified. \n\n\nAn \xc3\xa9tale ring map is G-unramified and unramified. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $(\\Omega _{S/R})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $\\Omega _{S/R} \\otimes _ S \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)}) \\otimes _{S \\otimes _ R \\kappa (\\mathfrak p)} \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is a ring map, $g_1, \\ldots , g_ m \\in S$ generate the unit ideal and $R \\to S_{g_ j}$ is unramified (resp. G-unramified) for $j = 1, \\ldots , m$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is a ring map which is unramified (resp. G-unramified) at every prime of $S$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is G-unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and a G-unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S = R \\otimes _{R_0} S_0$. \n\n\nIf $R \\to S$ is unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and an unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S$ is a quotient of $R \\otimes _{R_0} S_0$. \n\n\n\n\n    \n]]. By Lemma 10.140.3 [[\n  Lemma 10.140.3. Let $k$ be any field. Let $S$ be a finite type $k$-algebra. Let $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$. The following are equivalent: \n  \n  \nThe $k$-algebra $S$ is smooth at $\\mathfrak q$ over $k$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) \\leq \\dim _ x X$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) = \\dim _ x X$. \n\n\n\n   Moreover, in this case the local ring $S_{\\mathfrak q}$ is regular. \n\n    \n]] it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4 [[\n  Lemma 10.143.4. Let $k$ be a field. A ring map $k \\to S$ is \xc3\xa9tale if and only if $S$ is isomorphic as a $k$-algebra to a finite product of finite separable extensions of $k$. \n\n    \n]]. This implies the lemma. \n      $\\square$\n    \n","Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3 [[\n  Lemma 10.151.3. Properties of unramified and G-unramified ring maps. \n  \n  \nThe base change of an unramified ring map is unramified. The base change of a G-unramified ring map is G-unramified. \n\n\nThe composition of unramified ring maps is unramified. The composition of G-unramified ring maps is G-unramified. \n\n\nAny principal localization $R \\to R_ f$ is G-unramified and unramified. \n\n\nIf $I \\subset R$ is an ideal, then $R \\to R/I$ is unramified. If $I \\subset R$ is a finitely generated ideal, then $R \\to R/I$ is G-unramified. \n\n\nAn \xc3\xa9tale ring map is G-unramified and unramified. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $(\\Omega _{S/R})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $\\Omega _{S/R} \\otimes _ S \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)}) \\otimes _{S \\otimes _ R \\kappa (\\mathfrak p)} \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is a ring map, $g_1, \\ldots , g_ m \\in S$ generate the unit ideal and $R \\to S_{g_ j}$ is unramified (resp. G-unramified) for $j = 1, \\ldots , m$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is a ring map which is unramified (resp. G-unramified) at every prime of $S$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is G-unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and a G-unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S = R \\otimes _{R_0} S_0$. \n\n\nIf $R \\to S$ is unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and an unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S$ is a quotient of $R \\otimes _{R_0} S_0$. \n\n\n\n\n    \n]]. By Lemma 10.140.3 [[\n  Lemma 10.140.3. Let $k$ be any field. Let $S$ be a finite type $k$-algebra. Let $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$. The following are equivalent: \n  \n  \nThe $k$-algebra $S$ is smooth at $\\mathfrak q$ over $k$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) \\leq \\dim _ x X$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) = \\dim _ x X$. \n\n\n\n   Moreover, in this case the local ring $S_{\\mathfrak q}$ is regular. \n\n    \n]] it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4 [[\n  Lemma 10.143.4. Let $k$ be a field. A ring map $k \\to S$ is \xc3\xa9tale if and only if $S$ is isomorphic as a $k$-algebra to a finite product of finite separable extensions of $k$. \n\n    \n]]. This implies the lemma. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that after localizing to make the map unramified, the fiber ring S ‚äó_R Œ∫(p) is unramified over the field Œ∫(p), hence smooth/√©tale, hence a finite product of finite separable field extensions, concluding separability. The Lean proof is just a one-line invocation `FormallyUnramified.isSeparable _ _`, which (presumably) states directly that a formally unramified algebra is separable, without exhibiting the intermediate steps (localization, base change to residue field, √©tale characterization as product of separable extensions). Structurally, there is essentially no correspondence: the informal proof is a multi-lemma geometric argument, while the formal proof is a direct lemma application. Completeness is low relative to the informal narrative (it omits the reductions and cited lemmas), though it may still prove the same end statement if the underlying Lean lemma matches the intended conclusion. Precision is fine (no extra claims), but the mismatch in method and missing intermediate reasoning yields weak alignment overall.""}"
353,00UW,"lemma FormallyUnramified.map_maximalIdeal [FormallyUnramified R S] :
    (maximalIdeal R).map (algebraMap R S) = maximalIdeal S := by
  apply eq_maximalIdeal
  rw [Ideal.Quotient.maximal_ideal_iff_isField_quotient]
  exact isField_quotient_map_maximalIdeal
",Formal Proof of Stacks Project Tag 00UW,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Unramified/LocalRing.lean#L77-L81,Q27041,,10.151.5,lemma,3.0,"['00US', '00AO', '0ELQ']","\n  Lemma 10.151.5. Let $R \\to S$ be a ring map. Let $\\mathfrak q \\subset S$ be a prime lying over $\\mathfrak p$ in $R$. If $S/R$ is unramified at $\\mathfrak q$ then \n  \n  \nwe have $\\mathfrak p S_{\\mathfrak q} = \\mathfrak qS_{\\mathfrak q}$ is the maximal ideal of the local ring $S_{\\mathfrak q}$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/\\kappa (\\mathfrak p)$ is finite separable. \n\n\n\n\n    \n      Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3. By Lemma 10.140.3 it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4. This implies the lemma. \n      $\\square$\n    \n","\n  Lemma 10.151.5. Let $R \\to S$ be a ring map. Let $\\mathfrak q \\subset S$ be a prime lying over $\\mathfrak p$ in $R$. If $S/R$ is unramified at $\\mathfrak q$ then \n  \n  \nwe have $\\mathfrak p S_{\\mathfrak q} = \\mathfrak qS_{\\mathfrak q}$ is the maximal ideal of the local ring $S_{\\mathfrak q}$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/\\kappa (\\mathfrak p)$ is finite separable. \n\n\n\n\n    \n","Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3. By Lemma 10.140.3 it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4. This implies the lemma. \n      $\\square$\n    \n"," by
  apply eq_maximalIdeal
  rw [Ideal.Quotient.maximal_ideal_iff_isField_quotient]
  exact isField_quotient_map_maximalIdeal
","lemma FormallyUnramified.map_maximalIdeal [FormallyUnramified R S] :
    (maximalIdeal R).map (algebraMap R S) = maximalIdeal S ","Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3 [[\n  Lemma 10.151.3. Properties of unramified and G-unramified ring maps. \n  \n  \nThe base change of an unramified ring map is unramified. The base change of a G-unramified ring map is G-unramified. \n\n\nThe composition of unramified ring maps is unramified. The composition of G-unramified ring maps is G-unramified. \n\n\nAny principal localization $R \\to R_ f$ is G-unramified and unramified. \n\n\nIf $I \\subset R$ is an ideal, then $R \\to R/I$ is unramified. If $I \\subset R$ is a finitely generated ideal, then $R \\to R/I$ is G-unramified. \n\n\nAn \xc3\xa9tale ring map is G-unramified and unramified. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $(\\Omega _{S/R})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $\\Omega _{S/R} \\otimes _ S \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)}) \\otimes _{S \\otimes _ R \\kappa (\\mathfrak p)} \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is a ring map, $g_1, \\ldots , g_ m \\in S$ generate the unit ideal and $R \\to S_{g_ j}$ is unramified (resp. G-unramified) for $j = 1, \\ldots , m$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is a ring map which is unramified (resp. G-unramified) at every prime of $S$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is G-unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and a G-unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S = R \\otimes _{R_0} S_0$. \n\n\nIf $R \\to S$ is unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and an unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S$ is a quotient of $R \\otimes _{R_0} S_0$. \n\n\n\n\n    \n]]. By Lemma 10.140.3 [[\n  Lemma 10.140.3. Let $k$ be any field. Let $S$ be a finite type $k$-algebra. Let $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$. The following are equivalent: \n  \n  \nThe $k$-algebra $S$ is smooth at $\\mathfrak q$ over $k$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) \\leq \\dim _ x X$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) = \\dim _ x X$. \n\n\n\n   Moreover, in this case the local ring $S_{\\mathfrak q}$ is regular. \n\n    \n]] it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4 [[\n  Lemma 10.143.4. Let $k$ be a field. A ring map $k \\to S$ is \xc3\xa9tale if and only if $S$ is isomorphic as a $k$-algebra to a finite product of finite separable extensions of $k$. \n\n    \n]]. This implies the lemma. \n      $\\square$\n    \n","Proof.\n      We may first replace $S$ by $S_ g$ for some $g \\in S$, $g \\not\\in \\mathfrak q$ and assume that $R \\to S$ is unramified. The base change $S \\otimes _ R \\kappa (\\mathfrak p)$ is unramified over $\\kappa (\\mathfrak p)$ by Lemma 10.151.3 [[\n  Lemma 10.151.3. Properties of unramified and G-unramified ring maps. \n  \n  \nThe base change of an unramified ring map is unramified. The base change of a G-unramified ring map is G-unramified. \n\n\nThe composition of unramified ring maps is unramified. The composition of G-unramified ring maps is G-unramified. \n\n\nAny principal localization $R \\to R_ f$ is G-unramified and unramified. \n\n\nIf $I \\subset R$ is an ideal, then $R \\to R/I$ is unramified. If $I \\subset R$ is a finitely generated ideal, then $R \\to R/I$ is G-unramified. \n\n\nAn \xc3\xa9tale ring map is G-unramified and unramified. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $(\\Omega _{S/R})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $\\Omega _{S/R} \\otimes _ S \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)}) \\otimes _{S \\otimes _ R \\kappa (\\mathfrak p)} \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is a ring map, $g_1, \\ldots , g_ m \\in S$ generate the unit ideal and $R \\to S_{g_ j}$ is unramified (resp. G-unramified) for $j = 1, \\ldots , m$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is a ring map which is unramified (resp. G-unramified) at every prime of $S$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is G-unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and a G-unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S = R \\otimes _{R_0} S_0$. \n\n\nIf $R \\to S$ is unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and an unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S$ is a quotient of $R \\otimes _{R_0} S_0$. \n\n\n\n\n    \n]]. By Lemma 10.140.3 [[\n  Lemma 10.140.3. Let $k$ be any field. Let $S$ be a finite type $k$-algebra. Let $X = \\mathop{\\mathrm{Spec}}(S)$. Let $\\mathfrak q \\subset S$ be a prime corresponding to $x \\in X$. The following are equivalent: \n  \n  \nThe $k$-algebra $S$ is smooth at $\\mathfrak q$ over $k$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) \\leq \\dim _ x X$. \n\n\nWe have $\\dim _{\\kappa (\\mathfrak q)} \\Omega _{S/k} \\otimes _ S \\kappa (\\mathfrak q) = \\dim _ x X$. \n\n\n\n   Moreover, in this case the local ring $S_{\\mathfrak q}$ is regular. \n\n    \n]] it is smooth hence \xc3\xa9tale over $\\kappa (\\mathfrak p)$. Hence we see that $S \\otimes _ R \\kappa (\\mathfrak p) = (R \\setminus \\mathfrak p)^{-1} S/\\mathfrak pS$ is a product of finite separable field extensions of $\\kappa (\\mathfrak p)$ by Lemma 10.143.4 [[\n  Lemma 10.143.4. Let $k$ be a field. A ring map $k \\to S$ is \xc3\xa9tale if and only if $S$ is isomorphic as a $k$-algebra to a finite product of finite separable extensions of $k$. \n\n    \n]]. This implies the lemma. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""1"", ""brief_justification"": ""The informal proof is about commutative algebra/algebraic geometry: localizing to assume an unramified map, using base change stability of unramifiedness, then deducing smooth/√©tale over a residue field and concluding the base change ring is a finite product of finite separable field extensions. The Lean proof instead is a short argument about maximal ideals/fields in an ideal quotient: it applies `eq_maximalIdeal`, rewrites using `Ideal.Quotient.maximal_ideal_iff_isField_quotient`, and finishes with `isField_quotient_map_maximalIdeal`. Semantically these are unrelated (maximal ideal characterization vs unramified/√©tale base change and product of fields). Structurally there is no correspondence either: the informal proof has multiple reduction and lemma applications about unramified/√©tale, while the Lean proof is a three-line maximal-ideal/isField rewrite. Thus the formal proof does not capture the content or structure of the informal proof.""}"
354,02FM,"lemma FormallyUnramified.of_map_maximalIdeal
    [Algebra.IsSeparable (ResidueField R) (ResidueField S)]
    (H : (maximalIdeal R).map (algebraMap R S) = maximalIdeal S) :
    Algebra.FormallyUnramified R S := by
  constructor
  have : FormallyUnramified (ResidueField R) (ResidueField S) := .of_isSeparable _ _
  have : FormallyUnramified R (ResidueField S) := .comp _ (ResidueField R) _
  rw [‚Üê subsingleton_tensorProduct (R := S)]
  refine subsingleton_of_forall_eq 0 fun x ‚Ü¶ ?_
  obtain ‚ü®x, rfl‚ü© := (KaehlerDifferential.exact_kerCotangentToTensor_mapBaseChange R S
    (ResidueField S) Ideal.Quotient.mk_surjective x).mp (Subsingleton.elim _ _)
  obtain ‚ü®‚ü®x, hx‚ü©, rfl‚ü© := Ideal.toCotangent_surjective _ x
  simp only [KaehlerDifferential.kerCotangentToTensor_toCotangent]
  replace hx : x ‚àà Ideal.map (algebraMap R S) (maximalIdeal R) := by simpa [H] using hx
  induction hx using Submodule.span_induction with
  | zero => simp
  | mem x h => obtain ‚ü®x, hx, rfl‚ü© := h; simp
  | add x y hx hy _ _ => simp [*, TensorProduct.tmul_add]
  | smul a x hx _ =>
    have : residue S x = 0 := by rwa [residue_eq_zero_iff, ‚Üê H]
    simp [*, TensorProduct.tmul_add, TensorProduct.smul_tmul', ‚Üê Algebra.algebraMap_eq_smul_one]
",Formal Proof of Stacks Project Tag 02FM,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Unramified/LocalRing.lean#L84-L104,Q27041,,10.151.7,lemma,3.0,"['00US', '00AO', '0ELQ']","\n  Lemma 10.151.7. Let $R \\to S$ be a ring map. Let $\\mathfrak q$ be a prime of $S$ lying over a prime $\\mathfrak p$ of $R$. If \n  \n  \n$R \\to S$ is of finite type, \n\n\n$\\mathfrak p S_{\\mathfrak q}$ is the maximal ideal of the local ring $S_{\\mathfrak q}$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/\\kappa (\\mathfrak p)$ is finite separable, \n\n\n\n   then $R \\to S$ is unramified at $\\mathfrak q$. \n\n    \n      Proof.\n      By Lemma 10.151.3 (8) it suffices to show that $\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p) / \\kappa (\\mathfrak p)}$ is zero when localized at $\\mathfrak q$. Hence we may replace $S$ by $S \\otimes _ R \\kappa (\\mathfrak p)$ and $R$ by $\\kappa (\\mathfrak p)$. In other words, we may assume that $R = k$ is a field and $S$ is a finite type $k$-algebra. In this case the hypotheses imply that $S_{\\mathfrak q} \\cong \\kappa (\\mathfrak q)$. Thus $(\\Omega _{S/k})_{\\mathfrak q} = \\Omega _{S_\\mathfrak q/k} = \\Omega _{\\kappa (\\mathfrak q)/k}$ is zero as desired (the first equality is Lemma 10.131.8). \n      $\\square$\n    \n","\n  Lemma 10.151.7. Let $R \\to S$ be a ring map. Let $\\mathfrak q$ be a prime of $S$ lying over a prime $\\mathfrak p$ of $R$. If \n  \n  \n$R \\to S$ is of finite type, \n\n\n$\\mathfrak p S_{\\mathfrak q}$ is the maximal ideal of the local ring $S_{\\mathfrak q}$, and \n\n\nthe field extension $\\kappa (\\mathfrak q)/\\kappa (\\mathfrak p)$ is finite separable, \n\n\n\n   then $R \\to S$ is unramified at $\\mathfrak q$. \n\n    \n","Proof.\n      By Lemma 10.151.3 (8) it suffices to show that $\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p) / \\kappa (\\mathfrak p)}$ is zero when localized at $\\mathfrak q$. Hence we may replace $S$ by $S \\otimes _ R \\kappa (\\mathfrak p)$ and $R$ by $\\kappa (\\mathfrak p)$. In other words, we may assume that $R = k$ is a field and $S$ is a finite type $k$-algebra. In this case the hypotheses imply that $S_{\\mathfrak q} \\cong \\kappa (\\mathfrak q)$. Thus $(\\Omega _{S/k})_{\\mathfrak q} = \\Omega _{S_\\mathfrak q/k} = \\Omega _{\\kappa (\\mathfrak q)/k}$ is zero as desired (the first equality is Lemma 10.131.8). \n      $\\square$\n    \n"," by
  constructor
  have : FormallyUnramified (ResidueField R) (ResidueField S) := .of_isSeparable _ _
  have : FormallyUnramified R (ResidueField S) := .comp _ (ResidueField R) _
  rw [‚Üê subsingleton_tensorProduct (R := S)]
  refine subsingleton_of_forall_eq 0 fun x ‚Ü¶ ?_
  obtain ‚ü®x, rfl‚ü© := (KaehlerDifferential.exact_kerCotangentToTensor_mapBaseChange R S
    (ResidueField S) Ideal.Quotient.mk_surjective x).mp (Subsingleton.elim _ _)
  obtain ‚ü®‚ü®x, hx‚ü©, rfl‚ü© := Ideal.toCotangent_surjective _ x
  simp only [KaehlerDifferential.kerCotangentToTensor_toCotangent]
  replace hx : x ‚àà Ideal.map (algebraMap R S) (maximalIdeal R) := by simpa [H] using hx
  induction hx using Submodule.span_induction with
  | zero => simp
  | mem x h => obtain ‚ü®x, hx, rfl‚ü© := h; simp
  | add x y hx hy _ _ => simp [*, TensorProduct.tmul_add]
  | smul a x hx _ =>
    have : residue S x = 0 := by rwa [residue_eq_zero_iff, ‚Üê H]
    simp [*, TensorProduct.tmul_add, TensorProduct.smul_tmul', ‚Üê Algebra.algebraMap_eq_smul_one]
","lemma FormallyUnramified.of_map_maximalIdeal
    [Algebra.IsSeparable (ResidueField R) (ResidueField S)]
    (H : (maximalIdeal R).map (algebraMap R S) = maximalIdeal S) :
    Algebra.FormallyUnramified R S ","Proof.\n      By Lemma 10.151.3 [[\n  Lemma 10.151.3. Properties of unramified and G-unramified ring maps. \n  \n  \nThe base change of an unramified ring map is unramified. The base change of a G-unramified ring map is G-unramified. \n\n\nThe composition of unramified ring maps is unramified. The composition of G-unramified ring maps is G-unramified. \n\n\nAny principal localization $R \\to R_ f$ is G-unramified and unramified. \n\n\nIf $I \\subset R$ is an ideal, then $R \\to R/I$ is unramified. If $I \\subset R$ is a finitely generated ideal, then $R \\to R/I$ is G-unramified. \n\n\nAn \xc3\xa9tale ring map is G-unramified and unramified. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $(\\Omega _{S/R})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $\\Omega _{S/R} \\otimes _ S \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)}) \\otimes _{S \\otimes _ R \\kappa (\\mathfrak p)} \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is a ring map, $g_1, \\ldots , g_ m \\in S$ generate the unit ideal and $R \\to S_{g_ j}$ is unramified (resp. G-unramified) for $j = 1, \\ldots , m$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is a ring map which is unramified (resp. G-unramified) at every prime of $S$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is G-unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and a G-unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S = R \\otimes _{R_0} S_0$. \n\n\nIf $R \\to S$ is unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and an unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S$ is a quotient of $R \\otimes _{R_0} S_0$. \n\n\n\n\n    \n]] (8) it suffices to show that $\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p) / \\kappa (\\mathfrak p)}$ is zero when localized at $\\mathfrak q$. Hence we may replace $S$ by $S \\otimes _ R \\kappa (\\mathfrak p)$ and $R$ by $\\kappa (\\mathfrak p)$. In other words, we may assume that $R = k$ is a field and $S$ is a finite type $k$-algebra. In this case the hypotheses imply that $S_{\\mathfrak q} \\cong \\kappa (\\mathfrak q)$. Thus $(\\Omega _{S/k})_{\\mathfrak q} = \\Omega _{S_\\mathfrak q/k} = \\Omega _{\\kappa (\\mathfrak q)/k}$ is zero as desired (the first equality is Lemma 10.131.8 [[\n  Lemma 10.131.8. Let $\\varphi : A \\to B$ be a ring map. \n  \n  \nIf $S \\subset A$ is a multiplicative subset mapping to invertible elements of $B$, then $\\Omega _{B/A} = \\Omega _{B/S^{-1}A}$. \n\n\nIf $S \\subset B$ is a multiplicative subset then $S^{-1}\\Omega _{B/A} = \\Omega _{S^{-1}B/A}$. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","Proof.\n      By Lemma 10.151.3 [[\n  Lemma 10.151.3. Properties of unramified and G-unramified ring maps. \n  \n  \nThe base change of an unramified ring map is unramified. The base change of a G-unramified ring map is G-unramified. \n\n\nThe composition of unramified ring maps is unramified. The composition of G-unramified ring maps is G-unramified. \n\n\nAny principal localization $R \\to R_ f$ is G-unramified and unramified. \n\n\nIf $I \\subset R$ is an ideal, then $R \\to R/I$ is unramified. If $I \\subset R$ is a finitely generated ideal, then $R \\to R/I$ is G-unramified. \n\n\nAn \xc3\xa9tale ring map is G-unramified and unramified. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $(\\Omega _{S/R})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime and $\\Omega _{S/R} \\otimes _ S \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. finite presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)})_{\\mathfrak q} = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is of finite type (resp. presentation), $\\mathfrak q \\subset S$ is a prime lying over $\\mathfrak p \\subset R$ and $(\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p)/\\kappa (\\mathfrak p)}) \\otimes _{S \\otimes _ R \\kappa (\\mathfrak p)} \\kappa (\\mathfrak q) = 0$, then $R \\to S$ is unramified (resp. G-unramified) at $\\mathfrak q$. \n\n\nIf $R \\to S$ is a ring map, $g_1, \\ldots , g_ m \\in S$ generate the unit ideal and $R \\to S_{g_ j}$ is unramified (resp. G-unramified) for $j = 1, \\ldots , m$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is a ring map which is unramified (resp. G-unramified) at every prime of $S$, then $R \\to S$ is unramified (resp. G-unramified). \n\n\nIf $R \\to S$ is G-unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and a G-unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S = R \\otimes _{R_0} S_0$. \n\n\nIf $R \\to S$ is unramified, then there exists a finite type $\\mathbf{Z}$-algebra $R_0$ and an unramified ring map $R_0 \\to S_0$ and a ring map $R_0 \\to R$ such that $S$ is a quotient of $R \\otimes _{R_0} S_0$. \n\n\n\n\n    \n]] (8) it suffices to show that $\\Omega _{S \\otimes _ R \\kappa (\\mathfrak p) / \\kappa (\\mathfrak p)}$ is zero when localized at $\\mathfrak q$. Hence we may replace $S$ by $S \\otimes _ R \\kappa (\\mathfrak p)$ and $R$ by $\\kappa (\\mathfrak p)$. In other words, we may assume that $R = k$ is a field and $S$ is a finite type $k$-algebra. In this case the hypotheses imply that $S_{\\mathfrak q} \\cong \\kappa (\\mathfrak q)$. Thus $(\\Omega _{S/k})_{\\mathfrak q} = \\Omega _{S_\\mathfrak q/k} = \\Omega _{\\kappa (\\mathfrak q)/k}$ is zero as desired (the first equality is Lemma 10.131.8 [[\n  Lemma 10.131.8. Let $\\varphi : A \\to B$ be a ring map. \n  \n  \nIf $S \\subset A$ is a multiplicative subset mapping to invertible elements of $B$, then $\\Omega _{B/A} = \\Omega _{B/S^{-1}A}$. \n\n\nIf $S \\subset B$ is a multiplicative subset then $S^{-1}\\Omega _{B/A} = \\Omega _{S^{-1}B/A}$. \n\n\n\n\n    \n]]). \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues an unramifiedness criterion via vanishing of K√§hler differentials after base change/localization (reduce to a field, identify a localization with a residue field, then conclude Œ©=0). The Lean proof instead constructs `FormallyUnramified` instances for residue field extensions (using separability and composition), then proves a tensor product is subsingleton via exactness/surjectivity lemmas about the cotangent module and an explicit span-induction argument in an ideal. Structurally, the informal proof is a high-level reduction using Lemma 10.151.3(8) and localization properties, while the Lean proof is a direct algebraic manipulation in the cotangent/tensor setting and does not mirror the reduction-to-field/localization-to-residue-field steps. There is partial thematic overlap (both revolve around vanishing/cotangent/K√§hler differentials and residue fields), but the main lemmas and proof strategy do not correspond closely, and the Lean proof contains substantial extra machinery (subsingleton tensor product, exact_kerCotangentToTensor_mapBaseChange, span induction) not reflected in the informal argument.""}"
355,00IC,"-- the conclusion could be `IsIntegrallyClosedIn R.toSubring K`, which has slightly worse defeq.
lemma LocalSubring.mem_of_isMax_of_isIntegral {R : LocalSubring K}
    (hR : IsMax R) {x : K} (hx : IsIntegral R.toSubring x) : x ‚àà R.toSubring := by
  let S := Algebra.adjoin R.toSubring {x}
  have : Algebra.IsIntegral R.toSubring S := Algebra.IsIntegral.adjoin (by simpa)
  obtain ‚ü®Q : Ideal S.toSubring, hQ, e‚ü© := Ideal.exists_ideal_over_maximal_of_isIntegral
    (S := S) (maximalIdeal R.toSubring) (le_maximalIdeal (by simp))
  have : R = .ofPrime S.toSubring Q := by
    have hRS : R.toSubring ‚â§ S.toSubring := fun r hr ‚Ü¶ algebraMap_mem S ‚ü®r, hr‚ü©
    refine hR.eq_of_le ‚ü®hRS.trans (LocalSubring.le_ofPrime _ _), ((local_hom_TFAE _).out 2 0).mp ?_‚ü©
    conv_rhs => rw [‚Üê IsLocalization.AtPrime.map_eq_maximalIdeal Q]
    refine .trans ?_ (Ideal.map_mono <| Ideal.map_le_iff_le_comap.mpr e.ge)
    rw [Ideal.map_map]; rfl
  rw [this]
  exact LocalSubring.le_ofPrime _ _ (Algebra.self_mem_adjoin_singleton _ _)
",Formal Proof of Stacks Project Tag 00IC,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Valuation/LocalSubring.lean#L60-L74,Q27041,,10.50.3,lemma,3.0,"['00I8', '00AO', '0ELQ']","\n  Lemma 10.50.3. Let $A$ be a valuation ring. Then $A$ is a normal domain. \n\n    \n      Proof.\n      Suppose $x$ is in the field of fractions of $A$ and integral over $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A\\subset A\'$ is an integral extension, we see by Lemma 10.36.17 that there is a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. Since $A$ is a valuation ring we conclude that $A=A\'_{\\mathfrak m\'}$ and therefore that $x\\in A$. \n      $\\square$\n    \n",\n  Lemma 10.50.3. Let $A$ be a valuation ring. Then $A$ is a normal domain. \n\n    \n,"Proof.\n      Suppose $x$ is in the field of fractions of $A$ and integral over $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A\\subset A\'$ is an integral extension, we see by Lemma 10.36.17 that there is a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. Since $A$ is a valuation ring we conclude that $A=A\'_{\\mathfrak m\'}$ and therefore that $x\\in A$. \n      $\\square$\n    \n"," by
  let S := Algebra.adjoin R.toSubring {x}
  have : Algebra.IsIntegral R.toSubring S := Algebra.IsIntegral.adjoin (by simpa)
  obtain ‚ü®Q : Ideal S.toSubring, hQ, e‚ü© := Ideal.exists_ideal_over_maximal_of_isIntegral
    (S := S) (maximalIdeal R.toSubring) (le_maximalIdeal (by simp))
  have : R = .ofPrime S.toSubring Q := by
    have hRS : R.toSubring ‚â§ S.toSubring := fun r hr ‚Ü¶ algebraMap_mem S ‚ü®r, hr‚ü©
    refine hR.eq_of_le ‚ü®hRS.trans (LocalSubring.le_ofPrime _ _), ((local_hom_TFAE _).out 2 0).mp ?_‚ü©
    conv_rhs => rw [‚Üê IsLocalization.AtPrime.map_eq_maximalIdeal Q]
    refine .trans ?_ (Ideal.map_mono <| Ideal.map_le_iff_le_comap.mpr e.ge)
    rw [Ideal.map_map]; rfl
  rw [this]
  exact LocalSubring.le_ofPrime _ _ (Algebra.self_mem_adjoin_singleton _ _)
","-- the conclusion could be `IsIntegrallyClosedIn R.toSubring K`, which has slightly worse defeq.
lemma LocalSubring.mem_of_isMax_of_isIntegral {R : LocalSubring K}
    (hR : IsMax R) {x : K} (hx : IsIntegral R.toSubring x) : x ‚àà R.toSubring ","Proof.\n      Suppose $x$ is in the field of fractions of $A$ and integral over $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A\\subset A\'$ is an integral extension, we see by Lemma 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] that there is a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. Since $A$ is a valuation ring we conclude that $A=A\'_{\\mathfrak m\'}$ and therefore that $x\\in A$. \n      $\\square$\n    \n","Proof.\n      Suppose $x$ is in the field of fractions of $A$ and integral over $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A\\subset A\'$ is an integral extension, we see by Lemma 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] that there is a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. Since $A$ is a valuation ring we conclude that $A=A\'_{\\mathfrak m\'}$ and therefore that $x\\in A$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs follow the same strategy: form the subring generated by the base ring and the element x (formal: `S := Algebra.adjoin ... {x}`; informal: `A'`), use integrality of the extension (formal: `Algebra.IsIntegral.adjoin`; informal: ‚ÄúA ‚äÇ A' is integral‚Äù), apply a lying-over/surjectivity result to obtain a prime/maximal ideal over the given maximal ideal (formal: `Ideal.exists_ideal_over_maximal_of_isIntegral ... obtain ‚ü®Q, hQ, e‚ü©`; informal: ‚Äúthere is a prime ideal m' lying over m‚Äù), then use domination/localization at that prime and the valuation-ring property to conclude equality of local rings and hence x ‚àà A (formal: constructs an equality `R = .ofPrime S.toSubring Q` via `hR.eq_of_le ...` and then concludes membership using `LocalSubring.le_ofPrime ... (Algebra.self_mem_adjoin_singleton ...)`; informal: ‚ÄúA'_{m'} dominates A; since A is valuation ring, A = A'_{m'}; hence x ‚àà A‚Äù).\nStructurally, the Lean proof mirrors the informal steps but with more technical machinery: it uses a maximal ideal and `IsLocalization.AtPrime.map_eq_maximalIdeal`/ideal map-comap manipulations to express the domination condition, which is not explicitly present in the informal proof. Also, the informal proof mentions Spec-surjectivity (Lemma 10.36.17) while the formal proof uses a specialized lemma producing an ideal over a maximal ideal; these are closely related but not identical in statement. Overall the core argument aligns well, with minor divergence in the exact lemmas and extra localization/ideal-map details in the formalization.""}"
356,052K,"lemma ValuationSubring.isMax_toLocalSubring (R : ValuationSubring K) :
    IsMax R.toLocalSubring := by
  intro S hS
  refine (LocalSubring.toSubring_injective (hS.1.antisymm fun x hx ‚Ü¶ (R.2 x).elim id fun h ‚Ü¶ ?_)).ge
  by_contra h'
  have hx0 : x ‚â† 0 := by rintro rfl; exact h' R.zero_mem
  have : IsUnit (Subring.inclusion hS.1 ‚ü®x‚Åª¬π, h‚ü©) :=
    isUnit_iff_exists_inv.mpr ‚ü®‚ü®x, hx‚ü©, Subtype.ext (inv_mul_cancel‚ÇÄ hx0)‚ü©
  obtain ‚ü®x', hx'‚ü© := isUnit_iff_exists_inv.mp (hS.2.1 _ this)
  have : x' = x := by simpa [Subtype.ext_iff, inv_mul_eq_iff_eq_mul‚ÇÄ hx0] using hx'
  exact h' (this ‚ñ∏ x'.2)
",Formal Proof of Stacks Project Tag 052K,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Valuation/LocalSubring.lean#L77-L87,Q27041,,10.50.5,lemma,3.0,"['00I8', '00AO', '0ELQ']","\n  Lemma 10.50.5. Let $A \\subset K$ be a subring of a field $K$ such that for all $x \\in K$ either $x \\in A$ or $x^{-1} \\in A$ or both. Then $A$ is a valuation ring with fraction field $K$. \n\n    \n      Proof.\n      If $A$ is not $K$, then $A$ is not a field and there is a nonzero maximal ideal $\\mathfrak m$. If $\\mathfrak m\'$ is a second maximal ideal, then choose $x, y \\in A$ with $x \\in \\mathfrak m$, $y \\not\\in \\mathfrak m$, $x \\not\\in \\mathfrak m\'$, and $y \\in \\mathfrak m\'$. Then neither $x/y \\in A$ nor $y/x \\in A$ contradicting the assumption of the lemma. Thus we see that $A$ is a local ring. Suppose that $A\'$ is a local ring contained in $K$ which dominates $A$. Let $x \\in A\'$. We have to show that $x \\in A$. If not, then $x^{-1} \\in A$, and of course $x^{-1} \\in \\mathfrak m_ A$. But then $x^{-1} \\in \\mathfrak m_{A\'}$ which contradicts $x \\in A\'$. \n      $\\square$\n    \n",\n  Lemma 10.50.5. Let $A \\subset K$ be a subring of a field $K$ such that for all $x \\in K$ either $x \\in A$ or $x^{-1} \\in A$ or both. Then $A$ is a valuation ring with fraction field $K$. \n\n    \n,"Proof.\n      If $A$ is not $K$, then $A$ is not a field and there is a nonzero maximal ideal $\\mathfrak m$. If $\\mathfrak m\'$ is a second maximal ideal, then choose $x, y \\in A$ with $x \\in \\mathfrak m$, $y \\not\\in \\mathfrak m$, $x \\not\\in \\mathfrak m\'$, and $y \\in \\mathfrak m\'$. Then neither $x/y \\in A$ nor $y/x \\in A$ contradicting the assumption of the lemma. Thus we see that $A$ is a local ring. Suppose that $A\'$ is a local ring contained in $K$ which dominates $A$. Let $x \\in A\'$. We have to show that $x \\in A$. If not, then $x^{-1} \\in A$, and of course $x^{-1} \\in \\mathfrak m_ A$. But then $x^{-1} \\in \\mathfrak m_{A\'}$ which contradicts $x \\in A\'$. \n      $\\square$\n    \n"," by
  intro S hS
  refine (LocalSubring.toSubring_injective (hS.1.antisymm fun x hx ‚Ü¶ (R.2 x).elim id fun h ‚Ü¶ ?_)).ge
  by_contra h'
  have hx0 : x ‚â† 0 := by rintro rfl; exact h' R.zero_mem
  have : IsUnit (Subring.inclusion hS.1 ‚ü®x‚Åª¬π, h‚ü©) :=
    isUnit_iff_exists_inv.mpr ‚ü®‚ü®x, hx‚ü©, Subtype.ext (inv_mul_cancel‚ÇÄ hx0)‚ü©
  obtain ‚ü®x', hx'‚ü© := isUnit_iff_exists_inv.mp (hS.2.1 _ this)
  have : x' = x := by simpa [Subtype.ext_iff, inv_mul_eq_iff_eq_mul‚ÇÄ hx0] using hx'
  exact h' (this ‚ñ∏ x'.2)
","lemma ValuationSubring.isMax_toLocalSubring (R : ValuationSubring K) :
    IsMax R.toLocalSubring ","Proof.\n      If $A$ is not $K$, then $A$ is not a field and there is a nonzero maximal ideal $\\mathfrak m$. If $\\mathfrak m\'$ is a second maximal ideal, then choose $x, y \\in A$ with $x \\in \\mathfrak m$, $y \\not\\in \\mathfrak m$, $x \\not\\in \\mathfrak m\'$, and $y \\in \\mathfrak m\'$. Then neither $x/y \\in A$ nor $y/x \\in A$ contradicting the assumption of the lemma. Thus we see that $A$ is a local ring. Suppose that $A\'$ is a local ring contained in $K$ which dominates $A$. Let $x \\in A\'$. We have to show that $x \\in A$. If not, then $x^{-1} \\in A$, and of course $x^{-1} \\in \\mathfrak m_ A$. But then $x^{-1} \\in \\mathfrak m_{A\'}$ which contradicts $x \\in A\'$. \n      $\\square$\n    \n","Proof.\n      If $A$ is not $K$, then $A$ is not a field and there is a nonzero maximal ideal $\\mathfrak m$. If $\\mathfrak m\'$ is a second maximal ideal, then choose $x, y \\in A$ with $x \\in \\mathfrak m$, $y \\not\\in \\mathfrak m$, $x \\not\\in \\mathfrak m\'$, and $y \\in \\mathfrak m\'$. Then neither $x/y \\in A$ nor $y/x \\in A$ contradicting the assumption of the lemma. Thus we see that $A$ is a local ring. Suppose that $A\'$ is a local ring contained in $K$ which dominates $A$. Let $x \\in A\'$. We have to show that $x \\in A$. If not, then $x^{-1} \\in A$, and of course $x^{-1} \\in \\mathfrak m_ A$. But then $x^{-1} \\in \\mathfrak m_{A\'}$ which contradicts $x \\in A\'$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the key second part of the informal argument: given a local subring S dominating A (captured by `intro S hS` and the dominance/local hypotheses in `hS`), it proves any `x ‚àà S` must lie in A by contradiction: assume `x ‚àâ A`, derive `x ‚â† 0`, use the ambient dichotomy (the `R.2 x` elimination) to get that `x‚Åª¬π ‚àà A`, then show the image of `x‚Åª¬π` in the subring is a unit, and use the dominance/local condition (`hS.2.1`) to force its inverse to lie in S, yielding `x ‚àà A`, contradicting the assumption. Structurally, it follows the same contradiction pattern as the informal proof (\""if x‚àâA then x^{-1}‚ààA; but then x^{-1} is in the maximal ideal, contradiction\""), though expressed via `IsUnit` and inverse-existence lemmas rather than explicit maximal ideals. However, the informal proof also includes an earlier argument establishing that A is local via uniqueness of maximal ideals and the x/y, y/x trick; that portion is not reflected in the provided Lean snippet, which focuses only on the domination/minimality step. Hence strong but not perfect alignment.""}"
357,00IB,"lemma LocalSubring.exists_valuationRing_of_isMax {R : LocalSubring K} (hR : IsMax R) :
    ‚àÉ R' : ValuationSubring K, R'.toLocalSubring = R := by
  suffices ‚àÄ x ‚àâ R.toSubring, x‚Åª¬π ‚àà R.toSubring from
    ‚ü®‚ü®R.toSubring, fun x ‚Ü¶ or_iff_not_imp_left.mpr (this x)‚ü©, rfl‚ü©
  refine fun x hx ‚Ü¶ mem_of_isMax_of_isIntegral hR ?_
  have hx0 : x ‚â† 0 := fun e ‚Ü¶ hx (e ‚ñ∏ zero_mem _)
  let := invertibleOfNonzero hx0
  let S := Algebra.adjoin R.toSubring {x}
  have : R.toSubring < S.toSubring := SetLike.lt_iff_le_and_exists.mpr
    ‚ü®fun r hr ‚Ü¶ algebraMap_mem S ‚ü®r, hr‚ü©, ‚ü®x, Algebra.self_mem_adjoin_singleton _ _, hx‚ü©‚ü©
  have ‚ü®p, hp, hpx‚ü© := Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top x _
    (maximalIdeal.isMaximal R.toSubring).ne_top
    (top_unique <| (map_maximalIdeal_eq_top_of_isMax hR this).ge.trans le_self_add)
  have H : IsUnit p.leadingCoeff := of_not_not fun h ‚Ü¶ by simpa using sub_mem h hp
  exact ‚ü®.C H.unit‚Åª¬π.1 * p, by simp [Polynomial.Monic], by simpa using .inr hpx‚ü©
",Formal Proof of Stacks Project Tag 00IB,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Valuation/LocalSubring.lean#L90-L104,Q27041,,10.50.4,lemma,3.0,"['00I8', '00AO', '0ELQ']","\n  Lemma 10.50.4. Let $A$ be a valuation ring with maximal ideal $\\mathfrak m$ and fraction field $K$. Let $x \\in K$. Then either $x \\in A$ or $x^{-1} \\in A$ or both. \n\n    \n      Proof.\n      Assume that $x$ is not in $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A$ is a valuation ring we see that there is no prime of $A\'$ lying over $\\mathfrak m$. Since $\\mathfrak m$ is maximal we see that $V(\\mathfrak m A\') = \\emptyset $. Then $\\mathfrak m A\' = A\'$ by Lemma 10.17.2. Hence we can write $1 = \\sum _{i = 0}^ d t_ i x^ i$ with $t_ i \\in \\mathfrak m$. This implies that $(1 - t_0) (x^{-1})^ d - \\sum t_ i (x^{-1})^{d - i} = 0$. In particular we see that $x^{-1}$ is integral over $A$, and hence $x^{-1} \\in A$ by Lemma 10.50.3. \n      $\\square$\n    \n",\n  Lemma 10.50.4. Let $A$ be a valuation ring with maximal ideal $\\mathfrak m$ and fraction field $K$. Let $x \\in K$. Then either $x \\in A$ or $x^{-1} \\in A$ or both. \n\n    \n,"Proof.\n      Assume that $x$ is not in $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A$ is a valuation ring we see that there is no prime of $A\'$ lying over $\\mathfrak m$. Since $\\mathfrak m$ is maximal we see that $V(\\mathfrak m A\') = \\emptyset $. Then $\\mathfrak m A\' = A\'$ by Lemma 10.17.2. Hence we can write $1 = \\sum _{i = 0}^ d t_ i x^ i$ with $t_ i \\in \\mathfrak m$. This implies that $(1 - t_0) (x^{-1})^ d - \\sum t_ i (x^{-1})^{d - i} = 0$. In particular we see that $x^{-1}$ is integral over $A$, and hence $x^{-1} \\in A$ by Lemma 10.50.3. \n      $\\square$\n    \n"," by
  suffices ‚àÄ x ‚àâ R.toSubring, x‚Åª¬π ‚àà R.toSubring from
    ‚ü®‚ü®R.toSubring, fun x ‚Ü¶ or_iff_not_imp_left.mpr (this x)‚ü©, rfl‚ü©
  refine fun x hx ‚Ü¶ mem_of_isMax_of_isIntegral hR ?_
  have hx0 : x ‚â† 0 := fun e ‚Ü¶ hx (e ‚ñ∏ zero_mem _)
  let := invertibleOfNonzero hx0
  let S := Algebra.adjoin R.toSubring {x}
  have : R.toSubring < S.toSubring := SetLike.lt_iff_le_and_exists.mpr
    ‚ü®fun r hr ‚Ü¶ algebraMap_mem S ‚ü®r, hr‚ü©, ‚ü®x, Algebra.self_mem_adjoin_singleton _ _, hx‚ü©‚ü©
  have ‚ü®p, hp, hpx‚ü© := Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top x _
    (maximalIdeal.isMaximal R.toSubring).ne_top
    (top_unique <| (map_maximalIdeal_eq_top_of_isMax hR this).ge.trans le_self_add)
  have H : IsUnit p.leadingCoeff := of_not_not fun h ‚Ü¶ by simpa using sub_mem h hp
  exact ‚ü®.C H.unit‚Åª¬π.1 * p, by simp [Polynomial.Monic], by simpa using .inr hpx‚ü©
","lemma LocalSubring.exists_valuationRing_of_isMax {R : LocalSubring K} (hR : IsMax R) :
    ‚àÉ R' : ValuationSubring K, R'.toLocalSubring = R ","Proof.\n      Assume that $x$ is not in $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A$ is a valuation ring we see that there is no prime of $A\'$ lying over $\\mathfrak m$. Since $\\mathfrak m$ is maximal we see that $V(\\mathfrak m A\') = \\emptyset $. Then $\\mathfrak m A\' = A\'$ by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Hence we can write $1 = \\sum _{i = 0}^ d t_ i x^ i$ with $t_ i \\in \\mathfrak m$. This implies that $(1 - t_0) (x^{-1})^ d - \\sum t_ i (x^{-1})^{d - i} = 0$. In particular we see that $x^{-1}$ is integral over $A$, and hence $x^{-1} \\in A$ by Lemma 10.50.3 [[\n  Lemma 10.50.3. Let $A$ be a valuation ring. Then $A$ is a normal domain. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Assume that $x$ is not in $A$. Let $A\'$ denote the subring of $K$ generated by $A$ and $x$. Since $A$ is a valuation ring we see that there is no prime of $A\'$ lying over $\\mathfrak m$. Since $\\mathfrak m$ is maximal we see that $V(\\mathfrak m A\') = \\emptyset $. Then $\\mathfrak m A\' = A\'$ by Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]. Hence we can write $1 = \\sum _{i = 0}^ d t_ i x^ i$ with $t_ i \\in \\mathfrak m$. This implies that $(1 - t_0) (x^{-1})^ d - \\sum t_ i (x^{-1})^{d - i} = 0$. In particular we see that $x^{-1}$ is integral over $A$, and hence $x^{-1} \\in A$ by Lemma 10.50.3 [[\n  Lemma 10.50.3. Let $A$ be a valuation ring. Then $A$ is a normal domain. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs aim to show the valuation-ring property via integrality: assuming x ‚àâ A (R.toSubring), they derive that x‚Åª¬π is integral over A and then conclude x‚Åª¬π ‚àà A using normality/integral-closure of a valuation ring (formal: `mem_of_isMax_of_isIntegral hR`; informal: Lemma 10.50.3). Structurally, the Lean proof mirrors the informal route: it adjoins x to A (`S := Algebra.adjoin ... {x}` corresponding to A‚Ä≤), shows A < A‚Ä≤, forces a contradiction/‚Äúunit ideal‚Äù condition via maximality (`map_maximalIdeal_eq_top_of_isMax ...` corresponding to mA‚Ä≤ = A‚Ä≤ / V(mA‚Ä≤)=‚àÖ), then extracts a polynomial relation giving integrality of x‚Åª¬π (`exists_aeval_invOf_eq_zero...` and constructing a monic polynomial by inverting the leading coefficient). The main mismatch is that the informal proof explicitly uses Spec/V(I) arguments and writes 1 = Œ£ t_i x^i with t_i ‚àà m, while the formal proof uses a packaged lemma producing a polynomial equation for invOf x and a leading-coefficient unit argument; these are equivalent in intent but not a close step-by-step match. No major extraneous goals appear, but the formal proof‚Äôs reliance on specialized lemmas obscures the geometric argument present informally.""}"
358,00IA,"lemma LocalSubring.exists_le_valuationSubring (A : LocalSubring K) :
    ‚àÉ B : ValuationSubring K, A ‚â§ B.toLocalSubring := by
  suffices ‚àÉ B, A ‚â§ B ‚àß IsMax B by
    obtain ‚ü®B, hB, hB'‚ü© := this
    obtain ‚ü®B, rfl‚ü© := B.exists_valuationRing_of_isMax hB'
    exact ‚ü®B, hB‚ü©
  refine zorn_le_nonempty_Ici‚ÇÄ _ ?_ _ le_rfl
  intro s hs H y hys
  have inst : Nonempty s := ‚ü®‚ü®y, hys‚ü©‚ü©
  have hdir := H.directed.mono_comp _ LocalSubring.toSubring_mono
  refine ‚ü®@LocalSubring.mk _ _ (‚®Ü i : s, i.1.toSubring) ‚ü®?_‚ü©, ?_‚ü©
  ¬∑ intro ‚ü®a, ha‚ü© ‚ü®b, hb‚ü© e
    obtain ‚ü®A, haA : a ‚àà A.1.toSubring‚ü© := (Subring.mem_iSup_of_directed hdir).mp ha
    obtain ‚ü®B, hbB : b ‚àà B.1.toSubring‚ü© := (Subring.mem_iSup_of_directed hdir).mp hb
    obtain ‚ü®C, hCA, hCB‚ü© := hdir A B
    refine (C.1.2.2 (a := ‚ü®a, hCA haA‚ü©) (b := ‚ü®b, hCB hbB‚ü©) (Subtype.ext congr(($e).1))).imp ?_ ?_
    ¬∑ exact fun h ‚Ü¶ h.map (Subring.inclusion (le_iSup (fun i : s ‚Ü¶ i.1.toSubring) C))
    ¬∑ exact fun h ‚Ü¶ h.map (Subring.inclusion (le_iSup (fun i : s ‚Ü¶ i.1.toSubring) C))
  ¬∑ intro A hA
    refine ‚ü®le_iSup (fun i : s ‚Ü¶ i.1.toSubring) ‚ü®A, hA‚ü©, ‚ü®?_‚ü©‚ü©
    rintro ‚ü®a, haA‚ü© h
    obtain ‚ü®‚ü®b, hb‚ü©, e‚ü© := isUnit_iff_exists_inv.mp h
    obtain ‚ü®B, hbB : b ‚àà B.1.toSubring‚ü© := (Subring.mem_iSup_of_directed hdir).mp hb
    obtain ‚ü®C, hCA, hCB‚ü© := H.directed ‚ü®A, hA‚ü© B
    apply hCA.2.1
    exact isUnit_iff_exists_inv.mpr ‚ü®‚ü®b, hCB.1 hbB‚ü©, Subtype.ext congr(($e).1)‚ü©
",Formal Proof of Stacks Project Tag 00IA,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Valuation/LocalSubring.lean#L113-L138,Q27041,,10.50.2,lemma,3.0,"['00I8', '00AO', '0ELQ']","\n  Lemma 10.50.2. Let $K$ be a field. Let $A \\subset K$ be a local subring. Then there exists a valuation ring with fraction field $K$ dominating $A$. \n\n    \n      Proof.\n      We consider the collection of local subrings of $K$ as a partially ordered set using the relation of domination. Suppose that $\\{ A_ i\\} _{i \\in I}$ is a totally ordered collection of local subrings of $K$. Then $B = \\bigcup A_ i$ is a local subring which dominates all of the $A_ i$. Hence by Zorn\'s Lemma, it suffices to show that if $A \\subset K$ is a local ring whose fraction field is not $K$, then there exists a local ring $B \\subset K$, $B \\not= A$ dominating $A$. \n    \n      Pick $t \\in K$ which is not in the fraction field of $A$. If $t$ is transcendental over $A$, then $A[t] \\subset K$ and hence $A[t]_{(t, \\mathfrak m)} \\subset K$ is a local ring distinct from $A$ dominating $A$. Suppose $t$ is algebraic over $A$. Then for some nonzero $a \\in A$ the element $at$ is integral over $A$. In this case the subring $A\' \\subset K$ generated by $A$ and $ta$ is finite over $A$. By Lemma 10.36.17 there exists a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. If $A = A\'_{\\mathfrak m\'}$, then $t$ is in the fraction field of $A$ which we assumed not to be the case. Thus $A \\not= A\'_{\\mathfrak m\'}$ as desired. \n      $\\square$\n    \n",\n  Lemma 10.50.2. Let $K$ be a field. Let $A \\subset K$ be a local subring. Then there exists a valuation ring with fraction field $K$ dominating $A$. \n\n    \n,"Proof.\n      We consider the collection of local subrings of $K$ as a partially ordered set using the relation of domination. Suppose that $\\{ A_ i\\} _{i \\in I}$ is a totally ordered collection of local subrings of $K$. Then $B = \\bigcup A_ i$ is a local subring which dominates all of the $A_ i$. Hence by Zorn\'s Lemma, it suffices to show that if $A \\subset K$ is a local ring whose fraction field is not $K$, then there exists a local ring $B \\subset K$, $B \\not= A$ dominating $A$. \n    \n      Pick $t \\in K$ which is not in the fraction field of $A$. If $t$ is transcendental over $A$, then $A[t] \\subset K$ and hence $A[t]_{(t, \\mathfrak m)} \\subset K$ is a local ring distinct from $A$ dominating $A$. Suppose $t$ is algebraic over $A$. Then for some nonzero $a \\in A$ the element $at$ is integral over $A$. In this case the subring $A\' \\subset K$ generated by $A$ and $ta$ is finite over $A$. By Lemma 10.36.17 there exists a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. If $A = A\'_{\\mathfrak m\'}$, then $t$ is in the fraction field of $A$ which we assumed not to be the case. Thus $A \\not= A\'_{\\mathfrak m\'}$ as desired. \n      $\\square$\n    \n"," by
  suffices ‚àÉ B, A ‚â§ B ‚àß IsMax B by
    obtain ‚ü®B, hB, hB'‚ü© := this
    obtain ‚ü®B, rfl‚ü© := B.exists_valuationRing_of_isMax hB'
    exact ‚ü®B, hB‚ü©
  refine zorn_le_nonempty_Ici‚ÇÄ _ ?_ _ le_rfl
  intro s hs H y hys
  have inst : Nonempty s := ‚ü®‚ü®y, hys‚ü©‚ü©
  have hdir := H.directed.mono_comp _ LocalSubring.toSubring_mono
  refine ‚ü®@LocalSubring.mk _ _ (‚®Ü i : s, i.1.toSubring) ‚ü®?_‚ü©, ?_‚ü©
  ¬∑ intro ‚ü®a, ha‚ü© ‚ü®b, hb‚ü© e
    obtain ‚ü®A, haA : a ‚àà A.1.toSubring‚ü© := (Subring.mem_iSup_of_directed hdir).mp ha
    obtain ‚ü®B, hbB : b ‚àà B.1.toSubring‚ü© := (Subring.mem_iSup_of_directed hdir).mp hb
    obtain ‚ü®C, hCA, hCB‚ü© := hdir A B
    refine (C.1.2.2 (a := ‚ü®a, hCA haA‚ü©) (b := ‚ü®b, hCB hbB‚ü©) (Subtype.ext congr(($e).1))).imp ?_ ?_
    ¬∑ exact fun h ‚Ü¶ h.map (Subring.inclusion (le_iSup (fun i : s ‚Ü¶ i.1.toSubring) C))
    ¬∑ exact fun h ‚Ü¶ h.map (Subring.inclusion (le_iSup (fun i : s ‚Ü¶ i.1.toSubring) C))
  ¬∑ intro A hA
    refine ‚ü®le_iSup (fun i : s ‚Ü¶ i.1.toSubring) ‚ü®A, hA‚ü©, ‚ü®?_‚ü©‚ü©
    rintro ‚ü®a, haA‚ü© h
    obtain ‚ü®‚ü®b, hb‚ü©, e‚ü© := isUnit_iff_exists_inv.mp h
    obtain ‚ü®B, hbB : b ‚àà B.1.toSubring‚ü© := (Subring.mem_iSup_of_directed hdir).mp hb
    obtain ‚ü®C, hCA, hCB‚ü© := H.directed ‚ü®A, hA‚ü© B
    apply hCA.2.1
    exact isUnit_iff_exists_inv.mpr ‚ü®‚ü®b, hCB.1 hbB‚ü©, Subtype.ext congr(($e).1)‚ü©
","lemma LocalSubring.exists_le_valuationSubring (A : LocalSubring K) :
    ‚àÉ B : ValuationSubring K, A ‚â§ B.toLocalSubring ","Proof.\n      We consider the collection of local subrings of $K$ as a partially ordered set using the relation of domination. Suppose that $\\{ A_ i\\} _{i \\in I}$ is a totally ordered collection of local subrings of $K$. Then $B = \\bigcup A_ i$ is a local subring which dominates all of the $A_ i$. Hence by Zorn\'s Lemma, it suffices to show that if $A \\subset K$ is a local ring whose fraction field is not $K$, then there exists a local ring $B \\subset K$, $B \\not= A$ dominating $A$. \n    \n      Pick $t \\in K$ which is not in the fraction field of $A$. If $t$ is transcendental over $A$, then $A[t] \\subset K$ and hence $A[t]_{(t, \\mathfrak m)} \\subset K$ is a local ring distinct from $A$ dominating $A$. Suppose $t$ is algebraic over $A$. Then for some nonzero $a \\in A$ the element $at$ is integral over $A$. In this case the subring $A\' \\subset K$ generated by $A$ and $ta$ is finite over $A$. By Lemma 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] there exists a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. If $A = A\'_{\\mathfrak m\'}$, then $t$ is in the fraction field of $A$ which we assumed not to be the case. Thus $A \\not= A\'_{\\mathfrak m\'}$ as desired. \n      $\\square$\n    \n","Proof.\n      We consider the collection of local subrings of $K$ as a partially ordered set using the relation of domination. Suppose that $\\{ A_ i\\} _{i \\in I}$ is a totally ordered collection of local subrings of $K$. Then $B = \\bigcup A_ i$ is a local subring which dominates all of the $A_ i$. Hence by Zorn\'s Lemma, it suffices to show that if $A \\subset K$ is a local ring whose fraction field is not $K$, then there exists a local ring $B \\subset K$, $B \\not= A$ dominating $A$. \n    \n      Pick $t \\in K$ which is not in the fraction field of $A$. If $t$ is transcendental over $A$, then $A[t] \\subset K$ and hence $A[t]_{(t, \\mathfrak m)} \\subset K$ is a local ring distinct from $A$ dominating $A$. Suppose $t$ is algebraic over $A$. Then for some nonzero $a \\in A$ the element $at$ is integral over $A$. In this case the subring $A\' \\subset K$ generated by $A$ and $ta$ is finite over $A$. By Lemma 10.36.17 [[\n  Lemma 10.36.17. Suppose that $R \\to S$ is an integral ring extension with $R \\subset S$. Then $\\varphi : \\mathop{\\mathrm{Spec}}(S) \\to \\mathop{\\mathrm{Spec}}(R)$ is surjective. \n\n    \n]] there exists a prime ideal $\\mathfrak m\' \\subset A\'$ lying over $\\mathfrak m$. Then $A\'_{\\mathfrak m\'}$ dominates $A$. If $A = A\'_{\\mathfrak m\'}$, then $t$ is in the fraction field of $A$ which we assumed not to be the case. Thus $A \\not= A\'_{\\mathfrak m\'}$ as desired. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs use Zorn‚Äôs lemma on a poset of local subrings (ordered by inclusion/domination) to obtain a maximal object, and the Lean proof then converts an `IsMax` local subring into a valuation ring via `exists_valuationRing_of_isMax`, matching the overall goal of producing a valuation ring containing/dominating A. Structurally, however, the Lean code only establishes the Zorn chain-upper-bound condition by taking a directed supremum (an iSup/union of a chain) and proving it is a local subring dominating the chain; it does not implement the informal proof‚Äôs key second step: showing that any non-maximal local ring can be strictly enlarged by adjoining an element t (transcendental case via localization of A[t], algebraic case via integral extension and lying-over). Thus the formal proof aligns with the Zorn/chain-union part of the informal argument but omits the transcendental/algebraic enlargement construction and the lying-over lemma, replacing it with an abstract maximality-to-valuation-ring lemma. This makes the semantic endpoint similar but the internal argument substantially different/incomplete relative to the informal proof.""}"
359,090P,"    {x : K} {R : Subring K} (hxR : x ‚àâ R) [IsIntegrallyClosedIn R K] :
    ‚àÉ V : ValuationSubring K, R ‚â§ V.toSubring ‚àß x ‚àâ V := by
  obtain rfl | hx0 := eq_or_ne x 0
  ¬∑ exact (hxR R.zero_mem).elim
  let := invertibleOfNonzero hx0
  let B := Algebra.adjoin R {x‚Åª¬π}
  let xinv : B.toSubring := ‚ü®x‚Åª¬π, Algebra.subset_adjoin rfl‚ü©
  have : Ideal.span {xinv} ‚â† ‚ä§ := fun eq ‚Ü¶ hxR <|
    have ‚ü®p, hp, hpx‚ü© := Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top _
      (‚ä• : Ideal R) bot_ne_top (top_unique <| eq.ge.trans le_add_self)
    (Subring.isIntegrallyClosedIn_iff).mp ‚Äπ_‚Ä∫ ‚ü®p, by simpa [Monic, sub_eq_zero] using hp, hpx‚ü©
  have ‚ü®V, hV‚ü© := Ideal.image_subset_nonunits_valuationSubring _ this
  exact ‚ü®V, fun r hr ‚Ü¶ hV.1 (B.algebraMap_mem ‚ü®r, hr‚ü©),
    (V.inv_mem_nonunits_iff.mp <| hV.2 ‚ü®_, Ideal.subset_span rfl, rfl‚ü©).resolve_left hx0‚ü©
",Formal Proof of Stacks Project Tag 090P,part (1)] lemma Subring.exists_le_valuationSubring_of_isIntegrallyClosedI,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Valuation/LocalSubring.lean#L154-L167,Q27041,,10.50.11,lemma,3.0,"['00I8', '00AO', '0ELQ']","\n  Lemma 10.50.11. Let $A$ be a normal domain with fraction field $K$. \n  \n  \nFor every $x \\in K$, $x \\not\\in A$ there exists a valuation ring $A \\subset V \\subset K$ with fraction field $K$ such that $x \\not\\in V$. \n\n\nIf $A$ is local, we can moreover choose $V$ which dominates $A$. \n\n\n\n   In other words, $A$ is the intersection of all valuation rings in $K$ containing $A$ and if $A$ is local, then $A$ is the intersection of all valuation rings in $K$ dominating $A$. \n\n    \n      Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n","\n  Lemma 10.50.11. Let $A$ be a normal domain with fraction field $K$. \n  \n  \nFor every $x \\in K$, $x \\not\\in A$ there exists a valuation ring $A \\subset V \\subset K$ with fraction field $K$ such that $x \\not\\in V$. \n\n\nIf $A$ is local, we can moreover choose $V$ which dominates $A$. \n\n\n\n   In other words, $A$ is the intersection of all valuation rings in $K$ containing $A$ and if $A$ is local, then $A$ is the intersection of all valuation rings in $K$ dominating $A$. \n\n    \n","Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n"," by
  obtain rfl | hx0 := eq_or_ne x 0
  ¬∑ exact (hxR R.zero_mem).elim
  let := invertibleOfNonzero hx0
  let B := Algebra.adjoin R {x‚Åª¬π}
  let xinv : B.toSubring := ‚ü®x‚Åª¬π, Algebra.subset_adjoin rfl‚ü©
  have : Ideal.span {xinv} ‚â† ‚ä§ := fun eq ‚Ü¶ hxR <|
    have ‚ü®p, hp, hpx‚ü© := Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top _
      (‚ä• : Ideal R) bot_ne_top (top_unique <| eq.ge.trans le_add_self)
    (Subring.isIntegrallyClosedIn_iff).mp ‚Äπ_‚Ä∫ ‚ü®p, by simpa [Monic, sub_eq_zero] using hp, hpx‚ü©
  have ‚ü®V, hV‚ü© := Ideal.image_subset_nonunits_valuationSubring _ this
  exact ‚ü®V, fun r hr ‚Ü¶ hV.1 (B.algebraMap_mem ‚ü®r, hr‚ü©),
    (V.inv_mem_nonunits_iff.mp <| hV.2 ‚ü®_, Ideal.subset_span rfl, rfl‚ü©).resolve_left hx0‚ü©
","    {x : K} {R : Subring K} (hxR : x ‚àâ R) [IsIntegrallyClosedIn R K] :
    ‚àÉ V : ValuationSubring K, R ‚â§ V.toSubring ‚àß x ‚àâ V ","Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2 [[\n  Lemma 10.50.2. Let $K$ be a field. Let $A \\subset K$ be a local subring. Then there exists a valuation ring with fraction field $K$ dominating $A$. \n\n    \n]]). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n","Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2 [[\n  Lemma 10.50.2. Let $K$ be a field. Let $A \\subset K$ be a local subring. Then there exists a valuation ring with fraction field $K$ dominating $A$. \n\n    \n]]). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: part (1)] lemma Subring.exists_le_valuationSubring_of_isIntegrallyClosedI","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the main informal argument: it splits off the trivial case x = 0, then for x ‚â† 0 forms B = Algebra.adjoin R {x‚Åª¬π} (corresponding to A[x^{-1}]), shows that the ideal generated by x‚Åª¬π is not the unit ideal (so x‚Åª¬π is a nonunit), and then uses a lemma producing a valuation subring V with the required containment properties, concluding x ‚àâ V because x‚Åª¬π lies in the maximal ideal/nonunits. Structurally, the Lean proof follows the same high-level steps (construct B, prove span{x‚Åª¬π} ‚â† ‚ä§ via an integrality/normality contradiction, then obtain V), but it packages the ‚Äòx ‚àâ B implies integrality contradiction‚Äô part into the lemma `Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top` and the normality step via `Subring.isIntegrallyClosedIn_iff`, rather than explicitly manipulating the polynomial as in the informal proof. The informal proof‚Äôs additional local-ring refinement (involving m_A and the ideal x‚Åª¬πB + m_AB to ensure domination of A when A is local) is not reflected in the provided Lean snippet, which only shows the nonunit/prime/valuation-subring existence route. Hence strong semantic alignment on part (1) but not a perfect structural match to all informal details.""}"
360,090P,"    {x : K} {R : LocalSubring K} (hxR : x ‚àâ R.toSubring) [IsIntegrallyClosedIn R.toSubring K] :
    ‚àÉ V : ValuationSubring K, R ‚â§ V.toLocalSubring ‚àß x ‚àâ V := by
  obtain rfl | hx0 := eq_or_ne x 0
  ¬∑ exact (hxR R.toSubring.zero_mem).elim
  let := invertibleOfNonzero hx0
  let B := Algebra.adjoin R.toSubring {x‚Åª¬π}
  let xinv : B.toSubring := ‚ü®x‚Åª¬π, Algebra.subset_adjoin rfl‚ü©
  have : (maximalIdeal R.toSubring).map (algebraMap _ B) + .span {xinv} ‚â† ‚ä§ := fun eq ‚Ü¶ hxR <|
    have ‚ü®p, hp, hpx‚ü© := Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top _ _
      (maximalIdeal.isMaximal R.toSubring).ne_top eq
    have H : IsUnit p.leadingCoeff := of_not_not fun h ‚Ü¶ by simpa using sub_mem h hp
    (Subring.isIntegrallyClosedIn_iff).mp ‚Äπ_‚Ä∫
      ‚ü®.C H.unit‚Åª¬π.1 * p, by simp [Polynomial.Monic], by simpa using .inr hpx‚ü©
  have ‚ü®V, hV‚ü© := Ideal.image_subset_nonunits_valuationSubring (A := B.toSubring) _ this
  refine ‚ü®V, ‚ü®fun r hr ‚Ü¶ hV.1 (B.algebraMap_mem ‚ü®r, hr‚ü©),
    ((local_hom_TFAE _).out 3 0).mp fun r hr ‚Ü¶ ?_‚ü©, (V.inv_mem_nonunits_iff.mp <|
      hV.2 ‚ü®_, le_add_self (Œ± := Ideal B) (Ideal.subset_span rfl), rfl‚ü©).resolve_left hx0‚ü©
  rw [‚Üê V.image_maximalIdeal] at hV
  obtain ‚ü®‚ü®r, _‚ü©, hr, rfl‚ü© := hV.2 ‚ü®_, le_self_add (Œ± := Ideal B) (Ideal.mem_map_of_mem _ hr), rfl‚ü©
  exact hr
",Formal Proof of Stacks Project Tag 090P,part (2)] lemma LocalSubring.exists_le_valuationSubring_of_isIntegrallyClosedI,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/RingTheory/Valuation/LocalSubring.lean#L171-L190,Q27041,,10.50.11,lemma,3.0,"['00I8', '00AO', '0ELQ']","\n  Lemma 10.50.11. Let $A$ be a normal domain with fraction field $K$. \n  \n  \nFor every $x \\in K$, $x \\not\\in A$ there exists a valuation ring $A \\subset V \\subset K$ with fraction field $K$ such that $x \\not\\in V$. \n\n\nIf $A$ is local, we can moreover choose $V$ which dominates $A$. \n\n\n\n   In other words, $A$ is the intersection of all valuation rings in $K$ containing $A$ and if $A$ is local, then $A$ is the intersection of all valuation rings in $K$ dominating $A$. \n\n    \n      Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n","\n  Lemma 10.50.11. Let $A$ be a normal domain with fraction field $K$. \n  \n  \nFor every $x \\in K$, $x \\not\\in A$ there exists a valuation ring $A \\subset V \\subset K$ with fraction field $K$ such that $x \\not\\in V$. \n\n\nIf $A$ is local, we can moreover choose $V$ which dominates $A$. \n\n\n\n   In other words, $A$ is the intersection of all valuation rings in $K$ containing $A$ and if $A$ is local, then $A$ is the intersection of all valuation rings in $K$ dominating $A$. \n\n    \n","Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n"," by
  obtain rfl | hx0 := eq_or_ne x 0
  ¬∑ exact (hxR R.toSubring.zero_mem).elim
  let := invertibleOfNonzero hx0
  let B := Algebra.adjoin R.toSubring {x‚Åª¬π}
  let xinv : B.toSubring := ‚ü®x‚Åª¬π, Algebra.subset_adjoin rfl‚ü©
  have : (maximalIdeal R.toSubring).map (algebraMap _ B) + .span {xinv} ‚â† ‚ä§ := fun eq ‚Ü¶ hxR <|
    have ‚ü®p, hp, hpx‚ü© := Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top _ _
      (maximalIdeal.isMaximal R.toSubring).ne_top eq
    have H : IsUnit p.leadingCoeff := of_not_not fun h ‚Ü¶ by simpa using sub_mem h hp
    (Subring.isIntegrallyClosedIn_iff).mp ‚Äπ_‚Ä∫
      ‚ü®.C H.unit‚Åª¬π.1 * p, by simp [Polynomial.Monic], by simpa using .inr hpx‚ü©
  have ‚ü®V, hV‚ü© := Ideal.image_subset_nonunits_valuationSubring (A := B.toSubring) _ this
  refine ‚ü®V, ‚ü®fun r hr ‚Ü¶ hV.1 (B.algebraMap_mem ‚ü®r, hr‚ü©),
    ((local_hom_TFAE _).out 3 0).mp fun r hr ‚Ü¶ ?_‚ü©, (V.inv_mem_nonunits_iff.mp <|
      hV.2 ‚ü®_, le_add_self (Œ± := Ideal B) (Ideal.subset_span rfl), rfl‚ü©).resolve_left hx0‚ü©
  rw [‚Üê V.image_maximalIdeal] at hV
  obtain ‚ü®‚ü®r, _‚ü©, hr, rfl‚ü© := hV.2 ‚ü®_, le_self_add (Œ± := Ideal B) (Ideal.mem_map_of_mem _ hr), rfl‚ü©
  exact hr
","    {x : K} {R : LocalSubring K} (hxR : x ‚àâ R.toSubring) [IsIntegrallyClosedIn R.toSubring K] :
    ‚àÉ V : ValuationSubring K, R ‚â§ V.toLocalSubring ‚àß x ‚àâ V ","Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2 [[\n  Lemma 10.50.2. Let $K$ be a field. Let $A \\subset K$ be a local subring. Then there exists a valuation ring with fraction field $K$ dominating $A$. \n\n    \n]]). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n","Proof.\n      Suppose $x \\in K$, $x \\not\\in A$. Consider $B = A[x^{-1}]$. Then $x \\not\\in B$. Namely, if $x = a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d}$ then $x^{d + 1} - a_0x^ d - \\ldots - a_ d = 0$ and $x$ is integral over $A$ in contradiction with the fact that $A$ is normal. Thus $x^{-1}$ is not a unit in $B$. Thus $V(x^{-1}) \\subset \\mathop{\\mathrm{Spec}}(B)$ is not empty (Lemma 10.17.2 [[\n  Lemma 10.17.2. Let $R$ be a ring. \n  \n  \nThe spectrum of a ring $R$ is empty if and only if $R$ is the zero ring. \n\n\nEvery nonzero ring has a maximal ideal. \n\n\nEvery nonzero ring has a minimal prime ideal. \n\n\nGiven an ideal $I \\subset R$ and a prime ideal $I \\subset \\mathfrak p$ there exists a prime $I \\subset \\mathfrak q \\subset \\mathfrak p$ such that $\\mathfrak q$ is minimal over $I$. \n\n\nIf $T \\subset R$, and if $(T)$ is the ideal generated by $T$ in $R$, then $V((T)) = V(T)$. \n\n\nIf $I$ is an ideal and $\\sqrt{I}$ is its radical, see basic notion (27), then $V(I) = V(\\sqrt{I})$. \n\n\nGiven an ideal $I$ of $R$ we have $\\sqrt{I} = \\bigcap _{I \\subset \\mathfrak p} \\mathfrak p$. \n\n\nIf $I$ is an ideal then $V(I) = \\emptyset $ if and only if $I$ is the unit ideal. \n\n\nIf $I$, $J$ are ideals of $R$ then $V(I) \\cup V(J) = V(I \\cap J)$. \n\n\nIf $(I_ a)_{a\\in A}$ is a set of ideals of $R$ then $\\bigcap _{a\\in A} V(I_ a) = V(\\bigcup _{a\\in A} I_ a)$. \n\n\nIf $f \\in R$, then $D(f) \\amalg V(f) = \\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ then $D(f) = \\emptyset $ if and only if $f$ is nilpotent. \n\n\nIf $f = u f\'$ for some unit $u \\in R$, then $D(f) = D(f\')$. \n\n\nIf $I \\subset R$ is an ideal, and $\\mathfrak p$ is a prime of $R$ with $\\mathfrak p \\not\\in V(I)$, then there exists an $f \\in R$ such that $\\mathfrak p \\in D(f)$, and $D(f) \\cap V(I) = \\emptyset $. \n\n\nIf $f, g \\in R$, then $D(fg) = D(f) \\cap D(g)$. \n\n\nIf $f_ i \\in R$ for $i \\in I$, then $\\bigcup _{i\\in I} D(f_ i)$ is the complement of $V(\\{ f_ i \\} _{i\\in I})$ in $\\mathop{\\mathrm{Spec}}(R)$. \n\n\nIf $f \\in R$ and $D(f) = \\mathop{\\mathrm{Spec}}(R)$, then $f$ is a unit. \n\n\n\n\n    \n]]), and we can choose a prime $\\mathfrak p \\subset B$ with $x^{-1} \\in \\mathfrak p$. Choose a valuation ring $V \\subset K$ dominating $B_\\mathfrak p$ (Lemma 10.50.2 [[\n  Lemma 10.50.2. Let $K$ be a field. Let $A \\subset K$ be a local subring. Then there exists a valuation ring with fraction field $K$ dominating $A$. \n\n    \n]]). Then $x \\not\\in V$ as $x^{-1} \\in \\mathfrak m_ V$. \n    \n      If $A$ is local, then we claim that $x^{-1} B + \\mathfrak m_ A B \\not= B$. Namely, if $1 = (a_0 + a_1x^{-1} + \\ldots + a_ d x^{-d})x^{-1} + a\'_0 + \\ldots + a\'_ d x^{-d}$ with $a_ i \\in A$ and $a\'_ i \\in \\mathfrak m_ A$, then we\'d get \n    \n      \n  \\[  (1 - a\'_0) x^{d + 1} - (a_0 + a\'_1) x^ d - \\ldots - a_ d = 0  \\]\n\n    \n       Since $a\'_0 \\in \\mathfrak m_ A$ we see that $1 - a\'_0$ is a unit in $A$ and we conclude that $x$ would be integral over $A$, a contradiction as before. Then choose the prime $\\mathfrak p \\supset x^{-1} B + \\mathfrak m_ A B$ we find $V$ dominating $A$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: part (2)] lemma LocalSubring.exists_le_valuationSubring_of_isIntegrallyClosedI","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs follow the same strategy: split off the trivial case x = 0, then form B = A[x‚Åª¬π] (Lean: `Algebra.adjoin R.toSubring {x‚Åª¬π}`), show that a certain ideal involving the maximal ideal of A and the element x‚Åª¬π is not the unit ideal (informal: show `x‚Åª¬πB + m_AB ‚â† B`; Lean: `...map ... + span {xinv} ‚â† ‚ä§`), and deduce existence of a prime/valuation ring with x‚Åª¬π in the maximal ideal so that x ‚àâ V. The integrality contradiction is also mirrored: the informal argument derives a monic polynomial relation for x from an expression in B; Lean uses `Algebra.exists_aeval_invOf_eq_zero_of_idealMap_adjoin_sup_span_eq_top` to extract a polynomial relation and then applies integrally-closedness (`Subring.isIntegrallyClosedIn_iff`) to contradict `hxR`.\n\nStructurally, the Lean proof is more abstract and compressed: it packages the ‚Äúif the ideal sum is ‚ä§ then x is integral‚Äù step via a lemma about `aeval` and `invOf`, and it obtains the valuation subring via `Ideal.image_subset_nonunits_valuationSubring`, rather than explicitly choosing a prime in V(x‚Åª¬π) and then a valuation ring dominating the localization. Still, the key intermediate objects correspond (B, the ideal with x‚Åª¬π and m_A, nonunit-ness of x‚Åª¬π, existence of valuation ring with x‚Åª¬π in its maximal ideal).\n\nCompleteness-wise, the Lean proof covers the main logical content of the informal proof, including the local/maximal-ideal condition and the final conclusion x ‚àâ V. What is not explicitly mirrored is the informal detour through Spec nonemptiness and choosing a prime containing x‚Åª¬π; Lean bypasses this with a direct valuation-subring existence lemma. There is no major extraneous content beyond these library-level abstractions.""}"
362,005B,"theorem IsSpectralMap.comp {f : Œ≤ ‚Üí Œ≥} {g : Œ± ‚Üí Œ≤} (hf : IsSpectralMap f) (hg : IsSpectralMap g) :
    IsSpectralMap (f ‚àò g) :=
  ‚ü®hf.continuous.comp hg.continuous, fun _s hs‚ÇÄ hs‚ÇÅ =>
    ((hs‚ÇÅ.preimage_of_isOpen hf hs‚ÇÄ).preimage_of_isOpen hg) (hs‚ÇÄ.preimage hf.continuous)‚ü©
",Formal Proof of Stacks Project Tag 005B,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Spectral/Hom.lean#L59-L62,Q27041,,5.12.2,lemma,3.0,"['0059', '004C', '0ELQ']",\n  Lemma 5.12.2. A composition of quasi-compact maps is quasi-compact. \n\n    \n      Proof.\n      This is immediate from the definition. \n      $\\square$\n    \n,\n  Lemma 5.12.2. A composition of quasi-compact maps is quasi-compact. \n\n    \n,Proof.\n      This is immediate from the definition. \n      $\\square$\n    \n,"
  ‚ü®hf.continuous.comp hg.continuous, fun _s hs‚ÇÄ hs‚ÇÅ =>
    ((hs‚ÇÅ.preimage_of_isOpen hf hs‚ÇÄ).preimage_of_isOpen hg) (hs‚ÇÄ.preimage hf.continuous)‚ü©
","theorem IsSpectralMap.comp {f : Œ≤ ‚Üí Œ≥} {g : Œ± ‚Üí Œ≤} (hf : IsSpectralMap f) (hg : IsSpectralMap g) :
    IsSpectralMap (f ‚àò g) ",Proof.\n      This is immediate from the definition. \n      $\\square$\n    \n,Proof.\n      This is immediate from the definition. \n      $\\square$\n    \n,"{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof constructs the required object by pairing (1) continuity of the composition via `hf.continuous.comp hg.continuous` and (2) the corresponding preimage/isOpen condition for the composed map, which matches the informal claim that the result is ‚Äúimmediate from the definition.‚Äù Structurally, the formal proof explicitly unfolds the definition into its two components and proves each, whereas the informal proof gives no internal structure beyond asserting immediacy. There is no apparent extraneous content, but the formal proof is more detailed than the informal one, so the alignment is strong but not perfectly mirrored in structure.""}"
363,005J,"lemma IsRetrocompact.preimage_of_isOpenEmbedding {s : Set Y} (hf : IsOpenEmbedding f)
    (hs : IsRetrocompact s) : IsRetrocompact (f ‚Åª¬π' s) := by
  rintro U hUcomp hUopen
  rw [hf.isCompact_iff, image_preimage_inter]
  exact hs (hUcomp.image hf.continuous) <| hf.isOpenMap _ hUopen
",Formal Proof of Stacks Project Tag 005J,Extracted from the proof,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L152-L156,Q27041,,5.15.4,lemma,3.0,"['04ZC', '004C', '0ELQ']",\n  Lemma 5.15.4. Let $U \\subset X$ be open. For a constructible set $E \\subset X$ the intersection $E \\cap U$ is constructible in $U$. \n\n    \n      Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n,\n  Lemma 5.15.4. Let $U \\subset X$ be open. For a constructible set $E \\subset X$ the intersection $E \\cap U$ is constructible in $U$. \n\n    \n,Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n," by
  rintro U hUcomp hUopen
  rw [hf.isCompact_iff, image_preimage_inter]
  exact hs (hUcomp.image hf.continuous) <| hf.isOpenMap _ hUopen
","lemma IsRetrocompact.preimage_of_isOpenEmbedding {s : Set Y} (hf : IsOpenEmbedding f)
    (hs : IsRetrocompact s) : IsRetrocompact (f ‚Åª¬π' s) ","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Extracted from the proof","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues a locality property of retrocompact opens: given V retrocompact open in X and an open quasi-compact W ‚äÜ U, conclude V ‚à© U ‚à© W is quasi-compact, hence V ‚à© U is retrocompact in U. The formal Lean proof instead rewrites using `hf.isCompact_iff` and `image_preimage_inter`, and then applies a hypothesis `hs` to an image of a compact set under a continuous map together with `hf.isOpenMap`. This is about compactness of images/preimages under an open/continuous map, not about retrocompactness via testing against open quasi-compact subsets. Structurally, the informal proof is a direct set-theoretic argument with an arbitrary open quasi-compact W, while the Lean proof is a short chain of rewriting and applying a lemma about compactness and open maps; it does not introduce W or mirror the retrocompactness criterion. There is partial thematic overlap (intersections, compactness/quasi-compactness, openness), but the main logical content and structure do not match.""}"
364,09YE,"lemma IsRetrocompact.preimage_of_isClosedEmbedding {s : Set Y} (hf : IsClosedEmbedding f)
    (hf' : IsCompact (range f)·∂ú) (hs : IsRetrocompact s) : IsRetrocompact (f ‚Åª¬π' s) := by
  rintro U hUcomp hUopen
  have hfUopen : IsOpen (f '' U ‚à™ (range f)·∂ú) := by
    simpa [‚Üê range_diff_image hf.injective, sdiff_eq, compl_inter, union_comm]
      using (hf.isClosedMap _ hUopen.isClosed_compl).isOpen_compl
  have hfUcomp : IsCompact (f '' U ‚à™ (range f)·∂ú) := (hUcomp.image hf.continuous).union hf'
  simpa [inter_union_distrib_left, inter_left_comm, inter_eq_right.2 (image_subset_range ..),
    hf.isCompact_iff, image_preimage_inter] using (hs hfUcomp hfUopen).inter_left hf.isClosed_range
",Formal Proof of Stacks Project Tag 09YE,Extracted from the proof,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L159-L167,Q27041,,5.15.7,lemma,3.0,"['04ZC', '004C', '0ELQ']","\n  Lemma 5.15.7. Let $X$ be a topological space. Let $Z \\subset X$ be a closed subset such that $X \\setminus Z$ is quasi-compact. Then for a constructible set $E \\subset X$ the intersection $E \\cap Z$ is constructible in $Z$. \n\n    \n      Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3. \n      $\\square$\n    \n",\n  Lemma 5.15.7. Let $X$ be a topological space. Let $Z \\subset X$ be a closed subset such that $X \\setminus Z$ is quasi-compact. Then for a constructible set $E \\subset X$ the intersection $E \\cap Z$ is constructible in $Z$. \n\n    \n,"Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3. \n      $\\square$\n    \n"," by
  rintro U hUcomp hUopen
  have hfUopen : IsOpen (f '' U ‚à™ (range f)·∂ú) := by
    simpa [‚Üê range_diff_image hf.injective, sdiff_eq, compl_inter, union_comm]
      using (hf.isClosedMap _ hUopen.isClosed_compl).isOpen_compl
  have hfUcomp : IsCompact (f '' U ‚à™ (range f)·∂ú) := (hUcomp.image hf.continuous).union hf'
  simpa [inter_union_distrib_left, inter_left_comm, inter_eq_right.2 (image_subset_range ..),
    hf.isCompact_iff, image_preimage_inter] using (hs hfUcomp hfUopen).inter_left hf.isClosed_range
","lemma IsRetrocompact.preimage_of_isClosedEmbedding {s : Set Y} (hf : IsClosedEmbedding f)
    (hf' : IsCompact (range f)·∂ú) (hs : IsRetrocompact s) : IsRetrocompact (f ‚Åª¬π' s) ","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]]. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Extracted from the proof","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof is about retrocompactness/quasi-compactness of intersections with an open quasi-compact subset after enlarging it by the complement of a subspace (W' = W ‚à™ (X \\ Z)), and then using that a closed subset of a quasi-compact space is quasi-compact. The Lean proof instead works with a continuous injective map f, constructs the set f '' U ‚à™ (range f)·∂ú, proves it is open and compact using a closed-map property and compactness of images, and then applies a hypothesis hs to deduce compactness of an intersection involving preimages/images and the closed range. Structurally, the informal argument is an intersection/extension argument inside a space and a subspace, while the Lean argument is an image/range-complement trick typical for embeddings and compactness transfer. There is some thematic overlap (adding complement of range/subspace to preserve openness/compactness and then intersecting back), but the objects and key lemmas (closed subset of quasi-compact vs. closed map/range_diff_image/image_preimage_inter) do not correspond closely, and the Lean proof contains substantial machinery not reflected in the informal proof.""}"
365,005I,"lemma IsConstructible.preimage {s : Set Y} (hfcont : Continuous f)
    (hf : ‚àÄ s, IsOpen s ‚Üí IsRetrocompact s ‚Üí IsRetrocompact (f ‚Åª¬π' s)) (hs : IsConstructible s) :
    IsConstructible (f ‚Åª¬π' s) := by
  induction hs using IsConstructible.empty_union_induction with
  | open_retrocompact U hUopen hUcomp =>
    exact (hf _ hUopen hUcomp).isConstructible <| hUopen.preimage hfcont
  | union s hs t ht hs' ht' => rw [preimage_union]; exact hs'.union ht'
  | compl s hs hs' => rw [preimage_compl]; exact hs'.compl
",Formal Proof of Stacks Project Tag 005I,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L244-L251,Q27041,,5.15.3,lemma,3.0,"['04ZC', '004C', '0ELQ']","\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n      Proof.\n      This is true because $f^{-1}(U \\cap V^ c) = f^{-1}(U) \\cap f^{-1}(V)^ c$, combined with the definition of constructible sets. \n      $\\square$\n    \n","\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n","Proof.\n      This is true because $f^{-1}(U \\cap V^ c) = f^{-1}(U) \\cap f^{-1}(V)^ c$, combined with the definition of constructible sets. \n      $\\square$\n    \n"," by
  induction hs using IsConstructible.empty_union_induction with
  | open_retrocompact U hUopen hUcomp =>
    exact (hf _ hUopen hUcomp).isConstructible <| hUopen.preimage hfcont
  | union s hs t ht hs' ht' => rw [preimage_union]; exact hs'.union ht'
  | compl s hs hs' => rw [preimage_compl]; exact hs'.compl
","lemma IsConstructible.preimage {s : Set Y} (hfcont : Continuous f)
    (hf : ‚àÄ s, IsOpen s ‚Üí IsRetrocompact s ‚Üí IsRetrocompact (f ‚Åª¬π' s)) (hs : IsConstructible s) :
    IsConstructible (f ‚Åª¬π' s) ","Proof.\n      This is true because $f^{-1}(U \\cap V^ c) = f^{-1}(U) \\cap f^{-1}(V)^ c$, combined with the definition of constructible sets. \n      $\\square$\n    \n","Proof.\n      This is true because $f^{-1}(U \\cap V^ c) = f^{-1}(U) \\cap f^{-1}(V)^ c$, combined with the definition of constructible sets. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to show that the preimage of a constructible set under a continuous map is constructible, using closure of constructible sets under basic set operations. The informal proof cites the identity f‚Åª¬π(U ‚à© V·∂ú) = f‚Åª¬π(U) ‚à© (f‚Åª¬π(V))·∂ú and appeals to the definition of constructible sets (built from opens via finite unions/intersections/complements). The Lean proof instead proceeds by an induction principle for constructible sets (empty_union_induction), with cases for a generating class (open_retrocompact), union, and complement, rewriting preimages of union/complement and applying constructible closure lemmas. Structurally, the formal proof is more detailed and uses union/compl induction rather than the single intersection-with-complement identity mentioned informally; it does not explicitly use the intersection step, though it is compatible with it. Thus the alignment is partial: same overall idea, but the informal proof is much narrower and does not match the formal proof‚Äôs induction structure.""}"
366,005J,"lemma IsConstructible.preimage_of_isOpenEmbedding {s : Set Y} (hf : IsOpenEmbedding f)
    (hs : IsConstructible s) : IsConstructible (f ‚Åª¬π' s) :=
  hs.preimage hf.continuous fun _t _ ht ‚Ü¶ ht.preimage_of_isOpenEmbedding hf
",Formal Proof of Stacks Project Tag 005J,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L254-L256,Q27041,,5.15.4,lemma,3.0,"['04ZC', '004C', '0ELQ']",\n  Lemma 5.15.4. Let $U \\subset X$ be open. For a constructible set $E \\subset X$ the intersection $E \\cap U$ is constructible in $U$. \n\n    \n      Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n,\n  Lemma 5.15.4. Let $U \\subset X$ be open. For a constructible set $E \\subset X$ the intersection $E \\cap U$ is constructible in $U$. \n\n    \n,Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n,"
  hs.preimage hf.continuous fun _t _ ht ‚Ü¶ ht.preimage_of_isOpenEmbedding hf
","lemma IsConstructible.preimage_of_isOpenEmbedding {s : Set Y} (hf : IsOpenEmbedding f)
    (hs : IsConstructible s) : IsConstructible (f ‚Åª¬π' s) ","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap U$ is retrocompact in $U$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset U$ be open and quasi-compact. Then $W$ is open and quasi-compact in $X$. Hence $V \\cap W = V \\cap U \\cap W$ is quasi-compact as $V$ is retrocompact in $X$. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that the preimage (or intersection) of a retrocompact open set remains retrocompact by reducing to checking quasi-compactness of intersections with quasi-compact opens, using a lemma about retrocompactness/constructibility. The formal proof instead is a one-liner using `hs.preimage` with `hf.continuous` and a fact about `IsOpenEmbedding` (`ht.preimage_of_isOpenEmbedding hf`), i.e. it proves an openness/embedding-style preimage statement rather than the quasi-compactness/retrocompact intersection argument. Structurally, the informal proof has a multi-step reduction (take V retrocompact open, reduce via Lemma 5.15.3, then test against W open qc), while the formal proof has no corresponding steps and relies on different hypotheses/lemmas. There is at best a loose thematic connection (preimages under continuous/open embedding), but the key retrocompact/quasi-compact reasoning is not reflected.""}"
367,09YE,"lemma IsConstructible.preimage_of_isClosedEmbedding {s : Set Y} (hf : IsClosedEmbedding f)
    (hf' : IsCompact (range f)·∂ú) (hs : IsConstructible s) : IsConstructible (f ‚Åª¬π' s) :=
  hs.preimage hf.continuous fun _t _ ht ‚Ü¶ ht.preimage_of_isClosedEmbedding hf hf'
",Formal Proof of Stacks Project Tag 09YE,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L259-L261,Q27041,,5.15.7,lemma,3.0,"['04ZC', '004C', '0ELQ']","\n  Lemma 5.15.7. Let $X$ be a topological space. Let $Z \\subset X$ be a closed subset such that $X \\setminus Z$ is quasi-compact. Then for a constructible set $E \\subset X$ the intersection $E \\cap Z$ is constructible in $Z$. \n\n    \n      Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3. \n      $\\square$\n    \n",\n  Lemma 5.15.7. Let $X$ be a topological space. Let $Z \\subset X$ be a closed subset such that $X \\setminus Z$ is quasi-compact. Then for a constructible set $E \\subset X$ the intersection $E \\cap Z$ is constructible in $Z$. \n\n    \n,"Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3. \n      $\\square$\n    \n","
  hs.preimage hf.continuous fun _t _ ht ‚Ü¶ ht.preimage_of_isClosedEmbedding hf hf'
","lemma IsConstructible.preimage_of_isClosedEmbedding {s : Set Y} (hf : IsClosedEmbedding f)
    (hf' : IsCompact (range f)·∂ú) (hs : IsConstructible s) : IsConstructible (f ‚Åª¬π' s) ","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]]. \n      $\\square$\n    \n","Proof.\n      Suppose that $V \\subset X$ is retrocompact open in $X$. It suffices to show that $V \\cap Z$ is retrocompact in $Z$ by Lemma 5.15.3 [[\n  Lemma 5.15.3. Let $f : X \\to Y$ be a continuous map of topological spaces. If the inverse image of every retrocompact open subset of $Y$ is retrocompact in $X$, then inverse images of constructible sets are constructible. \n\n    \n]]. To show this let $W \\subset Z$ be open and quasi-compact. The subset $W\' = W \\cup (X \\setminus Z)$ is quasi-compact, open, and $W = Z \\cap W\'$. Hence $V \\cap Z \\cap W = V \\cap Z \\cap W\'$ is a closed subset of the quasi-compact open $V \\cap W\'$ as $V$ is retrocompact in $X$. Thus $V \\cap Z \\cap W$ is quasi-compact by Lemma 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]]. \n      $\\square$\n    \n","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the informal proof argues that the preimage/intersection of a retrocompact open with a closed subspace is retrocompact, using a characterization via intersections with quasi-compact opens and the fact that closed subsets of quasi-compact spaces are quasi-compact. The formal proof instead applies a generic `preimage` lemma for `hs` under a continuous map `hf.continuous`, and then uses `preimage_of_isClosedEmbedding` for closed embeddings. This matches the *high-level* idea ‚Äúretrocompactness is preserved under preimage along a (closed) embedding/continuous map,‚Äù but it does not reflect the specific retrocompact/quasi-compact-open intersection argument given informally. Structurally, the informal proof is a multi-step construction (introduce W, form W', show closed in qc open, conclude qc), whereas the Lean proof is a one-line invocation of existing lemmas with no corresponding intermediate constructions. So there is partial semantic overlap but weak structural correspondence and missing the explicit reasoning steps from the augmented proof.""}"
368,09YD,"lemma IsConstructible.image_of_isOpenEmbedding (hfopen : IsOpenEmbedding f)
    (hfcomp : IsRetrocompact (range f)) (hs : IsConstructible s) : IsConstructible (f '' s) := by
  induction hs using IsConstructible.empty_union_induction with
  | open_retrocompact U hUopen hUcomp =>
    exact (hUcomp.image_of_isEmbedding hfopen.isEmbedding hfcomp).isConstructible <|
      hfopen.isOpenMap _ hUopen
  | union s hs t ht hs' ht' => rw [image_union]; exact hs'.union ht'
  | compl s hs hs' =>
    rw [‚Üê range_diff_image hfopen.injective]
    exact (hfcomp.isConstructible hfopen.isOpen_range).sdiff hs'
",Formal Proof of Stacks Project Tag 09YD,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L264-L273,Q27041,,5.15.5,lemma,3.0,"['04ZC', '004C', '0ELQ']","\n  Lemma 5.15.5. Let $U \\subset X$ be a retrocompact open. Let $E \\subset U$. If $E$ is constructible in $U$, then $E$ is constructible in $X$. \n\n    \n      Proof.\n      Suppose that $V, W \\subset U$ are retrocompact open in $U$. Then $V, W$ are retrocompact open in $X$ (Lemma 5.12.2). Hence $V \\cap (U \\setminus W) = V \\cap (X \\setminus W)$ is constructible in $X$. We conclude since every constructible subset of $U$ is a finite union of subsets of the form $V \\cap (U \\setminus W)$. \n      $\\square$\n    \n","\n  Lemma 5.15.5. Let $U \\subset X$ be a retrocompact open. Let $E \\subset U$. If $E$ is constructible in $U$, then $E$ is constructible in $X$. \n\n    \n","Proof.\n      Suppose that $V, W \\subset U$ are retrocompact open in $U$. Then $V, W$ are retrocompact open in $X$ (Lemma 5.12.2). Hence $V \\cap (U \\setminus W) = V \\cap (X \\setminus W)$ is constructible in $X$. We conclude since every constructible subset of $U$ is a finite union of subsets of the form $V \\cap (U \\setminus W)$. \n      $\\square$\n    \n"," by
  induction hs using IsConstructible.empty_union_induction with
  | open_retrocompact U hUopen hUcomp =>
    exact (hUcomp.image_of_isEmbedding hfopen.isEmbedding hfcomp).isConstructible <|
      hfopen.isOpenMap _ hUopen
  | union s hs t ht hs' ht' => rw [image_union]; exact hs'.union ht'
  | compl s hs hs' =>
    rw [‚Üê range_diff_image hfopen.injective]
    exact (hfcomp.isConstructible hfopen.isOpen_range).sdiff hs'
","lemma IsConstructible.image_of_isOpenEmbedding (hfopen : IsOpenEmbedding f)
    (hfcomp : IsRetrocompact (range f)) (hs : IsConstructible s) : IsConstructible (f '' s) ","Proof.\n      Suppose that $V, W \\subset U$ are retrocompact open in $U$. Then $V, W$ are retrocompact open in $X$ (Lemma 5.12.2 [[\n  Lemma 5.12.2. A composition of quasi-compact maps is quasi-compact. \n\n    \n]]). Hence $V \\cap (U \\setminus W) = V \\cap (X \\setminus W)$ is constructible in $X$. We conclude since every constructible subset of $U$ is a finite union of subsets of the form $V \\cap (U \\setminus W)$. \n      $\\square$\n    \n","Proof.\n      Suppose that $V, W \\subset U$ are retrocompact open in $U$. Then $V, W$ are retrocompact open in $X$ (Lemma 5.12.2 [[\n  Lemma 5.12.2. A composition of quasi-compact maps is quasi-compact. \n\n    \n]]). Hence $V \\cap (U \\setminus W) = V \\cap (X \\setminus W)$ is constructible in $X$. We conclude since every constructible subset of $U$ is a finite union of subsets of the form $V \\cap (U \\setminus W)$. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs aim to show that the relevant class of subsets is constructible and is stable under the operations used to generate constructible sets. The Lean proof proceeds by an `IsConstructible.empty_union_induction`, handling three constructors: (1) retrocompact open sets (showing their image is constructible using embedding/open-map/quasi-compact hypotheses), (2) unions (using `image_union` and closure under union), and (3) complements/differences (rewriting via `range_diff_image` and using `sdiff`). The informal proof instead argues that any constructible subset is a finite union of sets of the form `V ‚à© (U \\ W)` with `V,W` retrocompact open, and that such sets are constructible; it does not explicitly use an induction on constructible sets nor discuss images/range-diff rewrites. Structurally, the Lean proof is an induction on the constructible predicate with explicit union and complement cases, while the informal proof uses a normal-form decomposition into `V ‚à© (U \\ W)` and a single constructibility argument. Thus they are related in goal and operations (union and set-difference/complement), but the formal proof includes additional machinery about images under an embedding/open map and a range-difference lemma that is not reflected in the informal proof‚Äôs structure.""}"
369,09YG,"lemma IsConstructible.image_of_isClosedEmbedding (hf : IsClosedEmbedding f)
    (hfcomp : IsRetrocompact (range f)·∂ú) (hs : IsConstructible s) : IsConstructible (f '' s) := by
  induction hs using IsConstructible.empty_union_induction with
  | open_retrocompact U hUopen hUcomp =>
    have hfU : IsOpen (f '' U ‚à™ (range f)·∂ú) := by
      simpa [‚Üê range_diff_image hf.injective, sdiff_eq, compl_inter, union_comm]
        using (hf.isClosedMap _ hUopen.isClosed_compl).isOpen_compl
    suffices h : IsRetrocompact (f '' U ‚à™ (range f)·∂ú) by
      simpa [union_inter_distrib_right, inter_eq_left.2 (image_subset_range ..)]
        using (h.isConstructible hfU).sdiff (hfcomp.isConstructible hf.isClosed_range.isOpen_compl)
    rintro V hVcomp hVopen
    rw [union_inter_distrib_right, ‚Üê image_inter_preimage]
    exact ((hUcomp (hf.isCompact_preimage hVcomp) (hVopen.preimage hf.continuous)).image
      hf.continuous).union <| hfcomp hVcomp hVopen
  | union s hs t ht hs' ht' => rw [image_union]; exact hs'.union ht'
  | compl s hs hs' =>
    rw [‚Üê range_diff_image hf.injective]
    exact (hfcomp.isConstructible hf.isClosed_range.isOpen_compl).of_compl.sdiff hs'
",Formal Proof of Stacks Project Tag 09YG,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L276-L293,Q27041,,5.15.9,lemma,3.0,"['04ZC', '004C', '0ELQ']","\n  Lemma 5.15.9. Let $Z \\subset X$ be a closed subset whose complement is retrocompact open. Let $E \\subset Z$. If $E$ is constructible in $Z$, then $E$ is constructible in $X$. \n\n    \n      Proof.\n      Suppose that $V \\subset Z$ is retrocompact open in $Z$. Consider the open subset $\\tilde V = V \\cup (X \\setminus Z)$ of $X$. Let $W \\subset X$ be quasi-compact open. Then \n    \n      \n  \\[  W \\cap \\tilde V = \\left(V \\cap W\\right) \\cup \\left((X \\setminus Z) \\cap W\\right).  \\]\n\n    \n       The first part is quasi-compact as $V \\cap W = V \\cap (Z \\cap W)$ and $(Z \\cap W)$ is quasi-compact open in $Z$ (Lemma 5.12.3) and $V$ is retrocompact in $Z$. The second part is quasi-compact as $(X \\setminus Z)$ is retrocompact in $X$. In this way we see that $\\tilde V$ is retrocompact in $X$. Thus if $V_1, V_2 \\subset Z$ are retrocompact open, then \n    \n      \n  \\[  V_1 \\cap (Z \\setminus V_2) = \\tilde V_1 \\cap (X \\setminus \\tilde V_2)  \\]\n\n    \n       is constructible in $X$. We conclude since every constructible subset of $Z$ is a finite union of subsets of the form $V_1 \\cap (Z \\setminus V_2)$. \n      $\\square$\n    \n","\n  Lemma 5.15.9. Let $Z \\subset X$ be a closed subset whose complement is retrocompact open. Let $E \\subset Z$. If $E$ is constructible in $Z$, then $E$ is constructible in $X$. \n\n    \n","Proof.\n      Suppose that $V \\subset Z$ is retrocompact open in $Z$. Consider the open subset $\\tilde V = V \\cup (X \\setminus Z)$ of $X$. Let $W \\subset X$ be quasi-compact open. Then \n    \n      \n  \\[  W \\cap \\tilde V = \\left(V \\cap W\\right) \\cup \\left((X \\setminus Z) \\cap W\\right).  \\]\n\n    \n       The first part is quasi-compact as $V \\cap W = V \\cap (Z \\cap W)$ and $(Z \\cap W)$ is quasi-compact open in $Z$ (Lemma 5.12.3) and $V$ is retrocompact in $Z$. The second part is quasi-compact as $(X \\setminus Z)$ is retrocompact in $X$. In this way we see that $\\tilde V$ is retrocompact in $X$. Thus if $V_1, V_2 \\subset Z$ are retrocompact open, then \n    \n      \n  \\[  V_1 \\cap (Z \\setminus V_2) = \\tilde V_1 \\cap (X \\setminus \\tilde V_2)  \\]\n\n    \n       is constructible in $X$. We conclude since every constructible subset of $Z$ is a finite union of subsets of the form $V_1 \\cap (Z \\setminus V_2)$. \n      $\\square$\n    \n"," by
  induction hs using IsConstructible.empty_union_induction with
  | open_retrocompact U hUopen hUcomp =>
    have hfU : IsOpen (f '' U ‚à™ (range f)·∂ú) := by
      simpa [‚Üê range_diff_image hf.injective, sdiff_eq, compl_inter, union_comm]
        using (hf.isClosedMap _ hUopen.isClosed_compl).isOpen_compl
    suffices h : IsRetrocompact (f '' U ‚à™ (range f)·∂ú) by
      simpa [union_inter_distrib_right, inter_eq_left.2 (image_subset_range ..)]
        using (h.isConstructible hfU).sdiff (hfcomp.isConstructible hf.isClosed_range.isOpen_compl)
    rintro V hVcomp hVopen
    rw [union_inter_distrib_right, ‚Üê image_inter_preimage]
    exact ((hUcomp (hf.isCompact_preimage hVcomp) (hVopen.preimage hf.continuous)).image
      hf.continuous).union <| hfcomp hVcomp hVopen
  | union s hs t ht hs' ht' => rw [image_union]; exact hs'.union ht'
  | compl s hs hs' =>
    rw [‚Üê range_diff_image hf.injective]
    exact (hfcomp.isConstructible hf.isClosed_range.isOpen_compl).of_compl.sdiff hs'
","lemma IsConstructible.image_of_isClosedEmbedding (hf : IsClosedEmbedding f)
    (hfcomp : IsRetrocompact (range f)·∂ú) (hs : IsConstructible s) : IsConstructible (f '' s) ","Proof.\n      Suppose that $V \\subset Z$ is retrocompact open in $Z$. Consider the open subset $\\tilde V = V \\cup (X \\setminus Z)$ of $X$. Let $W \\subset X$ be quasi-compact open. Then \n    \n      \n  \\[  W \\cap \\tilde V = \\left(V \\cap W\\right) \\cup \\left((X \\setminus Z) \\cap W\\right).  \\]\n\n    \n       The first part is quasi-compact as $V \\cap W = V \\cap (Z \\cap W)$ and $(Z \\cap W)$ is quasi-compact open in $Z$ (Lemma 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]]) and $V$ is retrocompact in $Z$. The second part is quasi-compact as $(X \\setminus Z)$ is retrocompact in $X$. In this way we see that $\\tilde V$ is retrocompact in $X$. Thus if $V_1, V_2 \\subset Z$ are retrocompact open, then \n    \n      \n  \\[  V_1 \\cap (Z \\setminus V_2) = \\tilde V_1 \\cap (X \\setminus \\tilde V_2)  \\]\n\n    \n       is constructible in $X$. We conclude since every constructible subset of $Z$ is a finite union of subsets of the form $V_1 \\cap (Z \\setminus V_2)$. \n      $\\square$\n    \n","Proof.\n      Suppose that $V \\subset Z$ is retrocompact open in $Z$. Consider the open subset $\\tilde V = V \\cup (X \\setminus Z)$ of $X$. Let $W \\subset X$ be quasi-compact open. Then \n    \n      \n  \\[  W \\cap \\tilde V = \\left(V \\cap W\\right) \\cup \\left((X \\setminus Z) \\cap W\\right).  \\]\n\n    \n       The first part is quasi-compact as $V \\cap W = V \\cap (Z \\cap W)$ and $(Z \\cap W)$ is quasi-compact open in $Z$ (Lemma 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]]) and $V$ is retrocompact in $Z$. The second part is quasi-compact as $(X \\setminus Z)$ is retrocompact in $X$. In this way we see that $\\tilde V$ is retrocompact in $X$. Thus if $V_1, V_2 \\subset Z$ are retrocompact open, then \n    \n      \n  \\[  V_1 \\cap (Z \\setminus V_2) = \\tilde V_1 \\cap (X \\setminus \\tilde V_2)  \\]\n\n    \n       is constructible in $X$. We conclude since every constructible subset of $Z$ is a finite union of subsets of the form $V_1 \\cap (Z \\setminus V_2)$. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, both proofs establish constructibility of images/sets by reducing to the case of retrocompact opens and then using closure properties (finite unions and complements/differences) of constructible sets. The Lean proof proceeds by an induction principle for constructible sets (`empty_union_induction`) with cases for a basic retrocompact open, union, and complement; this matches the informal argument that every constructible set is a finite union of differences of retrocompact opens and hence closed under union and complement.\n\nStructurally, the Lean `open_retrocompact` case corresponds to the informal step of enlarging a retrocompact open in a subspace to an open in the ambient space and proving it is retrocompact by testing against compact opens; Lean does this via `rintro V hVcomp hVopen` and shows compactness of intersections using preimages/images and a hypothesis `hfcomp` handling the complement-of-range part. The union and complement cases in Lean directly mirror the informal closure under union and taking differences/complements.\n\nThe main mismatch is that the informal proof is phrased for a subspace inclusion Z ‚äÇ X and constructs \\tilde V = V ‚à™ (X \\ Z), whereas the Lean proof is formulated for a map f with injectivity/closed-map hypotheses and uses sets of the form `f '' U ‚à™ (range f)·∂ú` and lemmas like `range_diff_image`. So the setting is more general/different, but the logical pattern (extend by adding complement of the range/subspace, prove retrocompactness, then use constructible closure) is closely aligned.""}"
370,0069,"lemma _root_.QuasiSeparatedSpace.isRetrocompact_iff_isCompact
    (hU : IsOpen U) : IsRetrocompact U ‚Üî IsCompact U :=
  ‚ü®IsRetrocompact.isCompact, (IsCompact.isRetrocompact ¬∑ hU)‚ü©
",Formal Proof of Stacks Project Tag 0069,Iff form of (2). Note that Stacks doesn't define quasi-separated spaces.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Constructible.lean#L334-L336,Q27041,,5.27.1,lemma,3.0,"['0067', '004C', '0ELQ']","\n  Lemma 5.27.1. Let $X$ be a topological space which \n  \n  \nhas a basis of the topology consisting of quasi-compact opens, and \n\n\nhas the property that the intersection of any two quasi-compact opens is quasi-compact. \n\n\n\n   Then \n  \n  \n$X$ is locally quasi-compact, \n\n\na quasi-compact open $U \\subset X$ is retrocompact, \n\n\nany quasi-compact open $U \\subset X$ has a cofinal system of open coverings $\\mathcal{U} : U = \\bigcup _{j\\in J} U_ j$ with $J$ finite and all $U_ j$ and $U_ j \\cap U_{j\'}$ quasi-compact, \n\n\nadd more here. \n\n\n\n\n    \n      Proof.\n      Omitted. \n      $\\square$\n    \n","\n  Lemma 5.27.1. Let $X$ be a topological space which \n  \n  \nhas a basis of the topology consisting of quasi-compact opens, and \n\n\nhas the property that the intersection of any two quasi-compact opens is quasi-compact. \n\n\n\n   Then \n  \n  \n$X$ is locally quasi-compact, \n\n\na quasi-compact open $U \\subset X$ is retrocompact, \n\n\nany quasi-compact open $U \\subset X$ has a cofinal system of open coverings $\\mathcal{U} : U = \\bigcup _{j\\in J} U_ j$ with $J$ finite and all $U_ j$ and $U_ j \\cap U_{j\'}$ quasi-compact, \n\n\nadd more here. \n\n\n\n\n    \n",Proof.\n      Omitted. \n      $\\square$\n    \n,"
  ‚ü®IsRetrocompact.isCompact, (IsCompact.isRetrocompact ¬∑ hU)‚ü©
","lemma _root_.QuasiSeparatedSpace.isRetrocompact_iff_isCompact
    (hU : IsOpen U) : IsRetrocompact U ‚Üî IsCompact U ",Proof.\n      Omitted. \n      $\\square$\n    \n,"Proof.\n      Omitted. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: Iff form of (2). Note that Stacks doesn't define quasi-separated spaces.","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term constructs a pair of implications ‚ü®‚Ä¶, ‚Ä¶‚ü©, i.e. it is proving an iff by giving both directions: one direction uses `IsRetrocompact.isCompact`, and the other uses `(IsCompact.isRetrocompact ¬∑ hU)` (a compactness assumption `hU` to deduce retrocompactness). This matches the meta-comment that the intended result is an ‚Äúiff form of (2)‚Äù. However, the informal proof is completely omitted and provides no mathematical content or structure to compare against, so structural correspondence and completeness relative to the written informal proof cannot really be verified. The Lean proof also implicitly relies on specific definitions/lemmas (and on the absence of quasi-separatedness assumptions), which the informal text does not mention. Hence there is only weak alignment: the Lean proof plausibly proves the intended iff, but the informal proof gives no details to confirm it.""}"
373,004W,"theorem isIrreducible_iff_closure : IsIrreducible (closure s) ‚Üî IsIrreducible s :=
  and_congr closure_nonempty_iff isPreirreducible_iff_closure
",Formal Proof of Stacks Project Tag 004W,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Irreducible.lean#L78-L79,Q27041,,5.8.3,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n      Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","
  and_congr closure_nonempty_iff isPreirreducible_iff_closure
",theorem isIrreducible_iff_closure : IsIrreducible (closure s) ‚Üî IsIrreducible s ,"Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term `and_congr closure_nonempty_iff isPreirreducible_iff_closure` only establishes a logical equivalence of a conjunction by rewriting each conjunct via two existing iff-lemmas: one about nonemptiness vs closure (`closure_nonempty_iff`) and one about (pre)irreducibility vs closure (`isPreirreducible_iff_closure`). This corresponds at best to the informal proof‚Äôs first theme that taking closure preserves irreducibility/nonemptiness, but it does not capture the main content of the informal argument (maximal chains/Zorn-type construction of irreducible components, existence of maximal irreducible supersets, etc.). Structurally, the informal proof is multi-part (show closure of irreducible is irreducible; then derive statements about irreducible components; then a maximal-chain union argument), whereas the Lean proof is a one-line congruence transformation with no such structure. The formal proof is therefore incomplete relative to the informal proof and omits most steps and conclusions, though it is not obviously inconsistent with a small sub-claim about closure.""}"
375,004W,"theorem isClosed_of_mem_irreducibleComponents (s) (H : s ‚àà irreducibleComponents X) :
    IsClosed s := by
  rw [‚Üê closure_eq_iff_isClosed, eq_comm]
  exact subset_closure.antisymm (H.2 H.1.closure subset_closure)
",Formal Proof of Stacks Project Tag 004W,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Irreducible.lean#L110-L113,Q27041,,5.8.3,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n      Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n"," by
  rw [‚Üê closure_eq_iff_isClosed, eq_comm]
  exact subset_closure.antisymm (H.2 H.1.closure subset_closure)
","theorem isClosed_of_mem_irreducibleComponents (s) (H : s ‚àà irreducibleComponents X) :
    IsClosed s ","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is a short argument about closures and closedness: it rewrites using a lemma characterizing when `closure s = s` (via `closure_eq_iff_isClosed`), then applies an antisymmetry argument using `subset_closure` and a hypothesis `H` to conclude an equality involving a closure. This matches at most the *spirit* of informal part (1)/(2) (closure of an irreducible set and a minimality/maximality property), but it does not encode the key irreducibility reasoning (decomposition into two closed sets, intersection with T, concluding one side contains the closure) nor anything about irreducible components.\n\nStructurally, the informal proof is a multi-step topological argument (irreducibility under closure; then Zorn/maximal chain union irreducible; then consequences). The Lean proof is a two-line rewrite + `antisymm` using closure monotonicity, with no case split on closed unions, no use of irreducibility definitions, and no maximal chain/union argument. So the structure does not correspond.\n\nCompleteness/precision: the Lean proof is far too short to cover the informal proof‚Äôs content (especially parts (3) and (4)), and it relies on an `H` hypothesis whose meaning is not reflected in the informal text provided. It is not obviously wrong, but it appears to prove only a small closure/closedness lemma rather than the full informal statement.""}"
376,004W,"lemma exists_mem_irreducibleComponents_subset_of_isIrreducible (s : Set X) (hs : IsIrreducible s) :
    ‚àÉ u ‚àà irreducibleComponents X, s ‚äÜ u := by
  obtain ‚ü®u, hu‚ü© := exists_preirreducible s hs.isPreirreducible
  use u, ‚ü®‚ü®hs.left.mono hu.right.left,hu.left‚ü©,fun _ h hl => (hu.right.right _ h.right hl).le‚ü©
  exact hu.right.left
",Formal Proof of Stacks Project Tag 004W,(3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Irreducible.lean#L127-L131,Q27041,,5.8.3,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n      Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n"," by
  obtain ‚ü®u, hu‚ü© := exists_preirreducible s hs.isPreirreducible
  use u, ‚ü®‚ü®hs.left.mono hu.right.left,hu.left‚ü©,fun _ h hl => (hu.right.right _ h.right hl).le‚ü©
  exact hu.right.left
","lemma exists_mem_irreducibleComponents_subset_of_isIrreducible (s : Set X) (hs : IsIrreducible s) :
    ‚àÉ u ‚àà irreducibleComponents X, s ‚äÜ u ","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof appears to be about extracting a ‚Äúpreirreducible‚Äù witness `u` from `s` via `exists_preirreducible s hs.isPreirreducible`, and then packaging `u` with some monotonicity/maximality-style property (using `hs.left.mono ...` and a `fun _ h hl => ... .le`). This looks like a technical lemma about existence of a preirreducible subset/superset and some order-theoretic condition, not the Zorn/chain-union argument establishing that the union of a maximal chain of irreducible supersets is irreducible (informal part (3)). Structurally, the informal proof‚Äôs key steps are: form a poset of irreducible supersets, take a maximal chain, define `E` as a union, and prove irreducibility by a closed-cover argument using total order. None of these ingredients (maximal chain, union over chain, closed cover case split) are visible in the Lean snippet; instead it is a short witness-extraction and record construction. Thus the formal proof does not reflect the structure of the informal proof for (3), and at best only weakly aligns if `exists_preirreducible` encapsulates a large amount of the Zorn/chain reasoning off-screen. Overall alignment is low.""}"
377,004W,"theorem mem_irreducibleComponent {x : X} : x ‚àà irreducibleComponent x :=
  singleton_subset_iff.1 (irreducibleComponent_property x).2.1
",Formal Proof of Stacks Project Tag 004W,(4),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Irreducible.lean#L145-L146,Q27041,,5.8.3,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n      Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","
  singleton_subset_iff.1 (irreducibleComponent_property x).2.1
",theorem mem_irreducibleComponent {x : X} : x ‚àà irreducibleComponent x ,"Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n","Proof.\n      Let $\\overline{T}$ be the closure of the irreducible subset $T$. If $\\overline{T} = Z_1 \\cup Z_2$ with $Z_ i \\subset \\overline{T}$ closed, then $T = (T\\cap Z_1) \\cup (T \\cap Z_2)$ and hence $T$ equals one of the two, say $T = Z_1 \\cap T$. Thus clearly $\\overline{T} \\subset Z_1$. This proves (1). Part (2) follows immediately from (1) and the definition of irreducible components. \n    \n      Let $T \\subset X$ be irreducible. Consider the set $A$ of irreducible subsets $T \\subset T\' \\subset X$. Note that $A$ is nonempty since $T \\in A$. There is a partial ordering on $A$ coming from inclusion: $T\' \\leq T\'\' \\Leftrightarrow T\' \\subset T\'\'$. Choose a maximal totally ordered subset $A\' \\subset A$, and let $E = \\bigcup _{T\' \\in A\'} T\'$. We claim that $E$ is irreducible. Namely, suppose that $E = Z_1 \\cup Z_2$ is a union of two closed subsets of $E$. For each $T\' \\in A\'$ we have either $T\' \\subset Z_1$ or $T\' \\subset Z_2$, by irreducibility of $T\'$. Suppose that for some $T\'_0 \\in A\'$ we have $T\'_0 \\not\\subset Z_1$ (say, if not we\'re done anyway). Then, since $A\'$ is totally ordered we see immediately that $T\' \\subset Z_2$ for all $T\' \\in A\'$. Hence $E = Z_2$. This proves (3). Part (4) is an immediate consequence of (3) as a singleton space is irreducible. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (4)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean term `singleton_subset_iff.1 (irreducibleComponent_property x).2.1` is extracting a statement of the form ‚Äú{x} ‚äÜ ‚Ä¶‚Äù (via `singleton_subset_iff`) from a bundled property about an irreducible component containing `x` (via `irreducibleComponent_property x`). This matches only the very last informal step (part (4): a singleton is irreducible, hence it lies in some irreducible component / maximal irreducible set), but it does not reflect the main informal argument (Zorn chain construction, union of chain is irreducible, closure argument, etc.). Structurally, the informal proof is multi-part and constructive (closure irreducible, Zorn maximality, then singleton case), whereas the Lean proof is a one-line projection from an existing lemma about irreducible components, with no trace of the intermediate reasoning. Thus it captures at best the endpoint of (4) but not the proof strategy or earlier parts, and it relies on a prepackaged lemma rather than reproducing the informal derivation.""}"
379,0379,"theorem IsIrreducible.image (H : IsIrreducible s) (f : X ‚Üí Y) (hf : ContinuousOn f s) :
    IsIrreducible (f '' s) :=
  ‚ü®H.nonempty.image _, H.isPreirreducible.image f hf‚ü©
",Formal Proof of Stacks Project Tag 0379,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Irreducible.lean#L214-L216,Q27041,,5.8.2,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.2. Let $f : X \\to Y$ be a continuous map of topological spaces. If $E \\subset X$ is an irreducible subset, then $f(E) \\subset Y$ is irreducible as well. \n\n    \n      Proof.\n      Clearly we may assume $E = X$ (i.e., $X$ irreducible) and $f(E) = Y$ (i.e., $f$ surjective). First, $Y \\not= \\emptyset $ since $X \\not= \\emptyset $. Next, assume $Y = Y_1 \\cup Y_2$ with $Y_1$, $Y_2$ closed. Then $X = X_1 \\cup X_2$ with $X_ i = f^{-1}(Y_ i)$ closed in $X$. By assumption on $X$, we must have $X = X_1$ or $X = X_2$, hence $Y = Y_1$ or $Y = Y_2$ since $f$ is surjective. \n      $\\square$\n    \n","\n  Lemma 5.8.2. Let $f : X \\to Y$ be a continuous map of topological spaces. If $E \\subset X$ is an irreducible subset, then $f(E) \\subset Y$ is irreducible as well. \n\n    \n","Proof.\n      Clearly we may assume $E = X$ (i.e., $X$ irreducible) and $f(E) = Y$ (i.e., $f$ surjective). First, $Y \\not= \\emptyset $ since $X \\not= \\emptyset $. Next, assume $Y = Y_1 \\cup Y_2$ with $Y_1$, $Y_2$ closed. Then $X = X_1 \\cup X_2$ with $X_ i = f^{-1}(Y_ i)$ closed in $X$. By assumption on $X$, we must have $X = X_1$ or $X = X_2$, hence $Y = Y_1$ or $Y = Y_2$ since $f$ is surjective. \n      $\\square$\n    \n","
  ‚ü®H.nonempty.image _, H.isPreirreducible.image f hf‚ü©
","theorem IsIrreducible.image (H : IsIrreducible s) (f : X ‚Üí Y) (hf : ContinuousOn f s) :
    IsIrreducible (f '' s) ","Proof.\n      Clearly we may assume $E = X$ (i.e., $X$ irreducible) and $f(E) = Y$ (i.e., $f$ surjective). First, $Y \\not= \\emptyset $ since $X \\not= \\emptyset $. Next, assume $Y = Y_1 \\cup Y_2$ with $Y_1$, $Y_2$ closed. Then $X = X_1 \\cup X_2$ with $X_ i = f^{-1}(Y_ i)$ closed in $X$. By assumption on $X$, we must have $X = X_1$ or $X = X_2$, hence $Y = Y_1$ or $Y = Y_2$ since $f$ is surjective. \n      $\\square$\n    \n","Proof.\n      Clearly we may assume $E = X$ (i.e., $X$ irreducible) and $f(E) = Y$ (i.e., $f$ surjective). First, $Y \\not= \\emptyset $ since $X \\not= \\emptyset $. Next, assume $Y = Y_1 \\cup Y_2$ with $Y_1$, $Y_2$ closed. Then $X = X_1 \\cup X_2$ with $X_ i = f^{-1}(Y_ i)$ closed in $X$. By assumption on $X$, we must have $X = X_1$ or $X = X_2$, hence $Y = Y_1$ or $Y = Y_2$ since $f$ is surjective. \n      $\\square$\n    \n","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean term constructs the irreducibility of the image from two components: nonemptiness of the image (via `H.nonempty.image _`) and preservation of preirreducibility under a map (via `H.isPreirreducible.image f hf`). This matches the informal proof‚Äôs two key steps: (1) show the image is nonempty because the domain is nonempty, and (2) show irreducibility by pulling back a decomposition of the image into closed sets to a decomposition of the domain, then using irreducibility of the domain and surjectivity/continuity to conclude one piece is all. Structurally, the informal proof explicitly argues with unions of closed sets and surjectivity, while the formal proof packages these arguments into existing lemmas (`image` lemmas) rather than reproducing the decomposition argument. The only mild mismatch is that the informal proof discusses reductions like assuming surjectivity and E=X, f(E)=Y, whereas the Lean proof directly applies general lemmas without those narrative reductions; otherwise the content aligns well.""}"
380,004Z,"lemma IsPreirreducible.preimage_of_dense_isPreirreducible_fiber
    {V : Set Y} (hV : IsPreirreducible V) (f : X ‚Üí Y) (hf' : IsOpenMap f)
    (hf'' : V ‚äÜ closure (V ‚à© { x | IsPreirreducible (f ‚Åª¬π' {x}) })) :
    IsPreirreducible (f ‚Åª¬π' V) := by
  rintro U‚ÇÅ U‚ÇÇ hU‚ÇÅ hU‚ÇÇ ‚ü®x, hxV, hxU‚ÇÅ‚ü© ‚ü®y, hyV, hyU‚ÇÇ‚ü©
  obtain ‚ü®z, hzV, hz‚ÇÅ, hz‚ÇÇ‚ü© :=
    hV _ _ (hf' _ hU‚ÇÅ) (hf' _ hU‚ÇÇ) ‚ü®f x, hxV, x, hxU‚ÇÅ, rfl‚ü© ‚ü®f y, hyV, y, hyU‚ÇÇ, rfl‚ü©
  obtain ‚ü®z, ‚ü®‚ü®z‚ÇÅ, hz‚ÇÅ, e‚ÇÅ‚ü©, ‚ü®z‚ÇÇ, hz‚ÇÇ, e‚ÇÇ‚ü©‚ü©, hzV, hz‚ü© :=
    mem_closure_iff.mp (hf'' hzV) _ ((hf' _ hU‚ÇÅ).inter (hf' _ hU‚ÇÇ)) ‚ü®hz‚ÇÅ, hz‚ÇÇ‚ü©
  obtain ‚ü®z‚ÇÉ, hz‚ÇÉ, hz‚ÇÉ'‚ü© := hz _ _ hU‚ÇÅ hU‚ÇÇ ‚ü®z‚ÇÅ, e‚ÇÅ, hz‚ÇÅ‚ü© ‚ü®z‚ÇÇ, e‚ÇÇ, hz‚ÇÇ‚ü©
  refine ‚ü®z‚ÇÉ, show f z‚ÇÉ ‚àà _ from (show f z‚ÇÉ = z from hz‚ÇÉ) ‚ñ∏ hzV, hz‚ÇÉ'‚ü©
",Formal Proof of Stacks Project Tag 004Z,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Irreducible.lean#L355-L365,Q27041,,5.8.14,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.14. Let $f : X \\to Y$ be a continuous map of topological spaces. Assume that (a) $Y$ is irreducible, (b) $f$ is open, and (c) there exists a dense collection of points $y \\in Y$ such that $f^{-1}(y)$ is irreducible. Then $X$ is irreducible. \n\n    \n      Proof.\n      Suppose $X = Z_1 \\cup Z_2$ with $Z_ i$ closed. Consider the open sets $U_1 = Z_1 \\setminus Z_2 = X \\setminus Z_2$ and $U_2 = Z_2 \\setminus Z_1 = X \\setminus Z_1$. To get a contradiction assume that $U_1$ and $U_2$ are both nonempty. By (b) we see that $f(U_ i)$ is open. By (a) we have $Y$ irreducible and hence $f(U_1) \\cap f(U_2) \\not= \\emptyset $. By (c) there is a point $y$ which corresponds to a point of this intersection such that the fibre $X_ y = f^{-1}(y)$ is irreducible. Then $X_ y \\cap U_1$ and $X_ y \\cap U_2$ are nonempty disjoint open subsets of $X_ y$ which is a contradiction. \n      $\\square$\n    \n","\n  Lemma 5.8.14. Let $f : X \\to Y$ be a continuous map of topological spaces. Assume that (a) $Y$ is irreducible, (b) $f$ is open, and (c) there exists a dense collection of points $y \\in Y$ such that $f^{-1}(y)$ is irreducible. Then $X$ is irreducible. \n\n    \n",Proof.\n      Suppose $X = Z_1 \\cup Z_2$ with $Z_ i$ closed. Consider the open sets $U_1 = Z_1 \\setminus Z_2 = X \\setminus Z_2$ and $U_2 = Z_2 \\setminus Z_1 = X \\setminus Z_1$. To get a contradiction assume that $U_1$ and $U_2$ are both nonempty. By (b) we see that $f(U_ i)$ is open. By (a) we have $Y$ irreducible and hence $f(U_1) \\cap f(U_2) \\not= \\emptyset $. By (c) there is a point $y$ which corresponds to a point of this intersection such that the fibre $X_ y = f^{-1}(y)$ is irreducible. Then $X_ y \\cap U_1$ and $X_ y \\cap U_2$ are nonempty disjoint open subsets of $X_ y$ which is a contradiction. \n      $\\square$\n    \n," by
  rintro U‚ÇÅ U‚ÇÇ hU‚ÇÅ hU‚ÇÇ ‚ü®x, hxV, hxU‚ÇÅ‚ü© ‚ü®y, hyV, hyU‚ÇÇ‚ü©
  obtain ‚ü®z, hzV, hz‚ÇÅ, hz‚ÇÇ‚ü© :=
    hV _ _ (hf' _ hU‚ÇÅ) (hf' _ hU‚ÇÇ) ‚ü®f x, hxV, x, hxU‚ÇÅ, rfl‚ü© ‚ü®f y, hyV, y, hyU‚ÇÇ, rfl‚ü©
  obtain ‚ü®z, ‚ü®‚ü®z‚ÇÅ, hz‚ÇÅ, e‚ÇÅ‚ü©, ‚ü®z‚ÇÇ, hz‚ÇÇ, e‚ÇÇ‚ü©‚ü©, hzV, hz‚ü© :=
    mem_closure_iff.mp (hf'' hzV) _ ((hf' _ hU‚ÇÅ).inter (hf' _ hU‚ÇÇ)) ‚ü®hz‚ÇÅ, hz‚ÇÇ‚ü©
  obtain ‚ü®z‚ÇÉ, hz‚ÇÉ, hz‚ÇÉ'‚ü© := hz _ _ hU‚ÇÅ hU‚ÇÇ ‚ü®z‚ÇÅ, e‚ÇÅ, hz‚ÇÅ‚ü© ‚ü®z‚ÇÇ, e‚ÇÇ, hz‚ÇÇ‚ü©
  refine ‚ü®z‚ÇÉ, show f z‚ÇÉ ‚àà _ from (show f z‚ÇÉ = z from hz‚ÇÉ) ‚ñ∏ hzV, hz‚ÇÉ'‚ü©
","lemma IsPreirreducible.preimage_of_dense_isPreirreducible_fiber
    {V : Set Y} (hV : IsPreirreducible V) (f : X ‚Üí Y) (hf' : IsOpenMap f)
    (hf'' : V ‚äÜ closure (V ‚à© { x | IsPreirreducible (f ‚Åª¬π' {x}) })) :
    IsPreirreducible (f ‚Åª¬π' V) ",Proof.\n      Suppose $X = Z_1 \\cup Z_2$ with $Z_ i$ closed. Consider the open sets $U_1 = Z_1 \\setminus Z_2 = X \\setminus Z_2$ and $U_2 = Z_2 \\setminus Z_1 = X \\setminus Z_1$. To get a contradiction assume that $U_1$ and $U_2$ are both nonempty. By (b) we see that $f(U_ i)$ is open. By (a) we have $Y$ irreducible and hence $f(U_1) \\cap f(U_2) \\not= \\emptyset $. By (c) there is a point $y$ which corresponds to a point of this intersection such that the fibre $X_ y = f^{-1}(y)$ is irreducible. Then $X_ y \\cap U_1$ and $X_ y \\cap U_2$ are nonempty disjoint open subsets of $X_ y$ which is a contradiction. \n      $\\square$\n    \n,Proof.\n      Suppose $X = Z_1 \\cup Z_2$ with $Z_ i$ closed. Consider the open sets $U_1 = Z_1 \\setminus Z_2 = X \\setminus Z_2$ and $U_2 = Z_2 \\setminus Z_1 = X \\setminus Z_1$. To get a contradiction assume that $U_1$ and $U_2$ are both nonempty. By (b) we see that $f(U_ i)$ is open. By (a) we have $Y$ irreducible and hence $f(U_1) \\cap f(U_2) \\not= \\emptyset $. By (c) there is a point $y$ which corresponds to a point of this intersection such that the fibre $X_ y = f^{-1}(y)$ is irreducible. Then $X_ y \\cap U_1$ and $X_ y \\cap U_2$ are nonempty disjoint open subsets of $X_ y$ which is a contradiction. \n      $\\square$\n    \n,"{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is implementing the same irreducibility-contradiction strategy as the informal argument: it takes two nonempty opens (U‚ÇÅ, U‚ÇÇ) with points x‚ààU‚ÇÅ and y‚ààU‚ÇÇ, uses irreducibility of the target (hV) together with openness of images (hf') to obtain a point z in the intersection of the images, then pulls this back to a point in the domain via a closure/fiber argument (hf'' and mem_closure_iff), and finally applies an irreducibility hypothesis on the fiber (hz ... hU‚ÇÅ hU‚ÇÇ ...) to produce a point z‚ÇÉ lying in both opens, yielding the required intersection. Structurally, both proofs proceed: choose points in U‚ÇÅ,U‚ÇÇ ‚Üí show f(U‚ÇÅ),f(U‚ÇÇ) intersect in Y ‚Üí pick a point over that intersection with irreducible fiber ‚Üí deduce U‚ÇÅ‚à©U‚ÇÇ nonempty, contradicting disjointness. The main mismatch is that the informal proof explicitly sets U‚ÇÅ,U‚ÇÇ as complements of closed sets and argues by contradiction about disjoint opens in a fiber, while the Lean proof is written directly in the ‚Äúirreducible space‚Äù formulation (showing any two nonempty opens intersect) and uses technical lemmas about closure (mem_closure_iff) rather than explicitly mentioning the closed-set decomposition. So the core meaning matches well, but the presentation differs and some informal steps (defining U‚ÇÅ,U‚ÇÇ from Z‚ÇÅ,Z‚ÇÇ) are not mirrored explicitly.""}"
381,037A,"def irreducibleComponentsEquivOfIsPreirreducibleFiber :
    irreducibleComponents Y ‚âÉo irreducibleComponents X where
  invFun W := ‚ü®f '' W.1,
    image_mem_irreducibleComponents_of_isPreirreducible_fiber f hf‚ÇÅ hf‚ÇÇ hf‚ÇÉ hf‚ÇÑ W.2‚ü©
  toFun W := ‚ü®f ‚Åª¬π' W.1,
    preimage_mem_irreducibleComponents_of_isPreirreducible_fiber f hf‚ÇÅ hf‚ÇÇ hf‚ÇÉ hf‚ÇÑ W.2‚ü©
  right_inv W := Subtype.ext <| by
    refine (Set.subset_preimage_image _ _).antisymm' (W.2.2 ?_ (Set.subset_preimage_image _ _))
    refine ‚ü®?_, (W.2.1.image _ hf‚ÇÅ.continuousOn).2.preimage_of_isPreirreducible_fiber _ hf‚ÇÇ hf‚ÇÉ‚ü©
    obtain ‚ü®x, hx‚ü© := W.2.1.1
    exact ‚ü®_, x, hx, rfl‚ü©
  left_inv _ := Subtype.ext <| Set.image_preimage_eq _ hf‚ÇÑ
  map_rel_iff' {W Z} := by
    refine ‚ü®fun H ‚Ü¶ ?_, Set.preimage_mono‚ü©
    simpa only [Equiv.coe_fn_mk, Set.image_preimage_eq _ hf‚ÇÑ] using Set.image_mono (f := f) H
",Formal Proof of Stacks Project Tag 037A,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Irreducible.lean#L407-L421,Q27041,,5.8.15,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.15. Let $f : X \\to Y$ be a continuous map of topological spaces. Assume that (a) $f$ is open, and (b) for every $y \\in Y$ the fibre $f^{-1}(y)$ is irreducible. Then $f$ induces a bijection between irreducible components. \n\n    \n      Proof.\n      We point out that assumption (b) implies that $f$ is surjective (see Definition 5.8.1). Let $T \\subset Y$ be an irreducible component. Note that $T$ is closed, see Lemma 5.8.3. The lemma follows if we show that $f^{-1}(T)$ is irreducible because any irreducible subset of $X$ maps into an irreducible component of $Y$ by Lemma 5.8.2. Note that $f^{-1}(T) \\to T$ satisfies the assumptions of Lemma 5.8.14. Hence we win. \n      $\\square$\n    \n","\n  Lemma 5.8.15. Let $f : X \\to Y$ be a continuous map of topological spaces. Assume that (a) $f$ is open, and (b) for every $y \\in Y$ the fibre $f^{-1}(y)$ is irreducible. Then $f$ induces a bijection between irreducible components. \n\n    \n","Proof.\n      We point out that assumption (b) implies that $f$ is surjective (see Definition 5.8.1). Let $T \\subset Y$ be an irreducible component. Note that $T$ is closed, see Lemma 5.8.3. The lemma follows if we show that $f^{-1}(T)$ is irreducible because any irreducible subset of $X$ maps into an irreducible component of $Y$ by Lemma 5.8.2. Note that $f^{-1}(T) \\to T$ satisfies the assumptions of Lemma 5.8.14. Hence we win. \n      $\\square$\n    \n"," ‚ü®f '' W.1,
    image_mem_irreducibleComponents_of_isPreirreducible_fiber f hf‚ÇÅ hf‚ÇÇ hf‚ÇÉ hf‚ÇÑ W.2‚ü©
  toFun W := ‚ü®f ‚Åª¬π' W.1,
    preimage_mem_irreducibleComponents_of_isPreirreducible_fiber f hf‚ÇÅ hf‚ÇÇ hf‚ÇÉ hf‚ÇÑ W.2‚ü©
  right_inv W := Subtype.ext <| by
    refine (Set.subset_preimage_image _ _).antisymm' (W.2.2 ?_ (Set.subset_preimage_image _ _))
    refine ‚ü®?_, (W.2.1.image _ hf‚ÇÅ.continuousOn).2.preimage_of_isPreirreducible_fiber _ hf‚ÇÇ hf‚ÇÉ‚ü©
    obtain ‚ü®x, hx‚ü© := W.2.1.1
    exact ‚ü®_, x, hx, rfl‚ü©
  left_inv _ := Subtype.ext <| Set.image_preimage_eq _ hf‚ÇÑ
  map_rel_iff' {W Z} := by
    refine ‚ü®fun H ‚Ü¶ ?_, Set.preimage_mono‚ü©
    simpa only [Equiv.coe_fn_mk, Set.image_preimage_eq _ hf‚ÇÑ] using Set.image_mono (f := f) H
","def irreducibleComponentsEquivOfIsPreirreducibleFiber :
    irreducibleComponents Y ‚âÉo irreducibleComponents X where
  invFun W ","Proof.\n      We point out that assumption (b) implies that $f$ is surjective (see Definition 5.8.1 [[\n  Definition 5.8.1. Let $X$ be a topological space. \n  \n  \nWe say $X$ is irreducible, if $X$ is not empty, and whenever $X = Z_1 \\cup Z_2$ with $Z_ i$ closed, we have $X = Z_1$ or $X = Z_2$. \n\n\nWe say $Z \\subset X$ is an irreducible component of $X$ if $Z$ is a maximal irreducible subset of $X$. \n\n\n\n]]). Let $T \\subset Y$ be an irreducible component. Note that $T$ is closed, see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]. The lemma follows if we show that $f^{-1}(T)$ is irreducible because any irreducible subset of $X$ maps into an irreducible component of $Y$ by Lemma 5.8.2 [[\n  Lemma 5.8.2. Let $f : X \\to Y$ be a continuous map of topological spaces. If $E \\subset X$ is an irreducible subset, then $f(E) \\subset Y$ is irreducible as well. \n\n    \n]]. Note that $f^{-1}(T) \\to T$ satisfies the assumptions of Lemma 5.8.14 [[\n  Lemma 5.8.14. Let $f : X \\to Y$ be a continuous map of topological spaces. Assume that (a) $Y$ is irreducible, (b) $f$ is open, and (c) there exists a dense collection of points $y \\in Y$ such that $f^{-1}(y)$ is irreducible. Then $X$ is irreducible. \n\n    \n]]. Hence we win. \n      $\\square$\n    \n","Proof.\n      We point out that assumption (b) implies that $f$ is surjective (see Definition 5.8.1 [[\n  Definition 5.8.1. Let $X$ be a topological space. \n  \n  \nWe say $X$ is irreducible, if $X$ is not empty, and whenever $X = Z_1 \\cup Z_2$ with $Z_ i$ closed, we have $X = Z_1$ or $X = Z_2$. \n\n\nWe say $Z \\subset X$ is an irreducible component of $X$ if $Z$ is a maximal irreducible subset of $X$. \n\n\n\n]]). Let $T \\subset Y$ be an irreducible component. Note that $T$ is closed, see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]. The lemma follows if we show that $f^{-1}(T)$ is irreducible because any irreducible subset of $X$ maps into an irreducible component of $Y$ by Lemma 5.8.2 [[\n  Lemma 5.8.2. Let $f : X \\to Y$ be a continuous map of topological spaces. If $E \\subset X$ is an irreducible subset, then $f(E) \\subset Y$ is irreducible as well. \n\n    \n]]. Note that $f^{-1}(T) \\to T$ satisfies the assumptions of Lemma 5.8.14 [[\n  Lemma 5.8.14. Let $f : X \\to Y$ be a continuous map of topological spaces. Assume that (a) $Y$ is irreducible, (b) $f$ is open, and (c) there exists a dense collection of points $y \\in Y$ such that $f^{-1}(y)$ is irreducible. Then $X$ is irreducible. \n\n    \n]]. Hence we win. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, both proofs are about relating irreducible components under a map f using hypotheses hf‚ÇÅ‚Äìhf‚ÇÑ and a condition about irreducible fibers: the Lean code constructs an equivalence between irreducible components via image/preimage and proves the inverses using image_preimage_eq (surjectivity) and subset_preimage_image, while also invoking lemmas about irreducibility of images and preimages under the fiber hypotheses. However, the informal proof‚Äôs main thrust is: take an irreducible component T of Y and show f‚Åª¬π(T) is irreducible by applying a lemma like 5.8.14 (open map + dense set of points with irreducible fibers), then conclude via general facts about components and images. Structurally, the Lean proof is much more explicit and stronger: it builds a two-sided inverse (Equiv-like) between components and establishes an order-compatibility statement (map_rel_iff'), whereas the informal proof only argues existence/containment and irreducibility of a specific preimage, not a full bijection with inverse laws. Thus there is partial semantic overlap (use of irreducible-fiber lemmas and surjectivity) but notable structural and goal mismatch.""}"
382,0052,"instance NoetherianSpace.set [NoetherianSpace Œ±] (s : Set Œ±) : NoetherianSpace s :=
  IsInducing.subtypeVal.noetherianSpace
",Formal Proof of Stacks Project Tag 0052,(1),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/NoetherianSpace.lean#L76-L77,Q27041,,5.9.2,lemma,3.0,"['0050', '004C', '0ELQ']","\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n      Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n",\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n,"Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n","
  IsInducing.subtypeVal.noetherianSpace
",instance NoetherianSpace.set [NoetherianSpace Œ±] (s : Set Œ±) : NoetherianSpace s ,"Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4 [[\n  Lemma 5.8.4. Let $X$ be a topological space and suppose $X = \\bigcup _{i = 1, \\ldots , n} X_ i$ where each $X_ i$ is an irreducible closed subset of $X$ and no $X_ i$ is contained in the union of the other members. Then each $X_ i$ is an irreducible component of $X$ and each irreducible component of $X$ is one of the $X_ i$. \n\n    \n]]), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n","Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4 [[\n  Lemma 5.8.4. Let $X$ be a topological space and suppose $X = \\bigcup _{i = 1, \\ldots , n} X_ i$ where each $X_ i$ is an irreducible closed subset of $X$ and no $X_ i$ is contained in the union of the other members. Then each $X_ i$ is an irreducible component of $X$ and each irreducible component of $X$ is one of the $X_ i$. \n\n    \n]]), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (1)","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about Noetherian topological spaces implying (i) every subset is Noetherian via stabilization of descending chains, (ii) existence/finitemess of irreducible components using a minimal counterexample argument, and (iii) each irreducible component contains a nonempty open subset. The Lean item `IsInducing.subtypeVal.noetherianSpace` instead concerns a map `subtypeVal : T ‚Üí X` being inducing and transferring the `NoetherianSpace` property along this inducing map (typically: if X is Noetherian then the subtype is Noetherian). This matches only the first paragraph‚Äôs theme (subspaces of a Noetherian space are Noetherian) and does not address the irreducible-component arguments or the final open-subset-in-component claim. Structurally, the informal proof is multi-part with several lemmas and a contradiction/minimal element argument, while the Lean proof is a single lemma about inducing maps/subtype inclusion. Hence the formal proof captures at best a small fragment and is largely not aligned with the full informal proof.""}"
383,0052,"theorem NoetherianSpace.finite_irreducibleComponents [NoetherianSpace Œ±] :
    (irreducibleComponents Œ±).Finite := by
  obtain ‚ü®S : Set (Set Œ±), hSf, hSc, hSi, hSU‚ü© :=
    NoetherianSpace.exists_finite_set_isClosed_irreducible isClosed_univ (Œ± := Œ±)
  refine hSf.subset fun s hs => ?_
  lift S to Finset (Set Œ±) using hSf
  rcases isIrreducible_iff_sUnion_isClosed.1 hs.1 S hSc (hSU ‚ñ∏ Set.subset_univ _) with ‚ü®t, htS, ht‚ü©
  rwa [ht.antisymm (hs.2 (hSi _ htS) ht)]
",Formal Proof of Stacks Project Tag 0052,(2),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/NoetherianSpace.lean#L189-L196,Q27041,,5.9.2,lemma,3.0,"['0050', '004C', '0ELQ']","\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n      Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n",\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n,"Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n"," by
  obtain ‚ü®S : Set (Set Œ±), hSf, hSc, hSi, hSU‚ü© :=
    NoetherianSpace.exists_finite_set_isClosed_irreducible isClosed_univ (Œ± := Œ±)
  refine hSf.subset fun s hs => ?_
  lift S to Finset (Set Œ±) using hSf
  rcases isIrreducible_iff_sUnion_isClosed.1 hs.1 S hSc (hSU ‚ñ∏ Set.subset_univ _) with ‚ü®t, htS, ht‚ü©
  rwa [ht.antisymm (hs.2 (hSi _ htS) ht)]
","theorem NoetherianSpace.finite_irreducibleComponents [NoetherianSpace Œ±] :
    (irreducibleComponents Œ±).Finite ","Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4 [[\n  Lemma 5.8.4. Let $X$ be a topological space and suppose $X = \\bigcup _{i = 1, \\ldots , n} X_ i$ where each $X_ i$ is an irreducible closed subset of $X$ and no $X_ i$ is contained in the union of the other members. Then each $X_ i$ is an irreducible component of $X$ and each irreducible component of $X$ is one of the $X_ i$. \n\n    \n]]), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n","Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4 [[\n  Lemma 5.8.4. Let $X$ be a topological space and suppose $X = \\bigcup _{i = 1, \\ldots , n} X_ i$ where each $X_ i$ is an irreducible closed subset of $X$ and no $X_ i$ is contained in the union of the other members. Then each $X_ i$ is an irreducible component of $X$ and each irreducible component of $X$ is one of the $X_ i$. \n\n    \n]]), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (2)","{""Alignment Score"": ""2"", ""brief_justification"": ""Semantically, the Lean proof is about extracting a finite family of closed irreducible sets covering `univ` in a Noetherian space (via `NoetherianSpace.exists_finite_set_isClosed_irreducible isClosed_univ`) and then using `isIrreducible_iff_sUnion_isClosed` to pick a member `t ‚àà S` equal to a given irreducible closed set `s`. This corresponds to a *component-existence/finite-cover* style result, not to the full informal argument.\n\nStructurally, the informal proof has three major parts: (i) show subsets of a Noetherian space are Noetherian via descending chains, (ii) prove existence of a finite decomposition into irreducible components by a minimal counterexample argument, and (iii) deduce that each irreducible component contains a nonempty open subset. None of these steps (descending chain stabilization, minimal element in a poset, decomposition into two proper closed subsets, or the open-subset-in-component argument) appears in the Lean code. The Lean code instead starts from an already-established finite set of closed irreducible subsets and performs a finitary selection argument.\n\nThus there is only weak thematic overlap (Noetherian + finite irreducible cover/components), but the Lean proof omits the core reasoning and structure of the informal proof and seems to be proving a different lemma or a later corollary rather than the stated informal proof.""}"
384,0052,"theorem NoetherianSpace.exists_isOpen_nonempty_subset_irreducibleComponent [NoetherianSpace Œ±]
    (Z : Set Œ±) (H : Z ‚àà irreducibleComponents Œ±) :
    ‚àÉ o : Set Œ±, IsOpen o ‚àß o.Nonempty ‚àß o ‚äÜ Z := by
  classical
  let Œπ : Set (Set Œ±) := irreducibleComponents Œ± \ {Z}
  have hŒπ : Œπ.Finite := NoetherianSpace.finite_irreducibleComponents.subset Set.diff_subset
  have hŒπ' : Finite Œπ := hŒπ
  let U := Z \ ‚ãÉ x : Œπ, x
  have hU0 : U.Nonempty := Set.diff_nonempty.mpr fun r ‚Ü¶ by
    obtain ‚ü®Z', hZ'‚ü© := isIrreducible_iff_sUnion_isClosed.mp H.1 hŒπ.toFinset
      (fun z hz ‚Ü¶ isClosed_of_mem_irreducibleComponents _ (hŒπ.mem_toFinset.mp hz).1)
      (by rwa [hŒπ.coe_toFinset, Set.sUnion_eq_iUnion])
    rw [Set.Finite.mem_toFinset] at hZ'
    exact hZ'.1.2 <| le_antisymm (H.2 hZ'.1.1.1 hZ'.2) hZ'.2
  have hU1 : U = (‚ãÉ x : Œπ, x)·∂ú := by
    rw [Set.compl_eq_univ_diff]
    refine le_antisymm (Set.diff_subset_diff le_top subset_rfl) ?_
    rw [‚Üê Set.compl_eq_univ_diff]
    refine Set.compl_subset_iff_union.mpr (le_antisymm le_top ?_)
    rw [Set.union_comm, ‚Üê Set.sUnion_eq_iUnion, ‚Üê Set.sUnion_insert]
    rintro a -
    by_cases h : a ‚àà U
    ¬∑ exact ‚ü®U, Set.mem_insert _ _, h‚ü©
    ¬∑ rw [Set.mem_diff, Decidable.not_and_iff_not_or_not, not_not, Set.mem_iUnion] at h
      rcases h with (h | ‚ü®i, hi‚ü©)
      ¬∑ refine ‚ü®irreducibleComponent a, Or.inr ?_, mem_irreducibleComponent‚ü©
        simp only [Œπ, Set.mem_diff, Set.mem_singleton_iff]
        refine ‚ü®irreducibleComponent_mem_irreducibleComponents _, ?_‚ü©
        rintro rfl
        exact h mem_irreducibleComponent
      ¬∑ exact ‚ü®i, Or.inr i.2, hi‚ü©
  refine ‚ü®U, hU1 ‚ñ∏ isOpen_compl_iff.mpr ?_, hU0, sdiff_le‚ü©
  exact isClosed_iUnion_of_finite fun i ‚Ü¶ isClosed_of_mem_irreducibleComponents i.1 i.2.1
",Formal Proof of Stacks Project Tag 0052,(3),https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/NoetherianSpace.lean#L199-L231,Q27041,,5.9.2,lemma,3.0,"['0050', '004C', '0ELQ']","\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n      Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n",\n  Lemma 5.9.2. Let $X$ be a Noetherian topological space. \n  \n  \nAny subset of $X$ with the induced topology is Noetherian. \n\n\nThe space $X$ has finitely many irreducible components. \n\n\nEach irreducible component of $X$ contains a nonempty open of $X$. \n\n\n\n\n    \n,"Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n"," by
  classical
  let Œπ : Set (Set Œ±) := irreducibleComponents Œ± \ {Z}
  have hŒπ : Œπ.Finite := NoetherianSpace.finite_irreducibleComponents.subset Set.diff_subset
  have hŒπ' : Finite Œπ := hŒπ
  let U := Z \ ‚ãÉ x : Œπ, x
  have hU0 : U.Nonempty := Set.diff_nonempty.mpr fun r ‚Ü¶ by
    obtain ‚ü®Z', hZ'‚ü© := isIrreducible_iff_sUnion_isClosed.mp H.1 hŒπ.toFinset
      (fun z hz ‚Ü¶ isClosed_of_mem_irreducibleComponents _ (hŒπ.mem_toFinset.mp hz).1)
      (by rwa [hŒπ.coe_toFinset, Set.sUnion_eq_iUnion])
    rw [Set.Finite.mem_toFinset] at hZ'
    exact hZ'.1.2 <| le_antisymm (H.2 hZ'.1.1.1 hZ'.2) hZ'.2
  have hU1 : U = (‚ãÉ x : Œπ, x)·∂ú := by
    rw [Set.compl_eq_univ_diff]
    refine le_antisymm (Set.diff_subset_diff le_top subset_rfl) ?_
    rw [‚Üê Set.compl_eq_univ_diff]
    refine Set.compl_subset_iff_union.mpr (le_antisymm le_top ?_)
    rw [Set.union_comm, ‚Üê Set.sUnion_eq_iUnion, ‚Üê Set.sUnion_insert]
    rintro a -
    by_cases h : a ‚àà U
    ¬∑ exact ‚ü®U, Set.mem_insert _ _, h‚ü©
    ¬∑ rw [Set.mem_diff, Decidable.not_and_iff_not_or_not, not_not, Set.mem_iUnion] at h
      rcases h with (h | ‚ü®i, hi‚ü©)
      ¬∑ refine ‚ü®irreducibleComponent a, Or.inr ?_, mem_irreducibleComponent‚ü©
        simp only [Œπ, Set.mem_diff, Set.mem_singleton_iff]
        refine ‚ü®irreducibleComponent_mem_irreducibleComponents _, ?_‚ü©
        rintro rfl
        exact h mem_irreducibleComponent
      ¬∑ exact ‚ü®i, Or.inr i.2, hi‚ü©
  refine ‚ü®U, hU1 ‚ñ∏ isOpen_compl_iff.mpr ?_, hU0, sdiff_le‚ü©
  exact isClosed_iUnion_of_finite fun i ‚Ü¶ isClosed_of_mem_irreducibleComponents i.1 i.2.1
","theorem NoetherianSpace.exists_isOpen_nonempty_subset_irreducibleComponent [NoetherianSpace Œ±]
    (Z : Set Œ±) (H : Z ‚àà irreducibleComponents Œ±) :
    ‚àÉ o : Set Œ±, IsOpen o ‚àß o.Nonempty ‚àß o ‚äÜ Z ","Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4 [[\n  Lemma 5.8.4. Let $X$ be a topological space and suppose $X = \\bigcup _{i = 1, \\ldots , n} X_ i$ where each $X_ i$ is an irreducible closed subset of $X$ and no $X_ i$ is contained in the union of the other members. Then each $X_ i$ is an irreducible component of $X$ and each irreducible component of $X$ is one of the $X_ i$. \n\n    \n]]), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n","Proof.\n      Let $T \\subset X$ be a subset of $X$. Let $T_1 \\supset T_2 \\supset \\ldots $ be a descending chain of closed subsets of $T$. Write $T_ i = T \\cap Z_ i$ with $Z_ i \\subset X$ closed. Consider the descending chain of closed subsets $Z_1 \\supset Z_1\\cap Z_2 \\supset Z_1 \\cap Z_2 \\cap Z_3 \\ldots $ This stabilizes by assumption and hence the original sequence of $T_ i$ stabilizes. Thus $T$ is Noetherian. \n    \n      Let $A$ be the set of closed subsets of $X$ which do not have finitely many irreducible components. Assume that $A$ is not empty to arrive at a contradiction. The set $A$ is partially ordered by inclusion: $\\alpha \\leq \\alpha \' \\Leftrightarrow Z_{\\alpha } \\subset Z_{\\alpha \'}$. By the descending chain condition we may find a smallest element of $A$, say $Z$. As $Z$ is not a finite union of irreducible components, it is not irreducible. Hence we can write $Z = Z\' \\cup Z\'\'$ and both are strictly smaller closed subsets. By construction $Z\' = \\bigcup Z\'_ i$ and $Z\'\' = \\bigcup Z\'\'_ j$ are finite unions of their irreducible components (Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]). Hence $Z = \\bigcup Z\'_ i \\cup \\bigcup Z\'\'_ j$ is a finite union of irreducible closed subsets. After removing redundant members of this expression, this will be the decomposition of $Z$ into its irreducible components (Lemma 5.8.4 [[\n  Lemma 5.8.4. Let $X$ be a topological space and suppose $X = \\bigcup _{i = 1, \\ldots , n} X_ i$ where each $X_ i$ is an irreducible closed subset of $X$ and no $X_ i$ is contained in the union of the other members. Then each $X_ i$ is an irreducible component of $X$ and each irreducible component of $X$ is one of the $X_ i$. \n\n    \n]]), a contradiction. \n    \n      Let $Z \\subset X$ be an irreducible component of $X$. Let $Z_1, \\ldots , Z_ n$ be the other irreducible components of $X$. Consider $U = Z \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$. This is not empty since otherwise the irreducible space $Z$ would be contained in one of the other $Z_ i$. Because $X = Z \\cup Z_1 \\cup \\ldots Z_ n$ (see Lemma 5.8.3 [[\n  Lemma 5.8.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is irreducible so is its closure in $X$. \n\n\nAny irreducible component of $X$ is closed. \n\n\nAny irreducible subset of $X$ is contained in an irreducible component of $X$. \n\n\nEvery point of $X$ is contained in some irreducible component of $X$, in other words, $X$ is the union of its irreducible components. \n\n\n\n\n    \n]]), also $U = X \\setminus (Z_1\\cup \\ldots \\cup Z_ n)$ and hence open in $X$. Thus $Z$ contains a nonempty open of $X$. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: (3)","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof matches the *third* part of the informal argument: given an irreducible component Z, let Œπ be the set of all other irreducible components, define U = Z \\ ‚ãÉ(others), prove U is nonempty (otherwise irreducibility forces Z ‚äÜ some other component), and show U is open by rewriting it as the complement of a finite union of closed irreducible components. Structurally, the Lean code follows the same steps: defines Œπ = irreducibleComponents \\ {Z}, uses NoetherianSpace.finite_irreducibleComponents to get finiteness, defines U, proves U.Nonempty via an irreducibility lemma (isIrreducible_iff_sUnion_isClosed) and a minimality/containment contradiction, then proves U = (‚ãÉ x:Œπ, x)·∂ú and concludes openness using isClosed_iUnion_of_finite and closedness of irreducible components. The mismatch is that the informal proof also contains earlier parts (Noetherian subsets; existence/finite decomposition into irreducible components via minimal counterexample), which are not addressed in the Lean snippet; thus it is not a full alignment with the entire informal text, but it is well-aligned with the relevant concluding lemma.""}"
386,0900,"def CompHaus.toProfiniteObj (X : CompHaus.{u}) : Profinite.{u} where
  toTop := TopCat.of (ConnectedComponents X)
  is_compact := Quotient.compactSpace
  is_hausdorff := ConnectedComponents.t2
  prop := ConnectedComponents.totallyDisconnectedSpace
",Formal Proof of Stacks Project Tag 0900,,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Category/Profinite/Basic.lean#L97-L101,Q27041,,5.22.5,lemma,3.0,"['08ZW', '004C', '0ELQ']","\n  Lemma 5.22.5. Let $X$ be a topological space. If $X$ is quasi-compact and every connected component of $X$ is the intersection of the open and closed subsets containing it, then $\\pi _0(X)$ is a profinite space. \n\n    \n      Proof.\n      We will use Lemma 5.22.2 to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7). It is totally disconnected by construction (Lemma 5.7.9). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3, 5.12.3 and 5.12.6) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n","\n  Lemma 5.22.5. Let $X$ be a topological space. If $X$ is quasi-compact and every connected component of $X$ is the intersection of the open and closed subsets containing it, then $\\pi _0(X)$ is a profinite space. \n\n    \n","Proof.\n      We will use Lemma 5.22.2 to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7). It is totally disconnected by construction (Lemma 5.7.9). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3, 5.12.3 and 5.12.6) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n"," TopCat.of (ConnectedComponents X)
  is_compact := Quotient.compactSpace
  is_hausdorff := ConnectedComponents.t2
  prop := ConnectedComponents.totallyDisconnectedSpace
","def CompHaus.toProfiniteObj (X : CompHaus.{u}) : Profinite.{u} where
  toTop ","Proof.\n      We will use Lemma 5.22.2 [[\n  Lemma 5.22.2. Let $X$ be a topological space. The following are equivalent \n  \n  \n$X$ is a profinite space, and \n\n\n$X$ is Hausdorff, quasi-compact, and totally disconnected. \n\n\n\n   If this is true, then $X$ is a cofiltered limit of finite discrete spaces. \n\n    \n]] to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7 [[\n  Lemma 5.12.7. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf $X$ is quasi-compact, then $f(X)$ is quasi-compact. \n\n\nIf $f$ is quasi-compact, then $f(X)$ is retrocompact. \n\n\n\n\n    \n]]). It is totally disconnected by construction (Lemma 5.7.9 [[\n  Lemma 5.7.9. Let $X$ be a topological space. Let $\\pi _0(X)$ be the set of connected components of $X$. Let $X \\to \\pi _0(X)$ be the map which sends $x \\in X$ to the connected component of $X$ passing through $x$. Endow $\\pi _0(X)$ with the quotient topology. Then $\\pi _0(X)$ is a totally disconnected space and any continuous map $X \\to Y$ from $X$ to a totally disconnected space $Y$ factors through $\\pi _0(X)$. \n\n    \n]]). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3 [[\n  Lemma 5.7.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is connected, then so is its closure. \n\n\nAny connected component of $X$ is closed (but not necessarily open). \n\n\nEvery connected subset of $X$ is contained in a unique connected component of $X$. \n\n\nEvery point of $X$ is contained in a unique connected component, in other words, $X$ is the disjoint union of its connected components. \n\n\n\n\n    \n]], 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]] and 5.12.6 [[\n  Lemma 5.12.6. Let $X$ be a quasi-compact topological space. If $\\{ Z_\\alpha \\} _{\\alpha \\in A}$ is a collection of closed subsets such that the intersection of each finite subcollection is nonempty, then $\\bigcap _{\\alpha \\in A} Z_\\alpha $ is nonempty. \n\n    \n]]) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n","Proof.\n      We will use Lemma 5.22.2 [[\n  Lemma 5.22.2. Let $X$ be a topological space. The following are equivalent \n  \n  \n$X$ is a profinite space, and \n\n\n$X$ is Hausdorff, quasi-compact, and totally disconnected. \n\n\n\n   If this is true, then $X$ is a cofiltered limit of finite discrete spaces. \n\n    \n]] to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7 [[\n  Lemma 5.12.7. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf $X$ is quasi-compact, then $f(X)$ is quasi-compact. \n\n\nIf $f$ is quasi-compact, then $f(X)$ is retrocompact. \n\n\n\n\n    \n]]). It is totally disconnected by construction (Lemma 5.7.9 [[\n  Lemma 5.7.9. Let $X$ be a topological space. Let $\\pi _0(X)$ be the set of connected components of $X$. Let $X \\to \\pi _0(X)$ be the map which sends $x \\in X$ to the connected component of $X$ passing through $x$. Endow $\\pi _0(X)$ with the quotient topology. Then $\\pi _0(X)$ is a totally disconnected space and any continuous map $X \\to Y$ from $X$ to a totally disconnected space $Y$ factors through $\\pi _0(X)$. \n\n    \n]]). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3 [[\n  Lemma 5.7.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is connected, then so is its closure. \n\n\nAny connected component of $X$ is closed (but not necessarily open). \n\n\nEvery connected subset of $X$ is contained in a unique connected component of $X$. \n\n\nEvery point of $X$ is contained in a unique connected component, in other words, $X$ is the disjoint union of its connected components. \n\n\n\n\n    \n]], 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]] and 5.12.6 [[\n  Lemma 5.12.6. Let $X$ be a quasi-compact topological space. If $\\{ Z_\\alpha \\} _{\\alpha \\in A}$ is a collection of closed subsets such that the intersection of each finite subcollection is nonempty, then $\\bigcap _{\\alpha \\in A} Z_\\alpha $ is nonempty. \n\n    \n]]) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n","{""Alignment Score"": ""3"", ""brief_justification"": ""Semantically, the formal proof constructs `TopCat.of (ConnectedComponents X)` and supplies instances showing it is compact (`Quotient.compactSpace`), Hausdorff (`ConnectedComponents.t2`), and totally disconnected (`ConnectedComponents.totallyDisconnectedSpace`). This matches the informal proof‚Äôs end goal of proving that \\(\\pi_0(X)\\) is quasi-compact, Hausdorff, and totally disconnected (hence profinite by an external lemma).\n\nStructurally, however, the informal proof gives a detailed argument: quasi-compactness via image of a quasi-compact space under the quotient map, total disconnectedness by the universal property of connected components, and Hausdorffness via separation of distinct components using clopen neighborhoods and quasi-compactness lemmas. The formal proof does not reflect this structure; it simply invokes pre-existing Lean lemmas/instances (`ConnectedComponents.t2`, etc.) without reproducing the intermediate reasoning or the appeal to the ‚Äúprofinite iff compact+Hausdorff+totally disconnected‚Äù lemma.\n\nCompleteness-wise, the formal proof omits the explicit use of the equivalence lemma and the detailed Hausdorff argument, but it does cover the same key properties as final facts. Precision is fine (no obvious extra claims beyond those properties).""}"
388,0B31,"instance Subtype.t0Space [T0Space X] {p : X ‚Üí Prop} : T0Space (Subtype p) :=
  IsEmbedding.subtypeVal.t0Space
",Formal Proof of Stacks Project Tag 0B31,part 1,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Separation/Basic.lean#L225-L226,Q27041,,5.8.7,lemma,3.0,"['004U', '004C', '0ELQ']","\n  Lemma 5.8.7. Let $X$ be a topological space and let $Y\\subset X$. \n  \n  \nIf $X$ is Kolmogorov then so is $Y$. \n\n\nSuppose $Y$ is locally closed in $X$. If $X$ is quasi-sober then so is $Y$. \n\n\nSuppose $Y$ is locally closed in $X$. If $X$ is sober then so is $Y$. \n\n\n\n\n    \n      Proof.\n      Proof of (1). Suppose $X$ is Kolmogorov. Let $x,y\\in Y$ with $x\\neq y$. Then $\\overline{\\overline{\\{ x\\} }\\cap Y}=\\overline{\\{ x\\} }\\neq \\overline{\\{ y\\} }= \\overline{\\overline{\\{ y\\} }\\cap Y}$. Hence $\\overline{\\{ x\\} }\\cap Y\\neq \\overline{\\{ y\\} }\\cap Y$. This shows that $Y$ is Kolmogorov. \n    \n      Proof of (2). Suppose $X$ is quasi-sober. It suffices to consider the cases $Y$ is closed and $Y$ is open. First, suppose $Y$ is closed. Let $Z$ be an irreducible closed subset of $Y$. Then $Z$ is an irreducible closed subset of $X$. Hence there exists $x \\in Z$ with $\\overline{\\{ x\\} } = Z$. It follows $\\overline{\\{ x\\} } \\cap Y = Z$. This shows $Y$ is quasi-sober. Second, suppose $Y$ is open. Let $Z$ be an irreducible closed subset of $Y$. Then $\\overline{Z}$ is an irreducible closed subset of $X$. Hence there exists $x \\in \\overline{Z}$ with $\\overline{\\{ x\\} }=\\overline{Z}$. If $x\\notin Y$ we get the contradiction $Z=Z\\cap Y\\subset \\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y=\\emptyset $. Therefore $x\\in Y$. It follows $Z=\\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y$. This shows $Y$ is quasi-sober. \n    \n      Proof of (3). Immediately from (1) and (2). \n      $\\square$\n    \n",\n  Lemma 5.8.7. Let $X$ be a topological space and let $Y\\subset X$. \n  \n  \nIf $X$ is Kolmogorov then so is $Y$. \n\n\nSuppose $Y$ is locally closed in $X$. If $X$ is quasi-sober then so is $Y$. \n\n\nSuppose $Y$ is locally closed in $X$. If $X$ is sober then so is $Y$. \n\n\n\n\n    \n,"Proof.\n      Proof of (1). Suppose $X$ is Kolmogorov. Let $x,y\\in Y$ with $x\\neq y$. Then $\\overline{\\overline{\\{ x\\} }\\cap Y}=\\overline{\\{ x\\} }\\neq \\overline{\\{ y\\} }= \\overline{\\overline{\\{ y\\} }\\cap Y}$. Hence $\\overline{\\{ x\\} }\\cap Y\\neq \\overline{\\{ y\\} }\\cap Y$. This shows that $Y$ is Kolmogorov. \n    \n      Proof of (2). Suppose $X$ is quasi-sober. It suffices to consider the cases $Y$ is closed and $Y$ is open. First, suppose $Y$ is closed. Let $Z$ be an irreducible closed subset of $Y$. Then $Z$ is an irreducible closed subset of $X$. Hence there exists $x \\in Z$ with $\\overline{\\{ x\\} } = Z$. It follows $\\overline{\\{ x\\} } \\cap Y = Z$. This shows $Y$ is quasi-sober. Second, suppose $Y$ is open. Let $Z$ be an irreducible closed subset of $Y$. Then $\\overline{Z}$ is an irreducible closed subset of $X$. Hence there exists $x \\in \\overline{Z}$ with $\\overline{\\{ x\\} }=\\overline{Z}$. If $x\\notin Y$ we get the contradiction $Z=Z\\cap Y\\subset \\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y=\\emptyset $. Therefore $x\\in Y$. It follows $Z=\\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y$. This shows $Y$ is quasi-sober. \n    \n      Proof of (3). Immediately from (1) and (2). \n      $\\square$\n    \n","
  IsEmbedding.subtypeVal.t0Space
",instance Subtype.t0Space [T0Space X] {p : X ‚Üí Prop} : T0Space (Subtype p) ,"Proof.\n      Proof of (1). Suppose $X$ is Kolmogorov. Let $x,y\\in Y$ with $x\\neq y$. Then $\\overline{\\overline{\\{ x\\} }\\cap Y}=\\overline{\\{ x\\} }\\neq \\overline{\\{ y\\} }= \\overline{\\overline{\\{ y\\} }\\cap Y}$. Hence $\\overline{\\{ x\\} }\\cap Y\\neq \\overline{\\{ y\\} }\\cap Y$. This shows that $Y$ is Kolmogorov. \n    \n      Proof of (2). Suppose $X$ is quasi-sober. It suffices to consider the cases $Y$ is closed and $Y$ is open. First, suppose $Y$ is closed. Let $Z$ be an irreducible closed subset of $Y$. Then $Z$ is an irreducible closed subset of $X$. Hence there exists $x \\in Z$ with $\\overline{\\{ x\\} } = Z$. It follows $\\overline{\\{ x\\} } \\cap Y = Z$. This shows $Y$ is quasi-sober. Second, suppose $Y$ is open. Let $Z$ be an irreducible closed subset of $Y$. Then $\\overline{Z}$ is an irreducible closed subset of $X$. Hence there exists $x \\in \\overline{Z}$ with $\\overline{\\{ x\\} }=\\overline{Z}$. If $x\\notin Y$ we get the contradiction $Z=Z\\cap Y\\subset \\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y=\\emptyset $. Therefore $x\\in Y$. It follows $Z=\\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y$. This shows $Y$ is quasi-sober. \n    \n      Proof of (3). Immediately from (1) and (2). \n      $\\square$\n    \n","Proof.\n      Proof of (1). Suppose $X$ is Kolmogorov. Let $x,y\\in Y$ with $x\\neq y$. Then $\\overline{\\overline{\\{ x\\} }\\cap Y}=\\overline{\\{ x\\} }\\neq \\overline{\\{ y\\} }= \\overline{\\overline{\\{ y\\} }\\cap Y}$. Hence $\\overline{\\{ x\\} }\\cap Y\\neq \\overline{\\{ y\\} }\\cap Y$. This shows that $Y$ is Kolmogorov. \n    \n      Proof of (2). Suppose $X$ is quasi-sober. It suffices to consider the cases $Y$ is closed and $Y$ is open. First, suppose $Y$ is closed. Let $Z$ be an irreducible closed subset of $Y$. Then $Z$ is an irreducible closed subset of $X$. Hence there exists $x \\in Z$ with $\\overline{\\{ x\\} } = Z$. It follows $\\overline{\\{ x\\} } \\cap Y = Z$. This shows $Y$ is quasi-sober. Second, suppose $Y$ is open. Let $Z$ be an irreducible closed subset of $Y$. Then $\\overline{Z}$ is an irreducible closed subset of $X$. Hence there exists $x \\in \\overline{Z}$ with $\\overline{\\{ x\\} }=\\overline{Z}$. If $x\\notin Y$ we get the contradiction $Z=Z\\cap Y\\subset \\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y=\\emptyset $. Therefore $x\\in Y$. It follows $Z=\\overline{Z}\\cap Y=\\overline{\\{ x\\} }\\cap Y$. This shows $Y$ is quasi-sober. \n    \n      Proof of (3). Immediately from (1) and (2). \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: part 1","{""Alignment Score"": ""1"", ""brief_justification"": ""Semantically, the informal proof is about inheritance of separation/sobriety-type properties (Kolmogorov/T0, quasi-sober, and a combined statement) from a space X to a subspace Y under assumptions like Y being open/closed, using closure/intersection arguments. The Lean term `IsEmbedding.subtypeVal.t0Space` is a specific lemma about the subtype coercion map `subtypeVal : Y ‚Üí X` being an embedding and transferring a `T0Space` instance along that embedding (i.e., a T0 result for subtypes). It does not address quasi-sobriety, open/closed cases, irreducible closed subsets, or the combined (3) statement. Structurally, the informal proof has three parts with detailed arguments; the Lean proof is a single lemma invocation with no corresponding multi-part structure. Thus the formal proof only (at best) matches a small fragment of part (1) and omits the rest, so overall alignment is very low.""}"
389,0900,"instance ConnectedComponents.t2 [T2Space X] [CompactSpace X] : T2Space (ConnectedComponents X) := by
  -- Fix 2 distinct connected components, with points a and b
  refine ‚ü®ConnectedComponents.surjective_coe.forall‚ÇÇ.2 fun a b ne => ?_‚ü©
  rw [ConnectedComponents.coe_ne_coe] at ne
  have h := connectedComponent_disjoint ne
  -- write ‚Üëb as the intersection of all clopen subsets containing it
  rw [connectedComponent_eq_iInter_isClopen b, disjoint_iff_inter_eq_empty] at h
  -- Now we show that this can be reduced to some clopen containing `‚Üëb` being disjoint to `‚Üëa`
  obtain ‚ü®U, V, hU, ha, hb, rfl‚ü© : ‚àÉ (U : Set X) (V : Set (ConnectedComponents X)),
      IsClopen U ‚àß connectedComponent a ‚à© U = ‚àÖ ‚àß connectedComponent b ‚äÜ U ‚àß (‚Üë) ‚Åª¬π' V = U := by
    have h :=
      (isClosed_connectedComponent (Œ± := X)).isCompact.elim_finite_subfamily_closed
        _ (fun s : { s : Set X // IsClopen s ‚àß b ‚àà s } => s.2.1.1) h
    obtain ‚ü®fin_a, ha‚ü© := h
    -- This clopen and its complement will separate the connected components of `a` and `b`
    set U : Set X := ‚ãÇ (i : { s // IsClopen s ‚àß b ‚àà s }) (_ : i ‚àà fin_a), i
    have hU : IsClopen U := isClopen_biInter_finset fun i _ => i.2.1
    exact ‚ü®U, (‚Üë) '' U, hU, ha, subset_iInter‚ÇÇ fun s _ => s.2.1.connectedComponent_subset s.2.2,
      (connectedComponents_preimage_image U).symm ‚ñ∏ hU.biUnion_connectedComponent_eq‚ü©
  rw [ConnectedComponents.isQuotientMap_coe.isClopen_preimage] at hU
  refine ‚ü®V·∂ú, V, hU.compl.isOpen, hU.isOpen, ?_, hb mem_connectedComponent, disjoint_compl_left‚ü©
  exact fun h => flip Set.Nonempty.ne_empty ha ‚ü®a, mem_connectedComponent, h‚ü©
",Formal Proof of Stacks Project Tag 0900,The Stacks entry proves profiniteness.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Separation/Regular.lean#L758,Q27041,,5.22.5,lemma,3.0,"['08ZW', '004C', '0ELQ']","\n  Lemma 5.22.5. Let $X$ be a topological space. If $X$ is quasi-compact and every connected component of $X$ is the intersection of the open and closed subsets containing it, then $\\pi _0(X)$ is a profinite space. \n\n    \n      Proof.\n      We will use Lemma 5.22.2 to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7). It is totally disconnected by construction (Lemma 5.7.9). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3, 5.12.3 and 5.12.6) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n","\n  Lemma 5.22.5. Let $X$ be a topological space. If $X$ is quasi-compact and every connected component of $X$ is the intersection of the open and closed subsets containing it, then $\\pi _0(X)$ is a profinite space. \n\n    \n","Proof.\n      We will use Lemma 5.22.2 to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7). It is totally disconnected by construction (Lemma 5.7.9). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3, 5.12.3 and 5.12.6) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n"," by
  -- Fix 2 distinct connected components, with points a and b
  refine ‚ü®ConnectedComponents.surjective_coe.forall‚ÇÇ.2 fun a b ne => ?_‚ü©
  rw [ConnectedComponents.coe_ne_coe] at ne
  have h := connectedComponent_disjoint ne
  -- write ‚Üëb as the intersection of all clopen subsets containing it
  rw [connectedComponent_eq_iInter_isClopen b, disjoint_iff_inter_eq_empty] at h
  -- Now we show that this can be reduced to some clopen containing `‚Üëb` being disjoint to `‚Üëa`
  obtain ‚ü®U, V, hU, ha, hb, rfl‚ü© : ‚àÉ (U : Set X) (V : Set (ConnectedComponents X)),
      IsClopen U ‚àß connectedComponent a ‚à© U = ‚àÖ ‚àß connectedComponent b ‚äÜ U ‚àß (‚Üë) ‚Åª¬π' V = U := by
    have h :=
      (isClosed_connectedComponent (Œ± := X)).isCompact.elim_finite_subfamily_closed
        _ (fun s : { s : Set X // IsClopen s ‚àß b ‚àà s } => s.2.1.1) h
    obtain ‚ü®fin_a, ha‚ü© := h
    -- This clopen and its complement will separate the connected components of `a` and `b`
    set U : Set X := ‚ãÇ (i : { s // IsClopen s ‚àß b ‚àà s }) (_ : i ‚àà fin_a), i
    have hU : IsClopen U := isClopen_biInter_finset fun i _ => i.2.1
    exact ‚ü®U, (‚Üë) '' U, hU, ha, subset_iInter‚ÇÇ fun s _ => s.2.1.connectedComponent_subset s.2.2,
      (connectedComponents_preimage_image U).symm ‚ñ∏ hU.biUnion_connectedComponent_eq‚ü©
  rw [ConnectedComponents.isQuotientMap_coe.isClopen_preimage] at hU
  refine ‚ü®V·∂ú, V, hU.compl.isOpen, hU.isOpen, ?_, hb mem_connectedComponent, disjoint_compl_left‚ü©
  exact fun h => flip Set.Nonempty.ne_empty ha ‚ü®a, mem_connectedComponent, h‚ü©
",instance ConnectedComponents.t2 [T2Space X] [CompactSpace X] : T2Space (ConnectedComponents X) ,"Proof.\n      We will use Lemma 5.22.2 [[\n  Lemma 5.22.2. Let $X$ be a topological space. The following are equivalent \n  \n  \n$X$ is a profinite space, and \n\n\n$X$ is Hausdorff, quasi-compact, and totally disconnected. \n\n\n\n   If this is true, then $X$ is a cofiltered limit of finite discrete spaces. \n\n    \n]] to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7 [[\n  Lemma 5.12.7. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf $X$ is quasi-compact, then $f(X)$ is quasi-compact. \n\n\nIf $f$ is quasi-compact, then $f(X)$ is retrocompact. \n\n\n\n\n    \n]]). It is totally disconnected by construction (Lemma 5.7.9 [[\n  Lemma 5.7.9. Let $X$ be a topological space. Let $\\pi _0(X)$ be the set of connected components of $X$. Let $X \\to \\pi _0(X)$ be the map which sends $x \\in X$ to the connected component of $X$ passing through $x$. Endow $\\pi _0(X)$ with the quotient topology. Then $\\pi _0(X)$ is a totally disconnected space and any continuous map $X \\to Y$ from $X$ to a totally disconnected space $Y$ factors through $\\pi _0(X)$. \n\n    \n]]). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3 [[\n  Lemma 5.7.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is connected, then so is its closure. \n\n\nAny connected component of $X$ is closed (but not necessarily open). \n\n\nEvery connected subset of $X$ is contained in a unique connected component of $X$. \n\n\nEvery point of $X$ is contained in a unique connected component, in other words, $X$ is the disjoint union of its connected components. \n\n\n\n\n    \n]], 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]] and 5.12.6 [[\n  Lemma 5.12.6. Let $X$ be a quasi-compact topological space. If $\\{ Z_\\alpha \\} _{\\alpha \\in A}$ is a collection of closed subsets such that the intersection of each finite subcollection is nonempty, then $\\bigcap _{\\alpha \\in A} Z_\\alpha $ is nonempty. \n\n    \n]]) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n","Proof.\n      We will use Lemma 5.22.2 [[\n  Lemma 5.22.2. Let $X$ be a topological space. The following are equivalent \n  \n  \n$X$ is a profinite space, and \n\n\n$X$ is Hausdorff, quasi-compact, and totally disconnected. \n\n\n\n   If this is true, then $X$ is a cofiltered limit of finite discrete spaces. \n\n    \n]] to prove this. Since $\\pi _0(X)$ is the image of a quasi-compact space it is quasi-compact (Lemma 5.12.7 [[\n  Lemma 5.12.7. Let $f : X \\to Y$ be a continuous map of topological spaces. \n  \n  \nIf $X$ is quasi-compact, then $f(X)$ is quasi-compact. \n\n\nIf $f$ is quasi-compact, then $f(X)$ is retrocompact. \n\n\n\n\n    \n]]). It is totally disconnected by construction (Lemma 5.7.9 [[\n  Lemma 5.7.9. Let $X$ be a topological space. Let $\\pi _0(X)$ be the set of connected components of $X$. Let $X \\to \\pi _0(X)$ be the map which sends $x \\in X$ to the connected component of $X$ passing through $x$. Endow $\\pi _0(X)$ with the quotient topology. Then $\\pi _0(X)$ is a totally disconnected space and any continuous map $X \\to Y$ from $X$ to a totally disconnected space $Y$ factors through $\\pi _0(X)$. \n\n    \n]]). Let $C, D \\subset X$ be distinct connected components of $X$. Write $C = \\bigcap U_\\alpha $ as the intersection of the open and closed subsets of $X$ containing $C$. Any finite intersection of $U_\\alpha $\'s is another. Since $\\bigcap U_\\alpha \\cap D = \\emptyset $ we conclude that $U_\\alpha \\cap D = \\emptyset $ for some $\\alpha $ (use Lemmas 5.7.3 [[\n  Lemma 5.7.3. Let $X$ be a topological space. \n  \n  \nIf $T \\subset X$ is connected, then so is its closure. \n\n\nAny connected component of $X$ is closed (but not necessarily open). \n\n\nEvery connected subset of $X$ is contained in a unique connected component of $X$. \n\n\nEvery point of $X$ is contained in a unique connected component, in other words, $X$ is the disjoint union of its connected components. \n\n\n\n\n    \n]], 5.12.3 [[\n  Lemma 5.12.3. A closed subset of a quasi-compact topological space is quasi-compact. \n\n    \n]] and 5.12.6 [[\n  Lemma 5.12.6. Let $X$ be a quasi-compact topological space. If $\\{ Z_\\alpha \\} _{\\alpha \\in A}$ is a collection of closed subsets such that the intersection of each finite subcollection is nonempty, then $\\bigcap _{\\alpha \\in A} Z_\\alpha $ is nonempty. \n\n    \n]]) Since $U_\\alpha $ is open and closed, it is the union of the connected components it contains, i.e., $U_\\alpha $ is the inverse image of some open and closed subset $V_\\alpha \\subset \\pi _0(X)$. This proves that the points corresponding to $C$ and $D$ are contained in disjoint open subsets, i.e., $\\pi _0(X)$ is Hausdorff. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: The Stacks entry proves profiniteness.","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof is focused on showing that distinct connected components in the quotient space `ConnectedComponents X` can be separated by disjoint open sets, i.e. it proves the key Hausdorff separation argument for œÄ‚ÇÄ(X) using clopen subsets of X and compactness/finite subcover reasoning. This matches the core informal argument: write a connected component as an intersection of clopen neighborhoods, use quasi-compactness to reduce to a finite subfamily to find a clopen separating two distinct components, then push it down to an open-and-closed subset of œÄ‚ÇÄ(X) via the quotient map.\n\nStructurally, both proofs follow the same steps: (1) take two distinct components (Lean: `forall‚ÇÇ` over surjective coercion, `connectedComponent_disjoint ne`), (2) express a component as an intersection of clopens (Lean: `connectedComponent_eq_iInter_isClopen b`), (3) use compactness to extract a finite subfamily yielding a single clopen `U` disjoint from the other component (Lean: `isCompact.elim_finite_subfamily_closed` and defining `U` as a finite intersection), and (4) obtain corresponding clopen `V` in `ConnectedComponents X` with `coe ‚Åª¬π' V = U` and then separate by `V` and `V·∂ú` (Lean: `isClopen_preimage`, then `‚ü®V·∂ú, V, ...‚ü©`).\n\nThe main mismatch is that the informal proof is embedded in a broader Stacks argument about profiniteness (quasi-compact + totally disconnected + Hausdorff, etc.), while the Lean snippet only formalizes the Hausdorff separation part for œÄ‚ÇÄ(X) and does not address the surrounding profiniteness equivalence/limit-of-finite-discrete-spaces claims. Within that intended sub-lemma (œÄ‚ÇÄ(X) Hausdorff under compactness assumptions), the alignment is strong, but it is not a full formalization of the entire informal Stacks proof.""}"
390,0073,"theorem isSheaf_iff_isSheaf_comp' {C : Type u‚ÇÅ} [Category.{v‚ÇÅ} C] {D : Type u‚ÇÇ} [Category.{v‚ÇÇ} D]
    (G : C ‚•§ D) [G.ReflectsIsomorphisms] [HasLimitsOfSize.{v, v} C] [PreservesLimitsOfSize.{v, v} G]
    {X : TopCat.{v}} (F : Presheaf C X) : Presheaf.IsSheaf F ‚Üî Presheaf.IsSheaf (F ‚ãô G) :=
  Presheaf.isSheaf_iff_isSheaf_comp _ F G
",Formal Proof of Stacks Project Tag 0073,In fact we prove a stronger version with arbitrary target category.,https://github.com/leanprover-community/mathlib4/tree/ed96f50f75b1f89c4561f2ba2d837eb169052094/Mathlib/Topology/Sheaves/Forget.lean#L50-L53,Q27041,,6.9.2,lemma,3.0,"['0071', '006A', '0ELQ']","\n  Lemma 6.9.2. Suppose the category $\\mathcal{C}$ and the functor $F : \\mathcal{C} \\to \\textit{Sets}$ have the following properties: \n  \n  \n$F$ is faithful, \n\n\n$\\mathcal{C}$ has limits and $F$ commutes with them, and \n\n\nthe functor $F$ reflects isomorphisms. \n\n\n\n   Let $X$ be a topological space. Let $\\mathcal{F}$ be a presheaf with values in $\\mathcal{C}$. Then $\\mathcal{F}$ is a sheaf if and only if the underlying presheaf of sets is a sheaf. \n\n    \n      Proof.\n      Assume that $\\mathcal{F}$ is a sheaf. Then $\\mathcal{F}(U)$ is the equalizer of the diagram above and by assumption we see $F(\\mathcal{F}(U))$ is the equalizer of the corresponding diagram of sets. Hence $F(\\mathcal{F})$ is a sheaf of sets. \n    \n      Assume that $F(\\mathcal{F})$ is a sheaf. Let $E \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ be the equalizer of the two parallel arrows in Definition 6.9.1. We get a canonical morphism $\\mathcal{F}(U) \\to E$, simply because $\\mathcal{F}$ is a presheaf. By assumption, the induced map $F(\\mathcal{F}(U)) \\to F(E)$ is an isomorphism, because $F(E)$ is the equalizer of the corresponding diagram of sets. Hence we see $\\mathcal{F}(U) \\to E$ is an isomorphism by condition (3) of the lemma. \n      $\\square$\n    \n","\n  Lemma 6.9.2. Suppose the category $\\mathcal{C}$ and the functor $F : \\mathcal{C} \\to \\textit{Sets}$ have the following properties: \n  \n  \n$F$ is faithful, \n\n\n$\\mathcal{C}$ has limits and $F$ commutes with them, and \n\n\nthe functor $F$ reflects isomorphisms. \n\n\n\n   Let $X$ be a topological space. Let $\\mathcal{F}$ be a presheaf with values in $\\mathcal{C}$. Then $\\mathcal{F}$ is a sheaf if and only if the underlying presheaf of sets is a sheaf. \n\n    \n","Proof.\n      Assume that $\\mathcal{F}$ is a sheaf. Then $\\mathcal{F}(U)$ is the equalizer of the diagram above and by assumption we see $F(\\mathcal{F}(U))$ is the equalizer of the corresponding diagram of sets. Hence $F(\\mathcal{F})$ is a sheaf of sets. \n    \n      Assume that $F(\\mathcal{F})$ is a sheaf. Let $E \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ be the equalizer of the two parallel arrows in Definition 6.9.1. We get a canonical morphism $\\mathcal{F}(U) \\to E$, simply because $\\mathcal{F}$ is a presheaf. By assumption, the induced map $F(\\mathcal{F}(U)) \\to F(E)$ is an isomorphism, because $F(E)$ is the equalizer of the corresponding diagram of sets. Hence we see $\\mathcal{F}(U) \\to E$ is an isomorphism by condition (3) of the lemma. \n      $\\square$\n    \n","
  Presheaf.isSheaf_iff_isSheaf_comp _ F G
","theorem isSheaf_iff_isSheaf_comp' {C : Type u‚ÇÅ} [Category.{v‚ÇÅ} C] {D : Type u‚ÇÇ} [Category.{v‚ÇÇ} D]
    (G : C ‚•§ D) [G.ReflectsIsomorphisms] [HasLimitsOfSize.{v, v} C] [PreservesLimitsOfSize.{v, v} G]
    {X : TopCat.{v}} (F : Presheaf C X) : Presheaf.IsSheaf F ‚Üî Presheaf.IsSheaf (F ‚ãô G) ","Proof.\n      Assume that $\\mathcal{F}$ is a sheaf. Then $\\mathcal{F}(U)$ is the equalizer of the diagram above and by assumption we see $F(\\mathcal{F}(U))$ is the equalizer of the corresponding diagram of sets. Hence $F(\\mathcal{F})$ is a sheaf of sets. \n    \n      Assume that $F(\\mathcal{F})$ is a sheaf. Let $E \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ be the equalizer of the two parallel arrows in Definition 6.9.1 [[\n  Definition 6.9.1. Let $X$ be a topological space. Let $\\mathcal{C}$ be a category with products. A presheaf $\\mathcal{F}$ with values in $\\mathcal{C}$ on $X$ is a sheaf if for every open covering the diagram \n  \n  \\[  \\xymatrix{ \\mathcal{F}(U) \\ar[r] &  \\prod \\nolimits _{i\\in I} \\mathcal{F}(U_ i) \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\prod \\nolimits _{(i_0, i_1) \\in I \\times I} \\mathcal{F}(U_{i_0} \\cap U_{i_1}) }  \\]\n\n   is an equalizer diagram in the category $\\mathcal{C}$. \n]]. We get a canonical morphism $\\mathcal{F}(U) \\to E$, simply because $\\mathcal{F}$ is a presheaf. By assumption, the induced map $F(\\mathcal{F}(U)) \\to F(E)$ is an isomorphism, because $F(E)$ is the equalizer of the corresponding diagram of sets. Hence we see $\\mathcal{F}(U) \\to E$ is an isomorphism by condition (3) of the lemma. \n      $\\square$\n    \n","Proof.\n      Assume that $\\mathcal{F}$ is a sheaf. Then $\\mathcal{F}(U)$ is the equalizer of the diagram above and by assumption we see $F(\\mathcal{F}(U))$ is the equalizer of the corresponding diagram of sets. Hence $F(\\mathcal{F})$ is a sheaf of sets. \n    \n      Assume that $F(\\mathcal{F})$ is a sheaf. Let $E \\in \\mathop{\\mathrm{Ob}}\\nolimits (\\mathcal{C})$ be the equalizer of the two parallel arrows in Definition 6.9.1 [[\n  Definition 6.9.1. Let $X$ be a topological space. Let $\\mathcal{C}$ be a category with products. A presheaf $\\mathcal{F}$ with values in $\\mathcal{C}$ on $X$ is a sheaf if for every open covering the diagram \n  \n  \\[  \\xymatrix{ \\mathcal{F}(U) \\ar[r] &  \\prod \\nolimits _{i\\in I} \\mathcal{F}(U_ i) \\ar@<1ex>[r] \\ar@<-1ex>[r] &  \\prod \\nolimits _{(i_0, i_1) \\in I \\times I} \\mathcal{F}(U_{i_0} \\cap U_{i_1}) }  \\]\n\n   is an equalizer diagram in the category $\\mathcal{C}$. \n]]. We get a canonical morphism $\\mathcal{F}(U) \\to E$, simply because $\\mathcal{F}$ is a presheaf. By assumption, the induced map $F(\\mathcal{F}(U)) \\to F(E)$ is an isomorphism, because $F(E)$ is the equalizer of the corresponding diagram of sets. Hence we see $\\mathcal{F}(U) \\to E$ is an isomorphism by condition (3) of the lemma. \n      $\\square$\n    \n

Please take into account the following comment, which specifies the relation between the underlying Lean and informal statement: In fact we prove a stronger version with arbitrary target category.","{""Alignment Score"": ""4"", ""brief_justification"": ""Semantically, the Lean proof `Presheaf.isSheaf_iff_isSheaf_comp _ F G` establishes an equivalence between a presheaf being a sheaf and its composition with a functor (or pair of functors) being a sheaf, which matches the informal argument‚Äôs two directions: (1) sheafness is preserved under applying a functor to the values, and (2) sheafness can be reflected back using a condition that detects isomorphisms (the informal ‚Äúcondition (3)‚Äù). Structurally, both are an iff proof with the same forward/backward flow, but the Lean proof is a one-line invocation of a general lemma rather than explicitly reproducing the equalizer/isomorphism argument. The informal proof is specialized to sheaves of sets via a functor to `Set` and uses equalizers explicitly, while the Lean lemma is stated in a more general categorical setting (as noted: stronger version with arbitrary target category), so it likely subsumes the informal proof rather than mirroring its details. No clear extraneous content is present, but the presence of both `F` and `G` in the Lean statement suggests additional generality (e.g. composition or reflection hypotheses) not spelled out in the informal text, preventing a perfect structural match.""}"
